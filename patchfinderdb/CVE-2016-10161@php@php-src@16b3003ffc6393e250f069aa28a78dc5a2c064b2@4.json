{
  "cve_id": "CVE-2016-10161",
  "cve_desc": "The object_common1 function in ext/standard/var_unserializer.c in PHP before 5.6.30, 7.0.x before 7.0.15, and 7.1.x before 7.1.1 allows remote attackers to cause a denial of service (buffer over-read and application crash) via crafted serialized data that is mishandled in a finish_nested_data call.",
  "repo": "php/php-src",
  "patch_hash": "16b3003ffc6393e250f069aa28a78dc5a2c064b2",
  "patch_info": {
    "commit_hash": "16b3003ffc6393e250f069aa28a78dc5a2c064b2",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/16b3003ffc6393e250f069aa28a78dc5a2c064b2",
    "files": [
      "ext/standard/tests/serialize/bug73825.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #73825 - Heap out of bounds read on unserialize in finish_nested_data()",
    "before_after_code_files": [
      "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt": [
      "File: ext/standard/tests/serialize/bug73825.phpt -> ext/standard/tests/serialize/bug73825.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #73825 Heap out of bounds read on unserialize in finish_nested_data()",
      "3: --FILE--",
      "4: <?php",
      "5: $obj = unserialize('O:8:\"00000000\":');",
      "6: var_dump($obj);",
      "7: ?>",
      "8: --EXPECTF--",
      "9: Warning: Bad unserialize data in %sbug73825.php on line %d",
      "11: Notice: unserialize(): Error at offset 13 of 15 bytes in %sbug73825.php on line %d",
      "12: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "405: {",
      "406:  long elements;",
      "408:  elements = parse_iv2((*p) + 2, p);",
      "410:  (*p) += 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "408:  if( *p >= max - 2) {",
      "409:   zend_error(E_WARNING, \"Bad unserialize data\");",
      "410:   return -1;",
      "411:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "417:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
      "419:  }",
      "421:  return elements;",
      "",
      "[Removed Lines]",
      "418:   return 0;",
      "",
      "[Added Lines]",
      "423:   return -1;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "496: {",
      "497:  YYCTYPE yych;",
      "498:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "495: #line 496 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "500: #line 501 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "552:  yych = *(YYMARKER = ++YYCURSOR);",
      "553:  if (yych == ':') goto yy95;",
      "554: yy3:",
      "556:  { return 0; }",
      "558: yy4:",
      "559:  yych = *(YYMARKER = ++YYCURSOR);",
      "560:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "555: #line 861 \"ext/standard/var_unserializer.re\"",
      "557: #line 558 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "560: #line 875 \"ext/standard/var_unserializer.re\"",
      "562: #line 563 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "597:  goto yy3;",
      "598: yy14:",
      "599:  ++YYCURSOR;",
      "601:  {",
      "603:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "605: }",
      "607: yy16:",
      "608:  yych = *++YYCURSOR;",
      "609:  goto yy3;",
      "",
      "[Removed Lines]",
      "600: #line 855 \"ext/standard/var_unserializer.re\"",
      "606: #line 607 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "605: #line 869 \"ext/standard/var_unserializer.re\"",
      "611: #line 612 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "634:  yych = *++YYCURSOR;",
      "635:  if (yych != '\"') goto yy18;",
      "636:  ++YYCURSOR;",
      "638:  {",
      "639:  size_t len, len2, len3, maxlen;",
      "640:  long elements;",
      "",
      "[Removed Lines]",
      "637: #line 708 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "642: #line 717 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "775:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "777:  if (incomplete_class) {",
      "778:   php_store_class_name(*rval, class_name, len2);",
      "779:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "782:  if (elements < 0) {",
      "783:     efree(class_name);",
      "784:     return 0;",
      "785:  }",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "782:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "783: }",
      "785: yy25:",
      "786:  yych = *++YYCURSOR;",
      "787:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "784: #line 785 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "794: #line 795 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "806:  yych = *++YYCURSOR;",
      "807:  if (yych != '\"') goto yy18;",
      "808:  ++YYCURSOR;",
      "810:  {",
      "811:     if (!var_hash) return 0;",
      "813:  INIT_PZVAL(*rval);",
      "817: }",
      "819: yy32:",
      "820:  yych = *++YYCURSOR;",
      "821:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "809: #line 699 \"ext/standard/var_unserializer.re\"",
      "815:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "816:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "818: #line 819 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "819: #line 704 \"ext/standard/var_unserializer.re\"",
      "821:  long elements;",
      "826:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "827:  if (elements < 0) {",
      "828:   return 0;",
      "829:  }",
      "830:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "832: #line 833 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "836:  yych = *++YYCURSOR;",
      "837:  if (yych != '{') goto yy18;",
      "838:  ++YYCURSOR;",
      "840:  {",
      "841:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "839: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "853: #line 683 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "858:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "859: }",
      "861: yy39:",
      "862:  yych = *++YYCURSOR;",
      "863:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "860: #line 861 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "874: #line 875 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "878:  yych = *++YYCURSOR;",
      "879:  if (yych != '\"') goto yy18;",
      "880:  ++YYCURSOR;",
      "882:  {",
      "883:  size_t len, maxlen;",
      "884:  char *str;",
      "",
      "[Removed Lines]",
      "881: #line 643 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "895: #line 648 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "913:  ZVAL_STRINGL(*rval, str, len, 0);",
      "914:  return 1;",
      "915: }",
      "917: yy46:",
      "918:  yych = *++YYCURSOR;",
      "919:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "916: #line 917 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "930: #line 931 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "934:  yych = *++YYCURSOR;",
      "935:  if (yych != '\"') goto yy18;",
      "936:  ++YYCURSOR;",
      "938:  {",
      "939:  size_t len, maxlen;",
      "940:  char *str;",
      "",
      "[Removed Lines]",
      "937: #line 610 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "951: #line 615 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "967:  ZVAL_STRINGL(*rval, str, len, 1);",
      "968:  return 1;",
      "969: }",
      "971: yy53:",
      "972:  yych = *++YYCURSOR;",
      "973:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "970: #line 971 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "984: #line 985 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1055:  }",
      "1056: yy63:",
      "1057:  ++YYCURSOR;",
      "1059:  {",
      "1060: #if SIZEOF_LONG == 4",
      "1061: use_double:",
      "",
      "[Removed Lines]",
      "1058: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1072: #line 605 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1065:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1066:  return 1;",
      "1067: }",
      "1069: yy65:",
      "1070:  yych = *++YYCURSOR;",
      "1071:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1082: #line 1083 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1124:  yych = *++YYCURSOR;",
      "1125:  if (yych != ';') goto yy18;",
      "1126:  ++YYCURSOR;",
      "1128:  {",
      "1130:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1127: #line 585 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1141: #line 590 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1140:  return 1;",
      "1141: }",
      "1143: yy76:",
      "1144:  yych = *++YYCURSOR;",
      "1145:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1156: #line 1157 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1166:  if (yych <= '9') goto yy79;",
      "1167:  if (yych != ';') goto yy18;",
      "1168:  ++YYCURSOR;",
      "1170:  {",
      "1171: #if SIZEOF_LONG == 4",
      "1172:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1169: #line 558 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1183: #line 563 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1193:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1194:  return 1;",
      "1195: }",
      "1197: yy83:",
      "1198:  yych = *++YYCURSOR;",
      "1199:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1201:  yych = *++YYCURSOR;",
      "1202:  if (yych != ';') goto yy18;",
      "1203:  ++YYCURSOR;",
      "1205:  {",
      "1207:  INIT_PZVAL(*rval);",
      "1208:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1209:  return 1;",
      "1210: }",
      "1212: yy87:",
      "1213:  ++YYCURSOR;",
      "1215:  {",
      "1217:  INIT_PZVAL(*rval);",
      "1218:  ZVAL_NULL(*rval);",
      "1219:  return 1;",
      "1220: }",
      "1222: yy89:",
      "1223:  yych = *++YYCURSOR;",
      "1224:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1204: #line 551 \"ext/standard/var_unserializer.re\"",
      "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
      "1214: #line 544 \"ext/standard/var_unserializer.re\"",
      "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1218: #line 556 \"ext/standard/var_unserializer.re\"",
      "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
      "1228: #line 549 \"ext/standard/var_unserializer.re\"",
      "1235: #line 1236 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1241:  if (yych <= '9') goto yy91;",
      "1242:  if (yych != ';') goto yy18;",
      "1243:  ++YYCURSOR;",
      "1245:  {",
      "1246:  long id;",
      "",
      "[Removed Lines]",
      "1244: #line 521 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1258: #line 526 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1265:  return 1;",
      "1266: }",
      "1268: yy95:",
      "1269:  yych = *++YYCURSOR;",
      "1270:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1281: #line 1282 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1287:  if (yych <= '9') goto yy97;",
      "1288:  if (yych != ';') goto yy18;",
      "1289:  ++YYCURSOR;",
      "1291:  {",
      "1292:  long id;",
      "",
      "[Removed Lines]",
      "1290: #line 500 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1304: #line 505 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 26 ---",
      "[Context before]",
      "1309:  return 1;",
      "1310: }",
      "1312: }",
      "1316:  return 0;",
      "",
      "[Removed Lines]",
      "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
      "1313: #line 863 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1325: #line 1326 \"ext/standard/var_unserializer.c\"",
      "1327: #line 877 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "409: {",
      "410:  long elements;",
      "412:  elements = parse_iv2((*p) + 2, p);",
      "414:  (*p) += 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "412:  if( *p >= max - 2) {",
      "413:   zend_error(E_WARNING, \"Bad unserialize data\");",
      "414:   return -1;",
      "415:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
      "423:  }",
      "425:  return elements;",
      "",
      "[Removed Lines]",
      "422:   return 0;",
      "",
      "[Added Lines]",
      "427:   return -1;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "697: }",
      "699: \"o:\" iv \":\" [\"] {",
      "700:     if (!var_hash) return 0;",
      "702:  INIT_PZVAL(*rval);",
      "706: }",
      "708: object \":\" uiv \":\" [\"] {",
      "",
      "[Removed Lines]",
      "704:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "705:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "",
      "[Added Lines]",
      "705:  long elements;",
      "710:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "711:  if (elements < 0) {",
      "712:   return 0;",
      "713:  }",
      "714:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "845:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "847:  if (incomplete_class) {",
      "848:   php_store_class_name(*rval, class_name, len2);",
      "849:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "856:  if (elements < 0) {",
      "857:     efree(class_name);",
      "858:     return 0;",
      "859:  }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "82d4727dbb33a1ca9145b735fb4709c604178c76",
      "candidate_info": {
        "commit_hash": "82d4727dbb33a1ca9145b735fb4709c604178c76",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/82d4727dbb33a1ca9145b735fb4709c604178c76",
        "files": [
          "ext/standard/tests/serialize/bug68044.phpt",
          "ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-7.1' into PHP-7.2\n\n* PHP-7.1:\n  Fixed bug #75152 (signed integer overflow in parse_iv)\n\nConflicts:\n\text/standard/var_unserializer.c",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug68044.phpt||ext/standard/tests/serialize/bug68044.phpt",
          "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug68044.phpt||ext/standard/tests/serialize/bug68044.phpt": [
          "File: ext/standard/tests/serialize/bug68044.phpt -> ext/standard/tests/serialize/bug68044.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: ?>",
          "7: ===DONE==",
          "8: --EXPECTF--",
          "9: Warning: Insufficient data for unserializing - %d required, 1 present in %s%ebug68044.php on line 2",
          "11: Notice: unserialize(): Error at offset 32 of 33 bytes in %s%ebug68044.php on line 2",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9: Warning: unserialize(): Numerical result out of range in %sbug68044.php on line %d",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt": [
          "File: ext/standard/tests/serialize/bug74101.phpt -> ext/standard/tests/serialize/bug74101.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: var_dump(unserialize($s));",
          "7: ?>",
          "8: --EXPECTF--",
          "10: bool(false)",
          "",
          "[Removed Lines]",
          "9: Notice: unserialize(): Error at offset 48 of 74 bytes in %s on line %d",
          "",
          "[Added Lines]",
          "9: Warning: unserialize(): Numerical result out of range in %sbug74101.php on line %d",
          "11: Notice: unserialize(): Error at offset 48 of 74 bytes in %sbug74101.php on line %d",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt": [
          "File: ext/standard/tests/serialize/bug74614.phpt -> ext/standard/tests/serialize/bug74614.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "8: ?>",
          "9: --EXPECTF--",
          "10: Notice: unserialize(): Error at offset %d of 113 bytes in %s on line %d",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10: Warning: unserialize(): Numerical result out of range in %sbug74614.php on line %d",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "325: static inline zend_long parse_iv2(const unsigned char *p, const unsigned char **q)",
          "326: {",
          "328:  zend_long result = 0;",
          "337:  }",
          "347:  }",
          "350:  return result;",
          "351: }",
          "",
          "[Removed Lines]",
          "327:  char cursor;",
          "329:  int neg = 0;",
          "331:  switch (*p) {",
          "332:   case '-':",
          "333:    neg++;",
          "335:   case '+':",
          "336:    p++;",
          "339:  while (1) {",
          "340:   cursor = (char)*p;",
          "341:   if (cursor >= '0' && cursor <= '9') {",
          "342:    result = result * 10 + (size_t)(cursor - (unsigned char)'0');",
          "343:   } else {",
          "344:    break;",
          "345:   }",
          "346:   p++;",
          "348:  if (q) *q = p;",
          "349:  if (neg) return -result;",
          "",
          "[Added Lines]",
          "328:  char *end;",
          "330:  errno = 0;",
          "331:  result = ZEND_STRTOL((const char*)p, &end, 0);",
          "333:  if (q) {",
          "337:  if (errno) {",
          "338:   php_error_docref(NULL, E_WARNING, \"%s\", strerror(errno));",
          "339:   return result;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "652:  start = cursor;",
          "656: {",
          "657:  YYCTYPE yych;",
          "658:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "655: #line 656 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "647: #line 648 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "710: yy2:",
          "711:  ++YYCURSOR;",
          "712: yy3:",
          "714:  { return 0; }",
          "716: yy4:",
          "717:  yych = *(YYMARKER = ++YYCURSOR);",
          "718:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "713: #line 1043 \"ext/standard/var_unserializer.re\"",
          "715: #line 716 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "705: #line 1035 \"ext/standard/var_unserializer.re\"",
          "707: #line 708 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "759:  goto yy3;",
          "760: yy15:",
          "761:  ++YYCURSOR;",
          "763:  {",
          "765:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "767: }",
          "769: yy17:",
          "770:  yych = *++YYCURSOR;",
          "771:  if (yybm[0+yych] & 128) {",
          "",
          "[Removed Lines]",
          "762: #line 1037 \"ext/standard/var_unserializer.re\"",
          "768: #line 769 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "754: #line 1029 \"ext/standard/var_unserializer.re\"",
          "760: #line 761 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "776:  goto yy3;",
          "777: yy19:",
          "778:  ++YYCURSOR;",
          "780:  {",
          "782:  ZVAL_NULL(rval);",
          "783:  return 1;",
          "784: }",
          "786: yy21:",
          "787:  yych = *++YYCURSOR;",
          "788:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "779: #line 709 \"ext/standard/var_unserializer.re\"",
          "785: #line 786 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "771: #line 701 \"ext/standard/var_unserializer.re\"",
          "777: #line 778 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "981:  goto yy18;",
          "982: yy56:",
          "983:  ++YYCURSOR;",
          "985:  {",
          "986:  zend_long id;",
          "",
          "[Removed Lines]",
          "984: #line 660 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "976: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1007:  return 1;",
          "1008: }",
          "1010: yy58:",
          "1011:  yych = *++YYCURSOR;",
          "1012:  if (yych == '\"') goto yy77;",
          "",
          "[Removed Lines]",
          "1009: #line 1010 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1001: #line 1002 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1017:  goto yy18;",
          "1018: yy60:",
          "1019:  ++YYCURSOR;",
          "1021:  {",
          "1023:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1024:  return 1;",
          "1025: }",
          "1027: yy62:",
          "1028:  ++YYCURSOR;",
          "1029:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "",
          "[Removed Lines]",
          "1020: #line 715 \"ext/standard/var_unserializer.re\"",
          "1026: #line 1027 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1012: #line 707 \"ext/standard/var_unserializer.re\"",
          "1018: #line 1019 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1043:  }",
          "1044: yy64:",
          "1045:  ++YYCURSOR;",
          "1047:  {",
          "1048: #if SIZEOF_ZEND_LONG == 4",
          "1049: use_double:",
          "",
          "[Removed Lines]",
          "1046: #line 763 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1038: #line 755 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1052:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1053:  return 1;",
          "1054: }",
          "1056: yy66:",
          "1057:  yych = *++YYCURSOR;",
          "1058:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1055: #line 1056 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1047: #line 1048 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1074:  goto yy18;",
          "1075: yy69:",
          "1076:  ++YYCURSOR;",
          "1078:  {",
          "1079: #if SIZEOF_ZEND_LONG == 4",
          "1080:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1077: #line 721 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1069: #line 713 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1100:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1101:  return 1;",
          "1102: }",
          "1104: yy71:",
          "1105:  yych = *++YYCURSOR;",
          "1106:  if (yych == '\"') goto yy85;",
          "1107:  goto yy18;",
          "1108: yy72:",
          "1109:  ++YYCURSOR;",
          "1111:  {",
          "1112:  zend_long id;",
          "",
          "[Removed Lines]",
          "1103: #line 1104 \"ext/standard/var_unserializer.c\"",
          "1110: #line 685 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1095: #line 1096 \"ext/standard/var_unserializer.c\"",
          "1102: #line 677 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1132:  return 1;",
          "1133: }",
          "1135: yy74:",
          "1136:  yych = *++YYCURSOR;",
          "1137:  if (yych == '\"') goto yy87;",
          "1138:  goto yy18;",
          "1139: yy75:",
          "1140:  ++YYCURSOR;",
          "1142:  {",
          "1143:  size_t len, len2, len3, maxlen;",
          "1144:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1134: #line 1135 \"ext/standard/var_unserializer.c\"",
          "1141: #line 885 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1126: #line 1127 \"ext/standard/var_unserializer.c\"",
          "1133: #line 877 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1291:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1292: }",
          "1294: yy77:",
          "1295:  ++YYCURSOR;",
          "1297:  {",
          "1298:  size_t len, maxlen;",
          "1299:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1293: #line 1294 \"ext/standard/var_unserializer.c\"",
          "1296: #line 810 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1285: #line 1286 \"ext/standard/var_unserializer.c\"",
          "1288: #line 802 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1327:  ZVAL_STR(rval, str);",
          "1328:  return 1;",
          "1329: }",
          "1331: yy79:",
          "1332:  ++YYCURSOR;",
          "1334:  {",
          "1335:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "1330: #line 1331 \"ext/standard/var_unserializer.c\"",
          "1333: #line 844 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "1325: #line 836 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1361:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1362: }",
          "1364: yy81:",
          "1365:  yych = *++YYCURSOR;",
          "1366:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1363: #line 1364 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1355: #line 1356 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1379:  goto yy18;",
          "1380: yy85:",
          "1381:  ++YYCURSOR;",
          "1383:  {",
          "1384:  zend_long elements;",
          "1385:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "1382: #line 874 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1374: #line 866 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1390:  }",
          "1391:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1392: }",
          "1394: yy87:",
          "1395:  ++YYCURSOR;",
          "1397:  {",
          "1398:  size_t len, maxlen;",
          "1399:  char *str;",
          "",
          "[Removed Lines]",
          "1393: #line 1394 \"ext/standard/var_unserializer.c\"",
          "1396: #line 772 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1385: #line 1386 \"ext/standard/var_unserializer.c\"",
          "1388: #line 764 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1431:  }",
          "1432:  return 1;",
          "1433: }",
          "1435: yy89:",
          "1436:  ++YYCURSOR;",
          "1438:  {",
          "",
          "[Removed Lines]",
          "1434: #line 1435 \"ext/standard/var_unserializer.c\"",
          "1437: #line 747 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1426: #line 1427 \"ext/standard/var_unserializer.c\"",
          "1429: #line 739 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1451:  return 1;",
          "1452: }",
          "1454: }",
          "1458:  return 0;",
          "",
          "[Removed Lines]",
          "1453: #line 1454 \"ext/standard/var_unserializer.c\"",
          "1455: #line 1045 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1445: #line 1446 \"ext/standard/var_unserializer.c\"",
          "1447: #line 1037 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "329: static inline zend_long parse_iv2(const unsigned char *p, const unsigned char **q)",
          "330: {",
          "332:  zend_long result = 0;",
          "341:  }",
          "351:  }",
          "354:  return result;",
          "355: }",
          "",
          "[Removed Lines]",
          "331:  char cursor;",
          "333:  int neg = 0;",
          "335:  switch (*p) {",
          "336:   case '-':",
          "337:    neg++;",
          "339:   case '+':",
          "340:    p++;",
          "343:  while (1) {",
          "344:   cursor = (char)*p;",
          "345:   if (cursor >= '0' && cursor <= '9') {",
          "346:    result = result * 10 + (size_t)(cursor - (unsigned char)'0');",
          "347:   } else {",
          "348:    break;",
          "349:   }",
          "350:   p++;",
          "352:  if (q) *q = p;",
          "353:  if (neg) return -result;",
          "",
          "[Added Lines]",
          "332:  char *end;",
          "334:  errno = 0;",
          "335:  result = ZEND_STRTOL((const char*)p, &end, 0);",
          "337:  if (q) {",
          "341:  if (errno) {",
          "342:   php_error_docref(NULL, E_WARNING, \"%s\", strerror(errno));",
          "343:   return result;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0ae14f3a1d946feb7e3c6662377e5521475297f5",
      "candidate_info": {
        "commit_hash": "0ae14f3a1d946feb7e3c6662377e5521475297f5",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/0ae14f3a1d946feb7e3c6662377e5521475297f5",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed access to uninitialized data",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "278:  while (elements-- > 0) {",
          "279:   zval key, *data, d, *old_data;",
          "281:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "282:    zval_dtor(&key);",
          "283:    return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "281:   ZVAL_UNDEF(&key);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "442:  start = cursor;",
          "446: {",
          "447:  YYCTYPE yych;",
          "448:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "445: #line 446 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "446: #line 447 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "502:  yych = *(YYMARKER = ++YYCURSOR);",
          "503:  if (yych == ':') goto yy95;",
          "504: yy3:",
          "506:  { return 0; }",
          "508: yy4:",
          "509:  yych = *(YYMARKER = ++YYCURSOR);",
          "510:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "505: #line 792 \"ext/standard/var_unserializer.re\"",
          "507: #line 508 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "506: #line 793 \"ext/standard/var_unserializer.re\"",
          "508: #line 509 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "547:  goto yy3;",
          "548: yy14:",
          "549:  ++YYCURSOR;",
          "551:  {",
          "553:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "555: }",
          "557: yy16:",
          "558:  yych = *++YYCURSOR;",
          "559:  goto yy3;",
          "",
          "[Removed Lines]",
          "550: #line 786 \"ext/standard/var_unserializer.re\"",
          "556: #line 557 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "551: #line 787 \"ext/standard/var_unserializer.re\"",
          "557: #line 558 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "583:  yych = *++YYCURSOR;",
          "584:  if (yych != '\"') goto yy18;",
          "585:  ++YYCURSOR;",
          "587:  {",
          "588:  size_t len, len2, len3, maxlen;",
          "589:  long elements;",
          "",
          "[Removed Lines]",
          "586: #line 647 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "587: #line 648 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "723:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "724: }",
          "726: yy25:",
          "727:  yych = *++YYCURSOR;",
          "728:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "725: #line 726 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "726: #line 727 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "747:  yych = *++YYCURSOR;",
          "748:  if (yych != '\"') goto yy18;",
          "749:  ++YYCURSOR;",
          "751:  {",
          "",
          "[Removed Lines]",
          "750: #line 639 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "751: #line 640 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "755:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "756:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "757: }",
          "759: yy32:",
          "760:  yych = *++YYCURSOR;",
          "761:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "758: #line 759 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "759: #line 760 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "776:  yych = *++YYCURSOR;",
          "777:  if (yych != '{') goto yy18;",
          "778:  ++YYCURSOR;",
          "780:  {",
          "781:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "779: #line 618 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "780: #line 619 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "798:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "799: }",
          "801: yy39:",
          "802:  yych = *++YYCURSOR;",
          "803:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "800: #line 801 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "801: #line 802 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "818:  yych = *++YYCURSOR;",
          "819:  if (yych != '\"') goto yy18;",
          "820:  ++YYCURSOR;",
          "822:  {",
          "823:  size_t len, maxlen;",
          "",
          "[Removed Lines]",
          "821: #line 588 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "822: #line 589 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "848:  efree(str);",
          "849:  return 1;",
          "850: }",
          "852: yy46:",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "852: #line 853 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "869:  yych = *++YYCURSOR;",
          "870:  if (yych != '\"') goto yy18;",
          "871:  ++YYCURSOR;",
          "873:  {",
          "874:  size_t len, maxlen;",
          "875:  char *str;",
          "",
          "[Removed Lines]",
          "872: #line 561 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "873: #line 562 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "896:  ZVAL_STRINGL(rval, str, len);",
          "897:  return 1;",
          "898: }",
          "900: yy53:",
          "901:  yych = *++YYCURSOR;",
          "902:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "899: #line 900 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "900: #line 901 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "984:  }",
          "985: yy63:",
          "986:  ++YYCURSOR;",
          "988:  {",
          "989: #if SIZEOF_LONG == 4",
          "990: use_double:",
          "",
          "[Removed Lines]",
          "987: #line 552 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "988: #line 553 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "993:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "994:  return 1;",
          "995: }",
          "997: yy65:",
          "998:  yych = *++YYCURSOR;",
          "999:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "996: #line 997 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "997: #line 998 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1052:  yych = *++YYCURSOR;",
          "1053:  if (yych != ';') goto yy18;",
          "1054:  ++YYCURSOR;",
          "1056:  {",
          "",
          "[Removed Lines]",
          "1055: #line 536 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1056: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1069:  return 1;",
          "1070: }",
          "1072: yy76:",
          "1073:  yych = *++YYCURSOR;",
          "1074:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1071: #line 1072 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1072: #line 1073 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1095:  if (yych <= '9') goto yy79;",
          "1096:  if (yych != ';') goto yy18;",
          "1097:  ++YYCURSOR;",
          "1099:  {",
          "1100: #if SIZEOF_LONG == 4",
          "1101:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1098: #line 510 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1099: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1121:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1122:  return 1;",
          "1123: }",
          "1125: yy83:",
          "1126:  yych = *++YYCURSOR;",
          "1127:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1124: #line 1125 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1125: #line 1126 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1129:  yych = *++YYCURSOR;",
          "1130:  if (yych != ';') goto yy18;",
          "1131:  ++YYCURSOR;",
          "1133:  {",
          "1135:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1136:  return 1;",
          "1137: }",
          "1139: yy87:",
          "1140:  ++YYCURSOR;",
          "1142:  {",
          "1144:  ZVAL_NULL(rval);",
          "1145:  return 1;",
          "1146: }",
          "1148: yy89:",
          "1149:  yych = *++YYCURSOR;",
          "1150:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1132: #line 504 \"ext/standard/var_unserializer.re\"",
          "1138: #line 1139 \"ext/standard/var_unserializer.c\"",
          "1141: #line 498 \"ext/standard/var_unserializer.re\"",
          "1147: #line 1148 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1133: #line 505 \"ext/standard/var_unserializer.re\"",
          "1139: #line 1140 \"ext/standard/var_unserializer.c\"",
          "1142: #line 499 \"ext/standard/var_unserializer.re\"",
          "1148: #line 1149 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1167:  if (yych <= '9') goto yy91;",
          "1168:  if (yych != ';') goto yy18;",
          "1169:  ++YYCURSOR;",
          "1171:  {",
          "1172:  long id;",
          "",
          "[Removed Lines]",
          "1170: #line 475 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1171: #line 476 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1191:  return 1;",
          "1192: }",
          "1194: yy95:",
          "1195:  yych = *++YYCURSOR;",
          "1196:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1193: #line 1194 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1213:  if (yych <= '9') goto yy97;",
          "1214:  if (yych != ';') goto yy18;",
          "1215:  ++YYCURSOR;",
          "1217:  {",
          "1218:  long id;",
          "",
          "[Removed Lines]",
          "1216: #line 450 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1217: #line 451 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1239:  return 1;",
          "1240: }",
          "1242: }",
          "1246:  return 0;",
          "",
          "[Removed Lines]",
          "1241: #line 1242 \"ext/standard/var_unserializer.c\"",
          "1243: #line 794 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1242: #line 1243 \"ext/standard/var_unserializer.c\"",
          "1244: #line 795 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "282:  while (elements-- > 0) {",
          "283:   zval key, *data, d, *old_data;",
          "285:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "286:    zval_dtor(&key);",
          "287:    return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "285:   ZVAL_UNDEF(&key);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2dc24005d9fe1827705276cec52397a57ae66549",
      "candidate_info": {
        "commit_hash": "2dc24005d9fe1827705276cec52397a57ae66549",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/2dc24005d9fe1827705276cec52397a57ae66549",
        "files": [
          "ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-7.0' into PHP-7.1\n\n* PHP-7.0:\n  Fixed bug #74101 and bug #74614",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt": [
          "File: ext/standard/tests/serialize/bug74101.phpt -> ext/standard/tests/serialize/bug74101.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74101: Unserialize Heap Use-After-Free (READ: 1) in zval_get_type",
          "3: --FILE--",
          "4: <?php",
          "5: $s = 'O:9:\"Exception\":799999999999999999999999999997:0i:0;a:0:{}i:2;i:0;i:0;R:2;';",
          "6: var_dump(unserialize($s));",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Notice: unserialize(): Error at offset 48 of 74 bytes in %s on line %d",
          "10: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt": [
          "File: ext/standard/tests/serialize/bug74614.phpt -> ext/standard/tests/serialize/bug74614.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74614: Use-after-free in PHP7's unserialize()",
          "3: --FILE--",
          "4: <?php",
          "6: unserialize('a:3020000000000000000000000000000001:{i:0;a:0:{}i:1;i:2;i:2;i:3;i:3;i:4;i:4;i:5;i:5;i:6;i:6;i:7;i:7;i:8;i:8;R:2;}');",
          "8: ?>",
          "9: --EXPECTF--",
          "10: Notice: unserialize(): Error at offset 38 of 113 bytes in %s on line %d",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "548:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "550:  ht = Z_OBJPROP_P(rval);",
          "551:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "552:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "553:   if (has_wakeup) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "551:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "552:   return 0;",
          "553:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "617:  start = cursor;",
          "621: {",
          "622:  YYCTYPE yych;",
          "623:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "620: #line 621 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "624: #line 625 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "675: yy2:",
          "676:  ++YYCURSOR;",
          "677: yy3:",
          "679:  { return 0; }",
          "681: yy4:",
          "682:  yych = *(YYMARKER = ++YYCURSOR);",
          "683:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "678: #line 998 \"ext/standard/var_unserializer.re\"",
          "680: #line 681 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "682: #line 1002 \"ext/standard/var_unserializer.re\"",
          "684: #line 685 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "724:  goto yy3;",
          "725: yy15:",
          "726:  ++YYCURSOR;",
          "728:  {",
          "730:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "732: }",
          "734: yy17:",
          "735:  yych = *++YYCURSOR;",
          "736:  if (yybm[0+yych] & 128) {",
          "",
          "[Removed Lines]",
          "727: #line 992 \"ext/standard/var_unserializer.re\"",
          "733: #line 734 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "731: #line 996 \"ext/standard/var_unserializer.re\"",
          "737: #line 738 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "742:  goto yy3;",
          "743: yy19:",
          "744:  ++YYCURSOR;",
          "746:  {",
          "748:  ZVAL_NULL(rval);",
          "749:  return 1;",
          "750: }",
          "752: yy21:",
          "753:  yych = *++YYCURSOR;",
          "754:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "745: #line 676 \"ext/standard/var_unserializer.re\"",
          "751: #line 752 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "749: #line 680 \"ext/standard/var_unserializer.re\"",
          "755: #line 756 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "998:  goto yy18;",
          "999: yy63:",
          "1000:  ++YYCURSOR;",
          "1002:  {",
          "1003:  zend_long id;",
          "",
          "[Removed Lines]",
          "1001: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1005: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1025:  return 1;",
          "1026: }",
          "1028: yy65:",
          "1029:  yych = *++YYCURSOR;",
          "1030:  if (yych == '\"') goto yy84;",
          "",
          "[Removed Lines]",
          "1027: #line 1028 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1031: #line 1032 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1035:  goto yy18;",
          "1036: yy67:",
          "1037:  ++YYCURSOR;",
          "1039:  {",
          "1041:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1042:  return 1;",
          "1043: }",
          "1045: yy69:",
          "1046:  ++YYCURSOR;",
          "1047:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "",
          "[Removed Lines]",
          "1038: #line 682 \"ext/standard/var_unserializer.re\"",
          "1044: #line 1045 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1042: #line 686 \"ext/standard/var_unserializer.re\"",
          "1048: #line 1049 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1061:  }",
          "1062: yy71:",
          "1063:  ++YYCURSOR;",
          "1065:  {",
          "1066: #if SIZEOF_ZEND_LONG == 4",
          "1067: use_double:",
          "",
          "[Removed Lines]",
          "1064: #line 730 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1068: #line 734 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1070:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1071:  return 1;",
          "1072: }",
          "1074: yy73:",
          "1075:  yych = *++YYCURSOR;",
          "1076:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1073: #line 1074 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1077: #line 1078 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1092:  goto yy18;",
          "1093: yy76:",
          "1094:  ++YYCURSOR;",
          "1096:  {",
          "1097: #if SIZEOF_ZEND_LONG == 4",
          "1098:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1095: #line 688 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1099: #line 692 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1118:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1119:  return 1;",
          "1120: }",
          "1122: yy78:",
          "1123:  yych = *++YYCURSOR;",
          "1124:  if (yych == '\"') goto yy92;",
          "1125:  goto yy18;",
          "1126: yy79:",
          "1127:  ++YYCURSOR;",
          "1129:  {",
          "1130:  zend_long id;",
          "",
          "[Removed Lines]",
          "1121: #line 1122 \"ext/standard/var_unserializer.c\"",
          "1128: #line 651 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1125: #line 1126 \"ext/standard/var_unserializer.c\"",
          "1132: #line 655 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1151:  return 1;",
          "1152: }",
          "1154: yy81:",
          "1155:  yych = *++YYCURSOR;",
          "1156:  if (yych == '\"') goto yy94;",
          "1157:  goto yy18;",
          "1158: yy82:",
          "1159:  ++YYCURSOR;",
          "1161:  {",
          "1162:  size_t len, len2, len3, maxlen;",
          "1163:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1153: #line 1154 \"ext/standard/var_unserializer.c\"",
          "1160: #line 840 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1157: #line 1158 \"ext/standard/var_unserializer.c\"",
          "1164: #line 844 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1310:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1311: }",
          "1313: yy84:",
          "1314:  ++YYCURSOR;",
          "1316:  {",
          "1317:  size_t len, maxlen;",
          "1318:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1312: #line 1313 \"ext/standard/var_unserializer.c\"",
          "1315: #line 771 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1316: #line 1317 \"ext/standard/var_unserializer.c\"",
          "1319: #line 775 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1346:  ZVAL_STR(rval, str);",
          "1347:  return 1;",
          "1348: }",
          "1350: yy86:",
          "1351:  ++YYCURSOR;",
          "1353:  {",
          "1354:  zend_long elements = parse_iv(start + 2);",
          "1357:     if (!var_hash) return 0;",
          "1360:   return 0;",
          "1361:  }",
          "",
          "[Removed Lines]",
          "1349: #line 1350 \"ext/standard/var_unserializer.c\"",
          "1352: #line 805 \"ext/standard/var_unserializer.re\"",
          "1359:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "1353: #line 1354 \"ext/standard/var_unserializer.c\"",
          "1356: #line 809 \"ext/standard/var_unserializer.re\"",
          "1363:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1374:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1375: }",
          "1377: yy88:",
          "1378:  yych = *++YYCURSOR;",
          "1379:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1376: #line 1377 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1380: #line 1381 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1398:  goto yy18;",
          "1399: yy92:",
          "1400:  ++YYCURSOR;",
          "1402:  {",
          "1403:  long elements;",
          "1404:     if (!var_hash) return 0;",
          "1406:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "1408:   return 0;",
          "1409:  }",
          "1410:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1411: }",
          "1413: yy94:",
          "1414:  ++YYCURSOR;",
          "1416:  {",
          "1417:  size_t len, maxlen;",
          "1418:  char *str;",
          "",
          "[Removed Lines]",
          "1401: #line 829 \"ext/standard/var_unserializer.re\"",
          "1407:  if (elements < 0) {",
          "1412: #line 1413 \"ext/standard/var_unserializer.c\"",
          "1415: #line 739 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1405: #line 833 \"ext/standard/var_unserializer.re\"",
          "1411:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "1416: #line 1417 \"ext/standard/var_unserializer.c\"",
          "1419: #line 743 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1444:  ZVAL_STRINGL(rval, str, len);",
          "1445:  return 1;",
          "1446: }",
          "1448: yy96:",
          "1449:  yych = *++YYCURSOR;",
          "1450:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1447: #line 1448 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1451: #line 1452 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1452:  goto yy18;",
          "1453: yy97:",
          "1454:  ++YYCURSOR;",
          "1456:  {",
          "",
          "[Removed Lines]",
          "1455: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1459: #line 718 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1469:  return 1;",
          "1470: }",
          "1472: }",
          "1476:  return 0;",
          "",
          "[Removed Lines]",
          "1471: #line 1472 \"ext/standard/var_unserializer.c\"",
          "1473: #line 1000 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1475: #line 1476 \"ext/standard/var_unserializer.c\"",
          "1477: #line 1004 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "552:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "554:  ht = Z_OBJPROP_P(rval);",
          "555:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "556:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "557:   if (has_wakeup) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "555:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "556:   return 0;",
          "557:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "809:     if (!var_hash) return 0;",
          "812:   return 0;",
          "813:  }",
          "",
          "[Removed Lines]",
          "811:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "815:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "831:     if (!var_hash) return 0;",
          "833:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "835:   return 0;",
          "836:  }",
          "837:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "",
          "[Removed Lines]",
          "834:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "838:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6fc358241b84866e8f688055d577ba2fcaf2bbd3",
      "candidate_info": {
        "commit_hash": "6fc358241b84866e8f688055d577ba2fcaf2bbd3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6fc358241b84866e8f688055d577ba2fcaf2bbd3",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Use specialized efree_size()",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "178:  while (var_hash) {",
          "179:   next = var_hash->next;",
          "181:   var_hash = next;",
          "182:  }",
          "",
          "[Removed Lines]",
          "180:   efree(var_hash);",
          "",
          "[Added Lines]",
          "180:   efree_size(var_hash, sizeof(var_entries));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "186:    zval_ptr_dtor(&var_dtor_hash->data[i]);",
          "187:   }",
          "188:   next = var_dtor_hash->next;",
          "190:   var_dtor_hash = next;",
          "191:  }",
          "192: }",
          "",
          "[Removed Lines]",
          "189:   efree(var_dtor_hash);",
          "",
          "[Added Lines]",
          "189:   efree_size(var_dtor_hash, sizeof(var_dtor_entries));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "665:  if (yybm[0+yych] & 128) {",
          "666:   goto yy20;",
          "667:  }",
          "670:  yych = *++YYCURSOR;",
          "671:  if (yych != '\"') goto yy18;",
          "672:  ++YYCURSOR;",
          "",
          "[Removed Lines]",
          "668:  if (yych <= '/') goto yy18;",
          "669:  if (yych >= ';') goto yy18;",
          "",
          "[Added Lines]",
          "668:  if (yych != ':') goto yy18;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "816:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "817: }",
          "819: yy25:",
          "820:  yych = *++YYCURSOR;",
          "821:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "817: #line 818 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "848:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "849:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "850: }",
          "852: yy32:",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "850: #line 851 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "891:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "892: }",
          "894: yy39:",
          "895:  yych = *++YYCURSOR;",
          "896:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "892: #line 893 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "939:  ZVAL_STR(rval, str);",
          "940:  return 1;",
          "941: }",
          "943: yy46:",
          "944:  yych = *++YYCURSOR;",
          "945:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "941: #line 942 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "987:  ZVAL_STRINGL(rval, str, len);",
          "988:  return 1;",
          "989: }",
          "991: yy53:",
          "992:  yych = *++YYCURSOR;",
          "993:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "990: #line 991 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "989: #line 990 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1084:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1085:  return 1;",
          "1086: }",
          "1088: yy65:",
          "1089:  yych = *++YYCURSOR;",
          "1090:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1087: #line 1088 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1160:  return 1;",
          "1161: }",
          "1163: yy76:",
          "1164:  yych = *++YYCURSOR;",
          "1165:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1212:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1213:  return 1;",
          "1214: }",
          "1216: yy83:",
          "1217:  yych = *++YYCURSOR;",
          "1218:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1226:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1227:  return 1;",
          "1228: }",
          "1230: yy87:",
          "1231:  ++YYCURSOR;",
          "1232: #line 581 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1228: #line 1229 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1235:  ZVAL_NULL(rval);",
          "1236:  return 1;",
          "1237: }",
          "1239: yy89:",
          "1240:  yych = *++YYCURSOR;",
          "1241:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1282:  return 1;",
          "1283: }",
          "1285: yy95:",
          "1286:  yych = *++YYCURSOR;",
          "1287:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1327:  return 1;",
          "1328: }",
          "1330: }",
          "1331: #line 881 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1328: #line 1329 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "176:  while (var_hash) {",
          "177:   next = var_hash->next;",
          "179:   var_hash = next;",
          "180:  }",
          "",
          "[Removed Lines]",
          "178:   efree(var_hash);",
          "",
          "[Added Lines]",
          "178:   efree_size(var_hash, sizeof(var_entries));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "184:    zval_ptr_dtor(&var_dtor_hash->data[i]);",
          "185:   }",
          "186:   next = var_dtor_hash->next;",
          "188:   var_dtor_hash = next;",
          "189:  }",
          "190: }",
          "",
          "[Removed Lines]",
          "187:   efree(var_dtor_hash);",
          "",
          "[Added Lines]",
          "187:   efree_size(var_dtor_hash, sizeof(var_dtor_entries));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6bfedfd22eb8521cd0f38ab45fca3c877ee724ca",
      "candidate_info": {
        "commit_hash": "6bfedfd22eb8521cd0f38ab45fca3c877ee724ca",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6bfedfd22eb8521cd0f38ab45fca3c877ee724ca",
        "files": [
          "ext/session/php_session.h",
          "ext/session/session.c",
          "ext/spl/spl_observer.c",
          "ext/standard/php_var.h",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed unserialize()",
        "before_after_code_files": [
          "ext/session/php_session.h||ext/session/php_session.h",
          "ext/session/session.c||ext/session/session.c",
          "ext/spl/spl_observer.c||ext/spl/spl_observer.c",
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/session/php_session.h||ext/session/php_session.h": [
          "File: ext/session/php_session.h -> ext/session/php_session.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "221: PHPAPI void session_adapt_url(const char *, size_t, char **, size_t * TSRMLS_DC);",
          "223: PHPAPI void php_add_session_var(zend_string *name TSRMLS_DC);",
          "225: PHPAPI zval *php_get_session_var(zend_string *name TSRMLS_DC);",
          "227: PHPAPI int php_session_register_module(ps_module *);",
          "",
          "[Removed Lines]",
          "224: PHPAPI void php_set_session_var(zend_string *name, zval *state_val, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "",
          "[Added Lines]",
          "224: PHPAPI zval *php_set_session_var(zend_string *name, zval *state_val, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "",
          "---------------"
        ],
        "ext/session/session.c||ext/session/session.c": [
          "File: ext/session/session.c -> ext/session/session.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "159: }",
          "163: {",
          "164:  IF_SESSION_VARS() {",
          "166:  }",
          "167: }",
          "",
          "[Removed Lines]",
          "165:   zend_set_hash_symbol(state_val, name->val, name->len, Z_ISREF_P(state_val), 1, Z_ARRVAL_P(Z_REFVAL(PS(http_session_vars))));",
          "",
          "[Added Lines]",
          "165:   return zend_hash_update(Z_ARRVAL_P(Z_REFVAL(PS(http_session_vars))), name, state_val);",
          "167:  return NULL;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "924:   }",
          "926:   if (has_value) {",
          "928:    if (php_var_unserialize(&current, (const unsigned char **) &p, (const unsigned char *) endptr, &var_hash TSRMLS_CC)) {",
          "930:    }",
          "932:   }",
          "933:   PS_ADD_VARL(name);",
          "934:   STR_RELEASE(name);",
          "",
          "[Removed Lines]",
          "927:    ZVAL_NULL(&current);",
          "929:     php_set_session_var(name, &current, &var_hash  TSRMLS_CC);",
          "931:    zval_ptr_dtor(&current);",
          "",
          "[Added Lines]",
          "928:    ZVAL_UNDEF(&current);",
          "930:     zval *zv = php_set_session_var(name, &current, &var_hash  TSRMLS_CC);",
          "931:     var_replace(&var_hash, &current, zv);",
          "932:    } else {",
          "933:     zval_ptr_dtor(&current);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "978: {",
          "979:  const char *p, *q;",
          "980:  const char *endptr = val + vallen;",
          "982:  int has_value;",
          "983:  int namelen;",
          "984:  zend_string *name;",
          "",
          "[Removed Lines]",
          "981:  zval stack, *current = NULL;",
          "",
          "[Added Lines]",
          "984:  zval current;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "989:  p = val;",
          "992:  while (p < endptr) {",
          "993:   zval *tmp;",
          "994:   q = p;",
          "",
          "[Removed Lines]",
          "991:  array_init(&stack);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1013:   }",
          "1015:   if (has_value) {",
          "1022:    }",
          "1023:   }",
          "1024:   PS_ADD_VARL(name);",
          "",
          "[Removed Lines]",
          "1016:    zval dummy;",
          "1017:    ZVAL_NULL(&dummy);",
          "1019:    current = zend_hash_next_index_insert(Z_ARRVAL(stack), &dummy);",
          "1020:    if (php_var_unserialize(current, (const unsigned char **) &q, (const unsigned char *) endptr, &var_hash TSRMLS_CC)) {",
          "1021:     php_set_session_var(name, current, &var_hash TSRMLS_CC);",
          "",
          "[Added Lines]",
          "1018:    ZVAL_UNDEF(&current);",
          "1019:    if (php_var_unserialize(&current, (const unsigned char **) &q, (const unsigned char *) endptr, &var_hash TSRMLS_CC)) {",
          "1020:     zval *zv = php_set_session_var(name, &current, &var_hash TSRMLS_CC);",
          "1021:     var_replace(&var_hash, &current, zv);",
          "1022:    } else {",
          "1023:     zval_ptr_dtor(&current);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1030: break_outer_loop:",
          "1032:  PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1035:  return SUCCESS;",
          "1036: }",
          "",
          "[Removed Lines]",
          "1033:  zval_ptr_dtor(&stack);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/spl/spl_observer.c||ext/spl/spl_observer.c": [
          "File: ext/spl/spl_observer.c -> ext/spl/spl_observer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "213:    ZVAL_NULL(&pelement->inf);",
          "214:   }",
          "215:   spl_object_storage_free_hash(intern, hash);",
          "217:  }",
          "219:  ZVAL_COPY(&element.obj, obj);",
          "",
          "[Removed Lines]",
          "216:   return;",
          "",
          "[Added Lines]",
          "216:   return pelement;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "222:  } else {",
          "223:   ZVAL_NULL(&element.inf);",
          "224:  }",
          "226:  spl_object_storage_free_hash(intern, hash);",
          "",
          "[Removed Lines]",
          "225:  zend_hash_update_mem(&intern->storage, hash, &element, sizeof(spl_SplObjectStorageElement));",
          "",
          "[Added Lines]",
          "225:  pelement = zend_hash_update_mem(&intern->storage, hash, &element, sizeof(spl_SplObjectStorageElement));",
          "227:  return pelement;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "796:  const unsigned char *p, *s;",
          "797:  php_unserialize_data_t var_hash;",
          "798:  zval entry, pmembers, pcount, inf;",
          "799:  long count;",
          "801:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"s\", &buf, &buf_len) == FAILURE) {",
          "802:   return;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "800:  spl_SplObjectStorageElement *element;",
          "802:  HashPosition pos;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "869:     var_push_dtor(&var_hash, &pelement->obj);",
          "870:    }",
          "871:   }",
          "873:   zval_ptr_dtor(&entry);",
          "874:   zval_ptr_dtor(&inf);",
          "875:  }",
          "",
          "[Removed Lines]",
          "872:   spl_object_storage_attach(intern, getThis(), &entry, &inf TSRMLS_CC);",
          "",
          "[Added Lines]",
          "876:   element = spl_object_storage_attach(intern, getThis(), &entry, &inf TSRMLS_CC);",
          "877:   var_replace(&var_hash, &entry, &element->obj);",
          "878:   var_replace(&var_hash, &inf, &element->inf);",
          "",
          "---------------"
        ],
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "52: PHPAPI void php_var_serialize(smart_str *buf, zval *struc, php_serialize_data_t *var_hash TSRMLS_DC);",
          "53: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "54: PHPAPI int php_var_unserialize_intern(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "56: #define PHP_VAR_SERIALIZE_INIT(var_hash_ptr) \\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "54: PHPAPI int php_var_unserialize_ref(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "114:  } \\",
          "115: } while (0)",
          "117: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hash, zval *val);",
          "118: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval);",
          "119: PHPAPI void var_destroy(php_unserialize_data_t *var_hash);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "118: PHPAPI void var_replace(php_unserialize_data_t *var_hash, zval *ozval, zval *nzval);",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "34:  void *next;",
          "35: } var_entries;",
          "37: static inline void var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "38: {",
          "39:  var_entries *var_hash = (*var_hashx)->last;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "37: typedef struct {",
          "38:  zval data[VAR_ENTRIES_MAX];",
          "39:  long used_slots;",
          "40:  void *next;",
          "41: } var_dtor_entries;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "61: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "62: {",
          "64: #if VAR_ENTRIES_DBG",
          "65:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "66: #endif",
          "68:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "70:   var_hash->used_slots = 0;",
          "71:   var_hash->next = 0;",
          "",
          "[Removed Lines]",
          "63:  var_entries *var_hash = (*var_hashx)->last_dtor;",
          "69:   var_hash = emalloc(sizeof(var_entries));",
          "",
          "[Added Lines]",
          "69:  var_dtor_entries *var_hash = (*var_hashx)->last_dtor;",
          "75:   var_hash = emalloc(sizeof(var_dtor_entries));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "79:   (*var_hashx)->last_dtor = var_hash;",
          "80:  }",
          "84: }",
          "87: #if 0",
          "88: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "89: {",
          "91: #if VAR_ENTRIES_DBG",
          "92:  fprintf(stderr, \"var_push_dtor_no_addref(%ld): %d (%d)\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval), Z_REFCOUNT_PP(rval));",
          "93: #endif",
          "95:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "97:   var_hash->used_slots = 0;",
          "98:   var_hash->next = 0;",
          "",
          "[Removed Lines]",
          "82:  if (Z_REFCOUNTED_P(rval)) Z_ADDREF_P(rval);",
          "83:  var_hash->data[var_hash->used_slots++] = rval;",
          "90:  var_entries *var_hash = (*var_hashx)->last_dtor;",
          "96:   var_hash = emalloc(sizeof(var_entries));",
          "",
          "[Added Lines]",
          "88:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "89:  var_hash->used_slots++;",
          "96:  var_dtor_entries *var_hash = (*var_hashx)->last_dtor;",
          "102:   var_hash = emalloc(sizeof(var_dtor_entries));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "106:   (*var_hashx)->last_dtor = var_hash;",
          "107:  }",
          "110: }",
          "111: #endif",
          "114: {",
          "115:  var_entries *var_hash = (*var_hashx)->first;",
          "116: #if VAR_ENTRIES_DBG",
          "",
          "[Removed Lines]",
          "109:  var_hash->data[var_hash->used_slots++] = rval;",
          "113: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "",
          "[Added Lines]",
          "115:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "116:  var_hash->used_slots++;",
          "120: PHPAPI void var_replace(php_unserialize_data_t *var_hashx, zval *ozval, zval *nzval)",
          "121: {",
          "122:  long i;",
          "123:  var_entries *var_hash = (*var_hashx)->first;",
          "124: #if VAR_ENTRIES_DBG",
          "125:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(nzval));",
          "126: #endif",
          "128:  while (var_hash) {",
          "129:   for (i = 0; i < var_hash->used_slots; i++) {",
          "130:    if (var_hash->data[i] == ozval) {",
          "131:     var_hash->data[i] = nzval;",
          "133:    }",
          "134:   }",
          "135:   var_hash = var_hash->next;",
          "136:  }",
          "137: }",
          "139: static zval *var_access(php_unserialize_data_t *var_hashx, long id)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "122:   id -= VAR_ENTRIES_MAX;",
          "123:  }",
          "132: }",
          "134: PHPAPI void var_destroy(php_unserialize_data_t *var_hashx)",
          "",
          "[Removed Lines]",
          "125:  if (!var_hash) return !SUCCESS;",
          "127:  if (id < 0 || id >= var_hash->used_slots) return !SUCCESS;",
          "131:  return SUCCESS;",
          "",
          "[Added Lines]",
          "151:  if (!var_hash) return NULL;",
          "153:  if (id < 0 || id >= var_hash->used_slots) return NULL;",
          "155:  return var_hash->data[id];",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "136:  void *next;",
          "137:  long i;",
          "138:  var_entries *var_hash = (*var_hashx)->first;",
          "139: #if VAR_ENTRIES_DBG",
          "140:  fprintf(stderr, \"var_destroy(%ld)\\n\", var_hash?var_hash->used_slots:-1L);",
          "141: #endif",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "163:  var_dtor_entries *var_dtor_hash = (*var_hashx)->first_dtor;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "146:   var_hash = next;",
          "147:  }",
          "154:   }",
          "158:  }",
          "159: }",
          "",
          "[Removed Lines]",
          "149:  var_hash = (*var_hashx)->first_dtor;",
          "151:  while (var_hash) {",
          "152:   for (i = 0; i < var_hash->used_slots; i++) {",
          "153:    zval_ptr_dtor(var_hash->data[i]);",
          "155:   next = var_hash->next;",
          "156:   efree(var_hash);",
          "157:   var_hash = next;",
          "",
          "[Added Lines]",
          "174:  while (var_dtor_hash) {",
          "175:   for (i = 0; i < var_dtor_hash->used_slots; i++) {",
          "176:    zval_ptr_dtor(&var_dtor_hash->data[i]);",
          "178:   next = var_dtor_hash->next;",
          "179:   efree(var_dtor_hash);",
          "180:   var_dtor_hash = next;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "210: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "213: #line 218 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "236: #line 241 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "443:  start = cursor;",
          "447: {",
          "448:  YYCTYPE yych;",
          "449:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "446: #line 447 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "472: #line 473 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "503:  yych = *(YYMARKER = ++YYCURSOR);",
          "504:  if (yych == ':') goto yy95;",
          "505: yy3:",
          "507:  { return 0; }",
          "509: yy4:",
          "510:  yych = *(YYMARKER = ++YYCURSOR);",
          "511:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "506: #line 793 \"ext/standard/var_unserializer.re\"",
          "508: #line 509 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "532: #line 817 \"ext/standard/var_unserializer.re\"",
          "534: #line 535 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "548:  goto yy3;",
          "549: yy14:",
          "550:  ++YYCURSOR;",
          "552:  {",
          "554:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "556: }",
          "558: yy16:",
          "559:  yych = *++YYCURSOR;",
          "560:  goto yy3;",
          "",
          "[Removed Lines]",
          "551: #line 787 \"ext/standard/var_unserializer.re\"",
          "557: #line 558 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "577: #line 811 \"ext/standard/var_unserializer.re\"",
          "583: #line 584 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "584:  yych = *++YYCURSOR;",
          "585:  if (yych != '\"') goto yy18;",
          "586:  ++YYCURSOR;",
          "588:  {",
          "589:  size_t len, len2, len3, maxlen;",
          "590:  long elements;",
          "",
          "[Removed Lines]",
          "587: #line 648 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "613: #line 672 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "724:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "725: }",
          "727: yy25:",
          "728:  yych = *++YYCURSOR;",
          "729:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "726: #line 727 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "752: #line 753 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "748:  yych = *++YYCURSOR;",
          "749:  if (yych != '\"') goto yy18;",
          "750:  ++YYCURSOR;",
          "752:  {",
          "",
          "[Removed Lines]",
          "751: #line 640 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "777: #line 664 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "756:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "757:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "758: }",
          "760: yy32:",
          "761:  yych = *++YYCURSOR;",
          "762:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "759: #line 760 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "785: #line 786 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "777:  yych = *++YYCURSOR;",
          "778:  if (yych != '{') goto yy18;",
          "779:  ++YYCURSOR;",
          "781:  {",
          "782:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "780: #line 619 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "806: #line 643 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "799:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "800: }",
          "802: yy39:",
          "803:  yych = *++YYCURSOR;",
          "804:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "801: #line 802 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "827: #line 828 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "819:  yych = *++YYCURSOR;",
          "820:  if (yych != '\"') goto yy18;",
          "821:  ++YYCURSOR;",
          "823:  {",
          "824:  size_t len, maxlen;",
          "",
          "[Removed Lines]",
          "822: #line 589 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "848: #line 613 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "849:  efree(str);",
          "850:  return 1;",
          "851: }",
          "853: yy46:",
          "854:  yych = *++YYCURSOR;",
          "855:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "852: #line 853 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "878: #line 879 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "870:  yych = *++YYCURSOR;",
          "871:  if (yych != '\"') goto yy18;",
          "872:  ++YYCURSOR;",
          "874:  {",
          "875:  size_t len, maxlen;",
          "876:  char *str;",
          "",
          "[Removed Lines]",
          "873: #line 562 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "899: #line 586 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "897:  ZVAL_STRINGL(rval, str, len);",
          "898:  return 1;",
          "899: }",
          "901: yy53:",
          "902:  yych = *++YYCURSOR;",
          "903:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "900: #line 901 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "926: #line 927 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "985:  }",
          "986: yy63:",
          "987:  ++YYCURSOR;",
          "989:  {",
          "990: #if SIZEOF_LONG == 4",
          "991: use_double:",
          "",
          "[Removed Lines]",
          "988: #line 553 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1014: #line 577 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "994:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "995:  return 1;",
          "996: }",
          "998: yy65:",
          "999:  yych = *++YYCURSOR;",
          "1000:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "997: #line 998 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1023: #line 1024 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1053:  yych = *++YYCURSOR;",
          "1054:  if (yych != ';') goto yy18;",
          "1055:  ++YYCURSOR;",
          "1057:  {",
          "",
          "[Removed Lines]",
          "1056: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1082: #line 561 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1070:  return 1;",
          "1071: }",
          "1073: yy76:",
          "1074:  yych = *++YYCURSOR;",
          "1075:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1072: #line 1073 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1098: #line 1099 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1096:  if (yych <= '9') goto yy79;",
          "1097:  if (yych != ';') goto yy18;",
          "1098:  ++YYCURSOR;",
          "1100:  {",
          "1101: #if SIZEOF_LONG == 4",
          "1102:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1099: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1125: #line 535 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "1122:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1123:  return 1;",
          "1124: }",
          "1126: yy83:",
          "1127:  yych = *++YYCURSOR;",
          "1128:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1125: #line 1126 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1151: #line 1152 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "1130:  yych = *++YYCURSOR;",
          "1131:  if (yych != ';') goto yy18;",
          "1132:  ++YYCURSOR;",
          "1134:  {",
          "1136:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1137:  return 1;",
          "1138: }",
          "1140: yy87:",
          "1141:  ++YYCURSOR;",
          "1143:  {",
          "1145:  ZVAL_NULL(rval);",
          "1146:  return 1;",
          "1147: }",
          "1149: yy89:",
          "1150:  yych = *++YYCURSOR;",
          "1151:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1133: #line 505 \"ext/standard/var_unserializer.re\"",
          "1139: #line 1140 \"ext/standard/var_unserializer.c\"",
          "1142: #line 499 \"ext/standard/var_unserializer.re\"",
          "1148: #line 1149 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1159: #line 529 \"ext/standard/var_unserializer.re\"",
          "1165: #line 1166 \"ext/standard/var_unserializer.c\"",
          "1168: #line 523 \"ext/standard/var_unserializer.re\"",
          "1174: #line 1175 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "1168:  if (yych <= '9') goto yy91;",
          "1169:  if (yych != ';') goto yy18;",
          "1170:  ++YYCURSOR;",
          "1172:  {",
          "1173:  long id;",
          "",
          "[Removed Lines]",
          "1171: #line 476 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1197: #line 500 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "1176:  if (!var_hash) return 0;",
          "1178:  id = parse_iv(start + 2) - 1;",
          "1180:   return 0;",
          "1181:  }",
          "",
          "[Removed Lines]",
          "1179:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "",
          "[Added Lines]",
          "1205:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "1192:  return 1;",
          "1193: }",
          "1195: yy95:",
          "1196:  yych = *++YYCURSOR;",
          "1197:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1220: #line 1221 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 32 ---",
          "[Context before]",
          "1214:  if (yych <= '9') goto yy97;",
          "1215:  if (yych != ';') goto yy18;",
          "1216:  ++YYCURSOR;",
          "1218:  {",
          "1219:  long id;",
          "",
          "[Removed Lines]",
          "1217: #line 451 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1243: #line 477 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 33 ---",
          "[Context before]",
          "1222:  if (!var_hash) return 0;",
          "1224:  id = parse_iv(start + 2) - 1;",
          "1226:   return 0;",
          "1227:  }",
          "1232:  if (Z_ISREF_P(rval_ref)) {",
          "1233:   ZVAL_COPY(rval, rval_ref);",
          "1234:  } else {",
          "",
          "[Removed Lines]",
          "1225:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "1229:  if (!ZVAL_IS_UNDEF(rval)) {",
          "1230:   zval_ptr_dtor(rval);",
          "1231:  }",
          "",
          "[Added Lines]",
          "1251:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1255:  zval_ptr_dtor(rval);",
          "",
          "---------------",
          "--- Hunk 34 ---",
          "[Context before]",
          "1240:  return 1;",
          "1241: }",
          "1243: }",
          "1247:  return 0;",
          "",
          "[Removed Lines]",
          "1242: #line 1243 \"ext/standard/var_unserializer.c\"",
          "1244: #line 795 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1266: #line 1267 \"ext/standard/var_unserializer.c\"",
          "1268: #line 819 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "32:  void *next;",
          "33: } var_entries;",
          "35: static inline void var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "36: {",
          "37:  var_entries *var_hash = (*var_hashx)->last;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35: typedef struct {",
          "36:  zval data[VAR_ENTRIES_MAX];",
          "37:  long used_slots;",
          "38:  void *next;",
          "39: } var_dtor_entries;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "59: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "60: {",
          "62: #if VAR_ENTRIES_DBG",
          "63:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "64: #endif",
          "66:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "68:   var_hash->used_slots = 0;",
          "69:   var_hash->next = 0;",
          "",
          "[Removed Lines]",
          "61:  var_entries *var_hash = (*var_hashx)->last_dtor;",
          "67:   var_hash = emalloc(sizeof(var_entries));",
          "",
          "[Added Lines]",
          "67:  var_dtor_entries *var_hash = (*var_hashx)->last_dtor;",
          "73:   var_hash = emalloc(sizeof(var_dtor_entries));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "77:   (*var_hashx)->last_dtor = var_hash;",
          "78:  }",
          "82: }",
          "85: #if 0",
          "86: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "87: {",
          "89: #if VAR_ENTRIES_DBG",
          "90:  fprintf(stderr, \"var_push_dtor_no_addref(%ld): %d (%d)\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval), Z_REFCOUNT_PP(rval));",
          "91: #endif",
          "93:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "95:   var_hash->used_slots = 0;",
          "96:   var_hash->next = 0;",
          "",
          "[Removed Lines]",
          "80:  if (Z_REFCOUNTED_P(rval)) Z_ADDREF_P(rval);",
          "81:  var_hash->data[var_hash->used_slots++] = rval;",
          "88:  var_entries *var_hash = (*var_hashx)->last_dtor;",
          "94:   var_hash = emalloc(sizeof(var_entries));",
          "",
          "[Added Lines]",
          "86:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "87:  var_hash->used_slots++;",
          "94:  var_dtor_entries *var_hash = (*var_hashx)->last_dtor;",
          "100:   var_hash = emalloc(sizeof(var_dtor_entries));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "104:   (*var_hashx)->last_dtor = var_hash;",
          "105:  }",
          "108: }",
          "109: #endif",
          "112: {",
          "113:  var_entries *var_hash = (*var_hashx)->first;",
          "114: #if VAR_ENTRIES_DBG",
          "",
          "[Removed Lines]",
          "107:  var_hash->data[var_hash->used_slots++] = rval;",
          "111: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "",
          "[Added Lines]",
          "113:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "114:  var_hash->used_slots++;",
          "118: PHPAPI void var_replace(php_unserialize_data_t *var_hashx, zval *ozval, zval *nzval)",
          "119: {",
          "120:  long i;",
          "121:  var_entries *var_hash = (*var_hashx)->first;",
          "122: #if VAR_ENTRIES_DBG",
          "123:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(nzval));",
          "124: #endif",
          "126:  while (var_hash) {",
          "127:   for (i = 0; i < var_hash->used_slots; i++) {",
          "128:    if (var_hash->data[i] == ozval) {",
          "129:     var_hash->data[i] = nzval;",
          "131:    }",
          "132:   }",
          "133:   var_hash = var_hash->next;",
          "134:  }",
          "135: }",
          "137: static zval *var_access(php_unserialize_data_t *var_hashx, long id)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "120:   id -= VAR_ENTRIES_MAX;",
          "121:  }",
          "130: }",
          "132: PHPAPI void var_destroy(php_unserialize_data_t *var_hashx)",
          "",
          "[Removed Lines]",
          "123:  if (!var_hash) return !SUCCESS;",
          "125:  if (id < 0 || id >= var_hash->used_slots) return !SUCCESS;",
          "129:  return SUCCESS;",
          "",
          "[Added Lines]",
          "149:  if (!var_hash) return NULL;",
          "151:  if (id < 0 || id >= var_hash->used_slots) return NULL;",
          "153:  return var_hash->data[id];",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "134:  void *next;",
          "135:  long i;",
          "136:  var_entries *var_hash = (*var_hashx)->first;",
          "137: #if VAR_ENTRIES_DBG",
          "138:  fprintf(stderr, \"var_destroy(%ld)\\n\", var_hash?var_hash->used_slots:-1L);",
          "139: #endif",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "161:  var_dtor_entries *var_dtor_hash = (*var_hashx)->first_dtor;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "144:   var_hash = next;",
          "145:  }",
          "152:   }",
          "156:  }",
          "157: }",
          "",
          "[Removed Lines]",
          "147:  var_hash = (*var_hashx)->first_dtor;",
          "149:  while (var_hash) {",
          "150:   for (i = 0; i < var_hash->used_slots; i++) {",
          "151:    zval_ptr_dtor(var_hash->data[i]);",
          "153:   next = var_hash->next;",
          "154:   efree(var_hash);",
          "155:   var_hash = next;",
          "",
          "[Added Lines]",
          "172:  while (var_dtor_hash) {",
          "173:   for (i = 0; i < var_dtor_hash->used_slots; i++) {",
          "174:    zval_ptr_dtor(&var_dtor_hash->data[i]);",
          "176:   next = var_dtor_hash->next;",
          "177:   efree(var_dtor_hash);",
          "178:   var_dtor_hash = next;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "455:  if (!var_hash) return 0;",
          "457:  id = parse_iv(start + 2) - 1;",
          "459:   return 0;",
          "460:  }",
          "465:  if (Z_ISREF_P(rval_ref)) {",
          "466:   ZVAL_COPY(rval, rval_ref);",
          "467:  } else {",
          "",
          "[Removed Lines]",
          "458:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "462:  if (!ZVAL_IS_UNDEF(rval)) {",
          "463:   zval_ptr_dtor(rval);",
          "464:  }",
          "",
          "[Added Lines]",
          "484:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "488:  zval_ptr_dtor(rval);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "480:  if (!var_hash) return 0;",
          "482:  id = parse_iv(start + 2) - 1;",
          "484:   return 0;",
          "485:  }",
          "",
          "[Removed Lines]",
          "483:  if (id == -1 || var_access(var_hash, id, &rval_ref) != SUCCESS) {",
          "",
          "[Added Lines]",
          "507:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}