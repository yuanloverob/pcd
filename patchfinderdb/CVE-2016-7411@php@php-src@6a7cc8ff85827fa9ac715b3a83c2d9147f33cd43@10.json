{
  "cve_id": "CVE-2016-7411",
  "cve_desc": "ext/standard/var_unserializer.re in PHP before 5.6.26 mishandles object-deserialization failures, which allows remote attackers to cause a denial of service (memory corruption) or possibly have unspecified other impact via an unserialize call that references a partially constructed object.",
  "repo": "php/php-src",
  "patch_hash": "6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
  "patch_info": {
    "commit_hash": "6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
    "files": [
      "Zend/zend_objects_API.c",
      "ext/standard/tests/serialize/bug73052.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #73052 - Memory Corruption in During Deserialized-object Destruction",
    "before_after_code_files": [
      "Zend/zend_objects_API.c||Zend/zend_objects_API.c",
      "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "Zend/zend_objects_API.c||Zend/zend_objects_API.c": [
      "File: Zend/zend_objects_API.c -> Zend/zend_objects_API.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "306: {",
      "307:  zend_object_handle handle = Z_OBJ_HANDLE_P(zobject);",
      "308:  zend_object_store_bucket *obj_bucket = &EG(objects_store).object_buckets[handle];",
      "311:  obj_bucket->destructor_called = 1;",
      "312: }",
      "",
      "[Removed Lines]",
      "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);;",
      "",
      "[Added Lines]",
      "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);",
      "",
      "---------------"
    ],
    "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt": [
      "File: ext/standard/tests/serialize/bug73052.phpt -> ext/standard/tests/serialize/bug73052.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #73052: Memory Corruption in During Deserialized-object Destruction",
      "3: --FILE--",
      "4: <?php",
      "6: class obj {",
      "7:     var $ryat;",
      "8:     public function __destruct() {",
      "9:         $this->ryat = null;",
      "10:     }",
      "11: }",
      "13: $poc = 'O:3:\"obj\":1:{';",
      "14: var_dump(unserialize($poc));",
      "15: ?>",
      "16: --EXPECTF--",
      "17: Notice: unserialize(): Error at offset 13 of 13 bytes in %sbug73052.php on line %d",
      "18: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "438:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
      "439:         zend_hash_clean(Z_OBJPROP_PP(rval));",
      "440:      }",
      "441:      ZVAL_NULL(*rval);",
      "442:   return 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "440:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "495: {",
      "496:  YYCTYPE yych;",
      "497:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "494: #line 495 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "495: #line 496 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "551:  yych = *(YYMARKER = ++YYCURSOR);",
      "552:  if (yych == ':') goto yy95;",
      "553: yy3:",
      "555:  { return 0; }",
      "557: yy4:",
      "558:  yych = *(YYMARKER = ++YYCURSOR);",
      "559:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "554: #line 860 \"ext/standard/var_unserializer.re\"",
      "556: #line 557 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "555: #line 861 \"ext/standard/var_unserializer.re\"",
      "557: #line 558 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "596:  goto yy3;",
      "597: yy14:",
      "598:  ++YYCURSOR;",
      "600:  {",
      "602:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "604: }",
      "606: yy16:",
      "607:  yych = *++YYCURSOR;",
      "608:  goto yy3;",
      "",
      "[Removed Lines]",
      "599: #line 854 \"ext/standard/var_unserializer.re\"",
      "605: #line 606 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "600: #line 855 \"ext/standard/var_unserializer.re\"",
      "606: #line 607 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "633:  yych = *++YYCURSOR;",
      "634:  if (yych != '\"') goto yy18;",
      "635:  ++YYCURSOR;",
      "637:  {",
      "638:  size_t len, len2, len3, maxlen;",
      "639:  long elements;",
      "",
      "[Removed Lines]",
      "636: #line 707 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "637: #line 708 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "781:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "782: }",
      "784: yy25:",
      "785:  yych = *++YYCURSOR;",
      "786:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "783: #line 784 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "784: #line 785 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "805:  yych = *++YYCURSOR;",
      "806:  if (yych != '\"') goto yy18;",
      "807:  ++YYCURSOR;",
      "809:  {",
      "810:     if (!var_hash) return 0;",
      "",
      "[Removed Lines]",
      "808: #line 698 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "809: #line 699 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "814:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "815:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "816: }",
      "818: yy32:",
      "819:  yych = *++YYCURSOR;",
      "820:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "817: #line 818 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "818: #line 819 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "835:  yych = *++YYCURSOR;",
      "836:  if (yych != '{') goto yy18;",
      "837:  ++YYCURSOR;",
      "839:  {",
      "840:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "838: #line 677 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "839: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "857:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "858: }",
      "860: yy39:",
      "861:  yych = *++YYCURSOR;",
      "862:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "859: #line 860 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "860: #line 861 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "877:  yych = *++YYCURSOR;",
      "878:  if (yych != '\"') goto yy18;",
      "879:  ++YYCURSOR;",
      "881:  {",
      "882:  size_t len, maxlen;",
      "883:  char *str;",
      "",
      "[Removed Lines]",
      "880: #line 642 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "881: #line 643 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "912:  ZVAL_STRINGL(*rval, str, len, 0);",
      "913:  return 1;",
      "914: }",
      "916: yy46:",
      "917:  yych = *++YYCURSOR;",
      "918:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "915: #line 916 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "916: #line 917 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "933:  yych = *++YYCURSOR;",
      "934:  if (yych != '\"') goto yy18;",
      "935:  ++YYCURSOR;",
      "937:  {",
      "938:  size_t len, maxlen;",
      "939:  char *str;",
      "",
      "[Removed Lines]",
      "936: #line 609 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "937: #line 610 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "966:  ZVAL_STRINGL(*rval, str, len, 1);",
      "967:  return 1;",
      "968: }",
      "970: yy53:",
      "971:  yych = *++YYCURSOR;",
      "972:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "969: #line 970 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "970: #line 971 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1054:  }",
      "1055: yy63:",
      "1056:  ++YYCURSOR;",
      "1058:  {",
      "1059: #if SIZEOF_LONG == 4",
      "1060: use_double:",
      "",
      "[Removed Lines]",
      "1057: #line 599 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1058: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1064:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1065:  return 1;",
      "1066: }",
      "1068: yy65:",
      "1069:  yych = *++YYCURSOR;",
      "1070:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1067: #line 1068 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1123:  yych = *++YYCURSOR;",
      "1124:  if (yych != ';') goto yy18;",
      "1125:  ++YYCURSOR;",
      "1127:  {",
      "1129:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1126: #line 584 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1127: #line 585 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1139:  return 1;",
      "1140: }",
      "1142: yy76:",
      "1143:  yych = *++YYCURSOR;",
      "1144:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1165:  if (yych <= '9') goto yy79;",
      "1166:  if (yych != ';') goto yy18;",
      "1167:  ++YYCURSOR;",
      "1169:  {",
      "1170: #if SIZEOF_LONG == 4",
      "1171:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1168: #line 557 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1169: #line 558 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1192:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1193:  return 1;",
      "1194: }",
      "1196: yy83:",
      "1197:  yych = *++YYCURSOR;",
      "1198:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1195: #line 1196 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1200:  yych = *++YYCURSOR;",
      "1201:  if (yych != ';') goto yy18;",
      "1202:  ++YYCURSOR;",
      "1204:  {",
      "1206:  INIT_PZVAL(*rval);",
      "1207:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1208:  return 1;",
      "1209: }",
      "1211: yy87:",
      "1212:  ++YYCURSOR;",
      "1214:  {",
      "1216:  INIT_PZVAL(*rval);",
      "1217:  ZVAL_NULL(*rval);",
      "1218:  return 1;",
      "1219: }",
      "1221: yy89:",
      "1222:  yych = *++YYCURSOR;",
      "1223:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1203: #line 550 \"ext/standard/var_unserializer.re\"",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "1213: #line 543 \"ext/standard/var_unserializer.re\"",
      "1220: #line 1221 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1204: #line 551 \"ext/standard/var_unserializer.re\"",
      "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
      "1214: #line 544 \"ext/standard/var_unserializer.re\"",
      "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1240:  if (yych <= '9') goto yy91;",
      "1241:  if (yych != ';') goto yy18;",
      "1242:  ++YYCURSOR;",
      "1244:  {",
      "1245:  long id;",
      "",
      "[Removed Lines]",
      "1243: #line 520 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1244: #line 521 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1264:  return 1;",
      "1265: }",
      "1267: yy95:",
      "1268:  yych = *++YYCURSOR;",
      "1269:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1266: #line 1267 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1286:  if (yych <= '9') goto yy97;",
      "1287:  if (yych != ';') goto yy18;",
      "1288:  ++YYCURSOR;",
      "1290:  {",
      "1291:  long id;",
      "",
      "[Removed Lines]",
      "1289: #line 499 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1290: #line 500 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1308:  return 1;",
      "1309: }",
      "1311: }",
      "1315:  return 0;",
      "",
      "[Removed Lines]",
      "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
      "1312: #line 862 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
      "1313: #line 863 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "442:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
      "443:         zend_hash_clean(Z_OBJPROP_PP(rval));",
      "444:      }",
      "445:      ZVAL_NULL(*rval);",
      "446:   return 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "444:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "61f2f5a0f760157f9c9d32d7d3df2be47a73e74d",
      "candidate_info": {
        "commit_hash": "61f2f5a0f760157f9c9d32d7d3df2be47a73e74d",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/61f2f5a0f760157f9c9d32d7d3df2be47a73e74d",
        "files": [
          "ext/standard/tests/serialize/bug72663_2.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Bug #72663 - part 2\n\nIf a (nested) unserialize() call fails, we remove all the values\nthat were inserted into var_hash during that call. This prevents\ntheir use in other unserializations in the same context.",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug72663_2.phpt||ext/standard/tests/serialize/bug72663_2.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug72663_2.phpt||ext/standard/tests/serialize/bug72663_2.phpt": [
          "File: ext/standard/tests/serialize/bug72663_2.phpt -> ext/standard/tests/serialize/bug72663_2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663 (2): Don't allow references into failed unserialize",
          "3: --FILE--",
          "4: <?php",
          "6: class obj implements Serializable {",
          "7:     public $data;",
          "8:     function serialize() {",
          "9:         return serialize($this->data);",
          "10:     }",
          "11:     function unserialize($data) {",
          "12:         $this->data = unserialize($data);",
          "13:     }",
          "14: }",
          "16: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
          "17: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
          "18: var_dump(unserialize($exploit));",
          "20: ?>",
          "21: --EXPECTF--",
          "22: Notice: unserialize(): Unexpected end of serialized data in %s on line %d",
          "24: Notice: unserialize(): Error at offset 46 of 47 bytes in %s on line %d",
          "26: Notice: unserialize(): Error at offset 79 of 80 bytes in %s on line %d",
          "27: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "301: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "302: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "304: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "305: {",
          "306:  while (elements-- > 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "304: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "310:   ZVAL_UNDEF(&key);",
          "313:    zval_dtor(&key);",
          "314:    return 0;",
          "315:   }",
          "",
          "[Removed Lines]",
          "312:   if (!php_var_unserialize_ex(&key, p, max, NULL, classes)) {",
          "",
          "[Added Lines]",
          "314:   if (!php_var_unserialize_internal(&key, p, max, NULL, classes)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "365:    }",
          "366:   }",
          "369:    zval_dtor(&key);",
          "370:    return 0;",
          "371:   }",
          "",
          "[Removed Lines]",
          "368:   if (!php_var_unserialize_ex(data, p, max, var_hash, classes)) {",
          "",
          "[Added Lines]",
          "370:   if (!php_var_unserialize_internal(data, p, max, var_hash, classes)) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "502:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "503: }",
          "506: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "507: {",
          "508:  const unsigned char *cursor, *limit, *marker, *start;",
          "509:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "508: {",
          "509:  var_entries *orig_var_entries = (*var_hash)->last;",
          "510:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "511:  int result;",
          "513:  result = php_var_unserialize_internal(UNSERIALIZE_PASSTHRU);",
          "515:  if (!result) {",
          "519:   var_entries *e = orig_var_entries;",
          "520:   zend_long s = orig_used_slots;",
          "521:   while (e) {",
          "522:    for (; s < e->used_slots; s++) {",
          "523:     e->data[s] = NULL;",
          "524:    }",
          "526:    e = e->next;",
          "527:    s = 0;",
          "528:   }",
          "529:  }",
          "531:  return result;",
          "532: }",
          "534: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "522:  start = cursor;",
          "526: {",
          "527:  YYCTYPE yych;",
          "528:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "525: #line 526 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "553: #line 554 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "305: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "306: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "308: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "309: {",
          "310:  while (elements-- > 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "308: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "314:   ZVAL_UNDEF(&key);",
          "317:    zval_dtor(&key);",
          "318:    return 0;",
          "319:   }",
          "",
          "[Removed Lines]",
          "316:   if (!php_var_unserialize_ex(&key, p, max, NULL, classes)) {",
          "",
          "[Added Lines]",
          "318:   if (!php_var_unserialize_internal(&key, p, max, NULL, classes)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "369:    }",
          "370:   }",
          "373:    zval_dtor(&key);",
          "374:    return 0;",
          "375:   }",
          "",
          "[Removed Lines]",
          "372:   if (!php_var_unserialize_ex(data, p, max, var_hash, classes)) {",
          "",
          "[Added Lines]",
          "374:   if (!php_var_unserialize_internal(data, p, max, var_hash, classes)) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "506:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "507: }",
          "510: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "511: {",
          "512:  const unsigned char *cursor, *limit, *marker, *start;",
          "513:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "512: {",
          "513:  var_entries *orig_var_entries = (*var_hash)->last;",
          "514:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "515:  int result;",
          "517:  result = php_var_unserialize_internal(UNSERIALIZE_PASSTHRU);",
          "519:  if (!result) {",
          "523:   var_entries *e = orig_var_entries;",
          "524:   zend_long s = orig_used_slots;",
          "525:   while (e) {",
          "526:    for (; s < e->used_slots; s++) {",
          "527:     e->data[s] = NULL;",
          "528:    }",
          "530:    e = e->next;",
          "531:    s = 0;",
          "532:   }",
          "533:  }",
          "535:  return result;",
          "536: }",
          "538: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7f0de1a138a69beb7c537fd1ec84afbc91a45b19",
      "candidate_info": {
        "commit_hash": "7f0de1a138a69beb7c537fd1ec84afbc91a45b19",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/7f0de1a138a69beb7c537fd1ec84afbc91a45b19",
        "files": [
          "ext/exif/exif.c",
          "ext/exif/tests/bug73737.phpt",
          "ext/exif/tests/bug73737.tiff",
          "ext/phar/phar.c",
          "ext/phar/tests/bug73764.phar",
          "ext/phar/tests/bug73764.phpt",
          "ext/phar/tests/bug73768.phar",
          "ext/phar/tests/bug73768.phpt",
          "ext/standard/tests/serialize/bug73825.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-5.6' into PHP-7.0\n\n* PHP-5.6:\n  Fix bug #73737 FPE when parsing a tag format\n  Fix bug #73773 - Seg fault when loading hostile phar\n  Fix bug #73825 - Heap out of bounds read on unserialize in finish_nested_data()\n  Fix bug #73768 - Memory corruption when loading hostile phar\n  Fix int overflows in phar (bug #73764)",
        "before_after_code_files": [
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/exif/tests/bug73737.phpt||ext/exif/tests/bug73737.phpt",
          "ext/phar/phar.c||ext/phar/phar.c",
          "ext/phar/tests/bug73764.phpt||ext/phar/tests/bug73764.phpt",
          "ext/phar/tests/bug73768.phpt||ext/phar/tests/bug73768.phpt",
          "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1297:    if (s_den == 0) {",
          "1298:     return 0;",
          "1299:    } else {",
          "1301:    }",
          "1303:   case TAG_FMT_SSHORT:    return php_ifd_get16u(value, motorola_intel);",
          "",
          "[Removed Lines]",
          "1300:     return php_ifd_get32s(value, motorola_intel) / s_den;",
          "",
          "[Added Lines]",
          "1300:     return (size_t)((double)php_ifd_get32s(value, motorola_intel) / s_den);",
          "",
          "---------------"
        ],
        "ext/exif/tests/bug73737.phpt||ext/exif/tests/bug73737.phpt": [
          "File: ext/exif/tests/bug73737.phpt -> ext/exif/tests/bug73737.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #73737 (Crash when parsing a tag format)",
          "3: --SKIPIF--",
          "4: <?php if (!extension_loaded('exif')) print 'skip exif extension not available';?>",
          "5: --FILE--",
          "6: <?php",
          "7:  $exif = exif_thumbnail(__DIR__ . '/bug73737.tiff');",
          "8:  var_dump($exif);",
          "9: ?>",
          "10: --EXPECTF--",
          "11: Warning: exif_thumbnail(bug73737.tiff): Error in TIFF: filesize(x0030) less than start of IFD dir(x10102) in %s line %d",
          "12: bool(false)",
          "",
          "---------------"
        ],
        "ext/phar/phar.c||ext/phar/phar.c": [
          "File: ext/phar/phar.c -> ext/phar/phar.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "984:   if (alias && alias_len && (alias_len != (int)tmp_len || strncmp(alias, buffer, tmp_len)))",
          "985:   {",
          "987:    php_stream_close(fp);",
          "989:    if (signature) {",
          "",
          "[Removed Lines]",
          "986:    buffer[tmp_len] = '\\0';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "991:    }",
          "993:    if (error) {",
          "995:    }",
          "997:    efree(savebuf);",
          "",
          "[Removed Lines]",
          "994:     spprintf(error, 0, \"cannot load phar \\\"%s\\\" with implicit alias \\\"%s\\\" under different alias \\\"%s\\\"\", fname, buffer, alias);",
          "",
          "[Added Lines]",
          "993:     spprintf(error, 0, \"cannot load phar \\\"%s\\\" with implicit alias \\\"%.*s\\\" under different alias \\\"%s\\\"\", fname, tmp_len, buffer, alias);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1057:  entry.is_persistent = mydata->is_persistent;",
          "1059:  for (manifest_index = 0; manifest_index < manifest_count; ++manifest_index) {",
          "1061:    MAPPHAR_FAIL(\"internal corruption of phar \\\"%s\\\" (truncated manifest entry)\")",
          "1062:   }",
          "",
          "[Removed Lines]",
          "1060:   if (buffer + 4 > endbuffer) {",
          "",
          "[Added Lines]",
          "1059:   if (buffer + 28 > endbuffer) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1071:    entry.manifest_pos = manifest_index;",
          "1072:   }",
          "1075:    MAPPHAR_FAIL(\"internal corruption of phar \\\"%s\\\" (truncated manifest entry)\");",
          "1076:   }",
          "",
          "[Removed Lines]",
          "1074:   if (entry.filename_len + 20 > endbuffer - buffer) {",
          "",
          "[Added Lines]",
          "1073:   if (entry.filename_len > endbuffer - buffer - 24) {",
          "",
          "---------------"
        ],
        "ext/phar/tests/bug73764.phpt||ext/phar/tests/bug73764.phpt": [
          "File: ext/phar/tests/bug73764.phpt -> ext/phar/tests/bug73764.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Phar: PHP bug #73764: Crash while loading hostile phar archive",
          "3: --SKIPIF--",
          "4: <?php if (!extension_loaded(\"phar\")) die(\"skip\"); ?>",
          "5: --FILE--",
          "6: <?php",
          "7: chdir(__DIR__);",
          "8: try {",
          "9: $p = Phar::LoadPhar('bug73764.phar', 'alias.phar');",
          "10: echo \"OK\\n\";",
          "11: } catch(PharException $e) {",
          "12:  echo $e->getMessage();",
          "13: }",
          "14: ?>",
          "15: --EXPECTF--",
          "16: internal corruption of phar \"%sbug73764.phar\" (truncated manifest entry)",
          "",
          "---------------"
        ],
        "ext/phar/tests/bug73768.phpt||ext/phar/tests/bug73768.phpt": [
          "File: ext/phar/tests/bug73768.phpt -> ext/phar/tests/bug73768.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Phar: PHP bug #73768: Memory corruption when loading hostile phar",
          "3: --SKIPIF--",
          "4: <?php if (!extension_loaded(\"phar\")) die(\"skip\"); ?>",
          "5: --FILE--",
          "6: <?php",
          "7: chdir(__DIR__);",
          "8: try {",
          "9: $p = Phar::LoadPhar('bug73768.phar', 'alias.phar');",
          "10: echo \"OK\\n\";",
          "11: } catch(PharException $e) {",
          "12:  echo $e->getMessage();",
          "13: }",
          "14: ?>",
          "15: --EXPECTF--",
          "16: cannot load phar \"%sbug73768.phar\" with implicit alias \"\" under different alias \"alias.phar\"",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt": [
          "File: ext/standard/tests/serialize/bug73825.phpt -> ext/standard/tests/serialize/bug73825.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #73825 Heap out of bounds read on unserialize in finish_nested_data()",
          "3: --FILE--",
          "4: <?php",
          "5: $obj = unserialize('O:8:\"00000000\":');",
          "6: var_dump($obj);",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Warning: Bad unserialize data in %sbug73825.php on line %d",
          "11: Notice: unserialize(): Error at offset 13 of 15 bytes in %sbug73825.php on line %d",
          "12: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "433: {",
          "434:  zend_long elements;",
          "436:  elements = parse_iv2((*p) + 2, p);",
          "438:  (*p) += 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "436:  if( *p >= max - 2) {",
          "437:   zend_error(E_WARNING, \"Bad unserialize data\");",
          "438:   return -1;",
          "439:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "442:  } else {",
          "447:  }",
          "449:  return elements;",
          "",
          "[Removed Lines]",
          "445:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ZSTR_VAL(ce->name));",
          "446:   return 0;",
          "",
          "[Added Lines]",
          "450:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
          "451:   return -1;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "550:  start = cursor;",
          "554: {",
          "555:  YYCTYPE yych;",
          "556:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "553: #line 554 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "558: #line 559 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "587:     0,   0,   0,   0,   0,   0,   0,   0,",
          "588:     0,   0,   0,   0,   0,   0,   0,   0,",
          "589:  };",
          "590:  if ((YYLIMIT - YYCURSOR) < 7) YYFILL(7);",
          "591:  yych = *YYCURSOR;",
          "592:  switch (yych) {",
          "593:  case 'C':",
          "595:  case 'N': goto yy5;",
          "602:  case 'o': goto yy12;",
          "607:  }",
          "608: yy2:",
          "610: yy3:",
          "612:  { return 0; }",
          "614: yy4:",
          "615:  yych = *(YYMARKER = ++YYCURSOR);",
          "617:  goto yy3;",
          "618: yy5:",
          "619:  yych = *++YYCURSOR;",
          "621:  goto yy3;",
          "622: yy6:",
          "623:  yych = *(YYMARKER = ++YYCURSOR);",
          "625:  goto yy3;",
          "626: yy7:",
          "627:  yych = *(YYMARKER = ++YYCURSOR);",
          "629:  goto yy3;",
          "630: yy8:",
          "631:  yych = *(YYMARKER = ++YYCURSOR);",
          "633:  goto yy3;",
          "634: yy9:",
          "635:  yych = *(YYMARKER = ++YYCURSOR);",
          "637:  goto yy3;",
          "638: yy10:",
          "639:  yych = *(YYMARKER = ++YYCURSOR);",
          "641:  goto yy3;",
          "642: yy11:",
          "643:  yych = *(YYMARKER = ++YYCURSOR);",
          "645:  goto yy3;",
          "646: yy12:",
          "647:  yych = *(YYMARKER = ++YYCURSOR);",
          "649:  goto yy3;",
          "650: yy13:",
          "651:  yych = *(YYMARKER = ++YYCURSOR);",
          "653:  goto yy3;",
          "654: yy14:",
          "659:  ++YYCURSOR;",
          "661:  {",
          "663:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "665: }",
          "667: yy17:",
          "668:  yych = *++YYCURSOR;",
          "669:  if (yybm[0+yych] & 128) {",
          "671:  }",
          "673: yy18:",
          "674:  YYCURSOR = YYMARKER;",
          "675:  goto yy3;",
          "676: yy19:",
          "686:  yych = *++YYCURSOR;",
          "695:  }",
          "701:  goto yy18;",
          "710:  if (yych <= '/') goto yy18;",
          "714:  yych = *++YYCURSOR;",
          "723:   }",
          "732:   }",
          "733:  }",
          "744:  }",
          "755:  }",
          "757:  yych = *++YYCURSOR;",
          "758:  if (yych <= ',') {",
          "761:  } else {",
          "763:   if (yych <= '/') goto yy18;",
          "765:   goto yy18;",
          "766:  }",
          "768:  yych = *++YYCURSOR;",
          "770:  if (yych <= '/') goto yy18;",
          "780:  ++YYCURSOR;",
          "781:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "782:  yych = *YYCURSOR;",
          "786:  if (yych <= '/') goto yy18;",
          "790:  yych = *++YYCURSOR;",
          "794:  ++YYCURSOR;",
          "797:  if (yych <= '/') goto yy18;",
          "798:  if (yych <= '9') goto yy34;",
          "800:  goto yy18;",
          "802:  yych = *++YYCURSOR;",
          "803:  if (yych <= '/') goto yy18;",
          "804:  if (yych >= ':') goto yy18;",
          "806:  ++YYCURSOR;",
          "807:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "808:  yych = *YYCURSOR;",
          "809:  if (yych <= '/') goto yy18;",
          "814:  yych = *++YYCURSOR;",
          "818:  ++YYCURSOR;",
          "843:  }",
          "871:  }",
          "881:  yych = *++YYCURSOR;",
          "882:  if (yych <= '/') goto yy18;",
          "891:  goto yy18;",
          "893:  yych = *++YYCURSOR;",
          "894:  if (yych <= '/') goto yy18;",
          "895:  if (yych >= ':') goto yy18;",
          "897:  ++YYCURSOR;",
          "898:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "899:  yych = *YYCURSOR;",
          "900:  if (yych <= '/') goto yy18;",
          "905:  yych = *++YYCURSOR;",
          "909:  ++YYCURSOR;",
          "912:  if (yych <= '/') goto yy18;",
          "915:  goto yy18;",
          "917:  yych = *++YYCURSOR;",
          "918:  if (yych <= '/') goto yy18;",
          "919:  if (yych >= ':') goto yy18;",
          "921:  ++YYCURSOR;",
          "922:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "923:  yych = *YYCURSOR;",
          "924:  if (yych <= '/') goto yy18;",
          "929:  yych = *++YYCURSOR;",
          "933:  ++YYCURSOR;",
          "935:  {",
          "943:   return 0;",
          "944:  }",
          "950:  }",
          "956:  }",
          "958:  return 1;",
          "959: }",
          "962:  yych = *++YYCURSOR;",
          "964:  goto yy18;",
          "966:  yych = *++YYCURSOR;",
          "968:  goto yy18;",
          "970:  ++YYCURSOR;",
          "979:  ++YYCURSOR;",
          "980:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "981:  yych = *YYCURSOR;",
          "982:  if (yych <= ';') {",
          "983:   if (yych <= '/') goto yy18;",
          "985:   if (yych <= ':') goto yy18;",
          "986:  } else {",
          "987:   if (yych <= 'E') {",
          "988:    if (yych <= 'D') goto yy18;",
          "990:   } else {",
          "992:    goto yy18;",
          "993:   }",
          "994:  }",
          "996:  ++YYCURSOR;",
          "998:  {",
          "999: #if SIZEOF_ZEND_LONG == 4",
          "1000: use_double:",
          "",
          "[Removed Lines]",
          "594:  case 'O': goto yy4;",
          "596:  case 'R': goto yy6;",
          "597:  case 'S': goto yy7;",
          "598:  case 'a': goto yy8;",
          "599:  case 'b': goto yy9;",
          "600:  case 'd': goto yy10;",
          "601:  case 'i': goto yy11;",
          "603:  case 'r': goto yy13;",
          "604:  case 's': goto yy14;",
          "605:  case '}': goto yy15;",
          "606:  default: goto yy2;",
          "609:  ++YYCURSOR;",
          "611: #line 922 \"ext/standard/var_unserializer.re\"",
          "613: #line 614 \"ext/standard/var_unserializer.c\"",
          "616:  if (yych == ':') goto yy17;",
          "620:  if (yych == ';') goto yy19;",
          "624:  if (yych == ':') goto yy21;",
          "628:  if (yych == ':') goto yy22;",
          "632:  if (yych == ':') goto yy23;",
          "636:  if (yych == ':') goto yy24;",
          "640:  if (yych == ':') goto yy25;",
          "644:  if (yych == ':') goto yy26;",
          "648:  if (yych == ':') goto yy27;",
          "652:  if (yych == ':') goto yy28;",
          "655:  yych = *(YYMARKER = ++YYCURSOR);",
          "656:  if (yych == ':') goto yy29;",
          "657:  goto yy3;",
          "658: yy15:",
          "660: #line 916 \"ext/standard/var_unserializer.re\"",
          "666: #line 667 \"ext/standard/var_unserializer.c\"",
          "670:   goto yy31;",
          "672:  if (yych == '+') goto yy30;",
          "677:  ++YYCURSOR;",
          "678: #line 609 \"ext/standard/var_unserializer.re\"",
          "679:  {",
          "681:  ZVAL_NULL(rval);",
          "682:  return 1;",
          "683: }",
          "684: #line 685 \"ext/standard/var_unserializer.c\"",
          "685: yy21:",
          "687:  if (yych <= ',') {",
          "688:   if (yych == '+') goto yy33;",
          "689:   goto yy18;",
          "690:  } else {",
          "691:   if (yych <= '-') goto yy33;",
          "692:   if (yych <= '/') goto yy18;",
          "693:   if (yych <= '9') goto yy34;",
          "694:   goto yy18;",
          "696: yy22:",
          "697:  yych = *++YYCURSOR;",
          "698:  if (yych == '+') goto yy36;",
          "699:  if (yych <= '/') goto yy18;",
          "700:  if (yych <= '9') goto yy37;",
          "702: yy23:",
          "703:  yych = *++YYCURSOR;",
          "704:  if (yych == '+') goto yy39;",
          "705:  if (yych <= '/') goto yy18;",
          "706:  if (yych <= '9') goto yy40;",
          "707:  goto yy18;",
          "708: yy24:",
          "709:  yych = *++YYCURSOR;",
          "711:  if (yych <= '1') goto yy42;",
          "712:  goto yy18;",
          "713: yy25:",
          "715:  if (yych <= '/') {",
          "716:   if (yych <= ',') {",
          "717:    if (yych == '+') goto yy43;",
          "718:    goto yy18;",
          "719:   } else {",
          "720:    if (yych <= '-') goto yy44;",
          "721:    if (yych <= '.') goto yy45;",
          "722:    goto yy18;",
          "724:  } else {",
          "725:   if (yych <= 'I') {",
          "726:    if (yych <= '9') goto yy46;",
          "727:    if (yych <= 'H') goto yy18;",
          "728:    goto yy48;",
          "729:   } else {",
          "730:    if (yych == 'N') goto yy49;",
          "731:    goto yy18;",
          "734: yy26:",
          "735:  yych = *++YYCURSOR;",
          "736:  if (yych <= ',') {",
          "737:   if (yych == '+') goto yy50;",
          "738:   goto yy18;",
          "739:  } else {",
          "740:   if (yych <= '-') goto yy50;",
          "741:   if (yych <= '/') goto yy18;",
          "742:   if (yych <= '9') goto yy51;",
          "743:   goto yy18;",
          "745: yy27:",
          "746:  yych = *++YYCURSOR;",
          "747:  if (yych <= ',') {",
          "748:   if (yych == '+') goto yy53;",
          "749:   goto yy18;",
          "750:  } else {",
          "751:   if (yych <= '-') goto yy53;",
          "752:   if (yych <= '/') goto yy18;",
          "753:   if (yych <= '9') goto yy54;",
          "754:   goto yy18;",
          "756: yy28:",
          "759:   if (yych == '+') goto yy56;",
          "760:   goto yy18;",
          "762:   if (yych <= '-') goto yy56;",
          "764:   if (yych <= '9') goto yy57;",
          "767: yy29:",
          "769:  if (yych == '+') goto yy59;",
          "771:  if (yych <= '9') goto yy60;",
          "772:  goto yy18;",
          "773: yy30:",
          "774:  yych = *++YYCURSOR;",
          "775:  if (yybm[0+yych] & 128) {",
          "776:   goto yy31;",
          "777:  }",
          "778:  goto yy18;",
          "779: yy31:",
          "783:  if (yybm[0+yych] & 128) {",
          "784:   goto yy31;",
          "785:  }",
          "787:  if (yych <= ':') goto yy62;",
          "788:  goto yy18;",
          "789: yy33:",
          "791:  if (yych <= '/') goto yy18;",
          "792:  if (yych >= ':') goto yy18;",
          "793: yy34:",
          "795:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "796:  yych = *YYCURSOR;",
          "799:  if (yych == ';') goto yy63;",
          "801: yy36:",
          "805: yy37:",
          "810:  if (yych <= '9') goto yy37;",
          "811:  if (yych <= ':') goto yy65;",
          "812:  goto yy18;",
          "813: yy39:",
          "815:  if (yych <= '/') goto yy18;",
          "816:  if (yych >= ':') goto yy18;",
          "817: yy40:",
          "819:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "820:  yych = *YYCURSOR;",
          "821:  if (yych <= '/') goto yy18;",
          "822:  if (yych <= '9') goto yy40;",
          "823:  if (yych <= ':') goto yy66;",
          "824:  goto yy18;",
          "825: yy42:",
          "826:  yych = *++YYCURSOR;",
          "827:  if (yych == ';') goto yy67;",
          "828:  goto yy18;",
          "829: yy43:",
          "830:  yych = *++YYCURSOR;",
          "831:  if (yych == '.') goto yy45;",
          "832:  if (yych <= '/') goto yy18;",
          "833:  if (yych <= '9') goto yy46;",
          "834:  goto yy18;",
          "835: yy44:",
          "836:  yych = *++YYCURSOR;",
          "837:  if (yych <= '/') {",
          "838:   if (yych != '.') goto yy18;",
          "839:  } else {",
          "840:   if (yych <= '9') goto yy46;",
          "841:   if (yych == 'I') goto yy48;",
          "842:   goto yy18;",
          "844: yy45:",
          "845:  yych = *++YYCURSOR;",
          "846:  if (yych <= '/') goto yy18;",
          "847:  if (yych <= '9') goto yy69;",
          "848:  goto yy18;",
          "849: yy46:",
          "850:  ++YYCURSOR;",
          "851:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "852:  yych = *YYCURSOR;",
          "853:  if (yych <= ':') {",
          "854:   if (yych <= '.') {",
          "855:    if (yych <= '-') goto yy18;",
          "856:    goto yy69;",
          "857:   } else {",
          "858:    if (yych <= '/') goto yy18;",
          "859:    if (yych <= '9') goto yy46;",
          "860:    goto yy18;",
          "861:   }",
          "862:  } else {",
          "863:   if (yych <= 'E') {",
          "864:    if (yych <= ';') goto yy71;",
          "865:    if (yych <= 'D') goto yy18;",
          "866:    goto yy73;",
          "867:   } else {",
          "868:    if (yych == 'e') goto yy73;",
          "869:    goto yy18;",
          "870:   }",
          "872: yy48:",
          "873:  yych = *++YYCURSOR;",
          "874:  if (yych == 'N') goto yy74;",
          "875:  goto yy18;",
          "876: yy49:",
          "877:  yych = *++YYCURSOR;",
          "878:  if (yych == 'A') goto yy75;",
          "879:  goto yy18;",
          "880: yy50:",
          "883:  if (yych >= ':') goto yy18;",
          "884: yy51:",
          "885:  ++YYCURSOR;",
          "886:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "887:  yych = *YYCURSOR;",
          "888:  if (yych <= '/') goto yy18;",
          "889:  if (yych <= '9') goto yy51;",
          "890:  if (yych == ';') goto yy76;",
          "892: yy53:",
          "896: yy54:",
          "901:  if (yych <= '9') goto yy54;",
          "902:  if (yych <= ':') goto yy78;",
          "903:  goto yy18;",
          "904: yy56:",
          "906:  if (yych <= '/') goto yy18;",
          "907:  if (yych >= ':') goto yy18;",
          "908: yy57:",
          "910:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "911:  yych = *YYCURSOR;",
          "913:  if (yych <= '9') goto yy57;",
          "914:  if (yych == ';') goto yy79;",
          "916: yy59:",
          "920: yy60:",
          "925:  if (yych <= '9') goto yy60;",
          "926:  if (yych <= ':') goto yy81;",
          "927:  goto yy18;",
          "928: yy62:",
          "930:  if (yych == '\"') goto yy82;",
          "931:  goto yy18;",
          "932: yy63:",
          "934: #line 558 \"ext/standard/var_unserializer.re\"",
          "936:  zend_long id;",
          "939:  if (!var_hash) return 0;",
          "941:  id = parse_iv(start + 2) - 1;",
          "942:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "946:  zval_ptr_dtor(rval);",
          "947:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "948:   ZVAL_UNDEF(rval);",
          "949:   return 1;",
          "951:  if (Z_ISREF_P(rval_ref)) {",
          "952:   ZVAL_COPY(rval, rval_ref);",
          "953:  } else {",
          "954:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "955:   ZVAL_COPY(rval, rval_ref);",
          "960: #line 961 \"ext/standard/var_unserializer.c\"",
          "961: yy65:",
          "963:  if (yych == '\"') goto yy84;",
          "965: yy66:",
          "967:  if (yych == '{') goto yy86;",
          "969: yy67:",
          "971: #line 615 \"ext/standard/var_unserializer.re\"",
          "972:  {",
          "974:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "975:  return 1;",
          "976: }",
          "977: #line 978 \"ext/standard/var_unserializer.c\"",
          "978: yy69:",
          "984:   if (yych <= '9') goto yy69;",
          "989:    goto yy73;",
          "991:    if (yych == 'e') goto yy73;",
          "995: yy71:",
          "997: #line 663 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "600:  case 'O': goto yy13;",
          "602:  case 'R': goto yy2;",
          "603:  case 'S': goto yy10;",
          "604:  case 'a': goto yy11;",
          "605:  case 'b': goto yy6;",
          "606:  case 'd': goto yy8;",
          "607:  case 'i': goto yy7;",
          "609:  case 'r': goto yy4;",
          "610:  case 's': goto yy9;",
          "611:  case '}': goto yy14;",
          "612:  default: goto yy16;",
          "615:  yych = *(YYMARKER = ++YYCURSOR);",
          "616:  if (yych == ':') goto yy95;",
          "618: #line 936 \"ext/standard/var_unserializer.re\"",
          "620: #line 621 \"ext/standard/var_unserializer.c\"",
          "623:  if (yych == ':') goto yy89;",
          "627:  if (yych == ';') goto yy87;",
          "631:  if (yych == ':') goto yy83;",
          "635:  if (yych == ':') goto yy77;",
          "639:  if (yych == ':') goto yy53;",
          "643:  if (yych == ':') goto yy46;",
          "647:  if (yych == ':') goto yy39;",
          "651:  if (yych == ':') goto yy32;",
          "655:  if (yych == ':') goto yy25;",
          "659:  if (yych == ':') goto yy17;",
          "663: #line 930 \"ext/standard/var_unserializer.re\"",
          "669: #line 670 \"ext/standard/var_unserializer.c\"",
          "670: yy16:",
          "671:  yych = *++YYCURSOR;",
          "672:  goto yy3;",
          "676:   goto yy20;",
          "678:  if (yych == '+') goto yy19;",
          "684:  if (yybm[0+yych] & 128) {",
          "685:   goto yy20;",
          "688: yy20:",
          "689:  ++YYCURSOR;",
          "690:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "691:  yych = *YYCURSOR;",
          "692:  if (yybm[0+yych] & 128) {",
          "693:   goto yy20;",
          "694:  }",
          "696:  if (yych >= ';') goto yy18;",
          "698:  if (yych != '\"') goto yy18;",
          "699:  ++YYCURSOR;",
          "700: #line 778 \"ext/standard/var_unserializer.re\"",
          "701:  {",
          "702:  size_t len, len2, len3, maxlen;",
          "703:  zend_long elements;",
          "704:  char *str;",
          "705:  zend_string *class_name;",
          "706:  zend_class_entry *ce;",
          "707:  int incomplete_class = 0;",
          "709:  int custom_object = 0;",
          "711:  zval user_func;",
          "712:  zval retval;",
          "713:  zval args[1];",
          "715:     if (!var_hash) return 0;",
          "716:  if (*start == 'C') {",
          "717:   custom_object = 1;",
          "718:  }",
          "720:  len2 = len = parse_uiv(start + 2);",
          "721:  maxlen = max - YYCURSOR;",
          "722:  if (maxlen < len || len == 0) {",
          "724:   return 0;",
          "725:  }",
          "727:  str = (char*)YYCURSOR;",
          "729:  YYCURSOR += len;",
          "731:  if (*(YYCURSOR) != '\"') {",
          "733:   return 0;",
          "734:  }",
          "735:  if (*(YYCURSOR+1) != ':') {",
          "737:   return 0;",
          "738:  }",
          "740:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "741:  if (len3 != len)",
          "742:  {",
          "744:   return 0;",
          "745:  }",
          "747:  class_name = zend_string_init(str, len, 0);",
          "749:  do {",
          "750:   if(!unserialize_allowed_class(class_name, classes)) {",
          "751:    incomplete_class = 1;",
          "752:    ce = PHP_IC_ENTRY;",
          "753:    break;",
          "757:   BG(serialize_lock)++;",
          "758:   ce = zend_lookup_class(class_name);",
          "759:   if (ce) {",
          "760:    BG(serialize_lock)--;",
          "761:    if (EG(exception)) {",
          "762:     zend_string_release(class_name);",
          "763:     return 0;",
          "764:    }",
          "765:    break;",
          "766:   }",
          "767:   BG(serialize_lock)--;",
          "769:   if (EG(exception)) {",
          "770:    zend_string_release(class_name);",
          "771:    return 0;",
          "772:   }",
          "775:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "776:    incomplete_class = 1;",
          "777:    ce = PHP_IC_ENTRY;",
          "778:    break;",
          "779:   }",
          "782:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
          "784:   ZVAL_STR_COPY(&args[0], class_name);",
          "785:   BG(serialize_lock)++;",
          "786:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
          "787:    BG(serialize_lock)--;",
          "788:    if (EG(exception)) {",
          "789:     zend_string_release(class_name);",
          "790:     zval_ptr_dtor(&user_func);",
          "791:     zval_ptr_dtor(&args[0]);",
          "792:     return 0;",
          "793:    }",
          "794:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
          "795:    incomplete_class = 1;",
          "796:    ce = PHP_IC_ENTRY;",
          "797:    zval_ptr_dtor(&user_func);",
          "798:    zval_ptr_dtor(&args[0]);",
          "799:    break;",
          "800:   }",
          "801:   BG(serialize_lock)--;",
          "802:   zval_ptr_dtor(&retval);",
          "803:   if (EG(exception)) {",
          "804:    zend_string_release(class_name);",
          "805:    zval_ptr_dtor(&user_func);",
          "806:    zval_ptr_dtor(&args[0]);",
          "807:    return 0;",
          "808:   }",
          "811:   BG(serialize_lock)++;",
          "812:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "813:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "814:    incomplete_class = 1;",
          "815:    ce = PHP_IC_ENTRY;",
          "816:   }",
          "817:   BG(serialize_lock)--;",
          "819:   zval_ptr_dtor(&user_func);",
          "820:   zval_ptr_dtor(&args[0]);",
          "821:   break;",
          "822:  } while (1);",
          "826:  if (custom_object) {",
          "827:   int ret;",
          "829:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "831:   if (ret && incomplete_class) {",
          "832:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "834:   zend_string_release(class_name);",
          "835:   return ret;",
          "838:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "840:  if (elements < 0) {",
          "841:     efree(class_name);",
          "842:     return 0;",
          "845:  if (incomplete_class) {",
          "846:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "848:  zend_string_release(class_name);",
          "850:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "851: }",
          "852: #line 853 \"ext/standard/var_unserializer.c\"",
          "853: yy25:",
          "856:   if (yych != '+') goto yy18;",
          "858:   if (yych <= '-') goto yy26;",
          "860:   if (yych <= '9') goto yy27;",
          "863: yy26:",
          "866:  if (yych >= ':') goto yy18;",
          "867: yy27:",
          "872:  if (yych <= '9') goto yy27;",
          "873:  if (yych >= ';') goto yy18;",
          "875:  if (yych != '\"') goto yy18;",
          "877: #line 767 \"ext/standard/var_unserializer.re\"",
          "878:  {",
          "879:  long elements;",
          "880:     if (!var_hash) return 0;",
          "882:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "883:  if (elements < 0) {",
          "884:   return 0;",
          "885:  }",
          "886:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "887: }",
          "888: #line 889 \"ext/standard/var_unserializer.c\"",
          "889: yy32:",
          "890:  yych = *++YYCURSOR;",
          "891:  if (yych == '+') goto yy33;",
          "895: yy33:",
          "899: yy34:",
          "904:  if (yych <= '9') goto yy34;",
          "905:  if (yych >= ';') goto yy18;",
          "907:  if (yych != '{') goto yy18;",
          "909: #line 743 \"ext/standard/var_unserializer.re\"",
          "910:  {",
          "911:  zend_long elements = parse_iv(start + 2);",
          "914:     if (!var_hash) return 0;",
          "916:  if (elements < 0) {",
          "917:   return 0;",
          "920:  array_init_size(rval, elements);",
          "921:  if (elements) {",
          "924:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "927:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "928:   return 0;",
          "929:  }",
          "931:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "932: }",
          "933: #line 934 \"ext/standard/var_unserializer.c\"",
          "934: yy39:",
          "936:  if (yych == '+') goto yy40;",
          "938:  if (yych <= '9') goto yy41;",
          "940: yy40:",
          "944: yy41:",
          "949:  if (yych <= '9') goto yy41;",
          "950:  if (yych >= ';') goto yy18;",
          "952:  if (yych != '\"') goto yy18;",
          "954: #line 709 \"ext/standard/var_unserializer.re\"",
          "955:  {",
          "956:  size_t len, maxlen;",
          "957:  zend_string *str;",
          "959:  len = parse_uiv(start + 2);",
          "960:  maxlen = max - YYCURSOR;",
          "961:  if (maxlen < len) {",
          "963:   return 0;",
          "964:  }",
          "966:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "967:   return 0;",
          "968:  }",
          "970:  if (*(YYCURSOR) != '\"') {",
          "971:   zend_string_free(str);",
          "973:   return 0;",
          "974:  }",
          "976:  if (*(YYCURSOR + 1) != ';') {",
          "977:   efree(str);",
          "979:   return 0;",
          "980:  }",
          "982:  YYCURSOR += 2;",
          "985:  ZVAL_STR(rval, str);",
          "986:  return 1;",
          "987: }",
          "988: #line 989 \"ext/standard/var_unserializer.c\"",
          "989: yy46:",
          "990:  yych = *++YYCURSOR;",
          "991:  if (yych == '+') goto yy47;",
          "993:  if (yych <= '9') goto yy48;",
          "995: yy47:",
          "999: yy48:",
          "1004:  if (yych <= '9') goto yy48;",
          "1005:  if (yych >= ';') goto yy18;",
          "1007:  if (yych != '\"') goto yy18;",
          "1009: #line 677 \"ext/standard/var_unserializer.re\"",
          "1011:  size_t len, maxlen;",
          "1012:  char *str;",
          "1014:  len = parse_uiv(start + 2);",
          "1015:  maxlen = max - YYCURSOR;",
          "1016:  if (maxlen < len) {",
          "1021:  str = (char*)YYCURSOR;",
          "1023:  YYCURSOR += len;",
          "1025:  if (*(YYCURSOR) != '\"') {",
          "1027:   return 0;",
          "1030:  if (*(YYCURSOR + 1) != ';') {",
          "1032:   return 0;",
          "1035:  YYCURSOR += 2;",
          "1038:  ZVAL_STRINGL(rval, str, len);",
          "1041: #line 1042 \"ext/standard/var_unserializer.c\"",
          "1042: yy53:",
          "1043:  yych = *++YYCURSOR;",
          "1044:  if (yych <= '/') {",
          "1045:   if (yych <= ',') {",
          "1046:    if (yych == '+') goto yy57;",
          "1047:    goto yy18;",
          "1048:   } else {",
          "1049:    if (yych <= '-') goto yy55;",
          "1050:    if (yych <= '.') goto yy60;",
          "1051:    goto yy18;",
          "1052:   }",
          "1053:  } else {",
          "1054:   if (yych <= 'I') {",
          "1055:    if (yych <= '9') goto yy58;",
          "1056:    if (yych <= 'H') goto yy18;",
          "1057:    goto yy56;",
          "1058:   } else {",
          "1059:    if (yych != 'N') goto yy18;",
          "1060:   }",
          "1061:  }",
          "1063:  if (yych == 'A') goto yy76;",
          "1065: yy55:",
          "1066:  yych = *++YYCURSOR;",
          "1067:  if (yych <= '/') {",
          "1068:   if (yych == '.') goto yy60;",
          "1069:   goto yy18;",
          "1070:  } else {",
          "1071:   if (yych <= '9') goto yy58;",
          "1072:   if (yych != 'I') goto yy18;",
          "1073:  }",
          "1074: yy56:",
          "1076:  if (yych == 'N') goto yy72;",
          "1078: yy57:",
          "1079:  yych = *++YYCURSOR;",
          "1080:  if (yych == '.') goto yy60;",
          "1081:  if (yych <= '/') goto yy18;",
          "1082:  if (yych >= ':') goto yy18;",
          "1083: yy58:",
          "1085:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1086:  yych = *YYCURSOR;",
          "1087:  if (yych <= ':') {",
          "1088:   if (yych <= '.') {",
          "1089:    if (yych <= '-') goto yy18;",
          "1090:    goto yy70;",
          "1091:   } else {",
          "1092:    if (yych <= '/') goto yy18;",
          "1093:    if (yych <= '9') goto yy58;",
          "1094:    goto yy18;",
          "1095:   }",
          "1096:  } else {",
          "1097:   if (yych <= 'E') {",
          "1098:    if (yych <= ';') goto yy63;",
          "1099:    if (yych <= 'D') goto yy18;",
          "1100:    goto yy65;",
          "1101:   } else {",
          "1102:    if (yych == 'e') goto yy65;",
          "1103:    goto yy18;",
          "1104:   }",
          "1105:  }",
          "1106: yy60:",
          "1107:  yych = *++YYCURSOR;",
          "1108:  if (yych <= '/') goto yy18;",
          "1109:  if (yych >= ':') goto yy18;",
          "1110: yy61:",
          "1116:   if (yych <= '9') goto yy61;",
          "1121:    goto yy65;",
          "1123:    if (yych == 'e') goto yy65;",
          "1127: yy63:",
          "1129: #line 668 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1003:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1004:  return 1;",
          "1005: }",
          "1008:  yych = *++YYCURSOR;",
          "1009:  if (yych <= ',') {",
          "1012:  } else {",
          "1014:   if (yych <= '/') goto yy18;",
          "1016:   goto yy18;",
          "1017:  }",
          "1019:  yych = *++YYCURSOR;",
          "1021:  goto yy18;",
          "1023:  yych = *++YYCURSOR;",
          "1025:  goto yy18;",
          "1027:  ++YYCURSOR;",
          "1045:   } else {",
          "1047:   }",
          "1048:  }",
          "1056:  yych = *++YYCURSOR;",
          "1060:  ++YYCURSOR;",
          "1062:  {",
          "1080:  }",
          "1084:  return 1;",
          "1085: }",
          "1088:  yych = *++YYCURSOR;",
          "1090:  goto yy18;",
          "1092:  ++YYCURSOR;",
          "1094:  {",
          "1138:  }",
          "1186:    }",
          "1226:   }",
          "1229:  }",
          "1239: }",
          "1242:  ++YYCURSOR;",
          "1244:  {",
          "1275:  return 1;",
          "1276: }",
          "1279:  ++YYCURSOR;",
          "1281:  {",
          "1303: }",
          "1306:  yych = *++YYCURSOR;",
          "1307:  if (yych <= ',') {",
          "1310:  } else {",
          "1312:   if (yych <= '/') goto yy18;",
          "1314:  }",
          "1316:  ++YYCURSOR;",
          "1317:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1318:  yych = *YYCURSOR;",
          "1319:  if (yych <= '/') goto yy18;",
          "1328:  ++YYCURSOR;",
          "1330:  {",
          "1348:   return 0;",
          "1349:  }",
          "1357:   return 0;",
          "1358:  }",
          "1363:  }",
          "1369:  return 1;",
          "1370: }",
          "1372: yy96:",
          "1373:  yych = *++YYCURSOR;",
          "1374:  if (yych <= '/') goto yy18;",
          "1377: yy97:",
          "1378:  ++YYCURSOR;",
          "1380:  {",
          "1389:  } else {",
          "1391:  }",
          "1393:  return 1;",
          "1394: }",
          "1396: }",
          "1400:  return 0;",
          "",
          "[Removed Lines]",
          "1006: #line 1007 \"ext/standard/var_unserializer.c\"",
          "1007: yy73:",
          "1010:   if (yych == '+') goto yy88;",
          "1011:   goto yy18;",
          "1013:   if (yych <= '-') goto yy88;",
          "1015:   if (yych <= '9') goto yy89;",
          "1018: yy74:",
          "1020:  if (yych == 'F') goto yy91;",
          "1022: yy75:",
          "1024:  if (yych == 'N') goto yy91;",
          "1026: yy76:",
          "1028: #line 621 \"ext/standard/var_unserializer.re\"",
          "1029:  {",
          "1030: #if SIZEOF_ZEND_LONG == 4",
          "1031:  int digits = YYCURSOR - start - 3;",
          "1033:  if (start[2] == '-' || start[2] == '+') {",
          "1034:   digits--;",
          "1035:  }",
          "1038:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1039:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1040:    int cmp = strncmp((char*)YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1042:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1043:     goto use_double;",
          "1044:    }",
          "1046:    goto use_double;",
          "1049: #endif",
          "1051:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1052:  return 1;",
          "1053: }",
          "1054: #line 1055 \"ext/standard/var_unserializer.c\"",
          "1055: yy78:",
          "1057:  if (yych == '\"') goto yy92;",
          "1058:  goto yy18;",
          "1059: yy79:",
          "1061: #line 584 \"ext/standard/var_unserializer.re\"",
          "1063:  zend_long id;",
          "1066:  if (!var_hash) return 0;",
          "1068:  id = parse_iv(start + 2) - 1;",
          "1069:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1070:   return 0;",
          "1071:  }",
          "1073:  if (rval_ref == rval) {",
          "1074:   return 0;",
          "1075:  }",
          "1077:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1078:   ZVAL_UNDEF(rval);",
          "1079:   return 1;",
          "1082:  ZVAL_COPY(rval, rval_ref);",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "1087: yy81:",
          "1089:  if (yych == '\"') goto yy94;",
          "1091: yy82:",
          "1093: #line 769 \"ext/standard/var_unserializer.re\"",
          "1095:  size_t len, len2, len3, maxlen;",
          "1096:  zend_long elements;",
          "1097:  char *str;",
          "1098:  zend_string *class_name;",
          "1099:  zend_class_entry *ce;",
          "1100:  int incomplete_class = 0;",
          "1102:  int custom_object = 0;",
          "1104:  zval user_func;",
          "1105:  zval retval;",
          "1106:  zval args[1];",
          "1108:     if (!var_hash) return 0;",
          "1109:  if (*start == 'C') {",
          "1110:   custom_object = 1;",
          "1111:  }",
          "1113:  len2 = len = parse_uiv(start + 2);",
          "1114:  maxlen = max - YYCURSOR;",
          "1115:  if (maxlen < len || len == 0) {",
          "1117:   return 0;",
          "1118:  }",
          "1120:  str = (char*)YYCURSOR;",
          "1122:  YYCURSOR += len;",
          "1124:  if (*(YYCURSOR) != '\"') {",
          "1126:   return 0;",
          "1127:  }",
          "1128:  if (*(YYCURSOR+1) != ':') {",
          "1130:   return 0;",
          "1131:  }",
          "1133:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "1134:  if (len3 != len)",
          "1135:  {",
          "1137:   return 0;",
          "1140:  class_name = zend_string_init(str, len, 0);",
          "1142:  do {",
          "1143:   if(!unserialize_allowed_class(class_name, classes)) {",
          "1144:    incomplete_class = 1;",
          "1145:    ce = PHP_IC_ENTRY;",
          "1146:    break;",
          "1147:   }",
          "1150:   BG(serialize_lock)++;",
          "1151:   ce = zend_lookup_class(class_name);",
          "1152:   if (ce) {",
          "1153:    BG(serialize_lock)--;",
          "1154:    if (EG(exception)) {",
          "1155:     zend_string_release(class_name);",
          "1156:     return 0;",
          "1157:    }",
          "1158:    break;",
          "1159:   }",
          "1160:   BG(serialize_lock)--;",
          "1162:   if (EG(exception)) {",
          "1163:    zend_string_release(class_name);",
          "1164:    return 0;",
          "1165:   }",
          "1168:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "1169:    incomplete_class = 1;",
          "1170:    ce = PHP_IC_ENTRY;",
          "1171:    break;",
          "1172:   }",
          "1175:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
          "1177:   ZVAL_STR_COPY(&args[0], class_name);",
          "1178:   BG(serialize_lock)++;",
          "1179:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
          "1180:    BG(serialize_lock)--;",
          "1181:    if (EG(exception)) {",
          "1182:     zend_string_release(class_name);",
          "1183:     zval_ptr_dtor(&user_func);",
          "1184:     zval_ptr_dtor(&args[0]);",
          "1185:     return 0;",
          "1187:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
          "1188:    incomplete_class = 1;",
          "1189:    ce = PHP_IC_ENTRY;",
          "1190:    zval_ptr_dtor(&user_func);",
          "1191:    zval_ptr_dtor(&args[0]);",
          "1192:    break;",
          "1193:   }",
          "1194:   BG(serialize_lock)--;",
          "1195:   zval_ptr_dtor(&retval);",
          "1196:   if (EG(exception)) {",
          "1197:    zend_string_release(class_name);",
          "1198:    zval_ptr_dtor(&user_func);",
          "1199:    zval_ptr_dtor(&args[0]);",
          "1200:    return 0;",
          "1201:   }",
          "1204:   BG(serialize_lock)++;",
          "1205:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "1206:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "1207:    incomplete_class = 1;",
          "1208:    ce = PHP_IC_ENTRY;",
          "1209:   }",
          "1210:   BG(serialize_lock)--;",
          "1212:   zval_ptr_dtor(&user_func);",
          "1213:   zval_ptr_dtor(&args[0]);",
          "1214:   break;",
          "1215:  } while (1);",
          "1219:  if (custom_object) {",
          "1220:   int ret;",
          "1222:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "1224:   if (ret && incomplete_class) {",
          "1225:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "1227:   zend_string_release(class_name);",
          "1228:   return ret;",
          "1231:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "1233:  if (incomplete_class) {",
          "1234:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "1235:  }",
          "1236:  zend_string_release(class_name);",
          "1238:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1240: #line 1241 \"ext/standard/var_unserializer.c\"",
          "1241: yy84:",
          "1243: #line 704 \"ext/standard/var_unserializer.re\"",
          "1245:  size_t len, maxlen;",
          "1246:  zend_string *str;",
          "1248:  len = parse_uiv(start + 2);",
          "1249:  maxlen = max - YYCURSOR;",
          "1250:  if (maxlen < len) {",
          "1252:   return 0;",
          "1253:  }",
          "1255:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "1256:   return 0;",
          "1257:  }",
          "1259:  if (*(YYCURSOR) != '\"') {",
          "1260:   zend_string_free(str);",
          "1262:   return 0;",
          "1263:  }",
          "1265:  if (*(YYCURSOR + 1) != ';') {",
          "1266:   efree(str);",
          "1268:   return 0;",
          "1269:  }",
          "1271:  YYCURSOR += 2;",
          "1274:  ZVAL_STR(rval, str);",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "1278: yy86:",
          "1280: #line 738 \"ext/standard/var_unserializer.re\"",
          "1282:  zend_long elements = parse_iv(start + 2);",
          "1285:     if (!var_hash) return 0;",
          "1287:  if (elements < 0) {",
          "1288:   return 0;",
          "1289:  }",
          "1291:  array_init_size(rval, elements);",
          "1292:  if (elements) {",
          "1295:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "1296:  }",
          "1298:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "1299:   return 0;",
          "1300:  }",
          "1302:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1304: #line 1305 \"ext/standard/var_unserializer.c\"",
          "1305: yy88:",
          "1308:   if (yych == '+') goto yy96;",
          "1309:   goto yy18;",
          "1311:   if (yych <= '-') goto yy96;",
          "1313:   if (yych >= ':') goto yy18;",
          "1315: yy89:",
          "1320:  if (yych <= '9') goto yy89;",
          "1321:  if (yych == ';') goto yy71;",
          "1322:  goto yy18;",
          "1323: yy91:",
          "1324:  yych = *++YYCURSOR;",
          "1325:  if (yych == ';') goto yy97;",
          "1326:  goto yy18;",
          "1327: yy92:",
          "1329: #line 762 \"ext/standard/var_unserializer.re\"",
          "1331:     if (!var_hash) return 0;",
          "1333:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "1334:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "1335: }",
          "1336: #line 1337 \"ext/standard/var_unserializer.c\"",
          "1337: yy94:",
          "1338:  ++YYCURSOR;",
          "1339: #line 672 \"ext/standard/var_unserializer.re\"",
          "1340:  {",
          "1341:  size_t len, maxlen;",
          "1342:  char *str;",
          "1344:  len = parse_uiv(start + 2);",
          "1345:  maxlen = max - YYCURSOR;",
          "1346:  if (maxlen < len) {",
          "1351:  str = (char*)YYCURSOR;",
          "1353:  YYCURSOR += len;",
          "1355:  if (*(YYCURSOR) != '\"') {",
          "1360:  if (*(YYCURSOR + 1) != ';') {",
          "1362:   return 0;",
          "1365:  YYCURSOR += 2;",
          "1368:  ZVAL_STRINGL(rval, str, len);",
          "1371: #line 1372 \"ext/standard/var_unserializer.c\"",
          "1375:  if (yych <= '9') goto yy89;",
          "1376:  goto yy18;",
          "1379: #line 647 \"ext/standard/var_unserializer.re\"",
          "1383:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
          "1384:   ZVAL_DOUBLE(rval, php_get_nan());",
          "1385:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
          "1386:   ZVAL_DOUBLE(rval, php_get_inf());",
          "1387:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
          "1388:   ZVAL_DOUBLE(rval, -php_get_inf());",
          "1390:   ZVAL_NULL(rval);",
          "1395: #line 1396 \"ext/standard/var_unserializer.c\"",
          "1397: #line 924 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1138: #line 1139 \"ext/standard/var_unserializer.c\"",
          "1139: yy65:",
          "1142:   if (yych != '+') goto yy18;",
          "1144:   if (yych <= '-') goto yy66;",
          "1146:   if (yych <= '9') goto yy67;",
          "1149: yy66:",
          "1151:  if (yych <= ',') {",
          "1152:   if (yych == '+') goto yy69;",
          "1153:   goto yy18;",
          "1154:  } else {",
          "1155:   if (yych <= '-') goto yy69;",
          "1156:   if (yych <= '/') goto yy18;",
          "1157:   if (yych >= ':') goto yy18;",
          "1158:  }",
          "1159: yy67:",
          "1160:  ++YYCURSOR;",
          "1161:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1162:  yych = *YYCURSOR;",
          "1163:  if (yych <= '/') goto yy18;",
          "1164:  if (yych <= '9') goto yy67;",
          "1165:  if (yych == ';') goto yy63;",
          "1167: yy69:",
          "1169:  if (yych <= '/') goto yy18;",
          "1170:  if (yych <= '9') goto yy67;",
          "1172: yy70:",
          "1174:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1175:  yych = *YYCURSOR;",
          "1176:  if (yych <= ';') {",
          "1177:   if (yych <= '/') goto yy18;",
          "1178:   if (yych <= '9') goto yy70;",
          "1179:   if (yych <= ':') goto yy18;",
          "1180:   goto yy63;",
          "1181:  } else {",
          "1182:   if (yych <= 'E') {",
          "1183:    if (yych <= 'D') goto yy18;",
          "1184:    goto yy65;",
          "1186:    if (yych == 'e') goto yy65;",
          "1187:    goto yy18;",
          "1190: yy72:",
          "1192:  if (yych != 'F') goto yy18;",
          "1193: yy73:",
          "1194:  yych = *++YYCURSOR;",
          "1195:  if (yych != ';') goto yy18;",
          "1197: #line 652 \"ext/standard/var_unserializer.re\"",
          "1201:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
          "1202:   ZVAL_DOUBLE(rval, php_get_nan());",
          "1203:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
          "1204:   ZVAL_DOUBLE(rval, php_get_inf());",
          "1205:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
          "1206:   ZVAL_DOUBLE(rval, -php_get_inf());",
          "1207:  } else {",
          "1208:   ZVAL_NULL(rval);",
          "1213: #line 1214 \"ext/standard/var_unserializer.c\"",
          "1214: yy76:",
          "1216:  if (yych == 'N') goto yy73;",
          "1218: yy77:",
          "1219:  yych = *++YYCURSOR;",
          "1220:  if (yych <= ',') {",
          "1221:   if (yych != '+') goto yy18;",
          "1222:  } else {",
          "1223:   if (yych <= '-') goto yy78;",
          "1224:   if (yych <= '/') goto yy18;",
          "1225:   if (yych <= '9') goto yy79;",
          "1226:   goto yy18;",
          "1227:  }",
          "1228: yy78:",
          "1229:  yych = *++YYCURSOR;",
          "1230:  if (yych <= '/') goto yy18;",
          "1231:  if (yych >= ':') goto yy18;",
          "1232: yy79:",
          "1234:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1235:  yych = *YYCURSOR;",
          "1236:  if (yych <= '/') goto yy18;",
          "1237:  if (yych <= '9') goto yy79;",
          "1238:  if (yych != ';') goto yy18;",
          "1239:  ++YYCURSOR;",
          "1240: #line 626 \"ext/standard/var_unserializer.re\"",
          "1242: #if SIZEOF_ZEND_LONG == 4",
          "1243:  int digits = YYCURSOR - start - 3;",
          "1245:  if (start[2] == '-' || start[2] == '+') {",
          "1246:   digits--;",
          "1250:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1251:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1252:    int cmp = strncmp((char*)YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1254:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1255:     goto use_double;",
          "1257:   } else {",
          "1258:    goto use_double;",
          "1261: #endif",
          "1263:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1264:  return 1;",
          "1266: #line 1267 \"ext/standard/var_unserializer.c\"",
          "1267: yy83:",
          "1268:  yych = *++YYCURSOR;",
          "1269:  if (yych <= '/') goto yy18;",
          "1270:  if (yych >= '2') goto yy18;",
          "1271:  yych = *++YYCURSOR;",
          "1272:  if (yych != ';') goto yy18;",
          "1274: #line 620 \"ext/standard/var_unserializer.re\"",
          "1277:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1280: #line 1281 \"ext/standard/var_unserializer.c\"",
          "1281: yy87:",
          "1283: #line 614 \"ext/standard/var_unserializer.re\"",
          "1286:  ZVAL_NULL(rval);",
          "1287:  return 1;",
          "1289: #line 1290 \"ext/standard/var_unserializer.c\"",
          "1290: yy89:",
          "1293:   if (yych != '+') goto yy18;",
          "1295:   if (yych <= '-') goto yy90;",
          "1297:   if (yych <= '9') goto yy91;",
          "1298:   goto yy18;",
          "1300: yy90:",
          "1301:  yych = *++YYCURSOR;",
          "1302:  if (yych <= '/') goto yy18;",
          "1303:  if (yych >= ':') goto yy18;",
          "1304: yy91:",
          "1309:  if (yych <= '9') goto yy91;",
          "1310:  if (yych != ';') goto yy18;",
          "1312: #line 589 \"ext/standard/var_unserializer.re\"",
          "1314:  zend_long id;",
          "1317:  if (!var_hash) return 0;",
          "1319:  id = parse_iv(start + 2) - 1;",
          "1320:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1324:  if (rval_ref == rval) {",
          "1328:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1329:   ZVAL_UNDEF(rval);",
          "1330:   return 1;",
          "1333:  ZVAL_COPY(rval, rval_ref);",
          "1337: #line 1338 \"ext/standard/var_unserializer.c\"",
          "1338: yy95:",
          "1339:  yych = *++YYCURSOR;",
          "1340:  if (yych <= ',') {",
          "1341:   if (yych != '+') goto yy18;",
          "1342:  } else {",
          "1343:   if (yych <= '-') goto yy96;",
          "1344:   if (yych <= '/') goto yy18;",
          "1345:   if (yych <= '9') goto yy97;",
          "1346:   goto yy18;",
          "1347:  }",
          "1351:  if (yych >= ':') goto yy18;",
          "1354:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1355:  yych = *YYCURSOR;",
          "1356:  if (yych <= '/') goto yy18;",
          "1357:  if (yych <= '9') goto yy97;",
          "1358:  if (yych != ';') goto yy18;",
          "1359:  ++YYCURSOR;",
          "1360: #line 563 \"ext/standard/var_unserializer.re\"",
          "1362:  zend_long id;",
          "1365:  if (!var_hash) return 0;",
          "1367:  id = parse_iv(start + 2) - 1;",
          "1368:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1369:   return 0;",
          "1370:  }",
          "1372:  zval_ptr_dtor(rval);",
          "1373:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1374:   ZVAL_UNDEF(rval);",
          "1375:   return 1;",
          "1376:  }",
          "1377:  if (Z_ISREF_P(rval_ref)) {",
          "1378:   ZVAL_COPY(rval, rval_ref);",
          "1380:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "1381:   ZVAL_COPY(rval, rval_ref);",
          "1386: #line 1387 \"ext/standard/var_unserializer.c\"",
          "1388: #line 938 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "437: {",
          "438:  zend_long elements;",
          "440:  elements = parse_iv2((*p) + 2, p);",
          "442:  (*p) += 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "440:  if( *p >= max - 2) {",
          "441:   zend_error(E_WARNING, \"Bad unserialize data\");",
          "442:   return -1;",
          "443:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "446:  } else {",
          "451:  }",
          "453:  return elements;",
          "",
          "[Removed Lines]",
          "449:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ZSTR_VAL(ce->name));",
          "450:   return 0;",
          "",
          "[Added Lines]",
          "454:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
          "455:   return -1;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "760: }",
          "762: \"o:\" iv \":\" [\"] {",
          "763:     if (!var_hash) return 0;",
          "767: }",
          "769: object \":\" uiv \":\" [\"] {",
          "",
          "[Removed Lines]",
          "765:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "766:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "",
          "[Added Lines]",
          "768:  long elements;",
          "771:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "772:  if (elements < 0) {",
          "773:   return 0;",
          "774:  }",
          "775:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "906:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "908:  if (incomplete_class) {",
          "909:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "910:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "917:  if (elements < 0) {",
          "918:     efree(class_name);",
          "919:     return 0;",
          "920:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9d7c5dbed941c4d4c18d7d5ed308a07897b7596d",
      "candidate_info": {
        "commit_hash": "9d7c5dbed941c4d4c18d7d5ed308a07897b7596d",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/9d7c5dbed941c4d4c18d7d5ed308a07897b7596d",
        "files": [
          "ext/standard/php_var.h",
          "ext/standard/tests/serialize/serialization_error_001.phpt",
          "ext/standard/tests/serialize/unserialize_classes.phpt",
          "ext/standard/var.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "secured unserialize\n\n- update for BC-compatible unserialize\n- add tests",
        "before_after_code_files": [
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/tests/serialize/serialization_error_001.phpt||ext/standard/tests/serialize/serialization_error_001.phpt",
          "ext/standard/tests/serialize/unserialize_classes.phpt||ext/standard/tests/serialize/unserialize_classes.phpt",
          "ext/standard/var.c||ext/standard/var.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "57: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "58: PHPAPI int php_var_unserialize_ref(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "59: PHPAPI int php_var_unserialize_intern(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "61: #define PHP_VAR_SERIALIZE_INIT(d) \\",
          "62: do  { \\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: PHPAPI int php_var_unserialize_ex(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes TSRMLS_DC);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/serialization_error_001.phpt||ext/standard/tests/serialize/serialization_error_001.phpt": [
          "File: ext/standard/tests/serialize/serialization_error_001.phpt -> ext/standard/tests/serialize/serialization_error_001.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: var_dump( serialize(1,2) );",
          "26: echo \"Done\";",
          "27: ?>",
          "",
          "[Removed Lines]",
          "24: var_dump( unserialize(1,2) );",
          "",
          "[Added Lines]",
          "24: var_dump( unserialize(1,2,3) );",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "31: Warning: serialize() expects exactly 1 parameter, 0 given in %s on line 16",
          "32: NULL",
          "35: bool(false)",
          "37: Warning: serialize() expects exactly 1 parameter, 2 given in %s on line 20",
          "38: NULL",
          "41: bool(false)",
          "42: Done",
          "",
          "[Removed Lines]",
          "34: Warning: unserialize() expects exactly 1 parameter, 0 given in %s on line 17",
          "40: Warning: unserialize() expects exactly 1 parameter, 2 given in %s on line 21",
          "",
          "[Added Lines]",
          "34: Warning: unserialize() expects at least 1 parameter, 0 given in %s on line 17",
          "40: Warning: unserialize() expects at most 2 parameters, 3 given in %s on line 21",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/unserialize_classes.phpt||ext/standard/tests/serialize/unserialize_classes.phpt": [
          "File: ext/standard/tests/serialize/unserialize_classes.phpt -> ext/standard/tests/serialize/unserialize_classes.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Test unserialize() with second parameter",
          "3: --FILE--",
          "4: <?php",
          "5: class foo {",
          "6:         public $x = \"bar\";",
          "7: }",
          "8: $z = array(new foo(), 2, \"3\");",
          "9: $s = serialize($z);",
          "11: var_dump(unserialize($s));",
          "12: var_dump(unserialize($s, [\"allowed_classes\" => false]));",
          "13: var_dump(unserialize($s, [\"allowed_classes\" => true]));",
          "14: var_dump(unserialize($s, [\"allowed_classes\" => [\"bar\"]]));",
          "15: var_dump(unserialize($s, [\"allowed_classes\" => [\"FOO\"]]));",
          "16: var_dump(unserialize($s, [\"allowed_classes\" => [\"bar\", \"foO\"]]));",
          "18: --EXPECTF--",
          "19: array(3) {",
          "20:   [0]=>",
          "21:   object(foo)#%d (1) {",
          "22:     [\"x\"]=>",
          "23:     string(3) \"bar\"",
          "24:   }",
          "25:   [1]=>",
          "26:   int(2)",
          "27:   [2]=>",
          "28:   string(1) \"3\"",
          "29: }",
          "30: array(3) {",
          "31:   [0]=>",
          "32:   object(__PHP_Incomplete_Class)#%d (2) {",
          "33:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "34:     string(3) \"foo\"",
          "35:     [\"x\"]=>",
          "36:     string(3) \"bar\"",
          "37:   }",
          "38:   [1]=>",
          "39:   int(2)",
          "40:   [2]=>",
          "41:   string(1) \"3\"",
          "42: }",
          "43: array(3) {",
          "44:   [0]=>",
          "45:   object(foo)#%d (1) {",
          "46:     [\"x\"]=>",
          "47:     string(3) \"bar\"",
          "48:   }",
          "49:   [1]=>",
          "50:   int(2)",
          "51:   [2]=>",
          "52:   string(1) \"3\"",
          "53: }",
          "54: array(3) {",
          "55:   [0]=>",
          "56:   object(__PHP_Incomplete_Class)#%d (2) {",
          "57:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "58:     string(3) \"foo\"",
          "59:     [\"x\"]=>",
          "60:     string(3) \"bar\"",
          "61:   }",
          "62:   [1]=>",
          "63:   int(2)",
          "64:   [2]=>",
          "65:   string(1) \"3\"",
          "66: }",
          "67: array(3) {",
          "68:   [0]=>",
          "69:   object(foo)#%d (1) {",
          "70:     [\"x\"]=>",
          "71:     string(3) \"bar\"",
          "72:   }",
          "73:   [1]=>",
          "74:   int(2)",
          "75:   [2]=>",
          "76:   string(1) \"3\"",
          "77: }",
          "78: array(3) {",
          "79:   [0]=>",
          "80:   object(foo)#%d (1) {",
          "81:     [\"x\"]=>",
          "82:     string(3) \"bar\"",
          "83:   }",
          "84:   [1]=>",
          "85:   int(2)",
          "86:   [2]=>",
          "87:   string(1) \"3\"",
          "88: }",
          "",
          "---------------"
        ],
        "ext/standard/var.c||ext/standard/var.c": [
          "File: ext/standard/var.c -> ext/standard/var.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "998:  size_t buf_len;",
          "999:  const unsigned char *p;",
          "1000:  php_unserialize_data_t var_hash;",
          "1003:   RETURN_FALSE;",
          "1004:  }",
          "",
          "[Removed Lines]",
          "1002:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"s\", &buf, &buf_len) == FAILURE) {",
          "",
          "[Added Lines]",
          "1001:  zval *options = NULL, *classes = NULL;",
          "1002:  HashTable *class_hash = NULL;",
          "1004:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"s|a\", &buf, &buf_len, &options) == FAILURE) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1010:  p = (const unsigned char*) buf;",
          "1011:  PHP_VAR_UNSERIALIZE_INIT(var_hash);",
          "1013:   PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1014:   zval_dtor(return_value);",
          "1015:   if (!EG(exception)) {",
          "1016:    php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Error at offset \" ZEND_LONG_FMT \" of %d bytes\", (zend_long)((char*)p - buf), buf_len);",
          "",
          "[Removed Lines]",
          "1012:  if (!php_var_unserialize(return_value, &p, p + buf_len, &var_hash TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "1014:  if(options != NULL) {",
          "1015:   classes = zend_hash_str_find(Z_ARRVAL_P(options), \"allowed_classes\", sizeof(\"allowed_classes\")-1);",
          "1016:   if(classes && (Z_TYPE_P(classes) == IS_ARRAY || !zend_is_true(classes TSRMLS_CC))) {",
          "1017:    ALLOC_HASHTABLE(class_hash);",
          "1018:    zend_hash_init(class_hash, (Z_TYPE_P(classes) == IS_ARRAY)?zend_hash_num_elements(Z_ARRVAL_P(classes)):0, NULL, NULL, 0);",
          "1019:   }",
          "1020:   if(class_hash && Z_TYPE_P(classes) == IS_ARRAY) {",
          "1021:    zval *entry;",
          "1022:    zend_string *lcname;",
          "1024:    ZEND_HASH_FOREACH_VAL(Z_ARRVAL_P(classes), entry) {",
          "1025:     convert_to_string_ex(entry);",
          "1026:     lcname = zend_string_alloc(Z_STRLEN_P(entry), 0);",
          "1027:     zend_str_tolower_copy(lcname->val, Z_STRVAL_P(entry), Z_STRLEN_P(entry));",
          "1028:     zend_hash_add_empty_element(class_hash, lcname);",
          "1029:           zend_string_release(lcname);",
          "1030:    } ZEND_HASH_FOREACH_END();",
          "1031:   }",
          "1032:  }",
          "1034:  if (!php_var_unserialize_ex(return_value, &p, p + buf_len, &var_hash, class_hash TSRMLS_CC)) {",
          "1036:   if(class_hash) {",
          "1037:    zend_hash_destroy(class_hash);",
          "1038:    FREE_HASHTABLE(class_hash);",
          "1039:   }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1018:   RETURN_FALSE;",
          "1019:  }",
          "1020:  PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1021: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1047:  if(class_hash) {",
          "1048:   zend_hash_destroy(class_hash);",
          "1049:   FREE_HASHTABLE(class_hash);",
          "1050:  }",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "226:  return str;",
          "227: }",
          "229: #define YYFILL(n) do { } while (0)",
          "230: #define YYCTYPE unsigned char",
          "231: #define YYCURSOR cursor",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "229: static inline int unserialize_allowed_class(zend_string *class_name, HashTable *classes)",
          "230: {",
          "231:  zend_string *lcname;",
          "232:  int res;",
          "233:  ALLOCA_FLAG(use_heap)",
          "235:  if(classes == NULL) {",
          "236:   return 1;",
          "237:  }",
          "238:  if(!zend_hash_num_elements(classes)) {",
          "239:   return 0;",
          "240:  }",
          "242:  STR_ALLOCA_ALLOC(lcname, class_name->len, use_heap);",
          "243:  zend_str_tolower_copy(lcname->val, class_name->val, class_name->len);",
          "244:  res = zend_hash_exists(classes, lcname);",
          "245:  STR_ALLOCA_FREE(lcname, use_heap);",
          "246:  return res;",
          "247: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "233: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "236: #line 241 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "256: #line 261 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "293:  return result;",
          "294: }",
          "299: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "300: {",
          "",
          "[Removed Lines]",
          "296: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC",
          "297: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash TSRMLS_CC",
          "",
          "[Added Lines]",
          "316: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes TSRMLS_DC",
          "317: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes TSRMLS_CC",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "302:   zval key, *data, d, *old_data;",
          "304:   ZVAL_UNDEF(&key);",
          "306:    zval_dtor(&key);",
          "307:    return 0;",
          "308:   }",
          "",
          "[Removed Lines]",
          "305:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "326:   if (!php_var_unserialize_ex(&key, p, max, NULL, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "355:   zval_dtor(&key);",
          "358:    return 0;",
          "359:   }",
          "",
          "[Removed Lines]",
          "357:   if (!php_var_unserialize(data, p, max, var_hash TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "378:   if (!php_var_unserialize_ex(data, p, max, var_hash, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "462: # pragma optimize(\"\", on)",
          "463: #endif",
          "466: {",
          "467:  const unsigned char *cursor, *limit, *marker, *start;",
          "468:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "465: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "486: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC)",
          "487: {",
          "488:  HashTable *classes = NULL;",
          "489:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "490: }",
          "493: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "481:  start = cursor;",
          "485: {",
          "486:  YYCTYPE yych;",
          "487:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "484: #line 485 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "512: #line 513 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "541:  yych = *(YYMARKER = ++YYCURSOR);",
          "542:  if (yych == ':') goto yy95;",
          "543: yy3:",
          "545:  { return 0; }",
          "547: yy4:",
          "548:  yych = *(YYMARKER = ++YYCURSOR);",
          "549:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "544: #line 826 \"ext/standard/var_unserializer.re\"",
          "546: #line 547 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "572: #line 860 \"ext/standard/var_unserializer.re\"",
          "574: #line 575 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "586:  goto yy3;",
          "587: yy14:",
          "588:  ++YYCURSOR;",
          "590:  {",
          "592:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "594: }",
          "596: yy16:",
          "597:  yych = *++YYCURSOR;",
          "598:  goto yy3;",
          "",
          "[Removed Lines]",
          "589: #line 820 \"ext/standard/var_unserializer.re\"",
          "595: #line 596 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "617: #line 854 \"ext/standard/var_unserializer.re\"",
          "623: #line 624 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "618:  if (yybm[0+yych] & 128) {",
          "619:   goto yy20;",
          "620:  }",
          "622:  yych = *++YYCURSOR;",
          "623:  if (yych != '\"') goto yy18;",
          "624:  ++YYCURSOR;",
          "626:  {",
          "627:  size_t len, len2, len3, maxlen;",
          "628:  zend_long elements;",
          "",
          "[Removed Lines]",
          "621:  if (yych != ':') goto yy18;",
          "625: #line 681 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "649:  if (yych <= '/') goto yy18;",
          "650:  if (yych >= ';') goto yy18;",
          "654: #line 709 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "672:  class_name = zend_string_init(str, len, 0);",
          "674:  do {",
          "676:   BG(serialize_lock)++;",
          "677:   ce = zend_lookup_class(class_name TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "704:   if(!unserialize_allowed_class(class_name, classes)) {",
          "705:    incomplete_class = 1;",
          "706:    ce = PHP_IC_ENTRY;",
          "707:    break;",
          "708:   }",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "762:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "763: }",
          "765: yy25:",
          "766:  yych = *++YYCURSOR;",
          "767:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "764: #line 765 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "799: #line 800 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "786:  yych = *++YYCURSOR;",
          "787:  if (yych != '\"') goto yy18;",
          "788:  ++YYCURSOR;",
          "790:  {",
          "",
          "[Removed Lines]",
          "789: #line 673 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "824: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "794:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "795:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "796: }",
          "798: yy32:",
          "799:  yych = *++YYCURSOR;",
          "800:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "832: #line 833 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "815:  yych = *++YYCURSOR;",
          "816:  if (yych != '{') goto yy18;",
          "817:  ++YYCURSOR;",
          "819:  {",
          "820:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "818: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "853: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "837:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "838: }",
          "840: yy39:",
          "841:  yych = *++YYCURSOR;",
          "842:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "839: #line 840 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "857:  yych = *++YYCURSOR;",
          "858:  if (yych != '\"') goto yy18;",
          "859:  ++YYCURSOR;",
          "861:  {",
          "862:  size_t len, maxlen;",
          "863:  zend_string *str;",
          "",
          "[Removed Lines]",
          "860: #line 624 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "895: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "885:  ZVAL_STR(rval, str);",
          "886:  return 1;",
          "887: }",
          "889: yy46:",
          "890:  yych = *++YYCURSOR;",
          "891:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "888: #line 889 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "923: #line 924 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "906:  yych = *++YYCURSOR;",
          "907:  if (yych != '\"') goto yy18;",
          "908:  ++YYCURSOR;",
          "910:  {",
          "911:  size_t len, maxlen;",
          "912:  char *str;",
          "",
          "[Removed Lines]",
          "909: #line 597 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "944: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "933:  ZVAL_STRINGL(rval, str, len);",
          "934:  return 1;",
          "935: }",
          "937: yy53:",
          "938:  yych = *++YYCURSOR;",
          "939:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "936: #line 937 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "971: #line 972 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1021:  }",
          "1022: yy63:",
          "1023:  ++YYCURSOR;",
          "1025:  {",
          "1026: #if SIZEOF_ZEND_LONG == 4",
          "1027: use_double:",
          "",
          "[Removed Lines]",
          "1024: #line 588 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1059: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1030:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1031:  return 1;",
          "1032: }",
          "1034: yy65:",
          "1035:  yych = *++YYCURSOR;",
          "1036:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1033: #line 1034 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1089:  yych = *++YYCURSOR;",
          "1090:  if (yych != ';') goto yy18;",
          "1091:  ++YYCURSOR;",
          "1093:  {",
          "",
          "[Removed Lines]",
          "1092: #line 572 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1127: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1106:  return 1;",
          "1107: }",
          "1109: yy76:",
          "1110:  yych = *++YYCURSOR;",
          "1111:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1108: #line 1109 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1143: #line 1144 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1132:  if (yych <= '9') goto yy79;",
          "1133:  if (yych != ';') goto yy18;",
          "1134:  ++YYCURSOR;",
          "1136:  {",
          "1137: #if SIZEOF_ZEND_LONG == 4",
          "1138:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1135: #line 546 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1170: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1158:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1159:  return 1;",
          "1160: }",
          "1162: yy83:",
          "1163:  yych = *++YYCURSOR;",
          "1164:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "1166:  yych = *++YYCURSOR;",
          "1167:  if (yych != ';') goto yy18;",
          "1168:  ++YYCURSOR;",
          "1170:  {",
          "1172:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1173:  return 1;",
          "1174: }",
          "1176: yy87:",
          "1177:  ++YYCURSOR;",
          "1179:  {",
          "1181:  ZVAL_NULL(rval);",
          "1182:  return 1;",
          "1183: }",
          "1185: yy89:",
          "1186:  yych = *++YYCURSOR;",
          "1187:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1169: #line 540 \"ext/standard/var_unserializer.re\"",
          "1175: #line 1176 \"ext/standard/var_unserializer.c\"",
          "1178: #line 534 \"ext/standard/var_unserializer.re\"",
          "1184: #line 1185 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1204: #line 568 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 562 \"ext/standard/var_unserializer.re\"",
          "1219: #line 1220 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "1204:  if (yych <= '9') goto yy91;",
          "1205:  if (yych != ';') goto yy18;",
          "1206:  ++YYCURSOR;",
          "1208:  {",
          "1209:  zend_long id;",
          "",
          "[Removed Lines]",
          "1207: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1242: #line 539 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "1228:  return 1;",
          "1229: }",
          "1231: yy95:",
          "1232:  yych = *++YYCURSOR;",
          "1233:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1230: #line 1231 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "1250:  if (yych <= '9') goto yy97;",
          "1251:  if (yych != ';') goto yy18;",
          "1252:  ++YYCURSOR;",
          "1254:  {",
          "1255:  zend_long id;",
          "",
          "[Removed Lines]",
          "1253: #line 489 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1288: #line 517 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "1273:  return 1;",
          "1274: }",
          "1276: }",
          "1280:  return 0;",
          "",
          "[Removed Lines]",
          "1275: #line 1276 \"ext/standard/var_unserializer.c\"",
          "1277: #line 828 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "224:  return str;",
          "225: }",
          "227: #define YYFILL(n) do { } while (0)",
          "228: #define YYCTYPE unsigned char",
          "229: #define YYCURSOR cursor",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "227: static inline int unserialize_allowed_class(zend_string *class_name, HashTable *classes)",
          "228: {",
          "229:  zend_string *lcname;",
          "230:  int res;",
          "231:  ALLOCA_FLAG(use_heap)",
          "233:  if(classes == NULL) {",
          "234:   return 1;",
          "235:  }",
          "236:  if(!zend_hash_num_elements(classes)) {",
          "237:   return 0;",
          "238:  }",
          "240:  STR_ALLOCA_ALLOC(lcname, class_name->len, use_heap);",
          "241:  zend_str_tolower_copy(lcname->val, class_name->val, class_name->len);",
          "242:  res = zend_hash_exists(classes, lcname);",
          "243:  STR_ALLOCA_FREE(lcname, use_heap);",
          "244:  return res;",
          "245: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "297:  return result;",
          "298: }",
          "303: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "304: {",
          "",
          "[Removed Lines]",
          "300: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC",
          "301: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash TSRMLS_CC",
          "",
          "[Added Lines]",
          "320: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes TSRMLS_DC",
          "321: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes TSRMLS_CC",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "306:   zval key, *data, d, *old_data;",
          "308:   ZVAL_UNDEF(&key);",
          "310:    zval_dtor(&key);",
          "311:    return 0;",
          "312:   }",
          "",
          "[Removed Lines]",
          "309:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "330:   if (!php_var_unserialize_ex(&key, p, max, NULL, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "359:   zval_dtor(&key);",
          "362:    return 0;",
          "363:   }",
          "",
          "[Removed Lines]",
          "361:   if (!php_var_unserialize(data, p, max, var_hash TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "382:   if (!php_var_unserialize_ex(data, p, max, var_hash, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "466: # pragma optimize(\"\", on)",
          "467: #endif",
          "470: {",
          "471:  const unsigned char *cursor, *limit, *marker, *start;",
          "472:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "469: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "490: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC)",
          "491: {",
          "492:  HashTable *classes = NULL;",
          "493:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "494: }",
          "497: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "727:  class_name = zend_string_init(str, len, 0);",
          "729:  do {",
          "731:   BG(serialize_lock)++;",
          "732:   ce = zend_lookup_class(class_name TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "758:   if(!unserialize_allowed_class(class_name, classes)) {",
          "759:    incomplete_class = 1;",
          "760:    ce = PHP_IC_ENTRY;",
          "761:    break;",
          "762:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fe1a3fc08bf47b8d484922d698975f134c7e9e3b",
      "candidate_info": {
        "commit_hash": "fe1a3fc08bf47b8d484922d698975f134c7e9e3b",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/fe1a3fc08bf47b8d484922d698975f134c7e9e3b",
        "files": [
          "Zend/tests/bug71841.phpt",
          "Zend/zend_vm_def.h",
          "Zend/zend_vm_execute.h",
          "ext/standard/tests/serialize/bug71840.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-5.6' into PHP-7.0\n\n* PHP-5.6:\n  Fixed bug #71841 (EG(error_zval) is not handled well)\n  Fixed bug #71840 (Unserialize accepts wrongly data)\n\nConflicts:\n\tZend/zend_vm_def.h\n\tZend/zend_vm_execute.h\n\text/standard/var_unserializer.c",
        "before_after_code_files": [
          "Zend/tests/bug71841.phpt||Zend/tests/bug71841.phpt",
          "Zend/zend_vm_def.h||Zend/zend_vm_def.h",
          "ext/standard/tests/serialize/bug71840.phpt||ext/standard/tests/serialize/bug71840.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/tests/bug71841.phpt||Zend/tests/bug71841.phpt": [
          "File: Zend/tests/bug71841.phpt -> Zend/tests/bug71841.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #71841 (EG(error_zval) is not handled well)",
          "3: --INI--",
          "4: error_reporting=0",
          "5: --FILE--",
          "6: <?php",
          "7: $z = unserialize('O:1:\"A\":0:{}');",
          "8: var_dump($z->e.=0);",
          "9: var_dump(++$z->x);",
          "10: var_dump($z->y++);",
          "12: $y = array(PHP_INT_MAX => 0);",
          "13: var_dump($y[] .= 0);",
          "14: var_dump(++$y[]);",
          "15: var_dump($y[]++);",
          "16: ?>",
          "17: --EXPECT--",
          "18: NULL",
          "19: NULL",
          "20: NULL",
          "21: NULL",
          "22: NULL",
          "23: NULL",
          "",
          "---------------"
        ],
        "Zend/zend_vm_def.h||Zend/zend_vm_def.h": [
          "File: Zend/zend_vm_def.h -> Zend/zend_vm_def.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "745:   if (EXPECTED(Z_OBJ_HT_P(object)->get_property_ptr_ptr)",
          "746:    && EXPECTED((zptr = Z_OBJ_HT_P(object)->get_property_ptr_ptr(object, property, BP_VAR_RW, ((OP2_TYPE == IS_CONST) ? CACHE_ADDR(Z_CACHE_SLOT_P(property)) : NULL))) != NULL)) {",
          "754:    }",
          "755:   } else {",
          "756:    zend_assign_op_overloaded_property(object, property, ((OP2_TYPE == IS_CONST) ? CACHE_ADDR(Z_CACHE_SLOT_P(property)) : NULL), value, binary_op, (UNEXPECTED(RETURN_VALUE_USED(opline)) ? EX_VAR(opline->result.var) : NULL));",
          "",
          "[Removed Lines]",
          "748:    ZVAL_DEREF(zptr);",
          "749:    SEPARATE_ZVAL_NOREF(zptr);",
          "751:    binary_op(zptr, zptr, value);",
          "752:    if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "753:     ZVAL_COPY(EX_VAR(opline->result.var), zptr);",
          "",
          "[Added Lines]",
          "747:    if (UNEXPECTED(zptr == &EG(error_zval))) {",
          "748:     if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "749:      ZVAL_NULL(EX_VAR(opline->result.var));",
          "750:     }",
          "751:    } else {",
          "752:     ZVAL_DEREF(zptr);",
          "753:     SEPARATE_ZVAL_NOREF(zptr);",
          "755:     binary_op(zptr, zptr, value);",
          "756:     if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "757:      ZVAL_COPY(EX_VAR(opline->result.var), zptr);",
          "758:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1150:   }",
          "1154:   if (EXPECTED(Z_OBJ_HT_P(object)->get_property_ptr_ptr)",
          "1155:    && EXPECTED((zptr = Z_OBJ_HT_P(object)->get_property_ptr_ptr(object, property, BP_VAR_RW, ((OP2_TYPE == IS_CONST) ? CACHE_ADDR(Z_CACHE_SLOT_P(property)) : NULL))) != NULL)) {",
          "1162:     }",
          "1163:    } else {",
          "1169:     } else {",
          "1171:     }",
          "1175:    }",
          "1176:   } else {",
          "1177:    zend_pre_incdec_overloaded_property(object, property, ((OP2_TYPE == IS_CONST) ? CACHE_ADDR(Z_CACHE_SLOT_P(property)) : NULL), inc, (UNEXPECTED(RETURN_VALUE_USED(opline)) ? EX_VAR(opline->result.var) : NULL));",
          "",
          "[Removed Lines]",
          "1157:    if (EXPECTED(Z_TYPE_P(zptr) == IS_LONG)) {",
          "1158:     if (inc) {",
          "1159:      fast_long_increment_function(zptr);",
          "1160:     } else {",
          "1161:      fast_long_decrement_function(zptr);",
          "1164:     ZVAL_DEREF(zptr);",
          "1165:     SEPARATE_ZVAL_NOREF(zptr);",
          "1167:     if (inc) {",
          "1168:      increment_function(zptr);",
          "1170:      decrement_function(zptr);",
          "1172:    }",
          "1173:    if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "1174:     ZVAL_COPY(EX_VAR(opline->result.var), zptr);",
          "",
          "[Added Lines]",
          "1160:    if (UNEXPECTED(zptr == &EG(error_zval))) {",
          "1161:     if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "1162:      ZVAL_NULL(EX_VAR(opline->result.var));",
          "1165:     if (EXPECTED(Z_TYPE_P(zptr) == IS_LONG)) {",
          "1166:      if (inc) {",
          "1167:       fast_long_increment_function(zptr);",
          "1168:      } else {",
          "1169:       fast_long_decrement_function(zptr);",
          "1170:      }",
          "1172:      ZVAL_DEREF(zptr);",
          "1173:      SEPARATE_ZVAL_NOREF(zptr);",
          "1175:      if (inc) {",
          "1176:       increment_function(zptr);",
          "1177:      } else {",
          "1178:       decrement_function(zptr);",
          "1179:      }",
          "1180:     }",
          "1181:     if (UNEXPECTED(RETURN_VALUE_USED(opline))) {",
          "1182:      ZVAL_COPY(EX_VAR(opline->result.var), zptr);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1233:   if (EXPECTED(Z_OBJ_HT_P(object)->get_property_ptr_ptr)",
          "1234:    && EXPECTED((zptr = Z_OBJ_HT_P(object)->get_property_ptr_ptr(object, property, BP_VAR_RW, ((OP2_TYPE == IS_CONST) ? CACHE_ADDR(Z_CACHE_SLOT_P(property)) : NULL))) != NULL)) {",
          "1243:    } else {",
          "1249:     } else {",
          "1251:     }",
          "1252:    }",
          "1253:   } else {",
          "",
          "[Removed Lines]",
          "1236:    if (EXPECTED(Z_TYPE_P(zptr) == IS_LONG)) {",
          "1237:     ZVAL_COPY_VALUE(EX_VAR(opline->result.var), zptr);",
          "1238:     if (inc) {",
          "1239:      fast_long_increment_function(zptr);",
          "1240:     } else {",
          "1241:      fast_long_decrement_function(zptr);",
          "1242:     }",
          "1244:     ZVAL_DEREF(zptr);",
          "1245:     ZVAL_COPY_VALUE(EX_VAR(opline->result.var), zptr);",
          "1246:     zval_opt_copy_ctor(zptr);",
          "1247:     if (inc) {",
          "1248:      increment_function(zptr);",
          "1250:      decrement_function(zptr);",
          "",
          "[Added Lines]",
          "1244:    if (UNEXPECTED(zptr == &EG(error_zval))) {",
          "1245:     ZVAL_NULL(EX_VAR(opline->result.var));",
          "1247:     if (EXPECTED(Z_TYPE_P(zptr) == IS_LONG)) {",
          "1248:      ZVAL_COPY_VALUE(EX_VAR(opline->result.var), zptr);",
          "1249:      if (inc) {",
          "1250:       fast_long_increment_function(zptr);",
          "1251:      } else {",
          "1252:       fast_long_decrement_function(zptr);",
          "1253:      }",
          "1255:      ZVAL_DEREF(zptr);",
          "1256:      ZVAL_COPY_VALUE(EX_VAR(opline->result.var), zptr);",
          "1257:      zval_opt_copy_ctor(zptr);",
          "1258:      if (inc) {",
          "1259:       increment_function(zptr);",
          "1260:      } else {",
          "1261:       decrement_function(zptr);",
          "1262:      }",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug71840.phpt||ext/standard/tests/serialize/bug71840.phpt": [
          "File: ext/standard/tests/serialize/bug71840.phpt -> ext/standard/tests/serialize/bug71840.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #71840 (Unserialize accepts wrongly data)",
          "3: --FILE--",
          "4: <?php",
          "5: var_dump(unserialize('a:1:{s:0:\"\"0a:0:{}}'));",
          "6: ?>",
          "7: --EXPECTF--",
          "8: Notice: unserialize(): Error at offset 11 of 19 bytes in %sbug71840.php on line %d",
          "9: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "574:  yych = *(YYMARKER = ++YYCURSOR);",
          "575:  if (yych == ':') goto yy95;",
          "576: yy3:",
          "578:  { return 0; }",
          "579: #line 580 \"ext/standard/var_unserializer.c\"",
          "580: yy4:",
          "",
          "[Removed Lines]",
          "577: #line 873 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "577: #line 884 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "619:  goto yy3;",
          "620: yy14:",
          "621:  ++YYCURSOR;",
          "623:  {",
          "625:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "",
          "[Removed Lines]",
          "622: #line 867 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "622: #line 878 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "655:  yych = *++YYCURSOR;",
          "656:  if (yych != '\"') goto yy18;",
          "657:  ++YYCURSOR;",
          "659:  {",
          "660:  size_t len, len2, len3, maxlen;",
          "661:  zend_long elements;",
          "",
          "[Removed Lines]",
          "658: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "658: #line 733 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych != '\"') goto yy18;",
          "827:  ++YYCURSOR;",
          "829:  {",
          "830:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "828: #line 715 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "828: #line 726 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych != '{') goto yy18;",
          "855:  ++YYCURSOR;",
          "857:  {",
          "858:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "856: #line 691 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "856: #line 702 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "898:  yych = *++YYCURSOR;",
          "899:  if (yych != '\"') goto yy18;",
          "900:  ++YYCURSOR;",
          "902:  {",
          "903:  size_t len, maxlen;",
          "904:  zend_string *str;",
          "",
          "[Removed Lines]",
          "901: #line 663 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "901: #line 668 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "920:   return 0;",
          "921:  }",
          "923:  YYCURSOR += 2;",
          "926:  ZVAL_STR(rval, str);",
          "927:  return 1;",
          "928: }",
          "930: yy46:",
          "931:  yych = *++YYCURSOR;",
          "932:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "929: #line 930 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "923:  if (*(YYCURSOR + 1) != ';') {",
          "924:   efree(str);",
          "926:   return 0;",
          "927:  }",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "968:   return 0;",
          "969:  }",
          "971:  YYCURSOR += 2;",
          "974:  ZVAL_STRINGL(rval, str, len);",
          "975:  return 1;",
          "976: }",
          "978: yy53:",
          "979:  yych = *++YYCURSOR;",
          "980:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "977: #line 978 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "977:  if (*(YYCURSOR + 1) != ';') {",
          "979:   return 0;",
          "980:  }",
          "988: #line 989 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1071:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1072:  return 1;",
          "1073: }",
          "1075: yy65:",
          "1076:  yych = *++YYCURSOR;",
          "1077:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1074: #line 1075 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1085: #line 1086 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1147:  return 1;",
          "1148: }",
          "1150: yy76:",
          "1151:  yych = *++YYCURSOR;",
          "1152:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1149: #line 1150 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1160: #line 1161 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1199:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1200:  return 1;",
          "1201: }",
          "1203: yy83:",
          "1204:  yych = *++YYCURSOR;",
          "1205:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1202: #line 1203 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1213: #line 1214 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1213:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1214:  return 1;",
          "1215: }",
          "1217: yy87:",
          "1218:  ++YYCURSOR;",
          "1219: #line 573 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1216: #line 1217 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1227: #line 1228 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1222:  ZVAL_NULL(rval);",
          "1223:  return 1;",
          "1224: }",
          "1226: yy89:",
          "1227:  yych = *++YYCURSOR;",
          "1228:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1236: #line 1237 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1271:  return 1;",
          "1272: }",
          "1274: yy95:",
          "1275:  yych = *++YYCURSOR;",
          "1276:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1273: #line 1274 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1320:  return 1;",
          "1321: }",
          "1323: }",
          "1327:  return 0;",
          "",
          "[Removed Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "1324: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1333: #line 1334 \"ext/standard/var_unserializer.c\"",
          "1335: #line 886 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "653:   return 0;",
          "654:  }",
          "656:  YYCURSOR += 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "656:  if (*(YYCURSOR + 1) != ';') {",
          "658:   return 0;",
          "659:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "681:   return 0;",
          "682:  }",
          "684:  YYCURSOR += 2;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "689:  if (*(YYCURSOR + 1) != ';') {",
          "690:   efree(str);",
          "692:   return 0;",
          "693:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6fc358241b84866e8f688055d577ba2fcaf2bbd3",
      "candidate_info": {
        "commit_hash": "6fc358241b84866e8f688055d577ba2fcaf2bbd3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6fc358241b84866e8f688055d577ba2fcaf2bbd3",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Use specialized efree_size()",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "178:  while (var_hash) {",
          "179:   next = var_hash->next;",
          "181:   var_hash = next;",
          "182:  }",
          "",
          "[Removed Lines]",
          "180:   efree(var_hash);",
          "",
          "[Added Lines]",
          "180:   efree_size(var_hash, sizeof(var_entries));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "186:    zval_ptr_dtor(&var_dtor_hash->data[i]);",
          "187:   }",
          "188:   next = var_dtor_hash->next;",
          "190:   var_dtor_hash = next;",
          "191:  }",
          "192: }",
          "",
          "[Removed Lines]",
          "189:   efree(var_dtor_hash);",
          "",
          "[Added Lines]",
          "189:   efree_size(var_dtor_hash, sizeof(var_dtor_entries));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "665:  if (yybm[0+yych] & 128) {",
          "666:   goto yy20;",
          "667:  }",
          "670:  yych = *++YYCURSOR;",
          "671:  if (yych != '\"') goto yy18;",
          "672:  ++YYCURSOR;",
          "",
          "[Removed Lines]",
          "668:  if (yych <= '/') goto yy18;",
          "669:  if (yych >= ';') goto yy18;",
          "",
          "[Added Lines]",
          "668:  if (yych != ':') goto yy18;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "816:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "817: }",
          "819: yy25:",
          "820:  yych = *++YYCURSOR;",
          "821:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "817: #line 818 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "848:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "849:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "850: }",
          "852: yy32:",
          "853:  yych = *++YYCURSOR;",
          "854:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "850: #line 851 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "891:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "892: }",
          "894: yy39:",
          "895:  yych = *++YYCURSOR;",
          "896:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "892: #line 893 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "939:  ZVAL_STR(rval, str);",
          "940:  return 1;",
          "941: }",
          "943: yy46:",
          "944:  yych = *++YYCURSOR;",
          "945:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "941: #line 942 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "987:  ZVAL_STRINGL(rval, str, len);",
          "988:  return 1;",
          "989: }",
          "991: yy53:",
          "992:  yych = *++YYCURSOR;",
          "993:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "990: #line 991 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "989: #line 990 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1084:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1085:  return 1;",
          "1086: }",
          "1088: yy65:",
          "1089:  yych = *++YYCURSOR;",
          "1090:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1087: #line 1088 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1160:  return 1;",
          "1161: }",
          "1163: yy76:",
          "1164:  yych = *++YYCURSOR;",
          "1165:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1212:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1213:  return 1;",
          "1214: }",
          "1216: yy83:",
          "1217:  yych = *++YYCURSOR;",
          "1218:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1226:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1227:  return 1;",
          "1228: }",
          "1230: yy87:",
          "1231:  ++YYCURSOR;",
          "1232: #line 581 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1228: #line 1229 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1235:  ZVAL_NULL(rval);",
          "1236:  return 1;",
          "1237: }",
          "1239: yy89:",
          "1240:  yych = *++YYCURSOR;",
          "1241:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1282:  return 1;",
          "1283: }",
          "1285: yy95:",
          "1286:  yych = *++YYCURSOR;",
          "1287:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1327:  return 1;",
          "1328: }",
          "1330: }",
          "1331: #line 881 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1328: #line 1329 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "176:  while (var_hash) {",
          "177:   next = var_hash->next;",
          "179:   var_hash = next;",
          "180:  }",
          "",
          "[Removed Lines]",
          "178:   efree(var_hash);",
          "",
          "[Added Lines]",
          "178:   efree_size(var_hash, sizeof(var_entries));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "184:    zval_ptr_dtor(&var_dtor_hash->data[i]);",
          "185:   }",
          "186:   next = var_dtor_hash->next;",
          "188:   var_dtor_hash = next;",
          "189:  }",
          "190: }",
          "",
          "[Removed Lines]",
          "187:   efree(var_dtor_hash);",
          "",
          "[Added Lines]",
          "187:   efree_size(var_dtor_hash, sizeof(var_dtor_entries));",
          "",
          "---------------"
        ]
      }
    }
  ]
}