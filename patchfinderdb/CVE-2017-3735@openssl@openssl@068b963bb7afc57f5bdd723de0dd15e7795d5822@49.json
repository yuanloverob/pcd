{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d9ac82a28d10c05d7b491324596a9d8ce7a9319e",
      "candidate_info": {
        "commit_hash": "d9ac82a28d10c05d7b491324596a9d8ce7a9319e",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/d9ac82a28d10c05d7b491324596a9d8ce7a9319e",
        "files": [
          "crypto/objects/obj_dat.c"
        ],
        "message": "Fix OBJ_create() to tolerate a NULL sn and ln\n\nIn 1.0.2 and before OBJ_create() allowed the sn or ln parameter to be NULL.\nCommit 52832e47 changed that so that it crashed if they were NULL.\n\nThis was causing problems with the built-in config oid module. If a long\nname was provided OBJ_create() is initially called with a NULL ln and\ntherefore causes a crash.\n\nFixes #3733\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3753)\n\n(cherry picked from commit f13615c5b828aeb8e3d9bf2545c803633d1c684f)",
        "before_after_code_files": [
          "crypto/objects/obj_dat.c||crypto/objects/obj_dat.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/objects/obj_dat.c||crypto/objects/obj_dat.c": [
          "File: crypto/objects/obj_dat.c -> crypto/objects/obj_dat.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "685:     int ok = 0;",
          "689:         OBJerr(OBJ_F_OBJ_CREATE, OBJ_R_OID_EXISTS);",
          "690:         return 0;",
          "691:     }",
          "",
          "[Removed Lines]",
          "688:     if (OBJ_sn2nid(sn) != NID_undef || OBJ_ln2nid(ln) != NID_undef) {",
          "",
          "[Added Lines]",
          "688:     if ((sn != NULL && OBJ_sn2nid(sn) != NID_undef)",
          "689:             || (ln != NULL && OBJ_ln2nid(ln) != NID_undef)) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ef66b8cb5efbc2dfbc2dc64f35a34c023b96e4c1",
      "candidate_info": {
        "commit_hash": "ef66b8cb5efbc2dfbc2dc64f35a34c023b96e4c1",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/ef66b8cb5efbc2dfbc2dc64f35a34c023b96e4c1",
        "files": [
          "ssl/record/rec_layer_s3.c"
        ],
        "message": "Fix inconsistent check of UNSAFE_LEGACY_RENEGOTIATION\n\nThe check for SSL3_FLAGS_ALLOW_UNSAFE_LEGACY_RENEGOTIATION is\ninconsistent. Most places check SSL->options, one place is checking\nSSL_CTX->options; fix that.\n\nReviewed-by: Matt Caswell <matt@openssl.org>\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\nGH: #3523\n(cherry picked from commit dffdcc773ac0a294b1ce620131cb8d7401da9408)",
        "before_after_code_files": [
          "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c": [
          "File: ssl/record/rec_layer_s3.c -> ssl/record/rec_layer_s3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1332:         (s->rlayer.handshake_fragment_len >= 4) &&",
          "1333:         (s->rlayer.handshake_fragment[0] == SSL3_MT_CLIENT_HELLO) &&",
          "1334:         (s->session != NULL) && (s->session->cipher != NULL) &&",
          "1336:         SSL3_RECORD_set_length(rr, 0);",
          "1337:         SSL3_RECORD_set_read(rr);",
          "1338:         ssl3_send_alert(s, SSL3_AL_WARNING, SSL_AD_NO_RENEGOTIATION);",
          "",
          "[Removed Lines]",
          "1335:         !(s->ctx->options & SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION)) {",
          "",
          "[Added Lines]",
          "1335:         !(s->options & SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION)) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c2b980d89fa8aa2084206f007ab9879cee4cda4e",
      "candidate_info": {
        "commit_hash": "c2b980d89fa8aa2084206f007ab9879cee4cda4e",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/c2b980d89fa8aa2084206f007ab9879cee4cda4e",
        "files": [
          "util/mkdef.pl"
        ],
        "message": "util/mkdef.pl: Add UNIX as a platform\n\nThis allows us to guard Unix specific functions with\n#ifndef / #ifdef OPENSSL_SYS_UNIX\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3804)\n\n(cherry picked from commit 9c06cf04ee9aa6682e6cc635aeb453ac12e641c1)",
        "before_after_code_files": [
          "util/mkdef.pl||util/mkdef.pl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "util/mkdef.pl||util/mkdef.pl": [
          "File: util/mkdef.pl -> util/mkdef.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "66: my $VMS=0;",
          "67: my $W32=0;",
          "68: my $NT=0;",
          "69: my $linux=0;",
          "70: # Set this to make typesafe STACK definitions appear in DEF",
          "71: my $safe_stack_def = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "69: my $UNIX=0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "73: my @known_platforms = ( \"__FreeBSD__\", \"PERL5\",",
          "74:    \"EXPORT_VAR_AS_FUNCTION\", \"ZLIB\", \"_WIN32\"",
          "75:    );",
          "77: my @known_algorithms = ( \"RC2\", \"RC4\", \"RC5\", \"IDEA\", \"DES\", \"BF\",",
          "78:     \"CAST\", \"MD2\", \"MD4\", \"MD5\", \"SHA\", \"SHA0\", \"SHA1\",",
          "79:     \"SHA256\", \"SHA512\", \"RMD160\",",
          "",
          "[Removed Lines]",
          "76: my @known_ossl_platforms = ( \"VMS\", \"WIN32\", \"WINNT\", \"OS2\" );",
          "",
          "[Added Lines]",
          "77: my @known_ossl_platforms = ( \"UNIX\", \"VMS\", \"WIN32\", \"WINNT\", \"OS2\" );",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "153:  }",
          "154:  if ($_ eq \"linux\") {",
          "155:   $linux=1;",
          "156:  }",
          "157:  $VMS=1 if $_ eq \"VMS\";",
          "158:  if ($_ eq \"zlib\" || $_ eq \"enable-zlib\" || $_ eq \"zlib-dynamic\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "157:   $UNIX=1;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1096:   if ($platforms) {",
          "1097:    # platforms",
          "1098:    if ($keyword eq \"VMS\" && $VMS) { return 1; }",
          "1099:    if ($keyword eq \"WIN32\" && $W32) { return 1; }",
          "1100:    if ($keyword eq \"_WIN32\" && $W32) { return 1; }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1100:    if ($keyword eq \"UNIX\" && $UNIX) { return 1; }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "389058f8a02641edc1847f84237efe757f836d03",
      "candidate_info": {
        "commit_hash": "389058f8a02641edc1847f84237efe757f836d03",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/389058f8a02641edc1847f84237efe757f836d03",
        "files": [
          "apps/s_socket.c"
        ],
        "message": "Allow an endpoint to read the alert data before closing the socket\n\nIf an alert gets sent and then we close the connection immediately with\ndata still in the input buffer then a TCP-RST gets sent. Some OSs\nimmediately abandon data in their input buffer if a TCP-RST is received -\nmeaning the alert data itself gets ditched. Sending a TCP-FIN before the\nTCP-RST seems to avoid this.\n\nThis was causing test failures in MSYS2 builds.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Ben Kaduk <kaduk@mit.edu>\n(Merged from https://github.com/openssl/openssl/pull/4333)\n\n(cherry picked from commit bac6abe18d28373e0d2d0666c411020404197337)",
        "before_after_code_files": [
          "apps/s_socket.c||apps/s_socket.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/s_socket.c||apps/s_socket.c": [
          "File: apps/s_socket.c -> apps/s_socket.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "178:                 break;",
          "179:             }",
          "180:             i = (*cb)(sock, type, context);",
          "181:             BIO_closesocket(sock);",
          "182:         } else {",
          "183:             i = (*cb)(asock, type, context);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "191: #ifdef _WIN32",
          "192: # ifdef SD_SEND",
          "193:             shutdown(sock, SD_SEND);",
          "194: # endif",
          "195: #elif defined(SHUT_WR)",
          "196:             shutdown(sock, SHUT_WR);",
          "197: #endif",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "38c23e647fd7d0e929ff97e6b9c9a23899ce52fd",
      "candidate_info": {
        "commit_hash": "38c23e647fd7d0e929ff97e6b9c9a23899ce52fd",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/38c23e647fd7d0e929ff97e6b9c9a23899ce52fd",
        "files": [
          "crypto/lhash/lhash.c",
          "demos/bio/cmod.cnf",
          "doc/apps/cms.pod",
          "doc/apps/openssl.pod",
          "doc/apps/x509v3_config.pod",
          "doc/crypto/BIO_set_callback.pod",
          "doc/crypto/PKCS7_sign.pod",
          "doc/crypto/PKCS7_sign_add_signer.pod",
          "doc/crypto/X509_get0_notBefore.pod",
          "doc/crypto/d2i_X509.pod",
          "doc/openssl-c-indent.el",
          "doc/ssl/SSL_CONF_cmd.pod",
          "doc/ssl/SSL_CTX_config.pod",
          "test/asynciotest.c",
          "test/recipes/70-test_sslmessages.t",
          "test/recipes/80-test_pkcs12.t",
          "test/recipes/tconversion.pl",
          "test/ssl-tests/06-sni-ticket.conf.in",
          "test/ssl-tests/08-npn.conf.in",
          "test/ssl-tests/09-alpn.conf.in",
          "test/ssl-tests/12-ct.conf.in",
          "test/ssl-tests/13-fragmentation.conf.in",
          "util/indent.pro"
        ],
        "message": "Spelling doc #3580 Duplicated tests descriptions\n\nBackport of #3580 to 1.1.0\nplus a few other typo fixes found at fligth.\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\nReviewed-by: Bernd Edlinger <bernd.edlinger@hotmail.de>\n(Merged from https://github.com/openssl/openssl/pull/4645)",
        "before_after_code_files": [
          "crypto/lhash/lhash.c||crypto/lhash/lhash.c",
          "demos/bio/cmod.cnf||demos/bio/cmod.cnf",
          "test/asynciotest.c||test/asynciotest.c",
          "test/recipes/70-test_sslmessages.t||test/recipes/70-test_sslmessages.t",
          "test/recipes/80-test_pkcs12.t||test/recipes/80-test_pkcs12.t",
          "test/recipes/tconversion.pl||test/recipes/tconversion.pl",
          "test/ssl-tests/06-sni-ticket.conf.in||test/ssl-tests/06-sni-ticket.conf.in",
          "test/ssl-tests/08-npn.conf.in||test/ssl-tests/08-npn.conf.in",
          "test/ssl-tests/09-alpn.conf.in||test/ssl-tests/09-alpn.conf.in",
          "test/ssl-tests/12-ct.conf.in||test/ssl-tests/12-ct.conf.in",
          "test/ssl-tests/13-fragmentation.conf.in||test/ssl-tests/13-fragmentation.conf.in",
          "util/indent.pro||util/indent.pro"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/lhash/lhash.c||crypto/lhash/lhash.c": [
          "File: crypto/lhash/lhash.c -> crypto/lhash/lhash.c"
        ],
        "demos/bio/cmod.cnf||demos/bio/cmod.cnf": [
          "File: demos/bio/cmod.cnf -> demos/bio/cmod.cnf",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: testapp = test_sect",
          "7: [test_sect]",
          "10: # SSL configuration module",
          "11: ssl_conf = ssl_sect",
          "",
          "[Removed Lines]",
          "8: # list of confuration modules",
          "",
          "[Added Lines]",
          "8: # list of configuration modules",
          "",
          "---------------"
        ],
        "test/asynciotest.c||test/asynciotest.c": [
          "File: test/asynciotest.c -> test/asynciotest.c"
        ],
        "test/recipes/70-test_sslmessages.t||test/recipes/70-test_sslmessages.t": [
          "File: test/recipes/70-test_sslmessages.t -> test/recipes/70-test_sslmessages.t",
          "--- Hunk 1 ---",
          "[Context before]",
          "98: $proxy->clear();",
          "99: $proxy->reneg(1);",
          "100: $proxy->start();",
          "103: #Test 5: A handshake with a renegotiation and client auth",
          "104: $proxy->clear();",
          "",
          "[Removed Lines]",
          "101: checkmessages(RENEG_HANDSHAKE, \"Rengotiation handshake test\");",
          "",
          "[Added Lines]",
          "101: checkmessages(RENEG_HANDSHAKE, \"Renegotiation handshake test\");",
          "",
          "---------------"
        ],
        "test/recipes/80-test_pkcs12.t||test/recipes/80-test_pkcs12.t": [
          "File: test/recipes/80-test_pkcs12.t -> test/recipes/80-test_pkcs12.t",
          "--- Hunk 1 ---",
          "[Context before]",
          "42:         $pass = Encode::encode(\"cp1253\",Encode::decode(\"utf-8\",$pass));",
          "43:     }",
          "44: } else {",
          "46:     # UTF-8 locale...",
          "48:     foreach(`locale -a`) {",
          "",
          "[Removed Lines]",
          "45:     # Running MinGW tests transparenly under Wine apparently requires",
          "",
          "[Added Lines]",
          "45:     # Running MinGW tests transparently under Wine apparently requires",
          "",
          "---------------"
        ],
        "test/recipes/tconversion.pl||test/recipes/tconversion.pl": [
          "File: test/recipes/tconversion.pl -> test/recipes/tconversion.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:  + $n   # initial conversions from p to all forms (A)",
          "38:  + $n*$n   # conversion from result of A to all forms (B)",
          "39:  + 1   # comparing original test file to p form of A",
          "41:     $totaltests-- if ($testtype eq \"p7d\"); # no comparison of original test file",
          "42:     plan tests => $totaltests;",
          "",
          "[Removed Lines]",
          "40:  + $n*($n-1);  # comparing first conversion to each fom in A with B",
          "",
          "[Added Lines]",
          "40:  + $n*($n-1);  # comparing first conversion to each form in A with B",
          "",
          "---------------"
        ],
        "test/ssl-tests/06-sni-ticket.conf.in||test/ssl-tests/06-sni-ticket.conf.in": [
          "File: test/ssl-tests/06-sni-ticket.conf.in -> test/ssl-tests/06-sni-ticket.conf.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: # https://www.openssl.org/source/license.html",
          "12: use strict;",
          "13: use warnings;",
          "",
          "[Removed Lines]",
          "10: ## Test version negotiation",
          "",
          "[Added Lines]",
          "10: ## Test Session ticket",
          "",
          "---------------"
        ],
        "test/ssl-tests/08-npn.conf.in||test/ssl-tests/08-npn.conf.in": [
          "File: test/ssl-tests/08-npn.conf.in -> test/ssl-tests/08-npn.conf.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: # https://www.openssl.org/source/license.html",
          "12: use strict;",
          "13: use warnings;",
          "",
          "[Removed Lines]",
          "10: ## Test version negotiation",
          "",
          "[Added Lines]",
          "10: ## Test NPN negotiation",
          "",
          "---------------"
        ],
        "test/ssl-tests/09-alpn.conf.in||test/ssl-tests/09-alpn.conf.in": [
          "File: test/ssl-tests/09-alpn.conf.in -> test/ssl-tests/09-alpn.conf.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: # https://www.openssl.org/source/license.html",
          "12: use strict;",
          "13: use warnings;",
          "",
          "[Removed Lines]",
          "10: ## Test version negotiation",
          "",
          "[Added Lines]",
          "10: ## Test ALPN negotiation",
          "",
          "---------------"
        ],
        "test/ssl-tests/12-ct.conf.in||test/ssl-tests/12-ct.conf.in": [
          "File: test/ssl-tests/12-ct.conf.in -> test/ssl-tests/12-ct.conf.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: # https://www.openssl.org/source/license.html",
          "12: use strict;",
          "13: use warnings;",
          "",
          "[Removed Lines]",
          "10: ## Test version negotiation",
          "",
          "[Added Lines]",
          "10: ## Test CT support",
          "",
          "---------------"
        ],
        "test/ssl-tests/13-fragmentation.conf.in||test/ssl-tests/13-fragmentation.conf.in": [
          "File: test/ssl-tests/13-fragmentation.conf.in -> test/ssl-tests/13-fragmentation.conf.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: # https://www.openssl.org/source/license.html",
          "12: use strict;",
          "13: use warnings;",
          "",
          "[Removed Lines]",
          "10: ## Test version negotiation",
          "",
          "[Added Lines]",
          "10: ## Test packet fragmentation",
          "",
          "---------------"
        ],
        "util/indent.pro||util/indent.pro": [
          "File: util/indent.pro -> util/indent.pro",
          "--- Hunk 1 ---",
          "[Context before]",
          "512: -T asn1_ps_func",
          "513: -T bio_dgram_data",
          "514: -T bio_info_cb",
          "516: -T char_io",
          "517: -T conf_finish_func",
          "518: -T conf_init_func",
          "",
          "[Removed Lines]",
          "515: -T BIO_callack_fn",
          "",
          "[Added Lines]",
          "515: -T BIO_callback_fn",
          "",
          "---------------"
        ]
      }
    }
  ]
}