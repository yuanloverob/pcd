{
  "cve_id": "CVE-2015-8896",
  "cve_desc": "Integer truncation issue in coders/pict.c in ImageMagick before 7.0.5-0 allows remote attackers to cause a denial of service (application crash) via a crafted .pict file.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "0f6fc2d5bf8f500820c3dbcf0d23ee14f2d9f734",
  "patch_info": {
    "commit_hash": "0f6fc2d5bf8f500820c3dbcf0d23ee14f2d9f734",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/0f6fc2d5bf8f500820c3dbcf0d23ee14f2d9f734",
    "files": [
      "MagickCore/memory.c",
      "MagickCore/studio.h",
      "MagickCore/version.c",
      "MagickCore/version.h",
      "MagickWand/studio.h",
      "coders/icon.c",
      "coders/pict.c",
      "configure",
      "configure.ac"
    ],
    "message": "",
    "before_after_code_files": [
      "MagickCore/memory.c||MagickCore/memory.c",
      "MagickCore/studio.h||MagickCore/studio.h",
      "MagickCore/version.c||MagickCore/version.c",
      "MagickCore/version.h||MagickCore/version.h",
      "MagickWand/studio.h||MagickWand/studio.h",
      "coders/icon.c||coders/icon.c",
      "coders/pict.c||coders/pict.c",
      "configure.ac||configure.ac"
    ]
  },
  "patch_diff": {
    "MagickCore/memory.c||MagickCore/memory.c": [
      "File: MagickCore/memory.c -> MagickCore/memory.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "606:     }",
      "607:   if ((memory_info->blob == NULL) &&",
      "608:       (AcquireMagickResource(MapResource,length) != MagickFalse))",
      "611:         Heap memory failed, try anonymous memory mapping.",
      "",
      "[Removed Lines]",
      "609:     {",
      "",
      "[Added Lines]",
      "609:     {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "615:         memory_info->type=MapVirtualMemory;",
      "616:       else",
      "617:         RelinquishMagickResource(MapResource,length);",
      "619:   if (memory_info->blob == NULL)",
      "621:       int",
      "627:       file=AcquireUniqueFileResource(memory_info->filename);",
      "628:       if (file != -1)",
      "629:         {",
      "",
      "[Removed Lines]",
      "618:     }",
      "620:     {",
      "622:         file;",
      "625:         Anonymous memory mapping failed, try file-backed memory mapping.",
      "",
      "[Added Lines]",
      "619:   if ((memory_info->blob == NULL) &&",
      "620:       (AcquireMagickResource(DiskResource,length) != MagickFalse))",
      "621:     {",
      "623:         file;",
      "628:       file=AcquireUniqueFileResource(memory_info->filename);",
      "629:       if (file == -1)",
      "631:       else",
      "632:         {",
      "633:           if ((lseek(file,length-1,SEEK_SET) < 0) || (write(file,\"\",1) != 1))",
      "634:             RelinquishMagickResource(DiskResource,length);",
      "635:           else",
      "636:             {",
      "637:               if (AcquireMagickResource(MapResource,length) == MagickFalse)",
      "638:                 RelinquishMagickResource(DiskResource,length);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1033: %",
      "1035: MagickExport MemoryInfo *RelinquishVirtualMemory(MemoryInfo *memory_info)",
      "1037:   assert(memory_info != (MemoryInfo *) NULL);",
      "1038:   assert(memory_info->signature == MagickSignature);",
      "1039:   if (memory_info->blob != (void *) NULL)",
      "",
      "[Removed Lines]",
      "1036: {",
      "",
      "[Added Lines]",
      "1048: {",
      "1049:   assert(memory_info != (MemoryInfo *) NULL);",
      "1050:   assert(memory_info->signature == MagickSignature);",
      "1051:   if (memory_info->blob != (void *) NULL)",
      "",
      "---------------"
    ],
    "MagickCore/studio.h||MagickCore/studio.h": [
      "File: MagickCore/studio.h -> MagickCore/studio.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "46: #if defined(_magickcore_inline) && !defined(inline)",
      "47: # define inline  _magickcore_inline",
      "48: #endif",
      "52: # if defined(__cplusplus) || defined(c_plusplus)",
      "53: #  undef inline",
      "54: # endif",
      "",
      "[Removed Lines]",
      "49: #if defined(_magickcore_restrict) && !defined(restrict)",
      "50: # define restrict  _magickcore_restrict",
      "51: #endif",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "75: #  include <stdlib.h>",
      "76: # endif",
      "77: #endif",
      "78: #if defined(MAGICKCORE_HAVE_STRING_H)",
      "79: # if !defined(STDC_HEADERS) && defined(MAGICKCORE_HAVE_MEMORY_H)",
      "80: #  include <memory.h>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "75: #if defined(_magickcore_restrict) && !defined(restrict)",
      "76: # define restrict  _magickcore_restrict",
      "77: #endif",
      "",
      "---------------"
    ],
    "MagickCore/version.c||MagickCore/version.c": [
      "File: MagickCore/version.c -> MagickCore/version.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "219: %      const char *GetMagickFeatures(void)",
      "220: %",
      "221: %  No parameters are required.",
      "224: MagickExport const char *GetMagickFeatures(void)",
      "225: {",
      "226:   return \"DPC\"",
      "227: #if defined(MAGICKCORE_BUILD_MODULES) || defined(_DLL)",
      "228:   \" Modules\"",
      "229: #endif",
      "230: #if defined(MAGICKCORE_HDRI_SUPPORT)",
      "231:   \" HDRI\"",
      "232: #endif",
      "233: #if defined(MAGICKCORE_OPENCL_SUPPORT)",
      "234:   \" OpenCL\"",
      "235: #endif",
      "",
      "[Removed Lines]",
      "222: %",
      "",
      "[Added Lines]",
      "222: %",
      "224: MagickExport const char *GetMagickFeatures(void)",
      "225: {",
      "226:   return \"DPC\"",
      "231:   \" Cipher\"",
      "232: #endif",
      "233: #if defined(MAGICKCORE_HDRI_SUPPORT)",
      "239: #if defined(MAGICKCORE_OPENCL_SUPPORT)",
      "240:   \" OpenCL\"",
      "241: #endif",
      "",
      "---------------"
    ],
    "MagickCore/version.h||MagickCore/version.h": [
      "File: MagickCore/version.h -> MagickCore/version.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "28: #define MagickPackageName \"ImageMagick\"",
      "29: #define MagickCopyright  \"Copyright (C) 1999-2015 ImageMagick Studio LLC\"",
      "31: #define MagickLibVersion  0x700",
      "32: #define MagickLibVersionText  \"7.0.0\"",
      "33: #define MagickLibVersionNumber  0,0,0",
      "",
      "[Removed Lines]",
      "30: #define MagickSVNRevision  \"18658:18662M\"",
      "",
      "[Added Lines]",
      "30: #define MagickSVNRevision  \"18670M\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "48: #define MagickppLibAddendum  \"-0\"",
      "49: #define MagickppLibInterface  0",
      "50: #define MagickppLibMinInterface  0",
      "52: #define MagickChangeDate   \"20120427\"",
      "53: #define MagickAuthoritativeLicense  \\",
      "54:   \"http://www.imagemagick.org/script/license.php\"",
      "55: #define MagickAuthoritativeURL  \"http://www.imagemagick.org\"",
      "57: #define MagickDelegates \"bzlib djvu mpeg fftw fpx fontconfig freetype jbig jng jpeg lcms lzma openexr pango png ps tiff webp x xml zlib\"",
      "58: #define MagickHomeURL  \"file:///usr/local/share/doc/ImageMagick-7/index.html\"",
      "59: #if (MAGICKCORE_QUANTUM_DEPTH == 8)",
      "",
      "[Removed Lines]",
      "51: #define MagickReleaseDate  \"2015-05-26\"",
      "56: #define MagickFeatures \"DPC HDRI OpenMP\"",
      "",
      "[Added Lines]",
      "51: #define MagickReleaseDate  \"2015-05-29\"",
      "56: #define MagickFeatures \"DPC HDRI Cipher OpenMP\"",
      "",
      "---------------"
    ],
    "MagickWand/studio.h||MagickWand/studio.h": [
      "File: MagickWand/studio.h -> MagickWand/studio.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "46: #if defined(_magickcore_inline) && !defined(inline)",
      "47: # define inline _magickcore_inline",
      "48: #endif",
      "52: # if defined(__cplusplus) || defined(c_plusplus)",
      "53: #  undef inline",
      "54: # endif",
      "",
      "[Removed Lines]",
      "49: #if defined(_magickcore_restrict) && !defined(restrict)",
      "50: # define restrict  _magickcore_restrict",
      "51: #endif",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "77: #  include <stdlib.h>",
      "78: # endif",
      "79: #endif",
      "80: #if defined(MAGICKCORE_HAVE_STRING_H)",
      "81: # if !defined(STDC_HEADERS) && defined(MAGICKCORE_HAVE_MEMORY_H)",
      "82: #  include <memory.h>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "77: #if defined(_magickcore_restrict) && !defined(restrict)",
      "78: # define restrict  _magickcore_restrict",
      "79: #endif",
      "",
      "---------------"
    ],
    "coders/icon.c||coders/icon.c": [
      "File: coders/icon.c -> coders/icon.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "183:     size_t",
      "184:       size;",
      "189:     size=(size_t)strtol(p,&q,10);",
      "190:     if (p == q || size < 16 || size > 256)",
      "",
      "[Removed Lines]",
      "186:     while ((isspace((int) ((unsigned char) *p)) != 0))",
      "187:       p++;",
      "",
      "[Added Lines]",
      "186:     while ((isspace((int) ((unsigned char) *p)) != 0))",
      "187:       p++;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "355:         unsigned char",
      "359:           Icon image encoded as a compressed PNG image.",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "coders/pict.c||coders/pict.c": [
      "File: coders/pict.c -> coders/pict.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1637:     source_rectangle;",
      "1639:   register const Quantum",
      "1642:   register ssize_t",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1649:     storage_class;",
      "1651:   ssize_t",
      "1654:   unsigned char",
      "",
      "[Removed Lines]",
      "1652:     y;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1682:     Initialize image info.",
      "1685:   size_rectangle.left=0;",
      "1686:   size_rectangle.bottom=(short) image->rows;",
      "1687:   size_rectangle.right=(short) image->columns;",
      "",
      "[Removed Lines]",
      "1684:   size_rectangle.top=0;",
      "",
      "[Added Lines]",
      "1684:   size_rectangle.top=0;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1711:   y_resolution=image->resolution.y != 0.0 ? image->resolution.y :",
      "1712:     DefaultResolution;",
      "1713:   storage_class=image->storage_class;",
      "1715:     storage_class=DirectClass;",
      "1716:   if (storage_class == DirectClass)",
      "1717:     {",
      "",
      "[Removed Lines]",
      "1714:   if (image_info->compression == JPEGCompression)",
      "",
      "[Added Lines]",
      "1714:   if (image_info->compression == JPEGCompression)",
      "",
      "---------------"
    ],
    "configure.ac||configure.ac": [
      "File: configure.ac -> configure.ac",
      "--- Hunk 1 ---",
      "[Context before]",
      "643: if test \"$enable_cipher\" = 'yes'; then",
      "644:     AC_DEFINE(CIPHER_SUPPORT,1,[permit enciphering and deciphering image pixels])",
      "645: fi",
      "647: # Build a zero-configuration version of ImageMagick.",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "645:     MAGICK_FEATURES=\"Cipher $MAGICK_FEATURES\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "654: if test \"$enable_zero_configuration\" = 'yes'; then",
      "655:     AC_DEFINE(ZERO_CONFIGURATION_SUPPORT,1,[Build self-contained, embeddable, zero-configuration ImageMagick])",
      "657: fi",
      "659: # Build a high dynamic range version of ImageMagick.",
      "",
      "[Removed Lines]",
      "656:     MAGICK_FEATURES=\"Zero-Configuration $MAGICK_FEATURES\"",
      "",
      "[Added Lines]",
      "657:     MAGICK_FEATURES=\"Zero-configuration $MAGICK_FEATURES\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "3996: if test \"$build_modules\" != 'no'; then",
      "3997:     MAGICK_DEP_LIBS=\"$USER_LIBS $LCMS_LIBS $FREETYPE_LIBS $LQR_LIBS $FFTW_LIBS $FONTCONFIG_LIBS $XEXT_LIBS $IPC_LIBS $X11_LIBS $XT_LIBS $LZMA_LIBS $BZLIB_LIBS $ZLIB_LIBS $LTDL_LIBS $GDI32_LIBS $MATH_LIBS $GOMP_LIBS $CL_LIBS $UMEM_LIBS $JEMALLOC_LIBS $THREAD_LIBS\"",
      "3998: else",
      "4000: fi",
      "4001: AC_SUBST(MAGICK_DEP_LIBS)",
      "",
      "[Removed Lines]",
      "3999:     MAGICK_DEP_LIBS=\"$USER_LIBS $JBIG_LIBS $LCMS_LIBS $TIFF_LIBS $FREETYPE_LIBS $JPEG_LIBS $GS_LIBS $LQR_LIBS $PNG_LIBS $AUTOTRACE_LIBS $DJVU_LIBS $FFTW_LIBS $FPX_LIBS $FONTCONFIG_LIBS $WEBP_LIBS $WMF_LIBS $DPS_LIBS $XEXT_LIBS $XT_LIBS $IPC_LIBS $X11_LIBS $LZMA_LIBS $BZLIB_LIBS $OPENEXR_LIBS $OPENJPEG_LIBS $PANGO_LIBS $RSVG_LIBS $XML_LIBS $GVC_LIBS $ZLIB_LIBS $GDI32_LIBS $MATH_LIBS $GOMP_LIBS $CL_LIBS $UMEM_LIBS $JEMALLOC_LIBS $THREAD_LIBS\"",
      "",
      "[Added Lines]",
      "4000:     MAGICK_DEP_LIBS=\"$USER_LIBS $JBIG_LIBS $LCMS_LIBS $TIFF_LIBS $FREETYPE_LIBS $JPEG_LIBS $GS_LIBS $LQR_LIBS $PNG_LIBS $AUTOTRACE_LIBS $DJVU_LIBS $FFTW_LIBS $FPX_LIBS $FONTCONFIG_LIBS $WEBP_LIBS $WMF_LIBS $DPS_LIBS $XEXT_LIBS $XT_LIBS $IPC_LIBS $X11_LIBS $LZMA_LIBS $BZLIB_LIBS $OPENEXR_LIBS $LIBOPENJP2_LIB $PANGO_LIBS $RSVG_LIBS $XML_LIBS $GVC_LIBS $ZLIB_LIBS $GDI32_LIBS $MATH_LIBS $GOMP_LIBS $CL_LIBS $UMEM_LIBS $JEMALLOC_LIBS $THREAD_LIBS\"",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b243bf0bc3336dcbcbfaa91f25d228b1671a81c3",
      "candidate_info": {
        "commit_hash": "b243bf0bc3336dcbcbfaa91f25d228b1671a81c3",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/b243bf0bc3336dcbcbfaa91f25d228b1671a81c3",
        "files": [
          "MagickCore/version.h",
          "Makefile.in",
          "configure"
        ],
        "message": "",
        "before_after_code_files": [
          "MagickCore/version.h||MagickCore/version.h",
          "Makefile.in||Makefile.in"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "MagickCore/version.h||MagickCore/version.h"
          ],
          "candidate": [
            "MagickCore/version.h||MagickCore/version.h"
          ]
        }
      },
      "candidate_diff": {
        "MagickCore/version.h||MagickCore/version.h": [
          "File: MagickCore/version.h -> MagickCore/version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: #define MagickPackageName \"ImageMagick\"",
          "29: #define MagickCopyright  \"Copyright (C) 1999-2014 ImageMagick Studio LLC\"",
          "31: #define MagickLibVersion  0x700",
          "32: #define MagickLibVersionText  \"7.0.0\"",
          "33: #define MagickLibVersionNumber  1,0,0",
          "",
          "[Removed Lines]",
          "30: #define MagickSVNRevision  \"16171M\"",
          "",
          "[Added Lines]",
          "30: #define MagickSVNRevision  \"16207:16231M\"",
          "",
          "---------------"
        ],
        "Makefile.in||Makefile.in": [
          "File: Makefile.in -> Makefile.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "2998: MOSTLYCLEANFILES =",
          "2999: M4_EXTRA_DIST = \\",
          "3000:  ac_func_fseeko.m4  \\",
          "3002:  ax_c___attribute__.m4  \\",
          "3003:  ax_cflags_warn_all.m4  \\",
          "3004:  ax_compare_version.m4  \\",
          "",
          "[Removed Lines]",
          "3001:  ax_append_flag.m4 \\",
          "",
          "[Added Lines]",
          "3001:  ax_append_flag.m4  \\",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3010:  ax_prefix_config_h.m4  \\",
          "3011:  ax_prog_perl_version.m4  \\",
          "3012:  ax_pthread.m4  \\",
          "3014:  cxx_have_lstring.m4  \\",
          "3015:  cxx_have_std_libs.m4  \\",
          "3016:  framework.m4  \\",
          "",
          "[Removed Lines]",
          "3013:  ax_require_defined.m4 \\",
          "",
          "[Added Lines]",
          "3013:  ax_require_defined.m4  \\",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "17f8c7215fff88fc1362e9d98f4ccdffb6a74950",
      "candidate_info": {
        "commit_hash": "17f8c7215fff88fc1362e9d98f4ccdffb6a74950",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/17f8c7215fff88fc1362e9d98f4ccdffb6a74950",
        "files": [
          ".travis.yml",
          "ChangeLog",
          "MagickCore/annotate.c",
          "MagickCore/draw.c",
          "MagickCore/draw.h",
          "MagickCore/option.c",
          "MagickWand/mogrify.c",
          "MagickWand/operation.c",
          "Makefile.in",
          "config/config.h.in",
          "configure",
          "configure.ac"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/pull/88",
        "before_after_code_files": [
          "MagickCore/annotate.c||MagickCore/annotate.c",
          "MagickCore/draw.c||MagickCore/draw.c",
          "MagickCore/draw.h||MagickCore/draw.h",
          "MagickCore/option.c||MagickCore/option.c",
          "MagickWand/mogrify.c||MagickWand/mogrify.c",
          "MagickWand/operation.c||MagickWand/operation.c",
          "Makefile.in||Makefile.in",
          "config/config.h.in||config/config.h.in",
          "configure.ac||configure.ac"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "configure.ac||configure.ac"
          ],
          "candidate": [
            "configure.ac||configure.ac"
          ]
        }
      },
      "candidate_diff": {
        "MagickCore/annotate.c||MagickCore/annotate.c": [
          "File: MagickCore/annotate.c -> MagickCore/annotate.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "72: #include \"MagickCore/resource_.h\"",
          "73: #include \"MagickCore/semaphore.h\"",
          "74: #include \"MagickCore/statistic.h\"",
          "75: #include \"MagickCore/string_.h\"",
          "76: #include \"MagickCore/token-private.h\"",
          "77: #include \"MagickCore/transform.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "75: #include \"MagickCore/string_.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "105: #else",
          "106: #  include <freetype/ftbbox.h>",
          "109: #if defined(MAGICKCORE_CTL_DELEGATE)",
          "110: #include <raqm.h>",
          "112: typedef struct _raqm_glyph_info_t",
          "113: {",
          "114:   int",
          "",
          "[Removed Lines]",
          "108: #endif",
          "111: #else",
          "",
          "[Added Lines]",
          "109: #endif",
          "112: #else",
          "113: typedef enum",
          "114: {",
          "115:   RAQM_DIRECTION_DEFAULT,",
          "116:   RAQM_DIRECTION_RTL,",
          "117:   RAQM_DIRECTION_LTR,",
          "118:   RAQM_DIRECTION_TTB",
          "119: } raqm_direction_t;",
          "120: #endif",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "118:     y_offset;",
          "120:   unsigned int",
          "122: } raqm_glyph_info_t;",
          "134:   Annotate semaphores.",
          "",
          "[Removed Lines]",
          "121:     cluster;",
          "124: typedef enum",
          "125: {",
          "126:   RAQM_DIRECTION_DEFAULT,",
          "127:   RAQM_DIRECTION_RTL,",
          "128:   RAQM_DIRECTION_LTR",
          "129: } raqm_direction_t;",
          "130: #endif",
          "",
          "[Added Lines]",
          "131:     cluster;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1026: %",
          "1027: %    o encoding: the font encoding.",
          "1028: %",
          "1031: %    o metrics: bounding box of text.",
          "1034: %",
          "",
          "[Removed Lines]",
          "1029: %    o offset: (x,y) location of text relative to image.",
          "1030: %",
          "1032: %",
          "1033: %    o exception: return any errors or warnings in this structure.",
          "",
          "[Added Lines]",
          "1031: %",
          "1032: %    o metrics: bounding box of text.",
          "1034: %    o exception: return any errors or warnings in this structure.",
          "1035: %",
          "1038: #if defined(MAGICKCORE_FREETYPE_DELEGATE)",
          "1040: static size_t ComplexTextLayout(const char *text,const size_t length,",
          "1041:   const FT_Face face,const raqm_direction_t direction,const char *features,",
          "1042:   const FT_Int32 flags,GraphemeInfo **grapheme)",
          "1043: {",
          "1044: #if defined(MAGICKCORE_RAQM_DELEGATE)",
          "1045:   int",
          "1046:     i;",
          "1048:   size_t",
          "1049:     count;",
          "1051:   raqm_t",
          "1054:   raqm_glyph_t",
          "1057:   count = 0;",
          "1058:   rq = raqm_create();",
          "1059:   if (rq == (raqm_t *) NULL)",
          "1060:     goto cleanup;",
          "1062:   if (!raqm_set_text_utf8(rq,text,length))",
          "1063:     goto cleanup;",
          "1065:   if (!raqm_set_par_direction(rq,direction))",
          "1066:     goto cleanup;",
          "1068:   if (!raqm_set_freetype_face(rq,face))",
          "1069:     goto cleanup;",
          "1071:   if (features)",
          "1072:     {",
          "1073:       char",
          "1074:         breaker,",
          "1075:         quote,",
          "1078:       TokenInfo",
          "1081:       int",
          "1082:         next,",
          "1083:         status_token;",
          "1085:       next=0;",
          "1086:       token_info=AcquireTokenInfo();",
          "1087:       token=(char *) AcquireQuantumMemory(50,sizeof(*token));",
          "1088:       status_token = Tokenizer(token_info,0,token,50,features,",
          "1089:                                \"\",\",\",\"\",'\\0',&breaker,&next,&quote);",
          "1090:       while (status_token == 0)",
          "1091:         {",
          "1092:           raqm_add_font_feature(rq, token, strlen(token));",
          "1093:           status_token = Tokenizer(token_info,0,token,50,features,",
          "1094:                                    \"\",\",\",\"\",'\\0',&breaker,&next,&quote);",
          "1095:         }",
          "1096:       token_info=DestroyTokenInfo(token_info);",
          "1097:       token=DestroyString(token);",
          "1098:     }",
          "1100:   if (!raqm_layout(rq))",
          "1101:     goto cleanup;",
          "1103:   glyphs = raqm_get_glyphs(rq,&count);",
          "1104:   if (glyphs == (raqm_glyph_t *) NULL)",
          "1105:     {",
          "1106:       count = 0;",
          "1107:       goto cleanup;",
          "1108:     }",
          "1111:   if (*grapheme == (GraphemeInfo *) NULL)",
          "1112:     {",
          "1113:       count = 0;",
          "1114:       goto cleanup;",
          "1115:     }",
          "1117:   for (i = 0; i < count; i++)",
          "1118:     {",
          "1119:       (*grapheme)[i].index = glyphs[i].index;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1044:   return(raqm_shape(text,length,face,direction,&grapheme));",
          "1045: #else",
          "1046:   FT_Error",
          "1047:     ft_status;",
          "1050:     i;",
          "1052:   ssize_t",
          "",
          "[Removed Lines]",
          "1049:   register ssize_t",
          "",
          "[Added Lines]",
          "1135:     i;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1202:   FT_Matrix",
          "1203:     affine;",
          "1205:   FT_Open_Args",
          "1206:     args;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1290:   FT_Open_Args",
          "1291:     args;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1211:   GlyphInfo",
          "1212:     glyph,",
          "1213:     last_glyph;",
          "1218:   PointInfo",
          "1219:     point,",
          "",
          "[Removed Lines]",
          "1215:   MagickBooleanType",
          "1216:     status;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1436:     p=draw_info->text;",
          "1437:   else",
          "1438:     {",
          "1441:         p=(char *) utf8;",
          "1442:     }",
          "1443:   status=MagickTrue;",
          "",
          "[Removed Lines]",
          "1439:       utf8=ConvertLatin1ToUTF8((unsigned char *) draw_info->text);",
          "1440:       if (utf8 != (unsigned char *) NULL)",
          "",
          "[Added Lines]",
          "1525:       if (utf8 != (unsigned char *) NULL)",
          "1526:         p=(char *) utf8;",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1616:       metrics->width=bitmap->left+bitmap->bitmap.width;",
          "1617:     if ((fabs(draw_info->interword_spacing) >= MagickEpsilon) &&",
          "1618:         (IsUTFSpace(GetUTFCode(p+grapheme[i].cluster)) != MagickFalse) &&",
          "1621:     else",
          "1622:       origin.x+=(FT_Pos) grapheme[i].x_advance;",
          "1623:     metrics->origin.x=(double) origin.x;",
          "",
          "[Removed Lines]",
          "1619:         (IsUTFSpace(code) == MagickFalse))",
          "1620:       origin.x+=(FT_Pos) (64.0*draw_info->interword_spacing);",
          "",
          "[Added Lines]",
          "1705:       origin.x+=(FT_Pos) (64.0*draw_info->interword_spacing);",
          "1706:     else",
          "",
          "---------------"
        ],
        "MagickCore/draw.c||MagickCore/draw.c": [
          "File: MagickCore/draw.c -> MagickCore/draw.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "282:   clone_info->linejoin=draw_info->linejoin;",
          "283:   clone_info->miterlimit=draw_info->miterlimit;",
          "284:   clone_info->dash_offset=draw_info->dash_offset;",
          "285:   clone_info->decorate=draw_info->decorate;",
          "286:   clone_info->compose=draw_info->compose;",
          "287:   if (draw_info->text != (char *) NULL)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "285:   clone_info->decorate=draw_info->decorate;",
          "286:   clone_info->compose=draw_info->compose;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "836:   if (draw_info->primitive != (char *) NULL)",
          "837:     draw_info->primitive=DestroyString(draw_info->primitive);",
          "838:   if (draw_info->text != (char *) NULL)",
          "839:     draw_info->text=DestroyString(draw_info->text);",
          "840:   if (draw_info->geometry != (char *) NULL)",
          "841:     draw_info->geometry=DestroyString(draw_info->geometry);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "841:     draw_info->text=DestroyString(draw_info->text);",
          "842:   if (draw_info->geometry != (char *) NULL)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2064:             else",
          "2065:               graphic_context[n]->fill_rule=(FillRule) fill_rule;",
          "2066:             break;",
          "2067:           }",
          "2068:         if (LocaleCompare(\"font\",keyword) == 0)",
          "2069:           {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2071:           }",
          "2072:         if (LocaleCompare(\"font\",keyword) == 0)",
          "2073:           {",
          "2074:             GetMagickToken(q,&q,token);",
          "2075:             (void) CloneString(&graphic_context[n]->font,token);",
          "2076:             if (LocaleCompare(\"none\",token) == 0)",
          "2077:               graphic_context[n]->font=(char *)",
          "2078:                 RelinquishMagickMemory(graphic_context[n]->font);",
          "2079:             break;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "4864:   (void) LogMagickEvent(TraceEvent,GetMagickModule(),\"...\");",
          "4865:   assert(draw_info != (DrawInfo *) NULL);",
          "4866:   (void) ResetMagickMemory(draw_info,0,sizeof(*draw_info));",
          "4867:   clone_info=CloneImageInfo(image_info);",
          "4868:   GetAffineMatrix(&draw_info->affine);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4879:   (void) ResetMagickMemory(draw_info,0,sizeof(*draw_info));",
          "4880:   clone_info=CloneImageInfo(image_info);",
          "4881:   GetAffineMatrix(&draw_info->affine);",
          "",
          "---------------"
        ],
        "MagickCore/draw.h||MagickCore/draw.h": [
          "File: MagickCore/draw.h -> MagickCore/draw.h"
        ],
        "MagickCore/option.c||MagickCore/option.c": [
          "File: MagickCore/option.c -> MagickCore/option.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "475:     { \"+floodfill\", 2L, SimpleOperatorFlag, MagickFalse },",
          "476:     { \"+flop\", 0L, DeprecateOptionFlag, MagickTrue },",
          "477:     { \"-flop\", 0L, SimpleOperatorFlag, MagickFalse },",
          "478:     { \"+font\", 0L, ImageInfoOptionFlag | DrawInfoOptionFlag, MagickFalse },",
          "479:     { \"-font\", 1L, ImageInfoOptionFlag | DrawInfoOptionFlag, MagickFalse },",
          "480:     { \"+foreground\", 0L, NonMagickOptionFlag, MagickFalse },",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "478:     { \"+font\", 0L, ImageInfoOptionFlag | DrawInfoOptionFlag, MagickFalse },",
          "479:     { \"-font\", 1L, ImageInfoOptionFlag | DrawInfoOptionFlag, MagickFalse },",
          "",
          "---------------"
        ],
        "MagickWand/mogrify.c||MagickWand/mogrify.c": [
          "File: MagickWand/mogrify.c -> MagickWand/mogrify.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1645:               {",
          "1646:                 if (draw_info->font != (char *) NULL)",
          "1647:                   draw_info->font=DestroyString(draw_info->font);",
          "1648:                 break;",
          "1649:               }",
          "1650:             (void) CloneString(&draw_info->font,argv[i+1]);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1648:                 break;",
          "1649:               }",
          "1650:             (void) CloneString(&draw_info->font,argv[i+1]);",
          "1651:             break;",
          "1652:           }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4870:           {",
          "4871:             (void) CopyMagickString(argv[i]+1,\"sans\",MagickPathExtent);",
          "4872:             (void) CloneString(&format,(char *) NULL);",
          "4874:               break;",
          "4875:             i++;",
          "4876:             if (i == (ssize_t) argc)",
          "",
          "[Removed Lines]",
          "4873:             if (*option == '+')",
          "",
          "[Added Lines]",
          "4878:             if (*option == '+')",
          "4879:               break;",
          "",
          "---------------"
        ],
        "MagickWand/operation.c||MagickWand/operation.c": [
          "File: MagickWand/operation.c -> MagickWand/operation.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "885:           break;",
          "886:         }",
          "887:       if (LocaleCompare(\"font\",option+1) == 0)",
          "888:         {",
          "889:           (void) CloneString(&_draw_info->font,ArgOption(NULL));",
          "890:           (void) CloneString(&_image_info->font,_draw_info->font);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "888:         {",
          "889:           (void) CloneString(&_draw_info->font,ArgOption(NULL));",
          "890:           (void) CloneString(&_image_info->font,_draw_info->font);",
          "891:           break;",
          "892:         }",
          "",
          "---------------"
        ],
        "Makefile.in||Makefile.in": [
          "File: Makefile.in -> Makefile.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "2834: PrintDelegate = @PrintDelegate@",
          "2835: QUANTUM_DEPTH = @QUANTUM_DEPTH@",
          "2836: RANLIB = @RANLIB@",
          "2837: RLEEncodeDelegate = @RLEEncodeDelegate@",
          "2838: RMDelegate = @RMDelegate@",
          "2839: RPM = @RPM@",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2837: RAQM_CFLAGS = @RAQM_CFLAGS@",
          "2838: RAQM_LIBS = @RAQM_LIBS@",
          "",
          "---------------"
        ],
        "config/config.h.in||config/config.h.in": [
          "File: config/config.h.in -> config/config.h.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "827: #undef QUANTUM_DEPTH_OBSOLETE_IN_H",
          "830: #undef RETSIGTYPE",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "830: #undef RAQM_DELEGATE",
          "",
          "---------------"
        ],
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "1386: GOMP_LIBS=''",
          "1387: if test \"$enable_openmp\" != 'no'; then",
          "1388:   if test \"${GCC}\" = \"yes\"; then",
          "1395:     # Open64 (passes for GCC but uses different OpenMP implementation)",
          "1396:     if test \"x$GOMP_LIBS\" = x ; then",
          "1397:       if $CC --version 2>&1 | grep Open64 > /dev/null ; then",
          "",
          "[Removed Lines]",
          "1389:     # Clang 3.8 and later defaults to the LLVM OpenMP implementation",
          "1390:     if test \"x$GOMP_LIBS\" = x ; then",
          "1391:       if $CC --version 2>&1 | grep clang > /dev/null ; then",
          "1392:         AC_CHECK_LIB(omp,omp_get_num_procs,GOMP_LIBS=\"-lomp\",,)",
          "1393:       fi",
          "1394:     fi",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2027: dnl ===========================================================================",
          "2029: #",
          "2030: # Check for Ghostscript library or framework.",
          "2031: #",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2023: #",
          "2024: # Check for the raqm delegate library.",
          "2025: #",
          "2026: AC_ARG_WITH([raqm],",
          "2027:     [AC_HELP_STRING([--without-raqm],",
          "2028:                     [disable Raqm support])],",
          "2029:     [with_raqm=$withval],",
          "2030:     [with_raqm='yes'])",
          "2032: if test \"$with_raqm\" != 'yes'; then",
          "2033:     DISTCHECK_CONFIG_FLAGS=\"${DISTCHECK_CONFIG_FLAGS} --with-raqm=$with_raqm \"",
          "2034: fi",
          "2036: have_raqm='no'",
          "2037: RAQM_CFLAGS=\"\"",
          "2038: RAQM_LIBS=\"\"",
          "2039: RAQM_PKG=\"\"",
          "2040: if test \"x$with_raqm\" = \"xyes\"; then",
          "2041:   AC_MSG_RESULT([-------------------------------------------------------------])",
          "2042:   PKG_CHECK_MODULES(RAQM,[raqm], have_raqm=yes, have_raqm=no)",
          "2043:   AC_MSG_RESULT([])",
          "2044: fi",
          "2046: if test \"$have_raqm\" = 'yes'; then",
          "2047:   AC_DEFINE(RAQM_DELEGATE,1,Define if you have RAQM library)",
          "2048:   CFLAGS=\"$RAQM_CFLAGS $CFLAGS\"",
          "2049: fi",
          "2051: AM_CONDITIONAL(RAQM_DELEGATE, test \"$have_raqm\" = 'yes')",
          "2052: AC_SUBST(RAQM_CFLAGS)",
          "2053: AC_SUBST(RAQM_LIBS)",
          "2055: dnl ===========================================================================",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3594: if test \"$have_freetype\"    = 'yes' ; then",
          "3595:    MAGICK_DELEGATES=\"$MAGICK_DELEGATES freetype\"",
          "3596: fi",
          "3597: if test \"$have_gslib\"    = 'yes' ; then",
          "3598:    MAGICK_DELEGATES=\"$MAGICK_DELEGATES gslib\"",
          "3599: fi",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3625: if test \"$have_raqm\"    = 'yes' ; then",
          "3626:    MAGICK_DELEGATES=\"$MAGICK_DELEGATES raqm\"",
          "3627: fi",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3712: #",
          "3714: if test \"$build_modules\" != 'no'; then",
          "3716: else",
          "3718: fi",
          "3719: AC_SUBST(MAGICK_DEP_LIBS)",
          "",
          "[Removed Lines]",
          "3715:     MAGICK_DEP_LIBS=\"$USER_LIBS $LCMS_LIBS $FREETYPE_LIBS $LQR_LIBS $FFTW_LIBS $FONTCONFIG_LIBS $XEXT_LIBS $IPC_LIBS $X11_LIBS $XT_LIBS $LZMA_LIBS $BZLIB_LIBS $ZLIB_LIBS $LTDL_LIBS $GDI32_LIBS $MATH_LIBS $GOMP_LIBS $CL_LIBS $UMEM_LIBS $JEMALLOC_LIBS $THREAD_LIBS\"",
          "3717:     MAGICK_DEP_LIBS=\"$USER_LIBS $JBIG_LIBS $LCMS_LIBS $TIFF_LIBS $FREETYPE_LIBS $JPEG_LIBS $GS_LIBS $LQR_LIBS $PNG_LIBS $AUTOTRACE_LIBS $DJVU_LIBS $FFTW_LIBS $FPX_LIBS $FONTCONFIG_LIBS $WEBP_LIBS $WMF_LIBS $DPS_LIBS $XEXT_LIBS $XT_LIBS $IPC_LIBS $X11_LIBS $LZMA_LIBS $BZLIB_LIBS $OPENEXR_LIBS $LIBOPENJP2_LIBS $PANGO_LIBS $RSVG_LIBS $XML_LIBS $GVC_LIBS $ZLIB_LIBS $GDI32_LIBS $MATH_LIBS $GOMP_LIBS $CL_LIBS $UMEM_LIBS $JEMALLOC_LIBS $THREAD_LIBS\"",
          "",
          "[Added Lines]",
          "3746:     MAGICK_DEP_LIBS=\"$USER_LIBS $LCMS_LIBS $FREETYPE_LIBS $RAQM_LIBS $LQR_LIBS $FFTW_LIBS $FONTCONFIG_LIBS $XEXT_LIBS $IPC_LIBS $X11_LIBS $XT_LIBS $LZMA_LIBS $BZLIB_LIBS $ZLIB_LIBS $LTDL_LIBS $GDI32_LIBS $MATH_LIBS $GOMP_LIBS $CL_LIBS $UMEM_LIBS $JEMALLOC_LIBS $THREAD_LIBS\"",
          "3748:     MAGICK_DEP_LIBS=\"$USER_LIBS $JBIG_LIBS $LCMS_LIBS $TIFF_LIBS $FREETYPE_LIBS $RAQM_LIBS $JPEG_LIBS $GS_LIBS $LQR_LIBS $PNG_LIBS $AUTOTRACE_LIBS $DJVU_LIBS $FFTW_LIBS $FPX_LIBS $FONTCONFIG_LIBS $WEBP_LIBS $WMF_LIBS $DPS_LIBS $XEXT_LIBS $XT_LIBS $IPC_LIBS $X11_LIBS $LZMA_LIBS $BZLIB_LIBS $OPENEXR_LIBS $LIBOPENJP2_LIBS $PANGO_LIBS $RSVG_LIBS $XML_LIBS $GVC_LIBS $ZLIB_LIBS $GDI32_LIBS $MATH_LIBS $GOMP_LIBS $CL_LIBS $UMEM_LIBS $JEMALLOC_LIBS $THREAD_LIBS\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3851:   FlashPIX          --with-fpx=$with_fpx  $have_fpx",
          "3852:   FontConfig        --with-fontconfig=$with_fontconfig $have_fontconfig",
          "3853:   FreeType          --with-freetype=$with_freetype  $have_freetype",
          "3854:   Ghostscript lib   --with-gslib=$with_gslib  $have_gslib",
          "3855:   Graphviz          --with-gvc=$with_gvc  $have_gvc",
          "3856:   JBIG              --with-jbig=$with_jbig  $have_jbig",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3885:   Raqm              --with-raqm=$with_raqm  $have_raqm",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9416a7255c6054406839d190217c07845974a756",
      "candidate_info": {
        "commit_hash": "9416a7255c6054406839d190217c07845974a756",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/9416a7255c6054406839d190217c07845974a756",
        "files": [
          "MagickCore/version.h",
          "configure"
        ],
        "message": "",
        "before_after_code_files": [
          "MagickCore/version.h||MagickCore/version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "MagickCore/version.h||MagickCore/version.h"
          ],
          "candidate": [
            "MagickCore/version.h||MagickCore/version.h"
          ]
        }
      },
      "candidate_diff": {
        "MagickCore/version.h||MagickCore/version.h": [
          "File: MagickCore/version.h -> MagickCore/version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: #define MagickPackageName \"ImageMagick\"",
          "29: #define MagickCopyright  \"Copyright (C) 1999-2014 ImageMagick Studio LLC\"",
          "31: #define MagickLibVersion  0x700",
          "32: #define MagickLibVersionText  \"7.0.0\"",
          "33: #define MagickLibVersionNumber  1,0,0",
          "",
          "[Removed Lines]",
          "30: #define MagickSVNRevision  \"15896M\"",
          "",
          "[Added Lines]",
          "30: #define MagickSVNRevision  \"15957:15959\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "48: #define MagickppLibAddendum  \"-0\"",
          "49: #define MagickppLibInterface  1",
          "50: #define MagickppLibMinInterface  1",
          "52: #define MagickChangeDate   \"20120427\"",
          "53: #define MagickAuthoritativeURL  \"http://www.imagemagick.org\"",
          "54: #define MagickFeatures \"DPC HDRI OpenMP\"",
          "",
          "[Removed Lines]",
          "51: #define MagickReleaseDate  \"2014-05-27\"",
          "",
          "[Added Lines]",
          "51: #define MagickReleaseDate  \"2014-06-07\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}