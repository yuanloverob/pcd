{
  "cve_id": "CVE-2016-7052",
  "cve_desc": "crypto/x509/x509_vfy.c in OpenSSL 1.0.2i allows remote attackers to cause a denial of service (NULL pointer dereference and application crash) by triggering a CRL operation.",
  "repo": "openssl/openssl",
  "patch_hash": "8b7c51a0e4a03895a657cf2eb8d5c2aa1ca3586f",
  "patch_info": {
    "commit_hash": "8b7c51a0e4a03895a657cf2eb8d5c2aa1ca3586f",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/8b7c51a0e4a03895a657cf2eb8d5c2aa1ca3586f",
    "files": [
      "crypto/x509/x509_vfy.c"
    ],
    "message": "Add some sanity checks when checking CRL scores\n\nReviewed-by: Tim Hudson <tjh@openssl.org>",
    "before_after_code_files": [
      "crypto/x509/x509_vfy.c||crypto/x509/x509_vfy.c"
    ]
  },
  "patch_diff": {
    "crypto/x509/x509_vfy.c||crypto/x509/x509_vfy.c": [
      "File: crypto/x509/x509_vfy.c -> crypto/x509/x509_vfy.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "974:         crl = sk_X509_CRL_value(crls, i);",
      "975:         reasons = *preasons;",
      "976:         crl_score = get_crl_score(ctx, &crl_issuer, &reasons, crl, x);",
      "978:             continue;",
      "981:             int day, sec;",
      "982:             if (ASN1_TIME_diff(&day, &sec, X509_CRL_get0_lastUpdate(best_crl),",
      "983:                                X509_CRL_get0_lastUpdate(crl)) == 0)",
      "",
      "[Removed Lines]",
      "977:         if (crl_score < best_score)",
      "980:         if (crl_score == best_score) {",
      "",
      "[Added Lines]",
      "977:         if (crl_score < best_score || crl_score == 0)",
      "980:         if (crl_score == best_score && best_crl != NULL) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "626aa24849be549b7ef4f049d8427989940c8a37",
      "candidate_info": {
        "commit_hash": "626aa24849be549b7ef4f049d8427989940c8a37",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/626aa24849be549b7ef4f049d8427989940c8a37",
        "files": [
          "crypto/x509/x509_vfy.c"
        ],
        "message": "Use newest CRL.\n\nIf two CRLs are equivalent then use the one with a later lastUpdate field:\nthis will result in the newest CRL available being used.\n\nRT#4615\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
        "before_after_code_files": [
          "crypto/x509/x509_vfy.c||crypto/x509/x509_vfy.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "crypto/x509/x509_vfy.c||crypto/x509/x509_vfy.c"
          ],
          "candidate": [
            "crypto/x509/x509_vfy.c||crypto/x509/x509_vfy.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/x509/x509_vfy.c||crypto/x509/x509_vfy.c": [
          "File: crypto/x509/x509_vfy.c -> crypto/x509/x509_vfy.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "971:         crl = sk_X509_CRL_value(crls, i);",
          "972:         reasons = *preasons;",
          "973:         crl_score = get_crl_score(ctx, &crl_issuer, &reasons, crl, x);",
          "980:         }",
          "981:     }",
          "983:     if (best_crl) {",
          "",
          "[Removed Lines]",
          "975:         if (crl_score > best_score) {",
          "976:             best_crl = crl;",
          "977:             best_crl_issuer = crl_issuer;",
          "978:             best_score = crl_score;",
          "979:             best_reasons = reasons;",
          "",
          "[Added Lines]",
          "974:         if (crl_score < best_score)",
          "975:             continue;",
          "977:         if (crl_score == best_score) {",
          "978:             int day, sec;",
          "979:             if (ASN1_TIME_diff(&day, &sec, X509_CRL_get_lastUpdate(best_crl),",
          "980:                                X509_CRL_get_lastUpdate(crl)) == 0)",
          "981:                 continue;",
          "982:             if (day < 0 || sec <= 0)",
          "983:                 continue;",
          "985:         best_crl = crl;",
          "986:         best_crl_issuer = crl_issuer;",
          "987:         best_score = crl_score;",
          "988:         best_reasons = reasons;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6e629b5be45face20b4ca71c4fcbfed78b864a2e",
      "candidate_info": {
        "commit_hash": "6e629b5be45face20b4ca71c4fcbfed78b864a2e",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/6e629b5be45face20b4ca71c4fcbfed78b864a2e",
        "files": [
          "crypto/x509/x509_vfy.c"
        ],
        "message": "Add some sanity checks when checking CRL scores\n\nNote: this was accidentally omitted from OpenSSL 1.0.2 branch.\nWithout this fix any attempt to use CRLs will crash.\n\nCVE-2016-7052\n\nThanks to Bruce Stephens and Thomas Jakobi for reporting this issue.\n\nReviewed-by: Stephen Henson <steve@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>",
        "before_after_code_files": [
          "crypto/x509/x509_vfy.c||crypto/x509/x509_vfy.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crypto/x509/x509_vfy.c||crypto/x509/x509_vfy.c"
          ],
          "candidate": [
            "crypto/x509/x509_vfy.c||crypto/x509/x509_vfy.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/x509/x509_vfy.c||crypto/x509/x509_vfy.c": [
          "File: crypto/x509/x509_vfy.c -> crypto/x509/x509_vfy.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1124:         crl = sk_X509_CRL_value(crls, i);",
          "1125:         reasons = *preasons;",
          "1126:         crl_score = get_crl_score(ctx, &crl_issuer, &reasons, crl, x);",
          "1128:             continue;",
          "1131:             int day, sec;",
          "1132:             if (ASN1_TIME_diff(&day, &sec, X509_CRL_get_lastUpdate(best_crl),",
          "1133:                                X509_CRL_get_lastUpdate(crl)) == 0)",
          "",
          "[Removed Lines]",
          "1127:         if (crl_score < best_score)",
          "1130:         if (crl_score == best_score) {",
          "",
          "[Added Lines]",
          "1127:         if (crl_score < best_score || crl_score == 0)",
          "1130:         if (crl_score == best_score && best_crl != NULL) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}