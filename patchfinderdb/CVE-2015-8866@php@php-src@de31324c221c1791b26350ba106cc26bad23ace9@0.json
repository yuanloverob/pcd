{
  "cve_id": "CVE-2015-8866",
  "cve_desc": "ext/libxml/libxml.c in PHP before 5.5.22 and 5.6.x before 5.6.6, when PHP-FPM is used, does not isolate each thread from libxml_disable_entity_loader changes in other threads, which allows remote attackers to conduct XML External Entity (XXE) and XML Entity Expansion (XEE) attacks via a crafted XML document, a related issue to CVE-2015-5161.",
  "repo": "php/php-src",
  "patch_hash": "de31324c221c1791b26350ba106cc26bad23ace9",
  "patch_info": {
    "commit_hash": "de31324c221c1791b26350ba106cc26bad23ace9",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/de31324c221c1791b26350ba106cc26bad23ace9",
    "files": [
      "NEWS",
      "ext/libxml/libxml.c"
    ],
    "message": "Fix bug #64938: libxml_disable_entity_loader setting is shared between threads\n\nThe availability of entity loading is stored in a module global which\npreviously was only initialized in the GINIT constructor. This had the\neffect that disabling the entity loader in one request caused\nsubsequent requests hitting the same Apache child process to  also have\nthe loader disabled.\n\nWith this change the loader is explicitely enabled in the request init\nphase.",
    "before_after_code_files": [
      "ext/libxml/libxml.c||ext/libxml/libxml.c"
    ]
  },
  "patch_diff": {
    "ext/libxml/libxml.c||ext/libxml/libxml.c": [
      "File: ext/libxml/libxml.c -> ext/libxml/libxml.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "857:   xmlSetGenericErrorFunc(NULL, php_libxml_error_handler);",
      "858:   xmlParserInputBufferCreateFilenameDefault(php_libxml_input_buffer_create_filename);",
      "859:   xmlOutputBufferCreateFilenameDefault(php_libxml_output_buffer_create_filename);",
      "860:  }",
      "861:  return SUCCESS;",
      "862: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "865:   LIBXML(entity_loader_disabled) = 0;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c1eb87ab1a2e2df1868b70cd7b8016c6147092c5",
      "candidate_info": {
        "commit_hash": "c1eb87ab1a2e2df1868b70cd7b8016c6147092c5",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/c1eb87ab1a2e2df1868b70cd7b8016c6147092c5",
        "files": [
          "ext/libxml/libxml.c"
        ],
        "message": "Fix bug #64938: libxml_disable_entity_loader setting is shared between threads\n\nThe availability of entity loading is stored in a module global which\npreviously was only initialized in the GINIT constructor. This had the\neffect that disabling the entity loader in one request caused\nsubsequent requests hitting the same Apache child process to  also have\nthe loader disabled.\n\nWith this change the loader is explicitely enabled in the request init\nphase.",
        "before_after_code_files": [
          "ext/libxml/libxml.c||ext/libxml/libxml.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "ext/libxml/libxml.c||ext/libxml/libxml.c"
          ],
          "candidate": [
            "ext/libxml/libxml.c||ext/libxml/libxml.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/libxml/libxml.c||ext/libxml/libxml.c": [
          "File: ext/libxml/libxml.c -> ext/libxml/libxml.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "860:   xmlSetGenericErrorFunc(NULL, php_libxml_error_handler);",
          "861:   xmlParserInputBufferCreateFilenameDefault(php_libxml_input_buffer_create_filename);",
          "862:   xmlOutputBufferCreateFilenameDefault(php_libxml_output_buffer_create_filename);",
          "863:  }",
          "864:  return SUCCESS;",
          "865: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "868:   LIBXML(entity_loader_disabled) = 0;",
          "",
          "---------------"
        ]
      }
    }
  ]
}