{
  "cve_id": "CVE-2019-5717",
  "cve_desc": "In Wireshark 2.6.0 to 2.6.5 and 2.4.0 to 2.4.11, the P_MUL dissector could crash. This was addressed in epan/dissectors/packet-p_mul.c by rejecting the invalid sequence number of zero.",
  "repo": "wireshark/wireshark",
  "patch_hash": "3cccd4ec5b922e79afd134db4f0c9acb10bf7202",
  "patch_info": {
    "commit_hash": "3cccd4ec5b922e79afd134db4f0c9acb10bf7202",
    "repo": "wireshark/wireshark",
    "commit_url": "https://github.com/wireshark/wireshark/commit/3cccd4ec5b922e79afd134db4f0c9acb10bf7202",
    "files": [
      "epan/dissectors/packet-p_mul.c"
    ],
    "message": "p_mul: Detect Data PDU sequence number 0\n\nData PDU sequence number 0 is illegal, add an expert info for this.\nDon't include this packet in SEQ/ACK analysis.\n\nBug: 15337\nChange-Id: I476088531e8a3605393ee1dedf1e8b159dac342b\nReviewed-on: https://code.wireshark.org/review/30980\nPetri-Dish: Stig Bj\u00f8rlykke <stig@bjorlykke.org>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>",
    "before_after_code_files": [
      "epan/dissectors/packet-p_mul.c||epan/dissectors/packet-p_mul.c"
    ]
  },
  "patch_diff": {
    "epan/dissectors/packet-p_mul.c||epan/dissectors/packet-p_mul.c": [
      "File: epan/dissectors/packet-p_mul.c -> epan/dissectors/packet-p_mul.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "152: static expert_field ei_more_data = EI_INIT;",
      "153: static expert_field ei_checksum_bad = EI_INIT;",
      "154: static expert_field ei_tot_miss_seq_no = EI_INIT;",
      "155: static expert_field ei_miss_seq_no = EI_INIT;",
      "156: static expert_field ei_analysis_ack_missing = EI_INIT;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "154: static expert_field ei_illegal_seq_no = EI_INIT;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "356:     return NULL;",
      "357:   }",
      "359:   nstime_set_zero(&addr_time);",
      "360:   nstime_set_zero(&prev_time);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "360:   if (pdu_type == Data_PDU && seq_no == 0) {",
      "362:     return NULL;",
      "363:   }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "864:   case Data_PDU:",
      "866:     seq_no = tvb_get_ntohs (tvb, offset);",
      "868:     proto_item_append_text (ti, \", Seq no: %u\", seq_no);",
      "869:     break;",
      "",
      "[Removed Lines]",
      "867:     proto_tree_add_item (p_mul_tree, hf_seq_no, tvb, offset, 2, ENC_BIG_ENDIAN);",
      "",
      "[Added Lines]",
      "873:     en = proto_tree_add_item (p_mul_tree, hf_seq_no, tvb, offset, 2, ENC_BIG_ENDIAN);",
      "874:     if (seq_no == 0) {",
      "875:       expert_add_info(pinfo, en, &ei_illegal_seq_no);",
      "876:     }",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1533:       { &ei_miss_seq_range, { \"p_mul.missing_seq_range.invalid\", PI_UNDECODED, PI_WARN, \"Invalid missing sequence range\", EXPFILL }},",
      "1534:       { &ei_miss_seq_no, { \"p_mul.missing_seq_no.invalid\", PI_UNDECODED, PI_WARN, \"Invalid missing seq number\", EXPFILL }},",
      "1535:       { &ei_tot_miss_seq_no, { \"p_mul.no_missing_seq_no.expert\", PI_RESPONSE_CODE, PI_NOTE, \"Missing seq numbers\", EXPFILL }},",
      "1536:       { &ei_length, { \"p_mul.length.invalid\", PI_MALFORMED, PI_WARN, \"Incorrect length field\", EXPFILL }},",
      "1537:       { &ei_more_data, { \"p_mul.more_data\", PI_MALFORMED, PI_WARN, \"More data in packet\", EXPFILL }},",
      "1538:   };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1545:       { &ei_illegal_seq_no, { \"p_mul.seq_no.illegal\", PI_PROTOCOL, PI_WARN, \"Illegal seq number\", EXPFILL }},",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "bf9272a92f3df1e4ccfaad434e123222ae5313f7",
      "candidate_info": {
        "commit_hash": "bf9272a92f3df1e4ccfaad434e123222ae5313f7",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/bf9272a92f3df1e4ccfaad434e123222ae5313f7",
        "files": [
          "epan/dissectors/packet-p_mul.c"
        ],
        "message": "p_mul: Detect Data PDU sequence number 0\n\nData PDU sequence number 0 is illegal, add an expert info for this.\nDon't include this packet in SEQ/ACK analysis.\n\nBug: 15337\nChange-Id: I476088531e8a3605393ee1dedf1e8b159dac342b\nReviewed-on: https://code.wireshark.org/review/30980\nPetri-Dish: Stig Bj\u00f8rlykke <stig@bjorlykke.org>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>\n(cherry picked from commit 3cccd4ec5b922e79afd134db4f0c9acb10bf7202)\nReviewed-on: https://code.wireshark.org/review/30987\nReviewed-by: Stig Bj\u00f8rlykke <stig@bjorlykke.org>",
        "before_after_code_files": [
          "epan/dissectors/packet-p_mul.c||epan/dissectors/packet-p_mul.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-p_mul.c||epan/dissectors/packet-p_mul.c"
          ],
          "candidate": [
            "epan/dissectors/packet-p_mul.c||epan/dissectors/packet-p_mul.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-p_mul.c||epan/dissectors/packet-p_mul.c": [
          "File: epan/dissectors/packet-p_mul.c -> epan/dissectors/packet-p_mul.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "164: static expert_field ei_more_data = EI_INIT;",
          "165: static expert_field ei_checksum_bad = EI_INIT;",
          "166: static expert_field ei_tot_miss_seq_no = EI_INIT;",
          "167: static expert_field ei_miss_seq_no = EI_INIT;",
          "168: static expert_field ei_analysis_ack_missing = EI_INIT;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "166: static expert_field ei_illegal_seq_no = EI_INIT;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "368:     return NULL;",
          "369:   }",
          "371:   nstime_set_zero(&addr_time);",
          "372:   nstime_set_zero(&prev_time);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "372:   if (pdu_type == Data_PDU && seq_no == 0) {",
          "374:     return NULL;",
          "375:   }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "877:   case Data_PDU:",
          "879:     seq_no = tvb_get_ntohs (tvb, offset);",
          "881:     proto_item_append_text (ti, \", Seq no: %u\", seq_no);",
          "882:     break;",
          "",
          "[Removed Lines]",
          "880:     proto_tree_add_item (p_mul_tree, hf_seq_no, tvb, offset, 2, ENC_BIG_ENDIAN);",
          "",
          "[Added Lines]",
          "886:     en = proto_tree_add_item (p_mul_tree, hf_seq_no, tvb, offset, 2, ENC_BIG_ENDIAN);",
          "887:     if (seq_no == 0) {",
          "888:       expert_add_info(pinfo, en, &ei_illegal_seq_no);",
          "889:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1548:       { &ei_miss_seq_range, { \"p_mul.missing_seq_range.invalid\", PI_UNDECODED, PI_WARN, \"Invalid missing sequence range\", EXPFILL }},",
          "1549:       { &ei_miss_seq_no, { \"p_mul.missing_seq_no.invalid\", PI_UNDECODED, PI_WARN, \"Invalid missing seq number\", EXPFILL }},",
          "1550:       { &ei_tot_miss_seq_no, { \"p_mul.no_missing_seq_no.expert\", PI_RESPONSE_CODE, PI_NOTE, \"Missing seq numbers\", EXPFILL }},",
          "1551:       { &ei_length, { \"p_mul.length.invalid\", PI_MALFORMED, PI_WARN, \"Incorrect length field\", EXPFILL }},",
          "1552:       { &ei_more_data, { \"p_mul.more_data\", PI_MALFORMED, PI_WARN, \"More data in packet\", EXPFILL }},",
          "1553:   };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1560:       { &ei_illegal_seq_no, { \"p_mul.seq_no.illegal\", PI_PROTOCOL, PI_WARN, \"Illegal seq number\", EXPFILL }},",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3caa4cde0dcca1893396beaff2b865aeb3a5bbe8",
      "candidate_info": {
        "commit_hash": "3caa4cde0dcca1893396beaff2b865aeb3a5bbe8",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/3caa4cde0dcca1893396beaff2b865aeb3a5bbe8",
        "files": [
          "epan/dissectors/packet-p_mul.c"
        ],
        "message": "p_mul: Detect Data PDU sequence number 0\n\nData PDU sequence number 0 is illegal, add an expert info for this.\nDon't include this packet in SEQ/ACK analysis.\n\nBug: 15337\nChange-Id: I476088531e8a3605393ee1dedf1e8b159dac342b\nReviewed-on: https://code.wireshark.org/review/30980\nPetri-Dish: Stig Bj\u00f8rlykke <stig@bjorlykke.org>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>\n(cherry picked from commit 3cccd4ec5b922e79afd134db4f0c9acb10bf7202)\nReviewed-on: https://code.wireshark.org/review/30986\nReviewed-by: Stig Bj\u00f8rlykke <stig@bjorlykke.org>",
        "before_after_code_files": [
          "epan/dissectors/packet-p_mul.c||epan/dissectors/packet-p_mul.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-p_mul.c||epan/dissectors/packet-p_mul.c"
          ],
          "candidate": [
            "epan/dissectors/packet-p_mul.c||epan/dissectors/packet-p_mul.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-p_mul.c||epan/dissectors/packet-p_mul.c": [
          "File: epan/dissectors/packet-p_mul.c -> epan/dissectors/packet-p_mul.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "152: static expert_field ei_more_data = EI_INIT;",
          "153: static expert_field ei_checksum_bad = EI_INIT;",
          "154: static expert_field ei_tot_miss_seq_no = EI_INIT;",
          "155: static expert_field ei_miss_seq_no = EI_INIT;",
          "156: static expert_field ei_analysis_ack_missing = EI_INIT;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "154: static expert_field ei_illegal_seq_no = EI_INIT;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "356:     return NULL;",
          "357:   }",
          "359:   nstime_set_zero(&addr_time);",
          "360:   nstime_set_zero(&prev_time);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "360:   if (pdu_type == Data_PDU && seq_no == 0) {",
          "362:     return NULL;",
          "363:   }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "865:   case Data_PDU:",
          "867:     seq_no = tvb_get_ntohs (tvb, offset);",
          "869:     proto_item_append_text (ti, \", Seq no: %u\", seq_no);",
          "870:     break;",
          "",
          "[Removed Lines]",
          "868:     proto_tree_add_item (p_mul_tree, hf_seq_no, tvb, offset, 2, ENC_BIG_ENDIAN);",
          "",
          "[Added Lines]",
          "874:     en = proto_tree_add_item (p_mul_tree, hf_seq_no, tvb, offset, 2, ENC_BIG_ENDIAN);",
          "875:     if (seq_no == 0) {",
          "876:       expert_add_info(pinfo, en, &ei_illegal_seq_no);",
          "877:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1536:       { &ei_miss_seq_range, { \"p_mul.missing_seq_range.invalid\", PI_UNDECODED, PI_WARN, \"Invalid missing sequence range\", EXPFILL }},",
          "1537:       { &ei_miss_seq_no, { \"p_mul.missing_seq_no.invalid\", PI_UNDECODED, PI_WARN, \"Invalid missing seq number\", EXPFILL }},",
          "1538:       { &ei_tot_miss_seq_no, { \"p_mul.no_missing_seq_no.expert\", PI_RESPONSE_CODE, PI_NOTE, \"Missing seq numbers\", EXPFILL }},",
          "1539:       { &ei_length, { \"p_mul.length.invalid\", PI_MALFORMED, PI_WARN, \"Incorrect length field\", EXPFILL }},",
          "1540:       { &ei_more_data, { \"p_mul.more_data\", PI_MALFORMED, PI_WARN, \"More data in packet\", EXPFILL }},",
          "1541:   };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1548:       { &ei_illegal_seq_no, { \"p_mul.seq_no.illegal\", PI_PROTOCOL, PI_WARN, \"Illegal seq number\", EXPFILL }},",
          "",
          "---------------"
        ]
      }
    }
  ]
}