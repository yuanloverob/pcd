{
  "cve_id": "CVE-2017-7747",
  "cve_desc": "In Wireshark 2.2.0 to 2.2.5 and 2.0.0 to 2.0.11, the PacketBB dissector could crash, triggered by packet injection or a malformed capture file. This was addressed in epan/dissectors/packet-packetbb.c by restricting additions to the protocol tree.",
  "repo": "wireshark/wireshark",
  "patch_hash": "2321a92ccc339cd2103f75f190df045d7c631051",
  "patch_info": {
    "commit_hash": "2321a92ccc339cd2103f75f190df045d7c631051",
    "repo": "wireshark/wireshark",
    "commit_url": "https://github.com/wireshark/wireshark/commit/2321a92ccc339cd2103f75f190df045d7c631051",
    "files": [
      "epan/dissectors/packet-packetbb.c"
    ],
    "message": "PacketBB: do not add more bytes to the protocol tree than the real addr array length\n\nBug: 13559\nChange-Id: I612a7e2c104603a0aa14a0775bf9b8d247069398\nReviewed-on: https://code.wireshark.org/review/20992\nPetri-Dish: Pascal Quantin <pascal.quantin@gmail.com>\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Michael Mann <mmann78@netscape.net>",
    "before_after_code_files": [
      "epan/dissectors/packet-packetbb.c||epan/dissectors/packet-packetbb.c"
    ]
  },
  "patch_diff": {
    "epan/dissectors/packet-packetbb.c||epan/dissectors/packet-packetbb.c": [
      "File: epan/dissectors/packet-packetbb.c -> epan/dissectors/packet-packetbb.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "30: #include <epan/packet.h>",
      "31: #include <epan/expert.h>",
      "33: void proto_reg_handoff_packetbb(void);",
      "34: void proto_register_packetbb(void);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "32: #include <epan/to_str.h>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "713:             tvb, mid_index, block_index + block_length - mid_index, addr);",
      "714:         break;",
      "715:       case 3:",
      "718:         break;",
      "719:       default:",
      "720:         break;",
      "",
      "[Removed Lines]",
      "716:         addrValue_item = proto_tree_add_bytes(addr_tree, hf_packetbb_addr_value[addressType],",
      "717:             tvb, mid_index, block_index + block_length - mid_index, addr);",
      "",
      "[Added Lines]",
      "717:         addrValue_item = proto_tree_add_bytes_format_value(addr_tree, hf_packetbb_addr_value[addressType],",
      "718:             tvb, mid_index, block_index + block_length - mid_index, NULL,",
      "719:             \"%s\", bytes_to_str(wmem_packet_scope(), addr, head_length + midSize));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ac5d73fee87ced57a87df67403017d235cdf7837",
      "candidate_info": {
        "commit_hash": "ac5d73fee87ced57a87df67403017d235cdf7837",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/ac5d73fee87ced57a87df67403017d235cdf7837",
        "files": [
          "epan/dissectors/packet-packetbb.c"
        ],
        "message": "PacketBB: do not add more bytes to the protocol tree than the real addr array length\n\nBug: 13559\nChange-Id: I612a7e2c104603a0aa14a0775bf9b8d247069398\nReviewed-on: https://code.wireshark.org/review/20992\nPetri-Dish: Pascal Quantin <pascal.quantin@gmail.com>\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Michael Mann <mmann78@netscape.net>\n(cherry picked from commit 2321a92ccc339cd2103f75f190df045d7c631051)\nReviewed-on: https://code.wireshark.org/review/21009\nPetri-Dish: Michael Mann <mmann78@netscape.net>",
        "before_after_code_files": [
          "epan/dissectors/packet-packetbb.c||epan/dissectors/packet-packetbb.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-packetbb.c||epan/dissectors/packet-packetbb.c"
          ],
          "candidate": [
            "epan/dissectors/packet-packetbb.c||epan/dissectors/packet-packetbb.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-packetbb.c||epan/dissectors/packet-packetbb.c": [
          "File: epan/dissectors/packet-packetbb.c -> epan/dissectors/packet-packetbb.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #include <epan/packet.h>",
          "30: #include <epan/prefs.h>",
          "31: #include <epan/expert.h>",
          "33: void proto_reg_handoff_packetbb(void);",
          "34: void proto_register_packetbb(void);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32: #include <epan/to_str.h>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "480:             tvb, mid_index, block_index + block_length - mid_index, addr);",
          "481:         break;",
          "482:       case 3:",
          "485:         break;",
          "486:       default:",
          "487:         break;",
          "",
          "[Removed Lines]",
          "483:         addrValue_item = proto_tree_add_bytes(addr_tree, hf_packetbb_addr_value[addressType],",
          "484:             tvb, mid_index, block_index + block_length - mid_index, addr);",
          "",
          "[Added Lines]",
          "484:         addrValue_item = proto_tree_add_bytes_format_value(addr_tree, hf_packetbb_addr_value[addressType],",
          "485:             tvb, mid_index, block_index + block_length - mid_index, NULL,",
          "486:             \"%s\", bytes_to_str(wmem_packet_scope(), addr, head_length + midSize));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5cfd52d6629cf8a7ab67c6bacd3431a964f43584",
      "candidate_info": {
        "commit_hash": "5cfd52d6629cf8a7ab67c6bacd3431a964f43584",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/5cfd52d6629cf8a7ab67c6bacd3431a964f43584",
        "files": [
          "epan/dissectors/packet-packetbb.c"
        ],
        "message": "PacketBB: do not add more bytes to the protocol tree than the real addr array length\n\nBug: 13559\nChange-Id: I612a7e2c104603a0aa14a0775bf9b8d247069398\nReviewed-on: https://code.wireshark.org/review/20992\nPetri-Dish: Pascal Quantin <pascal.quantin@gmail.com>\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Michael Mann <mmann78@netscape.net>\n(cherry picked from commit 2321a92ccc339cd2103f75f190df045d7c631051)\nReviewed-on: https://code.wireshark.org/review/21008\nPetri-Dish: Michael Mann <mmann78@netscape.net>",
        "before_after_code_files": [
          "epan/dissectors/packet-packetbb.c||epan/dissectors/packet-packetbb.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-packetbb.c||epan/dissectors/packet-packetbb.c"
          ],
          "candidate": [
            "epan/dissectors/packet-packetbb.c||epan/dissectors/packet-packetbb.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-packetbb.c||epan/dissectors/packet-packetbb.c": [
          "File: epan/dissectors/packet-packetbb.c -> epan/dissectors/packet-packetbb.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #include <epan/packet.h>",
          "30: #include <epan/prefs.h>",
          "31: #include <epan/expert.h>",
          "33: void proto_reg_handoff_packetbb(void);",
          "34: void proto_register_packetbb(void);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32: #include <epan/to_str.h>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "532:             tvb, mid_index, block_index + block_length - mid_index, addr);",
          "533:         break;",
          "534:       case 3:",
          "537:         break;",
          "538:       default:",
          "539:         break;",
          "",
          "[Removed Lines]",
          "535:         addrValue_item = proto_tree_add_bytes(addr_tree, hf_packetbb_addr_value[addressType],",
          "536:             tvb, mid_index, block_index + block_length - mid_index, addr);",
          "",
          "[Added Lines]",
          "536:         addrValue_item = proto_tree_add_bytes_format_value(addr_tree, hf_packetbb_addr_value[addressType],",
          "537:             tvb, mid_index, block_index + block_length - mid_index, NULL,",
          "538:             \"%s\", bytes_to_str(wmem_packet_scope(), addr, head_length + midSize));",
          "",
          "---------------"
        ]
      }
    }
  ]
}