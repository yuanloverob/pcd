{
  "cve_id": "CVE-2018-8792",
  "cve_desc": "rdesktop versions up to and including v1.8.3 contain an Out-Of-Bounds Read in function cssp_read_tsrequest() that results in a Denial of Service (segfault).",
  "repo": "rdesktop/rdesktop",
  "patch_hash": "4dca546d04321a610c1835010b5dad85163b65e1",
  "patch_info": {
    "commit_hash": "4dca546d04321a610c1835010b5dad85163b65e1",
    "repo": "rdesktop/rdesktop",
    "commit_url": "https://github.com/rdesktop/rdesktop/commit/4dca546d04321a610c1835010b5dad85163b65e1",
    "files": [
      "asn.c",
      "bitmap.c",
      "cliprdr.c",
      "constants.h",
      "cssp.c",
      "lspci.c",
      "mcs.c",
      "orders.c",
      "proto.h",
      "rdp.c",
      "rdpdr.c",
      "rdpsnd.c",
      "seamless.c",
      "secure.c",
      "stream.h",
      "types.h"
    ],
    "message": "Malicious RDP server security fixes\n\nThis commit includes fixes for a set of 21 vulnerabilities in\nrdesktop when a malicious RDP server is used.\n\nAll vulnerabilities was identified and reported by Eyal Itkin.\n\n * Add rdp_protocol_error function that is used in several fixes\n * Refactor of process_bitmap_updates\n * Fix possible integer overflow in s_check_rem() on 32bit arch\n * Fix memory corruption in process_bitmap_data - CVE-2018-8794\n * Fix remote code execution in process_bitmap_data - CVE-2018-8795\n * Fix remote code execution in process_plane - CVE-2018-8797\n * Fix Denial of Service in mcs_recv_connect_response - CVE-2018-20175\n * Fix Denial of Service in mcs_parse_domain_params - CVE-2018-20175\n * Fix Denial of Service in sec_parse_crypt_info - CVE-2018-20176\n * Fix Denial of Service in sec_recv - CVE-2018-20176\n * Fix minor information leak in rdpdr_process - CVE-2018-8791\n * Fix Denial of Service in cssp_read_tsrequest - CVE-2018-8792\n * Fix remote code execution in cssp_read_tsrequest - CVE-2018-8793\n * Fix Denial of Service in process_bitmap_data - CVE-2018-8796\n * Fix minor information leak in rdpsnd_process_ping - CVE-2018-8798\n * Fix Denial of Service in process_secondary_order - CVE-2018-8799\n * Fix remote code execution in in ui_clip_handle_data - CVE-2018-8800\n * Fix major information leak in ui_clip_handle_data - CVE-2018-20174\n * Fix memory corruption in rdp_in_unistr - CVE-2018-20177\n * Fix Denial of Service in process_demand_active - CVE-2018-20178\n * Fix remote code execution in lspci_process - CVE-2018-20179\n * Fix remote code execution in rdpsnddbg_process - CVE-2018-20180\n * Fix remote code execution in seamless_process - CVE-2018-20181\n * Fix remote code execution in seamless_process_line - CVE-2018-20182",
    "before_after_code_files": [
      "asn.c||asn.c",
      "bitmap.c||bitmap.c",
      "cliprdr.c||cliprdr.c",
      "constants.h||constants.h",
      "cssp.c||cssp.c",
      "lspci.c||lspci.c",
      "mcs.c||mcs.c",
      "orders.c||orders.c",
      "proto.h||proto.h",
      "rdp.c||rdp.c",
      "rdpdr.c||rdpdr.c",
      "rdpsnd.c||rdpsnd.c",
      "seamless.c||seamless.c",
      "secure.c||secure.c",
      "stream.h||stream.h",
      "types.h||types.h"
    ]
  },
  "patch_diff": {
    "asn.c||asn.c": [
      "File: asn.c -> asn.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "24: RD_BOOL",
      "26: {",
      "27:  int tag, len;",
      "",
      "[Removed Lines]",
      "25: ber_parse_header(STREAM s, int tagval, int *length)",
      "",
      "[Added Lines]",
      "25: ber_parse_header(STREAM s, int tagval, uint32 *length)",
      "",
      "---------------"
    ],
    "bitmap.c||bitmap.c": [
      "File: bitmap.c -> bitmap.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "794:      replen = revcode;",
      "795:      collen = 0;",
      "796:     }",
      "798:     {",
      "799:      color = CVAL(in);",
      "",
      "[Removed Lines]",
      "797:     while (collen > 0)",
      "",
      "[Added Lines]",
      "797:     while (indexw < width && collen > 0)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "802:      indexw++;",
      "803:      collen--;",
      "804:     }",
      "806:     {",
      "808:      out += 4;",
      "",
      "[Removed Lines]",
      "805:     while (replen > 0)",
      "",
      "[Added Lines]",
      "805:     while (indexw < width && replen > 0)",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "824:      replen = revcode;",
      "825:      collen = 0;",
      "826:     }",
      "828:     {",
      "829:      x = CVAL(in);",
      "830:      if (x & 1)",
      "",
      "[Removed Lines]",
      "827:     while (collen > 0)",
      "",
      "[Added Lines]",
      "827:     while (indexw < width && collen > 0)",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "844:      indexw++;",
      "845:      collen--;",
      "846:     }",
      "848:     {",
      "849:      x = last_line[indexw * 4] + color;",
      "",
      "[Removed Lines]",
      "847:     while (replen > 0)",
      "",
      "[Added Lines]",
      "847:     while (indexw < width && replen > 0)",
      "",
      "---------------"
    ],
    "cliprdr.c||cliprdr.c": [
      "File: cliprdr.c -> cliprdr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "118:  uint16 type, status;",
      "119:  uint32 length, format;",
      "120:  uint8 *data;",
      "122:  in_uint16_le(s, type);",
      "123:  in_uint16_le(s, status);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "121:  struct stream packet = *s;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "127:  logger(Clipboard, Debug, \"cliprdr_process(), type=%d, status=%d, length=%d\", type, status,",
      "128:         length);",
      "130:  if (status == CLIPRDR_ERROR)",
      "131:  {",
      "132:   switch (type)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "131:  if (!s_check_rem(s, length))",
      "132:  {",
      "133:   rdp_protocol_error(\"cliprdr_process(), consume of packet from stream would overrun\", &packet);",
      "134:  }",
      "",
      "---------------"
    ],
    "constants.h||constants.h": [
      "File: constants.h -> constants.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "751: #define ENC_SALTED_CHECKSUM  0x0010",
      "752: #define NO_BITMAP_COMPRESSION_HDR 0x0400",
      "755: #define NEGOTIATEORDERSUPPORT 0x0002",
      "756: #define ZEROBOUNDSDELTASSUPPORT 0x0008",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "755: #define BITMAP_COMPRESSION              0x0001",
      "",
      "---------------"
    ],
    "cssp.c||cssp.c": [
      "File: cssp.c -> cssp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "595:  STREAM s;",
      "596:  int length;",
      "597:  int tagval;",
      "599:  s = tcp_recv(NULL, 4);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "598:  struct stream packet;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "624:  s = tcp_recv(s, length);",
      "627:  if (!ber_in_header(s, &tagval, &length) ||",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "626:  packet = *s;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "632:  if (!ber_in_header(s, &tagval, &length) ||",
      "633:      tagval != (BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 0))",
      "634:   return False;",
      "635:  in_uint8s(s, length);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "638:  if (!s_check_rem(s, length))",
      "639:  {",
      "640:    rdp_protocol_error(\"cssp_read_tsrequest(), consume of version from stream would overrun\",",
      "641:         &packet);",
      "642:  }",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "653:   if (!ber_in_header(s, &tagval, &length) || tagval != BER_TAG_OCTET_STRING)",
      "654:    return False;",
      "657:   out_uint8p(token, s->p, length);",
      "658:   s_mark_end(token);",
      "659:  }",
      "",
      "[Removed Lines]",
      "656:   token->end = token->p = token->data;",
      "",
      "[Added Lines]",
      "664:   if (!s_check_rem(s, length))",
      "665:   {",
      "666:    rdp_protocol_error(\"cssp_read_tsrequest(), consume of token from stream would overrun\",",
      "667:         &packet);",
      "668:   }",
      "670:   s_realloc(token, length);",
      "671:   s_reset(token);",
      "",
      "---------------"
    ],
    "lspci.c||lspci.c": [
      "File: lspci.c -> lspci.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2:    rdesktop: A Remote Desktop Protocol client.",
      "3:    Support for the Matrox \"lspci\" channel",
      "6:    This program is free software: you can redistribute it and/or modify",
      "7:    it under the terms of the GNU General Public License as published by",
      "",
      "[Removed Lines]",
      "4:    Copyright (C) 2005 Matrox Graphics Inc.",
      "",
      "[Added Lines]",
      "4:    Copyright (C) 2005 Matrox Graphics Inc.",
      "5:    Copyright 2018 Henrik Andersson <hean01@cendio.se> for Cendio AB",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "134:  unsigned int pkglen;",
      "135:  static char *rest = NULL;",
      "136:  char *buf;",
      "138:  pkglen = s->end - s->p;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "138:  struct stream packet = *s;",
      "140:  if (!s_check(s))",
      "141:  {",
      "142:   rdp_protocol_error(\"lspci_process(), stream is in unstable state\", &packet);",
      "143:  }",
      "",
      "---------------"
    ],
    "mcs.c||mcs.c": [
      "File: mcs.c -> mcs.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "45: static RD_BOOL",
      "46: mcs_parse_domain_params(STREAM s)",
      "47: {",
      "50:  ber_parse_header(s, MCS_TAG_DOMAIN_PARAMS, &length);",
      "51:  in_uint8s(s, length);",
      "53:  return s_check(s);",
      "",
      "[Removed Lines]",
      "48:  int length;",
      "",
      "[Added Lines]",
      "48:  uint32 length;",
      "49:  struct stream packet = *s;",
      "53:  if (!s_check_rem(s, length))",
      "54:  {",
      "55:   rdp_protocol_error(\"mcs_parse_domain_params(), consume domain params from stream would overrun\", &packet);",
      "56:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "89: {",
      "90:  UNUSED(mcs_data);",
      "91:  uint8 result;",
      "93:  STREAM s;",
      "94:  RD_BOOL is_fastpath;",
      "95:  uint8 fastpath_hdr;",
      "",
      "[Removed Lines]",
      "92:  int length;",
      "",
      "[Added Lines]",
      "99:  uint32 length;",
      "101:  struct stream packet;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "100:  if (s == NULL)",
      "101:   return False;",
      "103:  ber_parse_header(s, MCS_CONNECT_RESPONSE, &length);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "111:  packet = *s;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "113:  ber_parse_header(s, BER_TAG_INTEGER, &length);",
      "115:  mcs_parse_domain_params(s);",
      "117:  ber_parse_header(s, BER_TAG_OCTET_STRING, &length);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "126:  if (!s_check_rem(s, length))",
      "127:  {",
      "128:   rdp_protocol_error(\"mcs_recv_connect_response(), consume connect id from stream would overrun\", &packet);",
      "129:  }",
      "",
      "---------------"
    ],
    "orders.c||orders.c": [
      "File: orders.c -> orders.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1259:  uint16 flags;",
      "1260:  uint8 type;",
      "1261:  uint8 *next_order;",
      "1263:  in_uint16_le(s, length);",
      "1265:  in_uint8(s, type);",
      "1267:  next_order = s->p + (sint16) length + 7;",
      "1269:  switch (type)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1262:  struct stream packet = *s;",
      "1268:  if (!s_check_rem(s, length + 7))",
      "1269:  {",
      "1270:   rdp_protocol_error(\"process_secondary_order(), next order pointer would overrun stream\", &packet);",
      "1271:  }",
      "",
      "---------------"
    ],
    "proto.h||proto.h": [
      "File: proto.h -> proto.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "164:       char *directory, RD_BOOL reconnect);",
      "165: void rdp_reset_state(void);",
      "166: void rdp_disconnect(void);",
      "168: int get_device_index(RD_NTHANDLE handle);",
      "169: void convert_to_unix_filename(char *filename);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "167: void rdp_protocol_error(const char *message, STREAM s);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "225: RD_BOOL ber_in_header(STREAM s, int *tagval, int *length);",
      "226: void ber_out_header(STREAM s, int tagval, int length);",
      "228: void ber_out_integer(STREAM s, int value);",
      "229: void ber_out_sequence(STREAM s, STREAM contents);",
      "",
      "[Removed Lines]",
      "227: RD_BOOL ber_parse_header(STREAM s, int tagval, int *length);",
      "",
      "[Added Lines]",
      "228: RD_BOOL ber_parse_header(STREAM s, int tagval, uint32 *length);",
      "",
      "---------------"
    ],
    "rdp.c||rdp.c": [
      "File: rdp.c -> rdp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "285:  size_t ibl, obl;",
      "286:  char *pin, *pout;",
      "289:  if (!icv_utf16_to_local)",
      "290:  {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "288:  struct stream packet = *s;",
      "290:  if ((in_len < 0) || ((uint32)in_len >= (RD_UINT32_MAX / 2)))",
      "291:  {",
      "292:   logger(Protocol, Error, \"rdp_in_unistr(), length of unicode data is out of bounds.\");",
      "293:   abort();",
      "294:  }",
      "296:  if (!s_check_rem(s, in_len))",
      "297:  {",
      "298:   rdp_protocol_error(\"rdp_in_unistr(), consume of unicode data from stream would overrun\", &packet);",
      "299:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1211: {",
      "1212:  uint8 type;",
      "1213:  uint16 len_src_descriptor, len_combined_caps;",
      "1216:  rd_create_ui();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1227:  struct stream packet = *s;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1218:  in_uint32_le(s, g_rdp_shareid);",
      "1219:  in_uint16_le(s, len_src_descriptor);",
      "1220:  in_uint16_le(s, len_combined_caps);",
      "1221:  in_uint8s(s, len_src_descriptor);",
      "1223:  logger(Protocol, Debug, \"process_demand_active(), shareid=0x%x\", g_rdp_shareid);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1236:  if (!s_check_rem(s, len_src_descriptor))",
      "1237:  {",
      "1238:   rdp_protocol_error(\"rdp_demand_active(), consume of source descriptor from stream would overrun\", &packet);",
      "1239:  }",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1390:  }",
      "1391: }",
      "1396: {",
      "1398:  uint16 left, top, right, bottom, width, height;",
      "1400:  uint8 *data, *bmpdata;",
      "1403:  logger(Protocol, Debug, \"%s()\", __func__);",
      "1453:   bmpdata = (uint8 *) xmalloc(width * height * Bpp);",
      "1455:   {",
      "1457:   }",
      "1464:   xfree(bmpdata);",
      "1465:  }",
      "1466: }",
      "",
      "[Removed Lines]",
      "1394: void",
      "1395: process_bitmap_updates(STREAM s)",
      "1397:  uint16 num_updates;",
      "1399:  uint16 cx, cy, bpp, Bpp, compress, bufsize, size;",
      "1401:  int i;",
      "1405:  in_uint16_le(s, num_updates);",
      "1407:  for (i = 0; i < num_updates; i++)",
      "1408:  {",
      "1409:   in_uint16_le(s, left);",
      "1410:   in_uint16_le(s, top);",
      "1411:   in_uint16_le(s, right);",
      "1412:   in_uint16_le(s, bottom);",
      "1413:   in_uint16_le(s, width);",
      "1414:   in_uint16_le(s, height);",
      "1415:   in_uint16_le(s, bpp);",
      "1416:   Bpp = (bpp + 7) / 8;",
      "1417:   in_uint16_le(s, compress);",
      "1418:   in_uint16_le(s, bufsize);",
      "1420:   cx = right - left + 1;",
      "1421:   cy = bottom - top + 1;",
      "1423:   logger(Graphics, Debug,",
      "1424:          \"process_bitmap_updates(), [%d,%d,%d,%d], [%d,%d], bpp=%d, compression=%d\",",
      "1425:          left, top, right, bottom, width, height, Bpp, compress);",
      "1427:   if (!compress)",
      "1428:   {",
      "1429:    int y;",
      "1430:    bmpdata = (uint8 *) xmalloc(width * height * Bpp);",
      "1431:    for (y = 0; y < height; y++)",
      "1432:    {",
      "1433:     in_uint8a(s, &bmpdata[(height - y - 1) * (width * Bpp)],",
      "1434:        width * Bpp);",
      "1435:    }",
      "1436:    ui_paint_bitmap(left, top, cx, cy, width, height, bmpdata);",
      "1437:    xfree(bmpdata);",
      "1438:    continue;",
      "1439:   }",
      "1442:   if (compress & 0x400)",
      "1443:   {",
      "1444:    size = bufsize;",
      "1445:   }",
      "1446:   else",
      "1447:   {",
      "1449:    in_uint16_le(s, size);",
      "1451:   }",
      "1452:   in_uint8p(s, data, size);",
      "1454:   if (bitmap_decompress(bmpdata, width, height, data, size, Bpp))",
      "1456:    ui_paint_bitmap(left, top, cx, cy, width, height, bmpdata);",
      "1458:   else",
      "1459:   {",
      "1460:    logger(Graphics, Warning,",
      "1461:           \"process_bitmap_updates(), failed to decompress bitmap\");",
      "1462:   }",
      "",
      "[Added Lines]",
      "1413: static void",
      "1414: process_bitmap_data(STREAM s)",
      "1417:  uint16 cx, cy, bpp, Bpp, flags, bufsize, size;",
      "1422:  struct stream packet = *s;",
      "1431:  Bpp = (bpp + 7) / 8;",
      "1435:  cx = right - left + 1;",
      "1436:  cy = bottom - top + 1;",
      "1439:   this code. The value of bpp is not passed to",
      "1440:   ui_paint_bitmap() which relies on g_server_bpp for drawing",
      "1441:   the bitmap data.",
      "1443:   Does this means that we can sanity check bpp with g_server_bpp ?",
      "1446:  if (Bpp == 0 || width == 0 || height == 0)",
      "1447:  {",
      "1448:         logger(Protocol, Warning, \"%s(), [%d,%d,%d,%d], [%d,%d], bpp=%d, flags=%x\", __func__,",
      "1449:     left, top, right, bottom, width, height, bpp, flags);",
      "1450:   rdp_protocol_error(\"TS_BITMAP_DATA, unsafe size of bitmap data received from server\", &packet);",
      "1451:  }",
      "1453:  if ((RD_UINT32_MAX / Bpp) <= (width * height))",
      "1454:  {",
      "1455:   logger(Protocol, Warning, \"%s(), [%d,%d,%d,%d], [%d,%d], bpp=%d, flags=%x\", __func__,",
      "1456:     left, top, right, bottom, width, height, bpp, flags);",
      "1457:   rdp_protocol_error(\"TS_BITMAP_DATA, unsafe size of bitmap data received from server\", &packet);",
      "1458:  }",
      "1460:  if (flags == 0)",
      "1461:  {",
      "1463:   int y;",
      "1465:   for (y = 0; y < height; y++)",
      "1467:    in_uint8a(s, &bmpdata[(height - y - 1) * (width * Bpp)], width * Bpp);",
      "1470:   ui_paint_bitmap(left, top, cx, cy, width, height, bmpdata);",
      "1472:   return;",
      "1473:  }",
      "1475:  if (flags & NO_BITMAP_COMPRESSION_HDR)",
      "1476:  {",
      "1477:   size = bufsize;",
      "1478:  }",
      "1479:  else",
      "1480:  {",
      "1486:  }",
      "1489:  if (!s_check_rem(s, size))",
      "1490:  {",
      "1491:   rdp_protocol_error(\"process_bitmap_data(), consume of bitmap data from stream would overrun\", &packet);",
      "1492:  }",
      "1493:  in_uint8p(s, data, size);",
      "1494:  bmpdata = (uint8 *) xmalloc(width * height * Bpp);",
      "1495:  if (bitmap_decompress(bmpdata, width, height, data, size, Bpp))",
      "1496:  {",
      "1497:   ui_paint_bitmap(left, top, cx, cy, width, height, bmpdata);",
      "1498:  }",
      "1499:  else",
      "1500:  {",
      "1501:   logger(Protocol, Warning, \"%s(), failed to decompress bitmap\", __func__);",
      "1502:  }",
      "1504:  xfree(bmpdata);",
      "1505: }",
      "1508: void",
      "1509: process_bitmap_updates(STREAM s)",
      "1510: {",
      "1511:  int i;",
      "1512:  uint16 num_updates;",
      "1516:  for (i = 0; i < num_updates; i++)",
      "1517:  {",
      "1518:   process_bitmap_data(s);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "2013:  logger(Protocol, Debug, \"%s()\", __func__);",
      "2014:  sec_disconnect();",
      "2015: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2073:    A protocol error is defined as:",
      "2075:     - A value is outside specified range for example;",
      "2076:       bpp for a bitmap is not allowed to be greater than the",
      "2077:       value 32 but is represented by a byte in protocol.",
      "2080: void",
      "2081: rdp_protocol_error(const char *message, STREAM s)",
      "2082: {",
      "2083:  logger(Protocol, Error, \"%s(), %s\", __func__, message);",
      "2084:  if (s)",
      "2085:   hexdump(s->p, s_length(s));",
      "2086:  exit(0);",
      "2087: }",
      "",
      "---------------"
    ],
    "rdpdr.c||rdpdr.c": [
      "File: rdpdr.c -> rdpdr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "854:  uint16 vmin;",
      "855:  uint16 component;",
      "856:  uint16 pakid;",
      "858:  logger(Protocol, Debug, \"rdpdr_process()\");",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "857:  struct stream packet = *s;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "880:     if (vmin < 0x000c)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "881:        so lets check that we actually got",
      "882:        valid data from stream to prevent",
      "884:     if (!s_check(s))",
      "885:     {",
      "886:      rdp_protocol_error(\"rdpdr_process(), consume of g_client_id from stream did overrun\", &packet);",
      "887:     }",
      "",
      "---------------"
    ],
    "rdpsnd.c||rdpsnd.c": [
      "File: rdpsnd.c -> rdpsnd.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "269:  uint16 tick;",
      "270:  uint16 packsize;",
      "271:  STREAM out;",
      "273:  in_uint16_le(in, tick);",
      "274:  in_uint16_le(in, packsize);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "272:  struct stream packet = *in;",
      "274:  if (!s_check_rem(in, 4))",
      "275:  {",
      "276:   rdp_protocol_error(\"rdpsnd_process_training(), consume of training data from stream would overrun\", &packet);",
      "277:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "445:  static char *rest = NULL;",
      "446:  char *buf;",
      "448:  pkglen = s->end - s->p;",
      "450:  buf = (char *) xmalloc(pkglen + 1);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "454:  if (!s_check(s))",
      "455:  {",
      "456:   rdp_protocol_error(\"rdpsnddbg_process(), stream is in unstable state\", s);",
      "457:  }",
      "",
      "---------------"
    ],
    "seamless.c||seamless.c": [
      "File: seamless.c -> seamless.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "169:    icon_buf[len] = strtol(byte, NULL, 16);",
      "170:    len++;",
      "171:   }",
      "173:   ui_seamless_seticon(id, tok5, width, height, chunk, icon_buf, len);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "172:    if ((size_t)len >= sizeof(icon_buf))",
      "173:    {",
      "174:     logger(Protocol, Warning, \"seamless_process_line(), icon data would overrun icon_buf\");",
      "175:     break;",
      "176:    }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "370: {",
      "371:  unsigned int pkglen;",
      "372:  char *buf;",
      "374:  pkglen = s->end - s->p;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "379:  struct stream packet = *s;",
      "381:  if (!s_check(s))",
      "382:  {",
      "383:   rdp_protocol_error(\"seamless_process(), stream is in unstable state\", &packet);",
      "384:  }",
      "",
      "---------------"
    ],
    "secure.c||secure.c": [
      "File: secure.c -> secure.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "296: void",
      "297: sec_decrypt(uint8 * data, int length)",
      "298: {",
      "299:  if (g_sec_decrypt_use_count == 4096)",
      "300:  {",
      "301:   sec_update(g_sec_decrypt_key, g_sec_decrypt_update_key);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "299:  if (length <= 0)",
      "300:   return;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "848:  uint16 sec_flags;",
      "849:  uint16 channel;",
      "850:  STREAM s;",
      "852:  while ((s = mcs_recv(&channel, is_fastpath, &fastpath_hdr)) != NULL)",
      "853:  {",
      "854:   if (*is_fastpath == True)",
      "855:   {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "854:  struct stream packet;",
      "858:   packet = *s;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "859:    fastpath_flags = (fastpath_hdr & 0xC0) >> 6;",
      "860:    if (fastpath_flags & FASTPATH_OUTPUT_ENCRYPTED)",
      "861:    {",
      "863:     sec_decrypt(s->p, s->end - s->p);",
      "864:    }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "867:     if (!s_check_rem(s, 8)) {",
      "868:      rdp_protocol_error(\"sec_recv(), consume fastpath signature from stream would overrun\", &packet);",
      "869:     }",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "875:    {",
      "876:     if (sec_flags & SEC_ENCRYPT)",
      "877:     {",
      "879:      sec_decrypt(s->p, s->end - s->p);",
      "880:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "887:      if (!s_check_rem(s, 8)) {",
      "888:       rdp_protocol_error(\"sec_recv(), consume encrypt signature from stream would overrun\", &packet);",
      "889:      }",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "889:     {",
      "890:      uint8 swapbyte;",
      "893:      sec_decrypt(s->p, s->end - s->p);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "905:      if (!s_check_rem(s, 8)) {",
      "906:       rdp_protocol_error(\"sec_recv(), consume redirect signature from stream would overrun\", &packet);",
      "907:      }",
      "",
      "---------------"
    ],
    "stream.h||stream.h": [
      "File: stream.h -> stream.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "54: #define s_pop_layer(s,h) (s)->p = (s)->h;",
      "55: #define s_mark_end(s)  (s)->end = (s)->p;",
      "56: #define s_check(s)  ((s)->p <= (s)->end)",
      "58: #define s_check_end(s)  ((s)->p == (s)->end)",
      "59: #define s_length(s)  ((s)->end - (s)->data)",
      "60: #define s_left(s)               ((s)->size - ((s)->p - (s)->data))",
      "",
      "[Removed Lines]",
      "57: #define s_check_rem(s,n) ((s)->p + n <= (s)->end)",
      "",
      "[Added Lines]",
      "57: #define s_check_rem(s,n) (s_check(s) && (n <= (s)->end - (s)->p))",
      "",
      "---------------"
    ],
    "types.h||types.h": [
      "File: types.h -> types.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "43: typedef unsigned int uint32;",
      "44: typedef signed int sint32;",
      "46: typedef void *RD_HBITMAP;",
      "47: typedef void *RD_HGLYPH;",
      "48: typedef void *RD_HCOLOURMAP;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "46: #define RD_UINT32_MAX (uint32)(-1)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "75221eb3c52a160fc8737bcb47b487d2df1579ff",
      "candidate_info": {
        "commit_hash": "75221eb3c52a160fc8737bcb47b487d2df1579ff",
        "repo": "rdesktop/rdesktop",
        "commit_url": "https://github.com/rdesktop/rdesktop/commit/75221eb3c52a160fc8737bcb47b487d2df1579ff",
        "files": [
          "channels.c",
          "cliprdr.c",
          "cssp.c",
          "iso.c",
          "licence.c",
          "lspci.c",
          "mcs.c",
          "rdp.c",
          "rdp5.c",
          "rdpdr.c",
          "scard.c",
          "seamless.c",
          "secure.c",
          "stream.h"
        ],
        "message": "Separate behaviour of out_uint8a and out_uint8p\n\nMake them more match in_uint8a and in_uint8p in that one copies and\nthe other just gives you a pointer and it is up to the caller how\nto fill it in. This can be useful when other APIs are used to\ngenerate the data as it avoids a temporary buffer.",
        "before_after_code_files": [
          "channels.c||channels.c",
          "cliprdr.c||cliprdr.c",
          "cssp.c||cssp.c",
          "iso.c||iso.c",
          "licence.c||licence.c",
          "lspci.c||lspci.c",
          "mcs.c||mcs.c",
          "rdp.c||rdp.c",
          "rdp5.c||rdp5.c",
          "rdpdr.c||rdpdr.c",
          "scard.c||scard.c",
          "seamless.c||seamless.c",
          "secure.c||secure.c",
          "stream.h||stream.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "cliprdr.c||cliprdr.c",
            "cssp.c||cssp.c",
            "lspci.c||lspci.c",
            "mcs.c||mcs.c",
            "rdp.c||rdp.c",
            "rdpdr.c||rdpdr.c",
            "seamless.c||seamless.c",
            "secure.c||secure.c",
            "stream.h||stream.h"
          ],
          "candidate": [
            "cliprdr.c||cliprdr.c",
            "cssp.c||cssp.c",
            "lspci.c||lspci.c",
            "mcs.c||mcs.c",
            "rdp.c||rdp.c",
            "rdpdr.c||rdpdr.c",
            "seamless.c||seamless.c",
            "secure.c||secure.c",
            "stream.h||stream.h"
          ]
        }
      },
      "candidate_diff": {
        "channels.c||channels.c": [
          "File: channels.c -> channels.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "134:   s = sec_init(g_encryption ? SEC_ENCRYPT : 0, thislength + 8);",
          "135:   out_uint32_le(s, length);",
          "136:   out_uint32_le(s, flags);",
          "138:   s_mark_end(s);",
          "139:   sec_send_to_channel(s, g_encryption ? SEC_ENCRYPT : 0, channel->mcs_id);",
          "",
          "[Removed Lines]",
          "137:   out_uint8p(s, data, thislength);",
          "",
          "[Added Lines]",
          "137:   out_uint8a(s, data, thislength);",
          "",
          "---------------"
        ],
        "cliprdr.c||cliprdr.c": [
          "File: cliprdr.c -> cliprdr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "48:  out_uint16_le(s, type);",
          "49:  out_uint16_le(s, status);",
          "50:  out_uint32_le(s, length);",
          "53:  s_mark_end(s);",
          "54:  channel_send(s, cliprdr_channel);",
          "",
          "[Removed Lines]",
          "51:  out_uint8p(s, data, length);",
          "",
          "[Added Lines]",
          "51:  out_uint8a(s, data, length);",
          "",
          "---------------"
        ],
        "cssp.c||cssp.c": [
          "File: cssp.c -> cssp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "39:  out = s_alloc(size);",
          "40:  ber_out_header(out, tagval, s_length(in));",
          "42:  s_mark_end(out);",
          "44:  return out;",
          "",
          "[Removed Lines]",
          "41:  out_uint8p(out, in->data, s_length(in));",
          "",
          "[Added Lines]",
          "41:  out_uint8a(out, in->data, s_length(in));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "171:  out->data = out->p = xmalloc(outbuf.length);",
          "172:  out->size = outbuf.length;",
          "174:  s_mark_end(out);",
          "176:  gss_release_buffer(&minor_status, &outbuf);",
          "",
          "[Removed Lines]",
          "173:  out_uint8p(out, outbuf.value, outbuf.length);",
          "",
          "[Added Lines]",
          "173:  out_uint8a(out, outbuf.value, outbuf.length);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "202:  out->data = out->p = xmalloc(outbuf.length);",
          "203:  out->size = outbuf.length;",
          "205:  s_mark_end(out);",
          "207:  gss_release_buffer(&minor_status, &outbuf);",
          "",
          "[Removed Lines]",
          "204:  out_uint8p(out, outbuf.value, outbuf.length);",
          "",
          "[Added Lines]",
          "204:  out_uint8a(out, outbuf.value, outbuf.length);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "229:  h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, &tmp);",
          "230:  h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 0, h2);",
          "231:  s_realloc(&message, s_length(&message) + s_length(h1));",
          "233:  s_mark_end(&message);",
          "234:  s_free(h2);",
          "235:  s_free(h1);",
          "",
          "[Removed Lines]",
          "232:  out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "232:  out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "242:  h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, &tmp);",
          "243:  h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 1, h2);",
          "244:  s_realloc(&message, s_length(&message) + s_length(h1));",
          "246:  s_mark_end(&message);",
          "247:  s_free(h2);",
          "248:  s_free(h1);",
          "",
          "[Removed Lines]",
          "245:  out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "245:  out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "254:  h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, &tmp);",
          "255:  h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 2, h2);",
          "256:  s_realloc(&message, s_length(&message) + s_length(h1));",
          "258:  s_mark_end(&message);",
          "259:  s_free(h2);",
          "260:  s_free(h1);",
          "",
          "[Removed Lines]",
          "257:  out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "257:  out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "290:  h2 = ber_wrap_hdr_data(BER_TAG_INTEGER, &tmp);",
          "291:  h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 0, h2);",
          "292:  s_realloc(&message, s_length(&message) + s_length(h1));",
          "294:  s_mark_end(&message);",
          "295:  s_free(h2);",
          "296:  s_free(h1);",
          "",
          "[Removed Lines]",
          "293:  out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "293:  out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "304:   h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, &tmp);",
          "305:   h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 1, h2);",
          "306:   s_realloc(&message, s_length(&message) + s_length(h1));",
          "308:   s_mark_end(&message);",
          "309:   s_free(h2);",
          "310:   s_free(h1);",
          "",
          "[Removed Lines]",
          "307:   out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "307:   out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "319:   h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, &tmp);",
          "320:   h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 2, h2);",
          "321:   s_realloc(&message, s_length(&message) + s_length(h1));",
          "323:   s_mark_end(&message);",
          "324:   s_free(h2);",
          "325:   s_free(h1);",
          "",
          "[Removed Lines]",
          "322:   out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "322:   out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "334:   h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, &tmp);",
          "335:   h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 3, h2);",
          "336:   s_realloc(&message, s_length(&message) + s_length(h1));",
          "338:   s_mark_end(&message);",
          "339:   s_free(h2);",
          "340:   s_free(h1);",
          "",
          "[Removed Lines]",
          "337:   out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "337:   out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "349:   h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, &tmp);",
          "350:   h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 4, h2);",
          "351:   s_realloc(&message, s_length(&message) + s_length(h1));",
          "353:   s_mark_end(&message);",
          "354:   s_free(h2);",
          "355:   s_free(h1);",
          "",
          "[Removed Lines]",
          "352:   out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "352:   out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "382:  h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, &tmp);",
          "383:  h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 0, h2);",
          "384:  s_realloc(&message, s_length(&message) + s_length(h1));",
          "386:  s_mark_end(&message);",
          "387:  s_free(h2);",
          "388:  s_free(h1);",
          "",
          "[Removed Lines]",
          "385:  out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "385:  out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "392:       g_sc_container_name, g_sc_csp_name);",
          "393:  h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 1, h2);",
          "394:  s_realloc(&message, s_length(&message) + s_length(h1));",
          "396:  s_mark_end(&message);",
          "397:  s_free(h2);",
          "398:  s_free(h1);",
          "",
          "[Removed Lines]",
          "395:  out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "395:  out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "406:   h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, &tmp);",
          "407:   h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 2, h2);",
          "408:   s_realloc(&message, s_length(&message) + s_length(h1));",
          "410:   s_mark_end(&message);",
          "411:   s_free(h2);",
          "412:   s_free(h1);",
          "",
          "[Removed Lines]",
          "409:   out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "409:   out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "421:   h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, &tmp);",
          "422:   h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 3, h2);",
          "423:   s_realloc(&message, s_length(&message) + s_length(h1));",
          "425:   s_mark_end(&message);",
          "426:   s_free(h2);",
          "427:   s_free(h1);",
          "",
          "[Removed Lines]",
          "424:   out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "424:   out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "462:  h2 = ber_wrap_hdr_data(BER_TAG_INTEGER, &tmp);",
          "463:  h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 0, h2);",
          "464:  s_realloc(&message, s_length(&message) + s_length(h1));",
          "466:  s_mark_end(&message);",
          "467:  s_free(h2);",
          "468:  s_free(h1);",
          "",
          "[Removed Lines]",
          "465:  out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "465:  out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "480:  h2 = ber_wrap_hdr_data(BER_TAG_OCTET_STRING, h3);",
          "481:  h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 1, h2);",
          "482:  s_realloc(&message, s_length(&message) + s_length(h1));",
          "484:  s_mark_end(&message);",
          "485:  s_free(h3);",
          "486:  s_free(h2);",
          "",
          "[Removed Lines]",
          "483:  out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "483:  out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "516:  h2 = ber_wrap_hdr_data(BER_TAG_INTEGER, &tmp);",
          "517:  h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 0, h2);",
          "518:  s_realloc(&message, s_length(&message) + s_length(h1));",
          "520:  s_mark_end(&message);",
          "521:  s_free(h2);",
          "522:  s_free(h1);",
          "",
          "[Removed Lines]",
          "519:  out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "519:  out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "530:   h2 = ber_wrap_hdr_data(BER_TAG_SEQUENCE | BER_TAG_CONSTRUCTED, h3);",
          "531:   h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 1, h2);",
          "532:   s_realloc(&message, s_length(&message) + s_length(h1));",
          "534:   s_mark_end(&message);",
          "535:   s_free(h5);",
          "536:   s_free(h4);",
          "",
          "[Removed Lines]",
          "533:   out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "533:   out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "546:   h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 2, h2);",
          "548:   s_realloc(&message, s_length(&message) + s_length(h1));",
          "551:   s_free(h2);",
          "552:   s_free(h1);",
          "",
          "[Removed Lines]",
          "549:   out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "549:   out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "559:   h1 = ber_wrap_hdr_data(BER_TAG_CTXT_SPECIFIC | BER_TAG_CONSTRUCTED | 3, h2);",
          "561:   s_realloc(&message, s_length(&message) + s_length(h1));",
          "563:   s_mark_end(&message);",
          "564:   s_free(h2);",
          "565:   s_free(h1);",
          "",
          "[Removed Lines]",
          "562:   out_uint8p(&message, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "562:   out_uint8a(&message, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "571:  h1 = ber_wrap_hdr_data(BER_TAG_SEQUENCE | BER_TAG_CONSTRUCTED, &message);",
          "572:  s = tcp_init(s_length(h1));",
          "574:  s_mark_end(s);",
          "575:  s_free(h1);",
          "",
          "[Removed Lines]",
          "573:  out_uint8p(s, h1->data, s_length(h1));",
          "",
          "[Added Lines]",
          "573:  out_uint8a(s, h1->data, s_length(h1));",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "665:   s_realloc(token, length);",
          "666:   s_reset(token);",
          "668:   s_mark_end(token);",
          "669:  }",
          "",
          "[Removed Lines]",
          "667:   out_uint8p(token, s->p, length);",
          "",
          "[Added Lines]",
          "667:   out_uint8a(token, s->p, length);",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "785:     s_realloc(&token, output_tok.length);",
          "786:    s_reset(&token);",
          "789:    s_mark_end(&token);",
          "791:    if (!cssp_send_tsrequest(&token, NULL, NULL))",
          "",
          "[Removed Lines]",
          "788:    out_uint8p(&token, output_tok.value, output_tok.length);",
          "",
          "[Added Lines]",
          "788:    out_uint8a(&token, output_tok.value, output_tok.length);",
          "",
          "---------------"
        ],
        "iso.c||iso.c": [
          "File: iso.c -> iso.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "85:  out_uint8(s, 0x0a);",
          "",
          "[Removed Lines]",
          "81:  out_uint8p(s, \"Cookie: mstshash=\", strlen(\"Cookie: mstshash=\"));",
          "82:  out_uint8p(s, username, strlen(username));",
          "",
          "[Added Lines]",
          "81:  out_uint8a(s, \"Cookie: mstshash=\", strlen(\"Cookie: mstshash=\"));",
          "82:  out_uint8a(s, username, strlen(username));",
          "",
          "---------------"
        ],
        "licence.c||licence.c": [
          "File: licence.c -> licence.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "79:  out_uint16(s, 0);",
          "80:  out_uint16_le(s, 0x0201);",
          "83:  out_uint16_le(s, 2);",
          "84:  out_uint16_le(s, (SEC_MODULUS_SIZE + SEC_PADDING_SIZE));",
          "86:  out_uint8s(s, SEC_PADDING_SIZE);",
          "88:  out_uint16_le(s, 1);",
          "89:  out_uint16_le(s, licence_size);",
          "92:  out_uint16_le(s, 1);",
          "93:  out_uint16_le(s, LICENCE_HWID_SIZE);",
          "98:  s_mark_end(s);",
          "99:  sec_send(s, sec_flags);",
          "",
          "[Removed Lines]",
          "82:  out_uint8p(s, client_random, SEC_RANDOM_SIZE);",
          "85:  out_uint8p(s, rsa_data, SEC_MODULUS_SIZE);",
          "90:  out_uint8p(s, licence_data, licence_size);",
          "94:  out_uint8p(s, hwid, LICENCE_HWID_SIZE);",
          "96:  out_uint8p(s, signature, LICENCE_SIGNATURE_SIZE);",
          "",
          "[Added Lines]",
          "82:  out_uint8a(s, client_random, SEC_RANDOM_SIZE);",
          "85:  out_uint8a(s, rsa_data, SEC_MODULUS_SIZE);",
          "90:  out_uint8a(s, licence_data, licence_size);",
          "94:  out_uint8a(s, hwid, LICENCE_HWID_SIZE);",
          "96:  out_uint8a(s, signature, LICENCE_SIGNATURE_SIZE);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "120:  out_uint16(s, 0);",
          "121:  out_uint16_le(s, 0xff01);",
          "124:  out_uint16_le(s, 2);",
          "125:  out_uint16_le(s, (SEC_MODULUS_SIZE + SEC_PADDING_SIZE));",
          "127:  out_uint8s(s, SEC_PADDING_SIZE);",
          "130:  out_uint16_le(s, BB_CLIENT_USER_NAME_BLOB);",
          "131:  out_uint16_le(s, userlen);",
          "135:  out_uint16_le(s, BB_CLIENT_MACHINE_NAME_BLOB);",
          "136:  out_uint16_le(s, hostlen);",
          "139:  s_mark_end(s);",
          "140:  sec_send(s, sec_flags);",
          "",
          "[Removed Lines]",
          "123:  out_uint8p(s, client_random, SEC_RANDOM_SIZE);",
          "126:  out_uint8p(s, rsa_data, SEC_MODULUS_SIZE);",
          "132:  out_uint8p(s, user, userlen);",
          "137:  out_uint8p(s, host, hostlen);",
          "",
          "[Added Lines]",
          "123:  out_uint8a(s, client_random, SEC_RANDOM_SIZE);",
          "126:  out_uint8a(s, rsa_data, SEC_MODULUS_SIZE);",
          "132:  out_uint8a(s, user, userlen);",
          "137:  out_uint8a(s, host, hostlen);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "205:  out_uint16_le(s, 1);",
          "206:  out_uint16_le(s, LICENCE_TOKEN_SIZE);",
          "209:  out_uint16_le(s, 1);",
          "210:  out_uint16_le(s, LICENCE_HWID_SIZE);",
          "215:  s_mark_end(s);",
          "216:  sec_send(s, sec_flags);",
          "",
          "[Removed Lines]",
          "207:  out_uint8p(s, token, LICENCE_TOKEN_SIZE);",
          "211:  out_uint8p(s, crypt_hwid, LICENCE_HWID_SIZE);",
          "213:  out_uint8p(s, signature, LICENCE_SIGNATURE_SIZE);",
          "",
          "[Added Lines]",
          "207:  out_uint8a(s, token, LICENCE_TOKEN_SIZE);",
          "211:  out_uint8a(s, crypt_hwid, LICENCE_HWID_SIZE);",
          "213:  out_uint8a(s, signature, LICENCE_SIGNATURE_SIZE);",
          "",
          "---------------"
        ],
        "lspci.c||lspci.c": [
          "File: lspci.c -> lspci.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "164:  len = strlen(output);",
          "165:  s = channel_init(lspci_channel, len);",
          "167:  channel_send(s, lspci_channel);",
          "168: }",
          "",
          "[Removed Lines]",
          "166:  out_uint8p(s, output, len) s_mark_end(s);",
          "",
          "[Added Lines]",
          "166:  out_uint8a(s, output, len) s_mark_end(s);",
          "",
          "---------------"
        ],
        "mcs.c||mcs.c": [
          "File: mcs.c -> mcs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "84:  ber_out_header(s, BER_TAG_OCTET_STRING, datalen);",
          "87:  s_mark_end(s);",
          "88:  iso_send(s);",
          "",
          "[Removed Lines]",
          "85:  out_uint8p(s, mcs_data->data, datalen);",
          "",
          "[Added Lines]",
          "85:  out_uint8a(s, mcs_data->data, datalen);",
          "",
          "---------------"
        ],
        "rdp.c||rdp.c": [
          "File: rdp.c -> rdp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "470:   if (g_redirect == True && 0 < g_redirect_cookie_len)",
          "471:   {",
          "473:   }",
          "474:   else",
          "475:   {",
          "",
          "[Removed Lines]",
          "472:    out_uint8p(s, g_redirect_cookie, g_redirect_cookie_len);",
          "",
          "[Added Lines]",
          "472:    out_uint8a(s, g_redirect_cookie, g_redirect_cookie_len);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1096:  out_uint16_le(s, sizeof(RDP_SOURCE));",
          "1097:  out_uint16_le(s, caplen);",
          "",
          "[Removed Lines]",
          "1099:  out_uint8p(s, RDP_SOURCE, sizeof(RDP_SOURCE));",
          "",
          "[Added Lines]",
          "1099:  out_uint8a(s, RDP_SOURCE, sizeof(RDP_SOURCE));",
          "",
          "---------------"
        ],
        "rdp5.c||rdp5.c": [
          "File: rdp5.c -> rdp5.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "140:     s_reset(assembled[code]);",
          "141:    }",
          "145:    if (frag == FASTPATH_FRAGMENT_LAST)",
          "146:    {",
          "",
          "[Removed Lines]",
          "143:    out_uint8p(assembled[code], ts->p, length);",
          "",
          "[Added Lines]",
          "143:    out_uint8a(assembled[code], ts->p, length);",
          "",
          "---------------"
        ],
        "rdpdr.c||rdpdr.c": [
          "File: rdpdr.c -> rdpdr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "385:  out_uint32_le(s, status);",
          "386:  out_uint32_le(s, result);",
          "387:  if (length)",
          "389:  s_mark_end(s);",
          "391:  logger(Protocol, Debug, \"rdpdr_send_completion()\");",
          "",
          "[Removed Lines]",
          "388:   out_uint8p(s, buffer, length);",
          "",
          "[Added Lines]",
          "388:   out_uint8a(s, buffer, length);",
          "",
          "---------------"
        ],
        "scard.c||scard.c": [
          "File: scard.c -> scard.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "548:  {",
          "549:   if (header < length)",
          "550:    length = header;",
          "552:   outRepos(out, length);",
          "553:  }",
          "554: }",
          "",
          "[Removed Lines]",
          "551:   out_uint8p(out, buffer, length);",
          "",
          "[Added Lines]",
          "551:   out_uint8a(out, buffer, length);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "624:     buffer[2 * i] = reader[i];",
          "625:    buffer[2 * i + 1] = '\\0';",
          "626:   }",
          "628:  }",
          "629:  else",
          "630:  {",
          "632:  }",
          "634:  SC_xfreeallmemory(&lcHandle);",
          "",
          "[Removed Lines]",
          "627:   out_uint8p(out, buffer, 2 * dataLength);",
          "631:   out_uint8p(out, reader, dataLength);",
          "",
          "[Added Lines]",
          "627:   out_uint8a(out, buffer, 2 * dataLength);",
          "631:   out_uint8a(out, reader, dataLength);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1255:   cur->dwEventState = swap32(cur->dwEventState);",
          "1256:   cur->cbAtr = swap32(cur->cbAtr);",
          "1259:       sizeof(SERVER_SCARD_READERSTATE_A) - 2 * sizeof(unsigned char *));",
          "1260:  }",
          "1261:  outForceAlignment(out, 8);",
          "",
          "[Removed Lines]",
          "1258:   out_uint8p(out, (void *) ((unsigned char **) cur + 2),",
          "",
          "[Added Lines]",
          "1258:   out_uint8a(out, (void *) ((unsigned char **) cur + 2),",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1419:   rsCur->dwEventState = swap32(rsCur->dwEventState);",
          "1420:   rsCur->cbAtr = swap32(rsCur->cbAtr);",
          "1423:       sizeof(SCARD_READERSTATE) - 2 * sizeof(unsigned char *));",
          "1424:  }",
          "",
          "[Removed Lines]",
          "1422:   out_uint8p(out, (void *) ((unsigned char **) rsCur + 2),",
          "",
          "[Added Lines]",
          "1422:   out_uint8a(out, (void *) ((unsigned char **) rsCur + 2),",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1795:   out_uint32_le(out, 0x00020000);",
          "1796:   out_uint32_le(out, dwState);",
          "1797:   out_uint32_le(out, dwProtocol);",
          "1799:   if (dwAtrLen < 32)",
          "1800:   {",
          "1801:    out_uint8s(out, 32 - dwAtrLen);",
          "",
          "[Removed Lines]",
          "1798:   out_uint8p(out, atr, dwAtrLen);",
          "",
          "[Added Lines]",
          "1798:   out_uint8a(out, atr, dwAtrLen);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1901:   out_uint32_le(out, dwAtrLen);",
          "1902:   out_uint32_le(out, 0x00000001);",
          "1903:   out_uint32_le(out, dwAtrLen);",
          "1905:   outRepos(out, dwAtrLen);",
          "1906:  }",
          "1907:  outForceAlignment(out, 8);",
          "",
          "[Removed Lines]",
          "1904:   out_uint8p(out, atr, dwAtrLen);",
          "",
          "[Added Lines]",
          "1904:   out_uint8a(out, atr, dwAtrLen);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "2038:   }",
          "2039:   else",
          "2040:   {",
          "2042:   }",
          "2043:   outRepos(out, dwAttrLen);",
          "2044:   out_uint32_le(out, 0x00000000);",
          "",
          "[Removed Lines]",
          "2041:    out_uint8p(out, pbAttr, dwAttrLen);",
          "",
          "[Added Lines]",
          "2041:    out_uint8a(out, pbAttr, dwAttrLen);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "2236:  out_uint32_le(out, nBytesReturned);",
          "2237:  if (nBytesReturned > 0)",
          "2238:  {",
          "2240:   outRepos(out, nBytesReturned);",
          "2241:  }",
          "",
          "[Removed Lines]",
          "2239:   out_uint8p(out, pOutBuffer, nBytesReturned);",
          "",
          "[Added Lines]",
          "2239:   out_uint8a(out, pOutBuffer, nBytesReturned);",
          "",
          "---------------"
        ],
        "seamless.c||seamless.c": [
          "File: seamless.c -> seamless.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "440:  len++;",
          "442:  s = channel_init(seamless_channel, len);",
          "445:  logger(Core, Debug, \"seamless_send(), sending '%s'\", buf);",
          "",
          "[Removed Lines]",
          "443:  out_uint8p(s, buf, len) s_mark_end(s);",
          "",
          "[Added Lines]",
          "443:  out_uint8a(s, buf, len) s_mark_end(s);",
          "",
          "---------------"
        ],
        "secure.c||secure.c": [
          "File: secure.c -> secure.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "384:  s = sec_init(flags, length + 4);",
          "386:  out_uint32_le(s, length);",
          "388:  out_uint8s(s, SEC_PADDING_SIZE);",
          "390:  s_mark_end(s);",
          "",
          "[Removed Lines]",
          "387:  out_uint8p(s, g_sec_crypted_random, g_server_public_key_len);",
          "",
          "[Added Lines]",
          "387:  out_uint8a(s, g_sec_crypted_random, g_server_public_key_len);",
          "",
          "---------------"
        ],
        "stream.h||stream.h": [
          "File: stream.h -> stream.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "127: #endif",
          "129: #define in_uint8(s,v)  { s_assert_r(s, 1); v = *((s)->p++); }",
          "130: #define in_uint8p(s,v,n) { s_assert_r(s, n); v = (s)->p; (s)->p += n; }",
          "131: #define in_uint8a(s,v,n) { s_assert_r(s, n); memcpy(v,(s)->p,n); (s)->p += n; }",
          "132: #define in_uint8s(s,n)  { s_assert_r(s, n); (s)->p += n; }",
          "133: #define out_uint8(s,v)  { s_assert_w(s, 1); *((s)->p++) = v; }",
          "136: #define out_uint8s(s,n)  { s_assert_w(s, n); memset((s)->p,0,n); (s)->p += n; }",
          "139: #define next_be(s,v)  { s_assert_r(s, 1); v = ((v) << 8) + *((s)->p++); }",
          "",
          "[Removed Lines]",
          "134: #define out_uint8p(s,v,n) { s_assert_w(s, n); memcpy((s)->p,v,n); (s)->p += n; }",
          "135: #define out_uint8a(s,v,n) out_uint8p(s,v,n);",
          "137: #define out_stream(s, v)        out_uint8p(s, (v)->data, s_length((v)))",
          "",
          "[Added Lines]",
          "137: #define out_uint8p(s,v,n) { s_assert_w(s, n); v = (s)->p; (s)->p += n; }",
          "139: #define out_uint8a(s,v,n) { s_assert_w(s, n); memcpy((s)->p,v,n); (s)->p += n; }",
          "141: #define out_stream(s, v) out_uint8a(s, (v)->data, s_length((v)))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "28b3c6b621b920c9ba4597dbab5416cf1a98f7df",
      "candidate_info": {
        "commit_hash": "28b3c6b621b920c9ba4597dbab5416cf1a98f7df",
        "repo": "rdesktop/rdesktop",
        "commit_url": "https://github.com/rdesktop/rdesktop/commit/28b3c6b621b920c9ba4597dbab5416cf1a98f7df",
        "files": [
          "orders.c"
        ],
        "message": "Explain the +7 constant while processing secondary drawing orders",
        "before_after_code_files": [
          "orders.c||orders.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "orders.c||orders.c"
          ],
          "candidate": [
            "orders.c||orders.c"
          ]
        }
      },
      "candidate_diff": {
        "orders.c||orders.c": [
          "File: orders.c -> orders.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1259:  uint16 flags;",
          "1260:  uint8 type;",
          "1261:  uint8 *next_order;",
          "",
          "[Removed Lines]",
          "1258:  uint16 length;",
          "",
          "[Added Lines]",
          "1258:  sint16 length;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1266:  in_uint8(s, type);",
          "1269:  {",
          "1270:   rdp_protocol_error(\"process_secondary_order(), next order pointer would overrun stream\", &packet);",
          "1271:  }",
          "1275:  switch (type)",
          "1276:  {",
          "",
          "[Removed Lines]",
          "1268:  if (!s_check_rem(s, (sint16) length + 7))",
          "1273:  next_order = s->p + (sint16) length + 7;",
          "",
          "[Added Lines]",
          "1268:  length += 13;  /* MS-RDPEGDI is ridiculous and says that you need to add 13 to this",
          "1270:  length -= 6;   /* Subtract six bytes of headers and you'll get the size of the remaining",
          "1273:  if (!s_check_rem(s, length))",
          "1278:  next_order = s->p + length;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e099d79879fa3662384d661a25593c661db4f823",
      "candidate_info": {
        "commit_hash": "e099d79879fa3662384d661a25593c661db4f823",
        "repo": "rdesktop/rdesktop",
        "commit_url": "https://github.com/rdesktop/rdesktop/commit/e099d79879fa3662384d661a25593c661db4f823",
        "files": [
          "asn.c",
          "lspci.c",
          "mcs.c",
          "orders.c",
          "rdp.c",
          "rdp5.c",
          "rdpdr.c",
          "rdpsnd.c",
          "seamless.c",
          "secure.c",
          "stream.h"
        ],
        "message": "Remove dangerous s_check()\n\nThis macro checks if a pointer is valid _after_ we've already used\nthat pointer. So it will only trigger if we're already performed some\nfor of buffer overflow. As such, it provides little to no value and\ncan only server to encourage broken behaviour.\n\nLet's remove it and replace it with proper bounds checking before\naccess instead.",
        "before_after_code_files": [
          "asn.c||asn.c",
          "lspci.c||lspci.c",
          "mcs.c||mcs.c",
          "orders.c||orders.c",
          "rdp.c||rdp.c",
          "rdp5.c||rdp5.c",
          "rdpdr.c||rdpdr.c",
          "rdpsnd.c||rdpsnd.c",
          "seamless.c||seamless.c",
          "secure.c||secure.c",
          "stream.h||stream.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "asn.c||asn.c",
            "lspci.c||lspci.c",
            "mcs.c||mcs.c",
            "orders.c||orders.c",
            "rdp.c||rdp.c",
            "rdpdr.c||rdpdr.c",
            "rdpsnd.c||rdpsnd.c",
            "seamless.c||seamless.c",
            "secure.c||secure.c",
            "stream.h||stream.h"
          ],
          "candidate": [
            "asn.c||asn.c",
            "lspci.c||lspci.c",
            "mcs.c||mcs.c",
            "orders.c||orders.c",
            "rdp.c||rdp.c",
            "rdpdr.c||rdpdr.c",
            "rdpsnd.c||rdpsnd.c",
            "seamless.c||seamless.c",
            "secure.c||secure.c",
            "stream.h||stream.h"
          ]
        }
      },
      "candidate_diff": {
        "asn.c||asn.c": [
          "File: asn.c -> asn.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "42:  if (tagval > 0xff)",
          "43:  {",
          "44:   in_uint16_be(s, tag);",
          "45:  }",
          "46:  else",
          "47:  {",
          "48:   in_uint8(s, tag);",
          "49:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "44:   if (!s_check_rem(s, 2)) {",
          "45:    return False;",
          "46:   }",
          "51:   if (!s_check_rem(s, 1)) {",
          "52:    return False;",
          "53:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "54:   return False;",
          "55:  }",
          "57:  in_uint8(s, len);",
          "59:  if (len & 0x80)",
          "60:  {",
          "61:   len &= ~0x80;",
          "63:   while (len--)",
          "64:    next_be(s, *length);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "63:  if (!s_check_rem(s, 1)) {",
          "64:   return False;",
          "65:  }",
          "71:   if (!s_check_rem(s, len)) {",
          "72:    return False;",
          "73:   }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "66:  else",
          "70: }",
          "72: void",
          "",
          "[Removed Lines]",
          "69:  return s_check(s);",
          "",
          "[Added Lines]",
          "81:  return True;",
          "",
          "---------------"
        ],
        "lspci.c||lspci.c": [
          "File: lspci.c -> lspci.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "135:  unsigned int pkglen;",
          "136:  static char *rest = NULL;",
          "137:  char *buf;",
          "145:  pkglen = s->end - s->p;",
          "",
          "[Removed Lines]",
          "138:  struct stream packet = *s;",
          "140:  if (!s_check(s))",
          "141:  {",
          "142:   rdp_protocol_error(\"lspci_process(), stream is in unstable state\", &packet);",
          "143:  }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "mcs.c||mcs.c": [
          "File: mcs.c -> mcs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "42: }",
          "46: mcs_parse_domain_params(STREAM s)",
          "47: {",
          "48:  uint32 length;",
          "",
          "[Removed Lines]",
          "45: static RD_BOOL",
          "",
          "[Added Lines]",
          "45: static void",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "56:  }",
          "58:  in_uint8s(s, length);",
          "61: }",
          "",
          "[Removed Lines]",
          "60:  return s_check(s);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "orders.c||orders.c": [
          "File: orders.c -> orders.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "101: }",
          "105: rdp_parse_bounds(STREAM s, BOUNDS * bounds)",
          "106: {",
          "107:  uint8 present;",
          "",
          "[Removed Lines]",
          "104: static RD_BOOL",
          "",
          "[Added Lines]",
          "104: static void",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "127:   rdp_in_coord(s, &bounds->bottom, False);",
          "128:  else if (present & 128)",
          "129:   rdp_in_coord(s, &bounds->bottom, True);",
          "132: }",
          "136: rdp_parse_pen(STREAM s, PEN * pen, uint32 present)",
          "137: {",
          "138:  if (present & 1)",
          "",
          "[Removed Lines]",
          "131:  return s_check(s);",
          "135: static RD_BOOL",
          "",
          "[Added Lines]",
          "133: static void",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "144:  if (present & 4)",
          "145:   rdp_in_colour(s, &pen->colour);",
          "148: }",
          "150: static void",
          "",
          "[Removed Lines]",
          "147:  return s_check(s);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "176: }",
          "180: rdp_parse_brush(STREAM s, BRUSH * brush, uint32 present)",
          "181: {",
          "182:  if (present & 1)",
          "",
          "[Removed Lines]",
          "179: static RD_BOOL",
          "",
          "[Added Lines]",
          "175: static void",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "194:  if (present & 16)",
          "195:   in_uint8a(s, &brush->pattern[1], 7);",
          "198: }",
          "",
          "[Removed Lines]",
          "197:  return s_check(s);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "rdp.c||rdp.c": [
          "File: rdp.c -> rdp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1417:   case RDP_POINTER_MOVE:",
          "1418:    in_uint16_le(s, x);",
          "1419:    in_uint16_le(s, y);",
          "1422:    break;",
          "1424:   case RDP_POINTER_COLOR:",
          "",
          "[Removed Lines]",
          "1420:    if (s_check(s))",
          "1421:     ui_move_pointer(x, y);",
          "",
          "[Added Lines]",
          "1420:    ui_move_pointer(x, y);",
          "",
          "---------------"
        ],
        "rdp5.c||rdp5.c": [
          "File: rdp5.c -> rdp5.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "56:   case FASTPATH_UPDATETYPE_PTR_POSITION:",
          "57:    in_uint16_le(s, x);",
          "58:    in_uint16_le(s, y);",
          "61:    break;",
          "62:   case FASTPATH_UPDATETYPE_COLOR:",
          "63:    process_colour_pointer_pdu(s);",
          "",
          "[Removed Lines]",
          "59:    if (s_check(s))",
          "60:     ui_move_pointer(x, y);",
          "",
          "[Added Lines]",
          "59:    ui_move_pointer(x, y);",
          "",
          "---------------"
        ],
        "rdpdr.c||rdpdr.c": [
          "File: rdpdr.c -> rdpdr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "877:  uint16 vmin;",
          "878:  uint16 component;",
          "879:  uint16 pakid;",
          "882:  logger(Protocol, Debug, \"rdpdr_process()\");",
          "",
          "[Removed Lines]",
          "880:  struct stream packet = *s;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "914:     if (vmin < 0x000c)",
          "",
          "[Removed Lines]",
          "904:        so lets check that we actually got",
          "905:        valid data from stream to prevent",
          "907:     if (!s_check(s))",
          "908:     {",
          "909:      rdp_protocol_error(\"rdpdr_process(), consume of g_client_id from stream did overrun\", &packet);",
          "910:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "rdpsnd.c||rdpsnd.c": [
          "File: rdpsnd.c -> rdpsnd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "451:  static char *rest = NULL;",
          "452:  char *buf;",
          "459:  pkglen = s->end - s->p;",
          "461:  buf = (char *) xmalloc(pkglen + 1);",
          "",
          "[Removed Lines]",
          "454:  if (!s_check(s))",
          "455:  {",
          "456:   rdp_protocol_error(\"rdpsnddbg_process(), stream is in unstable state\", s);",
          "457:  }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "seamless.c||seamless.c": [
          "File: seamless.c -> seamless.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "376: {",
          "377:  unsigned int pkglen;",
          "378:  char *buf;",
          "386:  pkglen = s->end - s->p;",
          "",
          "[Removed Lines]",
          "379:  struct stream packet = *s;",
          "381:  if (!s_check(s))",
          "382:  {",
          "383:   rdp_protocol_error(\"seamless_process(), stream is in unstable state\", &packet);",
          "384:  }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "secure.c||secure.c": [
          "File: secure.c -> secure.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "523: {",
          "524:  uint32 magic, modulus_len;",
          "526:  in_uint32_le(s, magic);",
          "527:  if (magic != SEC_RSA_MAGIC)",
          "528:  {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "526:  if (!s_check_rem(s, 8)) {",
          "527:   return False;",
          "528:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "541:   return False;",
          "542:  }",
          "545:  in_uint8a(s, exponent, SEC_EXPONENT_SIZE);",
          "546:  in_uint8a(s, modulus, modulus_len);",
          "547:  in_uint8s(s, SEC_PADDING_SIZE);",
          "548:  g_server_public_key_len = modulus_len;",
          "551: }",
          "",
          "[Removed Lines]",
          "550:  return s_check(s);",
          "",
          "[Added Lines]",
          "548:  if (!s_check_rem(s, 1 + SEC_EXPONENT_SIZE + modulus_len + SEC_PADDING_SIZE)) {",
          "549:   return False;",
          "550:  }",
          "558:  return True;",
          "",
          "---------------"
        ],
        "stream.h||stream.h": [
          "File: stream.h -> stream.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "55: #define s_push_layer(s,h,n) { (s)->h = (s)->p; (s)->p += n; }",
          "56: #define s_pop_layer(s,h) (s)->p = (s)->h;",
          "57: #define s_mark_end(s)  (s)->end = (s)->p;",
          "60: #define s_check_end(s)  ((s)->p == (s)->end)",
          "61: #define s_length(s)  ((s)->end - (s)->data)",
          "62: #define s_left(s)               ((s)->size - ((s)->p - (s)->data))",
          "",
          "[Removed Lines]",
          "58: #define s_check(s)  ((s)->p <= (s)->end)",
          "59: #define s_check_rem(s,n) (s_check(s) && (n <= (s)->end - (s)->p))",
          "",
          "[Added Lines]",
          "58: #define s_check_rem(s,n) (((s)->p <= (s)->end) && (n <= (s)->end - (s)->p))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6268b44f0681995562f9e29f1f21b13a96ea6e14",
      "candidate_info": {
        "commit_hash": "6268b44f0681995562f9e29f1f21b13a96ea6e14",
        "repo": "rdesktop/rdesktop",
        "commit_url": "https://github.com/rdesktop/rdesktop/commit/6268b44f0681995562f9e29f1f21b13a96ea6e14",
        "files": [
          "channels.c",
          "iso.c",
          "lspci.c",
          "mcs.c",
          "rdp.c",
          "rdpdr.c",
          "rdpsnd.c",
          "rdpsnd_alsa.c",
          "rdpsnd_libao.c",
          "rdpsnd_oss.c",
          "rdpsnd_pulse.c",
          "rdpsnd_sgi.c",
          "rdpsnd_sun.c",
          "seamless.c",
          "secure.c",
          "stream.h"
        ],
        "message": "Add macro to check remaining length of STREAM\n\nAvoids poking around in the internals, and also makes the code\neasier to read.",
        "before_after_code_files": [
          "channels.c||channels.c",
          "iso.c||iso.c",
          "lspci.c||lspci.c",
          "mcs.c||mcs.c",
          "rdp.c||rdp.c",
          "rdpdr.c||rdpdr.c",
          "rdpsnd.c||rdpsnd.c",
          "rdpsnd_alsa.c||rdpsnd_alsa.c",
          "rdpsnd_libao.c||rdpsnd_libao.c",
          "rdpsnd_oss.c||rdpsnd_oss.c",
          "rdpsnd_pulse.c||rdpsnd_pulse.c",
          "rdpsnd_sgi.c||rdpsnd_sgi.c",
          "rdpsnd_sun.c||rdpsnd_sun.c",
          "seamless.c||seamless.c",
          "secure.c||secure.c",
          "stream.h||stream.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lspci.c||lspci.c",
            "mcs.c||mcs.c",
            "rdp.c||rdp.c",
            "rdpdr.c||rdpdr.c",
            "rdpsnd.c||rdpsnd.c",
            "seamless.c||seamless.c",
            "secure.c||secure.c",
            "stream.h||stream.h"
          ],
          "candidate": [
            "lspci.c||lspci.c",
            "mcs.c||mcs.c",
            "rdp.c||rdp.c",
            "rdpdr.c||rdpdr.c",
            "rdpsnd.c||rdpsnd.c",
            "seamless.c||seamless.c",
            "secure.c||secure.c",
            "stream.h||stream.h"
          ]
        }
      },
      "candidate_diff": {
        "channels.c||channels.c": [
          "File: channels.c -> channels.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "95:  s_pop_layer(s, channel_hdr);",
          "98:  logger(Protocol, Debug, \"channel_send(), channel = %d, length = %d\", channel->mcs_id,",
          "99:         length);",
          "",
          "[Removed Lines]",
          "96:  length = s->end - s->p - 8;",
          "",
          "[Added Lines]",
          "96:  length = s_remaining(s) - 8;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "186:    in->p = in->data;",
          "187:   }",
          "190:   memcpy(in->p, s->p, thislength);",
          "191:   in->p += thislength;",
          "",
          "[Removed Lines]",
          "189:   thislength = MIN(s->end - s->p, in->data + in->size - in->p);",
          "",
          "[Added Lines]",
          "189:   thislength = MIN(s_remaining(s), in->data + in->size - in->p);",
          "",
          "---------------"
        ],
        "iso.c||iso.c": [
          "File: iso.c -> iso.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "177:  uint16 length;",
          "179:  s_pop_layer(s, iso_hdr);",
          "",
          "[Removed Lines]",
          "180:  length = s->end - s->p;",
          "",
          "[Added Lines]",
          "180:  length = s_remaining(s);",
          "",
          "---------------"
        ],
        "lspci.c||lspci.c": [
          "File: lspci.c -> lspci.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "136:  static char *rest = NULL;",
          "137:  char *buf;",
          "141:  buf = xmalloc(pkglen + 1);",
          "142:  STRNCPY(buf, (char *) s->p, pkglen + 1);",
          "",
          "[Removed Lines]",
          "139:  pkglen = s->end - s->p;",
          "",
          "[Added Lines]",
          "139:  pkglen = s_remaining(s);",
          "",
          "---------------"
        ],
        "mcs.c||mcs.c": [
          "File: mcs.c -> mcs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "306:  uint16 length;",
          "308:  s_pop_layer(s, mcs_hdr);",
          "310:  length |= 0x8000;",
          "312:  out_uint8(s, (MCS_SDRQ << 2));",
          "",
          "[Removed Lines]",
          "309:  length = s->end - s->p - 8;",
          "",
          "[Added Lines]",
          "309:  length = s_remaining(s) - 8;",
          "",
          "---------------"
        ],
        "rdp.c||rdp.c": [
          "File: rdp.c -> rdp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "194:  uint16 length;",
          "196:  s_pop_layer(s, rdp_hdr);",
          "199:  out_uint16_le(s, length);",
          "200:  out_uint16_le(s, (RDP_PDU_DATA | 0x10));",
          "",
          "[Removed Lines]",
          "197:  length = s->end - s->p;",
          "",
          "[Added Lines]",
          "197:  length = s_remaining(s);",
          "",
          "---------------"
        ],
        "rdpdr.c||rdpdr.c": [
          "File: rdpdr.c -> rdpdr.c"
        ],
        "rdpsnd.c||rdpsnd.c": [
          "File: rdpsnd.c -> rdpsnd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "343:    }",
          "345:    rdpsnd_queue_write(rdpsnd_dsp_process",
          "347:          &formats[current_format]), tick, packet_index);",
          "348:    return;",
          "349:    break;",
          "",
          "[Removed Lines]",
          "346:         (s->p, s->end - s->p, current_driver,",
          "",
          "[Added Lines]",
          "346:         (s->p, s_remaining(s), current_driver,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "387:   if (packet.size == 0)",
          "388:   {",
          "390:    {",
          "391:     logger(Sound, Error,",
          "392:            \"rdpsnd_process(), split at packet header, things will go south from here...\");",
          "",
          "[Removed Lines]",
          "389:    if ((s->end - s->p) < 4)",
          "",
          "[Added Lines]",
          "389:    if (!s_check_rem(s, 4))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "405:   }",
          "406:   else",
          "407:   {",
          "411:    if (packet_opcode == SNDC_WAVE)",
          "",
          "[Removed Lines]",
          "408:    len = MIN(s->end - s->p, packet.end - packet.p);",
          "",
          "[Added Lines]",
          "408:    len = MIN(s_remaining(s), s_remaining(&packet));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "451:  static char *rest = NULL;",
          "452:  char *buf;",
          "456:  buf = (char *) xmalloc(pkglen + 1);",
          "457:  STRNCPY(buf, (char *) s->p, pkglen + 1);",
          "",
          "[Removed Lines]",
          "454:  pkglen = s->end - s->p;",
          "",
          "[Added Lines]",
          "454:  pkglen = s_remaining(s);",
          "",
          "---------------"
        ],
        "rdpsnd_alsa.c||rdpsnd_alsa.c": [
          "File: rdpsnd_alsa.c -> rdpsnd_alsa.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "381:  next_tick = rdpsnd_queue_next_tick();",
          "384:  if ((len = snd_pcm_writei(out_handle, out->p, ((MAX_FRAMES < len) ? MAX_FRAMES : len))) < 0)",
          "385:  {",
          "386:   snd_pcm_prepare(out_handle);",
          "",
          "[Removed Lines]",
          "383:  len = (out->end - out->p) / (samplewidth_out * audiochannels_out);",
          "",
          "[Added Lines]",
          "383:  len = s_remaining(out) / (samplewidth_out * audiochannels_out);",
          "",
          "---------------"
        ],
        "rdpsnd_libao.c||rdpsnd_libao.c": [
          "File: rdpsnd_libao.c -> rdpsnd_libao.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "172:  next_tick = rdpsnd_queue_next_tick();",
          "175:  ao_play(o_device, (char *) out->p, len);",
          "176:  out->p += len;",
          "",
          "[Removed Lines]",
          "174:  len = (WAVEOUTLEN > (out->end - out->p)) ? (out->end - out->p) : WAVEOUTLEN;",
          "",
          "[Added Lines]",
          "174:  len = MIN(WAVEOUTLEN, s_remaining(out));",
          "",
          "---------------"
        ],
        "rdpsnd_oss.c||rdpsnd_oss.c": [
          "File: rdpsnd_oss.c -> rdpsnd_oss.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "412:  packet = rdpsnd_queue_current_packet();",
          "413:  out = &packet->s;",
          "417:  len = write(dsp_fd, out->p, (len > MAX_LEN) ? MAX_LEN : len);",
          "418:  if (len == -1)",
          "",
          "[Removed Lines]",
          "415:  len = out->end - out->p;",
          "",
          "[Added Lines]",
          "415:  len = s_remaining(out);",
          "",
          "---------------"
        ],
        "rdpsnd_pulse.c||rdpsnd_pulse.c": [
          "File: rdpsnd_pulse.c -> rdpsnd_pulse.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1192:    playback_seek = PA_SEEK_RELATIVE;",
          "1194:   avail_space = pa_stream_writable_size(playback_stream);",
          "1196:   if (audio_size)",
          "1197:   {",
          "1198:    if (pa_stream_write",
          "",
          "[Removed Lines]",
          "1195:   audio_size = out->end - out->p <= avail_space ? out->end - out->p : avail_space;",
          "",
          "[Added Lines]",
          "1195:   audio_size = MIN(s_remaining(out), avail_space);",
          "",
          "---------------"
        ],
        "rdpsnd_sgi.c||rdpsnd_sgi.c": [
          "File: rdpsnd_sgi.c -> rdpsnd_sgi.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "256:   packet = rdpsnd_queue_current_packet();",
          "257:   out = (STREAM) (void *) &(packet->s);",
          "261:   alWriteFrames(output_port, out->p, len / combinedFrameSize);",
          "",
          "[Removed Lines]",
          "259:   len = out->end - out->p;",
          "",
          "[Added Lines]",
          "259:   len = s_remaining(out);",
          "",
          "---------------"
        ],
        "rdpsnd_sun.c||rdpsnd_sun.c": [
          "File: rdpsnd_sun.c -> rdpsnd_sun.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "419:  packet = rdpsnd_queue_current_packet();",
          "420:  out = &packet->s;",
          "424:  len = write(dsp_fd, out->p, (len > MAX_LEN) ? MAX_LEN : len);",
          "425:  if (len == -1)",
          "",
          "[Removed Lines]",
          "422:  len = out->end - out->p;",
          "",
          "[Added Lines]",
          "422:  len = s_remaining(out);",
          "",
          "---------------"
        ],
        "seamless.c||seamless.c": [
          "File: seamless.c -> seamless.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "377:  unsigned int pkglen;",
          "378:  char *buf;",
          "382:  buf = xmalloc(pkglen + 1);",
          "383:  STRNCPY(buf, (char *) s->p, pkglen + 1);",
          "",
          "[Removed Lines]",
          "380:  pkglen = s->end - s->p;",
          "",
          "[Added Lines]",
          "380:  pkglen = s_remaining(s);",
          "",
          "---------------"
        ],
        "secure.c||secure.c": [
          "File: secure.c -> secure.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "352:  if (flags & SEC_ENCRYPT)",
          "353:  {",
          "354:   flags &= ~SEC_ENCRYPT;",
          "356:   sec_sign(s->p, 8, g_sec_sign_key, g_rc4_key_len, s->p + 8, datalen);",
          "357:   sec_encrypt(s->p + 8, datalen);",
          "358:  }",
          "",
          "[Removed Lines]",
          "355:   datalen = s->end - s->p - 8;",
          "",
          "[Added Lines]",
          "355:   datalen = s_remaining(s) - 8;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "885:     }",
          "889:    }",
          "890:    return s;",
          "891:   }",
          "",
          "[Removed Lines]",
          "888:     sec_decrypt(s->p, s->end - s->p);",
          "",
          "[Added Lines]",
          "888:     sec_decrypt(s->p, s_remaining(s));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "905:      }",
          "909:     }",
          "911:     if (sec_flags & SEC_LICENSE_PKT)",
          "",
          "[Removed Lines]",
          "908:      sec_decrypt(s->p, s->end - s->p);",
          "",
          "[Added Lines]",
          "908:      sec_decrypt(s->p, s_remaining(s));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "923:      }",
          "929:      if (s->p[0] == 0 && s->p[1] == 4)",
          "",
          "[Removed Lines]",
          "926:      sec_decrypt(s->p, s->end - s->p);",
          "",
          "[Added Lines]",
          "926:      sec_decrypt(s->p, s_remaining(s));",
          "",
          "---------------"
        ],
        "stream.h||stream.h": [
          "File: stream.h -> stream.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "60: #define s_push_layer(s,h,n) { (s)->h = (s)->p; (s)->p += n; }",
          "61: #define s_pop_layer(s,h) (s)->p = (s)->h;",
          "62: #define s_mark_end(s)  (s)->end = (s)->p;",
          "64: #define s_check_end(s)  ((s)->p == (s)->end)",
          "65: #define s_length(s)  ((s)->end - (s)->data)",
          "66: #define s_left(s)  ((s)->size - (size_t)((s)->p - (s)->data))",
          "",
          "[Removed Lines]",
          "63: #define s_check_rem(s,n) (((s)->p <= (s)->end) && ((size_t)n <= (size_t)((s)->end - (s)->p)))",
          "",
          "[Added Lines]",
          "64: #define s_remaining(s)  (size_t)((s)->end - (s)->p)",
          "65: #define s_check_rem(s,n) (((s)->p <= (s)->end) && ((size_t)n <= s_remaining(s)))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d8b0f3782a12f92fe6ca606f05b3753f4e79f342",
      "candidate_info": {
        "commit_hash": "d8b0f3782a12f92fe6ca606f05b3753f4e79f342",
        "repo": "rdesktop/rdesktop",
        "commit_url": "https://github.com/rdesktop/rdesktop/commit/d8b0f3782a12f92fe6ca606f05b3753f4e79f342",
        "files": [
          "cliprdr.c",
          "cssp.c",
          "mcs.c",
          "orders.c",
          "proto.h",
          "rdp.c",
          "rdpsnd.c",
          "secure.c"
        ],
        "message": "Give source code info in rdp_protocol_error()\n\nMakes it easier to debug things by seeing exactly where the protocol\nhandling crashed.",
        "before_after_code_files": [
          "cliprdr.c||cliprdr.c",
          "cssp.c||cssp.c",
          "mcs.c||mcs.c",
          "orders.c||orders.c",
          "proto.h||proto.h",
          "rdp.c||rdp.c",
          "rdpsnd.c||rdpsnd.c",
          "secure.c||secure.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "cliprdr.c||cliprdr.c",
            "cssp.c||cssp.c",
            "mcs.c||mcs.c",
            "orders.c||orders.c",
            "proto.h||proto.h",
            "rdp.c||rdp.c",
            "rdpsnd.c||rdpsnd.c",
            "secure.c||secure.c"
          ],
          "candidate": [
            "cliprdr.c||cliprdr.c",
            "cssp.c||cssp.c",
            "mcs.c||mcs.c",
            "orders.c||orders.c",
            "proto.h||proto.h",
            "rdp.c||rdp.c",
            "rdpsnd.c||rdpsnd.c",
            "secure.c||secure.c"
          ]
        }
      },
      "candidate_diff": {
        "cliprdr.c||cliprdr.c": [
          "File: cliprdr.c -> cliprdr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "131:  if (!s_check_rem(s, length))",
          "132:  {",
          "134:  }",
          "136:  if (status == CLIPRDR_ERROR)",
          "",
          "[Removed Lines]",
          "133:   rdp_protocol_error(\"cliprdr_process(), consume of packet from stream would overrun\", &packet);",
          "",
          "[Added Lines]",
          "133:   rdp_protocol_error(\"consume of packet from stream would overrun\", &packet);",
          "",
          "---------------"
        ],
        "cssp.c||cssp.c": [
          "File: cssp.c -> cssp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "638:  if (!s_check_rem(s, length))",
          "639:  {",
          "641:         &packet);",
          "642:  }",
          "643:  in_uint8s(s, length);",
          "",
          "[Removed Lines]",
          "640:    rdp_protocol_error(\"cssp_read_tsrequest(), consume of version from stream would overrun\",",
          "",
          "[Added Lines]",
          "640:    rdp_protocol_error(\"consume of version from stream would overrun\",",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "664:   if (!s_check_rem(s, length))",
          "665:   {",
          "667:         &packet);",
          "668:   }",
          "",
          "[Removed Lines]",
          "666:    rdp_protocol_error(\"cssp_read_tsrequest(), consume of token from stream would overrun\",",
          "",
          "[Added Lines]",
          "666:    rdp_protocol_error(\"consume of token from stream would overrun\",",
          "",
          "---------------"
        ],
        "mcs.c||mcs.c": [
          "File: mcs.c -> mcs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "53:  if (!s_check_rem(s, length))",
          "54:  {",
          "56:  }",
          "58:  in_uint8s(s, length);",
          "",
          "[Removed Lines]",
          "55:   rdp_protocol_error(\"mcs_parse_domain_params(), consume domain params from stream would overrun\", &packet);",
          "",
          "[Added Lines]",
          "55:   rdp_protocol_error(\"consume domain params from stream would overrun\", &packet);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "126:  if (!s_check_rem(s, length))",
          "127:  {",
          "129:  }",
          "131:  mcs_parse_domain_params(s);",
          "",
          "[Removed Lines]",
          "128:   rdp_protocol_error(\"mcs_recv_connect_response(), consume connect id from stream would overrun\", &packet);",
          "",
          "[Added Lines]",
          "128:   rdp_protocol_error(\"consume connect id from stream would overrun\", &packet);",
          "",
          "---------------"
        ],
        "orders.c||orders.c": [
          "File: orders.c -> orders.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1273:  if (!s_check_rem(s, length))",
          "1274:  {",
          "1276:  }",
          "1278:  next_order = s->p + length;",
          "",
          "[Removed Lines]",
          "1275:   rdp_protocol_error(\"process_secondary_order(), next order pointer would overrun stream\", &packet);",
          "",
          "[Added Lines]",
          "1275:   rdp_protocol_error(\"next order pointer would overrun stream\", &packet);",
          "",
          "---------------"
        ],
        "proto.h||proto.h": [
          "File: proto.h -> proto.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "165:       char *directory, RD_BOOL reconnect);",
          "166: void rdp_reset_state(void);",
          "167: void rdp_disconnect(void);",
          "170: int get_device_index(RD_NTHANDLE handle);",
          "171: void convert_to_unix_filename(char *filename);",
          "",
          "[Removed Lines]",
          "168: void rdp_protocol_error(const char *message, STREAM s);",
          "",
          "[Added Lines]",
          "168: #define rdp_protocol_error(m, s) _rdp_protocol_error(__FILE__, __LINE__, __func__, m, s)",
          "169: void _rdp_protocol_error(const char *file, int line, const char *func,",
          "170:     const char *message, STREAM s);",
          "",
          "---------------"
        ],
        "rdp.c||rdp.c": [
          "File: rdp.c -> rdp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "299:  if (!s_check_rem(s, in_len))",
          "300:  {",
          "302:  }",
          "",
          "[Removed Lines]",
          "301:   rdp_protocol_error(\"rdp_in_unistr(), consume of unicode data from stream would overrun\", &packet);",
          "",
          "[Added Lines]",
          "301:   rdp_protocol_error(\"consume of unicode data from stream would overrun\", &packet);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1270:  if (!s_check_rem(s, len_src_descriptor))",
          "1271:  {",
          "1273:  }",
          "1274:  in_uint8s(s, len_src_descriptor);",
          "",
          "[Removed Lines]",
          "1272:   rdp_protocol_error(\"rdp_demand_active(), consume of source descriptor from stream would overrun\", &packet);",
          "",
          "[Added Lines]",
          "1272:   rdp_protocol_error(\"consume of source descriptor from stream would overrun\", &packet);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1523:  if (!s_check_rem(s, size))",
          "1524:  {",
          "1526:  }",
          "1527:  in_uint8p(s, data, size);",
          "1528:  bmpdata = (uint8 *) xmalloc(width * height * Bpp);",
          "",
          "[Removed Lines]",
          "1525:   rdp_protocol_error(\"process_bitmap_data(), consume of bitmap data from stream would overrun\", &packet);",
          "",
          "[Added Lines]",
          "1525:   rdp_protocol_error(\"consume of bitmap data from stream would overrun\", &packet);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2114: void",
          "2116: {",
          "2118:  if (s)",
          "2119:   hexdump(s->p, s_length(s));",
          "2120:  exit(0);",
          "",
          "[Removed Lines]",
          "2115: rdp_protocol_error(const char *message, STREAM s)",
          "2117:  logger(Protocol, Error, \"%s(), %s\", __func__, message);",
          "",
          "[Added Lines]",
          "2115: _rdp_protocol_error(const char *file, int line, const char *func,",
          "2116:       const char *message, STREAM s)",
          "2118:  logger(Protocol, Error, \"%s:%d: %s(), %s\", file, line, func, message);",
          "",
          "---------------"
        ],
        "rdpsnd.c||rdpsnd.c": [
          "File: rdpsnd.c -> rdpsnd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "274:  if (!s_check_rem(in, 4))",
          "275:  {",
          "277:  }",
          "279:  in_uint16_le(in, tick);",
          "",
          "[Removed Lines]",
          "276:   rdp_protocol_error(\"rdpsnd_process_training(), consume of training data from stream would overrun\", &packet);",
          "",
          "[Added Lines]",
          "276:   rdp_protocol_error(\"consume of training data from stream would overrun\", &packet);",
          "",
          "---------------"
        ],
        "secure.c||secure.c": [
          "File: secure.c -> secure.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "873:    if (fastpath_flags & FASTPATH_OUTPUT_ENCRYPTED)",
          "874:    {",
          "875:     if (!s_check_rem(s, 8)) {",
          "877:     }",
          "",
          "[Removed Lines]",
          "876:      rdp_protocol_error(\"sec_recv(), consume fastpath signature from stream would overrun\", &packet);",
          "",
          "[Added Lines]",
          "876:      rdp_protocol_error(\"consume fastpath signature from stream would overrun\", &packet);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "893:     if (sec_flags & SEC_ENCRYPT)",
          "894:     {",
          "895:      if (!s_check_rem(s, 8)) {",
          "897:      }",
          "",
          "[Removed Lines]",
          "896:       rdp_protocol_error(\"sec_recv(), consume encrypt signature from stream would overrun\", &packet);",
          "",
          "[Added Lines]",
          "896:       rdp_protocol_error(\"consume encrypt signature from stream would overrun\", &packet);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "911:      uint8 swapbyte;",
          "913:      if (!s_check_rem(s, 8)) {",
          "915:      }",
          "",
          "[Removed Lines]",
          "914:       rdp_protocol_error(\"sec_recv(), consume redirect signature from stream would overrun\", &packet);",
          "",
          "[Added Lines]",
          "914:       rdp_protocol_error(\"consume redirect signature from stream would overrun\", &packet);",
          "",
          "---------------"
        ]
      }
    }
  ]
}