{
  "cve_id": "CVE-2017-14059",
  "cve_desc": "In FFmpeg 3.3.3, a DoS in cine_read_header() due to lack of an EOF check might cause huge CPU and memory consumption. When a crafted CINE file, which claims a large \"duration\" field in the header but does not contain sufficient backing data, is provided, the image-offset parsing loop would consume huge CPU and memory resources, since there is no EOF check inside the loop.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "7e80b63ecd259d69d383623e75b318bf2bd491f6",
  "patch_info": {
    "commit_hash": "7e80b63ecd259d69d383623e75b318bf2bd491f6",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/7e80b63ecd259d69d383623e75b318bf2bd491f6",
    "files": [
      "libavformat/cinedec.c"
    ],
    "message": "avformat/cinedec: Fix DoS due to lack of eof check\n\nFixes: loop.cine\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
    "before_after_code_files": [
      "libavformat/cinedec.c||libavformat/cinedec.c"
    ]
  },
  "patch_diff": {
    "libavformat/cinedec.c||libavformat/cinedec.c": [
      "File: libavformat/cinedec.c -> libavformat/cinedec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "269:     avio_seek(pb, offImageOffsets, SEEK_SET);",
      "271:         av_add_index_entry(st, avio_rl64(pb), i, 0, 0, AVINDEX_KEYFRAME);",
      "273:     return 0;",
      "274: }",
      "",
      "[Removed Lines]",
      "270:     for (i = 0; i < st->duration; i++)",
      "",
      "[Added Lines]",
      "270:     for (i = 0; i < st->duration; i++) {",
      "271:         if (avio_feof(pb))",
      "272:             return AVERROR_INVALIDDATA;",
      "275:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "983f90ef1819a0d4d3a5685b8a617a18eaecbd4b",
      "candidate_info": {
        "commit_hash": "983f90ef1819a0d4d3a5685b8a617a18eaecbd4b",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/983f90ef1819a0d4d3a5685b8a617a18eaecbd4b",
        "files": [
          "libavformat/cinedec.c"
        ],
        "message": "avformat/cinedec: Fix DoS due to lack of eof check\n\nFixes: loop.cine\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7e80b63ecd259d69d383623e75b318bf2bd491f6)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/cinedec.c||libavformat/cinedec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/cinedec.c||libavformat/cinedec.c"
          ],
          "candidate": [
            "libavformat/cinedec.c||libavformat/cinedec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/cinedec.c||libavformat/cinedec.c": [
          "File: libavformat/cinedec.c -> libavformat/cinedec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "269:     avio_seek(pb, offImageOffsets, SEEK_SET);",
          "271:         av_add_index_entry(st, avio_rl64(pb), i, 0, 0, AVINDEX_KEYFRAME);",
          "273:     return 0;",
          "274: }",
          "",
          "[Removed Lines]",
          "270:     for (i = 0; i < st->duration; i++)",
          "",
          "[Added Lines]",
          "270:     for (i = 0; i < st->duration; i++) {",
          "271:         if (avio_feof(pb))",
          "272:             return AVERROR_INVALIDDATA;",
          "275:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "adca94d65e5c70d9fc104abc38081fa147d7f046",
      "candidate_info": {
        "commit_hash": "adca94d65e5c70d9fc104abc38081fa147d7f046",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/adca94d65e5c70d9fc104abc38081fa147d7f046",
        "files": [
          "libavformat/cinedec.c"
        ],
        "message": "avformat/cinedec: Fix DoS due to lack of eof check\n\nFixes: loop.cine\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7e80b63ecd259d69d383623e75b318bf2bd491f6)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/cinedec.c||libavformat/cinedec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/cinedec.c||libavformat/cinedec.c"
          ],
          "candidate": [
            "libavformat/cinedec.c||libavformat/cinedec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/cinedec.c||libavformat/cinedec.c": [
          "File: libavformat/cinedec.c -> libavformat/cinedec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "269:     avio_seek(pb, offImageOffsets, SEEK_SET);",
          "271:         av_add_index_entry(st, avio_rl64(pb), i, 0, 0, AVINDEX_KEYFRAME);",
          "273:     return 0;",
          "274: }",
          "",
          "[Removed Lines]",
          "270:     for (i = 0; i < st->duration; i++)",
          "",
          "[Added Lines]",
          "270:     for (i = 0; i < st->duration; i++) {",
          "271:         if (avio_feof(pb))",
          "272:             return AVERROR_INVALIDDATA;",
          "275:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c70fdd9948085a72c8f622c6e22d9349cbf0bc75",
      "candidate_info": {
        "commit_hash": "c70fdd9948085a72c8f622c6e22d9349cbf0bc75",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/c70fdd9948085a72c8f622c6e22d9349cbf0bc75",
        "files": [
          "libavformat/cinedec.c"
        ],
        "message": "avformat/cinedec: Fix DoS due to lack of eof check\n\nFixes: loop.cine\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7e80b63ecd259d69d383623e75b318bf2bd491f6)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/cinedec.c||libavformat/cinedec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/cinedec.c||libavformat/cinedec.c"
          ],
          "candidate": [
            "libavformat/cinedec.c||libavformat/cinedec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/cinedec.c||libavformat/cinedec.c": [
          "File: libavformat/cinedec.c -> libavformat/cinedec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "269:     avio_seek(pb, offImageOffsets, SEEK_SET);",
          "271:         av_add_index_entry(st, avio_rl64(pb), i, 0, 0, AVINDEX_KEYFRAME);",
          "273:     return 0;",
          "274: }",
          "",
          "[Removed Lines]",
          "270:     for (i = 0; i < st->duration; i++)",
          "",
          "[Added Lines]",
          "270:     for (i = 0; i < st->duration; i++) {",
          "271:         if (avio_feof(pb))",
          "272:             return AVERROR_INVALIDDATA;",
          "275:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4ff1fcd3caa2e59c3d4cec8e4c64c9ac79b09a1d",
      "candidate_info": {
        "commit_hash": "4ff1fcd3caa2e59c3d4cec8e4c64c9ac79b09a1d",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/4ff1fcd3caa2e59c3d4cec8e4c64c9ac79b09a1d",
        "files": [
          "libavformat/cinedec.c"
        ],
        "message": "avformat/cinedec: Fix DoS due to lack of eof check\n\nFixes: loop.cine\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7e80b63ecd259d69d383623e75b318bf2bd491f6)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/cinedec.c||libavformat/cinedec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/cinedec.c||libavformat/cinedec.c"
          ],
          "candidate": [
            "libavformat/cinedec.c||libavformat/cinedec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/cinedec.c||libavformat/cinedec.c": [
          "File: libavformat/cinedec.c -> libavformat/cinedec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "269:     avio_seek(pb, offImageOffsets, SEEK_SET);",
          "271:         av_add_index_entry(st, avio_rl64(pb), i, 0, 0, AVINDEX_KEYFRAME);",
          "273:     return 0;",
          "274: }",
          "",
          "[Removed Lines]",
          "270:     for (i = 0; i < st->duration; i++)",
          "",
          "[Added Lines]",
          "270:     for (i = 0; i < st->duration; i++) {",
          "271:         if (avio_feof(pb))",
          "272:             return AVERROR_INVALIDDATA;",
          "275:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "98e177c7288574b336d80618f4ec5d1f94243070",
      "candidate_info": {
        "commit_hash": "98e177c7288574b336d80618f4ec5d1f94243070",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/98e177c7288574b336d80618f4ec5d1f94243070",
        "files": [
          "libavformat/cinedec.c"
        ],
        "message": "avformat/cinedec: Fix DoS due to lack of eof check\n\nFixes: loop.cine\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7e80b63ecd259d69d383623e75b318bf2bd491f6)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/cinedec.c||libavformat/cinedec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/cinedec.c||libavformat/cinedec.c"
          ],
          "candidate": [
            "libavformat/cinedec.c||libavformat/cinedec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/cinedec.c||libavformat/cinedec.c": [
          "File: libavformat/cinedec.c -> libavformat/cinedec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "269:     avio_seek(pb, offImageOffsets, SEEK_SET);",
          "271:         av_add_index_entry(st, avio_rl64(pb), i, 0, 0, AVINDEX_KEYFRAME);",
          "273:     return 0;",
          "274: }",
          "",
          "[Removed Lines]",
          "270:     for (i = 0; i < st->duration; i++)",
          "",
          "[Added Lines]",
          "270:     for (i = 0; i < st->duration; i++) {",
          "271:         if (avio_feof(pb))",
          "272:             return AVERROR_INVALIDDATA;",
          "275:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}