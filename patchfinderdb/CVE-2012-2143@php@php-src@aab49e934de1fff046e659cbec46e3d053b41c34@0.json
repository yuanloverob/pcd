{
  "cve_id": "CVE-2012-2143",
  "cve_desc": "The crypt_des (aka DES-based crypt) function in FreeBSD before 9.0-RELEASE-p2, as used in PHP, PostgreSQL, and other products, does not process the complete cleartext password if this password contains a 0x80 character, which makes it easier for context-dependent attackers to obtain access via an authentication attempt with an initial substring of the intended password, as demonstrated by a Unicode password.",
  "repo": "php/php-src",
  "patch_hash": "aab49e934de1fff046e659cbec46e3d053b41c34",
  "patch_info": {
    "commit_hash": "aab49e934de1fff046e659cbec46e3d053b41c34",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/aab49e934de1fff046e659cbec46e3d053b41c34",
    "files": [
      "NEWS",
      "ext/standard/crypt_freesec.c",
      "ext/standard/tests/strings/crypt_chars.phpt"
    ],
    "message": "fix CVE-2012-2143",
    "before_after_code_files": [
      "ext/standard/crypt_freesec.c||ext/standard/crypt_freesec.c",
      "ext/standard/tests/strings/crypt_chars.phpt||ext/standard/tests/strings/crypt_chars.phpt"
    ]
  },
  "patch_diff": {
    "ext/standard/crypt_freesec.c||ext/standard/crypt_freesec.c": [
      "File: ext/standard/crypt_freesec.c -> ext/standard/crypt_freesec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "630:  q = (u_char *) keybuf;",
      "631:  while (q - (u_char *) keybuf < sizeof(keybuf)) {",
      "633:    key++;",
      "634:  }",
      "635:  if (des_setkey((u_char *) keybuf, data))",
      "",
      "[Removed Lines]",
      "632:   if ((*q++ = *key << 1))",
      "",
      "[Added Lines]",
      "633:   if (*key)",
      "",
      "---------------"
    ],
    "ext/standard/tests/strings/crypt_chars.phpt||ext/standard/tests/strings/crypt_chars.phpt": [
      "File: ext/standard/tests/strings/crypt_chars.phpt -> ext/standard/tests/strings/crypt_chars.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: crypt() function - characters > 0x80",
      "3: --SKIPIF--",
      "4: <?php",
      "5: if (!function_exists('crypt')) {",
      "6:         die(\"SKIP crypt() is not available\");",
      "7: }",
      "8: ?>",
      "9: --FILE--",
      "10: <?php",
      "11: var_dump(crypt(\"\u00c01234abcd\", \"99\"));",
      "12: var_dump(crypt(\"\u00c09234abcd\", \"99\"));",
      "13: var_dump(crypt(\"\u00c01234abcd\", \"_01234567\"));",
      "14: var_dump(crypt(\"\u00c09234abcd\", \"_01234567\"));",
      "15: --EXPECT--",
      "16: string(13) \"99PxawtsTfX56\"",
      "17: string(13) \"99jcVcGxUZOWk\"",
      "18: string(20) \"_01234567IBjxKliXXRQ\"",
      "19: string(20) \"_012345678OSGpGQRVHA\"",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c208ad9ddbf712e20a8ce0c0930eb1684e06609a",
      "candidate_info": {
        "commit_hash": "c208ad9ddbf712e20a8ce0c0930eb1684e06609a",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/c208ad9ddbf712e20a8ce0c0930eb1684e06609a",
        "files": [
          "ext/standard/crypt_freesec.c",
          "ext/standard/tests/strings/crypt_chars.phpt"
        ],
        "message": "fix CVE-2012-2143 (cherry picked from commit bc1c1beea5b4cd1bec72d347bfd21e865258933a)",
        "before_after_code_files": [
          "ext/standard/crypt_freesec.c||ext/standard/crypt_freesec.c",
          "ext/standard/tests/strings/crypt_chars.phpt||ext/standard/tests/strings/crypt_chars.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/crypt_freesec.c||ext/standard/crypt_freesec.c",
            "ext/standard/tests/strings/crypt_chars.phpt||ext/standard/tests/strings/crypt_chars.phpt"
          ],
          "candidate": [
            "ext/standard/crypt_freesec.c||ext/standard/crypt_freesec.c",
            "ext/standard/tests/strings/crypt_chars.phpt||ext/standard/tests/strings/crypt_chars.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/crypt_freesec.c||ext/standard/crypt_freesec.c": [
          "File: ext/standard/crypt_freesec.c -> ext/standard/crypt_freesec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "630:  q = (u_char *) keybuf;",
          "631:  while (q - (u_char *) keybuf < sizeof(keybuf)) {",
          "633:    key++;",
          "634:  }",
          "635:  if (des_setkey((u_char *) keybuf, data))",
          "",
          "[Removed Lines]",
          "632:   if ((*q++ = *key << 1))",
          "",
          "[Added Lines]",
          "633:   if (*key)",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/crypt_chars.phpt||ext/standard/tests/strings/crypt_chars.phpt": [
          "File: ext/standard/tests/strings/crypt_chars.phpt -> ext/standard/tests/strings/crypt_chars.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: crypt() function - characters > 0x80",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!function_exists('crypt')) {",
          "6:         die(\"SKIP crypt() is not available\");",
          "7: }",
          "8: ?>",
          "9: --FILE--",
          "10: <?php",
          "11: var_dump(crypt(\"\u00c01234abcd\", \"99\"));",
          "12: var_dump(crypt(\"\u00c09234abcd\", \"99\"));",
          "13: var_dump(crypt(\"\u00c01234abcd\", \"_01234567\"));",
          "14: var_dump(crypt(\"\u00c09234abcd\", \"_01234567\"));",
          "15: --EXPECT--",
          "16: string(13) \"99PxawtsTfX56\"",
          "17: string(13) \"99jcVcGxUZOWk\"",
          "18: string(20) \"_01234567IBjxKliXXRQ\"",
          "19: string(20) \"_012345678OSGpGQRVHA\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bc1c1beea5b4cd1bec72d347bfd21e865258933a",
      "candidate_info": {
        "commit_hash": "bc1c1beea5b4cd1bec72d347bfd21e865258933a",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/bc1c1beea5b4cd1bec72d347bfd21e865258933a",
        "files": [
          "NEWS",
          "ext/standard/crypt_freesec.c",
          "ext/standard/tests/strings/crypt_chars.phpt"
        ],
        "message": "fix CVE-2012-2143",
        "before_after_code_files": [
          "ext/standard/crypt_freesec.c||ext/standard/crypt_freesec.c",
          "ext/standard/tests/strings/crypt_chars.phpt||ext/standard/tests/strings/crypt_chars.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/crypt_freesec.c||ext/standard/crypt_freesec.c",
            "ext/standard/tests/strings/crypt_chars.phpt||ext/standard/tests/strings/crypt_chars.phpt"
          ],
          "candidate": [
            "ext/standard/crypt_freesec.c||ext/standard/crypt_freesec.c",
            "ext/standard/tests/strings/crypt_chars.phpt||ext/standard/tests/strings/crypt_chars.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/crypt_freesec.c||ext/standard/crypt_freesec.c": [
          "File: ext/standard/crypt_freesec.c -> ext/standard/crypt_freesec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "630:  q = (u_char *) keybuf;",
          "631:  while (q - (u_char *) keybuf < sizeof(keybuf)) {",
          "633:    key++;",
          "634:  }",
          "635:  if (des_setkey((u_char *) keybuf, data))",
          "",
          "[Removed Lines]",
          "632:   if ((*q++ = *key << 1))",
          "",
          "[Added Lines]",
          "633:   if (*key)",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/crypt_chars.phpt||ext/standard/tests/strings/crypt_chars.phpt": [
          "File: ext/standard/tests/strings/crypt_chars.phpt -> ext/standard/tests/strings/crypt_chars.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: crypt() function - characters > 0x80",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!function_exists('crypt')) {",
          "6:         die(\"SKIP crypt() is not available\");",
          "7: }",
          "8: ?>",
          "9: --FILE--",
          "10: <?php",
          "11: var_dump(crypt(\"\u00c01234abcd\", \"99\"));",
          "12: var_dump(crypt(\"\u00c09234abcd\", \"99\"));",
          "13: var_dump(crypt(\"\u00c01234abcd\", \"_01234567\"));",
          "14: var_dump(crypt(\"\u00c09234abcd\", \"_01234567\"));",
          "15: --EXPECT--",
          "16: string(13) \"99PxawtsTfX56\"",
          "17: string(13) \"99jcVcGxUZOWk\"",
          "18: string(20) \"_01234567IBjxKliXXRQ\"",
          "19: string(20) \"_012345678OSGpGQRVHA\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}