{
  "cve_id": "CVE-2016-7411",
  "cve_desc": "ext/standard/var_unserializer.re in PHP before 5.6.26 mishandles object-deserialization failures, which allows remote attackers to cause a denial of service (memory corruption) or possibly have unspecified other impact via an unserialize call that references a partially constructed object.",
  "repo": "php/php-src",
  "patch_hash": "6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
  "patch_info": {
    "commit_hash": "6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/6a7cc8ff85827fa9ac715b3a83c2d9147f33cd43",
    "files": [
      "Zend/zend_objects_API.c",
      "ext/standard/tests/serialize/bug73052.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #73052 - Memory Corruption in During Deserialized-object Destruction",
    "before_after_code_files": [
      "Zend/zend_objects_API.c||Zend/zend_objects_API.c",
      "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "Zend/zend_objects_API.c||Zend/zend_objects_API.c": [
      "File: Zend/zend_objects_API.c -> Zend/zend_objects_API.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "306: {",
      "307:  zend_object_handle handle = Z_OBJ_HANDLE_P(zobject);",
      "308:  zend_object_store_bucket *obj_bucket = &EG(objects_store).object_buckets[handle];",
      "311:  obj_bucket->destructor_called = 1;",
      "312: }",
      "",
      "[Removed Lines]",
      "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);;",
      "",
      "[Added Lines]",
      "310:  obj_bucket->bucket.obj.handlers = Z_OBJ_HT_P(zobject);",
      "",
      "---------------"
    ],
    "ext/standard/tests/serialize/bug73052.phpt||ext/standard/tests/serialize/bug73052.phpt": [
      "File: ext/standard/tests/serialize/bug73052.phpt -> ext/standard/tests/serialize/bug73052.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #73052: Memory Corruption in During Deserialized-object Destruction",
      "3: --FILE--",
      "4: <?php",
      "6: class obj {",
      "7:     var $ryat;",
      "8:     public function __destruct() {",
      "9:         $this->ryat = null;",
      "10:     }",
      "11: }",
      "13: $poc = 'O:3:\"obj\":1:{';",
      "14: var_dump(unserialize($poc));",
      "15: ?>",
      "16: --EXPECTF--",
      "17: Notice: unserialize(): Error at offset 13 of 13 bytes in %sbug73052.php on line %d",
      "18: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "438:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
      "439:         zend_hash_clean(Z_OBJPROP_PP(rval));",
      "440:      }",
      "441:      ZVAL_NULL(*rval);",
      "442:   return 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "440:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "495: {",
      "496:  YYCTYPE yych;",
      "497:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "494: #line 495 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "495: #line 496 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "551:  yych = *(YYMARKER = ++YYCURSOR);",
      "552:  if (yych == ':') goto yy95;",
      "553: yy3:",
      "555:  { return 0; }",
      "557: yy4:",
      "558:  yych = *(YYMARKER = ++YYCURSOR);",
      "559:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "554: #line 860 \"ext/standard/var_unserializer.re\"",
      "556: #line 557 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "555: #line 861 \"ext/standard/var_unserializer.re\"",
      "557: #line 558 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "596:  goto yy3;",
      "597: yy14:",
      "598:  ++YYCURSOR;",
      "600:  {",
      "602:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "604: }",
      "606: yy16:",
      "607:  yych = *++YYCURSOR;",
      "608:  goto yy3;",
      "",
      "[Removed Lines]",
      "599: #line 854 \"ext/standard/var_unserializer.re\"",
      "605: #line 606 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "600: #line 855 \"ext/standard/var_unserializer.re\"",
      "606: #line 607 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "633:  yych = *++YYCURSOR;",
      "634:  if (yych != '\"') goto yy18;",
      "635:  ++YYCURSOR;",
      "637:  {",
      "638:  size_t len, len2, len3, maxlen;",
      "639:  long elements;",
      "",
      "[Removed Lines]",
      "636: #line 707 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "637: #line 708 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "781:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "782: }",
      "784: yy25:",
      "785:  yych = *++YYCURSOR;",
      "786:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "783: #line 784 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "784: #line 785 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "805:  yych = *++YYCURSOR;",
      "806:  if (yych != '\"') goto yy18;",
      "807:  ++YYCURSOR;",
      "809:  {",
      "810:     if (!var_hash) return 0;",
      "",
      "[Removed Lines]",
      "808: #line 698 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "809: #line 699 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "814:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "815:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "816: }",
      "818: yy32:",
      "819:  yych = *++YYCURSOR;",
      "820:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "817: #line 818 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "818: #line 819 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "835:  yych = *++YYCURSOR;",
      "836:  if (yych != '{') goto yy18;",
      "837:  ++YYCURSOR;",
      "839:  {",
      "840:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "838: #line 677 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "839: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "857:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "858: }",
      "860: yy39:",
      "861:  yych = *++YYCURSOR;",
      "862:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "859: #line 860 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "860: #line 861 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "877:  yych = *++YYCURSOR;",
      "878:  if (yych != '\"') goto yy18;",
      "879:  ++YYCURSOR;",
      "881:  {",
      "882:  size_t len, maxlen;",
      "883:  char *str;",
      "",
      "[Removed Lines]",
      "880: #line 642 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "881: #line 643 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "912:  ZVAL_STRINGL(*rval, str, len, 0);",
      "913:  return 1;",
      "914: }",
      "916: yy46:",
      "917:  yych = *++YYCURSOR;",
      "918:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "915: #line 916 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "916: #line 917 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "933:  yych = *++YYCURSOR;",
      "934:  if (yych != '\"') goto yy18;",
      "935:  ++YYCURSOR;",
      "937:  {",
      "938:  size_t len, maxlen;",
      "939:  char *str;",
      "",
      "[Removed Lines]",
      "936: #line 609 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "937: #line 610 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "966:  ZVAL_STRINGL(*rval, str, len, 1);",
      "967:  return 1;",
      "968: }",
      "970: yy53:",
      "971:  yych = *++YYCURSOR;",
      "972:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "969: #line 970 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "970: #line 971 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1054:  }",
      "1055: yy63:",
      "1056:  ++YYCURSOR;",
      "1058:  {",
      "1059: #if SIZEOF_LONG == 4",
      "1060: use_double:",
      "",
      "[Removed Lines]",
      "1057: #line 599 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1058: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1064:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1065:  return 1;",
      "1066: }",
      "1068: yy65:",
      "1069:  yych = *++YYCURSOR;",
      "1070:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1067: #line 1068 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1123:  yych = *++YYCURSOR;",
      "1124:  if (yych != ';') goto yy18;",
      "1125:  ++YYCURSOR;",
      "1127:  {",
      "1129:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1126: #line 584 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1127: #line 585 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1139:  return 1;",
      "1140: }",
      "1142: yy76:",
      "1143:  yych = *++YYCURSOR;",
      "1144:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1165:  if (yych <= '9') goto yy79;",
      "1166:  if (yych != ';') goto yy18;",
      "1167:  ++YYCURSOR;",
      "1169:  {",
      "1170: #if SIZEOF_LONG == 4",
      "1171:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1168: #line 557 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1169: #line 558 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1192:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1193:  return 1;",
      "1194: }",
      "1196: yy83:",
      "1197:  yych = *++YYCURSOR;",
      "1198:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1195: #line 1196 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1200:  yych = *++YYCURSOR;",
      "1201:  if (yych != ';') goto yy18;",
      "1202:  ++YYCURSOR;",
      "1204:  {",
      "1206:  INIT_PZVAL(*rval);",
      "1207:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1208:  return 1;",
      "1209: }",
      "1211: yy87:",
      "1212:  ++YYCURSOR;",
      "1214:  {",
      "1216:  INIT_PZVAL(*rval);",
      "1217:  ZVAL_NULL(*rval);",
      "1218:  return 1;",
      "1219: }",
      "1221: yy89:",
      "1222:  yych = *++YYCURSOR;",
      "1223:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1203: #line 550 \"ext/standard/var_unserializer.re\"",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "1213: #line 543 \"ext/standard/var_unserializer.re\"",
      "1220: #line 1221 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1204: #line 551 \"ext/standard/var_unserializer.re\"",
      "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
      "1214: #line 544 \"ext/standard/var_unserializer.re\"",
      "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1240:  if (yych <= '9') goto yy91;",
      "1241:  if (yych != ';') goto yy18;",
      "1242:  ++YYCURSOR;",
      "1244:  {",
      "1245:  long id;",
      "",
      "[Removed Lines]",
      "1243: #line 520 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1244: #line 521 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1264:  return 1;",
      "1265: }",
      "1267: yy95:",
      "1268:  yych = *++YYCURSOR;",
      "1269:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1266: #line 1267 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1286:  if (yych <= '9') goto yy97;",
      "1287:  if (yych != ';') goto yy18;",
      "1288:  ++YYCURSOR;",
      "1290:  {",
      "1291:  long id;",
      "",
      "[Removed Lines]",
      "1289: #line 499 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1290: #line 500 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1308:  return 1;",
      "1309: }",
      "1311: }",
      "1315:  return 0;",
      "",
      "[Removed Lines]",
      "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
      "1312: #line 862 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
      "1313: #line 863 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "442:      if(Z_TYPE_PP(rval) == IS_OBJECT) {",
      "443:         zend_hash_clean(Z_OBJPROP_PP(rval));",
      "444:      }",
      "445:      ZVAL_NULL(*rval);",
      "446:   return 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "444:         zend_object_store_ctor_failed(*rval TSRMLS_CC);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
      "candidate_info": {
        "commit_hash": "6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6a6cdecbdbe0846451eaee38f7bc55a81c651d80",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Improved unserialize()",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "322: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "323: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "326: {",
          "327:  while (elements-- > 0) {",
          "328:   zval key, *data, d, *old_data;",
          "330:   ZVAL_UNDEF(&key);",
          "",
          "[Removed Lines]",
          "325: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "",
          "[Added Lines]",
          "325: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "329:   zend_ulong idx;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "334:    return 0;",
          "335:   }",
          "342:   data = NULL;",
          "343:   ZVAL_UNDEF(&d);",
          "345:   if (!objprops) {",
          "350:      var_push_dtor(var_hash, old_data);",
          "351:     }",
          "357:      var_push_dtor(var_hash, old_data);",
          "358:     }",
          "361:    }",
          "362:   } else {",
          "368:     }",
          "372:   }",
          "374:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "337:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "338:    zval_dtor(&key);",
          "339:    return 0;",
          "340:   }",
          "346:    switch (Z_TYPE(key)) {",
          "347:    case IS_LONG:",
          "348:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "352:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "353:     break;",
          "354:    case IS_STRING:",
          "355:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "359:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "360:     break;",
          "364:    convert_to_string(&key);",
          "365:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "366:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "367:      old_data = Z_INDIRECT_P(old_data);",
          "369:     var_push_dtor(var_hash, old_data);",
          "370:    }",
          "371:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "342:    if (Z_TYPE(key) == IS_LONG) {",
          "343:     idx = Z_LVAL(key);",
          "344: numeric_key:",
          "345:     if (UNEXPECTED((old_data = zend_hash_index_find(ht, idx)) != NULL)) {",
          "348:      data = zend_hash_index_update(ht, idx, &d);",
          "349:     } else {",
          "350:      data = zend_hash_index_add_new(ht, idx, &d);",
          "351:     }",
          "352:    } else if (Z_TYPE(key) == IS_STRING) {",
          "353:     if (UNEXPECTED(ZEND_HANDLE_NUMERIC(Z_STR(key), idx))) {",
          "354:      goto numeric_key;",
          "356:     if (UNEXPECTED((old_data = zend_hash_find(ht, Z_STR(key))) != NULL)) {",
          "359:      data = zend_hash_update(ht, Z_STR(key), &d);",
          "360:     } else {",
          "361:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "363:    } else {",
          "364:     zval_dtor(&key);",
          "365:     return 0;",
          "368:    if (EXPECTED(Z_TYPE(key) == IS_STRING)) {",
          "369: string_key:",
          "370:     if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "371:      if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "372:       old_data = Z_INDIRECT_P(old_data);",
          "373:      }",
          "374:      var_push_dtor(var_hash, old_data);",
          "375:      data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "376:     } else {",
          "377:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "379:    } else if (Z_TYPE(key) == IS_LONG) {",
          "381:     convert_to_string(&key);",
          "382:     goto string_key;",
          "383:    } else {",
          "384:     zval_dtor(&key);",
          "385:     return 0;",
          "386:    }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "507:  start = cursor;",
          "511: {",
          "512:  YYCTYPE yych;",
          "513:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "510: #line 511 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "525: #line 526 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "567:  yych = *(YYMARKER = ++YYCURSOR);",
          "568:  if (yych == ':') goto yy95;",
          "569: yy3:",
          "571:  { return 0; }",
          "573: yy4:",
          "574:  yych = *(YYMARKER = ++YYCURSOR);",
          "575:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "570: #line 858 \"ext/standard/var_unserializer.re\"",
          "572: #line 573 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "585: #line 873 \"ext/standard/var_unserializer.re\"",
          "587: #line 588 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "612:  goto yy3;",
          "613: yy14:",
          "614:  ++YYCURSOR;",
          "616:  {",
          "618:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "620: }",
          "622: yy16:",
          "623:  yych = *++YYCURSOR;",
          "624:  goto yy3;",
          "",
          "[Removed Lines]",
          "615: #line 852 \"ext/standard/var_unserializer.re\"",
          "621: #line 622 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "630: #line 867 \"ext/standard/var_unserializer.re\"",
          "636: #line 637 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "644:  if (yybm[0+yych] & 128) {",
          "645:   goto yy20;",
          "646:  }",
          "649:  yych = *++YYCURSOR;",
          "650:  if (yych != '\"') goto yy18;",
          "651:  ++YYCURSOR;",
          "653:  {",
          "654:  size_t len, len2, len3, maxlen;",
          "655:  zend_long elements;",
          "",
          "[Removed Lines]",
          "647:  if (yych <= '/') goto yy18;",
          "648:  if (yych >= ';') goto yy18;",
          "652: #line 707 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "662:  if (yych != ':') goto yy18;",
          "666: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "795:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "796: }",
          "798: yy25:",
          "799:  yych = *++YYCURSOR;",
          "800:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "811: #line 812 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "819:  yych = *++YYCURSOR;",
          "820:  if (yych != '\"') goto yy18;",
          "821:  ++YYCURSOR;",
          "823:  {",
          "",
          "[Removed Lines]",
          "822: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "836: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "827:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "828:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "829: }",
          "831: yy32:",
          "832:  yych = *++YYCURSOR;",
          "833:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "830: #line 831 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "844: #line 845 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "848:  yych = *++YYCURSOR;",
          "849:  if (yych != '{') goto yy18;",
          "850:  ++YYCURSOR;",
          "852:  {",
          "853:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "851: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "865: #line 693 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "870:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "871: }",
          "873: yy39:",
          "874:  yych = *++YYCURSOR;",
          "875:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "872: #line 873 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "886: #line 887 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "890:  yych = *++YYCURSOR;",
          "891:  if (yych != '\"') goto yy18;",
          "892:  ++YYCURSOR;",
          "894:  {",
          "895:  size_t len, maxlen;",
          "896:  zend_string *str;",
          "",
          "[Removed Lines]",
          "893: #line 650 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "907: #line 665 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "918:  ZVAL_STR(rval, str);",
          "919:  return 1;",
          "920: }",
          "922: yy46:",
          "923:  yych = *++YYCURSOR;",
          "924:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "921: #line 922 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "939:  yych = *++YYCURSOR;",
          "940:  if (yych != '\"') goto yy18;",
          "941:  ++YYCURSOR;",
          "943:  {",
          "944:  size_t len, maxlen;",
          "945:  char *str;",
          "",
          "[Removed Lines]",
          "942: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "956: #line 638 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "966:  ZVAL_STRINGL(rval, str, len);",
          "967:  return 1;",
          "968: }",
          "970: yy53:",
          "971:  yych = *++YYCURSOR;",
          "972:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "969: #line 970 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "983: #line 984 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1054:  }",
          "1055: yy63:",
          "1056:  ++YYCURSOR;",
          "1058:  {",
          "1059: #if SIZEOF_ZEND_LONG == 4",
          "1060: use_double:",
          "",
          "[Removed Lines]",
          "1057: #line 614 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1071: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1063:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1064:  return 1;",
          "1065: }",
          "1067: yy65:",
          "1068:  yych = *++YYCURSOR;",
          "1069:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1080: #line 1081 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1122:  yych = *++YYCURSOR;",
          "1123:  if (yych != ';') goto yy18;",
          "1124:  ++YYCURSOR;",
          "1126:  {",
          "",
          "[Removed Lines]",
          "1125: #line 598 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1139: #line 613 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1139:  return 1;",
          "1140: }",
          "1142: yy76:",
          "1143:  yych = *++YYCURSOR;",
          "1144:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1141: #line 1142 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1155: #line 1156 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1165:  if (yych <= '9') goto yy79;",
          "1166:  if (yych != ';') goto yy18;",
          "1167:  ++YYCURSOR;",
          "1169:  {",
          "1170: #if SIZEOF_ZEND_LONG == 4",
          "1171:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1168: #line 572 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1182: #line 587 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1191:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1192:  return 1;",
          "1193: }",
          "1195: yy83:",
          "1196:  yych = *++YYCURSOR;",
          "1197:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1199:  yych = *++YYCURSOR;",
          "1200:  if (yych != ';') goto yy18;",
          "1201:  ++YYCURSOR;",
          "1203:  {",
          "1205:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1206:  return 1;",
          "1207: }",
          "1209: yy87:",
          "1210:  ++YYCURSOR;",
          "1212:  {",
          "1214:  ZVAL_NULL(rval);",
          "1215:  return 1;",
          "1216: }",
          "1218: yy89:",
          "1219:  yych = *++YYCURSOR;",
          "1220:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1202: #line 566 \"ext/standard/var_unserializer.re\"",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "1211: #line 560 \"ext/standard/var_unserializer.re\"",
          "1217: #line 1218 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1216: #line 581 \"ext/standard/var_unserializer.re\"",
          "1222: #line 1223 \"ext/standard/var_unserializer.c\"",
          "1225: #line 575 \"ext/standard/var_unserializer.re\"",
          "1231: #line 1232 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1237:  if (yych <= '9') goto yy91;",
          "1238:  if (yych != ';') goto yy18;",
          "1239:  ++YYCURSOR;",
          "1241:  {",
          "1242:  zend_long id;",
          "",
          "[Removed Lines]",
          "1240: #line 537 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1254: #line 552 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1261:  return 1;",
          "1262: }",
          "1264: yy95:",
          "1265:  yych = *++YYCURSOR;",
          "1266:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1263: #line 1264 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1283:  if (yych <= '9') goto yy97;",
          "1284:  if (yych != ';') goto yy18;",
          "1285:  ++YYCURSOR;",
          "1287:  {",
          "1288:  zend_long id;",
          "",
          "[Removed Lines]",
          "1286: #line 515 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1300: #line 530 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1306:  return 1;",
          "1307: }",
          "1309: }",
          "1313:  return 0;",
          "",
          "[Removed Lines]",
          "1308: #line 1309 \"ext/standard/var_unserializer.c\"",
          "1310: #line 860 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "1324: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "326: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes",
          "327: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes",
          "330: {",
          "331:  while (elements-- > 0) {",
          "332:   zval key, *data, d, *old_data;",
          "334:   ZVAL_UNDEF(&key);",
          "",
          "[Removed Lines]",
          "329: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "",
          "[Added Lines]",
          "329: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "333:   zend_ulong idx;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "338:    return 0;",
          "339:   }",
          "346:   data = NULL;",
          "347:   ZVAL_UNDEF(&d);",
          "349:   if (!objprops) {",
          "354:      var_push_dtor(var_hash, old_data);",
          "355:     }",
          "361:      var_push_dtor(var_hash, old_data);",
          "362:     }",
          "365:    }",
          "366:   } else {",
          "372:     }",
          "376:   }",
          "378:   zval_dtor(&key);",
          "",
          "[Removed Lines]",
          "341:   if (Z_TYPE(key) != IS_LONG && Z_TYPE(key) != IS_STRING) {",
          "342:    zval_dtor(&key);",
          "343:    return 0;",
          "344:   }",
          "350:    switch (Z_TYPE(key)) {",
          "351:    case IS_LONG:",
          "352:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "356:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "357:     break;",
          "358:    case IS_STRING:",
          "359:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "363:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "364:     break;",
          "368:    convert_to_string(&key);",
          "369:    if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "370:     if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "371:      old_data = Z_INDIRECT_P(old_data);",
          "373:     var_push_dtor(var_hash, old_data);",
          "374:    }",
          "375:    data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "",
          "[Added Lines]",
          "346:    if (Z_TYPE(key) == IS_LONG) {",
          "347:     idx = Z_LVAL(key);",
          "348: numeric_key:",
          "349:     if (UNEXPECTED((old_data = zend_hash_index_find(ht, idx)) != NULL)) {",
          "352:      data = zend_hash_index_update(ht, idx, &d);",
          "353:     } else {",
          "354:      data = zend_hash_index_add_new(ht, idx, &d);",
          "356:    } else if (Z_TYPE(key) == IS_STRING) {",
          "357:     if (UNEXPECTED(ZEND_HANDLE_NUMERIC(Z_STR(key), idx))) {",
          "358:      goto numeric_key;",
          "359:     }",
          "360:     if (UNEXPECTED((old_data = zend_hash_find(ht, Z_STR(key))) != NULL)) {",
          "363:      data = zend_hash_update(ht, Z_STR(key), &d);",
          "364:     } else {",
          "365:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "367:    } else {",
          "368:     zval_dtor(&key);",
          "369:     return 0;",
          "372:    if (EXPECTED(Z_TYPE(key) == IS_STRING)) {",
          "373: string_key:",
          "374:     if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "375:      if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "376:       old_data = Z_INDIRECT_P(old_data);",
          "377:      }",
          "378:      var_push_dtor(var_hash, old_data);",
          "379:      data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "380:     } else {",
          "381:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "383:    } else if (Z_TYPE(key) == IS_LONG) {",
          "385:     convert_to_string(&key);",
          "386:     goto string_key;",
          "387:    } else {",
          "388:     zval_dtor(&key);",
          "389:     return 0;",
          "390:    }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1a23ebc1fff59bf480ca92963b36eba5c1b904c4",
      "candidate_info": {
        "commit_hash": "1a23ebc1fff59bf480ca92963b36eba5c1b904c4",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/1a23ebc1fff59bf480ca92963b36eba5c1b904c4",
        "files": [
          "NEWS",
          "ext/standard/tests/serialize/bug74103.phpt",
          "ext/standard/tests/serialize/bug75054.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #74103 and bug #75054\n\nDirectly fail unserialization when trying to acquire an r/R\nreference to an UNDEF HT slot. Previously this left an UNDEF and\nlater deleted the index/key from the HT.\n\nWhat actually caused the issue here is a combination of two\nfactors: First, the key deletion was performed using the hash API,\nrather than the symtable API, such that the element was not actually\nremoved if it used an integral string key. Second, a subsequent\ndeletion operation, while collecting trailing UNDEF ranges, would\nmark the element as available for reuse (leaving a corrupted HT\nstate with nNumOfElemnts > nNumUsed).\n\nFix this by failing early and dropping the deletion code.",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt",
          "ext/standard/tests/serialize/bug75054.phpt||ext/standard/tests/serialize/bug75054.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt": [
          "File: ext/standard/tests/serialize/bug74103.phpt -> ext/standard/tests/serialize/bug74103.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74103: heap-use-after-free when unserializing invalid array size",
          "3: --FILE--",
          "4: <?php",
          "5: var_dump(unserialize('a:7:{i:0;i:04;s:1:\"a\";i:2;i:00009617006;i:4;s:1:\"a\";i:4;s:1:\"a\";R:5;s:1:\"7\";R:3;s:1:\"a\";R:5;;s:18;}}'));",
          "6: ?>",
          "7: --EXPECTF--",
          "8: Notice: unserialize(): Error at offset 68 of 100 bytes in %s on line %d",
          "9: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug75054.phpt||ext/standard/tests/serialize/bug75054.phpt": [
          "File: ext/standard/tests/serialize/bug75054.phpt -> ext/standard/tests/serialize/bug75054.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #75054: A Denial of Service Vulnerability was found when performing deserialization",
          "3: --FILE--",
          "4: <?php",
          "5: $poc = 'a:9:{i:0;s:4:\"0000\";i:0;s:4:\"0000\";i:0;R:2;s:4:\"5003\";R:2;s:4:\"0000\";R:2;s:4:\"0000\";R:2;s:4:\"';",
          "6: $poc .= \"\\x06\";",
          "7: $poc .= '000\";R:2;s:4:\"0000\";d:0;s:4:\"0000\";a:9:{s:4:\"0000\";';",
          "8: var_dump(unserialize($poc));",
          "9: ?>",
          "10: --EXPECTF--",
          "11: Notice: unserialize(): Error at offset 43 of 145 bytes in %s on line %d",
          "12: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "405:    return 0;",
          "406:   }",
          "418:   zval_dtor(&key);",
          "420:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "",
          "[Removed Lines]",
          "408:   if (UNEXPECTED(Z_ISUNDEF_P(data))) {",
          "409:    if (Z_TYPE(key) == IS_LONG) {",
          "410:     zend_hash_index_del(ht, Z_LVAL(key));",
          "411:    } else {",
          "412:     zend_hash_del_ind(ht, Z_STR(key));",
          "413:    }",
          "414:   } else {",
          "415:    var_push_dtor(var_hash, data);",
          "416:   }",
          "",
          "[Added Lines]",
          "408:   var_push_dtor(var_hash, data);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "581:  start = cursor;",
          "585: {",
          "586:  YYCTYPE yych;",
          "587:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "584: #line 585 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "575: #line 576 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "622:  yych = *YYCURSOR;",
          "623:  switch (yych) {",
          "624:  case 'C':",
          "626:  case 'N': goto yy5;",
          "633:  case 'o': goto yy12;",
          "638:  }",
          "639: yy2:",
          "642: yy3:",
          "644:  { return 0; }",
          "646: yy4:",
          "647:  yych = *(YYMARKER = ++YYCURSOR);",
          "649:  goto yy3;",
          "650: yy5:",
          "651:  yych = *++YYCURSOR;",
          "653:  goto yy3;",
          "654: yy6:",
          "655:  yych = *(YYMARKER = ++YYCURSOR);",
          "657:  goto yy3;",
          "658: yy7:",
          "659:  yych = *(YYMARKER = ++YYCURSOR);",
          "661:  goto yy3;",
          "662: yy8:",
          "663:  yych = *(YYMARKER = ++YYCURSOR);",
          "665:  goto yy3;",
          "666: yy9:",
          "667:  yych = *(YYMARKER = ++YYCURSOR);",
          "669:  goto yy3;",
          "670: yy10:",
          "671:  yych = *(YYMARKER = ++YYCURSOR);",
          "673:  goto yy3;",
          "674: yy11:",
          "675:  yych = *(YYMARKER = ++YYCURSOR);",
          "677:  goto yy3;",
          "678: yy12:",
          "679:  yych = *(YYMARKER = ++YYCURSOR);",
          "681:  goto yy3;",
          "682: yy13:",
          "683:  yych = *(YYMARKER = ++YYCURSOR);",
          "685:  goto yy3;",
          "686: yy14:",
          "687:  ++YYCURSOR;",
          "689:  {",
          "691:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "693: }",
          "698: yy17:",
          "699:  yych = *++YYCURSOR;",
          "700:  if (yybm[0+yych] & 128) {",
          "702:  }",
          "704: yy18:",
          "705:  YYCURSOR = YYMARKER;",
          "706:  goto yy3;",
          "707: yy19:",
          "708:  yych = *++YYCURSOR;",
          "711:  }",
          "712:  goto yy18;",
          "720:  if (yych <= '/') goto yy18;",
          "722:  yych = *++YYCURSOR;",
          "841:   }",
          "858:   }",
          "861:  }",
          "868:  }",
          "872:  }",
          "879:  yych = *++YYCURSOR;",
          "880:  if (yych <= ',') {",
          "882:  } else {",
          "884:   if (yych <= '/') goto yy18;",
          "886:   goto yy18;",
          "887:  }",
          "889:  yych = *++YYCURSOR;",
          "890:  if (yych <= '/') goto yy18;",
          "893:  ++YYCURSOR;",
          "894:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "895:  yych = *YYCURSOR;",
          "896:  if (yych <= '/') goto yy18;",
          "899:  yych = *++YYCURSOR;",
          "901:  ++YYCURSOR;",
          "917:  if (yych <= '/') goto yy18;",
          "918:  if (yych <= '9') goto yy34;",
          "919:  goto yy18;",
          "921:  yych = *++YYCURSOR;",
          "922:  if (yych <= '/') goto yy18;",
          "923:  if (yych >= ':') goto yy18;",
          "925:  ++YYCURSOR;",
          "926:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "927:  yych = *YYCURSOR;",
          "928:  if (yych <= '/') goto yy18;",
          "931:  yych = *++YYCURSOR;",
          "933:  ++YYCURSOR;",
          "950:  }",
          "954:  }",
          "960:  yych = *++YYCURSOR;",
          "962:  if (yych <= '/') goto yy18;",
          "964:  goto yy18;",
          "966:  yych = *++YYCURSOR;",
          "967:  if (yych <= '/') goto yy18;",
          "968:  if (yych >= ':') goto yy18;",
          "970:  ++YYCURSOR;",
          "971:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "972:  yych = *YYCURSOR;",
          "973:  if (yych <= '/') goto yy18;",
          "976:  yych = *++YYCURSOR;",
          "978:  ++YYCURSOR;",
          "1017:  if (yych <= '/') goto yy18;",
          "1019:  goto yy18;",
          "1021:  yych = *++YYCURSOR;",
          "1022:  if (yych <= '/') goto yy18;",
          "1023:  if (yych >= ':') goto yy18;",
          "1025:  ++YYCURSOR;",
          "1026:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "1027:  yych = *YYCURSOR;",
          "1028:  if (yych <= '/') goto yy18;",
          "1031:  yych = *++YYCURSOR;",
          "1033:  ++YYCURSOR;",
          "1035:  {",
          "1052:   return 0;",
          "1053:  }",
          "1057:   return 0;",
          "1058:  }",
          "1064:  return 1;",
          "1065: }",
          "1087:  yych = *++YYCURSOR;",
          "1089:  goto yy18;",
          "1100:  yych = *++YYCURSOR;",
          "1102:  goto yy18;",
          "1109:  ++YYCURSOR;",
          "1136:  ++YYCURSOR;",
          "1137:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1138:  yych = *YYCURSOR;",
          "1139:  if (yych <= ';') {",
          "1140:   if (yych <= '/') goto yy18;",
          "1142:   if (yych <= ':') goto yy18;",
          "1143:  } else {",
          "1144:   if (yych <= 'E') {",
          "1145:    if (yych <= 'D') goto yy18;",
          "1147:   } else {",
          "1149:    goto yy18;",
          "1150:   }",
          "1151:  }",
          "1153:  ++YYCURSOR;",
          "1155:  {",
          "1156: #if SIZEOF_ZEND_LONG == 4",
          "1157: use_double:",
          "",
          "[Removed Lines]",
          "625:  case 'O': goto yy13;",
          "627:  case 'R': goto yy2;",
          "628:  case 'S': goto yy10;",
          "629:  case 'a': goto yy11;",
          "630:  case 'b': goto yy6;",
          "631:  case 'd': goto yy8;",
          "632:  case 'i': goto yy7;",
          "634:  case 'r': goto yy4;",
          "635:  case 's': goto yy9;",
          "636:  case '}': goto yy14;",
          "637:  default: goto yy16;",
          "640:  yych = *(YYMARKER = ++YYCURSOR);",
          "641:  if (yych == ':') goto yy95;",
          "643: #line 962 \"ext/standard/var_unserializer.re\"",
          "645: #line 646 \"ext/standard/var_unserializer.c\"",
          "648:  if (yych == ':') goto yy89;",
          "652:  if (yych == ';') goto yy87;",
          "656:  if (yych == ':') goto yy83;",
          "660:  if (yych == ':') goto yy77;",
          "664:  if (yych == ':') goto yy53;",
          "668:  if (yych == ':') goto yy46;",
          "672:  if (yych == ':') goto yy39;",
          "676:  if (yych == ':') goto yy32;",
          "680:  if (yych == ':') goto yy25;",
          "684:  if (yych == ':') goto yy17;",
          "688: #line 956 \"ext/standard/var_unserializer.re\"",
          "694: #line 695 \"ext/standard/var_unserializer.c\"",
          "695: yy16:",
          "696:  yych = *++YYCURSOR;",
          "697:  goto yy3;",
          "701:   goto yy20;",
          "703:  if (yych == '+') goto yy19;",
          "709:  if (yybm[0+yych] & 128) {",
          "710:   goto yy20;",
          "713: yy20:",
          "714:  ++YYCURSOR;",
          "715:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "716:  yych = *YYCURSOR;",
          "717:  if (yybm[0+yych] & 128) {",
          "718:   goto yy20;",
          "719:  }",
          "721:  if (yych >= ';') goto yy18;",
          "723:  if (yych != '\"') goto yy18;",
          "724:  ++YYCURSOR;",
          "725: #line 804 \"ext/standard/var_unserializer.re\"",
          "726:  {",
          "727:  size_t len, len2, len3, maxlen;",
          "728:  zend_long elements;",
          "729:  char *str;",
          "730:  zend_string *class_name;",
          "731:  zend_class_entry *ce;",
          "732:  int incomplete_class = 0;",
          "734:  int custom_object = 0;",
          "736:  zval user_func;",
          "737:  zval retval;",
          "738:  zval args[1];",
          "740:     if (!var_hash) return 0;",
          "741:  if (*start == 'C') {",
          "742:   custom_object = 1;",
          "743:  }",
          "745:  len2 = len = parse_uiv(start + 2);",
          "746:  maxlen = max - YYCURSOR;",
          "747:  if (maxlen < len || len == 0) {",
          "749:   return 0;",
          "750:  }",
          "752:  str = (char*)YYCURSOR;",
          "754:  YYCURSOR += len;",
          "756:  if (*(YYCURSOR) != '\"') {",
          "758:   return 0;",
          "759:  }",
          "760:  if (*(YYCURSOR+1) != ':') {",
          "762:   return 0;",
          "763:  }",
          "765:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "766:  if (len3 != len)",
          "767:  {",
          "769:   return 0;",
          "770:  }",
          "772:  class_name = zend_string_init(str, len, 0);",
          "774:  do {",
          "775:   if(!unserialize_allowed_class(class_name, classes)) {",
          "776:    incomplete_class = 1;",
          "777:    ce = PHP_IC_ENTRY;",
          "778:    break;",
          "779:   }",
          "782:   BG(serialize_lock)++;",
          "783:   ce = zend_lookup_class(class_name);",
          "784:   if (ce) {",
          "785:    BG(serialize_lock)--;",
          "786:    if (EG(exception)) {",
          "787:     zend_string_release(class_name);",
          "788:     return 0;",
          "789:    }",
          "790:    break;",
          "791:   }",
          "792:   BG(serialize_lock)--;",
          "794:   if (EG(exception)) {",
          "795:    zend_string_release(class_name);",
          "796:    return 0;",
          "797:   }",
          "800:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "801:    incomplete_class = 1;",
          "802:    ce = PHP_IC_ENTRY;",
          "803:    break;",
          "804:   }",
          "807:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
          "809:   ZVAL_STR_COPY(&args[0], class_name);",
          "810:   BG(serialize_lock)++;",
          "811:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
          "812:    BG(serialize_lock)--;",
          "813:    if (EG(exception)) {",
          "814:     zend_string_release(class_name);",
          "815:     zval_ptr_dtor(&user_func);",
          "816:     zval_ptr_dtor(&args[0]);",
          "817:     return 0;",
          "818:    }",
          "819:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
          "820:    incomplete_class = 1;",
          "821:    ce = PHP_IC_ENTRY;",
          "822:    zval_ptr_dtor(&user_func);",
          "823:    zval_ptr_dtor(&args[0]);",
          "824:    break;",
          "825:   }",
          "826:   BG(serialize_lock)--;",
          "827:   zval_ptr_dtor(&retval);",
          "828:   if (EG(exception)) {",
          "829:    zend_string_release(class_name);",
          "830:    zval_ptr_dtor(&user_func);",
          "831:    zval_ptr_dtor(&args[0]);",
          "832:    return 0;",
          "833:   }",
          "836:   BG(serialize_lock)++;",
          "837:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "838:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "839:    incomplete_class = 1;",
          "840:    ce = PHP_IC_ENTRY;",
          "842:   BG(serialize_lock)--;",
          "844:   zval_ptr_dtor(&user_func);",
          "845:   zval_ptr_dtor(&args[0]);",
          "846:   break;",
          "847:  } while (1);",
          "851:  if (custom_object) {",
          "852:   int ret;",
          "854:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "856:   if (ret && incomplete_class) {",
          "857:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "859:   zend_string_release(class_name);",
          "860:   return ret;",
          "863:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "865:  if (elements < 0) {",
          "866:     zend_string_release(class_name);",
          "867:     return 0;",
          "870:  if (incomplete_class) {",
          "871:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "873:  zend_string_release(class_name);",
          "875:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "876: }",
          "877: #line 878 \"ext/standard/var_unserializer.c\"",
          "878: yy25:",
          "881:   if (yych != '+') goto yy18;",
          "883:   if (yych <= '-') goto yy26;",
          "885:   if (yych <= '9') goto yy27;",
          "888: yy26:",
          "891:  if (yych >= ':') goto yy18;",
          "892: yy27:",
          "897:  if (yych <= '9') goto yy27;",
          "898:  if (yych >= ';') goto yy18;",
          "900:  if (yych != '\"') goto yy18;",
          "902: #line 793 \"ext/standard/var_unserializer.re\"",
          "903:  {",
          "904:  zend_long elements;",
          "905:     if (!var_hash) return 0;",
          "907:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "908:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "909:   return 0;",
          "910:  }",
          "911:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "912: }",
          "913: #line 914 \"ext/standard/var_unserializer.c\"",
          "914: yy32:",
          "915:  yych = *++YYCURSOR;",
          "916:  if (yych == '+') goto yy33;",
          "920: yy33:",
          "924: yy34:",
          "929:  if (yych <= '9') goto yy34;",
          "930:  if (yych >= ';') goto yy18;",
          "932:  if (yych != '{') goto yy18;",
          "934: #line 769 \"ext/standard/var_unserializer.re\"",
          "935:  {",
          "936:  zend_long elements = parse_iv(start + 2);",
          "939:     if (!var_hash) return 0;",
          "941:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "942:   return 0;",
          "943:  }",
          "945:  array_init_size(rval, elements);",
          "946:  if (elements) {",
          "949:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "952:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "953:   return 0;",
          "956:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "957: }",
          "958: #line 959 \"ext/standard/var_unserializer.c\"",
          "959: yy39:",
          "961:  if (yych == '+') goto yy40;",
          "963:  if (yych <= '9') goto yy41;",
          "965: yy40:",
          "969: yy41:",
          "974:  if (yych <= '9') goto yy41;",
          "975:  if (yych >= ';') goto yy18;",
          "977:  if (yych != '\"') goto yy18;",
          "979: #line 735 \"ext/standard/var_unserializer.re\"",
          "980:  {",
          "981:  size_t len, maxlen;",
          "982:  zend_string *str;",
          "984:  len = parse_uiv(start + 2);",
          "985:  maxlen = max - YYCURSOR;",
          "986:  if (maxlen < len) {",
          "988:   return 0;",
          "989:  }",
          "991:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "992:   return 0;",
          "993:  }",
          "995:  if (*(YYCURSOR) != '\"') {",
          "996:   zend_string_free(str);",
          "998:   return 0;",
          "999:  }",
          "1001:  if (*(YYCURSOR + 1) != ';') {",
          "1002:   efree(str);",
          "1004:   return 0;",
          "1005:  }",
          "1007:  YYCURSOR += 2;",
          "1010:  ZVAL_STR(rval, str);",
          "1011:  return 1;",
          "1012: }",
          "1013: #line 1014 \"ext/standard/var_unserializer.c\"",
          "1014: yy46:",
          "1015:  yych = *++YYCURSOR;",
          "1016:  if (yych == '+') goto yy47;",
          "1018:  if (yych <= '9') goto yy48;",
          "1020: yy47:",
          "1024: yy48:",
          "1029:  if (yych <= '9') goto yy48;",
          "1030:  if (yych >= ';') goto yy18;",
          "1032:  if (yych != '\"') goto yy18;",
          "1034: #line 703 \"ext/standard/var_unserializer.re\"",
          "1036:  size_t len, maxlen;",
          "1037:  char *str;",
          "1039:  len = parse_uiv(start + 2);",
          "1040:  maxlen = max - YYCURSOR;",
          "1041:  if (maxlen < len) {",
          "1043:   return 0;",
          "1044:  }",
          "1046:  str = (char*)YYCURSOR;",
          "1048:  YYCURSOR += len;",
          "1050:  if (*(YYCURSOR) != '\"') {",
          "1055:  if (*(YYCURSOR + 1) != ';') {",
          "1060:  YYCURSOR += 2;",
          "1063:  ZVAL_STRINGL(rval, str, len);",
          "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
          "1067: yy53:",
          "1068:  yych = *++YYCURSOR;",
          "1069:  if (yych <= '/') {",
          "1070:   if (yych <= ',') {",
          "1071:    if (yych == '+') goto yy57;",
          "1072:    goto yy18;",
          "1073:   } else {",
          "1074:    if (yych <= '-') goto yy55;",
          "1075:    if (yych <= '.') goto yy60;",
          "1076:    goto yy18;",
          "1077:   }",
          "1078:  } else {",
          "1079:   if (yych <= 'I') {",
          "1080:    if (yych <= '9') goto yy58;",
          "1081:    if (yych <= 'H') goto yy18;",
          "1082:    goto yy56;",
          "1083:   } else {",
          "1084:    if (yych != 'N') goto yy18;",
          "1085:   }",
          "1086:  }",
          "1088:  if (yych == 'A') goto yy76;",
          "1090: yy55:",
          "1091:  yych = *++YYCURSOR;",
          "1092:  if (yych <= '/') {",
          "1093:   if (yych == '.') goto yy60;",
          "1094:   goto yy18;",
          "1095:  } else {",
          "1096:   if (yych <= '9') goto yy58;",
          "1097:   if (yych != 'I') goto yy18;",
          "1098:  }",
          "1099: yy56:",
          "1101:  if (yych == 'N') goto yy72;",
          "1103: yy57:",
          "1104:  yych = *++YYCURSOR;",
          "1105:  if (yych == '.') goto yy60;",
          "1106:  if (yych <= '/') goto yy18;",
          "1107:  if (yych >= ':') goto yy18;",
          "1108: yy58:",
          "1110:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1111:  yych = *YYCURSOR;",
          "1112:  if (yych <= ':') {",
          "1113:   if (yych <= '.') {",
          "1114:    if (yych <= '-') goto yy18;",
          "1115:    goto yy70;",
          "1116:   } else {",
          "1117:    if (yych <= '/') goto yy18;",
          "1118:    if (yych <= '9') goto yy58;",
          "1119:    goto yy18;",
          "1120:   }",
          "1121:  } else {",
          "1122:   if (yych <= 'E') {",
          "1123:    if (yych <= ';') goto yy63;",
          "1124:    if (yych <= 'D') goto yy18;",
          "1125:    goto yy65;",
          "1126:   } else {",
          "1127:    if (yych == 'e') goto yy65;",
          "1128:    goto yy18;",
          "1129:   }",
          "1130:  }",
          "1131: yy60:",
          "1132:  yych = *++YYCURSOR;",
          "1133:  if (yych <= '/') goto yy18;",
          "1134:  if (yych >= ':') goto yy18;",
          "1135: yy61:",
          "1141:   if (yych <= '9') goto yy61;",
          "1146:    goto yy65;",
          "1148:    if (yych == 'e') goto yy65;",
          "1152: yy63:",
          "1154: #line 694 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "616:  case 'O': goto yy4;",
          "618:  case 'R': goto yy6;",
          "619:  case 'S': goto yy7;",
          "620:  case 'a': goto yy8;",
          "621:  case 'b': goto yy9;",
          "622:  case 'd': goto yy10;",
          "623:  case 'i': goto yy11;",
          "625:  case 'r': goto yy13;",
          "626:  case 's': goto yy14;",
          "627:  case '}': goto yy15;",
          "628:  default: goto yy2;",
          "631:  ++YYCURSOR;",
          "633: #line 951 \"ext/standard/var_unserializer.re\"",
          "635: #line 636 \"ext/standard/var_unserializer.c\"",
          "638:  if (yych == ':') goto yy17;",
          "642:  if (yych == ';') goto yy19;",
          "646:  if (yych == ':') goto yy21;",
          "650:  if (yych == ':') goto yy22;",
          "654:  if (yych == ':') goto yy23;",
          "658:  if (yych == ':') goto yy24;",
          "662:  if (yych == ':') goto yy25;",
          "666:  if (yych == ':') goto yy26;",
          "670:  if (yych == ':') goto yy27;",
          "674:  if (yych == ':') goto yy28;",
          "677:  yych = *(YYMARKER = ++YYCURSOR);",
          "678:  if (yych == ':') goto yy29;",
          "679:  goto yy3;",
          "680: yy15:",
          "682: #line 945 \"ext/standard/var_unserializer.re\"",
          "688: #line 689 \"ext/standard/var_unserializer.c\"",
          "692:   goto yy31;",
          "694:  if (yych == '+') goto yy30;",
          "699:  ++YYCURSOR;",
          "700: #line 629 \"ext/standard/var_unserializer.re\"",
          "701:  {",
          "703:  ZVAL_NULL(rval);",
          "704:  return 1;",
          "705: }",
          "706: #line 707 \"ext/standard/var_unserializer.c\"",
          "707: yy21:",
          "709:  if (yych <= ',') {",
          "710:   if (yych == '+') goto yy33;",
          "711:   goto yy18;",
          "712:  } else {",
          "713:   if (yych <= '-') goto yy33;",
          "714:   if (yych <= '/') goto yy18;",
          "715:   if (yych <= '9') goto yy34;",
          "716:   goto yy18;",
          "718: yy22:",
          "719:  yych = *++YYCURSOR;",
          "720:  if (yych == '+') goto yy36;",
          "721:  if (yych <= '/') goto yy18;",
          "722:  if (yych <= '9') goto yy37;",
          "724: yy23:",
          "725:  yych = *++YYCURSOR;",
          "726:  if (yych == '+') goto yy39;",
          "728:  if (yych <= '9') goto yy40;",
          "729:  goto yy18;",
          "730: yy24:",
          "732:  if (yych <= '/') goto yy18;",
          "733:  if (yych <= '1') goto yy42;",
          "734:  goto yy18;",
          "735: yy25:",
          "736:  yych = *++YYCURSOR;",
          "737:  if (yych <= '/') {",
          "738:   if (yych <= ',') {",
          "739:    if (yych == '+') goto yy43;",
          "740:    goto yy18;",
          "741:   } else {",
          "742:    if (yych <= '-') goto yy44;",
          "743:    if (yych <= '.') goto yy45;",
          "744:    goto yy18;",
          "746:  } else {",
          "747:   if (yych <= 'I') {",
          "748:    if (yych <= '9') goto yy46;",
          "749:    if (yych <= 'H') goto yy18;",
          "750:    goto yy48;",
          "751:   } else {",
          "752:    if (yych == 'N') goto yy49;",
          "753:    goto yy18;",
          "756: yy26:",
          "757:  yych = *++YYCURSOR;",
          "758:  if (yych <= ',') {",
          "759:   if (yych == '+') goto yy50;",
          "760:   goto yy18;",
          "761:  } else {",
          "762:   if (yych <= '-') goto yy50;",
          "763:   if (yych <= '/') goto yy18;",
          "764:   if (yych <= '9') goto yy51;",
          "765:   goto yy18;",
          "767: yy27:",
          "768:  yych = *++YYCURSOR;",
          "769:  if (yych <= ',') {",
          "770:   if (yych == '+') goto yy53;",
          "771:   goto yy18;",
          "772:  } else {",
          "773:   if (yych <= '-') goto yy53;",
          "774:   if (yych <= '/') goto yy18;",
          "775:   if (yych <= '9') goto yy54;",
          "776:   goto yy18;",
          "778: yy28:",
          "781:   if (yych == '+') goto yy56;",
          "782:   goto yy18;",
          "784:   if (yych <= '-') goto yy56;",
          "786:   if (yych <= '9') goto yy57;",
          "789: yy29:",
          "791:  if (yych == '+') goto yy59;",
          "793:  if (yych <= '9') goto yy60;",
          "794:  goto yy18;",
          "795: yy30:",
          "796:  yych = *++YYCURSOR;",
          "797:  if (yybm[0+yych] & 128) {",
          "798:   goto yy31;",
          "799:  }",
          "800:  goto yy18;",
          "801: yy31:",
          "805:  if (yybm[0+yych] & 128) {",
          "806:   goto yy31;",
          "807:  }",
          "809:  if (yych <= ':') goto yy62;",
          "810:  goto yy18;",
          "811: yy33:",
          "813:  if (yych <= '/') goto yy18;",
          "814:  if (yych >= ':') goto yy18;",
          "815: yy34:",
          "817:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "818:  yych = *YYCURSOR;",
          "821:  if (yych == ';') goto yy63;",
          "823: yy36:",
          "827: yy37:",
          "832:  if (yych <= '9') goto yy37;",
          "833:  if (yych <= ':') goto yy65;",
          "834:  goto yy18;",
          "835: yy39:",
          "837:  if (yych <= '/') goto yy18;",
          "838:  if (yych >= ':') goto yy18;",
          "839: yy40:",
          "841:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "842:  yych = *YYCURSOR;",
          "843:  if (yych <= '/') goto yy18;",
          "844:  if (yych <= '9') goto yy40;",
          "845:  if (yych <= ':') goto yy66;",
          "846:  goto yy18;",
          "847: yy42:",
          "848:  yych = *++YYCURSOR;",
          "849:  if (yych == ';') goto yy67;",
          "850:  goto yy18;",
          "851: yy43:",
          "852:  yych = *++YYCURSOR;",
          "853:  if (yych == '.') goto yy45;",
          "854:  if (yych <= '/') goto yy18;",
          "855:  if (yych <= '9') goto yy46;",
          "856:  goto yy18;",
          "857: yy44:",
          "858:  yych = *++YYCURSOR;",
          "859:  if (yych <= '/') {",
          "860:   if (yych != '.') goto yy18;",
          "861:  } else {",
          "862:   if (yych <= '9') goto yy46;",
          "863:   if (yych == 'I') goto yy48;",
          "864:   goto yy18;",
          "866: yy45:",
          "867:  yych = *++YYCURSOR;",
          "868:  if (yych <= '/') goto yy18;",
          "869:  if (yych <= '9') goto yy69;",
          "870:  goto yy18;",
          "871: yy46:",
          "872:  ++YYCURSOR;",
          "873:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "874:  yych = *YYCURSOR;",
          "875:  if (yych <= ':') {",
          "876:   if (yych <= '.') {",
          "877:    if (yych <= '-') goto yy18;",
          "878:    goto yy69;",
          "879:   } else {",
          "880:    if (yych <= '/') goto yy18;",
          "881:    if (yych <= '9') goto yy46;",
          "882:    goto yy18;",
          "883:   }",
          "884:  } else {",
          "885:   if (yych <= 'E') {",
          "886:    if (yych <= ';') goto yy71;",
          "887:    if (yych <= 'D') goto yy18;",
          "888:    goto yy73;",
          "889:   } else {",
          "890:    if (yych == 'e') goto yy73;",
          "891:    goto yy18;",
          "892:   }",
          "894: yy48:",
          "895:  yych = *++YYCURSOR;",
          "896:  if (yych == 'N') goto yy74;",
          "897:  goto yy18;",
          "898: yy49:",
          "899:  yych = *++YYCURSOR;",
          "900:  if (yych == 'A') goto yy75;",
          "901:  goto yy18;",
          "902: yy50:",
          "905:  if (yych >= ':') goto yy18;",
          "906: yy51:",
          "907:  ++YYCURSOR;",
          "908:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "909:  yych = *YYCURSOR;",
          "910:  if (yych <= '/') goto yy18;",
          "911:  if (yych <= '9') goto yy51;",
          "912:  if (yych == ';') goto yy76;",
          "914: yy53:",
          "918: yy54:",
          "923:  if (yych <= '9') goto yy54;",
          "924:  if (yych <= ':') goto yy78;",
          "925:  goto yy18;",
          "926: yy56:",
          "928:  if (yych <= '/') goto yy18;",
          "929:  if (yych >= ':') goto yy18;",
          "930: yy57:",
          "932:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "933:  yych = *YYCURSOR;",
          "935:  if (yych <= '9') goto yy57;",
          "936:  if (yych == ';') goto yy79;",
          "938: yy59:",
          "942: yy60:",
          "947:  if (yych <= '9') goto yy60;",
          "948:  if (yych <= ':') goto yy81;",
          "949:  goto yy18;",
          "950: yy62:",
          "952:  if (yych == '\"') goto yy82;",
          "953:  goto yy18;",
          "954: yy63:",
          "956: #line 580 \"ext/standard/var_unserializer.re\"",
          "958:  zend_long id;",
          "961:  if (!var_hash) return 0;",
          "963:  id = parse_iv(start + 2) - 1;",
          "964:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "968:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "972:  if (Z_ISREF_P(rval_ref)) {",
          "973:   ZVAL_COPY(rval, rval_ref);",
          "974:  } else {",
          "975:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "976:   ZVAL_COPY(rval, rval_ref);",
          "977:  }",
          "981: #line 982 \"ext/standard/var_unserializer.c\"",
          "982: yy65:",
          "984:  if (yych == '\"') goto yy84;",
          "986: yy66:",
          "988:  if (yych == '{') goto yy86;",
          "990: yy67:",
          "992: #line 635 \"ext/standard/var_unserializer.re\"",
          "993:  {",
          "995:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "996:  return 1;",
          "997: }",
          "998: #line 999 \"ext/standard/var_unserializer.c\"",
          "999: yy69:",
          "1005:   if (yych <= '9') goto yy69;",
          "1010:    goto yy73;",
          "1012:    if (yych == 'e') goto yy73;",
          "1016: yy71:",
          "1018: #line 683 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1160:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1161:  return 1;",
          "1162: }",
          "1165:  yych = *++YYCURSOR;",
          "1166:  if (yych <= ',') {",
          "1168:  } else {",
          "1170:   if (yych <= '/') goto yy18;",
          "1172:   goto yy18;",
          "1173:  }",
          "1175:  yych = *++YYCURSOR;",
          "1191:  goto yy18;",
          "1193:  yych = *++YYCURSOR;",
          "1196:  goto yy18;",
          "1198:  ++YYCURSOR;",
          "1210:   } else {",
          "1213:   }",
          "1214:  }",
          "1219:  yych = *++YYCURSOR;",
          "1221:  ++YYCURSOR;",
          "1223:  {",
          "1234:  }",
          "1236:  return 1;",
          "1237: }",
          "1240:  yych = *++YYCURSOR;",
          "1242:  goto yy18;",
          "1258:  ++YYCURSOR;",
          "1266:  {",
          "1272:  }",
          "1281:    }",
          "1284:   }",
          "1290: }",
          "1298:  ++YYCURSOR;",
          "1300:  {",
          "1303:  return 1;",
          "1304: }",
          "1307:  ++YYCURSOR;",
          "1309:  {",
          "1313: }",
          "1316:  yych = *++YYCURSOR;",
          "1317:  if (yych <= ',') {",
          "1319:  } else {",
          "1321:   if (yych <= '/') goto yy18;",
          "1324:  }",
          "1330:  ++YYCURSOR;",
          "1331:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1332:  yych = *YYCURSOR;",
          "1333:  if (yych <= '/') goto yy18;",
          "1336:  ++YYCURSOR;",
          "1338:  {",
          "1346:   return 0;",
          "1347:  }",
          "1350:   return 0;",
          "1351:  }",
          "1356:  }",
          "1360:  return 1;",
          "1361: }",
          "1373: yy96:",
          "1374:  yych = *++YYCURSOR;",
          "1375:  if (yych <= '/') goto yy18;",
          "1377: yy97:",
          "1378:  ++YYCURSOR;",
          "1386:  {",
          "1404:  } else {",
          "1407:  }",
          "1409:  return 1;",
          "1410: }",
          "1412: }",
          "1416:  return 0;",
          "",
          "[Removed Lines]",
          "1163: #line 1164 \"ext/standard/var_unserializer.c\"",
          "1164: yy65:",
          "1167:   if (yych != '+') goto yy18;",
          "1169:   if (yych <= '-') goto yy66;",
          "1171:   if (yych <= '9') goto yy67;",
          "1174: yy66:",
          "1176:  if (yych <= ',') {",
          "1177:   if (yych == '+') goto yy69;",
          "1178:   goto yy18;",
          "1179:  } else {",
          "1180:   if (yych <= '-') goto yy69;",
          "1181:   if (yych <= '/') goto yy18;",
          "1182:   if (yych >= ':') goto yy18;",
          "1183:  }",
          "1184: yy67:",
          "1185:  ++YYCURSOR;",
          "1186:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1187:  yych = *YYCURSOR;",
          "1188:  if (yych <= '/') goto yy18;",
          "1189:  if (yych <= '9') goto yy67;",
          "1190:  if (yych == ';') goto yy63;",
          "1192: yy69:",
          "1194:  if (yych <= '/') goto yy18;",
          "1195:  if (yych <= '9') goto yy67;",
          "1197: yy70:",
          "1199:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1200:  yych = *YYCURSOR;",
          "1201:  if (yych <= ';') {",
          "1202:   if (yych <= '/') goto yy18;",
          "1203:   if (yych <= '9') goto yy70;",
          "1204:   if (yych <= ':') goto yy18;",
          "1205:   goto yy63;",
          "1206:  } else {",
          "1207:   if (yych <= 'E') {",
          "1208:    if (yych <= 'D') goto yy18;",
          "1209:    goto yy65;",
          "1211:    if (yych == 'e') goto yy65;",
          "1212:    goto yy18;",
          "1215: yy72:",
          "1216:  yych = *++YYCURSOR;",
          "1217:  if (yych != 'F') goto yy18;",
          "1218: yy73:",
          "1220:  if (yych != ';') goto yy18;",
          "1222: #line 678 \"ext/standard/var_unserializer.re\"",
          "1226:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
          "1227:   ZVAL_DOUBLE(rval, php_get_nan());",
          "1228:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
          "1229:   ZVAL_DOUBLE(rval, php_get_inf());",
          "1230:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
          "1231:   ZVAL_DOUBLE(rval, -php_get_inf());",
          "1232:  } else {",
          "1233:   ZVAL_NULL(rval);",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "1239: yy76:",
          "1241:  if (yych == 'N') goto yy73;",
          "1243: yy77:",
          "1244:  yych = *++YYCURSOR;",
          "1245:  if (yych <= ',') {",
          "1246:   if (yych != '+') goto yy18;",
          "1247:  } else {",
          "1248:   if (yych <= '-') goto yy78;",
          "1249:   if (yych <= '/') goto yy18;",
          "1250:   if (yych <= '9') goto yy79;",
          "1251:   goto yy18;",
          "1252:  }",
          "1253: yy78:",
          "1254:  yych = *++YYCURSOR;",
          "1255:  if (yych <= '/') goto yy18;",
          "1256:  if (yych >= ':') goto yy18;",
          "1257: yy79:",
          "1259:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1260:  yych = *YYCURSOR;",
          "1261:  if (yych <= '/') goto yy18;",
          "1262:  if (yych <= '9') goto yy79;",
          "1263:  if (yych != ';') goto yy18;",
          "1264:  ++YYCURSOR;",
          "1265: #line 652 \"ext/standard/var_unserializer.re\"",
          "1267: #if SIZEOF_ZEND_LONG == 4",
          "1268:  int digits = YYCURSOR - start - 3;",
          "1270:  if (start[2] == '-' || start[2] == '+') {",
          "1271:   digits--;",
          "1275:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1276:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1277:    int cmp = strncmp((char*)YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1279:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1280:     goto use_double;",
          "1282:   } else {",
          "1283:    goto use_double;",
          "1285:  }",
          "1286: #endif",
          "1288:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1289:  return 1;",
          "1291: #line 1292 \"ext/standard/var_unserializer.c\"",
          "1292: yy83:",
          "1293:  yych = *++YYCURSOR;",
          "1294:  if (yych <= '/') goto yy18;",
          "1295:  if (yych >= '2') goto yy18;",
          "1296:  yych = *++YYCURSOR;",
          "1297:  if (yych != ';') goto yy18;",
          "1299: #line 646 \"ext/standard/var_unserializer.re\"",
          "1302:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1305: #line 1306 \"ext/standard/var_unserializer.c\"",
          "1306: yy87:",
          "1308: #line 640 \"ext/standard/var_unserializer.re\"",
          "1311:  ZVAL_NULL(rval);",
          "1312:  return 1;",
          "1314: #line 1315 \"ext/standard/var_unserializer.c\"",
          "1315: yy89:",
          "1318:   if (yych != '+') goto yy18;",
          "1320:   if (yych <= '-') goto yy90;",
          "1322:   if (yych <= '9') goto yy91;",
          "1323:   goto yy18;",
          "1325: yy90:",
          "1326:  yych = *++YYCURSOR;",
          "1327:  if (yych <= '/') goto yy18;",
          "1328:  if (yych >= ':') goto yy18;",
          "1329: yy91:",
          "1334:  if (yych <= '9') goto yy91;",
          "1335:  if (yych != ';') goto yy18;",
          "1337: #line 615 \"ext/standard/var_unserializer.re\"",
          "1339:  zend_long id;",
          "1342:  if (!var_hash) return 0;",
          "1344:  id = parse_iv(start + 2) - 1;",
          "1345:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1349:  if (rval_ref == rval) {",
          "1353:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1354:   ZVAL_UNDEF(rval);",
          "1355:   return 1;",
          "1358:  ZVAL_COPY(rval, rval_ref);",
          "1362: #line 1363 \"ext/standard/var_unserializer.c\"",
          "1363: yy95:",
          "1364:  yych = *++YYCURSOR;",
          "1365:  if (yych <= ',') {",
          "1366:   if (yych != '+') goto yy18;",
          "1367:  } else {",
          "1368:   if (yych <= '-') goto yy96;",
          "1369:   if (yych <= '/') goto yy18;",
          "1370:   if (yych <= '9') goto yy97;",
          "1371:   goto yy18;",
          "1372:  }",
          "1376:  if (yych >= ':') goto yy18;",
          "1379:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1380:  yych = *YYCURSOR;",
          "1381:  if (yych <= '/') goto yy18;",
          "1382:  if (yych <= '9') goto yy97;",
          "1383:  if (yych != ';') goto yy18;",
          "1384:  ++YYCURSOR;",
          "1385: #line 589 \"ext/standard/var_unserializer.re\"",
          "1387:  zend_long id;",
          "1390:  if (!var_hash) return 0;",
          "1392:  id = parse_iv(start + 2) - 1;",
          "1393:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1394:   return 0;",
          "1395:  }",
          "1397:  zval_ptr_dtor(rval);",
          "1398:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1399:   ZVAL_UNDEF(rval);",
          "1400:   return 1;",
          "1401:  }",
          "1402:  if (Z_ISREF_P(rval_ref)) {",
          "1403:   ZVAL_COPY(rval, rval_ref);",
          "1405:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "1406:   ZVAL_COPY(rval, rval_ref);",
          "1411: #line 1412 \"ext/standard/var_unserializer.c\"",
          "1413: #line 964 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1027: #line 1028 \"ext/standard/var_unserializer.c\"",
          "1028: yy73:",
          "1031:   if (yych == '+') goto yy88;",
          "1032:   goto yy18;",
          "1034:   if (yych <= '-') goto yy88;",
          "1036:   if (yych <= '9') goto yy89;",
          "1039: yy74:",
          "1041:  if (yych == 'F') goto yy91;",
          "1043: yy75:",
          "1045:  if (yych == 'N') goto yy91;",
          "1047: yy76:",
          "1049: #line 641 \"ext/standard/var_unserializer.re\"",
          "1050:  {",
          "1051: #if SIZEOF_ZEND_LONG == 4",
          "1052:  int digits = YYCURSOR - start - 3;",
          "1054:  if (start[2] == '-' || start[2] == '+') {",
          "1055:   digits--;",
          "1056:  }",
          "1059:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1060:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1061:    int cmp = strncmp((char*)YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1063:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1064:     goto use_double;",
          "1065:    }",
          "1067:    goto use_double;",
          "1070: #endif",
          "1072:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1073:  return 1;",
          "1074: }",
          "1075: #line 1076 \"ext/standard/var_unserializer.c\"",
          "1076: yy78:",
          "1078:  if (yych == '\"') goto yy92;",
          "1079:  goto yy18;",
          "1080: yy79:",
          "1082: #line 605 \"ext/standard/var_unserializer.re\"",
          "1084:  zend_long id;",
          "1087:  if (!var_hash) return 0;",
          "1089:  id = parse_iv(start + 2) - 1;",
          "1090:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1091:   return 0;",
          "1092:  }",
          "1094:  if (rval_ref == rval) {",
          "1095:   return 0;",
          "1098:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1099:   return 0;",
          "1100:  }",
          "1102:  ZVAL_COPY(rval, rval_ref);",
          "1106: #line 1107 \"ext/standard/var_unserializer.c\"",
          "1107: yy81:",
          "1109:  if (yych == '\"') goto yy94;",
          "1111: yy82:",
          "1113: #line 793 \"ext/standard/var_unserializer.re\"",
          "1115:  size_t len, len2, len3, maxlen;",
          "1116:  zend_long elements;",
          "1117:  char *str;",
          "1118:  zend_string *class_name;",
          "1119:  zend_class_entry *ce;",
          "1120:  int incomplete_class = 0;",
          "1122:  int custom_object = 0;",
          "1124:  zval user_func;",
          "1125:  zval retval;",
          "1126:  zval args[1];",
          "1128:     if (!var_hash) return 0;",
          "1129:  if (*start == 'C') {",
          "1130:   custom_object = 1;",
          "1133:  len2 = len = parse_uiv(start + 2);",
          "1134:  maxlen = max - YYCURSOR;",
          "1135:  if (maxlen < len || len == 0) {",
          "1137:   return 0;",
          "1138:  }",
          "1140:  str = (char*)YYCURSOR;",
          "1142:  YYCURSOR += len;",
          "1144:  if (*(YYCURSOR) != '\"') {",
          "1146:   return 0;",
          "1147:  }",
          "1148:  if (*(YYCURSOR+1) != ':') {",
          "1150:   return 0;",
          "1151:  }",
          "1153:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "1154:  if (len3 != len)",
          "1155:  {",
          "1157:   return 0;",
          "1158:  }",
          "1160:  class_name = zend_string_init(str, len, 0);",
          "1162:  do {",
          "1163:   if(!unserialize_allowed_class(class_name, classes)) {",
          "1164:    incomplete_class = 1;",
          "1165:    ce = PHP_IC_ENTRY;",
          "1166:    break;",
          "1167:   }",
          "1170:   BG(serialize_lock)++;",
          "1171:   ce = zend_lookup_class(class_name);",
          "1172:   if (ce) {",
          "1173:    BG(serialize_lock)--;",
          "1174:    if (EG(exception)) {",
          "1175:     zend_string_release(class_name);",
          "1176:     return 0;",
          "1178:    break;",
          "1180:   BG(serialize_lock)--;",
          "1182:   if (EG(exception)) {",
          "1183:    zend_string_release(class_name);",
          "1184:    return 0;",
          "1185:   }",
          "1188:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "1189:    incomplete_class = 1;",
          "1190:    ce = PHP_IC_ENTRY;",
          "1191:    break;",
          "1192:   }",
          "1195:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
          "1197:   ZVAL_STR_COPY(&args[0], class_name);",
          "1198:   BG(serialize_lock)++;",
          "1199:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
          "1200:    BG(serialize_lock)--;",
          "1201:    if (EG(exception)) {",
          "1202:     zend_string_release(class_name);",
          "1203:     zval_ptr_dtor(&user_func);",
          "1204:     zval_ptr_dtor(&args[0]);",
          "1205:     return 0;",
          "1206:    }",
          "1207:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
          "1208:    incomplete_class = 1;",
          "1209:    ce = PHP_IC_ENTRY;",
          "1210:    zval_ptr_dtor(&user_func);",
          "1211:    zval_ptr_dtor(&args[0]);",
          "1212:    break;",
          "1213:   }",
          "1214:   BG(serialize_lock)--;",
          "1215:   zval_ptr_dtor(&retval);",
          "1216:   if (EG(exception)) {",
          "1217:    zend_string_release(class_name);",
          "1218:    zval_ptr_dtor(&user_func);",
          "1219:    zval_ptr_dtor(&args[0]);",
          "1220:    return 0;",
          "1221:   }",
          "1224:   BG(serialize_lock)++;",
          "1225:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "1226:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "1227:    incomplete_class = 1;",
          "1228:    ce = PHP_IC_ENTRY;",
          "1229:   }",
          "1230:   BG(serialize_lock)--;",
          "1232:   zval_ptr_dtor(&user_func);",
          "1233:   zval_ptr_dtor(&args[0]);",
          "1234:   break;",
          "1235:  } while (1);",
          "1239:  if (custom_object) {",
          "1240:   int ret;",
          "1242:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "1244:   if (ret && incomplete_class) {",
          "1245:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "1246:   }",
          "1247:   zend_string_release(class_name);",
          "1248:   return ret;",
          "1249:  }",
          "1251:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "1253:  if (elements < 0) {",
          "1254:     zend_string_release(class_name);",
          "1255:     return 0;",
          "1256:  }",
          "1258:  if (incomplete_class) {",
          "1259:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "1260:  }",
          "1261:  zend_string_release(class_name);",
          "1263:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
          "1266: yy84:",
          "1268: #line 724 \"ext/standard/var_unserializer.re\"",
          "1270:  size_t len, maxlen;",
          "1271:  zend_string *str;",
          "1273:  len = parse_uiv(start + 2);",
          "1274:  maxlen = max - YYCURSOR;",
          "1275:  if (maxlen < len) {",
          "1277:   return 0;",
          "1278:  }",
          "1280:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "1281:   return 0;",
          "1282:  }",
          "1284:  if (*(YYCURSOR) != '\"') {",
          "1285:   zend_string_free(str);",
          "1287:   return 0;",
          "1288:  }",
          "1290:  if (*(YYCURSOR + 1) != ';') {",
          "1291:   efree(str);",
          "1293:   return 0;",
          "1294:  }",
          "1296:  YYCURSOR += 2;",
          "1299:  ZVAL_STR(rval, str);",
          "1302: #line 1303 \"ext/standard/var_unserializer.c\"",
          "1303: yy86:",
          "1305: #line 758 \"ext/standard/var_unserializer.re\"",
          "1307:  zend_long elements = parse_iv(start + 2);",
          "1310:     if (!var_hash) return 0;",
          "1312:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "1313:   return 0;",
          "1314:  }",
          "1316:  array_init_size(rval, elements);",
          "1317:  if (elements) {",
          "1320:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "1321:  }",
          "1323:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "1324:   return 0;",
          "1325:  }",
          "1327:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
          "1330: yy88:",
          "1333:   if (yych == '+') goto yy96;",
          "1334:   goto yy18;",
          "1336:   if (yych <= '-') goto yy96;",
          "1338:   if (yych >= ':') goto yy18;",
          "1340: yy89:",
          "1345:  if (yych <= '9') goto yy89;",
          "1346:  if (yych == ';') goto yy71;",
          "1347:  goto yy18;",
          "1348: yy91:",
          "1349:  yych = *++YYCURSOR;",
          "1350:  if (yych == ';') goto yy97;",
          "1351:  goto yy18;",
          "1352: yy92:",
          "1354: #line 782 \"ext/standard/var_unserializer.re\"",
          "1356:  zend_long elements;",
          "1357:     if (!var_hash) return 0;",
          "1359:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "1360:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "1361:   return 0;",
          "1362:  }",
          "1363:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1364: }",
          "1365: #line 1366 \"ext/standard/var_unserializer.c\"",
          "1366: yy94:",
          "1367:  ++YYCURSOR;",
          "1368: #line 692 \"ext/standard/var_unserializer.re\"",
          "1369:  {",
          "1370:  size_t len, maxlen;",
          "1371:  char *str;",
          "1373:  len = parse_uiv(start + 2);",
          "1374:  maxlen = max - YYCURSOR;",
          "1375:  if (maxlen < len) {",
          "1380:  str = (char*)YYCURSOR;",
          "1382:  YYCURSOR += len;",
          "1384:  if (*(YYCURSOR) != '\"') {",
          "1389:  if (*(YYCURSOR + 1) != ';') {",
          "1391:   return 0;",
          "1394:  YYCURSOR += 2;",
          "1397:  ZVAL_STRINGL(rval, str, len);",
          "1400: #line 1401 \"ext/standard/var_unserializer.c\"",
          "1404:  if (yych <= '9') goto yy89;",
          "1405:  goto yy18;",
          "1408: #line 667 \"ext/standard/var_unserializer.re\"",
          "1412:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
          "1413:   ZVAL_DOUBLE(rval, php_get_nan());",
          "1414:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
          "1415:   ZVAL_DOUBLE(rval, php_get_inf());",
          "1416:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
          "1417:   ZVAL_DOUBLE(rval, -php_get_inf());",
          "1419:   ZVAL_NULL(rval);",
          "1424: #line 1425 \"ext/standard/var_unserializer.c\"",
          "1426: #line 953 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "409:    return 0;",
          "410:   }",
          "422:   zval_dtor(&key);",
          "424:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "",
          "[Removed Lines]",
          "412:   if (UNEXPECTED(Z_ISUNDEF_P(data))) {",
          "413:    if (Z_TYPE(key) == IS_LONG) {",
          "414:     zend_hash_index_del(ht, Z_LVAL(key));",
          "415:    } else {",
          "416:     zend_hash_del_ind(ht, Z_STR(key));",
          "417:    }",
          "418:   } else {",
          "419:    var_push_dtor(var_hash, data);",
          "420:   }",
          "",
          "[Added Lines]",
          "412:   var_push_dtor(var_hash, data);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "597:   return 0;",
          "598:  }",
          "601:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "604:  }",
          "605:  if (Z_ISREF_P(rval_ref)) {",
          "606:   ZVAL_COPY(rval, rval_ref);",
          "607:  } else {",
          "",
          "[Removed Lines]",
          "600:  zval_ptr_dtor(rval);",
          "602:   ZVAL_UNDEF(rval);",
          "603:   return 1;",
          "",
          "[Added Lines]",
          "592:   return 0;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "628:  }",
          "630:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "633:  }",
          "635:  ZVAL_COPY(rval, rval_ref);",
          "",
          "[Removed Lines]",
          "631:   ZVAL_UNDEF(rval);",
          "632:   return 1;",
          "",
          "[Added Lines]",
          "621:   return 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "feeb2fba93a451c467ec70963995ca6371b3a568",
      "candidate_info": {
        "commit_hash": "feeb2fba93a451c467ec70963995ca6371b3a568",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/feeb2fba93a451c467ec70963995ca6371b3a568",
        "files": [
          "Zend/zend_exceptions.c",
          "ext/date/tests/bug53437_var5.phpt",
          "ext/spl/spl_array.c",
          "ext/spl/spl_dllist.c",
          "ext/spl/spl_observer.c",
          "ext/standard/php_var.h",
          "ext/standard/tests/serialize/bug69793.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "fix merge",
        "before_after_code_files": [
          "Zend/zend_exceptions.c||Zend/zend_exceptions.c",
          "ext/date/tests/bug53437_var5.phpt||ext/date/tests/bug53437_var5.phpt",
          "ext/spl/spl_array.c||ext/spl/spl_array.c",
          "ext/spl/spl_dllist.c||ext/spl/spl_dllist.c",
          "ext/spl/spl_observer.c||ext/spl/spl_observer.c",
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/tests/serialize/bug69793.phpt||ext/standard/tests/serialize/bug69793.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/zend_exceptions.c||Zend/zend_exceptions.c": [
          "File: Zend/zend_exceptions.c -> Zend/zend_exceptions.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "284: #define CHECK_EXC_TYPE(name, type) \\",
          "287:   zval tmp; \\",
          "288:   ZVAL_STRINGL(&tmp, name, sizeof(name) - 1); \\",
          "289:   Z_OBJ_HANDLER_P(object, unset_property)(object, &tmp, NULL); \\",
          "",
          "[Removed Lines]",
          "285:  if(zend_read_property(i_get_exception_base(object), (object), name, sizeof(name) - 1, 1, &value) != &EG(uninitialized_zval) \\",
          "286:   && Z_TYPE(value) != type) { \\",
          "",
          "[Added Lines]",
          "285:  ZVAL_UNDEF(&value); \\",
          "286:  pvalue = zend_read_property(i_get_exception_base(object), (object), name, sizeof(name) - 1, 1, &value); \\",
          "287:  if(Z_TYPE_P(pvalue) != IS_UNDEF && Z_TYPE_P(pvalue) != type) { \\",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "293: ZEND_METHOD(exception, __wakeup)",
          "294: {",
          "296:  zval *object = getThis();",
          "297:  CHECK_EXC_TYPE(\"message\", IS_STRING);",
          "298:  CHECK_EXC_TYPE(\"string\", IS_STRING);",
          "",
          "[Removed Lines]",
          "295:  zval value;",
          "",
          "[Added Lines]",
          "296:  zval value, *pvalue;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "711:  exception = getThis();",
          "712:  ZVAL_STRINGL(&fname, \"gettraceasstring\", sizeof(\"gettraceasstring\")-1);",
          "715:   zend_string *prev_str = str;",
          "716:   zend_string *message = zval_get_string(GET_PROPERTY(exception, \"message\"));",
          "717:   zend_string *file = zval_get_string(GET_PROPERTY(exception, \"file\"));",
          "",
          "[Removed Lines]",
          "714:  while (exception && Z_TYPE_P(exception) == IS_OBJECT) {",
          "",
          "[Added Lines]",
          "715:  while (exception && Z_TYPE_P(exception) == IS_OBJECT && instanceof_function(Z_OBJCE_P(exception), zend_ce_throwable)) {",
          "",
          "---------------"
        ],
        "ext/date/tests/bug53437_var5.phpt||ext/date/tests/bug53437_var5.phpt": [
          "File: ext/date/tests/bug53437_var5.phpt -> ext/date/tests/bug53437_var5.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: --EXPECTF--",
          "15: object(DateInterval)#%d (15) {",
          "16:   [\"y\"]=>",
          "18:   [\"m\"]=>",
          "20:   [\"d\"]=>",
          "22:   [\"h\"]=>",
          "24:   [\"i\"]=>",
          "26:   [\"s\"]=>",
          "28:   [\"weekday\"]=>",
          "29:   int(10)",
          "30:   [\"weekday_behavior\"]=>",
          "",
          "[Removed Lines]",
          "17:   int(-1)",
          "19:   int(-1)",
          "21:   int(-1)",
          "23:   int(-1)",
          "25:   int(-1)",
          "27:   int(-1)",
          "",
          "[Added Lines]",
          "17:   int(2)",
          "19:   int(0)",
          "21:   int(0)",
          "23:   int(6)",
          "25:   int(8)",
          "27:   int(0)",
          "",
          "---------------"
        ],
        "ext/spl/spl_array.c||ext/spl/spl_array.c": [
          "File: ext/spl/spl_array.c -> ext/spl/spl_array.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1710:  size_t buf_len;",
          "1711:  const unsigned char *p, *s;",
          "1712:  php_unserialize_data_t var_hash;",
          "1714:  HashTable *aht;",
          "1715:  zend_long flags;",
          "",
          "[Removed Lines]",
          "1713:  zval members, zflags;",
          "",
          "[Added Lines]",
          "1713:  zval *members, *zflags;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1737:  }",
          "1738:  ++p;",
          "1741:   goto outexcept;",
          "1742:  }",
          "",
          "[Removed Lines]",
          "1740:  if (!php_var_unserialize(&zflags, &p, s + buf_len, &var_hash) || Z_TYPE(zflags) != IS_LONG) {",
          "1744:  var_push_dtor(&var_hash, &zflags);",
          "1746:  flags = Z_LVAL(zflags);",
          "",
          "[Added Lines]",
          "1740:  zflags = var_tmp_var(&var_hash);",
          "1741:  if (!php_var_unserialize(zflags, &p, s + buf_len, &var_hash) || Z_TYPE_P(zflags) != IS_LONG) {",
          "1746:  flags = Z_LVAL_P(zflags);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1777:  }",
          "1778:  ++p;",
          "1783:   goto outexcept;",
          "1784:  }",
          "1793:  PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1794:  return;",
          "",
          "[Removed Lines]",
          "1780:  ZVAL_UNDEF(&members);",
          "1781:  if (!php_var_unserialize(&members, &p, s + buf_len, &var_hash) || Z_TYPE(members) != IS_ARRAY) {",
          "1782:   zval_ptr_dtor(&members);",
          "1786:  var_push_dtor(&var_hash, &members);",
          "1788:  object_properties_load(&intern->std, Z_ARRVAL(members));",
          "1789:  zval_ptr_dtor(&members);",
          "",
          "[Added Lines]",
          "1780:  members = var_tmp_var(&var_hash);",
          "1781:  if (!php_var_unserialize(members, &p, s + buf_len, &var_hash) || Z_TYPE_P(members) != IS_ARRAY) {",
          "1786:  object_properties_load(&intern->std, Z_ARRVAL_P(members));",
          "",
          "---------------"
        ],
        "ext/spl/spl_dllist.c||ext/spl/spl_dllist.c": [
          "File: ext/spl/spl_dllist.c -> ext/spl/spl_dllist.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1178: SPL_METHOD(SplDoublyLinkedList, unserialize)",
          "1179: {",
          "1180:  spl_dllist_object *intern = Z_SPLDLLIST_P(getThis());",
          "1182:  char *buf;",
          "1183:  size_t buf_len;",
          "1184:  const unsigned char *p, *s;",
          "",
          "[Removed Lines]",
          "1181:  zval flags, elem;",
          "",
          "[Added Lines]",
          "1181:  zval *flags, *elem;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1196:  PHP_VAR_UNSERIALIZE_INIT(var_hash);",
          "1200:   goto error;",
          "1201:  }",
          "1212:  while(*p == ':') {",
          "1213:   ++p;",
          "1215:    goto error;",
          "1216:   }",
          "1220:  }",
          "1222:  if (*p != '\\0') {",
          "",
          "[Removed Lines]",
          "1199:  if (!php_var_unserialize(&flags, &p, s + buf_len, &var_hash)) {",
          "1203:  if (Z_TYPE(flags) != IS_LONG) {",
          "1204:   zval_ptr_dtor(&flags);",
          "1205:   goto error;",
          "1206:  }",
          "1208:  intern->flags = (int)Z_LVAL(flags);",
          "1209:  zval_ptr_dtor(&flags);",
          "1214:   if (!php_var_unserialize(&elem, &p, s + buf_len, &var_hash)) {",
          "1218:   spl_ptr_llist_push(intern->llist, &elem);",
          "1219:   zval_ptr_dtor(&elem);",
          "",
          "[Added Lines]",
          "1199:  flags = var_tmp_var(&var_hash);",
          "1200:  if (!php_var_unserialize(flags, &p, s + buf_len, &var_hash) || Z_TYPE_P(flags) != IS_LONG) {",
          "1204:  intern->flags = (int)Z_LVAL_P(flags);",
          "1209:   elem = var_tmp_var(&var_hash);",
          "1210:   if (!php_var_unserialize(elem, &p, s + buf_len, &var_hash)) {",
          "1214:   spl_ptr_llist_push(intern->llist, elem);",
          "",
          "---------------"
        ],
        "ext/spl/spl_observer.c||ext/spl/spl_observer.c": [
          "File: ext/spl/spl_observer.c -> ext/spl/spl_observer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "780:  size_t buf_len;",
          "781:  const unsigned char *p, *s;",
          "782:  php_unserialize_data_t var_hash;",
          "784:  spl_SplObjectStorageElement *element;",
          "785:  zend_long count;",
          "",
          "[Removed Lines]",
          "783:  zval entry, pmembers, pcount, inf;",
          "",
          "[Added Lines]",
          "783:  zval entry, inf;",
          "784:  zval *pcount, *pmembers;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "801:  }",
          "802:  ++p;",
          "809:   goto outexcept;",
          "810:  }",
          "816:  while (count-- > 0) {",
          "817:   spl_SplObjectStorageElement *pelement;",
          "",
          "[Removed Lines]",
          "804:  if (!php_var_unserialize(&pcount, &p, s + buf_len, &var_hash)) {",
          "805:   goto outexcept;",
          "806:  }",
          "807:  if (Z_TYPE(pcount) != IS_LONG) {",
          "808:   zval_ptr_dtor(&pcount);",
          "812:  var_push_dtor(&var_hash, &pcount);",
          "814:  count = Z_LVAL(pcount);",
          "",
          "[Added Lines]",
          "805:  pcount = var_tmp_var(&var_hash);",
          "806:  if (!php_var_unserialize(pcount, &p, s + buf_len, &var_hash) || Z_TYPE_P(pcount) != IS_LONG) {",
          "811:  count = Z_LVAL_P(pcount);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "838:     zval_ptr_dtor(&entry);",
          "839:     goto outexcept;",
          "840:    }",
          "841:   }",
          "843:   hash = spl_object_storage_get_hash(intern, getThis(), &entry);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "838:   } else {",
          "839:    ZVAL_UNDEF(&inf);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "856:     var_push_dtor(&var_hash, &pelement->obj);",
          "857:    }",
          "858:   }",
          "860:   var_replace(&var_hash, &entry, &element->obj);",
          "861:   var_replace(&var_hash, &inf, &element->inf);",
          "862:   zval_ptr_dtor(&entry);",
          "",
          "[Removed Lines]",
          "859:   element = spl_object_storage_attach(intern, getThis(), &entry, &inf);",
          "",
          "[Added Lines]",
          "858:   element = spl_object_storage_attach(intern, getThis(), &entry, Z_ISUNDEF(inf)?NULL:&inf);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "874:  }",
          "875:  ++p;",
          "880:   goto outexcept;",
          "881:  }",
          "885:  if (!intern->std.properties) {",
          "886:   rebuild_object_properties(&intern->std);",
          "887:  }",
          "891:  PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "892:  return;",
          "",
          "[Removed Lines]",
          "877:  ZVAL_UNDEF(&pmembers);",
          "878:  if (!php_var_unserialize(&pmembers, &p, s + buf_len, &var_hash) || Z_TYPE(pmembers) != IS_ARRAY) {",
          "879:   zval_ptr_dtor(&pmembers);",
          "883:  var_push_dtor(&var_hash, &pmembers);",
          "888:  zend_hash_copy(intern->std.properties, Z_ARRVAL(pmembers), (copy_ctor_func_t) zval_add_ref);",
          "889:  zval_ptr_dtor(&pmembers);",
          "",
          "[Added Lines]",
          "876:  pmembers = var_tmp_var(&var_hash);",
          "877:  if (!php_var_unserialize(pmembers, &p, s + buf_len, &var_hash) || Z_TYPE_P(pmembers) != IS_ARRAY) {",
          "885:  zend_hash_copy(intern->std.properties, Z_ARRVAL_P(pmembers), (copy_ctor_func_t) zval_add_ref);",
          "",
          "---------------"
        ],
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "118: PHPAPI void var_replace(php_unserialize_data_t *var_hash, zval *ozval, zval *nzval);",
          "119: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hash, zval *val);",
          "121: PHPAPI void var_destroy(php_unserialize_data_t *var_hash);",
          "",
          "[Removed Lines]",
          "120: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval);",
          "",
          "[Added Lines]",
          "120: PHPAPI zval *var_tmp_var(php_unserialize_data_t *var_hashx);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug69793.phpt||ext/standard/tests/serialize/bug69793.phpt": [
          "File: ext/standard/tests/serialize/bug69793.phpt -> ext/standard/tests/serialize/bug69793.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "12: Notice: Undefined property: Exception::$file in %s/bug69793.php on line %d",
          "14: Notice: Undefined property: Exception::$previous in %s/bug69793.php on line %d",
          "16: Stack trace:",
          "17: #0 {main}\"",
          "",
          "[Removed Lines]",
          "15: string(53) \"exception 'Exception' in :1337",
          "",
          "[Added Lines]",
          "15: string(41) \"Exception in :1337",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "67: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "68: {",
          "96: }",
          "",
          "[Removed Lines]",
          "69:  var_dtor_entries *var_hash;",
          "71:  if (!var_hashx || !*var_hashx) {",
          "72:   return;",
          "73:  }",
          "75:  var_hash = (*var_hashx)->last_dtor;",
          "76: #if VAR_ENTRIES_DBG",
          "77:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "78: #endif",
          "80:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "81:   var_hash = emalloc(sizeof(var_dtor_entries));",
          "82:   var_hash->used_slots = 0;",
          "83:   var_hash->next = 0;",
          "85:   if (!(*var_hashx)->first_dtor) {",
          "86:    (*var_hashx)->first_dtor = var_hash;",
          "87:   } else {",
          "88:    ((var_dtor_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "89:   }",
          "91:   (*var_hashx)->last_dtor = var_hash;",
          "92:  }",
          "94:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "95:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "69:  zval *tmp_var = var_tmp_var(var_hashx);",
          "70:     if (!tmp_var) {",
          "71:         return;",
          "72:     }",
          "73:  ZVAL_COPY(tmp_var, rval);",
          "74: }",
          "76: PHPAPI zval *var_tmp_var(php_unserialize_data_t *var_hashx)",
          "77: {",
          "78:     var_dtor_entries *var_hash;",
          "80:     if (!var_hashx || !*var_hashx) {",
          "81:         return NULL;",
          "82:     }",
          "84:     var_hash = (*var_hashx)->last_dtor;",
          "85:     if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "86:         var_hash = emalloc(sizeof(var_dtor_entries));",
          "87:         var_hash->used_slots = 0;",
          "88:         var_hash->next = 0;",
          "90:         if (!(*var_hashx)->first_dtor) {",
          "91:             (*var_hashx)->first_dtor = var_hash;",
          "92:         } else {",
          "93:             ((var_dtor_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "94:         }",
          "96:         (*var_hashx)->last_dtor = var_hash;",
          "97:     }",
          "98:     ZVAL_UNDEF(&var_hash->data[var_hash->used_slots]);",
          "99:     return &var_hash->data[var_hash->used_slots++];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "259: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "262: #line 267 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "266: #line 271 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "524:  start = cursor;",
          "528: {",
          "529:  YYCTYPE yych;",
          "530:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "527: #line 528 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "531: #line 532 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "584:  yych = *(YYMARKER = ++YYCURSOR);",
          "585:  if (yych == ':') goto yy95;",
          "586: yy3:",
          "588:  { return 0; }",
          "590: yy4:",
          "591:  yych = *(YYMARKER = ++YYCURSOR);",
          "592:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "587: #line 875 \"ext/standard/var_unserializer.re\"",
          "589: #line 590 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "591: #line 879 \"ext/standard/var_unserializer.re\"",
          "593: #line 594 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "629:  goto yy3;",
          "630: yy14:",
          "631:  ++YYCURSOR;",
          "633:  {",
          "635:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "637: }",
          "639: yy16:",
          "640:  yych = *++YYCURSOR;",
          "641:  goto yy3;",
          "",
          "[Removed Lines]",
          "632: #line 869 \"ext/standard/var_unserializer.re\"",
          "638: #line 639 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "636: #line 873 \"ext/standard/var_unserializer.re\"",
          "642: #line 643 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "661:  if (yybm[0+yych] & 128) {",
          "662:   goto yy20;",
          "663:  }",
          "665:  yych = *++YYCURSOR;",
          "666:  if (yych != '\"') goto yy18;",
          "667:  ++YYCURSOR;",
          "669:  {",
          "670:  size_t len, len2, len3, maxlen;",
          "671:  zend_long elements;",
          "",
          "[Removed Lines]",
          "664:  if (yych != ':') goto yy18;",
          "668: #line 724 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "668:  if (yych <= '/') goto yy18;",
          "669:  if (yych >= ';') goto yy18;",
          "673: #line 728 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "811:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "812: }",
          "814: yy25:",
          "815:  yych = *++YYCURSOR;",
          "816:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "813: #line 814 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "835:  yych = *++YYCURSOR;",
          "836:  if (yych != '\"') goto yy18;",
          "837:  ++YYCURSOR;",
          "839:  {",
          "",
          "[Removed Lines]",
          "838: #line 716 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "843: #line 720 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "843:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "844:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "845: }",
          "847: yy32:",
          "848:  yych = *++YYCURSOR;",
          "849:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "846: #line 847 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "864:  yych = *++YYCURSOR;",
          "865:  if (yych != '{') goto yy18;",
          "866:  ++YYCURSOR;",
          "868:  {",
          "869:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "867: #line 695 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "872: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "886:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "887: }",
          "889: yy39:",
          "890:  yych = *++YYCURSOR;",
          "891:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "888: #line 889 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "906:  yych = *++YYCURSOR;",
          "907:  if (yych != '\"') goto yy18;",
          "908:  ++YYCURSOR;",
          "910:  {",
          "911:  size_t len, maxlen;",
          "912:  zend_string *str;",
          "",
          "[Removed Lines]",
          "909: #line 667 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "914: #line 671 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "934:  ZVAL_STR(rval, str);",
          "935:  return 1;",
          "936: }",
          "938: yy46:",
          "939:  yych = *++YYCURSOR;",
          "940:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "937: #line 938 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "955:  yych = *++YYCURSOR;",
          "956:  if (yych != '\"') goto yy18;",
          "957:  ++YYCURSOR;",
          "959:  {",
          "960:  size_t len, maxlen;",
          "961:  char *str;",
          "",
          "[Removed Lines]",
          "958: #line 640 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "963: #line 644 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "982:  ZVAL_STRINGL(rval, str, len);",
          "983:  return 1;",
          "984: }",
          "986: yy53:",
          "987:  yych = *++YYCURSOR;",
          "988:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "985: #line 986 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "990: #line 991 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1070:  }",
          "1071: yy63:",
          "1072:  ++YYCURSOR;",
          "1074:  {",
          "1075: #if SIZEOF_ZEND_LONG == 4",
          "1076: use_double:",
          "",
          "[Removed Lines]",
          "1073: #line 631 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1078: #line 635 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1079:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1080:  return 1;",
          "1081: }",
          "1083: yy65:",
          "1084:  yych = *++YYCURSOR;",
          "1085:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1082: #line 1083 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1087: #line 1088 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1138:  yych = *++YYCURSOR;",
          "1139:  if (yych != ';') goto yy18;",
          "1140:  ++YYCURSOR;",
          "1142:  {",
          "",
          "[Removed Lines]",
          "1141: #line 615 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1146: #line 619 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1155:  return 1;",
          "1156: }",
          "1158: yy76:",
          "1159:  yych = *++YYCURSOR;",
          "1160:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1157: #line 1158 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1181:  if (yych <= '9') goto yy79;",
          "1182:  if (yych != ';') goto yy18;",
          "1183:  ++YYCURSOR;",
          "1185:  {",
          "1186: #if SIZEOF_ZEND_LONG == 4",
          "1187:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1184: #line 589 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1189: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1207:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1208:  return 1;",
          "1209: }",
          "1211: yy83:",
          "1212:  yych = *++YYCURSOR;",
          "1213:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1215:  yych = *++YYCURSOR;",
          "1216:  if (yych != ';') goto yy18;",
          "1217:  ++YYCURSOR;",
          "1219:  {",
          "1221:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1222:  return 1;",
          "1223: }",
          "1225: yy87:",
          "1226:  ++YYCURSOR;",
          "1228:  {",
          "1230:  ZVAL_NULL(rval);",
          "1231:  return 1;",
          "1232: }",
          "1234: yy89:",
          "1235:  yych = *++YYCURSOR;",
          "1236:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1218: #line 583 \"ext/standard/var_unserializer.re\"",
          "1224: #line 1225 \"ext/standard/var_unserializer.c\"",
          "1227: #line 577 \"ext/standard/var_unserializer.re\"",
          "1233: #line 1234 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1223: #line 587 \"ext/standard/var_unserializer.re\"",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "1232: #line 581 \"ext/standard/var_unserializer.re\"",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1253:  if (yych <= '9') goto yy91;",
          "1254:  if (yych != ';') goto yy18;",
          "1255:  ++YYCURSOR;",
          "1257:  {",
          "1258:  zend_long id;",
          "",
          "[Removed Lines]",
          "1256: #line 554 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1261: #line 558 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1277:  return 1;",
          "1278: }",
          "1280: yy95:",
          "1281:  yych = *++YYCURSOR;",
          "1282:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1279: #line 1280 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1299:  if (yych <= '9') goto yy97;",
          "1300:  if (yych != ';') goto yy18;",
          "1301:  ++YYCURSOR;",
          "1303:  {",
          "1304:  zend_long id;",
          "",
          "[Removed Lines]",
          "1302: #line 532 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1307: #line 536 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1322:  return 1;",
          "1323: }",
          "1325: }",
          "1329:  return 0;",
          "",
          "[Removed Lines]",
          "1324: #line 1325 \"ext/standard/var_unserializer.c\"",
          "1326: #line 877 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
          "1331: #line 881 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "65: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "66: {",
          "94: }",
          "",
          "[Removed Lines]",
          "67:  var_dtor_entries *var_hash;",
          "69:  if (!var_hashx || !*var_hashx) {",
          "70:   return;",
          "71:  }",
          "73:  var_hash = (*var_hashx)->last_dtor;",
          "74: #if VAR_ENTRIES_DBG",
          "75:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "76: #endif",
          "78:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "79:   var_hash = emalloc(sizeof(var_dtor_entries));",
          "80:   var_hash->used_slots = 0;",
          "81:   var_hash->next = 0;",
          "83:   if (!(*var_hashx)->first_dtor) {",
          "84:    (*var_hashx)->first_dtor = var_hash;",
          "85:   } else {",
          "86:    ((var_dtor_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "87:   }",
          "89:   (*var_hashx)->last_dtor = var_hash;",
          "90:  }",
          "92:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "93:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "67:  zval *tmp_var = var_tmp_var(var_hashx);",
          "68:     if (!tmp_var) {",
          "69:         return;",
          "70:     }",
          "71:  ZVAL_COPY(tmp_var, rval);",
          "72: }",
          "74: PHPAPI zval *var_tmp_var(php_unserialize_data_t *var_hashx)",
          "75: {",
          "76:     var_dtor_entries *var_hash;",
          "78:     if (!var_hashx || !*var_hashx) {",
          "79:         return NULL;",
          "80:     }",
          "82:     var_hash = (*var_hashx)->last_dtor;",
          "83:     if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "84:         var_hash = emalloc(sizeof(var_dtor_entries));",
          "85:         var_hash->used_slots = 0;",
          "86:         var_hash->next = 0;",
          "88:         if (!(*var_hashx)->first_dtor) {",
          "89:             (*var_hashx)->first_dtor = var_hash;",
          "90:         } else {",
          "91:             ((var_dtor_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "92:         }",
          "94:         (*var_hashx)->last_dtor = var_hash;",
          "95:     }",
          "96:     ZVAL_UNDEF(&var_hash->data[var_hash->used_slots]);",
          "97:     return &var_hash->data[var_hash->used_slots++];",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "878b8f046593085365466f20c756a2d429164707",
      "candidate_info": {
        "commit_hash": "878b8f046593085365466f20c756a2d429164707",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/878b8f046593085365466f20c756a2d429164707",
        "files": [
          "NEWS",
          "ext/standard/tests/serialize/bug70213.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-7.0' into PHP-7.1",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug70213.phpt||ext/standard/tests/serialize/bug70213.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug70213.phpt||ext/standard/tests/serialize/bug70213.phpt": [
          "File: ext/standard/tests/serialize/bug70213.phpt -> ext/standard/tests/serialize/bug70213.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #70213: Unserialize context shared on double class lookup",
          "3: --FILE--",
          "4: <?php",
          "6: ini_set('unserialize_callback_func', 'evil');",
          "8: function evil() {",
          "9:  function __autoload($arg) {",
          "10:         var_dump(unserialize('R:1;'));",
          "11:     }",
          "12: }",
          "14: var_dump(unserialize('a:2:{i:0;i:42;i:1;O:4:\"evil\":0:{}}'));",
          "16: ?>",
          "17: --EXPECTF--",
          "18: Notice: unserialize(): Error at offset 4 of 4 bytes in %s on line %d",
          "19: bool(false)",
          "21: Warning: unserialize(): Function evil() hasn't defined the class it was called for in %s on line %d",
          "22: array(2) {",
          "23:   [0]=>",
          "24:   int(42)",
          "25:   [1]=>",
          "26:   object(__PHP_Incomplete_Class)#1 (1) {",
          "27:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "28:     string(4) \"evil\"",
          "29:   }",
          "30: }",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "647: yy2:",
          "648:  ++YYCURSOR;",
          "649: yy3:",
          "651:  { return 0; }",
          "652: #line 653 \"ext/standard/var_unserializer.c\"",
          "653: yy4:",
          "",
          "[Removed Lines]",
          "650: #line 959 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "650: #line 961 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "696:  goto yy3;",
          "697: yy15:",
          "698:  ++YYCURSOR;",
          "700:  {",
          "702:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "",
          "[Removed Lines]",
          "699: #line 953 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "699: #line 955 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1240:   }",
          "1243:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "1244:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "1245:    incomplete_class = 1;",
          "1246:    ce = PHP_IC_ENTRY;",
          "1247:   }",
          "1249:   zval_ptr_dtor(&user_func);",
          "1250:   zval_ptr_dtor(&args[0]);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1243:   BG(serialize_lock)++;",
          "1249:   BG(serialize_lock)--;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1275:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1276: }",
          "1278: yy84:",
          "1279:  ++YYCURSOR;",
          "1280: #line 743 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1279: #line 1280 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1311:  ZVAL_STR(rval, str);",
          "1312:  return 1;",
          "1313: }",
          "1315: yy86:",
          "1316:  ++YYCURSOR;",
          "1317: #line 777 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1314: #line 1315 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1316: #line 1317 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1339:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1340: }",
          "1342: yy88:",
          "1343:  yych = *++YYCURSOR;",
          "1344:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1341: #line 1342 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1343: #line 1344 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1370:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "1371:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "1372: }",
          "1374: yy94:",
          "1375:  ++YYCURSOR;",
          "1376: #line 711 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1373: #line 1374 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1375: #line 1376 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1405:  ZVAL_STRINGL(rval, str, len);",
          "1406:  return 1;",
          "1407: }",
          "1409: yy96:",
          "1410:  yych = *++YYCURSOR;",
          "1411:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1408: #line 1409 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1410: #line 1411 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1430:  return 1;",
          "1431: }",
          "1433: }",
          "1437:  return 0;",
          "",
          "[Removed Lines]",
          "1432: #line 1433 \"ext/standard/var_unserializer.c\"",
          "1434: #line 961 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1434: #line 1435 \"ext/standard/var_unserializer.c\"",
          "1436: #line 963 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "915:   }",
          "918:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "919:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "920:    incomplete_class = 1;",
          "921:    ce = PHP_IC_ENTRY;",
          "922:   }",
          "924:   zval_ptr_dtor(&user_func);",
          "925:   zval_ptr_dtor(&args[0]);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "918:   BG(serialize_lock)++;",
          "924:   BG(serialize_lock)--;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0d13325b660b5ae64267dffcc9a153c7634fdfe2",
      "candidate_info": {
        "commit_hash": "0d13325b660b5ae64267dffcc9a153c7634fdfe2",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/0d13325b660b5ae64267dffcc9a153c7634fdfe2",
        "files": [
          "ext/exif/exif.c",
          "ext/session/session.c",
          "ext/session/tests/bug72681.phpt",
          "ext/standard/base64.c",
          "ext/standard/quot_print.c",
          "ext/standard/tests/strings/bug70436.phpt",
          "ext/standard/tests/strings/bug72663.phpt",
          "ext/standard/tests/strings/bug72663_2.phpt",
          "ext/standard/tests/strings/bug72663_3.phpt",
          "ext/standard/uuencode.c",
          "ext/standard/var_unserializer.c",
          "ext/wddx/wddx.c"
        ],
        "message": "Merge branch 'PHP-5.6' into PHP-7.0\n\n* PHP-5.6: (24 commits)\n  Update NEWS\n  BLock test with memory leak\n  fix tests\n  Fix TSRM build\n  Fix bug #72850 - integer overflow in uuencode\n  Fixed bug #72849 - integer overflow in urlencode\n  Fix bug #72848 - integer overflow in quoted_printable_encode caused heap corruption\n  Fix bug #72838 - \tInteger overflow lead to heap corruption in sql_regcase\n  Fix bug #72837 - integer overflow in bzdecompress caused heap corruption\n  Fix bug #72836 - integer overflow in base64_decode caused heap corruption\n  Fix for bug #72807 - do not produce strings with negative length\n  Fix for bug #72790 and bug #72799\n  Fix bug #72730 - imagegammacorrect allows arbitrary write access\n  Fix bug#72697 - select_colors write out-of-bounds\n  Fixed bug #72627: Memory Leakage In exif_process_IFD_in_TIFF\n  Fix bug #72750: wddx_deserialize null dereference\n  Fix bug #72771: ftps:// opendir wrapper is vulnerable to protocol downgrade attack\n  Improve fix for #72663\n  Fix bug #70436: Use After Free Vulnerability in unserialize()\n  Fix bug #72749: wddx_deserialize allows illegal memory access\n  ...\n\nConflicts:\n\tZend/zend_API.h\n\text/bz2/bz2.c\n\text/curl/interface.c\n\text/ereg/ereg.c\n\text/exif/exif.c\n\text/gd/gd.c\n\text/gd/tests/imagetruecolortopalette_error3.phpt\n\text/gd/tests/imagetruecolortopalette_error4.phpt\n\text/session/session.c\n\text/snmp/snmp.c\n\text/standard/base64.c\n\text/standard/ftp_fopen_wrapper.c\n\text/standard/quot_print.c\n\text/standard/url.c\n\text/standard/uuencode.c\n\text/standard/var.c\n\text/standard/var_unserializer.c\n\text/standard/var_unserializer.re\n\text/wddx/tests/bug72790.phpt\n\text/wddx/tests/bug72799.phpt\n\text/wddx/wddx.c\n\tsapi/cli/generate_mime_type_map.php",
        "before_after_code_files": [
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/session/session.c||ext/session/session.c",
          "ext/session/tests/bug72681.phpt||ext/session/tests/bug72681.phpt",
          "ext/standard/base64.c||ext/standard/base64.c",
          "ext/standard/quot_print.c||ext/standard/quot_print.c",
          "ext/standard/tests/strings/bug70436.phpt||ext/standard/tests/strings/bug70436.phpt",
          "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
          "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
          "ext/standard/tests/strings/bug72663_3.phpt||ext/standard/tests/strings/bug72663_3.phpt",
          "ext/standard/uuencode.c||ext/standard/uuencode.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/wddx/wddx.c||ext/wddx/wddx.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3762:       } else {",
          "3763:        exif_thumbnail_build(ImageInfo);",
          "3764:       }",
          "3766:      }",
          "3767: #ifdef EXIF_DEBUG",
          "3768:      exif_error_docref(NULL EXIFERR_CC, ImageInfo, E_NOTICE, \"Read next IFD (THUMBNAIL) done\");",
          "",
          "[Removed Lines]",
          "3765:       exif_thumbnail_build(ImageInfo);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/session/session.c||ext/session/session.c": [
          "File: ext/session/session.c -> ext/session/session.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "963:  int namelen;",
          "964:  zend_string *name;",
          "965:  php_unserialize_data_t var_hash;",
          "967:  PHP_VAR_UNSERIALIZE_INIT(var_hash);",
          "969:  for (p = val; p < endptr; ) {",
          "970:   zval *tmp;",
          "971:   namelen = ((unsigned char)(*p)) & (~PS_BIN_UNDEF);",
          "973:   if (namelen < 0 || namelen > PS_BIN_MAX || (p + namelen) >= endptr) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "966:  int skip = 0;",
          "972:   skip = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "984:   if ((tmp = zend_hash_find(&EG(symbol_table), name))) {",
          "985:    if ((Z_TYPE_P(tmp) == IS_ARRAY &&",
          "986:     Z_ARRVAL_P(tmp) == &EG(symbol_table)) || tmp == &PS(http_session_vars)) {",
          "989:    }",
          "990:   }",
          "",
          "[Removed Lines]",
          "987:     zend_string_release(name);",
          "988:     continue;",
          "",
          "[Added Lines]",
          "989:     skip = 1;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "994:    current = var_tmp_var(&var_hash);",
          "995:    if (php_var_unserialize(current, (const unsigned char **) &p, (const unsigned char *) endptr, &var_hash)) {",
          "996:     ZVAL_PTR(&rv, current);",
          "998:    } else {",
          "999:     zend_string_release(name);",
          "1000:     php_session_normalize_vars();",
          "",
          "[Removed Lines]",
          "997:     php_set_session_var(name, &rv, &var_hash );",
          "",
          "[Added Lines]",
          "998:     if (!skip) {",
          "999:      php_set_session_var(name, &rv, &var_hash);",
          "1000:     }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1056:  zend_string *name;",
          "1057:  int has_value, retval = SUCCESS;",
          "1058:  php_unserialize_data_t var_hash;",
          "1060:  PHP_VAR_UNSERIALIZE_INIT(var_hash);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1062:  int skip = 0;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1064:  while (p < endptr) {",
          "1065:   zval *tmp;",
          "1066:   q = p;",
          "1067:   while (*q != PS_DELIMITER) {",
          "1068:    if (++q >= endptr) goto break_outer_loop;",
          "1069:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1071:   skip = 0;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1081:   if ((tmp = zend_hash_find(&EG(symbol_table), name))) {",
          "1082:    if ((Z_TYPE_P(tmp) == IS_ARRAY &&",
          "1083:     Z_ARRVAL_P(tmp) == &EG(symbol_table)) || tmp == &PS(http_session_vars)) {",
          "1085:    }",
          "1086:   }",
          "",
          "[Removed Lines]",
          "1084:     goto skip;",
          "",
          "[Added Lines]",
          "1089:     skip = 1;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1090:    current = var_tmp_var(&var_hash);",
          "1091:    if (php_var_unserialize(current, (const unsigned char **)&q, (const unsigned char *)endptr, &var_hash)) {",
          "1092:     ZVAL_PTR(&rv, current);",
          "1094:    } else {",
          "1095:     zend_string_release(name);",
          "1096:     retval = FAILURE;",
          "1097:     goto break_outer_loop;",
          "1098:    }",
          "1099:   } else {",
          "1101:   }",
          "1102: skip:",
          "1103:   zend_string_release(name);",
          "",
          "[Removed Lines]",
          "1093:     php_set_session_var(name, &rv, &var_hash);",
          "1100:    PS_ADD_VARL(name);",
          "",
          "[Added Lines]",
          "1098:     if (!skip) {",
          "1099:      php_set_session_var(name, &rv, &var_hash);",
          "1100:     }",
          "1107:    if(!skip) {",
          "1108:     PS_ADD_VARL(name);",
          "1109:    }",
          "",
          "---------------"
        ],
        "ext/session/tests/bug72681.phpt||ext/session/tests/bug72681.phpt": [
          "File: ext/session/tests/bug72681.phpt -> ext/session/tests/bug72681.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72681: PHP Session Data Injection Vulnerability",
          "3: --SKIPIF--",
          "4: <?php include('skipif.inc'); ?>",
          "5: --FILE--",
          "6: <?php",
          "7: ini_set('session.serialize_handler', 'php');",
          "8: session_start();",
          "9: $_SESSION['_SESSION'] = 'ryat|O:8:\"stdClass\":0:{}';",
          "10: session_write_close();",
          "11: session_start();",
          "12: var_dump($_SESSION);",
          "13: ?>",
          "14: --EXPECT--",
          "15: array(0) {",
          "16: }",
          "",
          "---------------"
        ],
        "ext/standard/base64.c||ext/standard/base64.c": [
          "File: ext/standard/base64.c -> ext/standard/base64.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "59:  unsigned char *p;",
          "60:  zend_string *result;",
          "63:  p = (unsigned char *)ZSTR_VAL(result);",
          "",
          "[Removed Lines]",
          "62:  result = zend_string_alloc(((length + 2) / 3) * 4 * sizeof(char), 0);",
          "",
          "[Added Lines]",
          "62:  result = zend_string_safe_alloc(((length + 2) / 3), 4 * sizeof(char), 0, 0);",
          "",
          "---------------"
        ],
        "ext/standard/quot_print.c||ext/standard/quot_print.c": [
          "File: ext/standard/quot_print.c -> ext/standard/quot_print.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "275:   RETURN_EMPTY_STRING();",
          "276:  }",
          "279:  RETURN_STR(new_str);",
          "280: }",
          "",
          "[Removed Lines]",
          "278:  new_str = php_quot_print_encode((unsigned char *)ZSTR_VAL(str), (size_t)ZSTR_LEN(str));",
          "",
          "[Added Lines]",
          "278:  new_str = php_quot_print_encode((unsigned char *)ZSTR_VAL(str), ZSTR_LEN(str));",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/bug70436.phpt||ext/standard/tests/strings/bug70436.phpt": [
          "File: ext/standard/tests/strings/bug70436.phpt -> ext/standard/tests/strings/bug70436.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #70436: Use After Free Vulnerability in unserialize()",
          "3: --FILE--",
          "4: <?php",
          "6: class obj implements Serializable",
          "7: {",
          "8:  var $data;",
          "10:  function serialize()",
          "11:  {",
          "12:   return serialize($this->data);",
          "13:  }",
          "15:  function unserialize($data)",
          "16:  {",
          "17:   $this->data = unserialize($data);",
          "18:  }",
          "19: }",
          "21: $fakezval = ptr2str(1122334455);",
          "22: $fakezval .= ptr2str(0);",
          "23: $fakezval .= \"\\x00\\x00\\x00\\x00\";",
          "24: $fakezval .= \"\\x01\";",
          "25: $fakezval .= \"\\x00\";",
          "26: $fakezval .= \"\\x00\\x00\";",
          "28: $inner = 'C:3:\"obj\":3:{ryat';",
          "29: $exploit = 'a:4:{i:0;i:1;i:1;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:2;s:'.strlen($fakezval).':\"'.$fakezval.'\";i:3;R:5;}';",
          "31: $data = unserialize($exploit);",
          "33: var_dump($data);",
          "35: function ptr2str($ptr)",
          "36: {",
          "37:  $out = '';",
          "39:  for ($i = 0; $i < 8; $i++) {",
          "40:   $out .= chr($ptr & 0xff);",
          "41:   $ptr >>= 8;",
          "42:  }",
          "44:  return $out;",
          "45: }",
          "46: ?>",
          "47: DONE",
          "48: --EXPECTF--",
          "49: Notice: unserialize(): Error at offset 0 of 3 bytes in %sbug70436.php on line %d",
          "51: Notice: unserialize(): Error at offset 17 of 17 bytes in %sbug70436.php on line %d",
          "52: array(4) {",
          "53:   [0]=>",
          "54:   int(1)",
          "55:   [1]=>",
          "56:   object(obj)#%d (1) {",
          "57:     [\"data\"]=>",
          "58:     bool(false)",
          "59:   }",
          "60:   [2]=>",
          "61:   string(24) \"%s\"",
          "62:   [3]=>",
          "63:   bool(false)",
          "64: }",
          "65: DONE",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
          "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --FILE--",
          "4: <?php",
          "5: class obj implements Serializable {",
          "6:     var $data;",
          "7:     function serialize() {",
          "8:         return serialize($this->data);",
          "9:     }",
          "10:     function unserialize($data) {",
          "11:         $this->data = unserialize($data);",
          "12:     }",
          "13: }",
          "15: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
          "16: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
          "18: $data = unserialize($exploit);",
          "19: echo $data[1];",
          "20: ?>",
          "21: DONE",
          "22: --EXPECTF--",
          "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
          "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
          "26: DONE",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt": [
          "File: ext/standard/tests/strings/bug72663_2.phpt -> ext/standard/tests/strings/bug72663_2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --FILE--",
          "4: <?php",
          "6: ini_set('session.serialize_handler', 'php_serialize');",
          "7: session_start();",
          "8: $sess = 'O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:1;}';",
          "9: session_decode($sess);",
          "10: var_dump($_SESSION);",
          "11: ?>",
          "12: DONE",
          "13: --EXPECTF--",
          "14: Notice: session_decode(): Unexpected end of serialized data in %sbug72663_2.php on line %d",
          "15: array(0) {",
          "16: }",
          "17: DONE",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/bug72663_3.phpt||ext/standard/tests/strings/bug72663_3.phpt": [
          "File: ext/standard/tests/strings/bug72663_3.phpt -> ext/standard/tests/strings/bug72663_3.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --XFAIL--",
          "4: Memory leak, TBF later.",
          "5: --FILE--",
          "6: <?php",
          "7: class obj {",
          "8:  var $ryat;",
          "9:  function __wakeup() {",
          "10:   $this->ryat = str_repeat('A', 0x112);",
          "11:  }",
          "12: }",
          "14: $poc = 'O:8:\"stdClass\":1:{i:0;O:3:\"obj\":1:{s:4:\"ryat\";R:1;';",
          "15: unserialize($poc);",
          "16: ?>",
          "17: DONE",
          "18: --EXPECTF--",
          "19: Notice: unserialize(): Error at offset 51 of 50 bytes in %sbug72663_3.php on line %d",
          "20: DONE",
          "",
          "---------------"
        ],
        "ext/standard/uuencode.c||ext/standard/uuencode.c": [
          "File: ext/standard/uuencode.c -> ext/standard/uuencode.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "71:  char *p, *s, *e, *ee;",
          "72:  zend_string *dest;",
          "76:  p = ZSTR_VAL(dest);",
          "77:  s = src;",
          "78:  e = src + src_len;",
          "",
          "[Removed Lines]",
          "75:  dest = zend_string_alloc((size_t)ceil(src_len * 1.38) + 46, 0);",
          "",
          "[Added Lines]",
          "75:        Use 1.5 for easier calculation.",
          "77:  dest = zend_string_safe_alloc(src_len/2, 3, 46, 0);",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "651:  if (yybm[0+yych] & 128) {",
          "652:   goto yy20;",
          "653:  }",
          "655:  yych = *++YYCURSOR;",
          "656:  if (yych != '\"') goto yy18;",
          "657:  ++YYCURSOR;",
          "",
          "[Removed Lines]",
          "654:  if (yych != ':') goto yy18;",
          "",
          "[Added Lines]",
          "654:  if (yych <= '/') goto yy18;",
          "655:  if (yych >= ';') goto yy18;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "801:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "802: }",
          "804: yy25:",
          "805:  yych = *++YYCURSOR;",
          "806:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "803: #line 804 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "804: #line 805 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "832:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "833:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "834: }",
          "836: yy32:",
          "837:  yych = *++YYCURSOR;",
          "838:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "835: #line 836 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "836: #line 837 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "878:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "879: }",
          "881: yy39:",
          "882:  yych = *++YYCURSOR;",
          "883:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "880: #line 881 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "881: #line 882 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "932:  ZVAL_STR(rval, str);",
          "933:  return 1;",
          "934: }",
          "936: yy46:",
          "937:  yych = *++YYCURSOR;",
          "938:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "936: #line 937 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "985:  ZVAL_STRINGL(rval, str, len);",
          "986:  return 1;",
          "987: }",
          "989: yy53:",
          "990:  yych = *++YYCURSOR;",
          "991:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "988: #line 989 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "989: #line 990 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1082:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1083:  return 1;",
          "1084: }",
          "1086: yy65:",
          "1087:  yych = *++YYCURSOR;",
          "1088:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1085: #line 1086 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1158:  return 1;",
          "1159: }",
          "1161: yy76:",
          "1162:  yych = *++YYCURSOR;",
          "1163:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1160: #line 1161 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1210:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1211:  return 1;",
          "1212: }",
          "1214: yy83:",
          "1215:  yych = *++YYCURSOR;",
          "1216:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1213: #line 1214 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1224:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1225:  return 1;",
          "1226: }",
          "1228: yy87:",
          "1229:  ++YYCURSOR;",
          "1230: #line 573 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1227: #line 1228 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1228: #line 1229 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1233:  ZVAL_NULL(rval);",
          "1234:  return 1;",
          "1235: }",
          "1237: yy89:",
          "1238:  yych = *++YYCURSOR;",
          "1239:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1236: #line 1237 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1282:  return 1;",
          "1283: }",
          "1285: yy95:",
          "1286:  yych = *++YYCURSOR;",
          "1287:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1285: #line 1286 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1331:  return 1;",
          "1332: }",
          "1334: }",
          "1335: #line 886 \"ext/standard/var_unserializer.re\"",
          "",
          "[Removed Lines]",
          "1333: #line 1334 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1334: #line 1335 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------"
        ],
        "ext/wddx/wddx.c||ext/wddx/wddx.c": [
          "File: ext/wddx/wddx.c -> ext/wddx/wddx.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "921:    wddx_stack_top(stack, (void**)&ent2);",
          "925:     zval_ptr_dtor(&ent1->data);",
          "926:     efree(ent1);",
          "927:     return;",
          "",
          "[Removed Lines]",
          "924:    if (ent2->type == ST_FIELD && Z_ISUNDEF(ent2->data)) {",
          "",
          "[Added Lines]",
          "924:    if (Z_ISUNDEF(ent2->data)) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1055:     if (Z_LVAL(ent->data) == -1) {",
          "1056:      ZVAL_STRINGL(&ent->data, (char *)tmp, len);",
          "1057:     }",
          "1059:    }",
          "1060:     break;",
          "",
          "[Removed Lines]",
          "1058:     efree(tmp);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1090:  if (stack.top == 1) {",
          "1091:   wddx_stack_top(&stack, (void**)&ent);",
          "1094:  } else {",
          "1095:   retval = FAILURE;",
          "1096:  }",
          "",
          "[Removed Lines]",
          "1092:   ZVAL_COPY(return_value, &ent->data);",
          "1093:   retval = SUCCESS;",
          "",
          "[Added Lines]",
          "1091:   if (IS_UNDEF(ent->data)) {",
          "1092:    retval = FAILURE;",
          "1093:   } else {",
          "1094:    ZVAL_COPY(return_value, &ent->data);",
          "1095:    retval = SUCCESS;",
          "1096:   }",
          "",
          "---------------"
        ]
      }
    }
  ]
}