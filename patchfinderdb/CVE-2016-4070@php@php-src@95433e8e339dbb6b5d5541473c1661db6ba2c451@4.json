{
  "cve_id": "CVE-2016-4070",
  "cve_desc": "Integer overflow in the php_raw_url_encode function in ext/standard/url.c in PHP before 5.5.34, 5.6.x before 5.6.20, and 7.x before 7.0.5 allows remote attackers to cause a denial of service (application crash) via a long string to the rawurlencode function. NOTE: the vendor says \"Not sure if this qualifies as security issue (probably not).",
  "repo": "php/php-src",
  "patch_hash": "95433e8e339dbb6b5d5541473c1661db6ba2c451",
  "patch_info": {
    "commit_hash": "95433e8e339dbb6b5d5541473c1661db6ba2c451",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/95433e8e339dbb6b5d5541473c1661db6ba2c451",
    "files": [
      "ext/standard/url.c",
      "main/php_version.h"
    ],
    "message": "Fix bug #71798 - Integer Overflow in php_raw_url_encode",
    "before_after_code_files": [
      "ext/standard/url.c||ext/standard/url.c",
      "main/php_version.h||main/php_version.h"
    ]
  },
  "patch_diff": {
    "ext/standard/url.c||ext/standard/url.c": [
      "File: ext/standard/url.c -> ext/standard/url.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "600: PHPAPI char *php_raw_url_encode(char const *s, int len, int *new_length)",
      "601: {",
      "603:  unsigned char *str;",
      "605:  str = (unsigned char *) safe_emalloc(3, len, 1);",
      "",
      "[Removed Lines]",
      "602:  register int x, y;",
      "",
      "[Added Lines]",
      "602:  register size_t x, y;",
      "",
      "---------------"
    ],
    "main/php_version.h||main/php_version.h": [
      "File: main/php_version.h -> main/php_version.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: #define PHP_MAJOR_VERSION 5",
      "4: #define PHP_MINOR_VERSION 5",
      "6: #define PHP_EXTRA_VERSION \"-dev\"",
      "",
      "[Removed Lines]",
      "5: #define PHP_RELEASE_VERSION 34",
      "7: #define PHP_VERSION \"5.5.34-dev\"",
      "8: #define PHP_VERSION_ID 50534",
      "",
      "[Added Lines]",
      "5: #define PHP_RELEASE_VERSION 27",
      "7: #define PHP_VERSION \"5.5.27-dev\"",
      "8: #define PHP_VERSION_ID 50527",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "633bb5ccb4f55ef140447b3faaeb7a6614909a63",
      "candidate_info": {
        "commit_hash": "633bb5ccb4f55ef140447b3faaeb7a6614909a63",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/633bb5ccb4f55ef140447b3faaeb7a6614909a63",
        "files": [
          "NEWS",
          "configure.in",
          "main/php_version.h"
        ],
        "message": "5.5.35",
        "before_after_code_files": [
          "configure.in||configure.in",
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "120: PHP_MAJOR_VERSION=5",
          "121: PHP_MINOR_VERSION=5",
          "124: PHP_VERSION=\"$PHP_MAJOR_VERSION.$PHP_MINOR_VERSION.$PHP_RELEASE_VERSION$PHP_EXTRA_VERSION\"",
          "125: PHP_VERSION_ID=`expr [$]PHP_MAJOR_VERSION \\* 10000 + [$]PHP_MINOR_VERSION \\* 100 + [$]PHP_RELEASE_VERSION`",
          "",
          "[Removed Lines]",
          "122: PHP_RELEASE_VERSION=36",
          "123: PHP_EXTRA_VERSION=\"-dev\"",
          "",
          "[Added Lines]",
          "122: PHP_RELEASE_VERSION=35",
          "123: PHP_EXTRA_VERSION=\"\"",
          "",
          "---------------"
        ],
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 5",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "",
          "[Removed Lines]",
          "5: #define PHP_RELEASE_VERSION 36",
          "7: #define PHP_VERSION \"5.5.36-dev\"",
          "8: #define PHP_VERSION_ID 50536",
          "",
          "[Added Lines]",
          "5: #define PHP_RELEASE_VERSION 35",
          "7: #define PHP_VERSION \"5.5.35-dev\"",
          "8: #define PHP_VERSION_ID 50535",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e21f87e9578884b8cc7914d1e68aca0a0b54c8b7",
      "candidate_info": {
        "commit_hash": "e21f87e9578884b8cc7914d1e68aca0a0b54c8b7",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/e21f87e9578884b8cc7914d1e68aca0a0b54c8b7",
        "files": [
          "configure.in",
          "ext/phar/phar_internal.h",
          "ext/phar/tests/bug69441.phar",
          "ext/phar/tests/bug69441.phpt",
          "main/php_version.h"
        ],
        "message": "Merge branch 'PHP-5.4' into PHP-5.5\n\n* PHP-5.4:\n  5.4.41 next\n  fix CVE num\n  update NEWS\n  Fix bug #69441 (Buffer Overflow when parsing tar/zip/phar in phar_set_inode)\n  fix type in fix for #69085\n  fix CVE num\n\nConflicts:\n\tconfigure.in\n\tmain/php_version.h",
        "before_after_code_files": [
          "configure.in||configure.in",
          "ext/phar/phar_internal.h||ext/phar/phar_internal.h",
          "ext/phar/tests/bug69441.phpt||ext/phar/tests/bug69441.phpt",
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "120: PHP_MAJOR_VERSION=5",
          "121: PHP_MINOR_VERSION=5",
          "124: PHP_VERSION=\"$PHP_MAJOR_VERSION.$PHP_MINOR_VERSION.$PHP_RELEASE_VERSION$PHP_EXTRA_VERSION\"",
          "125: PHP_VERSION_ID=`expr [$]PHP_MAJOR_VERSION \\* 10000 + [$]PHP_MINOR_VERSION \\* 100 + [$]PHP_RELEASE_VERSION`",
          "",
          "[Removed Lines]",
          "122: PHP_RELEASE_VERSION=24",
          "123: PHP_EXTRA_VERSION=\"RC1\"",
          "",
          "[Added Lines]",
          "122: PHP_RELEASE_VERSION=25",
          "123: PHP_EXTRA_VERSION=\"-dev\"",
          "",
          "---------------"
        ],
        "ext/phar/phar_internal.h||ext/phar/phar_internal.h": [
          "File: ext/phar/phar_internal.h -> ext/phar/phar_internal.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "561: {",
          "562:  char tmp[MAXPATHLEN];",
          "563:  int tmp_len;",
          "568:  entry->inode = (unsigned short)zend_get_hash_value(tmp, tmp_len);",
          "569: }",
          "",
          "[Removed Lines]",
          "565:  tmp_len = entry->filename_len + entry->phar->fname_len;",
          "566:  memcpy(tmp, entry->phar->fname, entry->phar->fname_len);",
          "567:  memcpy(tmp + entry->phar->fname_len, entry->filename, entry->filename_len);",
          "",
          "[Added Lines]",
          "564:  size_t len;",
          "566:  tmp_len = MIN(MAXPATHLEN, entry->filename_len + entry->phar->fname_len);",
          "567:  len = MIN(entry->phar->fname_len, tmp_len);",
          "568:  memcpy(tmp, entry->phar->fname, len);",
          "569:  len = MIN(tmp_len - len, entry->filename_len);",
          "570:  memcpy(tmp + entry->phar->fname_len, entry->filename, len);",
          "",
          "---------------"
        ],
        "ext/phar/tests/bug69441.phpt||ext/phar/tests/bug69441.phpt": [
          "File: ext/phar/tests/bug69441.phpt -> ext/phar/tests/bug69441.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Phar: bug #69441: Buffer Overflow when parsing tar/zip/phar in phar_set_inode",
          "3: --SKIPIF--",
          "4: <?php if (!extension_loaded(\"phar\")) die(\"skip\"); ?>",
          "5: --FILE--",
          "6: <?php",
          "7: $fname = dirname(__FILE__) . '/bug69441.phar';",
          "8: try {",
          "9: $r = new Phar($fname, 0);",
          "10: } catch(UnexpectedValueException $e) {",
          "11:  echo $e;",
          "12: }",
          "13: ?>",
          "15: ==DONE==",
          "16: --EXPECTF--",
          "17: exception 'UnexpectedValueException' with message 'phar error: corrupted central directory entry, no magic signature in zip-based phar \"%s/bug69441.phar\"' in %s/bug69441.php:%d",
          "18: Stack trace:",
          "19: #0 %s/bug69441.php(%d): Phar->__construct('%s', 0)",
          "20: #1 {main}",
          "21: ==DONE==",
          "",
          "---------------"
        ],
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 5",
          "",
          "[Removed Lines]",
          "5: #define PHP_RELEASE_VERSION 24",
          "6: #define PHP_EXTRA_VERSION \"RC1\"",
          "7: #define PHP_VERSION \"5.5.24RC1\"",
          "8: #define PHP_VERSION_ID 50524",
          "",
          "[Added Lines]",
          "5: #define PHP_RELEASE_VERSION 25",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "7: #define PHP_VERSION \"5.5.25-dev\"",
          "8: #define PHP_VERSION_ID 50525",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "527e8e73c97e282b1efde24cfb95dc0942e0ad59",
      "candidate_info": {
        "commit_hash": "527e8e73c97e282b1efde24cfb95dc0942e0ad59",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/527e8e73c97e282b1efde24cfb95dc0942e0ad59",
        "files": [
          "NEWS",
          "configure.in",
          "main/php_version.h"
        ],
        "message": "5.5.36",
        "before_after_code_files": [
          "configure.in||configure.in",
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "120: PHP_MAJOR_VERSION=5",
          "121: PHP_MINOR_VERSION=5",
          "122: PHP_RELEASE_VERSION=36",
          "124: PHP_VERSION=\"$PHP_MAJOR_VERSION.$PHP_MINOR_VERSION.$PHP_RELEASE_VERSION$PHP_EXTRA_VERSION\"",
          "125: PHP_VERSION_ID=`expr [$]PHP_MAJOR_VERSION \\* 10000 + [$]PHP_MINOR_VERSION \\* 100 + [$]PHP_RELEASE_VERSION`",
          "",
          "[Removed Lines]",
          "123: PHP_EXTRA_VERSION=\"-dev\"",
          "",
          "[Added Lines]",
          "123: PHP_EXTRA_VERSION=\"\"",
          "",
          "---------------"
        ],
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 5",
          "5: #define PHP_RELEASE_VERSION 36",
          "8: #define PHP_VERSION_ID 50536",
          "",
          "[Removed Lines]",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "7: #define PHP_VERSION \"5.5.36-dev\"",
          "",
          "[Added Lines]",
          "6: #define PHP_EXTRA_VERSION \"\"",
          "7: #define PHP_VERSION \"5.5.36\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3f08fc0466a2acd38763b23f85e06eb02950c6ea",
      "candidate_info": {
        "commit_hash": "3f08fc0466a2acd38763b23f85e06eb02950c6ea",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/3f08fc0466a2acd38763b23f85e06eb02950c6ea",
        "files": [
          "NEWS",
          "configure.in",
          "main/php_version.h"
        ],
        "message": "5.5.31 now",
        "before_after_code_files": [
          "configure.in||configure.in",
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "120: PHP_MAJOR_VERSION=5",
          "121: PHP_MINOR_VERSION=5",
          "123: PHP_EXTRA_VERSION=\"-dev\"",
          "124: PHP_VERSION=\"$PHP_MAJOR_VERSION.$PHP_MINOR_VERSION.$PHP_RELEASE_VERSION$PHP_EXTRA_VERSION\"",
          "125: PHP_VERSION_ID=`expr [$]PHP_MAJOR_VERSION \\* 10000 + [$]PHP_MINOR_VERSION \\* 100 + [$]PHP_RELEASE_VERSION`",
          "",
          "[Removed Lines]",
          "122: PHP_RELEASE_VERSION=30",
          "",
          "[Added Lines]",
          "122: PHP_RELEASE_VERSION=31",
          "",
          "---------------"
        ],
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 5",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "",
          "[Removed Lines]",
          "5: #define PHP_RELEASE_VERSION 30",
          "7: #define PHP_VERSION \"5.5.30-dev\"",
          "8: #define PHP_VERSION_ID 50530",
          "",
          "[Added Lines]",
          "5: #define PHP_RELEASE_VERSION 31",
          "7: #define PHP_VERSION \"5.5.31-dev\"",
          "8: #define PHP_VERSION_ID 50531",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f0120ff8787ce5efc509a8365fd815d1144c366e",
      "candidate_info": {
        "commit_hash": "f0120ff8787ce5efc509a8365fd815d1144c366e",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/f0120ff8787ce5efc509a8365fd815d1144c366e",
        "files": [
          "NEWS",
          "configure.in",
          "main/php_version.h"
        ],
        "message": "5.5.35 now",
        "before_after_code_files": [
          "configure.in||configure.in",
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "120: PHP_MAJOR_VERSION=5",
          "121: PHP_MINOR_VERSION=5",
          "123: PHP_EXTRA_VERSION=\"-dev\"",
          "124: PHP_VERSION=\"$PHP_MAJOR_VERSION.$PHP_MINOR_VERSION.$PHP_RELEASE_VERSION$PHP_EXTRA_VERSION\"",
          "125: PHP_VERSION_ID=`expr [$]PHP_MAJOR_VERSION \\* 10000 + [$]PHP_MINOR_VERSION \\* 100 + [$]PHP_RELEASE_VERSION`",
          "",
          "[Removed Lines]",
          "122: PHP_RELEASE_VERSION=34",
          "",
          "[Added Lines]",
          "122: PHP_RELEASE_VERSION=35",
          "",
          "---------------"
        ],
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 5",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "",
          "[Removed Lines]",
          "5: #define PHP_RELEASE_VERSION 34",
          "7: #define PHP_VERSION \"5.5.34-dev\"",
          "8: #define PHP_VERSION_ID 50534",
          "",
          "[Added Lines]",
          "5: #define PHP_RELEASE_VERSION 35",
          "7: #define PHP_VERSION \"5.5.35-dev\"",
          "8: #define PHP_VERSION_ID 50535",
          "",
          "---------------"
        ]
      }
    }
  ]
}