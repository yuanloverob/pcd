{
  "cve_id": "CVE-2017-13083",
  "cve_desc": "Akeo Consulting Rufus prior to version 2.17.1187 does not adequately validate the integrity of updates downloaded over HTTP, allowing an attacker to easily convince a user to execute arbitrary code",
  "repo": "pbatard/rufus",
  "patch_hash": "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
  "patch_info": {
    "commit_hash": "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
    "repo": "pbatard/rufus",
    "commit_url": "https://github.com/pbatard/rufus/commit/c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
    "files": [
      "res/localization/rufus.loc",
      "src/pki.c",
      "src/rufus.rc",
      "src/stdlg.c"
    ],
    "message": "[pki] fix https://www.kb.cert.org/vuls/id/403768\n\n* This commit effectively fixes https://www.kb.cert.org/vuls/id/403768 (CVE-2017-13083) as\n  it is described per its revision 11, which is the latest revision at the time of this commit,\n  by disabling Windows prompts, enacted during signature validation, that allow the user to\n  bypass the intended signature verification checks.\n* It needs to be pointed out that the vulnerability (\"allow(ing) the use of a self-signed\n  certificate\"), which relies on the end-user actively ignoring a Windows prompt that tells\n  them that the update failed the signature validation whilst also advising against running it,\n  is being fully addressed, even as the update protocol remains HTTP.\n* It also need to be pointed out that the extended delay (48 hours) between the time the\n  vulnerability was reported and the moment it is fixed in our codebase has to do with\n  the fact that the reporter chose to deviate from standard security practices by not\n  disclosing the details of the vulnerability with us, be it publicly or privately,\n  before creating the cert.org report. The only advance notification we received was a\n  generic note about the use of HTTP vs HTTPS, which, as have established, is not\n  immediately relevant to addressing the reported vulnerability.\n* Closes #1009\n* Note: The other vulnerability scenario described towards the end of #1009, which\n  doesn't have to do with the \"lack of CA checking\", will be addressed separately.",
    "before_after_code_files": [
      "res/localization/rufus.loc||res/localization/rufus.loc",
      "src/pki.c||src/pki.c",
      "src/rufus.rc||src/rufus.rc",
      "src/stdlg.c||src/stdlg.c"
    ]
  },
  "patch_diff": {
    "res/localization/rufus.loc||res/localization/rufus.loc": [
      "File: res/localization/rufus.loc -> res/localization/rufus.loc",
      "--- Hunk 1 ---",
      "[Context before]",
      "487: # eg. \"Partitioning (MBR)...\"",
      "488: t MSG_238 \"Partitioning (%s)...\"",
      "489: t MSG_239 \"Deleting partitions...\"",
      "490: t MSG_241 \"Downloading: %0.1f%%\"",
      "491: t MSG_242 \"Failed to download file.\"",
      "492: t MSG_243 \"Checking for Rufus updates...\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "490: t MSG_240 \"The signature for the downloaded update can not be validated. This could mean that your \"",
      "491:  \"system is improperly configured for signature validation or indicate a malicious download.\\n\\n\"",
      "492:  \"The download will be deleted. Please check the log for more details.\"",
      "",
      "---------------"
    ],
    "src/pki.c||src/pki.c": [
      "File: src/pki.c -> src/pki.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "53:  static char error_string[64];",
      "54:  DWORD error_code = GetLastError();",
      "57:   return WindowsErrorString();",
      "59:  switch (error_code) {",
      "",
      "[Removed Lines]",
      "56:  if ((error_code >> 16) != 0x8009)",
      "",
      "[Added Lines]",
      "56:  if (((error_code >> 16) != 0x8009) && ((error_code >> 16) != 0x800B))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "113:   return \"Cannot complete usage check.\";",
      "114:  case CRYPT_E_NO_TRUSTED_SIGNER:",
      "115:   return \"None of the signers of the cryptographic message or certificate trust list is trusted.\";",
      "116:  default:",
      "117:   static_sprintf(error_string, \"Unknown PKI error 0x%08lX\", error_code);",
      "118:   return error_string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "116:  case CERT_E_UNTRUSTEDROOT:",
      "117:   return \"The root certificate is not trusted.\";",
      "118:  case TRUST_E_NOSIGNATURE:",
      "119:   return \"Not digitally signed.\";",
      "120:  case TRUST_E_EXPLICIT_DISTRUST:",
      "121:   return \"One of the certificates used was marked as untrusted by the user.\";",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "268:  }",
      "270:  trust_data.cbStruct = sizeof(trust_data);",
      "273:  trust_data.fdwRevocationChecks = WTD_REVOKE_WHOLECHAIN;",
      "",
      "[Removed Lines]",
      "271:  trust_data.dwUIChoice = WTD_UI_ALL;",
      "",
      "[Added Lines]",
      "283:  trust_data.dwUIChoice = WTD_UI_NONE;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "279:  r = WinVerifyTrust(NULL, &guid_generic_verify, &trust_data);",
      "280:  safe_free(trust_file.pcwszFilePath);",
      "282:  return r;",
      "283: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "293:  switch (r) {",
      "294:  case ERROR_SUCCESS:",
      "295:   break;",
      "296:  case TRUST_E_NOSIGNATURE:",
      "298:   uprintf(\"PKI: File does not appear to be signed: %s\", WinPKIErrorString());",
      "299:   MessageBoxExU(hDlg, lmprintf(MSG_284), lmprintf(MSG_283), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);",
      "300:   break;",
      "301:  default:",
      "302:   uprintf(\"PKI: Failed to validate signature: %s\", WinPKIErrorString());",
      "303:   MessageBoxExU(hDlg, lmprintf(MSG_240), lmprintf(MSG_283), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);",
      "304:   break;",
      "305:  }",
      "",
      "---------------"
    ],
    "src/rufus.rc||src/rufus.rc": [
      "File: src/rufus.rc -> src/rufus.rc",
      "--- Hunk 1 ---",
      "[Context before]",
      "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
      "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
      "35: EXSTYLE WS_EX_ACCEPTFILES",
      "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
      "38: BEGIN",
      "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
      "",
      "[Removed Lines]",
      "36: CAPTION \"Rufus 2.17.1186\"",
      "",
      "[Added Lines]",
      "36: CAPTION \"Rufus 2.17.1187\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "368: VS_VERSION_INFO VERSIONINFO",
      "371:  FILEFLAGSMASK 0x3fL",
      "372: #ifdef _DEBUG",
      "373:  FILEFLAGS 0x1L",
      "",
      "[Removed Lines]",
      "369:  FILEVERSION 2,17,1186,0",
      "370:  PRODUCTVERSION 2,17,1186,0",
      "",
      "[Added Lines]",
      "369:  FILEVERSION 2,17,1187,0",
      "370:  PRODUCTVERSION 2,17,1187,0",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "384:         BEGIN",
      "385:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
      "386:             VALUE \"FileDescription\", \"Rufus\"",
      "388:             VALUE \"InternalName\", \"Rufus\"",
      "389:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
      "390:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
      "391:             VALUE \"OriginalFilename\", \"rufus.exe\"",
      "392:             VALUE \"ProductName\", \"Rufus\"",
      "394:         END",
      "395:     END",
      "396:     BLOCK \"VarFileInfo\"",
      "",
      "[Removed Lines]",
      "387:             VALUE \"FileVersion\", \"2.17.1186\"",
      "393:             VALUE \"ProductVersion\", \"2.17.1186\"",
      "",
      "[Added Lines]",
      "387:             VALUE \"FileVersion\", \"2.17.1187\"",
      "393:             VALUE \"ProductVersion\", \"2.17.1187\"",
      "",
      "---------------"
    ],
    "src/stdlg.c||src/stdlg.c": [
      "File: src/stdlg.c -> src/stdlg.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1674:    case 2:  // Launch newer version and close this one",
      "1675:     Sleep(1000); // Add a delay on account of antivirus scanners",
      "1678:      break;",
      "1680:     memset(&si, 0, sizeof(si));",
      "1681:     memset(&pi, 0, sizeof(pi));",
      "",
      "[Removed Lines]",
      "1677:     if (ValidateSignature(hDlg, filepath) != NO_ERROR)",
      "",
      "[Added Lines]",
      "1677:     if (ValidateSignature(hDlg, filepath) != NO_ERROR) {",
      "1679:      _unlinkU(filepath);",
      "1680:      EnableWindow(GetDlgItem(hDlg, IDC_DOWNLOAD), FALSE);",
      "1682:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3b4b742772adc8eedc7e9c9dab9b277c550b5de2",
      "candidate_info": {
        "commit_hash": "3b4b742772adc8eedc7e9c9dab9b277c550b5de2",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/3b4b742772adc8eedc7e9c9dab9b277c550b5de2",
        "files": [
          "src/format.c",
          "src/rufus.c",
          "src/rufus.h",
          "src/rufus.rc"
        ],
        "message": "[wintogo] add an error popup if we can't select the version",
        "before_after_code_files": [
          "src/format.c||src/format.c",
          "src/rufus.c||src/rufus.c",
          "src/rufus.h||src/rufus.h",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "src/format.c||src/format.c": [
          "File: src/format.c -> src/format.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1285: {",
          "1286:  char *mounted_iso, *build, image[128];",
          "1287:  char tmp_path[MAX_PATH] = \"\", xml_file[MAX_PATH] = \"\";",
          "",
          "[Removed Lines]",
          "1284: BOOL SetWinToGoIndex(void)",
          "",
          "[Added Lines]",
          "1285: int SetWinToGoIndex(void)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1344:   if ((build_nr < 15000) && (SelectedDrive.MediaType != FixedMedia)) {",
          "1345:    if (MessageBoxExU(hMainDialog, lmprintf(MSG_098), lmprintf(MSG_190),",
          "1346:     MB_YESNO | MB_ICONWARNING | MB_IS_RTL, selected_langid) != IDYES)",
          "1348:   }",
          "1349:  }",
          "1350:  StrArrayDestroy(&version_name);",
          "",
          "[Removed Lines]",
          "1347:     wintogo_index = -1;",
          "",
          "[Added Lines]",
          "1348:     wintogo_index = -2;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1353: out:",
          "1354:  DeleteFileU(xml_file);",
          "1355:  UnMountISO();",
          "1357: }",
          "",
          "[Removed Lines]",
          "1356:  return (wintogo_index >= 0);",
          "",
          "[Added Lines]",
          "1357:  return wintogo_index;",
          "",
          "---------------"
        ],
        "src/rufus.c||src/rufus.c": [
          "File: src/rufus.c -> src/rufus.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1308:     }",
          "1309:    }",
          "1312:     return FALSE;",
          "1313:   } else if (tt == TT_UEFI) {",
          "1314:    if (!IS_EFI_BOOTABLE(img_report)) {",
          "",
          "[Removed Lines]",
          "1311:    if (!SetWinToGoIndex())",
          "",
          "[Added Lines]",
          "1311:    switch(SetWinToGoIndex()) {",
          "1312:    case -1:",
          "1313:     MessageBoxExU(hMainDialog, lmprintf(MSG_073), lmprintf(MSG_291), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);",
          "1315:    case -2:",
          "1317:    default:",
          "1318:     break;",
          "1319:    }",
          "",
          "---------------"
        ],
        "src/rufus.h||src/rufus.h": [
          "File: src/rufus.h -> src/rufus.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "480: extern BOOL WimApplyImage(const char* image, int index, const char* dst);",
          "481: extern BOOL IsBootableImage(const char* path);",
          "482: extern BOOL AppendVHDFooter(const char* vhd_path);",
          "484: extern int IsHDD(DWORD DriveIndex, uint16_t vid, uint16_t pid, const char* strid);",
          "485: extern char* GetSignatureName(const char* path);",
          "486: extern LONG ValidateSignature(HWND hDlg, const char* path);",
          "",
          "[Removed Lines]",
          "483: extern BOOL SetWinToGoIndex(void);",
          "",
          "[Added Lines]",
          "483: extern int SetWinToGoIndex(void);",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.15.1102\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.15.1103\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,15,1102,0",
          "338:  PRODUCTVERSION 2,15,1102,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,15,1103,0",
          "338:  PRODUCTVERSION 2,15,1103,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.15.1102\"",
          "361:             VALUE \"ProductVersion\", \"2.15.1102\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.15.1103\"",
          "361:             VALUE \"ProductVersion\", \"2.15.1103\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f7b839c596c5055528e7cca118b932d512f2a88e",
      "candidate_info": {
        "commit_hash": "f7b839c596c5055528e7cca118b932d512f2a88e",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/f7b839c596c5055528e7cca118b932d512f2a88e",
        "files": [
          "src/rufus.rc",
          "src/stdlg.c"
        ],
        "message": "[ui] fix restore when a dialogbox is displayed while the main window is minimized\n\n* Closes #896",
        "before_after_code_files": [
          "src/rufus.rc||src/rufus.rc",
          "src/stdlg.c||src/stdlg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/rufus.rc||src/rufus.rc",
            "src/stdlg.c||src/stdlg.c"
          ],
          "candidate": [
            "src/rufus.rc||src/rufus.rc",
            "src/stdlg.c||src/stdlg.c"
          ]
        }
      },
      "candidate_diff": {
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.12.1058\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.12.1059\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,12,1058,0",
          "338:  PRODUCTVERSION 2,12,1058,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,12,1059,0",
          "338:  PRODUCTVERSION 2,12,1059,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.12.1058\"",
          "361:             VALUE \"ProductVersion\", \"2.12.1058\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.12.1059\"",
          "361:             VALUE \"ProductVersion\", \"2.12.1059\"",
          "",
          "---------------"
        ],
        "src/stdlg.c||src/stdlg.c": [
          "File: src/stdlg.c -> src/stdlg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1752: INT_PTR MyDialogBox(HINSTANCE hInstance, int Dialog_ID, HWND hWndParent, DLGPROC lpDialogFunc)",
          "1753: {",
          "1754:  LPCDLGTEMPLATE rcTemplate = GetDialogTemplate(Dialog_ID);",
          "1756:  safe_free(rcTemplate);",
          "1757:  return ret;",
          "1758: }",
          "",
          "[Removed Lines]",
          "1755:  INT_PTR ret = DialogBoxIndirect(hMainInstance, rcTemplate, hMainDialog, lpDialogFunc);",
          "",
          "[Added Lines]",
          "1754:  INT_PTR ret;",
          "1761:  ShowWindow(hMainDialog, SW_NORMAL);",
          "1763:  ret = DialogBoxIndirect(hMainInstance, rcTemplate, hWndParent, lpDialogFunc);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a75133cbd15459a6db27e4070663e043164a10b3",
      "candidate_info": {
        "commit_hash": "a75133cbd15459a6db27e4070663e043164a10b3",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/a75133cbd15459a6db27e4070663e043164a10b3",
        "files": [
          "res/localization/rufus.loc",
          "src/rufus.rc"
        ],
        "message": "[loc] update Latvian translation to latest",
        "before_after_code_files": [
          "res/localization/rufus.loc||res/localization/rufus.loc",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "res/localization/rufus.loc||res/localization/rufus.loc": [
          "File: res/localization/rufus.loc -> res/localization/rufus.loc",
          "--- Hunk 1 ---",
          "[Context before]",
          "9236: ################################################################################",
          "9237: l \"lv-LV\" \"Latvian (Latvie\u0161u)\" 0x0426",
          "9239: b \"en-US\"",
          "9241: # Main dialog",
          "",
          "[Removed Lines]",
          "9238: v 1.0.20",
          "",
          "[Added Lines]",
          "9238: v 1.0.21",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "9708:  \"var rad\u012bt aizdom\u012bgas aktivit\u0101tes...\\nVai tie\u0161\u0101m v\u0113laties izpild\u012bt \u0161o failu?\"",
          "9709: t MSG_286 \"Nulles disks: %0.1f%% paveikts\"",
          "9710: t MSG_287 \"neUSB disku noteik\u0161ana\"",
          "9712: ################################################################################",
          "9713: l \"lt-LT\" \"Lithuanian (Lietuvi\u0173)\" 0x0427",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9711: t MSG_288 \"Nepietiekamas lietot\u0101ja ties\u012bbas\"",
          "9712: t MSG_289 \"\u0160ai aplik\u0101cijai nepiecie\u0161amas speci\u0101las ties\u012bbas\"",
          "9713: t MSG_290 \"Failu indeks\u0101cija\"",
          "9714: t MSG_291 \"Versijas izv\u0113le\"",
          "9715: t MSG_292 \"Izv\u0113lieties Windows versiju, kuru v\u0113laties instal\u0113t:\"",
          "9716: t MSG_293 \"Neatbalst\u0101ma Windows versija\"",
          "9717: t MSG_294 \"\u0160o Windows versiju Rufus vairs neatbalsta.\"",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.12.1049\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.12.1050\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,12,1049,0",
          "338:  PRODUCTVERSION 2,12,1049,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,12,1050,0",
          "338:  PRODUCTVERSION 2,12,1050,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.12.1049\"",
          "361:             VALUE \"ProductVersion\", \"2.12.1049\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.12.1050\"",
          "361:             VALUE \"ProductVersion\", \"2.12.1050\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "09538a245629ff5556f4927f5fa2a0023a045d56",
      "candidate_info": {
        "commit_hash": "09538a245629ff5556f4927f5fa2a0023a045d56",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/09538a245629ff5556f4927f5fa2a0023a045d56",
        "files": [
          "res/localization/rufus.loc",
          "src/rufus.rc"
        ],
        "message": "[loc] update Latvian translation to latest",
        "before_after_code_files": [
          "res/localization/rufus.loc||res/localization/rufus.loc",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "res/localization/rufus.loc||res/localization/rufus.loc": [
          "File: res/localization/rufus.loc -> res/localization/rufus.loc",
          "--- Hunk 1 ---",
          "[Context before]",
          "9295: ################################################################################",
          "9296: l \"lv-LV\" \"Latvian (Latvie\u0161u)\" 0x0426",
          "9298: b \"en-US\"",
          "9300: # Main dialog",
          "",
          "[Removed Lines]",
          "9297: v 1.0.21",
          "",
          "[Added Lines]",
          "9297: v 1.0.22",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "9774: t MSG_292 \"Izv\u0113lieties Windows versiju, kuru v\u0113laties instal\u0113t:\"",
          "9775: t MSG_293 \"Neatbalst\u0101ma Windows versija\"",
          "9776: t MSG_294 \"\u0160o Windows versiju Rufus vairs neatbalsta.\"",
          "9778: ################################################################################",
          "9779: l \"lt-LT\" \"Lithuanian (Lietuvi\u0173)\" 0x0427",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9777: t MSG_295 \"Uzman\u012bbu: Neofici\u0101l\u0101 programmas versija!\"",
          "9778: t MSG_296 \"\u0160\u012b Rufus versija nav no ofici\u0101l\u0101 izstr\u0101d\u0101t\u0101ja.\\n\\nVai tie\u0161\u0101m v\u0113laties to izmantot?\"",
          "9779: t MSG_297 \"Noteikts samazin\u0101ts ISO\"",
          "9780: t MSG_298 \"Izv\u0113l\u0113tais ISO fails neatbilst noteiktajam izm\u0113ram: %s datu ir k\u013c\u016bdaini!\\n\\nJa \u0161is fails tika \"",
          "9781:  \"lejupl\u0101d\u0113ts no Interneta, nepiecie\u0161ams lejupl\u0101d\u0113t no jauna un p\u0101rbaud\u012bt MD5 vai SHA kontrolsummu \"",
          "9782:  \"atbilst\u012bbu.\\n\\nPiez\u012bme: apr\u0113\u0137in\u0101t MD5 vai SHA kontrolsummu programm\u0101 Rufus var piespie\u017eot tausti\u0146u '#'.\"",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.16.1135\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.16.1136\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "368: VS_VERSION_INFO VERSIONINFO",
          "371:  FILEFLAGSMASK 0x3fL",
          "372: #ifdef _DEBUG",
          "373:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "369:  FILEVERSION 2,16,1135,0",
          "370:  PRODUCTVERSION 2,16,1135,0",
          "",
          "[Added Lines]",
          "369:  FILEVERSION 2,16,1136,0",
          "370:  PRODUCTVERSION 2,16,1136,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "384:         BEGIN",
          "385:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "386:             VALUE \"FileDescription\", \"Rufus\"",
          "388:             VALUE \"InternalName\", \"Rufus\"",
          "389:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "390:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "391:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "392:             VALUE \"ProductName\", \"Rufus\"",
          "394:         END",
          "395:     END",
          "396:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "387:             VALUE \"FileVersion\", \"2.16.1135\"",
          "393:             VALUE \"ProductVersion\", \"2.16.1135\"",
          "",
          "[Added Lines]",
          "387:             VALUE \"FileVersion\", \"2.16.1136\"",
          "393:             VALUE \"ProductVersion\", \"2.16.1136\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "30137de7cb4e9b0f0256ecbfc39e21a1ae45c3f3",
      "candidate_info": {
        "commit_hash": "30137de7cb4e9b0f0256ecbfc39e21a1ae45c3f3",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/30137de7cb4e9b0f0256ecbfc39e21a1ae45c3f3",
        "files": [
          "src/checksum.c",
          "src/format.c",
          "src/iso.c",
          "src/rufus.c",
          "src/rufus.h",
          "src/rufus.rc",
          "src/vhd.c"
        ],
        "message": "[iso] improve handling of image size\n\n* Don't use the projected size where the actual image size should be used\n* Also fix an issue with the projected size computation",
        "before_after_code_files": [
          "src/checksum.c||src/checksum.c",
          "src/format.c||src/format.c",
          "src/iso.c||src/iso.c",
          "src/rufus.c||src/rufus.c",
          "src/rufus.h||src/rufus.h",
          "src/rufus.rc||src/rufus.rc",
          "src/vhd.c||src/vhd.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "src/checksum.c||src/checksum.c": [
          "File: src/checksum.c -> src/checksum.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "932:   if (_GetTickCount64() > LastRefresh + MAX_REFRESH) {",
          "933:    LastRefresh = _GetTickCount64();",
          "935:    PrintInfo(0, MSG_271, format_percent);",
          "936:    SendMessage(hProgress, PBM_SETPOS, (WPARAM)((format_percent / 100.0f)*MAX_PROGRESS), 0);",
          "938:   }",
          "939:   CHECK_FOR_USER_CANCEL;",
          "",
          "[Removed Lines]",
          "934:    format_percent = (100.0f*rb) / (1.0f*img_report.projected_size);",
          "937:    SetTaskbarProgressValue(rb, img_report.projected_size);",
          "",
          "[Added Lines]",
          "934:    format_percent = (100.0f*rb) / (1.0f*img_report.image_size);",
          "937:    SetTaskbarProgressValue(rb, img_report.image_size);",
          "",
          "---------------"
        ],
        "src/format.c||src/format.c": [
          "File: src/format.c -> src/format.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1505: {",
          "1506:  if (_GetTickCount64() > LastRefresh + MAX_REFRESH) {",
          "1507:   LastRefresh = _GetTickCount64();",
          "1509:   PrintInfo(0, MSG_261, format_percent);",
          "1510:   UpdateProgress(OP_FORMAT, format_percent);",
          "1511:  }",
          "",
          "[Removed Lines]",
          "1508:   format_percent = (100.0f*processed_bytes)/(1.0f*img_report.projected_size);",
          "",
          "[Added Lines]",
          "1508:   format_percent = (100.0f*processed_bytes)/(1.0f*img_report.image_size);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1517:  BOOL s, ret = FALSE;",
          "1518:  LARGE_INTEGER li;",
          "1519:  DWORD rSize, wSize, BufSize;",
          "1521:  uint8_t *buffer = NULL;",
          "1522:  int i;",
          "",
          "[Removed Lines]",
          "1520:  uint64_t wb, target_size = hSourceImage?img_report.projected_size:SelectedDrive.DiskSize;",
          "",
          "[Added Lines]",
          "1520:  uint64_t wb, target_size = hSourceImage?img_report.image_size:SelectedDrive.DiskSize;",
          "",
          "---------------"
        ],
        "src/iso.c||src/iso.c": [
          "File: src/iso.c -> src/iso.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "242:   if (i_file_length >= FOUR_GIGABYTES)",
          "243:    img_report.has_4GB_file = TRUE;",
          "248:    total_blocks++;",
          "249:   return TRUE;",
          "250:  }",
          "",
          "[Removed Lines]",
          "245:   total_blocks += i_file_length/UDF_BLOCKSIZE;",
          "247:   if ((i_file_length != 0) && (i_file_length%ISO_BLOCKSIZE == 0))",
          "",
          "[Added Lines]",
          "245:   total_blocks += i_file_length / ISO_BLOCKSIZE;",
          "247:   if ((i_file_length != 0) && (i_file_length % ISO_BLOCKSIZE != 0))",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "673:   uprintf(\"ISO analysis:\");",
          "674:   SendMessage(hMainDialog, UM_PROGRESS_INIT, PBS_MARQUEE, 0);",
          "675:   total_blocks = 0;",
          "677:   has_ldlinux_c32 = FALSE;",
          "679:   StrArrayCreate(&config_path, 8);",
          "",
          "[Removed Lines]",
          "676:   memset(&img_report, 0, sizeof(img_report));",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/rufus.c||src/rufus.c": [
          "File: src/rufus.c -> src/rufus.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "972:  int i;",
          "974:  uprintf(\"ISO label: '%s'\", img_report.label);",
          "976:  PRINT_ISO_PROP(img_report.has_4GB_file, \"  Has a >4GB file\");",
          "977:  PRINT_ISO_PROP(img_report.has_long_filename, \"  Has a >64 chars filename\");",
          "978:  PRINT_ISO_PROP(HAS_SYSLINUX(img_report), \"  Uses: Syslinux/Isolinux v%s\", img_report.sl_version_str);",
          "",
          "[Removed Lines]",
          "975:  uprintf(\"  Size: %s\", SizeToHumanReadable( img_report.projected_size, FALSE, FALSE));",
          "",
          "[Added Lines]",
          "975:  uprintf(\"  Size: %s (Projected)\", SizeToHumanReadable(img_report.projected_size, FALSE, FALSE));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1015:  PrintInfoDebug(0, MSG_202);",
          "1016:  user_notified = FALSE;",
          "1017:  EnableControls(FALSE);",
          "1018:  img_report.is_iso = (BOOLEAN)ExtractISO(image_path, \"\", TRUE);",
          "1019:  img_report.is_bootable_img = (BOOLEAN)IsBootableImage(image_path);",
          "1022:   SendMessage(hMainDialog, UM_PROGRESS_EXIT, 0, 0);",
          "1023:   PrintInfoDebug(0, MSG_203);",
          "",
          "[Removed Lines]",
          "1020:  if (!img_report.is_iso && !img_report.is_bootable_img) {",
          "",
          "[Added Lines]",
          "1018:  memset(&img_report, 0, sizeof(img_report));",
          "1022:  if ((img_report.image_size == 0) || (!img_report.is_iso && !img_report.is_bootable_img)) {",
          "",
          "---------------"
        ],
        "src/rufus.h||src/rufus.h": [
          "File: src/rufus.h -> src/rufus.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "280:  uint64_t projected_size;",
          "281:  uint32_t install_wim_version;",
          "282:  BOOLEAN is_iso;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "280:  uint64_t image_size;",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.15.1098\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.15.1099\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,15,1098,0",
          "338:  PRODUCTVERSION 2,15,1098,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,15,1099,0",
          "338:  PRODUCTVERSION 2,15,1099,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.15.1098\"",
          "361:             VALUE \"ProductVersion\", \"2.15.1098\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.15.1099\"",
          "361:             VALUE \"ProductVersion\", \"2.15.1099\"",
          "",
          "---------------"
        ],
        "src/vhd.c||src/vhd.c": [
          "File: src/vhd.c -> src/vhd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "293:   uprintf(\"  Could not get image size: %s\", WindowsErrorString());",
          "294:   goto out;",
          "295:  }",
          "298:  size = sizeof(vhd_footer);",
          "300:   footer = (vhd_footer*)malloc(size);",
          "302:   if ( (footer == NULL) || (!SetFilePointerEx(handle, ptr, NULL, FILE_BEGIN)) ||",
          "303:     (!ReadFile(handle, footer, size, &size, NULL)) || (size != sizeof(vhd_footer)) ) {",
          "304:    uprintf(\"  Could not read VHD footer\");",
          "305:    goto out;",
          "306:   }",
          "307:   if (memcmp(footer->cookie, conectix_str, sizeof(footer->cookie)) == 0) {",
          "309:    if ( (bswap_uint32(footer->file_format_version) != VHD_FOOTER_FILE_FORMAT_V1_0)",
          "310:      || (bswap_uint32(footer->disk_type) != VHD_FOOTER_TYPE_FIXED_HARD_DISK)) {",
          "311:     uprintf(\"  Unsupported type of VHD image\");",
          "",
          "[Removed Lines]",
          "296:  img_report.projected_size = (uint64_t)liImageSize.QuadPart;",
          "299:  if ((img_report.compression_type == BLED_COMPRESSION_NONE) && (img_report.projected_size >= (512 + size))) {",
          "301:   ptr.QuadPart = img_report.projected_size - size;",
          "308:    img_report.projected_size -= sizeof(vhd_footer);",
          "",
          "[Added Lines]",
          "296:  img_report.image_size = (uint64_t)liImageSize.QuadPart;",
          "299:  if ((img_report.compression_type == BLED_COMPRESSION_NONE) && (img_report.image_size >= (512 + size))) {",
          "301:   ptr.QuadPart = img_report.image_size - size;",
          "308:    img_report.image_size -= sizeof(vhd_footer);",
          "",
          "---------------"
        ]
      }
    }
  ]
}