{
  "cve_id": "CVE-2014-0063",
  "cve_desc": "Multiple stack-based buffer overflows in PostgreSQL before 8.4.20, 9.0.x before 9.0.16, 9.1.x before 9.1.12, 9.2.x before 9.2.7, and 9.3.x before 9.3.3 allow remote authenticated users to cause a denial of service (crash) or possibly execute arbitrary code via vectors related to an incorrect MAXDATELEN constant and datetime values involving (1) intervals, (2) timestamps, or (3) timezones, a different vulnerability than CVE-2014-0065.",
  "repo": "postgres/postgres",
  "patch_hash": "4318daecc959886d001a6e79c6ea853e8b1dfb4b",
  "patch_info": {
    "commit_hash": "4318daecc959886d001a6e79c6ea853e8b1dfb4b",
    "repo": "postgres/postgres",
    "commit_url": "https://github.com/postgres/postgres/commit/4318daecc959886d001a6e79c6ea853e8b1dfb4b",
    "files": [
      "src/include/utils/datetime.h",
      "src/interfaces/ecpg/pgtypeslib/datetime.c",
      "src/interfaces/ecpg/pgtypeslib/dt.h",
      "src/interfaces/ecpg/pgtypeslib/dt_common.c",
      "src/interfaces/ecpg/pgtypeslib/interval.c",
      "src/interfaces/ecpg/pgtypeslib/timestamp.c",
      "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c",
      "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout",
      "src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc",
      "src/test/regress/expected/interval.out",
      "src/test/regress/sql/interval.sql"
    ],
    "message": "Fix handling of wide datetime input/output.\n\nMany server functions use the MAXDATELEN constant to size a buffer for\nparsing or displaying a datetime value.  It was much too small for the\nlongest possible interval output and slightly too small for certain\nvalid timestamp input, particularly input with a long timezone name.\nThe long input was rejected needlessly; the long output caused\ninterval_out() to overrun its buffer.  ECPG's pgtypes library has a copy\nof the vulnerable functions, which bore the same vulnerabilities along\nwith some of its own.  In contrast to the server, certain long inputs\ncaused stack overflow rather than failing cleanly.  Back-patch to 8.4\n(all supported versions).\n\nReported by Daniel Sch\u00fcssler, reviewed by Tom Lane.\n\nSecurity: CVE-2014-0063",
    "before_after_code_files": [
      "src/include/utils/datetime.h||src/include/utils/datetime.h",
      "src/interfaces/ecpg/pgtypeslib/datetime.c||src/interfaces/ecpg/pgtypeslib/datetime.c",
      "src/interfaces/ecpg/pgtypeslib/dt.h||src/interfaces/ecpg/pgtypeslib/dt.h",
      "src/interfaces/ecpg/pgtypeslib/dt_common.c||src/interfaces/ecpg/pgtypeslib/dt_common.c",
      "src/interfaces/ecpg/pgtypeslib/interval.c||src/interfaces/ecpg/pgtypeslib/interval.c",
      "src/interfaces/ecpg/pgtypeslib/timestamp.c||src/interfaces/ecpg/pgtypeslib/timestamp.c",
      "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c",
      "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout",
      "src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc||src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc",
      "src/test/regress/sql/interval.sql||src/test/regress/sql/interval.sql"
    ]
  },
  "patch_diff": {
    "src/include/utils/datetime.h||src/include/utils/datetime.h": [
      "File: src/include/utils/datetime.h -> src/include/utils/datetime.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "188: #define DTK_DATE_M  (DTK_M(YEAR) | DTK_M(MONTH) | DTK_M(DAY))",
      "189: #define DTK_TIME_M  (DTK_M(HOUR) | DTK_M(MINUTE) | DTK_ALL_SECS_M)",
      "199: typedef struct",
      "",
      "[Removed Lines]",
      "191: #define MAXDATELEN  63  /* maximum possible length of an input date",
      "193: #define MAXDATEFIELDS 25  /* maximum possible number of fields in a date",
      "195: #define TOKMAXLEN  10  /* only this many chars are stored in",
      "",
      "[Added Lines]",
      "197: #define MAXDATELEN  128",
      "199: #define MAXDATEFIELDS 25",
      "201: #define TOKMAXLEN  10",
      "",
      "---------------"
    ],
    "src/interfaces/ecpg/pgtypeslib/datetime.c||src/interfaces/ecpg/pgtypeslib/datetime.c": [
      "File: src/interfaces/ecpg/pgtypeslib/datetime.c -> src/interfaces/ecpg/pgtypeslib/datetime.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "60:  int   nf;",
      "61:  char    *field[MAXDATEFIELDS];",
      "62:  int   ftype[MAXDATEFIELDS];",
      "64:  char    *realptr;",
      "65:  char   **ptr = (endptr != NULL) ? endptr : &realptr;",
      "67:  bool  EuroDates = FALSE;",
      "69:  errno = 0;",
      "71:  {",
      "72:   errno = PGTYPES_DATE_BAD_DATE;",
      "73:   return INT_MIN;",
      "",
      "[Removed Lines]",
      "63:  char  lowstr[MAXDATELEN + 1];",
      "70:  if (strlen(str) >= sizeof(lowstr))",
      "",
      "[Added Lines]",
      "63:  char  lowstr[MAXDATELEN + MAXDATEFIELDS];",
      "70:  if (strlen(str) > MAXDATELEN)",
      "",
      "---------------"
    ],
    "src/interfaces/ecpg/pgtypeslib/dt.h||src/interfaces/ecpg/pgtypeslib/dt.h": [
      "File: src/interfaces/ecpg/pgtypeslib/dt.h -> src/interfaces/ecpg/pgtypeslib/dt.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "192: #define DTK_DATE_M  (DTK_M(YEAR) | DTK_M(MONTH) | DTK_M(DAY))",
      "193: #define DTK_TIME_M  (DTK_M(HOUR) | DTK_M(MINUTE) | DTK_M(SECOND))",
      "203: typedef struct",
      "",
      "[Removed Lines]",
      "195: #define MAXDATELEN  63  /* maximum possible length of an input date",
      "197: #define MAXDATEFIELDS 25  /* maximum possible number of fields in a date",
      "199: #define TOKMAXLEN  10  /* only this many chars are stored in",
      "",
      "[Added Lines]",
      "201: #define MAXDATELEN  128",
      "203: #define MAXDATEFIELDS 25",
      "205: #define TOKMAXLEN  10",
      "",
      "---------------"
    ],
    "src/interfaces/ecpg/pgtypeslib/dt_common.c||src/interfaces/ecpg/pgtypeslib/dt_common.c": [
      "File: src/interfaces/ecpg/pgtypeslib/dt_common.c -> src/interfaces/ecpg/pgtypeslib/dt_common.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1171:  if ((cp = strchr(str, '.')) != NULL)",
      "1172:  {",
      "1173: #ifdef HAVE_INT64_TIMESTAMP",
      "1184: #else",
      "",
      "[Removed Lines]",
      "1174:   char  fstr[MAXDATELEN + 1];",
      "1180:   strcpy(fstr, (cp + 1));",
      "1181:   strcpy(fstr + strlen(fstr), \"000000\");",
      "",
      "[Added Lines]",
      "1174:   char  fstr[7];",
      "1175:   int   i;",
      "1177:   cp++;",
      "1187:   for (i = 0; i < 6; i++)",
      "1188:    fstr[i] = *cp != '\\0' ? *cp++ : '0';",
      "1189:   fstr[i] = '\\0';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1531:   else if (*cp == '.')",
      "1532:   {",
      "1533: #ifdef HAVE_INT64_TIMESTAMP",
      "1544: #else",
      "1545:    str = cp;",
      "",
      "[Removed Lines]",
      "1534:    char  fstr[MAXDATELEN + 1];",
      "1540:    strncpy(fstr, (cp + 1), 7);",
      "1541:    strcpy(fstr + strlen(fstr), \"000000\");",
      "",
      "[Added Lines]",
      "1541:    char  fstr[7];",
      "1542:    int   i;",
      "1544:    cp++;",
      "1554:    for (i = 0; i < 6; i++)",
      "1555:     fstr[i] = *cp != '\\0' ? *cp++ : '0';",
      "1556:    fstr[i] = '\\0';",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1678:  while (*(*endstr) != '\\0')",
      "1679:  {",
      "1680:   field[nf] = lp;",
      "1683:   if (isdigit((unsigned char) *(*endstr)))",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1699:   if (nf >= MAXDATEFIELDS)",
      "1700:    return -1;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1820:   nf++;",
      "1823:  }",
      "",
      "[Removed Lines]",
      "1821:   if (nf > MAXDATEFIELDS)",
      "1822:    return -1;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/interfaces/ecpg/pgtypeslib/interval.c||src/interfaces/ecpg/pgtypeslib/interval.c": [
      "File: src/interfaces/ecpg/pgtypeslib/interval.c -> src/interfaces/ecpg/pgtypeslib/interval.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1094:  tm->tm_sec = 0;",
      "1095:  fsec = 0;",
      "1098:  {",
      "1099:   errno = PGTYPES_INTVL_BAD_INTERVAL;",
      "1100:   return NULL;",
      "",
      "[Removed Lines]",
      "1097:  if (strlen(str) >= sizeof(lowstr))",
      "",
      "[Added Lines]",
      "1097:  if (strlen(str) > MAXDATELEN)",
      "",
      "---------------"
    ],
    "src/interfaces/ecpg/pgtypeslib/timestamp.c||src/interfaces/ecpg/pgtypeslib/timestamp.c": [
      "File: src/interfaces/ecpg/pgtypeslib/timestamp.c -> src/interfaces/ecpg/pgtypeslib/timestamp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "294:  char    *realptr;",
      "295:  char   **ptr = (endptr != NULL) ? endptr : &realptr;",
      "298:  {",
      "299:   errno = PGTYPES_TS_BAD_TIMESTAMP;",
      "300:   return (noresult);",
      "",
      "[Removed Lines]",
      "297:  if (strlen(str) >= sizeof(lowstr))",
      "",
      "[Added Lines]",
      "297:  if (strlen(str) > MAXDATELEN)",
      "",
      "---------------"
    ],
    "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c": [
      "File: src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c -> src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "45:       \"1999.008\",",
      "46:       \"J2451187\",",
      "47:       \"January 8, 99 BC\",",
      "48:       NULL };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "52:       \"........................Xaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"",
      "53:       \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",",
      "55:       \".........................aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"",
      "56:       \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "52:       \"1:59 PDT\",",
      "53:       \"13:24:40 -8:00\",",
      "54:       \"13:24:40.495+3\",",
      "55:       NULL };",
      "57: char *intervals[] = { \"1 minute\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "64:       \"13:24:40.123456789+3\",",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "77:  date date1 ;",
      "80:  timestamp ts1 , ts2 ;",
      "83:  char * text ;",
      "86:  interval * i1 ;",
      "89:  date * dc ;",
      "94:  int i, j;",
      "",
      "[Removed Lines]",
      "76: #line 52 \"dt_test2.pgc\"",
      "79: #line 53 \"dt_test2.pgc\"",
      "82: #line 54 \"dt_test2.pgc\"",
      "85: #line 55 \"dt_test2.pgc\"",
      "88: #line 56 \"dt_test2.pgc\"",
      "91: #line 57 \"dt_test2.pgc\"",
      "",
      "[Added Lines]",
      "86: #line 62 \"dt_test2.pgc\"",
      "89: #line 63 \"dt_test2.pgc\"",
      "92: #line 64 \"dt_test2.pgc\"",
      "95: #line 65 \"dt_test2.pgc\"",
      "98: #line 66 \"dt_test2.pgc\"",
      "101: #line 67 \"dt_test2.pgc\"",
      "",
      "---------------"
    ],
    "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout": [
      "File: src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout -> src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout",
      "--- Hunk 1 ---",
      "[Context before]",
      "8: TS[3,1]: 1999-01-08 01:59:00",
      "9: TS[3,2]: 1999-01-08 13:24:40",
      "10: TS[3,3]: 1999-01-08 13:24:40.495",
      "11: Date[4]: 1999-01-08 (N - F)",
      "12: TS[4,0]: 1999-01-08 00:04:00",
      "13: TS[4,1]: 1999-01-08 01:59:00",
      "14: TS[4,2]: 1999-01-08 13:24:40",
      "15: TS[4,3]: 1999-01-08 13:24:40.495",
      "16: Date[5]: 1999-01-08 (N - F)",
      "17: TS[5,0]: 1999-01-08 00:04:00",
      "18: TS[5,1]: 1999-01-08 01:59:00",
      "19: TS[5,2]: 1999-01-08 13:24:40",
      "20: TS[5,3]: 1999-01-08 13:24:40.495",
      "21: Date[6]: 1999-01-18 (N - F)",
      "22: TS[6,0]: 1999-01-18 00:04:00",
      "23: TS[6,1]: 1999-01-18 01:59:00",
      "24: TS[6,2]: 1999-01-18 13:24:40",
      "25: TS[6,3]: 1999-01-18 13:24:40.495",
      "26: Date[7]: 2003-01-02 (N - F)",
      "27: TS[7,0]: 2003-01-02 00:04:00",
      "28: TS[7,1]: 2003-01-02 01:59:00",
      "29: TS[7,2]: 2003-01-02 13:24:40",
      "30: TS[7,3]: 2003-01-02 13:24:40.495",
      "31: Date[8]: 1999-01-08 (N - F)",
      "32: TS[8,0]: 1999-01-08 00:04:00",
      "33: TS[8,1]: 1999-01-08 01:59:00",
      "34: TS[8,2]: 1999-01-08 13:24:40",
      "35: TS[8,3]: 1999-01-08 13:24:40.495",
      "36: Date[9]: 1999-01-08 (N - F)",
      "37: TS[9,0]: 1999-01-08 00:04:00",
      "38: TS[9,1]: 1999-01-08 01:59:00",
      "39: TS[9,2]: 1999-01-08 13:24:40",
      "40: TS[9,3]: 1999-01-08 13:24:40.495",
      "41: Date[10]: 1999-01-08 (N - F)",
      "42: TS[10,0]: 1999-01-08 00:04:00",
      "43: TS[10,1]: 1999-01-08 01:59:00",
      "44: TS[10,2]: 1999-01-08 13:24:40",
      "45: TS[10,3]: 1999-01-08 13:24:40.495",
      "46: Date[11]: 1999-01-08 (N - F)",
      "47: TS[11,0]: 1999-01-08 00:04:00",
      "48: TS[11,1]: 1999-01-08 01:59:00",
      "49: TS[11,2]: 1999-01-08 13:24:40",
      "50: TS[11,3]: 1999-01-08 13:24:40.495",
      "51: Date[12]: 1999-01-08 (N - F)",
      "52: TS[12,0]: 1999-01-08 00:04:00",
      "53: TS[12,1]: 1999-01-08 01:59:00",
      "54: TS[12,2]: 1999-01-08 13:24:40",
      "55: TS[12,3]: 1999-01-08 13:24:40.495",
      "56: Date[13]: 2006-01-08 (N - F)",
      "57: TS[13,0]: 2006-01-08 00:04:00",
      "58: TS[13,1]: 2006-01-08 01:59:00",
      "59: TS[13,2]: 2006-01-08 13:24:40",
      "60: TS[13,3]: 2006-01-08 13:24:40.495",
      "61: Date[14]: 1999-01-08 (N - F)",
      "62: TS[14,0]: 1999-01-08 00:04:00",
      "63: TS[14,1]: 1999-01-08 01:59:00",
      "64: TS[14,2]: 1999-01-08 13:24:40",
      "65: TS[14,3]: 1999-01-08 13:24:40.495",
      "66: Date[15]: 1999-01-08 (N - F)",
      "67: TS[15,0]: 1999-01-08 00:04:00",
      "68: TS[15,1]: 1999-01-08 01:59:00",
      "69: TS[15,2]: 1999-01-08 13:24:40",
      "70: TS[15,3]: 1999-01-08 13:24:40.495",
      "71: Date[16]: 1999-01-08 (N - F)",
      "72: TS[16,0]: 1999-01-08 00:04:00",
      "73: TS[16,1]: 1999-01-08 01:59:00",
      "74: TS[16,2]: 1999-01-08 13:24:40",
      "75: TS[16,3]: 1999-01-08 13:24:40.495",
      "76: Date[17]: 1999-01-08 (N - F)",
      "77: TS[17,0]: 1999-01-08 00:04:00",
      "78: TS[17,1]: 1999-01-08 01:59:00",
      "79: TS[17,2]: 1999-01-08 13:24:40",
      "80: TS[17,3]: 1999-01-08 13:24:40.495",
      "81: Date[18]: 1999-01-08 (N - F)",
      "82: TS[18,0]: 1999-01-08 00:04:00",
      "83: TS[18,1]: 1999-01-08 01:59:00",
      "84: TS[18,2]: 1999-01-08 13:24:40",
      "85: TS[18,3]: 1999-01-08 13:24:40.495",
      "86: Date[19]: 0099-01-08 BC (N - F)",
      "87: TS[19,0]: 0099-01-08 00:04:00 BC",
      "88: TS[19,1]: 0099-01-08 01:59:00 BC",
      "89: TS[19,2]: 0099-01-08 13:24:40 BC",
      "90: interval[0]: @ 1 min",
      "91: interval_copy[0]: @ 1 min",
      "92: interval[1]: @ 1 day 12 hours 59 mins 10 secs",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "11: TS[3,4]: 1999-01-08 13:24:40.123456",
      "17: TS[4,4]: 1999-01-08 13:24:40.123456",
      "23: TS[5,4]: 1999-01-08 13:24:40.123456",
      "29: TS[6,4]: 1999-01-18 13:24:40.123456",
      "35: TS[7,4]: 2003-01-02 13:24:40.123456",
      "41: TS[8,4]: 1999-01-08 13:24:40.123456",
      "47: TS[9,4]: 1999-01-08 13:24:40.123456",
      "53: TS[10,4]: 1999-01-08 13:24:40.123456",
      "59: TS[11,4]: 1999-01-08 13:24:40.123456",
      "65: TS[12,4]: 1999-01-08 13:24:40.123456",
      "71: TS[13,4]: 2006-01-08 13:24:40.123456",
      "77: TS[14,4]: 1999-01-08 13:24:40.123456",
      "83: TS[15,4]: 1999-01-08 13:24:40.123456",
      "89: TS[16,4]: 1999-01-08 13:24:40.123456",
      "95: TS[17,4]: 1999-01-08 13:24:40.123456",
      "101: TS[18,4]: 1999-01-08 13:24:40.123456",
      "106: TS[19,4]: 0099-01-08 13:24:40.123456 BC",
      "107: Date[20]: - (N - T)",
      "108: Date[21]: - (N - T)",
      "",
      "---------------"
    ],
    "src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc||src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc": [
      "File: src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc -> src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc",
      "--- Hunk 1 ---",
      "[Context before]",
      "27:       \"1999.008\",",
      "28:       \"J2451187\",",
      "29:       \"January 8, 99 BC\",",
      "30:       NULL };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "34:       \"........................Xaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"",
      "35:       \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",",
      "37:       \".........................aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"",
      "38:       \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "34:       \"1:59 PDT\",",
      "35:       \"13:24:40 -8:00\",",
      "36:       \"13:24:40.495+3\",",
      "37:       NULL };",
      "39: char *intervals[] = { \"1 minute\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "46:       \"13:24:40.123456789+3\",",
      "",
      "---------------"
    ],
    "src/test/regress/sql/interval.sql||src/test/regress/sql/interval.sql": [
      "File: src/test/regress/sql/interval.sql -> src/test/regress/sql/interval.sql",
      "--- Hunk 1 ---",
      "[Context before]",
      "108: -- test long interval input",
      "109: select '4 millenniums 5 centuries 4 decades 1 year 4 months 4 days 17 minutes 31 seconds'::interval;",
      "112: -- test justify_hours() and justify_days()",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "111: -- test long interval output",
      "112: select '100000000y 10mon -1000000000d -1000000000h -10min -10.000001s ago'::interval;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "08c8e8962f56c23c6799178d52d3b31350a0708f",
      "candidate_info": {
        "commit_hash": "08c8e8962f56c23c6799178d52d3b31350a0708f",
        "repo": "postgres/postgres",
        "commit_url": "https://github.com/postgres/postgres/commit/08c8e8962f56c23c6799178d52d3b31350a0708f",
        "files": [
          "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c",
          "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout",
          "src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc"
        ],
        "message": "Un-break ecpg test suite under --disable-integer-datetimes.\n\nCommit 4318daecc959886d001a6e79c6ea853e8b1dfb4b broke it.  The change in\nsub-second precision at extreme dates is normal.  The inconsistent\ntruncation vs. rounding is essentially a bug, albeit a longstanding one.\nBack-patch to 8.4, like the causative commit.",
        "before_after_code_files": [
          "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c",
          "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout",
          "src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc||src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c",
            "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout",
            "src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc||src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc"
          ],
          "candidate": [
            "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c",
            "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout",
            "src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc||src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc"
          ]
        }
      },
      "candidate_diff": {
        "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c": [
          "File: src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c -> src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "61:       \"1:59 PDT\",",
          "62:       \"13:24:40 -8:00\",",
          "63:       \"13:24:40.495+3\",",
          "65:       NULL };",
          "67: char *intervals[] = { \"1 minute\",",
          "",
          "[Removed Lines]",
          "64:       \"13:24:40.123456789+3\",",
          "",
          "[Added Lines]",
          "64:       \"13:24:40.123456123+3\",",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "145:     sprintf(t, \"%s %s\", dates[i], times[j]);",
          "146:     ts1 = PGTYPEStimestamp_from_asc(t, NULL);",
          "147:     text = PGTYPEStimestamp_to_asc(ts1);",
          "149:      printf(\"TS[%d,%d]: %s\\n\",",
          "150:       i, j, errno ? \"-\" : text);",
          "151:     free(text);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "149:     if (i != 19 || (j != 3 && j != 4))",
          "",
          "---------------"
        ],
        "src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout||src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout": [
          "File: src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout -> src/interfaces/ecpg/test/expected/pgtypeslib-dt_test2.stdout",
          "--- Hunk 1 ---",
          "[Context before]",
          "103: TS[19,0]: 0099-01-08 00:04:00 BC",
          "104: TS[19,1]: 0099-01-08 01:59:00 BC",
          "105: TS[19,2]: 0099-01-08 13:24:40 BC",
          "107: Date[20]: - (N - T)",
          "108: Date[21]: - (N - T)",
          "109: interval[0]: @ 1 min",
          "",
          "[Removed Lines]",
          "106: TS[19,4]: 0099-01-08 13:24:40.123456 BC",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc||src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc": [
          "File: src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc -> src/interfaces/ecpg/test/pgtypeslib/dt_test2.pgc",
          "--- Hunk 1 ---",
          "[Context before]",
          "43:       \"1:59 PDT\",",
          "44:       \"13:24:40 -8:00\",",
          "45:       \"13:24:40.495+3\",",
          "47:       NULL };",
          "49: char *intervals[] = { \"1 minute\",",
          "",
          "[Removed Lines]",
          "46:       \"13:24:40.123456789+3\",",
          "",
          "[Added Lines]",
          "46:       \"13:24:40.123456123+3\",",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "110:     sprintf(t, \"%s %s\", dates[i], times[j]);",
          "111:     ts1 = PGTYPEStimestamp_from_asc(t, NULL);",
          "112:     text = PGTYPEStimestamp_to_asc(ts1);",
          "114:      printf(\"TS[%d,%d]: %s\\n\",",
          "115:       i, j, errno ? \"-\" : text);",
          "116:     free(text);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "114:     if (i != 19 || (j != 3 && j != 4))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "348aa75a678069569923c501206d5a1ca03654e3",
      "candidate_info": {
        "commit_hash": "348aa75a678069569923c501206d5a1ca03654e3",
        "repo": "postgres/postgres",
        "commit_url": "https://github.com/postgres/postgres/commit/348aa75a678069569923c501206d5a1ca03654e3",
        "files": [
          "src/test/regress/expected/interval.out",
          "src/test/regress/sql/interval.sql"
        ],
        "message": "Fix interval test, which was broken for floating-point timestamps.\n\nCommit 4318daecc959886d001a6e79c6ea853e8b1dfb4b introduced a test that\ncouldn't be made consistent between integer and floating-point\ntimestamps.\n\nIt was designed to test the longest possible interval output length,\nso removing four zeros from the number of hours, as this patch does,\nis not ideal. But the test still has some utility for its original\npurpose, and there aren't a lot of other good options.\n\nNoah Misch suggested a different approach where we test that the\noutput either matches what we expect from integer timestamps or what\nwe expect from floating-point timestamps. That seemed to obscure an\notherwise simple test, however.\n\nReviewed by Tom Lane and Noah Misch.",
        "before_after_code_files": [
          "src/test/regress/sql/interval.sql||src/test/regress/sql/interval.sql"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/test/regress/sql/interval.sql||src/test/regress/sql/interval.sql"
          ],
          "candidate": [
            "src/test/regress/sql/interval.sql||src/test/regress/sql/interval.sql"
          ]
        }
      },
      "candidate_diff": {
        "src/test/regress/sql/interval.sql||src/test/regress/sql/interval.sql": [
          "File: src/test/regress/sql/interval.sql -> src/test/regress/sql/interval.sql",
          "--- Hunk 1 ---",
          "[Context before]",
          "109: select '4 millenniums 5 centuries 4 decades 1 year 4 months 4 days 17 minutes 31 seconds'::interval;",
          "111: -- test long interval output",
          "114: -- test justify_hours() and justify_days()",
          "",
          "[Removed Lines]",
          "112: select '100000000y 10mon -1000000000d -1000000000h -10min -10.000001s ago'::interval;",
          "",
          "[Added Lines]",
          "112: -- Note: the actual maximum length of the interval output is longer,",
          "113: -- but we need the test to work for both integer and floating-point",
          "114: -- timestamps.",
          "115: select '100000000y 10mon -1000000000d -100000h -10min -10.000001s ago'::interval;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "823b9dc2566dbdbdab3c08b83adb64eb428b8ca5",
      "candidate_info": {
        "commit_hash": "823b9dc2566dbdbdab3c08b83adb64eb428b8ca5",
        "repo": "postgres/postgres",
        "commit_url": "https://github.com/postgres/postgres/commit/823b9dc2566dbdbdab3c08b83adb64eb428b8ca5",
        "files": [
          "src/backend/catalog/pg_proc.c",
          "src/backend/commands/functioncmds.c",
          "src/backend/utils/fmgr/fmgr.c",
          "src/include/fmgr.h",
          "src/pl/plperl/plperl.c",
          "src/pl/plpgsql/src/pl_handler.c"
        ],
        "message": "Prevent privilege escalation in explicit calls to PL validators.\n\nThe primary role of PL validators is to be called implicitly during\nCREATE FUNCTION, but they are also normal functions that a user can call\nexplicitly.  Add a permissions check to each validator to ensure that a\nuser cannot use explicit validator calls to achieve things he could not\notherwise achieve.  Back-patch to 8.4 (all supported versions).\nNon-core procedural language extensions ought to make the same two-line\nchange to their own validators.\n\nAndres Freund, reviewed by Tom Lane and Noah Misch.\n\nSecurity: CVE-2014-0061",
        "before_after_code_files": [
          "src/backend/catalog/pg_proc.c||src/backend/catalog/pg_proc.c",
          "src/backend/commands/functioncmds.c||src/backend/commands/functioncmds.c",
          "src/backend/utils/fmgr/fmgr.c||src/backend/utils/fmgr/fmgr.c",
          "src/include/fmgr.h||src/include/fmgr.h",
          "src/pl/plperl/plperl.c||src/pl/plperl/plperl.c",
          "src/pl/plpgsql/src/pl_handler.c||src/pl/plpgsql/src/pl_handler.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/backend/catalog/pg_proc.c||src/backend/catalog/pg_proc.c": [
          "File: src/backend/catalog/pg_proc.c -> src/backend/catalog/pg_proc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "623:  Datum  tmp;",
          "624:  char    *prosrc;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "626:  if (!CheckFunctionValidatorAccess(fcinfo->flinfo->fn_oid, funcoid))",
          "627:   PG_RETURN_VOID();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "672:  char    *prosrc;",
          "673:  char    *probin;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "678:  if (!CheckFunctionValidatorAccess(fcinfo->flinfo->fn_oid, funcoid))",
          "679:   PG_RETURN_VOID();",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "724:  bool  haspolyarg;",
          "725:  int   i;",
          "727:  tuple = SearchSysCache(PROCOID,",
          "728:          ObjectIdGetDatum(funcoid),",
          "729:          0, 0, 0);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "733:  if (!CheckFunctionValidatorAccess(fcinfo->flinfo->fn_oid, funcoid))",
          "734:   PG_RETURN_VOID();",
          "",
          "---------------"
        ],
        "src/backend/commands/functioncmds.c||src/backend/commands/functioncmds.c": [
          "File: src/backend/commands/functioncmds.c -> src/backend/commands/functioncmds.c"
        ],
        "src/backend/utils/fmgr/fmgr.c||src/backend/utils/fmgr/fmgr.c": [
          "File: src/backend/utils/fmgr/fmgr.c -> src/backend/utils/fmgr/fmgr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: #include \"miscadmin.h\"",
          "25: #include \"nodes/nodeFuncs.h\"",
          "26: #include \"pgstat.h\"",
          "27: #include \"utils/builtins.h\"",
          "28: #include \"utils/fmgrtab.h\"",
          "29: #include \"utils/guc.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "27: #include \"utils/acl.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2429:  return false;",
          "2430: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2463: bool",
          "2464: CheckFunctionValidatorAccess(Oid validatorOid, Oid functionOid)",
          "2465: {",
          "2466:  HeapTuple procTup;",
          "2467:  HeapTuple langTup;",
          "2468:  Form_pg_proc procStruct;",
          "2469:  Form_pg_language langStruct;",
          "2470:  AclResult aclresult;",
          "2473:  procTup = SearchSysCache(PROCOID, ObjectIdGetDatum(functionOid), 0, 0, 0);",
          "2474:  if (!HeapTupleIsValid(procTup))",
          "2475:   elog(ERROR, \"cache lookup failed for function %u\", functionOid);",
          "2476:  procStruct = (Form_pg_proc) GETSTRUCT(procTup);",
          "2482:  langTup = SearchSysCache(LANGOID, ObjectIdGetDatum(procStruct->prolang),",
          "2483:         0, 0, 0);",
          "2484:  if (!HeapTupleIsValid(langTup))",
          "2485:   elog(ERROR, \"cache lookup failed for language %u\", procStruct->prolang);",
          "2486:  langStruct = (Form_pg_language) GETSTRUCT(langTup);",
          "2488:  if (langStruct->lanvalidator != validatorOid)",
          "2489:   ereport(ERROR,",
          "2490:     (errcode(ERRCODE_INSUFFICIENT_PRIVILEGE),",
          "2491:      errmsg(\"language validation function %u called for language %u instead of %u\",",
          "2492:       validatorOid, procStruct->prolang,",
          "2493:       langStruct->lanvalidator)));",
          "2496:  aclresult = pg_language_aclcheck(procStruct->prolang, GetUserId(),",
          "2497:           ACL_USAGE);",
          "2498:  if (aclresult != ACLCHECK_OK)",
          "2499:   aclcheck_error(aclresult, ACL_KIND_LANGUAGE,",
          "2500:         NameStr(langStruct->lanname));",
          "2507:  aclresult = pg_proc_aclcheck(functionOid, GetUserId(), ACL_EXECUTE);",
          "2508:  if (aclresult != ACLCHECK_OK)",
          "2509:   aclcheck_error(aclresult, ACL_KIND_PROC, NameStr(procStruct->proname));",
          "2511:  ReleaseSysCache(procTup);",
          "2512:  ReleaseSysCache(langTup);",
          "2514:  return true;",
          "2515: }",
          "",
          "---------------"
        ],
        "src/include/fmgr.h||src/include/fmgr.h": [
          "File: src/include/fmgr.h -> src/include/fmgr.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "518: extern Oid get_call_expr_argtype(fmNodePtr expr, int argnum);",
          "519: extern bool get_fn_expr_arg_stable(FmgrInfo *flinfo, int argnum);",
          "520: extern bool get_call_expr_arg_stable(fmNodePtr expr, int argnum);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "521: extern bool CheckFunctionValidatorAccess(Oid validatorOid, Oid functionOid);",
          "",
          "---------------"
        ],
        "src/pl/plperl/plperl.c||src/pl/plperl/plperl.c": [
          "File: src/pl/plperl/plperl.c -> src/pl/plperl/plperl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1094:  bool  istrigger = false;",
          "1095:  int   i;",
          "1098:  tuple = SearchSysCache(PROCOID,",
          "1099:          ObjectIdGetDatum(funcoid),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1097:  if (!CheckFunctionValidatorAccess(fcinfo->flinfo->fn_oid, funcoid))",
          "1098:   PG_RETURN_VOID();",
          "",
          "---------------"
        ],
        "src/pl/plpgsql/src/pl_handler.c||src/pl/plpgsql/src/pl_handler.c": [
          "File: src/pl/plpgsql/src/pl_handler.c -> src/pl/plpgsql/src/pl_handler.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "136:  bool  istrigger = false;",
          "137:  int   i;",
          "140:  tuple = SearchSysCache(PROCOID,",
          "141:          ObjectIdGetDatum(funcoid),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "139:  if (!CheckFunctionValidatorAccess(fcinfo->flinfo->fn_oid, funcoid))",
          "140:   PG_RETURN_VOID();",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c0ac4c75ff048b8ff6d8436946e9c414c2b64f94",
      "candidate_info": {
        "commit_hash": "c0ac4c75ff048b8ff6d8436946e9c414c2b64f94",
        "repo": "postgres/postgres",
        "commit_url": "https://github.com/postgres/postgres/commit/c0ac4c75ff048b8ff6d8436946e9c414c2b64f94",
        "files": [
          "doc/src/sgml/plhandler.sgml",
          "src/backend/catalog/pg_proc.c",
          "src/backend/commands/functioncmds.c",
          "src/backend/utils/fmgr/fmgr.c",
          "src/include/fmgr.h",
          "src/pl/plperl/plperl.c",
          "src/pl/plpgsql/src/pl_handler.c"
        ],
        "message": "Prevent privilege escalation in explicit calls to PL validators.\n\nThe primary role of PL validators is to be called implicitly during\nCREATE FUNCTION, but they are also normal functions that a user can call\nexplicitly.  Add a permissions check to each validator to ensure that a\nuser cannot use explicit validator calls to achieve things he could not\notherwise achieve.  Back-patch to 8.4 (all supported versions).\nNon-core procedural language extensions ought to make the same two-line\nchange to their own validators.\n\nAndres Freund, reviewed by Tom Lane and Noah Misch.\n\nSecurity: CVE-2014-0061",
        "before_after_code_files": [
          "src/backend/catalog/pg_proc.c||src/backend/catalog/pg_proc.c",
          "src/backend/commands/functioncmds.c||src/backend/commands/functioncmds.c",
          "src/backend/utils/fmgr/fmgr.c||src/backend/utils/fmgr/fmgr.c",
          "src/include/fmgr.h||src/include/fmgr.h",
          "src/pl/plperl/plperl.c||src/pl/plperl/plperl.c",
          "src/pl/plpgsql/src/pl_handler.c||src/pl/plpgsql/src/pl_handler.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/backend/catalog/pg_proc.c||src/backend/catalog/pg_proc.c": [
          "File: src/backend/catalog/pg_proc.c -> src/backend/catalog/pg_proc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "688:  Datum  tmp;",
          "689:  char    *prosrc;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "691:  if (!CheckFunctionValidatorAccess(fcinfo->flinfo->fn_oid, funcoid))",
          "692:   PG_RETURN_VOID();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "735:  char    *prosrc;",
          "736:  char    *probin;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "741:  if (!CheckFunctionValidatorAccess(fcinfo->flinfo->fn_oid, funcoid))",
          "742:   PG_RETURN_VOID();",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "785:  bool  haspolyarg;",
          "786:  int   i;",
          "788:  tuple = SearchSysCache1(PROCOID, ObjectIdGetDatum(funcoid));",
          "789:  if (!HeapTupleIsValid(tuple))",
          "790:   elog(ERROR, \"cache lookup failed for function %u\", funcoid);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "794:  if (!CheckFunctionValidatorAccess(fcinfo->flinfo->fn_oid, funcoid))",
          "795:   PG_RETURN_VOID();",
          "",
          "---------------"
        ],
        "src/backend/commands/functioncmds.c||src/backend/commands/functioncmds.c": [
          "File: src/backend/commands/functioncmds.c -> src/backend/commands/functioncmds.c"
        ],
        "src/backend/utils/fmgr/fmgr.c||src/backend/utils/fmgr/fmgr.c": [
          "File: src/backend/utils/fmgr/fmgr.c -> src/backend/utils/fmgr/fmgr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: #include \"miscadmin.h\"",
          "25: #include \"nodes/nodeFuncs.h\"",
          "26: #include \"pgstat.h\"",
          "27: #include \"utils/builtins.h\"",
          "28: #include \"utils/fmgrtab.h\"",
          "29: #include \"utils/guc.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "27: #include \"utils/acl.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2410:  return false;",
          "2411: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2444: bool",
          "2445: CheckFunctionValidatorAccess(Oid validatorOid, Oid functionOid)",
          "2446: {",
          "2447:  HeapTuple procTup;",
          "2448:  HeapTuple langTup;",
          "2449:  Form_pg_proc procStruct;",
          "2450:  Form_pg_language langStruct;",
          "2451:  AclResult aclresult;",
          "2454:  procTup = SearchSysCache1(PROCOID, ObjectIdGetDatum(functionOid));",
          "2455:  if (!HeapTupleIsValid(procTup))",
          "2456:   elog(ERROR, \"cache lookup failed for function %u\", functionOid);",
          "2457:  procStruct = (Form_pg_proc) GETSTRUCT(procTup);",
          "2463:  langTup = SearchSysCache1(LANGOID, ObjectIdGetDatum(procStruct->prolang));",
          "2464:  if (!HeapTupleIsValid(langTup))",
          "2465:   elog(ERROR, \"cache lookup failed for language %u\", procStruct->prolang);",
          "2466:  langStruct = (Form_pg_language) GETSTRUCT(langTup);",
          "2468:  if (langStruct->lanvalidator != validatorOid)",
          "2469:   ereport(ERROR,",
          "2470:     (errcode(ERRCODE_INSUFFICIENT_PRIVILEGE),",
          "2471:      errmsg(\"language validation function %u called for language %u instead of %u\",",
          "2472:       validatorOid, procStruct->prolang,",
          "2473:       langStruct->lanvalidator)));",
          "2476:  aclresult = pg_language_aclcheck(procStruct->prolang, GetUserId(),",
          "2477:           ACL_USAGE);",
          "2478:  if (aclresult != ACLCHECK_OK)",
          "2479:   aclcheck_error(aclresult, ACL_KIND_LANGUAGE,",
          "2480:         NameStr(langStruct->lanname));",
          "2487:  aclresult = pg_proc_aclcheck(functionOid, GetUserId(), ACL_EXECUTE);",
          "2488:  if (aclresult != ACLCHECK_OK)",
          "2489:   aclcheck_error(aclresult, ACL_KIND_PROC, NameStr(procStruct->proname));",
          "2491:  ReleaseSysCache(procTup);",
          "2492:  ReleaseSysCache(langTup);",
          "2494:  return true;",
          "2495: }",
          "",
          "---------------"
        ],
        "src/include/fmgr.h||src/include/fmgr.h": [
          "File: src/include/fmgr.h -> src/include/fmgr.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "518: extern Oid get_call_expr_argtype(fmNodePtr expr, int argnum);",
          "519: extern bool get_fn_expr_arg_stable(FmgrInfo *flinfo, int argnum);",
          "520: extern bool get_call_expr_arg_stable(fmNodePtr expr, int argnum);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "521: extern bool CheckFunctionValidatorAccess(Oid validatorOid, Oid functionOid);",
          "",
          "---------------"
        ],
        "src/pl/plperl/plperl.c||src/pl/plperl/plperl.c": [
          "File: src/pl/plperl/plperl.c -> src/pl/plperl/plperl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1395:  bool  istrigger = false;",
          "1396:  int   i;",
          "1399:  tuple = SearchSysCache1(PROCOID, ObjectIdGetDatum(funcoid));",
          "1400:  if (!HeapTupleIsValid(tuple))",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1398:  if (!CheckFunctionValidatorAccess(fcinfo->flinfo->fn_oid, funcoid))",
          "1399:   PG_RETURN_VOID();",
          "",
          "---------------"
        ],
        "src/pl/plpgsql/src/pl_handler.c||src/pl/plpgsql/src/pl_handler.c": [
          "File: src/pl/plpgsql/src/pl_handler.c -> src/pl/plpgsql/src/pl_handler.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "217:  bool  istrigger = false;",
          "218:  int   i;",
          "221:  tuple = SearchSysCache1(PROCOID, ObjectIdGetDatum(funcoid));",
          "222:  if (!HeapTupleIsValid(tuple))",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "220:  if (!CheckFunctionValidatorAccess(fcinfo->flinfo->fn_oid, funcoid))",
          "221:   PG_RETURN_VOID();",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "15a8f97b9d16aaf659f58c981242b9da591cf24c",
      "candidate_info": {
        "commit_hash": "15a8f97b9d16aaf659f58c981242b9da591cf24c",
        "repo": "postgres/postgres",
        "commit_url": "https://github.com/postgres/postgres/commit/15a8f97b9d16aaf659f58c981242b9da591cf24c",
        "files": [
          "doc/src/sgml/ref/grant.sgml",
          "src/backend/commands/user.c",
          "src/backend/utils/adt/acl.c",
          "src/test/regress/expected/privileges.out",
          "src/test/regress/sql/privileges.sql"
        ],
        "message": "Shore up ADMIN OPTION restrictions.\n\nGranting a role without ADMIN OPTION is supposed to prevent the grantee\nfrom adding or removing members from the granted role.  Issuing SET ROLE\nbefore the GRANT bypassed that, because the role itself had an implicit\nright to add or remove members.  Plug that hole by recognizing that\nimplicit right only when the session user matches the current role.\nAdditionally, do not recognize it during a security-restricted operation\nor during execution of a SECURITY DEFINER function.  The restriction on\nSECURITY DEFINER is not security-critical.  However, it seems best for a\nuser testing his own SECURITY DEFINER function to see the same behavior\nothers will see.  Back-patch to 8.4 (all supported versions).\n\nThe SQL standards do not conflate roles and users as PostgreSQL does;\nonly SQL roles have members, and only SQL users initiate sessions.  An\napplication using PostgreSQL users and roles as SQL users and roles will\nnever attempt to grant membership in the role that is the session user,\nso the implicit right to add or remove members will never arise.\n\nThe security impact was mostly that a role member could revoke access\nfrom others, contrary to the wishes of his own grantor.  Unapproved role\nmember additions are less notable, because the member can still largely\nachieve that by creating a view or a SECURITY DEFINER function.\n\nReviewed by Andres Freund and Tom Lane.  Reported, independently, by\nJonas Sundman and Noah Misch.\n\nSecurity: CVE-2014-0060",
        "before_after_code_files": [
          "src/backend/commands/user.c||src/backend/commands/user.c",
          "src/backend/utils/adt/acl.c||src/backend/utils/adt/acl.c",
          "src/test/regress/sql/privileges.sql||src/test/regress/sql/privileges.sql"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/backend/commands/user.c||src/backend/commands/user.c": [
          "File: src/backend/commands/user.c -> src/backend/commands/user.c"
        ],
        "src/backend/utils/adt/acl.c||src/backend/utils/adt/acl.c": [
          "File: src/backend/utils/adt/acl.c -> src/backend/utils/adt/acl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4910:  List    *roles_list;",
          "4911:  ListCell   *l;",
          "4918:  if (superuser_arg(member))",
          "4919:   return true;",
          "",
          "[Removed Lines]",
          "4914:  if (member == role)",
          "4915:   return true;",
          "",
          "[Added Lines]",
          "4919:  if (member == role)",
          "4948:   return member == GetSessionUserId() &&",
          "4949:    !InLocalUserIdChange() && !InSecurityRestrictedOperation();",
          "",
          "---------------"
        ],
        "src/test/regress/sql/privileges.sql||src/test/regress/sql/privileges.sql": [
          "File: src/test/regress/sql/privileges.sql -> src/test/regress/sql/privileges.sql",
          "--- Hunk 1 ---",
          "[Context before]",
          "38: ALTER GROUP regressgroup2 ADD USER regressuser2; -- duplicate",
          "39: ALTER GROUP regressgroup2 DROP USER regressuser2;",
          "42: -- test owner privileges",
          "",
          "[Removed Lines]",
          "40: ALTER GROUP regressgroup2 ADD USER regressuser4;",
          "",
          "[Added Lines]",
          "40: GRANT regressgroup2 TO regressuser4 WITH ADMIN OPTION;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "581: SELECT has_table_privilege('regressuser1', 'atest4', 'SELECT WITH GRANT OPTION'); -- true",
          "584: -- has_sequence_privilege tests",
          "585: \\c -",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "584: -- Admin options",
          "586: SET SESSION AUTHORIZATION regressuser4;",
          "587: CREATE FUNCTION dogrant_ok() RETURNS void LANGUAGE sql SECURITY DEFINER AS",
          "588:  'GRANT regressgroup2 TO regressuser5';",
          "589: GRANT regressgroup2 TO regressuser5; -- ok: had ADMIN OPTION",
          "590: SET ROLE regressgroup2;",
          "591: GRANT regressgroup2 TO regressuser5; -- fails: SET ROLE suspended privilege",
          "593: SET SESSION AUTHORIZATION regressuser1;",
          "594: GRANT regressgroup2 TO regressuser5; -- fails: no ADMIN OPTION",
          "595: SELECT dogrant_ok();   -- ok: SECURITY DEFINER conveys ADMIN",
          "596: SET ROLE regressgroup2;",
          "597: GRANT regressgroup2 TO regressuser5; -- fails: SET ROLE did not help",
          "599: SET SESSION AUTHORIZATION regressgroup2;",
          "600: GRANT regressgroup2 TO regressuser5; -- ok: a role can self-admin",
          "601: CREATE FUNCTION dogrant_fails() RETURNS void LANGUAGE sql SECURITY DEFINER AS",
          "602:  'GRANT regressgroup2 TO regressuser5';",
          "603: SELECT dogrant_fails();   -- fails: no self-admin in SECURITY DEFINER",
          "604: DROP FUNCTION dogrant_fails();",
          "606: SET SESSION AUTHORIZATION regressuser4;",
          "607: DROP FUNCTION dogrant_ok();",
          "608: REVOKE regressgroup2 FROM regressuser5;",
          "",
          "---------------"
        ]
      }
    }
  ]
}