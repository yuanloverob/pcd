{
  "cve_id": "CVE-2015-2698",
  "cve_desc": "The iakerb_gss_export_sec_context function in lib/gssapi/krb5/iakerb.c in MIT Kerberos 5 (aka krb5) 1.14 pre-release 2015-09-14 improperly accesses a certain pointer, which allows remote authenticated users to cause a denial of service (memory corruption) or possibly have unspecified other impact by interacting with an application that calls the gss_export_sec_context function.  NOTE: this vulnerability exists because of an incorrect fix for CVE-2015-2696.",
  "repo": "krb5/krb5",
  "patch_hash": "3db8dfec1ef50ddd78d6ba9503185995876a39fd",
  "patch_info": {
    "commit_hash": "3db8dfec1ef50ddd78d6ba9503185995876a39fd",
    "repo": "krb5/krb5",
    "commit_url": "https://github.com/krb5/krb5/commit/3db8dfec1ef50ddd78d6ba9503185995876a39fd",
    "files": [
      "src/lib/gssapi/krb5/gssapiP_krb5.h",
      "src/lib/gssapi/krb5/gssapi_krb5.c",
      "src/lib/gssapi/krb5/iakerb.c"
    ],
    "message": "Fix IAKERB context export/import [CVE-2015-2698]\n\nThe patches for CVE-2015-2696 contained a regression in the newly\nadded IAKERB iakerb_gss_export_sec_context() function, which could\ncause it to corrupt memory.  Fix the regression by properly\ndereferencing the context_handle pointer before casting it.\n\nAlso, the patches did not implement an IAKERB gss_import_sec_context()\nfunction, under the erroneous belief that an exported IAKERB context\nwould be tagged as a krb5 context.  Implement it now to allow IAKERB\ncontexts to be successfully exported and imported after establishment.\n\nCVE-2015-2698:\n\nIn any MIT krb5 release with the patches for CVE-2015-2696 applied, an\napplication which calls gss_export_sec_context() may experience memory\ncorruption if the context was established using the IAKERB mechanism.\nHistorically, some vulnerabilities of this nature can be translated\ninto remote code execution, though the necessary exploits must be\ntailored to the individual application and are usually quite\ncomplicated.\n\n    CVSSv2 Vector: AV:N/AC:H/Au:S/C:C/I:C/A:C/E:POC/RL:OF/RC:C\n\nticket: 8273 (new)\ntarget_version: 1.14\ntags: pullup",
    "before_after_code_files": [
      "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h",
      "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c",
      "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c"
    ]
  },
  "patch_diff": {
    "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h": [
      "File: src/lib/gssapi/krb5/gssapiP_krb5.h -> src/lib/gssapi/krb5/gssapiP_krb5.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "1397: iakerb_gss_export_sec_context(OM_uint32 *minor_status,",
      "1398:                               gss_ctx_id_t *context_handle,",
      "1399:                               gss_buffer_t interprocess_token);",
      "1402: OM_uint32 KRB5_CALLCONV",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1401: OM_uint32 KRB5_CALLCONV",
      "1402: iakerb_gss_import_sec_context(OM_uint32 *minor_status,",
      "1403:                               const gss_buffer_t interprocess_token,",
      "1404:                               gss_ctx_id_t *context_handle);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c": [
      "File: src/lib/gssapi/krb5/gssapi_krb5.c -> src/lib/gssapi/krb5/gssapi_krb5.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "970:     NULL,",
      "971: #else",
      "972:     iakerb_gss_export_sec_context,",
      "974: #endif",
      "975:     krb5_gss_inquire_cred_by_mech,",
      "976:     krb5_gss_inquire_names_for_mech,",
      "",
      "[Removed Lines]",
      "973:     NULL,",
      "",
      "[Added Lines]",
      "973:     iakerb_gss_import_sec_context,",
      "",
      "---------------"
    ],
    "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c": [
      "File: src/lib/gssapi/krb5/iakerb.c -> src/lib/gssapi/krb5/iakerb.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1057:                               gss_buffer_t interprocess_token)",
      "1058: {",
      "1059:     OM_uint32 maj;",
      "1063:     if (!ctx->established)",
      "",
      "[Removed Lines]",
      "1060:     iakerb_ctx_id_t ctx = (iakerb_ctx_id_t)context_handle;",
      "",
      "[Added Lines]",
      "1060:     iakerb_ctx_id_t ctx = (iakerb_ctx_id_t)*context_handle;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1072:     return maj;",
      "1073: }",
      "1084: OM_uint32 KRB5_CALLCONV",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1075: OM_uint32 KRB5_CALLCONV",
      "1076: iakerb_gss_import_sec_context(OM_uint32 *minor_status,",
      "1077:                               gss_buffer_t interprocess_token,",
      "1078:                               gss_ctx_id_t *context_handle)",
      "1079: {",
      "1080:     OM_uint32 maj, tmpmin;",
      "1081:     krb5_error_code code;",
      "1082:     gss_ctx_id_t gssc;",
      "1083:     krb5_gss_ctx_id_t kctx;",
      "1084:     iakerb_ctx_id_t ctx;",
      "1086:     maj = krb5_gss_import_sec_context(minor_status, interprocess_token, &gssc);",
      "1087:     if (maj != GSS_S_COMPLETE)",
      "1088:         return maj;",
      "1089:     kctx = (krb5_gss_ctx_id_t)gssc;",
      "1091:     if (!kctx->established) {",
      "1094:         krb5_gss_delete_sec_context(&tmpmin, &gssc, GSS_C_NO_BUFFER);",
      "1095:         return GSS_S_FAILURE;",
      "1096:     }",
      "1098:     code = iakerb_alloc_context(&ctx, kctx->initiate);",
      "1099:     if (code != 0) {",
      "1100:         krb5_gss_delete_sec_context(&tmpmin, &gssc, GSS_C_NO_BUFFER);",
      "1102:         return GSS_S_FAILURE;",
      "1103:     }",
      "1105:     ctx->gssc = gssc;",
      "1106:     ctx->established = 1;",
      "1108:     return GSS_S_COMPLETE;",
      "1109: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "54222de30a89bfac0247dfbc1759556dc9fd2983",
      "candidate_info": {
        "commit_hash": "54222de30a89bfac0247dfbc1759556dc9fd2983",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/54222de30a89bfac0247dfbc1759556dc9fd2983",
        "files": [
          "src/lib/gssapi/krb5/gssapiP_krb5.h",
          "src/lib/gssapi/krb5/gssapi_krb5.c",
          "src/lib/gssapi/krb5/iakerb.c"
        ],
        "message": "Fix IAKERB context export/import [CVE-2015-2698]\n\nThe patches for CVE-2015-2696 contained a regression in the newly\nadded IAKERB iakerb_gss_export_sec_context() function, which could\ncause it to corrupt memory.  Fix the regression by properly\ndereferencing the context_handle pointer before casting it.\n\nAlso, the patches did not implement an IAKERB gss_import_sec_context()\nfunction, under the erroneous belief that an exported IAKERB context\nwould be tagged as a krb5 context.  Implement it now to allow IAKERB\ncontexts to be successfully exported and imported after establishment.\n\nCVE-2015-2698:\n\nIn any MIT krb5 release with the patches for CVE-2015-2696 applied, an\napplication which calls gss_export_sec_context() may experience memory\ncorruption if the context was established using the IAKERB mechanism.\nHistorically, some vulnerabilities of this nature can be translated\ninto remote code execution, though the necessary exploits must be\ntailored to the individual application and are usually quite\ncomplicated.\n\n    CVSSv2 Vector: AV:N/AC:H/Au:S/C:C/I:C/A:C/E:POC/RL:OF/RC:C\n\n(cherry picked from commit 3db8dfec1ef50ddd78d6ba9503185995876a39fd)\n\nticket: 8273\nversion_fixed: 1.14",
        "before_after_code_files": [
          "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h",
          "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c",
          "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h",
            "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c",
            "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c"
          ],
          "candidate": [
            "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h",
            "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c",
            "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h": [
          "File: src/lib/gssapi/krb5/gssapiP_krb5.h -> src/lib/gssapi/krb5/gssapiP_krb5.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1397: iakerb_gss_export_sec_context(OM_uint32 *minor_status,",
          "1398:                               gss_ctx_id_t *context_handle,",
          "1399:                               gss_buffer_t interprocess_token);",
          "1402: OM_uint32 KRB5_CALLCONV",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1401: OM_uint32 KRB5_CALLCONV",
          "1402: iakerb_gss_import_sec_context(OM_uint32 *minor_status,",
          "1403:                               const gss_buffer_t interprocess_token,",
          "1404:                               gss_ctx_id_t *context_handle);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c": [
          "File: src/lib/gssapi/krb5/gssapi_krb5.c -> src/lib/gssapi/krb5/gssapi_krb5.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "970:     NULL,",
          "971: #else",
          "972:     iakerb_gss_export_sec_context,",
          "974: #endif",
          "975:     krb5_gss_inquire_cred_by_mech,",
          "976:     krb5_gss_inquire_names_for_mech,",
          "",
          "[Removed Lines]",
          "973:     NULL,",
          "",
          "[Added Lines]",
          "973:     iakerb_gss_import_sec_context,",
          "",
          "---------------"
        ],
        "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c": [
          "File: src/lib/gssapi/krb5/iakerb.c -> src/lib/gssapi/krb5/iakerb.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1057:                               gss_buffer_t interprocess_token)",
          "1058: {",
          "1059:     OM_uint32 maj;",
          "1063:     if (!ctx->established)",
          "",
          "[Removed Lines]",
          "1060:     iakerb_ctx_id_t ctx = (iakerb_ctx_id_t)context_handle;",
          "",
          "[Added Lines]",
          "1060:     iakerb_ctx_id_t ctx = (iakerb_ctx_id_t)*context_handle;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1072:     return maj;",
          "1073: }",
          "1084: OM_uint32 KRB5_CALLCONV",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1075: OM_uint32 KRB5_CALLCONV",
          "1076: iakerb_gss_import_sec_context(OM_uint32 *minor_status,",
          "1077:                               gss_buffer_t interprocess_token,",
          "1078:                               gss_ctx_id_t *context_handle)",
          "1079: {",
          "1080:     OM_uint32 maj, tmpmin;",
          "1081:     krb5_error_code code;",
          "1082:     gss_ctx_id_t gssc;",
          "1083:     krb5_gss_ctx_id_t kctx;",
          "1084:     iakerb_ctx_id_t ctx;",
          "1086:     maj = krb5_gss_import_sec_context(minor_status, interprocess_token, &gssc);",
          "1087:     if (maj != GSS_S_COMPLETE)",
          "1088:         return maj;",
          "1089:     kctx = (krb5_gss_ctx_id_t)gssc;",
          "1091:     if (!kctx->established) {",
          "1094:         krb5_gss_delete_sec_context(&tmpmin, &gssc, GSS_C_NO_BUFFER);",
          "1095:         return GSS_S_FAILURE;",
          "1096:     }",
          "1098:     code = iakerb_alloc_context(&ctx, kctx->initiate);",
          "1099:     if (code != 0) {",
          "1100:         krb5_gss_delete_sec_context(&tmpmin, &gssc, GSS_C_NO_BUFFER);",
          "1102:         return GSS_S_FAILURE;",
          "1103:     }",
          "1105:     ctx->gssc = gssc;",
          "1106:     ctx->established = 1;",
          "1108:     return GSS_S_COMPLETE;",
          "1109: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9ffff96c98a93bd9bc3846ac044a34cb1566aae7",
      "candidate_info": {
        "commit_hash": "9ffff96c98a93bd9bc3846ac044a34cb1566aae7",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/9ffff96c98a93bd9bc3846ac044a34cb1566aae7",
        "files": [
          "src/lib/gssapi/krb5/gssapiP_krb5.h",
          "src/lib/gssapi/krb5/gssapi_krb5.c",
          "src/lib/gssapi/krb5/iakerb.c"
        ],
        "message": "Fix IAKERB context export/import [CVE-2015-2698]\n\nThe patches for CVE-2015-2696 contained a regression in the newly\nadded IAKERB iakerb_gss_export_sec_context() function, which could\ncause it to corrupt memory.  Fix the regression by properly\ndereferencing the context_handle pointer before casting it.\n\nAlso, the patches did not implement an IAKERB gss_import_sec_context()\nfunction, under the erroneous belief that an exported IAKERB context\nwould be tagged as a krb5 context.  Implement it now to allow IAKERB\ncontexts to be successfully exported and imported after establishment.\n\nCVE-2015-2698:\n\nIn any MIT krb5 release with the patches for CVE-2015-2696 applied, an\napplication which calls gss_export_sec_context() may experience memory\ncorruption if the context was established using the IAKERB mechanism.\nHistorically, some vulnerabilities of this nature can be translated\ninto remote code execution, though the necessary exploits must be\ntailored to the individual application and are usually quite\ncomplicated.\n\n    CVSSv2 Vector: AV:N/AC:H/Au:S/C:C/I:C/A:C/E:POC/RL:OF/RC:C\n\n(cherry picked from commit 3db8dfec1ef50ddd78d6ba9503185995876a39fd)\n(cherry picked from commit 54222de30a89bfac0247dfbc1759556dc9fd2983)\n\nticket: 8284 (new)\nversion_fixed: 1.13.3",
        "before_after_code_files": [
          "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h",
          "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c",
          "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h",
            "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c",
            "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c"
          ],
          "candidate": [
            "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h",
            "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c",
            "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h": [
          "File: src/lib/gssapi/krb5/gssapiP_krb5.h -> src/lib/gssapi/krb5/gssapiP_krb5.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1396: iakerb_gss_export_sec_context(OM_uint32 *minor_status,",
          "1397:                               gss_ctx_id_t *context_handle,",
          "1398:                               gss_buffer_t interprocess_token);",
          "1401: OM_uint32 KRB5_CALLCONV",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1400: OM_uint32 KRB5_CALLCONV",
          "1401: iakerb_gss_import_sec_context(OM_uint32 *minor_status,",
          "1402:                               const gss_buffer_t interprocess_token,",
          "1403:                               gss_ctx_id_t *context_handle);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c": [
          "File: src/lib/gssapi/krb5/gssapi_krb5.c -> src/lib/gssapi/krb5/gssapi_krb5.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "945:     NULL,",
          "946: #else",
          "947:     iakerb_gss_export_sec_context,",
          "949: #endif",
          "950:     krb5_gss_inquire_cred_by_mech,",
          "951:     krb5_gss_inquire_names_for_mech,",
          "",
          "[Removed Lines]",
          "948:     NULL,",
          "",
          "[Added Lines]",
          "948:     iakerb_gss_import_sec_context,",
          "",
          "---------------"
        ],
        "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c": [
          "File: src/lib/gssapi/krb5/iakerb.c -> src/lib/gssapi/krb5/iakerb.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1057:                               gss_buffer_t interprocess_token)",
          "1058: {",
          "1059:     OM_uint32 maj;",
          "1063:     if (!ctx->established)",
          "",
          "[Removed Lines]",
          "1060:     iakerb_ctx_id_t ctx = (iakerb_ctx_id_t)context_handle;",
          "",
          "[Added Lines]",
          "1060:     iakerb_ctx_id_t ctx = (iakerb_ctx_id_t)*context_handle;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1072:     return maj;",
          "1073: }",
          "1084: OM_uint32 KRB5_CALLCONV",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1075: OM_uint32 KRB5_CALLCONV",
          "1076: iakerb_gss_import_sec_context(OM_uint32 *minor_status,",
          "1077:                               gss_buffer_t interprocess_token,",
          "1078:                               gss_ctx_id_t *context_handle)",
          "1079: {",
          "1080:     OM_uint32 maj, tmpmin;",
          "1081:     krb5_error_code code;",
          "1082:     gss_ctx_id_t gssc;",
          "1083:     krb5_gss_ctx_id_t kctx;",
          "1084:     iakerb_ctx_id_t ctx;",
          "1086:     maj = krb5_gss_import_sec_context(minor_status, interprocess_token, &gssc);",
          "1087:     if (maj != GSS_S_COMPLETE)",
          "1088:         return maj;",
          "1089:     kctx = (krb5_gss_ctx_id_t)gssc;",
          "1091:     if (!kctx->established) {",
          "1094:         krb5_gss_delete_sec_context(&tmpmin, &gssc, GSS_C_NO_BUFFER);",
          "1095:         return GSS_S_FAILURE;",
          "1096:     }",
          "1098:     code = iakerb_alloc_context(&ctx, kctx->initiate);",
          "1099:     if (code != 0) {",
          "1100:         krb5_gss_delete_sec_context(&tmpmin, &gssc, GSS_C_NO_BUFFER);",
          "1102:         return GSS_S_FAILURE;",
          "1103:     }",
          "1105:     ctx->gssc = gssc;",
          "1106:     ctx->established = 1;",
          "1108:     return GSS_S_COMPLETE;",
          "1109: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "683f330bd8c3f7159a61a8234b99c4d073de1ae0",
      "candidate_info": {
        "commit_hash": "683f330bd8c3f7159a61a8234b99c4d073de1ae0",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/683f330bd8c3f7159a61a8234b99c4d073de1ae0",
        "files": [
          "src/lib/gssapi/krb5/gssapiP_krb5.h",
          "src/lib/gssapi/krb5/gssapi_krb5.c",
          "src/lib/gssapi/krb5/iakerb.c"
        ],
        "message": "Fix IAKERB context export/import [CVE-2015-2698]\n\nThe patches for CVE-2015-2696 contained a regression in the newly\nadded IAKERB iakerb_gss_export_sec_context() function, which could\ncause it to corrupt memory.  Fix the regression by properly\ndereferencing the context_handle pointer before casting it.\n\nAlso, the patches did not implement an IAKERB gss_import_sec_context()\nfunction, under the erroneous belief that an exported IAKERB context\nwould be tagged as a krb5 context.  Implement it now to allow IAKERB\ncontexts to be successfully exported and imported after establishment.\n\nCVE-2015-2698:\n\nIn any MIT krb5 release with the patches for CVE-2015-2696 applied, an\napplication which calls gss_export_sec_context() may experience memory\ncorruption if the context was established using the IAKERB mechanism.\nHistorically, some vulnerabilities of this nature can be translated\ninto remote code execution, though the necessary exploits must be\ntailored to the individual application and are usually quite\ncomplicated.\n\n    CVSSv2 Vector: AV:N/AC:H/Au:S/C:C/I:C/A:C/E:POC/RL:OF/RC:C\n\n(back ported from commit 3db8dfec1ef50ddd78d6ba9503185995876a39fd)\n\nticket: 8316 (new)\nversion_fixed: 1.12.5\nstatus: resolved",
        "before_after_code_files": [
          "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h",
          "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c",
          "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h",
            "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c",
            "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c"
          ],
          "candidate": [
            "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h",
            "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c",
            "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/gssapi/krb5/gssapiP_krb5.h||src/lib/gssapi/krb5/gssapiP_krb5.h": [
          "File: src/lib/gssapi/krb5/gssapiP_krb5.h -> src/lib/gssapi/krb5/gssapiP_krb5.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1393: iakerb_gss_export_sec_context(OM_uint32 *minor_status,",
          "1394:                               gss_ctx_id_t *context_handle,",
          "1395:                               gss_buffer_t interprocess_token);",
          "1398: OM_uint32 KRB5_CALLCONV",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1397: OM_uint32 KRB5_CALLCONV",
          "1398: iakerb_gss_import_sec_context(OM_uint32 *minor_status,",
          "1399:                               const gss_buffer_t interprocess_token,",
          "1400:                               gss_ctx_id_t *context_handle);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/krb5/gssapi_krb5.c||src/lib/gssapi/krb5/gssapi_krb5.c": [
          "File: src/lib/gssapi/krb5/gssapi_krb5.c -> src/lib/gssapi/krb5/gssapi_krb5.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "945:     NULL,",
          "946: #else",
          "947:     iakerb_gss_export_sec_context,",
          "949: #endif",
          "950:     krb5_gss_inquire_cred_by_mech,",
          "951:     krb5_gss_inquire_names_for_mech,",
          "",
          "[Removed Lines]",
          "948:     NULL,",
          "",
          "[Added Lines]",
          "948:     iakerb_gss_import_sec_context,",
          "",
          "---------------"
        ],
        "src/lib/gssapi/krb5/iakerb.c||src/lib/gssapi/krb5/iakerb.c": [
          "File: src/lib/gssapi/krb5/iakerb.c -> src/lib/gssapi/krb5/iakerb.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1061:                               gss_buffer_t interprocess_token)",
          "1062: {",
          "1063:     OM_uint32 maj;",
          "1067:     if (!ctx->established)",
          "",
          "[Removed Lines]",
          "1064:     iakerb_ctx_id_t ctx = (iakerb_ctx_id_t)context_handle;",
          "",
          "[Added Lines]",
          "1064:     iakerb_ctx_id_t ctx = (iakerb_ctx_id_t)*context_handle;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1076:     return maj;",
          "1077: }",
          "1088: OM_uint32 KRB5_CALLCONV",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1079: OM_uint32 KRB5_CALLCONV",
          "1080: iakerb_gss_import_sec_context(OM_uint32 *minor_status,",
          "1081:                               gss_buffer_t interprocess_token,",
          "1082:                               gss_ctx_id_t *context_handle)",
          "1083: {",
          "1084:     OM_uint32 maj, tmpmin;",
          "1085:     krb5_error_code code;",
          "1086:     gss_ctx_id_t gssc;",
          "1087:     krb5_gss_ctx_id_t kctx;",
          "1088:     iakerb_ctx_id_t ctx;",
          "1090:     maj = krb5_gss_import_sec_context(minor_status, interprocess_token, &gssc);",
          "1091:     if (maj != GSS_S_COMPLETE)",
          "1092:         return maj;",
          "1093:     kctx = (krb5_gss_ctx_id_t)gssc;",
          "1095:     if (!kctx->established) {",
          "1098:         krb5_gss_delete_sec_context(&tmpmin, &gssc, GSS_C_NO_BUFFER);",
          "1099:         return GSS_S_FAILURE;",
          "1100:     }",
          "1102:     code = iakerb_alloc_context(&ctx, kctx->initiate);",
          "1103:     if (code != 0) {",
          "1104:         krb5_gss_delete_sec_context(&tmpmin, &gssc, GSS_C_NO_BUFFER);",
          "1106:         return GSS_S_FAILURE;",
          "1107:     }",
          "1109:     ctx->gssc = gssc;",
          "1110:     ctx->established = 1;",
          "1112:     return GSS_S_COMPLETE;",
          "1113: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}