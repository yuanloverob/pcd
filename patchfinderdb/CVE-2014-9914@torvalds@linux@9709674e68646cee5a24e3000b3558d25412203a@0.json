{
  "cve_id": "CVE-2014-9914",
  "cve_desc": "Race condition in the ip4_datagram_release_cb function in net/ipv4/datagram.c in the Linux kernel before 3.15.2 allows local users to gain privileges or cause a denial of service (use-after-free) by leveraging incorrect expectations about locking during multithreaded access to internal data structures for IPv4 UDP sockets.",
  "repo": "torvalds/linux",
  "patch_hash": "9709674e68646cee5a24e3000b3558d25412203a",
  "patch_info": {
    "commit_hash": "9709674e68646cee5a24e3000b3558d25412203a",
    "repo": "torvalds/linux",
    "commit_url": "https://github.com/torvalds/linux/commit/9709674e68646cee5a24e3000b3558d25412203a",
    "files": [
      "net/ipv4/datagram.c"
    ],
    "message": "ipv4: fix a race in ip4_datagram_release_cb()\n\nAlexey gave a AddressSanitizer[1] report that finally gave a good hint\nat where was the origin of various problems already reported by Dormando\nin the past [2]\n\nProblem comes from the fact that UDP can have a lockless TX path, and\nconcurrent threads can manipulate sk_dst_cache, while another thread,\nis holding socket lock and calls __sk_dst_set() in\nip4_datagram_release_cb() (this was added in linux-3.8)\n\nIt seems that all we need to do is to use sk_dst_check() and\nsk_dst_set() so that all the writers hold same spinlock\n(sk->sk_dst_lock) to prevent corruptions.\n\nTCP stack do not need this protection, as all sk_dst_cache writers hold\nthe socket lock.\n\n[1]\nhttps://code.google.com/p/address-sanitizer/wiki/AddressSanitizerForKernel\n\nAddressSanitizer: heap-use-after-free in ipv4_dst_check\nRead of size 2 by thread T15453:\n [<ffffffff817daa3a>] ipv4_dst_check+0x1a/0x90 ./net/ipv4/route.c:1116\n [<ffffffff8175b789>] __sk_dst_check+0x89/0xe0 ./net/core/sock.c:531\n [<ffffffff81830a36>] ip4_datagram_release_cb+0x46/0x390 ??:0\n [<ffffffff8175eaea>] release_sock+0x17a/0x230 ./net/core/sock.c:2413\n [<ffffffff81830882>] ip4_datagram_connect+0x462/0x5d0 ??:0\n [<ffffffff81846d06>] inet_dgram_connect+0x76/0xd0 ./net/ipv4/af_inet.c:534\n [<ffffffff817580ac>] SYSC_connect+0x15c/0x1c0 ./net/socket.c:1701\n [<ffffffff817596ce>] SyS_connect+0xe/0x10 ./net/socket.c:1682\n [<ffffffff818b0a29>] system_call_fastpath+0x16/0x1b\n./arch/x86/kernel/entry_64.S:629\n\nFreed by thread T15455:\n [<ffffffff8178d9b8>] dst_destroy+0xa8/0x160 ./net/core/dst.c:251\n [<ffffffff8178de25>] dst_release+0x45/0x80 ./net/core/dst.c:280\n [<ffffffff818304c1>] ip4_datagram_connect+0xa1/0x5d0 ??:0\n [<ffffffff81846d06>] inet_dgram_connect+0x76/0xd0 ./net/ipv4/af_inet.c:534\n [<ffffffff817580ac>] SYSC_connect+0x15c/0x1c0 ./net/socket.c:1701\n [<ffffffff817596ce>] SyS_connect+0xe/0x10 ./net/socket.c:1682\n [<ffffffff818b0a29>] system_call_fastpath+0x16/0x1b\n./arch/x86/kernel/entry_64.S:629\n\nAllocated by thread T15453:\n [<ffffffff8178d291>] dst_alloc+0x81/0x2b0 ./net/core/dst.c:171\n [<ffffffff817db3b7>] rt_dst_alloc+0x47/0x50 ./net/ipv4/route.c:1406\n [<     inlined    >] __ip_route_output_key+0x3e8/0xf70\n__mkroute_output ./net/ipv4/route.c:1939\n [<ffffffff817dde08>] __ip_route_output_key+0x3e8/0xf70 ./net/ipv4/route.c:2161\n [<ffffffff817deb34>] ip_route_output_flow+0x14/0x30 ./net/ipv4/route.c:2249\n [<ffffffff81830737>] ip4_datagram_connect+0x317/0x5d0 ??:0\n [<ffffffff81846d06>] inet_dgram_connect+0x76/0xd0 ./net/ipv4/af_inet.c:534\n [<ffffffff817580ac>] SYSC_connect+0x15c/0x1c0 ./net/socket.c:1701\n [<ffffffff817596ce>] SyS_connect+0xe/0x10 ./net/socket.c:1682\n [<ffffffff818b0a29>] system_call_fastpath+0x16/0x1b\n./arch/x86/kernel/entry_64.S:629\n\n[2]\n<4>[196727.311203] general protection fault: 0000 [#1] SMP\n<4>[196727.311224] Modules linked in: xt_TEE xt_dscp xt_DSCP macvlan bridge coretemp crc32_pclmul ghash_clmulni_intel gpio_ich microcode ipmi_watchdog ipmi_devintf sb_edac edac_core lpc_ich mfd_core tpm_tis tpm tpm_bios ipmi_si ipmi_msghandler isci igb libsas i2c_algo_bit ixgbe ptp pps_core mdio\n<4>[196727.311333] CPU: 17 PID: 0 Comm: swapper/17 Not tainted 3.10.26 #1\n<4>[196727.311344] Hardware name: Supermicro X9DRi-LN4+/X9DR3-LN4+/X9DRi-LN4+/X9DR3-LN4+, BIOS 3.0 07/05/2013\n<4>[196727.311364] task: ffff885e6f069700 ti: ffff885e6f072000 task.ti: ffff885e6f072000\n<4>[196727.311377] RIP: 0010:[<ffffffff815f8c7f>]  [<ffffffff815f8c7f>] ipv4_dst_destroy+0x4f/0x80\n<4>[196727.311399] RSP: 0018:ffff885effd23a70  EFLAGS: 00010282\n<4>[196727.311409] RAX: dead000000200200 RBX: ffff8854c398ecc0 RCX: 0000000000000040\n<4>[196727.311423] RDX: dead000000100100 RSI: dead000000100100 RDI: dead000000200200\n<4>[196727.311437] RBP: ffff885effd23a80 R08: ffffffff815fd9e0 R09: ffff885d5a590800\n<4>[196727.311451] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000\n<4>[196727.311464] R13: ffffffff81c8c280 R14: 0000000000000000 R15: ffff880e85ee16ce\n<4>[196727.311510] FS:  0000000000000000(0000) GS:ffff885effd20000(0000) knlGS:0000000000000000\n<4>[196727.311554] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n<4>[196727.311581] CR2: 00007a46751eb000 CR3: 0000005e65688000 CR4: 00000000000407e0\n<4>[196727.311625] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n<4>[196727.311669] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400\n<4>[196727.311713] Stack:\n<4>[196727.311733]  ffff8854c398ecc0 ffff8854c398ecc0 ffff885effd23ab0 ffffffff815b7f42\n<4>[196727.311784]  ffff88be6595bc00 ffff8854c398ecc0 0000000000000000 ffff8854c398ecc0\n<4>[196727.311834]  ffff885effd23ad0 ffffffff815b86c6 ffff885d5a590800 ffff8816827821c0\n<4>[196727.311885] Call Trace:\n<4>[196727.311907]  <IRQ>\n<4>[196727.311912]  [<ffffffff815b7f42>] dst_destroy+0x32/0xe0\n<4>[196727.311959]  [<ffffffff815b86c6>] dst_release+0x56/0x80\n<4>[196727.311986]  [<ffffffff81620bd5>] tcp_v4_do_rcv+0x2a5/0x4a0\n<4>[196727.312013]  [<ffffffff81622b5a>] tcp_v4_rcv+0x7da/0x820\n<4>[196727.312041]  [<ffffffff815fd9e0>] ? ip_rcv_finish+0x360/0x360\n<4>[196727.312070]  [<ffffffff815de02d>] ? nf_hook_slow+0x7d/0x150\n<4>[196727.312097]  [<ffffffff815fd9e0>] ? ip_rcv_finish+0x360/0x360\n<4>[196727.312125]  [<ffffffff815fda92>] ip_local_deliver_finish+0xb2/0x230\n<4>[196727.312154]  [<ffffffff815fdd9a>] ip_local_deliver+0x4a/0x90\n<4>[196727.312183]  [<ffffffff815fd799>] ip_rcv_finish+0x119/0x360\n<4>[196727.312212]  [<ffffffff815fe00b>] ip_rcv+0x22b/0x340\n<4>[196727.312242]  [<ffffffffa0339680>] ? macvlan_broadcast+0x160/0x160 [macvlan]\n<4>[196727.312275]  [<ffffffff815b0c62>] __netif_receive_skb_core+0x512/0x640\n<4>[196727.312308]  [<ffffffff811427fb>] ? kmem_cache_alloc+0x13b/0x150\n<4>[196727.312338]  [<ffffffff815b0db1>] __netif_receive_skb+0x21/0x70\n<4>[196727.312368]  [<ffffffff815b0fa1>] netif_receive_skb+0x31/0xa0\n<4>[196727.312397]  [<ffffffff815b1ae8>] napi_gro_receive+0xe8/0x140\n<4>[196727.312433]  [<ffffffffa00274f1>] ixgbe_poll+0x551/0x11f0 [ixgbe]\n<4>[196727.312463]  [<ffffffff815fe00b>] ? ip_rcv+0x22b/0x340\n<4>[196727.312491]  [<ffffffff815b1691>] net_rx_action+0x111/0x210\n<4>[196727.312521]  [<ffffffff815b0db1>] ? __netif_receive_skb+0x21/0x70\n<4>[196727.312552]  [<ffffffff810519d0>] __do_softirq+0xd0/0x270\n<4>[196727.312583]  [<ffffffff816cef3c>] call_softirq+0x1c/0x30\n<4>[196727.312613]  [<ffffffff81004205>] do_softirq+0x55/0x90\n<4>[196727.312640]  [<ffffffff81051c85>] irq_exit+0x55/0x60\n<4>[196727.312668]  [<ffffffff816cf5c3>] do_IRQ+0x63/0xe0\n<4>[196727.312696]  [<ffffffff816c5aaa>] common_interrupt+0x6a/0x6a\n<4>[196727.312722]  <EOI>\n<1>[196727.313071] RIP  [<ffffffff815f8c7f>] ipv4_dst_destroy+0x4f/0x80\n<4>[196727.313100]  RSP <ffff885effd23a70>\n<4>[196727.313377] ---[ end trace 64b3f14fae0f2e29 ]---\n<0>[196727.380908] Kernel panic - not syncing: Fatal exception in interrupt\n\nReported-by: Alexey Preobrazhensky <preobr@google.com>\nReported-by: dormando <dormando@rydia.ne>\nSigned-off-by: Eric Dumazet <edumazet@google.com>\nFixes: 8141ed9fcedb2 (\"ipv4: Add a socket release callback for datagram sockets\")\nCc: Steffen Klassert <steffen.klassert@secunet.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
    "before_after_code_files": [
      "net/ipv4/datagram.c||net/ipv4/datagram.c"
    ]
  },
  "patch_diff": {
    "net/ipv4/datagram.c||net/ipv4/datagram.c": [
      "File: net/ipv4/datagram.c -> net/ipv4/datagram.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "86: }",
      "87: EXPORT_SYMBOL(ip4_datagram_connect);",
      "89: void ip4_datagram_release_cb(struct sock *sk)",
      "90: {",
      "91:  const struct inet_sock *inet = inet_sk(sk);",
      "92:  const struct ip_options_rcu *inet_opt;",
      "93:  __be32 daddr = inet->inet_daddr;",
      "94:  struct flowi4 fl4;",
      "95:  struct rtable *rt;",
      "100:  rcu_read_lock();",
      "101:  inet_opt = rcu_dereference(inet->inet_opt);",
      "102:  if (inet_opt && inet_opt->opt.srr)",
      "103:   daddr = inet_opt->opt.faddr;",
      "",
      "[Removed Lines]",
      "97:  if (! __sk_dst_get(sk) || __sk_dst_check(sk, 0))",
      "98:   return;",
      "",
      "[Added Lines]",
      "98:  struct dst_entry *dst;",
      "104:  dst = __sk_dst_get(sk);",
      "105:  if (!dst || !dst->obsolete || dst->ops->check(dst, 0)) {",
      "106:   rcu_read_unlock();",
      "107:   return;",
      "108:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "105:        inet->inet_saddr, inet->inet_dport,",
      "106:        inet->inet_sport, sk->sk_protocol,",
      "107:        RT_CONN_FLAGS(sk), sk->sk_bound_dev_if);",
      "110:  rcu_read_unlock();",
      "111: }",
      "112: EXPORT_SYMBOL_GPL(ip4_datagram_release_cb);",
      "",
      "[Removed Lines]",
      "108:  if (!IS_ERR(rt))",
      "109:   __sk_dst_set(sk, &rt->dst);",
      "",
      "[Added Lines]",
      "117:  dst = !IS_ERR(rt) ? &rt->dst : NULL;",
      "118:  sk_dst_set(sk, dst);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "223a6f2b975ab35d93270ea1d4fb6e0ac6b27fe6",
      "candidate_info": {
        "commit_hash": "223a6f2b975ab35d93270ea1d4fb6e0ac6b27fe6",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/223a6f2b975ab35d93270ea1d4fb6e0ac6b27fe6",
        "files": [
          "drivers/gpu/drm/i915/intel_pm.c"
        ],
        "message": "drm/i915/bdw: remove erroneous chv specific workarounds from bdw code\n\nCorrect a merge mishap in\n\ncommit e4443e459ccf43f2c139358400365fd6a839d40d\nAuthor: Ville Syrj\u00e4l\u00e4 <ville.syrjala@linux.intel.com>\nDate:   Wed Apr 9 13:28:41 2014 +0300\n\n    drm/i915/chv: Add a bunch of pre production workarounds\n\nRemove the the chv specific workarounds from bdw code, specifically\ngen8_enable_rps().\n\nSigned-off-by: Tom O'Rourke <Tom.O'Rourke@intel.com>\nReviewed-by: Ville Syrj\u00e4l\u00e4 <ville.syrjala@linux.intel.com>\nSigned-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>\n[Jani: extract hunk #1 for 3.16 from Tom's patch, clarify commit message]\nSigned-off-by: Jani Nikula <jani.nikula@intel.com>\n\n---\n\nAll, I intend to push this to drm-intel-fixes, any objections?\n\nJani.",
        "before_after_code_files": [
          "drivers/gpu/drm/i915/intel_pm.c||drivers/gpu/drm/i915/intel_pm.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "drivers/gpu/drm/i915/intel_pm.c||drivers/gpu/drm/i915/intel_pm.c": [
          "File: drivers/gpu/drm/i915/intel_pm.c -> drivers/gpu/drm/i915/intel_pm.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3506:  I915_WRITE(GEN6_RP_IDLE_HYSTERSIS, 10);",
          "3513:  I915_WRITE(GEN6_RP_CONTROL,",
          "3514:      GEN6_RP_MEDIA_TURBO |",
          "3515:      GEN6_RP_MEDIA_HW_NORMAL_MODE |",
          "3517:      GEN6_RP_ENABLE |",
          "3518:      GEN6_RP_UP_BUSY_AVG |",
          "3519:      GEN6_RP_DOWN_IDLE_AVG);",
          "",
          "[Removed Lines]",
          "3509:  I915_WRITE(0xA80C, I915_READ(0xA80C) & 0x00ffffff);",
          "3510:  I915_WRITE(0xA810, I915_READ(0xA810) & 0xffffff00);",
          "",
          "[Added Lines]",
          "3512:      GEN6_RP_MEDIA_IS_GFX |",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2749a2f26a7c7eb4c7e3901695c8977cdb6b826d",
      "candidate_info": {
        "commit_hash": "2749a2f26a7c7eb4c7e3901695c8977cdb6b826d",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/2749a2f26a7c7eb4c7e3901695c8977cdb6b826d",
        "files": [
          "arch/powerpc/kernel/exceptions-64s.S"
        ],
        "message": "powerpc/book3s: Fix machine check handling for unhandled errors\n\nCurrent code does not check for unhandled/unrecovered errors and return from\ninterrupt if it is recoverable exception which in-turn triggers same machine\ncheck exception in a loop causing hypervisor to be unresponsive.\n\nThis patch fixes this situation and forces hypervisor to panic for\nunhandled/unrecovered errors.\n\nThis patch also fixes another issue where unrecoverable_exception routine\nwas called in real mode in case of unrecoverable exception (MSR_RI = 0).\nThis causes another exception vector 0x300 (data access) during system crash\nleading to confusion while debugging cause of the system crash.\n\nAlso turn ME bit off while going down, so that when another MCE is hit during\npanic path, system will checkstop and hypervisor will get restarted cleanly\nby SP.\n\nWith the above fixes we now throw correct console messages (see below) while\ncrashing the system in case of unhandled/unrecoverable machine checks.\n\n--------------\nSevere Machine check interrupt [[Not recovered]\n  Initiator: CPU\n  Error type: UE [Instruction fetch]\n    Effective address: 0000000030002864\nOops: Machine check, sig: 7 [#1]\nSMP NR_CPUS=2048 NUMA PowerNV\nModules linked in: bork(O) bridge stp llc kvm [last unloaded: bork]\nCPU: 36 PID: 55162 Comm: bash Tainted: G           O 3.14.0mce #1\ntask: c000002d72d022d0 ti: c000000007ec0000 task.ti: c000002d72de4000\nNIP: 0000000030002864 LR: 00000000300151a4 CTR: 000000003001518c\nREGS: c000000007ec3d80 TRAP: 0200   Tainted: G           O  (3.14.0mce)\nMSR: 9000000000041002 <SF,HV,ME,RI>  CR: 28222848  XER: 20000000\nCFAR: 0000000030002838 DAR: d0000000004d0000 DSISR: 00000000 SOFTE: 1\nGPR00: 000000003001512c 0000000031f92cb0 0000000030078af0 0000000030002864\nGPR04: d0000000004d0000 0000000000000000 0000000030002864 ffffffffffffffc9\nGPR08: 0000000000000024 0000000030008af0 000000000000002c c00000000150e728\nGPR12: 9000000000041002 0000000031f90000 0000000010142550 0000000040000000\nGPR16: 0000000010143cdc 0000000000000000 00000000101306fc 00000000101424dc\nGPR20: 00000000101424e0 000000001013c6f0 0000000000000000 0000000000000000\nGPR24: 0000000010143ce0 00000000100f6440 c000002d72de7e00 c000002d72860250\nGPR28: c000002d72860240 c000002d72ac0038 0000000000000008 0000000000040000\nNIP [0000000030002864] 0x30002864\nLR [00000000300151a4] 0x300151a4\nCall Trace:\nInstruction dump:\nXXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX\nXXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX\n---[ end trace 7285f0beac1e29d3 ]---\n\nSending IPI to other CPUs\nIPI complete\nOPAL V3 detected !\n--------------\n\nSigned-off-by: Mahesh Salgaonkar <mahesh@linux.vnet.ibm.com>\nSigned-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>",
        "before_after_code_files": [
          "arch/powerpc/kernel/exceptions-64s.S||arch/powerpc/kernel/exceptions-64s.S"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "arch/powerpc/kernel/exceptions-64s.S||arch/powerpc/kernel/exceptions-64s.S": [
          "File: arch/powerpc/kernel/exceptions-64s.S -> arch/powerpc/kernel/exceptions-64s.S",
          "--- Hunk 1 ---",
          "[Context before]",
          "1444:  andi. r11,r12,MSR_RI",
          "1445:  bne 2f",
          "1449: 2:",
          "",
          "[Removed Lines]",
          "1446: 1: addi r3,r1,STACK_FRAME_OVERHEAD",
          "1447:  bl unrecoverable_exception",
          "1448:  b 1b",
          "",
          "[Added Lines]",
          "1447: 1: mfspr r11,SPRN_SRR0",
          "1448:  ld r10,PACAKBASE(r13)",
          "1449:  LOAD_HANDLER(r10,unrecover_mce)",
          "1450:  mtspr SPRN_SRR0,r10",
          "1451:  ld r10,PACAKMSR(r13)",
          "1459:  li r3,MSR_ME",
          "1461:  mtspr SPRN_SRR1,r10",
          "1462:  rfid",
          "1463:  b .",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1460:  MACHINE_CHECK_HANDLER_WINDUP",
          "1461:  b machine_check_pSeries",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1486: unrecover_mce:",
          "1488:  addi r3,r1,STACK_FRAME_OVERHEAD",
          "1489:  bl .machine_check_exception",
          "1494: 1: addi r3,r1,STACK_FRAME_OVERHEAD",
          "1495:  bl .unrecoverable_exception",
          "1496:  b 1b",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c5a1fbca6f35a85e9167b2cd9f7257eff0274f8b",
      "candidate_info": {
        "commit_hash": "c5a1fbca6f35a85e9167b2cd9f7257eff0274f8b",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/c5a1fbca6f35a85e9167b2cd9f7257eff0274f8b",
        "files": [
          "drivers/usb/dwc3/Kconfig",
          "drivers/usb/dwc3/dwc3-omap.c"
        ],
        "message": "usb: dwc3: dwc3-omap: Fix the crash on module removal\n\nFollowing crash is seen on dwc3_omap removal\nUnable to handle kernel NULL pointer dereference at virtual address 00000018\npgd = ec098000\n[00000018] *pgd=ad1f9831, *pte=00000000, *ppte=00000000\nInternal error: Oops: 17 [#1] SMP ARM\nModules linked in: usb_f_ss_lb g_zero usb_f_acm u_serial usb_f_ecm u_ether libcomposite configfs snd_usb_audio snd_usbmidi_lib snd_rawmidi snd_hwdep snd_soc_omap snd_pcm_dmaengine snd_soc_core snd_compress snd_pcm snd_tim]\nCPU: 0 PID: 1296 Comm: rmmod Tainted: G        W     3.15.0-rc4-02716-g95c4e18-dirty #10\ntask: ed05a080 ti: ec368000 task.ti: ec368000\nPC is at release_resource+0x14/0x7c\nLR is at release_resource+0x10/0x7c\npc : [<c0044724>]    lr : [<c0044720>]    psr: 60000013\nsp : ec369ec0  ip : 60000013  fp : 00021008\nr10: 00000000  r9 : ec368000  r8 : c000e7a4\nr7 : 00000081  r6 : bf0062c0  r5 : ed7cd000  r4 : ed7d85c0\nr3 : 00000000  r2 : 00000000  r1 : 00000011  r0 : c086d08c\nFlags: nZCv  IRQs on  FIQs on  Mode SVC_32  ISA ARM  Segment user\nControl: 10c5387d  Table: ac098059  DAC: 00000015\nProcess rmmod (pid: 1296, stack limit = 0xec368248)\nStack: (0xec369ec0 to 0xec36a000)\n9ec0: 00000000 00000001 ed7cd000 c034de94 ed7cd010 ed7cd000 00000000 c034e194\n9ee0: 00000000 bf0062cc ed7cd010 c03490b0 ed154cc0 ed4c2570 ed2b8410 ed156810\ned156810 bf006d24 c034db9c c034db84 c034c518\n9f20: bf006d24 ed156810 bf006d24 c034cd2c bf006d24 bf006d68 00000800 c034c340\n9f40: 00000000 c00a9e5c 00000020 00000000 bf006d68 00000800 ec369f4c 33637764\n9f60: 616d6f5f 00000070 00000001 ec368000 ed05a080 c000e670 00000001 c0084010\n9f80: 00021088 00000800 00021088 00000081 80000010 0000e6f4 00021088 00000800\n9fa0: 00021088 c000e5e0 00021088 00000800 000210b8 00000800 e04f6d00 e04f6d00\n9fc0: 00021088 00000800 00021088 00000081 00000001 00000000 be91de08 00021008\n9fe0: 4d768880 be91dbb4 b6fc5984 4d76888c 80000010 000210b8 00000000 00000000\n[<c0044724>] (release_resource) from [<c034de94>] (platform_device_del+0x6c/0x9c)\n[<c034de94>] (platform_device_del) from [<c034e194>] (platform_device_unregister+0xc/0x18)\n[<c034e194>] (platform_device_unregister) from [<bf0062cc>] (dwc3_omap_remove_core+0xc/0x14 [dwc3_omap])\n[<bf0062cc>] (dwc3_omap_remove_core [dwc3_omap]) from [<c03490b0>] (device_for_each_child+0x34/0x74)\n[<c03490b0>] (device_for_each_child) from [<bf0062b4>] (dwc3_omap_remove+0x6c/0x78 [dwc3_omap])\n[<bf0062b4>] (dwc3_omap_remove [dwc3_omap]) from [<c034db9c>] (platform_drv_remove+0x18/0x1c)\n[<c034db9c>] (platform_drv_remove) from [<c034c518>] (__device_release_driver+0x70/0xc8)\n[<c034c518>] (__device_release_driver) from [<c034cd2c>] (driver_detach+0xb4/0xb8)\n[<c034cd2c>] (driver_detach) from [<c034c340>] (bus_remove_driver+0x4c/0x90)\n[<c034c340>] (bus_remove_driver) from [<c00a9e5c>] (SyS_delete_module+0x10c/0x198)\n[<c00a9e5c>] (SyS_delete_module) from [<c000e5e0>] (ret_fast_syscall+0x0/0x48)\nCode: e1a04000 e59f0068 eb14505e e5943010 (e5932018)\n---[ end trace 7e2a8746ff4fc811 ]---\nSegmentation fault\n\n[ balbi@ti.com : add CONFIG_OF dependency ]\n\nSigned-off-by: George Cherian <george.cherian@ti.com>\nSigned-off-by: Felipe Balbi <balbi@ti.com>",
        "before_after_code_files": [
          "drivers/usb/dwc3/dwc3-omap.c||drivers/usb/dwc3/dwc3-omap.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "drivers/usb/dwc3/dwc3-omap.c||drivers/usb/dwc3/dwc3-omap.c": [
          "File: drivers/usb/dwc3/dwc3-omap.c -> drivers/usb/dwc3/dwc3-omap.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "322: {",
          "323:  struct platform_device *pdev = to_platform_device(dev);",
          "327:  return 0;",
          "328: }",
          "",
          "[Removed Lines]",
          "325:  platform_device_unregister(pdev);",
          "",
          "[Added Lines]",
          "325:  of_device_unregister(pdev);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e47043aea3853a74a9aa5726a1faa916d7462ab7",
      "candidate_info": {
        "commit_hash": "e47043aea3853a74a9aa5726a1faa916d7462ab7",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/e47043aea3853a74a9aa5726a1faa916d7462ab7",
        "files": [
          "arch/arm/boot/dts/armada-xp-openblocks-ax3-4.dts"
        ],
        "message": "ARM: mvebu: DT: fix OpenBlocks AX3-4 RAM size\n\nThe OpenBlocks AX3-4 has a non-DT bootloader.  It also comes with 1GB of\nsoldered on RAM, and a DIMM slot for expansion.\n\nUnfortunately, atags_to_fdt() doesn't work in big-endian mode, so we see\nthe following failure when attempting to boot a big-endian kernel:\n\n  686 slab pages\n  17 pages shared\n  0 pages swap cached\n  [ pid ]   uid  tgid total_vm      rss nr_ptes swapents oom_score_adj name\n  Kernel panic - not syncing: Out of memory and no killable processes...\n\n  CPU: 1 PID: 351 Comm: kworker/u4:0 Not tainted 3.15.0-rc8-next-20140603 #1\n  [<c0215a54>] (unwind_backtrace) from [<c021160c>] (show_stack+0x10/0x14)\n  [<c021160c>] (show_stack) from [<c0802500>] (dump_stack+0x78/0x94)\n  [<c0802500>] (dump_stack) from [<c0800068>] (panic+0x90/0x21c)\n  [<c0800068>] (panic) from [<c02b5704>] (out_of_memory+0x320/0x340)\n  [<c02b5704>] (out_of_memory) from [<c02b93a0>] (__alloc_pages_nodemask+0x874/0x930)\n  [<c02b93a0>] (__alloc_pages_nodemask) from [<c02d446c>] (handle_mm_fault+0x744/0x96c)\n  [<c02d446c>] (handle_mm_fault) from [<c02cf250>] (__get_user_pages+0xd0/0x4c0)\n  [<c02cf250>] (__get_user_pages) from [<c02f3598>] (get_arg_page+0x54/0xbc)\n  [<c02f3598>] (get_arg_page) from [<c02f3878>] (copy_strings+0x278/0x29c)\n  [<c02f3878>] (copy_strings) from [<c02f38bc>] (copy_strings_kernel+0x20/0x28)\n  [<c02f38bc>] (copy_strings_kernel) from [<c02f4f1c>] (do_execve+0x3a8/0x4c8)\n  [<c02f4f1c>] (do_execve) from [<c025ac10>] (____call_usermodehelper+0x15c/0x194)\n  [<c025ac10>] (____call_usermodehelper) from [<c020e9b8>] (ret_from_fork+0x14/0x3c)\n  CPU0: stopping\n  CPU: 0 PID: 0 Comm: swapper/0 Not tainted 3.15.0-rc8-next-20140603 #1\n  [<c0215a54>] (unwind_backtrace) from [<c021160c>] (show_stack+0x10/0x14)\n  [<c021160c>] (show_stack) from [<c0802500>] (dump_stack+0x78/0x94)\n  [<c0802500>] (dump_stack) from [<c021429c>] (handle_IPI+0x138/0x174)\n  [<c021429c>] (handle_IPI) from [<c02087f0>] (armada_370_xp_handle_irq+0xb0/0xcc)\n  [<c02087f0>] (armada_370_xp_handle_irq) from [<c0212100>] (__irq_svc+0x40/0x50)\n  Exception stack(0xc0b6bf68 to 0xc0b6bfb0)\n  bf60:                   e9fad598 00000000 00f509a3 00000000 c0b6a000 c0b724c4\n  bf80: c0b72458 c0b6a000 00000000 00000000 c0b66da0 c0b6a000 00000000 c0b6bfb0\n  bfa0: c027bb94 c027bb24 60000313 ffffffff\n  [<c0212100>] (__irq_svc) from [<c027bb24>] (cpu_startup_entry+0x54/0x214)\n  [<c027bb24>] (cpu_startup_entry) from [<c0ac5b30>] (start_kernel+0x318/0x37c)\n  [<c0ac5b30>] (start_kernel) from [<00208078>] (0x208078)\n  ---[ end Kernel panic - not syncing: Out of memory and no killable processes...\n\nA similar failure will also occur if ARM_ATAG_DTB_COMPAT isn't selected.\n\nFix this by setting a sane default (1 GB) in the dts file.\n\nSigned-off-by: Jason Cooper <jason@lakedaemon.net>\nTested-by: Kevin Hilman <khilman@linaro.org>\nCc: <stable@vger.kernel.org> #v3.13+\nSigned-off-by: Arnd Bergmann <arnd@arndb.de>",
        "before_after_code_files": [
          "arch/arm/boot/dts/armada-xp-openblocks-ax3-4.dts||arch/arm/boot/dts/armada-xp-openblocks-ax3-4.dts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "arch/arm/boot/dts/armada-xp-openblocks-ax3-4.dts||arch/arm/boot/dts/armada-xp-openblocks-ax3-4.dts": [
          "File: arch/arm/boot/dts/armada-xp-openblocks-ax3-4.dts -> arch/arm/boot/dts/armada-xp-openblocks-ax3-4.dts"
        ]
      }
    },
    {
      "candidate_hash": "17cfd91f3985f23f92b8c7cba3307a2b630feb95",
      "candidate_info": {
        "commit_hash": "17cfd91f3985f23f92b8c7cba3307a2b630feb95",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/17cfd91f3985f23f92b8c7cba3307a2b630feb95",
        "files": [
          "drivers/gpu/drm/drm_crtc.c"
        ],
        "message": "drm: Avoid NULL deference when disabling a plane from userspace\n\nTo disable a plane, userspace passes in an framebuffer id of 0. This\ncauses us to pass CRTC == NULL to setplane_internal, who promptly\ndeferences it to grab the struct drm_device. Oops.\n\n[ 1296.467327] BUG: unable to handle kernel NULL pointer dereference at   (null)\n[ 1296.467332] IP: [<c134dc51>] setplane_internal+0x11/0x280\n[ 1296.467338] *pde = 00000000\n[ 1296.467341] Oops: 0000 [#1] SMP\n[ 1296.467344] Modules linked in: ccm bnep bluetooth snd_hda_codec_hdmi snd_hda_codec_idt snd_hda_codec_generic snd_hda_intel arc4 iwldvm snd_hda_controller snd_hda_codec mac80211 snd_hwdep snd_seq snd_seq_device snd_pcm snd_timer iwlwifi sdhci_pci snd cfg80211 x86_pkg_temp_thermal hp_wmi sdhci sparse_keymap mmc_core crc32c_intel rfkill microcode hp_accel lpc_ich lis3lv02d wmi mfd_core serio_raw input_polldev soundcore e1000e ptp pps_core\n[ 1296.467367] CPU: 1 PID: 672 Comm: Xorg Tainted: G        W     3.15.0-rc8+ #351\n[ 1296.467369] Hardware name: Hewlett-Packard HP ProBook 6360b/1620, BIOS 68SCF Ver. B.42 12/29/2010\n[ 1296.467371] task: f423b5c0 ti: c2332000 task.ti: c2332000\n[ 1296.467374] EIP: 0060:[<c134dc51>] EFLAGS: 00013286 CPU: 1\n[ 1296.467376] EIP is at setplane_internal+0x11/0x280\n[ 1296.467378] EAX: 00000000 EBX: c2333e90 ECX: 00000000 EDX: f3165600\n[ 1296.467380] ESI: f430f400 EDI: 00000000 EBP: c2333e14 ESP: c2333dd4\n[ 1296.467382]  DS: 007b ES: 007b FS: 00d8 GS: 0033 SS: 0068\n[ 1296.467384] CR0: 80050033 CR2: 00000000 CR3: 00159000 CR4: 000407d0\n[ 1296.467385] Stack:\n[ 1296.467387]  000200da 00000002 c2333de8 c15dc4a0 f430f400 c2333e00 c134c54f eeeeeeee\n[ 1296.467391]  f430f400 00000007 f416b480 c2333e14 00000000 c2333e90 f430f400 00000000\n[ 1296.467396]  c2333e4c c1350aed 00000000 00000000 00000000 00000000 00000000 00000000\n[ 1296.467400] Call Trace:\n[ 1296.467406]  [<c15dc4a0>] ? mutex_lock+0x10/0x28\n[ 1296.467408]  [<c134c54f>] ? _object_find+0x5f/0x90\n[ 1296.467413]  [<c1350aed>] drm_mode_setplane+0x10d/0x1f0\n[ 1296.467416]  [<c13509e0>] ? drm_mode_getplane+0x100/0x100\n[ 1296.467420]  [<c1342e4d>] drm_ioctl+0x1bd/0x4f0\n[ 1296.467423]  [<c13509e0>] ? drm_mode_getplane+0x100/0x100\n[ 1296.467427]  [<c111c023>] ? handle_mm_fault+0x5d3/0xb30\n[ 1296.467431]  [<c1118f31>] ? tlb_finish_mmu+0x11/0x40\n[ 1296.467435]  [<c1342c90>] ? drm_ioctl_flags+0x40/0x40\n[ 1296.467438]  [<c11593d2>] do_vfs_ioctl+0x2f2/0x4d0\n[ 1296.467443]  [<c1226512>] ? inode_has_perm.isra.32+0x32/0x40\n[ 1296.467446]  [<c122662f>] ? file_has_perm+0x7f/0x90\n[ 1296.467449]  [<c1226fec>] ? selinux_file_ioctl+0x4c/0xf0\n[ 1296.467452]  [<c1159610>] SyS_ioctl+0x60/0x90\n[ 1296.467456]  [<c15e578c>] sysenter_do_call+0x12/0x22\n[ 1296.467457] Code: 3f cf ff eb dd ba 3f 00 00 00 b8 d9 c9 7f c1 e8 e6 3f cf ff eb d9 8d 74 26 00 55 89 e5 57 56 53 83 ec 34 66 66 66 66 90 89 45 f0 <8b> 00 85 c9 89 d6 89 cb 89 45 ec 0f 84 16 01 00 00 8b 45 f0 e8\n[ 1296.467485] EIP: [<c134dc51>] setplane_internal+0x11/0x280 SS:ESP 0068:c2\n\nFixes regression from\ncommit b02fd7fd8a541c3d590bfdda23365a927b507ceb\nAuthor: Matt Roper <matthew.d.roper@intel.com>\nDate:   Tue Jun 10 08:28:10 2014 -0700\n\n    drm: Support legacy cursor ioctls via universal planes when possible (v4)\n\nWhile at it move the plane parameter to the first position in\nsetplane_internal since that's the main object we're manipulating.\n\nSigned-off-by: Chris Wilson <chris@chris-wilson.co.uk>\nCc: Daniel Vetter <daniel.vetter@ffwll.ch>\nCc: Pallavi G<pallavi.g@intel.com>\nCc: Matt Roper <matthew.d.roper@intel.com>\nReviewed-by: Matt Roper <matthew.d.roper@intel.com>\n[danvet: Add note about parameter reordering.]\nSigned-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>",
        "before_after_code_files": [
          "drivers/gpu/drm/drm_crtc.c||drivers/gpu/drm/drm_crtc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "drivers/gpu/drm/drm_crtc.c||drivers/gpu/drm/drm_crtc.c": [
          "File: drivers/gpu/drm/drm_crtc.c -> drivers/gpu/drm/drm_crtc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2136:         struct drm_framebuffer *fb,",
          "2137:         int32_t crtc_x, int32_t crtc_y,",
          "2138:         uint32_t crtc_w, uint32_t crtc_h,",
          "",
          "[Removed Lines]",
          "2134: static int setplane_internal(struct drm_crtc *crtc,",
          "2135:         struct drm_plane *plane,",
          "",
          "[Added Lines]",
          "2134: static int setplane_internal(struct drm_plane *plane,",
          "2135:         struct drm_crtc *crtc,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2140:         uint32_t src_x, uint32_t src_y,",
          "2141:         uint32_t src_w, uint32_t src_h)",
          "2142: {",
          "2144:  struct drm_framebuffer *old_fb = NULL;",
          "2145:  int ret = 0;",
          "2146:  unsigned int fb_width, fb_height;",
          "",
          "[Removed Lines]",
          "2143:  struct drm_device *dev = crtc->dev;",
          "",
          "[Added Lines]",
          "2143:  struct drm_device *dev = plane->dev;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2296:      plane_req->crtc_x, plane_req->crtc_y,",
          "2297:      plane_req->crtc_w, plane_req->crtc_h,",
          "2298:      plane_req->src_x, plane_req->src_y,",
          "",
          "[Removed Lines]",
          "2295:  return setplane_internal(crtc, plane, fb,",
          "",
          "[Added Lines]",
          "2295:  return setplane_internal(plane, crtc, fb,",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2632:     crtc_x, crtc_y, crtc_w, crtc_h,",
          "2633:     0, 0, src_w, src_h);",
          "",
          "[Removed Lines]",
          "2631:  ret = setplane_internal(crtc, crtc->cursor, fb,",
          "",
          "[Added Lines]",
          "2631:  ret = setplane_internal(crtc->cursor, crtc, fb,",
          "",
          "---------------"
        ]
      }
    }
  ]
}