{
  "cve_id": "CVE-2014-9625",
  "cve_desc": "The GetUpdateFile function in misc/update.c in the Updater in VideoLAN VLC media player before 2.1.6 performs an incorrect cast operation from a 64-bit integer to a 32-bit integer, which allows remote attackers to conduct buffer overflow attacks and execute arbitrary code via a crafted update status file, aka an \"integer truncation\" vulnerability.",
  "repo": "videolan/vlc",
  "patch_hash": "fbe2837bc80f155c001781041a54c58b5524fc14",
  "patch_info": {
    "commit_hash": "fbe2837bc80f155c001781041a54c58b5524fc14",
    "repo": "videolan/vlc",
    "commit_url": "https://github.com/videolan/vlc/commit/fbe2837bc80f155c001781041a54c58b5524fc14",
    "files": [
      "src/misc/update.c"
    ],
    "message": "misc: update: fix buffer overflow in updater\n\nOn 32 bit builds, parsing of update status files with a size of\n4294967295 or more lead to an integer truncation in a call to malloc\nand a subsequent buffer overflow. This happened prior to checking the\nfiles' signature. The commit fixes this by disallowing overly large\nstatus files (above 65k in practice)\n\nSigned-off-by: Jean-Baptiste Kempf <jb@videolan.org>",
    "before_after_code_files": [
      "src/misc/update.c||src/misc/update.c"
    ]
  },
  "patch_diff": {
    "src/misc/update.c||src/misc/update.c": [
      "File: src/misc/update.c -> src/misc/update.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "193:     }",
      "195:     const int64_t i_read = stream_Size( p_stream );",
      "197:     if( !psz_update_data )",
      "198:         goto error;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "197:     if( i_read < 0 || i_read >= UINT16_MAX)",
      "198:     {",
      "199:         msg_Err(p_update->p_libvlc, \"Status file too large\");",
      "200:         goto error;",
      "201:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "afceeaf90eac02f5bc7530762584b9177f0b7a43",
      "candidate_info": {
        "commit_hash": "afceeaf90eac02f5bc7530762584b9177f0b7a43",
        "repo": "videolan/vlc",
        "commit_url": "https://github.com/videolan/vlc/commit/afceeaf90eac02f5bc7530762584b9177f0b7a43",
        "files": [
          "src/misc/update.c"
        ],
        "message": "update: correct check for update file size",
        "before_after_code_files": [
          "src/misc/update.c||src/misc/update.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/misc/update.c||src/misc/update.c"
          ],
          "candidate": [
            "src/misc/update.c||src/misc/update.c"
          ]
        }
      },
      "candidate_diff": {
        "src/misc/update.c||src/misc/update.c": [
          "File: src/misc/update.c -> src/misc/update.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "192:         goto error;",
          "193:     }",
          "198:     {",
          "199:         msg_Err(p_update->p_libvlc, \"Status file too large\");",
          "200:         goto error;",
          "",
          "[Removed Lines]",
          "195:     const int64_t i_read = stream_Size( p_stream );",
          "197:     if( i_read < 0 || i_read >= UINT16_MAX)",
          "",
          "[Added Lines]",
          "195:     uint64_t i_read;",
          "196:     if( stream_GetSize( p_stream, &i_read ) || i_read >= UINT16_MAX )",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "204:     if( !psz_update_data )",
          "205:         goto error;",
          "208:     {",
          "209:         msg_Err( p_update->p_libvlc, \"Couldn't download update file %s\",",
          "210:                 UPDATE_VLC_STATUS_URL );",
          "",
          "[Removed Lines]",
          "207:     if( stream_Read( p_stream, psz_update_data, i_read ) != i_read )",
          "",
          "[Added Lines]",
          "206:     if( stream_Read( p_stream, psz_update_data, i_read ) != (ssize_t)i_read )",
          "",
          "---------------"
        ]
      }
    }
  ]
}