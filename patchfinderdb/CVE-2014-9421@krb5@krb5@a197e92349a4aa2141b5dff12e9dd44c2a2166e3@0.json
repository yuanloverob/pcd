{
  "cve_id": "CVE-2014-9421",
  "cve_desc": "The auth_gssapi_unwrap_data function in lib/rpc/auth_gssapi_misc.c in MIT Kerberos 5 (aka krb5) through 1.11.5, 1.12.x through 1.12.2, and 1.13.x before 1.13.1 does not properly handle partial XDR deserialization, which allows remote authenticated users to cause a denial of service (use-after-free and double free, and daemon crash) or possibly execute arbitrary code via malformed XDR data, as demonstrated by data sent to kadmind.",
  "repo": "krb5/krb5",
  "patch_hash": "a197e92349a4aa2141b5dff12e9dd44c2a2166e3",
  "patch_info": {
    "commit_hash": "a197e92349a4aa2141b5dff12e9dd44c2a2166e3",
    "repo": "krb5/krb5",
    "commit_url": "https://github.com/krb5/krb5/commit/a197e92349a4aa2141b5dff12e9dd44c2a2166e3",
    "files": [
      "src/lib/kadm5/kadm_rpc_xdr.c",
      "src/lib/rpc/auth_gssapi_misc.c"
    ],
    "message": "Fix kadm5/gssrpc XDR double free [CVE-2014-9421]\n\n[MITKRB5-SA-2015-001] In auth_gssapi_unwrap_data(), do not free\npartial deserialization results upon failure to deserialize.  This\nresponsibility belongs to the callers, svctcp_getargs() and\nsvcudp_getargs(); doing it in the unwrap function results in freeing\nthe results twice.\n\nIn xdr_krb5_tl_data() and xdr_krb5_principal(), null out the pointers\nwe are freeing, as other XDR functions such as xdr_bytes() and\nxdr_string().\n\nticket: 8056 (new)\ntarget_version: 1.13.1\ntags: pullup",
    "before_after_code_files": [
      "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c",
      "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c"
    ]
  },
  "patch_diff": {
    "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c": [
      "File: src/lib/kadm5/kadm_rpc_xdr.c -> src/lib/kadm5/kadm_rpc_xdr.c"
    ],
    "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c": [
      "File: src/lib/rpc/auth_gssapi_misc.c -> src/lib/rpc/auth_gssapi_misc.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "322:      if (! (*xdr_func)(&temp_xdrs, xdr_ptr)) {",
      "323:    PRINTF((\"gssapi_unwrap_data: deserializing arguments failed\\n\"));",
      "324:    gss_release_buffer(minor, &out_buf);",
      "326:    XDR_DESTROY(&temp_xdrs);",
      "327:    return FALSE;",
      "328:      }",
      "",
      "[Removed Lines]",
      "325:    xdr_free(xdr_func, xdr_ptr);",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d89dde02db71ba3ff0377e12e485f47537d43798",
      "candidate_info": {
        "commit_hash": "d89dde02db71ba3ff0377e12e485f47537d43798",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/d89dde02db71ba3ff0377e12e485f47537d43798",
        "files": [
          "src/lib/kadm5/kadm_rpc_xdr.c",
          "src/lib/rpc/auth_gssapi_misc.c"
        ],
        "message": "Fix kadm5/gssrpc XDR double free [CVE-2014-9421]\n\n[MITKRB5-SA-2015-001] In auth_gssapi_unwrap_data(), do not free\npartial deserialization results upon failure to deserialize.  This\nresponsibility belongs to the callers, svctcp_getargs() and\nsvcudp_getargs(); doing it in the unwrap function results in freeing\nthe results twice.\n\nIn xdr_krb5_tl_data() and xdr_krb5_principal(), null out the pointers\nwe are freeing, as other XDR functions such as xdr_bytes() and\nxdr_string().\n\n(cherry picked from commit a197e92349a4aa2141b5dff12e9dd44c2a2166e3)\n\nticket: 8056\nversion_fixed: 1.13.1\nstatus: resolved",
        "before_after_code_files": [
          "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c",
          "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c",
            "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c"
          ],
          "candidate": [
            "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c",
            "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c": [
          "File: src/lib/kadm5/kadm_rpc_xdr.c -> src/lib/kadm5/kadm_rpc_xdr.c"
        ],
        "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c": [
          "File: src/lib/rpc/auth_gssapi_misc.c -> src/lib/rpc/auth_gssapi_misc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "322:      if (! (*xdr_func)(&temp_xdrs, xdr_ptr)) {",
          "323:    PRINTF((\"gssapi_unwrap_data: deserializing arguments failed\\n\"));",
          "324:    gss_release_buffer(minor, &out_buf);",
          "326:    XDR_DESTROY(&temp_xdrs);",
          "327:    return FALSE;",
          "328:      }",
          "",
          "[Removed Lines]",
          "325:    xdr_free(xdr_func, xdr_ptr);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "771228aafa71f472578931b798c9e159a79d196e",
      "candidate_info": {
        "commit_hash": "771228aafa71f472578931b798c9e159a79d196e",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/771228aafa71f472578931b798c9e159a79d196e",
        "files": [
          "src/lib/kadm5/kadm_rpc_xdr.c",
          "src/lib/rpc/auth_gssapi_misc.c"
        ],
        "message": "Fix kadm5/gssrpc XDR double free [CVE-2014-9421]\n\n[MITKRB5-SA-2015-001] In auth_gssapi_unwrap_data(), do not free\npartial deserialization results upon failure to deserialize.  This\nresponsibility belongs to the callers, svctcp_getargs() and\nsvcudp_getargs(); doing it in the unwrap function results in freeing\nthe results twice.\n\nIn xdr_krb5_tl_data() and xdr_krb5_principal(), null out the pointers\nwe are freeing, as other XDR functions such as xdr_bytes() and\nxdr_string().\n\n(cherry picked from commit a197e92349a4aa2141b5dff12e9dd44c2a2166e3)\n\nticket: 8068 (new)\nversion_fixed: 1.12.3\nstatus: resolved",
        "before_after_code_files": [
          "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c",
          "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c",
            "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c"
          ],
          "candidate": [
            "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c",
            "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c": [
          "File: src/lib/kadm5/kadm_rpc_xdr.c -> src/lib/kadm5/kadm_rpc_xdr.c"
        ],
        "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c": [
          "File: src/lib/rpc/auth_gssapi_misc.c -> src/lib/rpc/auth_gssapi_misc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "322:      if (! (*xdr_func)(&temp_xdrs, xdr_ptr)) {",
          "323:    PRINTF((\"gssapi_unwrap_data: deserializing arguments failed\\n\"));",
          "324:    gss_release_buffer(minor, &out_buf);",
          "326:    XDR_DESTROY(&temp_xdrs);",
          "327:    return FALSE;",
          "328:      }",
          "",
          "[Removed Lines]",
          "325:    xdr_free(xdr_func, xdr_ptr);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0515f9e7b1d044f68e978f7192cd1e0fc4f5790f",
      "candidate_info": {
        "commit_hash": "0515f9e7b1d044f68e978f7192cd1e0fc4f5790f",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/0515f9e7b1d044f68e978f7192cd1e0fc4f5790f",
        "files": [
          "src/lib/kadm5/kadm_rpc_xdr.c",
          "src/lib/rpc/auth_gssapi_misc.c"
        ],
        "message": "Fix kadm5/gssrpc XDR double free [CVE-2014-9421]\n\n[MITKRB5-SA-2015-001] In auth_gssapi_unwrap_data(), do not free\npartial deserialization results upon failure to deserialize.  This\nresponsibility belongs to the callers, svctcp_getargs() and\nsvcudp_getargs(); doing it in the unwrap function results in freeing\nthe results twice.\n\nIn xdr_krb5_tl_data() and xdr_krb5_principal(), null out the pointers\nwe are freeing, as other XDR functions such as xdr_bytes() and\nxdr_string().\n\n(cherry picked from commit a197e92349a4aa2141b5dff12e9dd44c2a2166e3)\n\nticket: 8074 (new)\nversion_fixed: 1.11.6\nstatus: resolved",
        "before_after_code_files": [
          "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c",
          "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c",
            "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c"
          ],
          "candidate": [
            "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c",
            "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/kadm5/kadm_rpc_xdr.c||src/lib/kadm5/kadm_rpc_xdr.c": [
          "File: src/lib/kadm5/kadm_rpc_xdr.c -> src/lib/kadm5/kadm_rpc_xdr.c"
        ],
        "src/lib/rpc/auth_gssapi_misc.c||src/lib/rpc/auth_gssapi_misc.c": [
          "File: src/lib/rpc/auth_gssapi_misc.c -> src/lib/rpc/auth_gssapi_misc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "322:      if (! (*xdr_func)(&temp_xdrs, xdr_ptr)) {",
          "323:    PRINTF((\"gssapi_unwrap_data: deserializing arguments failed\\n\"));",
          "324:    gss_release_buffer(minor, &out_buf);",
          "326:    XDR_DESTROY(&temp_xdrs);",
          "327:    return FALSE;",
          "328:      }",
          "",
          "[Removed Lines]",
          "325:    xdr_free(xdr_func, xdr_ptr);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}