{
  "cve_id": "CVE-2019-10678",
  "cve_desc": "Domoticz before 4.10579 neglects to categorize \\n and \\r as insecure argument options.",
  "repo": "domoticz/domoticz",
  "patch_hash": "2119afbe74ee0c914c1d5c4c859c594c08b0ad42",
  "patch_info": {
    "commit_hash": "2119afbe74ee0c914c1d5c4c859c594c08b0ad42",
    "repo": "domoticz/domoticz",
    "commit_url": "https://github.com/domoticz/domoticz/commit/2119afbe74ee0c914c1d5c4c859c594c08b0ad42",
    "files": [
      "main/Helper.cpp"
    ],
    "message": "Do not allow enters/returns in arguments (thanks to Fabio Carretto)",
    "before_after_code_files": [
      "main/Helper.cpp||main/Helper.cpp"
    ]
  },
  "patch_diff": {
    "main/Helper.cpp||main/Helper.cpp": [
      "File: main/Helper.cpp -> main/Helper.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "1014:  \"$\",",
      "1015:  \"<\",",
      "1016:  \">\",",
      "1017:  NULL",
      "1018: };",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1017:  \"\\n\",",
      "1018:  \"\\r\",",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "41a07b0bf034e1e0db4045006f81f72634b274b5",
      "candidate_info": {
        "commit_hash": "41a07b0bf034e1e0db4045006f81f72634b274b5",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/41a07b0bf034e1e0db4045006f81f72634b274b5",
        "files": [
          "notifications/NotificationHelper.cpp"
        ],
        "message": "Ignoring evohome notifications",
        "before_after_code_files": [
          "notifications/NotificationHelper.cpp||notifications/NotificationHelper.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "notifications/NotificationHelper.cpp||notifications/NotificationHelper.cpp": [
          "File: notifications/NotificationHelper.cpp -> notifications/NotificationHelper.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "440:      return false;",
          "441:    }",
          "442:    break;",
          "443:   default:",
          "444:    break;",
          "445:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "443:   case pTypeEvohome:",
          "444:   case pTypeEvohomeRelay:",
          "445:   case pTypeEvohomeWater:",
          "446:   case pTypeEvohomeZone:",
          "448:    return false;",
          "449:    break;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "de9a1692cfed423978aacb9e870f358a5cdc6951",
      "candidate_info": {
        "commit_hash": "de9a1692cfed423978aacb9e870f358a5cdc6951",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/de9a1692cfed423978aacb9e870f358a5cdc6951",
        "files": [
          "www/app/report/EnergyMultiCounterReport.js"
        ],
        "message": "Correcting P1 Electric report for users with return delivery",
        "before_after_code_files": [
          "www/app/report/EnergyMultiCounterReport.js||www/app/report/EnergyMultiCounterReport.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "www/app/report/EnergyMultiCounterReport.js||www/app/report/EnergyMultiCounterReport.js": [
          "File: www/app/report/EnergyMultiCounterReport.js -> www/app/report/EnergyMultiCounterReport.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "25:                 }",
          "27:                 var includeReturn = typeof stats.delivered !== 'undefined';",
          "29:                 var source = month",
          "30:                     ? data.years[year].months.find(function (item) {",
          "31:                         return (new Date(item.date)).getMonth() + 1 === month;",
          "",
          "[Removed Lines]",
          "28:                 var data = getGroupedData(stats.result, costs);",
          "",
          "[Added Lines]",
          "28:                 var data = getGroupedData(stats.result, costs,includeReturn);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "238:             } else {",
          "239:                 columns.push({",
          "240:                     title: $.t('Month'),",
          "241:                     data: 'date',",
          "242:                     render: function (data) {",
          "243:                         var date = new Date(data);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "241:                     width: 150,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bb7298e269ea62716d2aef50dd5e7715ae9eb9dd",
      "candidate_info": {
        "commit_hash": "bb7298e269ea62716d2aef50dd5e7715ae9eb9dd",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/bb7298e269ea62716d2aef50dd5e7715ae9eb9dd",
        "files": [
          "www/app/devices/deviceFactory.js",
          "www/app/report/CounterReport.html",
          "www/app/report/CounterReport.js",
          "www/app/report/DeviceReport.js"
        ],
        "message": "Added report for Counter Incremental devices",
        "before_after_code_files": [
          "www/app/devices/deviceFactory.js||www/app/devices/deviceFactory.js",
          "www/app/report/CounterReport.html||www/app/report/CounterReport.html",
          "www/app/report/CounterReport.js||www/app/report/CounterReport.js",
          "www/app/report/DeviceReport.js||www/app/report/DeviceReport.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "www/app/devices/deviceFactory.js||www/app/devices/deviceFactory.js": [
          "File: www/app/devices/deviceFactory.js -> www/app/devices/deviceFactory.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "67:                 return 'dB';",
          "68:             } else if (this.Type === 'General' && this.SubType === 'kWh') {",
          "69:                 return 'kWh';",
          "70:             } else if (this.Type === 'P1 Smart Meter' && this.SubType === 'Energy') {",
          "71:                 return 'kWh';",
          "72:             } else if (this.Type === 'RFXMeter' && this.SwitchTypeVal === 2) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "70:             } else if (this.Type === 'General' && this.SubType === 'Counter Incremental') {",
          "71:                 return '';",
          "",
          "---------------"
        ],
        "www/app/report/CounterReport.html||www/app/report/CounterReport.html": [
          "File: www/app/report/CounterReport.html -> www/app/report/CounterReport.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <div ng-if=\"::!$ctrl.isMonthView\" style=\"margin-bottom: 12px\">",
          "2:     <div>{{:: 'Total Usage' | translate }}: {{:: $ctrl.data.usage.toFixed(3) }} {{:: $ctrl.unit}}</div>",
          "3:     <div>{{:: 'Counter' | translate }}: {{:: $ctrl.data.counter.toFixed(3) }} {{:: $ctrl.unit}}</div>",
          "5: </div>",
          "7: <div ng-if=\"::$ctrl.isMonthView\" style=\"margin-bottom: 12px\">",
          "",
          "[Removed Lines]",
          "4:     <div>{{:: 'Year Cost' | translate }}: {{:: $ctrl.data.cost.toFixed(2) }}</div>",
          "",
          "[Added Lines]",
          "4:     <div ng-hide=\"!$ctrl.data.cost\">{{:: 'Year Cost' | translate }}: {{:: $ctrl.data.cost.toFixed(2) }}</div>",
          "",
          "---------------"
        ],
        "www/app/report/CounterReport.js||www/app/report/CounterReport.js": [
          "File: www/app/report/CounterReport.js -> www/app/report/CounterReport.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "211:             }",
          "213:             columns.push({ title: $.t('Usage'), data: 'usage', render: counterRenderer });",
          "216:             columns.push({",
          "217:                 title: '<>',",
          "",
          "[Removed Lines]",
          "214:             columns.push({ title: $.t('Costs'), data: 'cost', render: costRenderer });",
          "",
          "[Added Lines]",
          "215:    if (!['Counter Incremental'].includes(vm.device.SubType))",
          "216:     columns.push({ title: $.t('Costs'), data: 'cost', render: costRenderer });",
          "",
          "---------------"
        ],
        "www/app/report/DeviceReport.js||www/app/report/DeviceReport.js": [
          "File: www/app/report/DeviceReport.js -> www/app/report/DeviceReport.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:             if (!vm.device) {",
          "65:                 return undefined;",
          "66:             }",
          "68:             return ['Power', 'Energy', 'RFXMeter'].includes(vm.device.Type)",
          "69:                 || ['kWh'].includes(vm.device.SubType)",
          "70:                 || (vm.device.Type === 'P1 Smart Meter' && vm.device.SubType !== 'Energy');",
          "71:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "69:                 || ['Counter Incremental'].includes(vm.device.SubType)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6e39ed699cefd39a359204651ef6fd06d287b7c7",
      "candidate_info": {
        "commit_hash": "6e39ed699cefd39a359204651ef6fd06d287b7c7",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/6e39ed699cefd39a359204651ef6fd06d287b7c7",
        "files": [
          "main/EventSystem.cpp"
        ],
        "message": "Removed double initialization",
        "before_after_code_files": [
          "main/EventSystem.cpp||main/EventSystem.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "main/EventSystem.cpp||main/EventSystem.cpp": [
          "File: main/EventSystem.cpp -> main/EventSystem.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "3897:  int level = 0;",
          "3898:  devicestatesMutexLock.unlock();",
          "3901:  ParseActionString(Action, oParseResults);",
          "3903:  if (oParseResults.sCommand.substr(0, 9) == \"Set Level\") {",
          "",
          "[Removed Lines]",
          "3900:  struct _tActionParseResults oParseResults = { \"\", 0, 0, 0, 1, 0, true };",
          "",
          "[Added Lines]",
          "3900:  _tActionParseResults oParseResults;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6d891117015628ecbebc55500e756adb8f2760ea",
      "candidate_info": {
        "commit_hash": "6d891117015628ecbebc55500e756adb8f2760ea",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/6d891117015628ecbebc55500e756adb8f2760ea",
        "files": [
          "hardware/EvohomeWeb.cpp"
        ],
        "message": "Removed terminate call cause by previous thread changes",
        "before_after_code_files": [
          "hardware/EvohomeWeb.cpp||hardware/EvohomeWeb.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "hardware/EvohomeWeb.cpp||hardware/EvohomeWeb.cpp": [
          "File: hardware/EvohomeWeb.cpp -> hardware/EvohomeWeb.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "212:    m_lastconnect=0;",
          "213:   }",
          "214:  }",
          "217:  _log.Log(LOG_STATUS, \"(%s) Worker stopped...\", m_Name.c_str());",
          "218: }",
          "",
          "[Removed Lines]",
          "215:  terminate();",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}