{
  "cve_id": "CVE-2019-5719",
  "cve_desc": "In Wireshark 2.6.0 to 2.6.5 and 2.4.0 to 2.4.11, the ISAKMP dissector could crash. This was addressed in epan/dissectors/packet-isakmp.c by properly handling the case of a missing decryption data block.",
  "repo": "wireshark/wireshark",
  "patch_hash": "c9cfae7fecd4bc21b8b4f48328d08e104d47dd52",
  "patch_info": {
    "commit_hash": "c9cfae7fecd4bc21b8b4f48328d08e104d47dd52",
    "repo": "wireshark/wireshark",
    "commit_url": "https://github.com/wireshark/wireshark/commit/c9cfae7fecd4bc21b8b4f48328d08e104d47dd52",
    "files": [
      "epan/dissectors/packet-isakmp.c"
    ],
    "message": "ISAKMP: Fix a crash when no decryption data block is there\n\nDon't try to (re)set parameters in a struct when its pointer\npoints to NULL.\n\nBug: 15374\nChange-Id: I953e82795990fde5fce2ad6d955781b372a9e405\nSigned-off-by: Jaap Keuter <jaap.keuter@xs4all.nl>\nReviewed-on: https://code.wireshark.org/review/31189\nTested-by: Petri Dish Buildbot\nReviewed-by: Michael Mann <mmann78@netscape.net>",
    "before_after_code_files": [
      "epan/dissectors/packet-isakmp.c||epan/dissectors/packet-isakmp.c"
    ]
  },
  "patch_diff": {
    "epan/dissectors/packet-isakmp.c||epan/dissectors/packet-isakmp.c": [
      "File: epan/dissectors/packet-isakmp.c -> epan/dissectors/packet-isakmp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3763: static int",
      "3766: {",
      "3767:   guint headerlen, value_len, attr_type;",
      "3768:   proto_item *attr_item;",
      "",
      "[Removed Lines]",
      "3764: dissect_ike_attribute(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, decrypt_data_t *decr",
      "3765: )",
      "",
      "[Added Lines]",
      "3764: dissect_ike_attribute(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, decrypt_data_t *decr)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3785:     case IKE_ATTR_ENCRYPTION_ALGORITHM:",
      "3786:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_encryption_algorithm, tvb, offset, value_len, ENC_BIG_ENDIAN);",
      "3787:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), ike_attr_enc_algo, \"Unknown %d\"));",
      "3789:       break;",
      "3790:     case IKE_ATTR_HASH_ALGORITHM:",
      "3791:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_hash_algorithm, tvb, offset, value_len, ENC_BIG_ENDIAN);",
      "3792:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), ike_attr_hash_algo, \"Unknown %d\"));",
      "3794:       break;",
      "3795:     case IKE_ATTR_AUTHENTICATION_METHOD:",
      "3796:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_authentication_method, tvb, offset, value_len, ENC_BIG_ENDIAN);",
      "3797:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), ike_attr_authmeth, \"Unknown %d\"));",
      "3799:       break;",
      "3800:     case IKE_ATTR_GROUP_DESCRIPTION:",
      "3801:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_group_description, tvb, offset, value_len, ENC_BIG_ENDIAN);",
      "3802:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), dh_group, \"Unknown %d\"));",
      "3804:       break;",
      "3805:     case IKE_ATTR_GROUP_TYPE:",
      "3806:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_group_type, tvb, offset, value_len, ENC_BIG_ENDIAN);",
      "",
      "[Removed Lines]",
      "3788:       decr->ike_encr_alg = tvb_get_ntohs(tvb, offset);",
      "3793:       decr->ike_hash_alg = tvb_get_ntohs(tvb, offset);",
      "3798:       decr->is_psk = tvb_get_ntohs(tvb, offset) == 0x01 ? TRUE : FALSE;",
      "3803:       decr->group = tvb_get_ntohs(tvb, offset);",
      "",
      "[Added Lines]",
      "3787:       if (decr) decr->ike_encr_alg = tvb_get_ntohs(tvb, offset);",
      "3792:       if (decr) decr->ike_hash_alg = tvb_get_ntohs(tvb, offset);",
      "3797:       if (decr) decr->is_psk = tvb_get_ntohs(tvb, offset) == 0x01 ? TRUE : FALSE;",
      "3802:       if (decr) decr->group = tvb_get_ntohs(tvb, offset);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "3834:     case IKE_ATTR_KEY_LENGTH:",
      "3835:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_key_length, tvb, offset, value_len, ENC_BIG_ENDIAN);",
      "3836:       proto_item_append_text(attr_item, \": %d\", tvb_get_ntohs(tvb, offset));",
      "3838:       break;",
      "3839:     case IKE_ATTR_FIELD_SIZE:",
      "3840:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_field_size, tvb, offset, value_len, ENC_NA);",
      "",
      "[Removed Lines]",
      "3837:       decr->ike_encr_keylen = tvb_get_ntohs(tvb, offset);",
      "",
      "[Added Lines]",
      "3836:       if (decr) decr->ike_encr_keylen = tvb_get_ntohs(tvb, offset);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "3970:     offset += 2;",
      "3972:     if (protocol_id == 1 && transform_id == 1) {",
      "3979:       while (offset < offset_end) {",
      "3980:         offset += dissect_ike_attribute(tvb, pinfo, tree, offset, decr);",
      "3981:       }",
      "",
      "[Removed Lines]",
      "3976:       decr->ike_encr_alg = 0;",
      "3977:       decr->ike_encr_keylen = 0;",
      "3978:       decr->ike_hash_alg = 0;",
      "",
      "[Added Lines]",
      "3972:       if (decr) {",
      "3976:         decr->ike_encr_alg = 0;",
      "3977:         decr->ike_encr_keylen = 0;",
      "3978:         decr->ike_hash_alg = 0;",
      "3979:       }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "cd4b3f5d692cf0be7a4811d406f79cbd84fc5c45",
      "candidate_info": {
        "commit_hash": "cd4b3f5d692cf0be7a4811d406f79cbd84fc5c45",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/cd4b3f5d692cf0be7a4811d406f79cbd84fc5c45",
        "files": [
          "epan/dissectors/packet-isakmp.c"
        ],
        "message": "ISAKMP: Fix a crash when no decryption data block is there\n\nDon't try to (re)set parameters in a struct when its pointer\npoints to NULL.\n\nBug: 15374\nChange-Id: I953e82795990fde5fce2ad6d955781b372a9e405\nSigned-off-by: Jaap Keuter <jaap.keuter@xs4all.nl>\nReviewed-on: https://code.wireshark.org/review/31189\nTested-by: Petri Dish Buildbot\nReviewed-by: Michael Mann <mmann78@netscape.net>\n(cherry picked from commit c9cfae7fecd4bc21b8b4f48328d08e104d47dd52)\nReviewed-on: https://code.wireshark.org/review/31219\nPetri-Dish: Michael Mann <mmann78@netscape.net>",
        "before_after_code_files": [
          "epan/dissectors/packet-isakmp.c||epan/dissectors/packet-isakmp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-isakmp.c||epan/dissectors/packet-isakmp.c"
          ],
          "candidate": [
            "epan/dissectors/packet-isakmp.c||epan/dissectors/packet-isakmp.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-isakmp.c||epan/dissectors/packet-isakmp.c": [
          "File: epan/dissectors/packet-isakmp.c -> epan/dissectors/packet-isakmp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3763: static int",
          "3766: {",
          "3767:   guint headerlen, value_len, attr_type;",
          "3768:   proto_item *attr_item;",
          "",
          "[Removed Lines]",
          "3764: dissect_ike_attribute(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, decrypt_data_t *decr",
          "3765: )",
          "",
          "[Added Lines]",
          "3764: dissect_ike_attribute(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, decrypt_data_t *decr)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3785:     case IKE_ATTR_ENCRYPTION_ALGORITHM:",
          "3786:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_encryption_algorithm, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "3787:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), ike_attr_enc_algo, \"Unknown %d\"));",
          "3789:       break;",
          "3790:     case IKE_ATTR_HASH_ALGORITHM:",
          "3791:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_hash_algorithm, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "3792:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), ike_attr_hash_algo, \"Unknown %d\"));",
          "3794:       break;",
          "3795:     case IKE_ATTR_AUTHENTICATION_METHOD:",
          "3796:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_authentication_method, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "3797:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), ike_attr_authmeth, \"Unknown %d\"));",
          "3799:       break;",
          "3800:     case IKE_ATTR_GROUP_DESCRIPTION:",
          "3801:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_group_description, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "3802:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), dh_group, \"Unknown %d\"));",
          "3804:       break;",
          "3805:     case IKE_ATTR_GROUP_TYPE:",
          "3806:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_group_type, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "",
          "[Removed Lines]",
          "3788:       decr->ike_encr_alg = tvb_get_ntohs(tvb, offset);",
          "3793:       decr->ike_hash_alg = tvb_get_ntohs(tvb, offset);",
          "3798:       decr->is_psk = tvb_get_ntohs(tvb, offset) == 0x01 ? TRUE : FALSE;",
          "3803:       decr->group = tvb_get_ntohs(tvb, offset);",
          "",
          "[Added Lines]",
          "3787:       if (decr) decr->ike_encr_alg = tvb_get_ntohs(tvb, offset);",
          "3792:       if (decr) decr->ike_hash_alg = tvb_get_ntohs(tvb, offset);",
          "3797:       if (decr) decr->is_psk = tvb_get_ntohs(tvb, offset) == 0x01 ? TRUE : FALSE;",
          "3802:       if (decr) decr->group = tvb_get_ntohs(tvb, offset);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3834:     case IKE_ATTR_KEY_LENGTH:",
          "3835:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_key_length, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "3836:       proto_item_append_text(attr_item, \": %d\", tvb_get_ntohs(tvb, offset));",
          "3838:       break;",
          "3839:     case IKE_ATTR_FIELD_SIZE:",
          "3840:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_field_size, tvb, offset, value_len, ENC_NA);",
          "",
          "[Removed Lines]",
          "3837:       decr->ike_encr_keylen = tvb_get_ntohs(tvb, offset);",
          "",
          "[Added Lines]",
          "3836:       if (decr) decr->ike_encr_keylen = tvb_get_ntohs(tvb, offset);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3970:     offset += 2;",
          "3972:     if (protocol_id == 1 && transform_id == 1) {",
          "3979:       while (offset < offset_end) {",
          "3980:         offset += dissect_ike_attribute(tvb, pinfo, tree, offset, decr);",
          "3981:       }",
          "",
          "[Removed Lines]",
          "3976:       decr->ike_encr_alg = 0;",
          "3977:       decr->ike_encr_keylen = 0;",
          "3978:       decr->ike_hash_alg = 0;",
          "",
          "[Added Lines]",
          "3972:       if (decr) {",
          "3976:         decr->ike_encr_alg = 0;",
          "3977:         decr->ike_encr_keylen = 0;",
          "3978:         decr->ike_hash_alg = 0;",
          "3979:       }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b5b02f2a9b8772d8814096f86c60a32889d61f2c",
      "candidate_info": {
        "commit_hash": "b5b02f2a9b8772d8814096f86c60a32889d61f2c",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/b5b02f2a9b8772d8814096f86c60a32889d61f2c",
        "files": [
          "epan/dissectors/packet-isakmp.c"
        ],
        "message": "ISAKMP: Fix a crash when no decryption data block is there\n\nDon't try to (re)set parameters in a struct when its pointer\npoints to NULL.\n\nBug: 15374\nChange-Id: I953e82795990fde5fce2ad6d955781b372a9e405\nSigned-off-by: Jaap Keuter <jaap.keuter@xs4all.nl>\nReviewed-on: https://code.wireshark.org/review/31189\nTested-by: Petri Dish Buildbot\nReviewed-by: Michael Mann <mmann78@netscape.net>\n(cherry picked from commit c9cfae7fecd4bc21b8b4f48328d08e104d47dd52)\nReviewed-on: https://code.wireshark.org/review/31220\nPetri-Dish: Michael Mann <mmann78@netscape.net>",
        "before_after_code_files": [
          "epan/dissectors/packet-isakmp.c||epan/dissectors/packet-isakmp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-isakmp.c||epan/dissectors/packet-isakmp.c"
          ],
          "candidate": [
            "epan/dissectors/packet-isakmp.c||epan/dissectors/packet-isakmp.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-isakmp.c||epan/dissectors/packet-isakmp.c": [
          "File: epan/dissectors/packet-isakmp.c -> epan/dissectors/packet-isakmp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3743: static int",
          "3746: {",
          "3747:   guint headerlen, value_len, attr_type;",
          "3748:   proto_item *attr_item;",
          "",
          "[Removed Lines]",
          "3744: dissect_ike_attribute(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, decrypt_data_t *decr",
          "3745: )",
          "",
          "[Added Lines]",
          "3744: dissect_ike_attribute(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, decrypt_data_t *decr)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3765:     case IKE_ATTR_ENCRYPTION_ALGORITHM:",
          "3766:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_encryption_algorithm, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "3767:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), ike_attr_enc_algo, \"Unknown %d\"));",
          "3769:       break;",
          "3770:     case IKE_ATTR_HASH_ALGORITHM:",
          "3771:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_hash_algorithm, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "3772:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), ike_attr_hash_algo, \"Unknown %d\"));",
          "3774:       break;",
          "3775:     case IKE_ATTR_AUTHENTICATION_METHOD:",
          "3776:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_authentication_method, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "3777:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), ike_attr_authmeth, \"Unknown %d\"));",
          "3779:       break;",
          "3780:     case IKE_ATTR_GROUP_DESCRIPTION:",
          "3781:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_group_description, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "3782:       proto_item_append_text(attr_item, \": %s\", val_to_str(tvb_get_ntohs(tvb, offset), dh_group, \"Unknown %d\"));",
          "3784:       break;",
          "3785:     case IKE_ATTR_GROUP_TYPE:",
          "3786:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_group_type, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "",
          "[Removed Lines]",
          "3768:       decr->ike_encr_alg = tvb_get_ntohs(tvb, offset);",
          "3773:       decr->ike_hash_alg = tvb_get_ntohs(tvb, offset);",
          "3778:       decr->is_psk = tvb_get_ntohs(tvb, offset) == 0x01 ? TRUE : FALSE;",
          "3783:       decr->group = tvb_get_ntohs(tvb, offset);",
          "",
          "[Added Lines]",
          "3767:       if (decr) decr->ike_encr_alg = tvb_get_ntohs(tvb, offset);",
          "3772:       if (decr) decr->ike_hash_alg = tvb_get_ntohs(tvb, offset);",
          "3777:       if (decr) decr->is_psk = tvb_get_ntohs(tvb, offset) == 0x01 ? TRUE : FALSE;",
          "3782:       if (decr) decr->group = tvb_get_ntohs(tvb, offset);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3814:     case IKE_ATTR_KEY_LENGTH:",
          "3815:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_key_length, tvb, offset, value_len, ENC_BIG_ENDIAN);",
          "3816:       proto_item_append_text(attr_item, \": %d\", tvb_get_ntohs(tvb, offset));",
          "3818:       break;",
          "3819:     case IKE_ATTR_FIELD_SIZE:",
          "3820:       proto_tree_add_item(attr_tree, hf_isakmp_ike_attr_field_size, tvb, offset, value_len, ENC_NA);",
          "",
          "[Removed Lines]",
          "3817:       decr->ike_encr_keylen = tvb_get_ntohs(tvb, offset);",
          "",
          "[Added Lines]",
          "3816:       if (decr) decr->ike_encr_keylen = tvb_get_ntohs(tvb, offset);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3950:     offset += 2;",
          "3952:     if (protocol_id == 1 && transform_id == 1) {",
          "3959:       while (offset < offset_end) {",
          "3960:         offset += dissect_ike_attribute(tvb, pinfo, tree, offset, decr);",
          "3961:       }",
          "",
          "[Removed Lines]",
          "3956:       decr->ike_encr_alg = 0;",
          "3957:       decr->ike_encr_keylen = 0;",
          "3958:       decr->ike_hash_alg = 0;",
          "",
          "[Added Lines]",
          "3952:       if (decr) {",
          "3956:         decr->ike_encr_alg = 0;",
          "3957:         decr->ike_encr_keylen = 0;",
          "3958:         decr->ike_hash_alg = 0;",
          "3959:       }",
          "",
          "---------------"
        ]
      }
    }
  ]
}