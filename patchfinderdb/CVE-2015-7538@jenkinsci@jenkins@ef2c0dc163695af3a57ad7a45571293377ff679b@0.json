{
  "cve_id": "CVE-2015-7538",
  "cve_desc": "Jenkins before 1.640 and LTS before 1.625.2 allow remote attackers to bypass the CSRF protection mechanism via unspecified vectors.",
  "repo": "jenkinsci/jenkins",
  "patch_hash": "ef2c0dc163695af3a57ad7a45571293377ff679b",
  "patch_info": {
    "commit_hash": "ef2c0dc163695af3a57ad7a45571293377ff679b",
    "repo": "jenkinsci/jenkins",
    "commit_url": "https://github.com/jenkinsci/jenkins/commit/ef2c0dc163695af3a57ad7a45571293377ff679b",
    "files": [
      "core/src/main/java/hudson/security/csrf/CrumbFilter.java",
      "war/src/main/webapp/scripts/hudson-behavior.js"
    ],
    "message": "[FIX SECURITY-233] Remove multipart form exception from crumb filter",
    "before_after_code_files": [
      "core/src/main/java/hudson/security/csrf/CrumbFilter.java||core/src/main/java/hudson/security/csrf/CrumbFilter.java",
      "war/src/main/webapp/scripts/hudson-behavior.js||war/src/main/webapp/scripts/hudson-behavior.js"
    ]
  },
  "patch_diff": {
    "core/src/main/java/hudson/security/csrf/CrumbFilter.java||core/src/main/java/hudson/security/csrf/CrumbFilter.java": [
      "File: core/src/main/java/hudson/security/csrf/CrumbFilter.java -> core/src/main/java/hudson/security/csrf/CrumbFilter.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "80:                     LOGGER.log(Level.WARNING, \"Found invalid crumb {0}.  Will check remaining parameters for a valid one...\", crumb);",
      "81:                 }",
      "82:             }",
      "85:                 chain.doFilter(request, response);",
      "86:             } else {",
      "87:                 LOGGER.log(Level.WARNING, \"No valid crumb was included in request for {0}. Returning {1}.\", new Object[] {httpRequest.getRequestURI(), HttpServletResponse.SC_FORBIDDEN});",
      "",
      "[Removed Lines]",
      "84:             if (valid || isMultipart(httpRequest)) {",
      "",
      "[Added Lines]",
      "84:             if (valid) {",
      "",
      "---------------"
    ],
    "war/src/main/webapp/scripts/hudson-behavior.js||war/src/main/webapp/scripts/hudson-behavior.js": [
      "File: war/src/main/webapp/scripts/hudson-behavior.js -> war/src/main/webapp/scripts/hudson-behavior.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "117:         var div = document.createElement(\"div\");",
      "118:         div.innerHTML = \"<input type=hidden name='\"+this.fieldName+\"' value='\"+this.value+\"'>\";",
      "119:         form.appendChild(div);",
      "120:     }",
      "121: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "120:         if (form.action.indexOf(\"?\") != -1) {",
      "121:             form.action = form.action+\"&\"+this.fieldName+\"=\"+this.value;",
      "122:         } else {",
      "123:             form.action = form.action+\"?\"+this.fieldName+\"=\"+this.value;",
      "124:         }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ba747888108d0db90d469c6d210b1df465d8fac1",
      "candidate_info": {
        "commit_hash": "ba747888108d0db90d469c6d210b1df465d8fac1",
        "repo": "jenkinsci/jenkins",
        "commit_url": "https://github.com/jenkinsci/jenkins/commit/ba747888108d0db90d469c6d210b1df465d8fac1",
        "files": [
          "war/src/main/webapp/scripts/hudson-behavior.js"
        ],
        "message": "[SECURITY-233] Only append crumb to URL in multipart forms",
        "before_after_code_files": [
          "war/src/main/webapp/scripts/hudson-behavior.js||war/src/main/webapp/scripts/hudson-behavior.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "war/src/main/webapp/scripts/hudson-behavior.js||war/src/main/webapp/scripts/hudson-behavior.js"
          ],
          "candidate": [
            "war/src/main/webapp/scripts/hudson-behavior.js||war/src/main/webapp/scripts/hudson-behavior.js"
          ]
        }
      },
      "candidate_diff": {
        "war/src/main/webapp/scripts/hudson-behavior.js||war/src/main/webapp/scripts/hudson-behavior.js": [
          "File: war/src/main/webapp/scripts/hudson-behavior.js -> war/src/main/webapp/scripts/hudson-behavior.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "117:         var div = document.createElement(\"div\");",
          "118:         div.innerHTML = \"<input type=hidden name='\"+this.fieldName+\"' value='\"+this.value+\"'>\";",
          "119:         form.appendChild(div);",
          "124:         }",
          "125:     }",
          "126: }",
          "",
          "[Removed Lines]",
          "120:         if (form.action.indexOf(\"?\") != -1) {",
          "121:             form.action = form.action+\"&\"+this.fieldName+\"=\"+this.value;",
          "122:         } else {",
          "123:             form.action = form.action+\"?\"+this.fieldName+\"=\"+this.value;",
          "",
          "[Added Lines]",
          "120:         if (form.enctype == \"multipart/form-data\") {",
          "121:             if (form.action.indexOf(\"?\") != -1) {",
          "122:                 form.action = form.action+\"&\"+this.fieldName+\"=\"+this.value;",
          "123:             } else {",
          "124:                 form.action = form.action+\"?\"+this.fieldName+\"=\"+this.value;",
          "125:             }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2426:                 form.enctype = form.encoding = \"multipart/form-data\";",
          "2427:                 break;",
          "2428:             case \"radio\":",
          "2429:                 if(!e.checked)  break;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2429:                 crumb.appendToForm(form);",
          "",
          "---------------"
        ]
      }
    }
  ]
}