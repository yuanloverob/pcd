{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "290bc0c067a63a90f3c02c4cffc4892fad7562aa",
      "candidate_info": {
        "commit_hash": "290bc0c067a63a90f3c02c4cffc4892fad7562aa",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/290bc0c067a63a90f3c02c4cffc4892fad7562aa",
        "files": [
          "doc/full-white-stripe.bmp",
          "doc/full-white-stripe.jpg",
          "doc/thin-white-stripe.bmp",
          "doc/thin-white-stripe.jpg",
          "tools/msvs/msi/product.wxs"
        ],
        "message": "Use .jpg instead of .bmp for .msi\n\nsmaller.",
        "before_after_code_files": [
          "tools/msvs/msi/product.wxs||tools/msvs/msi/product.wxs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/msvs/msi/product.wxs||tools/msvs/msi/product.wxs": [
          "File: tools/msvs/msi/product.wxs -> tools/msvs/msi/product.wxs",
          "--- Hunk 1 ---",
          "[Context before]",
          "114:     </UI>",
          "116:     <UIRef Id=\"WixUI_Common\" />",
          "119:   </Product>",
          "121: </Wix>",
          "",
          "[Removed Lines]",
          "117:     <WixVariable Id=\"WixUIBannerBmp\" Value=\"..\\..\\..\\doc\\thin-white-stripe.bmp\" />",
          "118:     <WixVariable Id=\"WixUIDialogBmp\" Value=\"..\\..\\..\\doc\\full-white-stripe.bmp\" />",
          "",
          "[Added Lines]",
          "117:     <WixVariable Id=\"WixUIBannerBmp\" Value=\"..\\..\\..\\doc\\thin-white-stripe.jpg\" />",
          "118:     <WixVariable Id=\"WixUIDialogBmp\" Value=\"..\\..\\..\\doc\\full-white-stripe.jpg\" />",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6f8839d2ac362ced42235a34a023af5e2c656501",
      "candidate_info": {
        "commit_hash": "6f8839d2ac362ced42235a34a023af5e2c656501",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/6f8839d2ac362ced42235a34a023af5e2c656501",
        "files": [
          "src/node_crypto.cc",
          "src/node_crypto.h"
        ],
        "message": "crypto: add SecureContext.clearOptions() method\n\nSecureContext.setOptions() is backed by SSL_CTX_set_options() which, contrary to\nwhat the name suggests, is additive: it doesn't set options, it adds them to the\nalready active options.\n\nHence the need for SecureContext.clearOptions(), which lets you unset active\noptions.",
        "before_after_code_files": [
          "src/node_crypto.cc||src/node_crypto.cc",
          "src/node_crypto.h||src/node_crypto.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/node_crypto.cc||src/node_crypto.cc": [
          "File: src/node_crypto.cc -> src/node_crypto.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "166:   NODE_SET_PROTOTYPE_METHOD(t, \"addRootCerts\", SecureContext::AddRootCerts);",
          "167:   NODE_SET_PROTOTYPE_METHOD(t, \"setCiphers\", SecureContext::SetCiphers);",
          "168:   NODE_SET_PROTOTYPE_METHOD(t, \"setOptions\", SecureContext::SetOptions);",
          "169:   NODE_SET_PROTOTYPE_METHOD(t, \"setSessionIdContext\",",
          "170:                                SecureContext::SetSessionIdContext);",
          "171:   NODE_SET_PROTOTYPE_METHOD(t, \"close\", SecureContext::Close);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "169:   NODE_SET_PROTOTYPE_METHOD(t, \"clearOptions\", SecureContext::ClearOptions);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "540:   return True();",
          "541: }",
          "550:   }",
          "559: Handle<Value> SecureContext::SetSessionIdContext(const Arguments& args) {",
          "560:   HandleScope scope;",
          "",
          "[Removed Lines]",
          "543: Handle<Value> SecureContext::SetOptions(const Arguments& args) {",
          "544:   HandleScope scope;",
          "546:   SecureContext *sc = ObjectWrap::Unwrap<SecureContext>(args.Holder());",
          "548:   if (args.Length() != 1 || !args[0]->IsUint32()) {",
          "549:     return ThrowException(Exception::TypeError(String::New(\"Bad parameter\")));",
          "552:   unsigned int opts = args[0]->Uint32Value();",
          "554:   SSL_CTX_set_options(sc->ctx_, opts);",
          "556:   return True();",
          "557: }",
          "",
          "[Added Lines]",
          "544: #define X(name, fn)                                                           \\",
          "545:   Handle<Value> name(const Arguments& args) {                                 \\",
          "546:     HandleScope scope;                                                        \\",
          "547:     SecureContext *sc = ObjectWrap::Unwrap<SecureContext>(args.Holder());     \\",
          "548:     if (args.Length() != 1 || !args[0]->IsInt32()) {                          \\",
          "549:       return ThrowException(                                                  \\",
          "550:           Exception::TypeError(String::New(\"Bad parameter\")));                \\",
          "551:     }                                                                         \\",
          "552:     fn(sc->ctx_, args[0]->Int32Value());                                      \\",
          "553:     return True();                                                            \\",
          "557: X(SecureContext::SetOptions,   SSL_CTX_set_options)",
          "558: X(SecureContext::ClearOptions, SSL_CTX_clear_options)",
          "560: #undef X",
          "",
          "---------------"
        ],
        "src/node_crypto.h||src/node_crypto.h": [
          "File: src/node_crypto.h -> src/node_crypto.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "66:   static v8::Handle<v8::Value> AddRootCerts(const v8::Arguments& args);",
          "67:   static v8::Handle<v8::Value> SetCiphers(const v8::Arguments& args);",
          "68:   static v8::Handle<v8::Value> SetOptions(const v8::Arguments& args);",
          "69:   static v8::Handle<v8::Value> SetSessionIdContext(const v8::Arguments& args);",
          "70:   static v8::Handle<v8::Value> Close(const v8::Arguments& args);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "69:   static v8::Handle<v8::Value> ClearOptions(const v8::Arguments& args);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2d9239359db7ba8d23761ca18cef9455f812f111",
      "candidate_info": {
        "commit_hash": "2d9239359db7ba8d23761ca18cef9455f812f111",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/2d9239359db7ba8d23761ca18cef9455f812f111",
        "files": [
          "deps/v8/build/common.gypi",
          "deps/v8/src/code-stubs.cc",
          "deps/v8/src/heap.h",
          "deps/v8/src/version.cc",
          "deps/v8/test/mjsunit/regress/regress-2291.js",
          "deps/v8/tools/gyp/v8.gyp"
        ],
        "message": "v8: upgrade to v3.11.10.19",
        "before_after_code_files": [
          "deps/v8/build/common.gypi||deps/v8/build/common.gypi",
          "deps/v8/src/code-stubs.cc||deps/v8/src/code-stubs.cc",
          "deps/v8/src/heap.h||deps/v8/src/heap.h",
          "deps/v8/src/version.cc||deps/v8/src/version.cc",
          "deps/v8/test/mjsunit/regress/regress-2291.js||deps/v8/test/mjsunit/regress/regress-2291.js",
          "deps/v8/tools/gyp/v8.gyp||deps/v8/tools/gyp/v8.gyp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "deps/v8/build/common.gypi||deps/v8/build/common.gypi": [
          "File: deps/v8/build/common.gypi -> deps/v8/build/common.gypi",
          "--- Hunk 1 ---",
          "[Context before]",
          "239:           'WIN32',",
          "240:         ],",
          "241:         'msvs_configuration_attributes': {",
          "242:           'IntermediateDirectory': '$(OutDir)\\\\obj\\\\$(ProjectName)',",
          "243:           'CharacterSet': '1',",
          "244:         },",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "242:           'OutputDirectory': '<(DEPTH)\\\\build\\\\$(ConfigurationName)',",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "270:         'target_conditions': [",
          "271:           ['_toolset==\"host\"', {",
          "272:             'variables': {",
          "274:             },",
          "275:             'cflags': [ '<(m32flag)' ],",
          "276:             'ldflags': [ '<(m32flag)' ],",
          "",
          "[Removed Lines]",
          "273:               'm32flag': '<!((echo | $(echo ${CXX_host:-$(which g++)}) -m32 -E - > /dev/null 2>&1) && echo \"-m32\" || true)',",
          "",
          "[Added Lines]",
          "274:               'm32flag': '<!((echo | $(echo ${CXX_host:-$(which g++)}) -m32 -E - > /dev/null 2>&1) && echo -n \"-m32\" || true)',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "280:           }],",
          "281:           ['_toolset==\"target\"', {",
          "282:             'variables': {",
          "284:             },",
          "285:             'cflags': [ '<(m32flag)' ],",
          "286:             'ldflags': [ '<(m32flag)' ],",
          "",
          "[Removed Lines]",
          "283:               'm32flag': '<!((echo | $(echo ${CXX_target:-${CXX:-$(which g++)}}) -m32 -E - > /dev/null 2>&1) && echo \"-m32\" || true)',",
          "",
          "[Added Lines]",
          "284:               'm32flag': '<!((echo | $(echo ${CXX_target:-${CXX:-$(which g++)}}) -m32 -E - > /dev/null 2>&1) && echo -n \"-m32\" || true)',",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "323:         },",
          "324:         'conditions': [",
          "325:           ['OS==\"linux\" or OS==\"freebsd\" or OS==\"openbsd\" or OS==\"netbsd\"', {",
          "327:                         '-Wnon-virtual-dtor', '-Woverloaded-virtual' ],",
          "328:           }],",
          "329:         ],",
          "",
          "[Removed Lines]",
          "326:             'cflags': [ '-Wno-unused-parameter',",
          "",
          "[Added Lines]",
          "327:             'cflags': [ '-Wall', '<(werror)', '-W', '-Wno-unused-parameter',",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "332:         'conditions': [",
          "333:           ['OS==\"linux\" or OS==\"freebsd\" or OS==\"openbsd\" or OS==\"netbsd\" \\",
          "334:             or OS==\"android\"', {",
          "335:             'cflags': [",
          "336:               '-fdata-sections',",
          "337:               '-ffunction-sections',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "336:             'cflags!': [",
          "337:               '-O2',",
          "338:               '-Os',",
          "339:             ],",
          "",
          "---------------"
        ],
        "deps/v8/src/code-stubs.cc||deps/v8/src/code-stubs.cc": [
          "File: deps/v8/src/code-stubs.cc -> deps/v8/src/code-stubs.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "172:   Isolate* isolate = new_object->GetIsolate();",
          "173:   Factory* factory = isolate->factory();",
          "174:   return Map::UpdateCodeCache(known_map_,",
          "176:                               new_object);",
          "177: }",
          "",
          "[Removed Lines]",
          "175:                               factory->compare_ic_symbol(),",
          "",
          "[Added Lines]",
          "175:                               strict() ?",
          "176:                                   factory->strict_compare_ic_symbol() :",
          "177:                                   factory->compare_ic_symbol(),",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "183:   Code::Flags flags = Code::ComputeFlags(",
          "184:       static_cast<Code::Kind>(GetCodeKind()),",
          "185:       UNINITIALIZED);",
          "186:   Handle<Object> probe(",
          "188:   if (probe->IsCode()) {",
          "190:     return true;",
          "191:   }",
          "192:   return false;",
          "",
          "[Removed Lines]",
          "187:       known_map_->FindInCodeCache(*factory->compare_ic_symbol(), flags));",
          "",
          "[Added Lines]",
          "188:   ASSERT(op_ == Token::EQ || op_ == Token::EQ_STRICT);",
          "190:       known_map_->FindInCodeCache(",
          "191:         strict() ?",
          "194:         flags));",
          "197:     ASSERT(op_ == (*code_out)->compare_operation());",
          "",
          "---------------"
        ],
        "deps/v8/src/heap.h||deps/v8/src/heap.h": [
          "File: deps/v8/src/heap.h -> deps/v8/src/heap.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "240:   V(use_strict, \"use strict\")                                            \\",
          "241:   V(dot_symbol, \".\")                                                     \\",
          "242:   V(anonymous_function_symbol, \"(anonymous function)\")                   \\",
          "244:   V(infinity_symbol, \"Infinity\")                                         \\",
          "245:   V(minus_infinity_symbol, \"-Infinity\")                                  \\",
          "246:   V(hidden_stack_trace_symbol, \"v8::hidden_stack_trace\")                 \\",
          "",
          "[Removed Lines]",
          "243:   V(compare_ic_symbol, \".compare_ic\")                                    \\",
          "",
          "[Added Lines]",
          "243:   V(compare_ic_symbol, \"==\")                                             \\",
          "244:   V(strict_compare_ic_symbol, \"===\")                                     \\",
          "",
          "---------------"
        ],
        "deps/v8/src/version.cc||deps/v8/src/version.cc": [
          "File: deps/v8/src/version.cc -> deps/v8/src/version.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "35: #define MAJOR_VERSION     3",
          "36: #define MINOR_VERSION     11",
          "37: #define BUILD_NUMBER      10",
          "41: #define IS_CANDIDATE_VERSION 0",
          "",
          "[Removed Lines]",
          "38: #define PATCH_LEVEL       18",
          "",
          "[Added Lines]",
          "38: #define PATCH_LEVEL       19",
          "",
          "---------------"
        ],
        "deps/v8/test/mjsunit/regress/regress-2291.js||deps/v8/test/mjsunit/regress/regress-2291.js": [
          "File: deps/v8/test/mjsunit/regress/regress-2291.js -> deps/v8/test/mjsunit/regress/regress-2291.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "28: function StrictCompare(x) { return x === Object(x); }",
          "30: var obj = new Object();",
          "31: var obj2 = new Object();",
          "32: obj == obj;  // Populate IC cache with non-strict comparison.",
          "34: StrictCompare(obj);  // Set IC in StrictCompare from IC cache.",
          "36: assertFalse(StrictCompare('foo'));  // Use == stub for === operation.",
          "",
          "---------------"
        ],
        "deps/v8/tools/gyp/v8.gyp||deps/v8/tools/gyp/v8.gyp": [
          "File: deps/v8/tools/gyp/v8.gyp -> deps/v8/tools/gyp/v8.gyp",
          "--- Hunk 1 ---",
          "[Context before]",
          "721:                 '../../src/win32-math.h',",
          "722:               ],",
          "723:               'msvs_disabled_warnings': [4351, 4355, 4800],",
          "727:               'link_settings':  {",
          "728:                 'libraries': [ '-lwinmm.lib', '-lws2_32.lib' ],",
          "729:               },",
          "",
          "[Removed Lines]",
          "724:               'direct_dependent_settings': {",
          "725:                 'msvs_disabled_warnings': [4351, 4355, 4800],",
          "726:               },",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5e8c2b0768f32051457cb6cb7e068722e4348fa4",
      "candidate_info": {
        "commit_hash": "5e8c2b0768f32051457cb6cb7e068722e4348fa4",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/5e8c2b0768f32051457cb6cb7e068722e4348fa4",
        "files": [
          "src/node.cc"
        ],
        "message": "debugger: use v8 api to wait for a connection\n\nUse v8::Debug::EnableAgent(_, _, true) to wait for incoming\ndebugger-client connection before emitting any break (or other) events.\n\nThis commit should fix test/simple/test-debugger-repl faults.",
        "before_after_code_files": [
          "src/node.cc||src/node.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/node.cc||src/node.cc": [
          "File: src/node.cc -> src/node.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "2390:   node_isolate->Enter();",
          "2404:   assert(r);",
          "",
          "[Removed Lines]",
          "2393:   bool r = v8::Debug::EnableAgent(\"node \" NODE_VERSION, debug_port);",
          "2395:   if (wait_connect) {",
          "2400:     v8::Debug::SetMessageHandler2(node::DebugBreakMessageHandler);",
          "2401:   }",
          "",
          "[Added Lines]",
          "2393:   bool r = v8::Debug::EnableAgent(\"node \" NODE_VERSION,",
          "2394:                                   debug_port,",
          "2395:                                   wait_connect);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "05b3f88064a3dc85f892d0ff07dbca4f90437809",
      "candidate_info": {
        "commit_hash": "05b3f88064a3dc85f892d0ff07dbca4f90437809",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/05b3f88064a3dc85f892d0ff07dbca4f90437809",
        "files": [
          "test/simple/test-regress-GH-1697.js"
        ],
        "message": "test: use common.PORT in simple/test-regress-GH-1697",
        "before_after_code_files": [
          "test/simple/test-regress-GH-1697.js||test/simple/test-regress-GH-1697.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/simple/test-regress-GH-1697.js||test/simple/test-regress-GH-1697.js": [
          "File: test/simple/test-regress-GH-1697.js -> test/simple/test-regress-GH-1697.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:     });",
          "38:   });",
          "41:     console.log('Server running.');",
          "42:   });",
          "",
          "[Removed Lines]",
          "40:   server.listen(1234, '127.0.0.1', function() {",
          "",
          "[Added Lines]",
          "40:   server.listen(common.PORT, '127.0.0.1', function() {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "49:   serverProcess.stderr.pipe(process.stdout);",
          "51:   serverProcess.stdout.once('data', function() {",
          "53:     client.on('connect', function() {",
          "54:       var alot = new Buffer(1024),",
          "55:           alittle = new Buffer(1);",
          "",
          "[Removed Lines]",
          "52:     var client = net.createConnection(1234, '127.0.0.1');",
          "",
          "[Added Lines]",
          "52:     var client = net.createConnection(common.PORT, '127.0.0.1');",
          "",
          "---------------"
        ]
      }
    }
  ]
}