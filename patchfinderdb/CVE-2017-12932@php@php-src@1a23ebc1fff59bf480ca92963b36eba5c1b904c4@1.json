{
  "cve_id": "CVE-2017-12932",
  "cve_desc": "ext/standard/var_unserializer.re in PHP 7.0.x through 7.0.22 and 7.1.x through 7.1.8 is prone to a heap use after free while unserializing untrusted data, related to improper use of the hash API for key deletion in a situation with an invalid array size. Exploitation of this issue can have an unspecified impact on the integrity of PHP.",
  "repo": "php/php-src",
  "patch_hash": "1a23ebc1fff59bf480ca92963b36eba5c1b904c4",
  "patch_info": {
    "commit_hash": "1a23ebc1fff59bf480ca92963b36eba5c1b904c4",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/1a23ebc1fff59bf480ca92963b36eba5c1b904c4",
    "files": [
      "NEWS",
      "ext/standard/tests/serialize/bug74103.phpt",
      "ext/standard/tests/serialize/bug75054.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fixed bug #74103 and bug #75054\n\nDirectly fail unserialization when trying to acquire an r/R\nreference to an UNDEF HT slot. Previously this left an UNDEF and\nlater deleted the index/key from the HT.\n\nWhat actually caused the issue here is a combination of two\nfactors: First, the key deletion was performed using the hash API,\nrather than the symtable API, such that the element was not actually\nremoved if it used an integral string key. Second, a subsequent\ndeletion operation, while collecting trailing UNDEF ranges, would\nmark the element as available for reuse (leaving a corrupted HT\nstate with nNumOfElemnts > nNumUsed).\n\nFix this by failing early and dropping the deletion code.",
    "before_after_code_files": [
      "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt",
      "ext/standard/tests/serialize/bug75054.phpt||ext/standard/tests/serialize/bug75054.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt": [
      "File: ext/standard/tests/serialize/bug74103.phpt -> ext/standard/tests/serialize/bug74103.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #74103: heap-use-after-free when unserializing invalid array size",
      "3: --FILE--",
      "4: <?php",
      "5: var_dump(unserialize('a:7:{i:0;i:04;s:1:\"a\";i:2;i:00009617006;i:4;s:1:\"a\";i:4;s:1:\"a\";R:5;s:1:\"7\";R:3;s:1:\"a\";R:5;;s:18;}}'));",
      "6: ?>",
      "7: --EXPECTF--",
      "8: Notice: unserialize(): Error at offset 68 of 100 bytes in %s on line %d",
      "9: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/tests/serialize/bug75054.phpt||ext/standard/tests/serialize/bug75054.phpt": [
      "File: ext/standard/tests/serialize/bug75054.phpt -> ext/standard/tests/serialize/bug75054.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #75054: A Denial of Service Vulnerability was found when performing deserialization",
      "3: --FILE--",
      "4: <?php",
      "5: $poc = 'a:9:{i:0;s:4:\"0000\";i:0;s:4:\"0000\";i:0;R:2;s:4:\"5003\";R:2;s:4:\"0000\";R:2;s:4:\"0000\";R:2;s:4:\"';",
      "6: $poc .= \"\\x06\";",
      "7: $poc .= '000\";R:2;s:4:\"0000\";d:0;s:4:\"0000\";a:9:{s:4:\"0000\";';",
      "8: var_dump(unserialize($poc));",
      "9: ?>",
      "10: --EXPECTF--",
      "11: Notice: unserialize(): Error at offset 43 of 145 bytes in %s on line %d",
      "12: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "405:    return 0;",
      "406:   }",
      "418:   zval_dtor(&key);",
      "420:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
      "",
      "[Removed Lines]",
      "408:   if (UNEXPECTED(Z_ISUNDEF_P(data))) {",
      "409:    if (Z_TYPE(key) == IS_LONG) {",
      "410:     zend_hash_index_del(ht, Z_LVAL(key));",
      "411:    } else {",
      "412:     zend_hash_del_ind(ht, Z_STR(key));",
      "413:    }",
      "414:   } else {",
      "415:    var_push_dtor(var_hash, data);",
      "416:   }",
      "",
      "[Added Lines]",
      "408:   var_push_dtor(var_hash, data);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "581:  start = cursor;",
      "585: {",
      "586:  YYCTYPE yych;",
      "587:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "584: #line 585 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "575: #line 576 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "622:  yych = *YYCURSOR;",
      "623:  switch (yych) {",
      "624:  case 'C':",
      "626:  case 'N': goto yy5;",
      "633:  case 'o': goto yy12;",
      "638:  }",
      "639: yy2:",
      "642: yy3:",
      "644:  { return 0; }",
      "646: yy4:",
      "647:  yych = *(YYMARKER = ++YYCURSOR);",
      "649:  goto yy3;",
      "650: yy5:",
      "651:  yych = *++YYCURSOR;",
      "653:  goto yy3;",
      "654: yy6:",
      "655:  yych = *(YYMARKER = ++YYCURSOR);",
      "657:  goto yy3;",
      "658: yy7:",
      "659:  yych = *(YYMARKER = ++YYCURSOR);",
      "661:  goto yy3;",
      "662: yy8:",
      "663:  yych = *(YYMARKER = ++YYCURSOR);",
      "665:  goto yy3;",
      "666: yy9:",
      "667:  yych = *(YYMARKER = ++YYCURSOR);",
      "669:  goto yy3;",
      "670: yy10:",
      "671:  yych = *(YYMARKER = ++YYCURSOR);",
      "673:  goto yy3;",
      "674: yy11:",
      "675:  yych = *(YYMARKER = ++YYCURSOR);",
      "677:  goto yy3;",
      "678: yy12:",
      "679:  yych = *(YYMARKER = ++YYCURSOR);",
      "681:  goto yy3;",
      "682: yy13:",
      "683:  yych = *(YYMARKER = ++YYCURSOR);",
      "685:  goto yy3;",
      "686: yy14:",
      "687:  ++YYCURSOR;",
      "689:  {",
      "691:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
      "693: }",
      "698: yy17:",
      "699:  yych = *++YYCURSOR;",
      "700:  if (yybm[0+yych] & 128) {",
      "702:  }",
      "704: yy18:",
      "705:  YYCURSOR = YYMARKER;",
      "706:  goto yy3;",
      "707: yy19:",
      "708:  yych = *++YYCURSOR;",
      "711:  }",
      "712:  goto yy18;",
      "720:  if (yych <= '/') goto yy18;",
      "722:  yych = *++YYCURSOR;",
      "841:   }",
      "858:   }",
      "861:  }",
      "868:  }",
      "872:  }",
      "879:  yych = *++YYCURSOR;",
      "880:  if (yych <= ',') {",
      "882:  } else {",
      "884:   if (yych <= '/') goto yy18;",
      "886:   goto yy18;",
      "887:  }",
      "889:  yych = *++YYCURSOR;",
      "890:  if (yych <= '/') goto yy18;",
      "893:  ++YYCURSOR;",
      "894:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
      "895:  yych = *YYCURSOR;",
      "896:  if (yych <= '/') goto yy18;",
      "899:  yych = *++YYCURSOR;",
      "901:  ++YYCURSOR;",
      "917:  if (yych <= '/') goto yy18;",
      "918:  if (yych <= '9') goto yy34;",
      "919:  goto yy18;",
      "921:  yych = *++YYCURSOR;",
      "922:  if (yych <= '/') goto yy18;",
      "923:  if (yych >= ':') goto yy18;",
      "925:  ++YYCURSOR;",
      "926:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
      "927:  yych = *YYCURSOR;",
      "928:  if (yych <= '/') goto yy18;",
      "931:  yych = *++YYCURSOR;",
      "933:  ++YYCURSOR;",
      "950:  }",
      "954:  }",
      "960:  yych = *++YYCURSOR;",
      "962:  if (yych <= '/') goto yy18;",
      "964:  goto yy18;",
      "966:  yych = *++YYCURSOR;",
      "967:  if (yych <= '/') goto yy18;",
      "968:  if (yych >= ':') goto yy18;",
      "970:  ++YYCURSOR;",
      "971:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
      "972:  yych = *YYCURSOR;",
      "973:  if (yych <= '/') goto yy18;",
      "976:  yych = *++YYCURSOR;",
      "978:  ++YYCURSOR;",
      "1017:  if (yych <= '/') goto yy18;",
      "1019:  goto yy18;",
      "1021:  yych = *++YYCURSOR;",
      "1022:  if (yych <= '/') goto yy18;",
      "1023:  if (yych >= ':') goto yy18;",
      "1025:  ++YYCURSOR;",
      "1026:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
      "1027:  yych = *YYCURSOR;",
      "1028:  if (yych <= '/') goto yy18;",
      "1031:  yych = *++YYCURSOR;",
      "1033:  ++YYCURSOR;",
      "1035:  {",
      "1052:   return 0;",
      "1053:  }",
      "1057:   return 0;",
      "1058:  }",
      "1064:  return 1;",
      "1065: }",
      "1087:  yych = *++YYCURSOR;",
      "1089:  goto yy18;",
      "1100:  yych = *++YYCURSOR;",
      "1102:  goto yy18;",
      "1109:  ++YYCURSOR;",
      "1136:  ++YYCURSOR;",
      "1137:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
      "1138:  yych = *YYCURSOR;",
      "1139:  if (yych <= ';') {",
      "1140:   if (yych <= '/') goto yy18;",
      "1142:   if (yych <= ':') goto yy18;",
      "1143:  } else {",
      "1144:   if (yych <= 'E') {",
      "1145:    if (yych <= 'D') goto yy18;",
      "1147:   } else {",
      "1149:    goto yy18;",
      "1150:   }",
      "1151:  }",
      "1153:  ++YYCURSOR;",
      "1155:  {",
      "1156: #if SIZEOF_ZEND_LONG == 4",
      "1157: use_double:",
      "",
      "[Removed Lines]",
      "625:  case 'O': goto yy13;",
      "627:  case 'R': goto yy2;",
      "628:  case 'S': goto yy10;",
      "629:  case 'a': goto yy11;",
      "630:  case 'b': goto yy6;",
      "631:  case 'd': goto yy8;",
      "632:  case 'i': goto yy7;",
      "634:  case 'r': goto yy4;",
      "635:  case 's': goto yy9;",
      "636:  case '}': goto yy14;",
      "637:  default: goto yy16;",
      "640:  yych = *(YYMARKER = ++YYCURSOR);",
      "641:  if (yych == ':') goto yy95;",
      "643: #line 962 \"ext/standard/var_unserializer.re\"",
      "645: #line 646 \"ext/standard/var_unserializer.c\"",
      "648:  if (yych == ':') goto yy89;",
      "652:  if (yych == ';') goto yy87;",
      "656:  if (yych == ':') goto yy83;",
      "660:  if (yych == ':') goto yy77;",
      "664:  if (yych == ':') goto yy53;",
      "668:  if (yych == ':') goto yy46;",
      "672:  if (yych == ':') goto yy39;",
      "676:  if (yych == ':') goto yy32;",
      "680:  if (yych == ':') goto yy25;",
      "684:  if (yych == ':') goto yy17;",
      "688: #line 956 \"ext/standard/var_unserializer.re\"",
      "694: #line 695 \"ext/standard/var_unserializer.c\"",
      "695: yy16:",
      "696:  yych = *++YYCURSOR;",
      "697:  goto yy3;",
      "701:   goto yy20;",
      "703:  if (yych == '+') goto yy19;",
      "709:  if (yybm[0+yych] & 128) {",
      "710:   goto yy20;",
      "713: yy20:",
      "714:  ++YYCURSOR;",
      "715:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
      "716:  yych = *YYCURSOR;",
      "717:  if (yybm[0+yych] & 128) {",
      "718:   goto yy20;",
      "719:  }",
      "721:  if (yych >= ';') goto yy18;",
      "723:  if (yych != '\"') goto yy18;",
      "724:  ++YYCURSOR;",
      "725: #line 804 \"ext/standard/var_unserializer.re\"",
      "726:  {",
      "727:  size_t len, len2, len3, maxlen;",
      "728:  zend_long elements;",
      "729:  char *str;",
      "730:  zend_string *class_name;",
      "731:  zend_class_entry *ce;",
      "732:  int incomplete_class = 0;",
      "734:  int custom_object = 0;",
      "736:  zval user_func;",
      "737:  zval retval;",
      "738:  zval args[1];",
      "740:     if (!var_hash) return 0;",
      "741:  if (*start == 'C') {",
      "742:   custom_object = 1;",
      "743:  }",
      "745:  len2 = len = parse_uiv(start + 2);",
      "746:  maxlen = max - YYCURSOR;",
      "747:  if (maxlen < len || len == 0) {",
      "749:   return 0;",
      "750:  }",
      "752:  str = (char*)YYCURSOR;",
      "754:  YYCURSOR += len;",
      "756:  if (*(YYCURSOR) != '\"') {",
      "758:   return 0;",
      "759:  }",
      "760:  if (*(YYCURSOR+1) != ':') {",
      "762:   return 0;",
      "763:  }",
      "765:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
      "766:  if (len3 != len)",
      "767:  {",
      "769:   return 0;",
      "770:  }",
      "772:  class_name = zend_string_init(str, len, 0);",
      "774:  do {",
      "775:   if(!unserialize_allowed_class(class_name, classes)) {",
      "776:    incomplete_class = 1;",
      "777:    ce = PHP_IC_ENTRY;",
      "778:    break;",
      "779:   }",
      "782:   BG(serialize_lock)++;",
      "783:   ce = zend_lookup_class(class_name);",
      "784:   if (ce) {",
      "785:    BG(serialize_lock)--;",
      "786:    if (EG(exception)) {",
      "787:     zend_string_release(class_name);",
      "788:     return 0;",
      "789:    }",
      "790:    break;",
      "791:   }",
      "792:   BG(serialize_lock)--;",
      "794:   if (EG(exception)) {",
      "795:    zend_string_release(class_name);",
      "796:    return 0;",
      "797:   }",
      "800:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
      "801:    incomplete_class = 1;",
      "802:    ce = PHP_IC_ENTRY;",
      "803:    break;",
      "804:   }",
      "807:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
      "809:   ZVAL_STR_COPY(&args[0], class_name);",
      "810:   BG(serialize_lock)++;",
      "811:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
      "812:    BG(serialize_lock)--;",
      "813:    if (EG(exception)) {",
      "814:     zend_string_release(class_name);",
      "815:     zval_ptr_dtor(&user_func);",
      "816:     zval_ptr_dtor(&args[0]);",
      "817:     return 0;",
      "818:    }",
      "819:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
      "820:    incomplete_class = 1;",
      "821:    ce = PHP_IC_ENTRY;",
      "822:    zval_ptr_dtor(&user_func);",
      "823:    zval_ptr_dtor(&args[0]);",
      "824:    break;",
      "825:   }",
      "826:   BG(serialize_lock)--;",
      "827:   zval_ptr_dtor(&retval);",
      "828:   if (EG(exception)) {",
      "829:    zend_string_release(class_name);",
      "830:    zval_ptr_dtor(&user_func);",
      "831:    zval_ptr_dtor(&args[0]);",
      "832:    return 0;",
      "833:   }",
      "836:   BG(serialize_lock)++;",
      "837:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
      "838:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
      "839:    incomplete_class = 1;",
      "840:    ce = PHP_IC_ENTRY;",
      "842:   BG(serialize_lock)--;",
      "844:   zval_ptr_dtor(&user_func);",
      "845:   zval_ptr_dtor(&args[0]);",
      "846:   break;",
      "847:  } while (1);",
      "851:  if (custom_object) {",
      "852:   int ret;",
      "854:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
      "856:   if (ret && incomplete_class) {",
      "857:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
      "859:   zend_string_release(class_name);",
      "860:   return ret;",
      "863:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "865:  if (elements < 0) {",
      "866:     zend_string_release(class_name);",
      "867:     return 0;",
      "870:  if (incomplete_class) {",
      "871:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
      "873:  zend_string_release(class_name);",
      "875:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "876: }",
      "877: #line 878 \"ext/standard/var_unserializer.c\"",
      "878: yy25:",
      "881:   if (yych != '+') goto yy18;",
      "883:   if (yych <= '-') goto yy26;",
      "885:   if (yych <= '9') goto yy27;",
      "888: yy26:",
      "891:  if (yych >= ':') goto yy18;",
      "892: yy27:",
      "897:  if (yych <= '9') goto yy27;",
      "898:  if (yych >= ';') goto yy18;",
      "900:  if (yych != '\"') goto yy18;",
      "902: #line 793 \"ext/standard/var_unserializer.re\"",
      "903:  {",
      "904:  zend_long elements;",
      "905:     if (!var_hash) return 0;",
      "907:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "908:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
      "909:   return 0;",
      "910:  }",
      "911:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "912: }",
      "913: #line 914 \"ext/standard/var_unserializer.c\"",
      "914: yy32:",
      "915:  yych = *++YYCURSOR;",
      "916:  if (yych == '+') goto yy33;",
      "920: yy33:",
      "924: yy34:",
      "929:  if (yych <= '9') goto yy34;",
      "930:  if (yych >= ';') goto yy18;",
      "932:  if (yych != '{') goto yy18;",
      "934: #line 769 \"ext/standard/var_unserializer.re\"",
      "935:  {",
      "936:  zend_long elements = parse_iv(start + 2);",
      "939:     if (!var_hash) return 0;",
      "941:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
      "942:   return 0;",
      "943:  }",
      "945:  array_init_size(rval, elements);",
      "946:  if (elements) {",
      "949:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
      "952:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
      "953:   return 0;",
      "956:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "957: }",
      "958: #line 959 \"ext/standard/var_unserializer.c\"",
      "959: yy39:",
      "961:  if (yych == '+') goto yy40;",
      "963:  if (yych <= '9') goto yy41;",
      "965: yy40:",
      "969: yy41:",
      "974:  if (yych <= '9') goto yy41;",
      "975:  if (yych >= ';') goto yy18;",
      "977:  if (yych != '\"') goto yy18;",
      "979: #line 735 \"ext/standard/var_unserializer.re\"",
      "980:  {",
      "981:  size_t len, maxlen;",
      "982:  zend_string *str;",
      "984:  len = parse_uiv(start + 2);",
      "985:  maxlen = max - YYCURSOR;",
      "986:  if (maxlen < len) {",
      "988:   return 0;",
      "989:  }",
      "991:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
      "992:   return 0;",
      "993:  }",
      "995:  if (*(YYCURSOR) != '\"') {",
      "996:   zend_string_free(str);",
      "998:   return 0;",
      "999:  }",
      "1001:  if (*(YYCURSOR + 1) != ';') {",
      "1002:   efree(str);",
      "1004:   return 0;",
      "1005:  }",
      "1007:  YYCURSOR += 2;",
      "1010:  ZVAL_STR(rval, str);",
      "1011:  return 1;",
      "1012: }",
      "1013: #line 1014 \"ext/standard/var_unserializer.c\"",
      "1014: yy46:",
      "1015:  yych = *++YYCURSOR;",
      "1016:  if (yych == '+') goto yy47;",
      "1018:  if (yych <= '9') goto yy48;",
      "1020: yy47:",
      "1024: yy48:",
      "1029:  if (yych <= '9') goto yy48;",
      "1030:  if (yych >= ';') goto yy18;",
      "1032:  if (yych != '\"') goto yy18;",
      "1034: #line 703 \"ext/standard/var_unserializer.re\"",
      "1036:  size_t len, maxlen;",
      "1037:  char *str;",
      "1039:  len = parse_uiv(start + 2);",
      "1040:  maxlen = max - YYCURSOR;",
      "1041:  if (maxlen < len) {",
      "1043:   return 0;",
      "1044:  }",
      "1046:  str = (char*)YYCURSOR;",
      "1048:  YYCURSOR += len;",
      "1050:  if (*(YYCURSOR) != '\"') {",
      "1055:  if (*(YYCURSOR + 1) != ';') {",
      "1060:  YYCURSOR += 2;",
      "1063:  ZVAL_STRINGL(rval, str, len);",
      "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
      "1067: yy53:",
      "1068:  yych = *++YYCURSOR;",
      "1069:  if (yych <= '/') {",
      "1070:   if (yych <= ',') {",
      "1071:    if (yych == '+') goto yy57;",
      "1072:    goto yy18;",
      "1073:   } else {",
      "1074:    if (yych <= '-') goto yy55;",
      "1075:    if (yych <= '.') goto yy60;",
      "1076:    goto yy18;",
      "1077:   }",
      "1078:  } else {",
      "1079:   if (yych <= 'I') {",
      "1080:    if (yych <= '9') goto yy58;",
      "1081:    if (yych <= 'H') goto yy18;",
      "1082:    goto yy56;",
      "1083:   } else {",
      "1084:    if (yych != 'N') goto yy18;",
      "1085:   }",
      "1086:  }",
      "1088:  if (yych == 'A') goto yy76;",
      "1090: yy55:",
      "1091:  yych = *++YYCURSOR;",
      "1092:  if (yych <= '/') {",
      "1093:   if (yych == '.') goto yy60;",
      "1094:   goto yy18;",
      "1095:  } else {",
      "1096:   if (yych <= '9') goto yy58;",
      "1097:   if (yych != 'I') goto yy18;",
      "1098:  }",
      "1099: yy56:",
      "1101:  if (yych == 'N') goto yy72;",
      "1103: yy57:",
      "1104:  yych = *++YYCURSOR;",
      "1105:  if (yych == '.') goto yy60;",
      "1106:  if (yych <= '/') goto yy18;",
      "1107:  if (yych >= ':') goto yy18;",
      "1108: yy58:",
      "1110:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
      "1111:  yych = *YYCURSOR;",
      "1112:  if (yych <= ':') {",
      "1113:   if (yych <= '.') {",
      "1114:    if (yych <= '-') goto yy18;",
      "1115:    goto yy70;",
      "1116:   } else {",
      "1117:    if (yych <= '/') goto yy18;",
      "1118:    if (yych <= '9') goto yy58;",
      "1119:    goto yy18;",
      "1120:   }",
      "1121:  } else {",
      "1122:   if (yych <= 'E') {",
      "1123:    if (yych <= ';') goto yy63;",
      "1124:    if (yych <= 'D') goto yy18;",
      "1125:    goto yy65;",
      "1126:   } else {",
      "1127:    if (yych == 'e') goto yy65;",
      "1128:    goto yy18;",
      "1129:   }",
      "1130:  }",
      "1131: yy60:",
      "1132:  yych = *++YYCURSOR;",
      "1133:  if (yych <= '/') goto yy18;",
      "1134:  if (yych >= ':') goto yy18;",
      "1135: yy61:",
      "1141:   if (yych <= '9') goto yy61;",
      "1146:    goto yy65;",
      "1148:    if (yych == 'e') goto yy65;",
      "1152: yy63:",
      "1154: #line 694 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "616:  case 'O': goto yy4;",
      "618:  case 'R': goto yy6;",
      "619:  case 'S': goto yy7;",
      "620:  case 'a': goto yy8;",
      "621:  case 'b': goto yy9;",
      "622:  case 'd': goto yy10;",
      "623:  case 'i': goto yy11;",
      "625:  case 'r': goto yy13;",
      "626:  case 's': goto yy14;",
      "627:  case '}': goto yy15;",
      "628:  default: goto yy2;",
      "631:  ++YYCURSOR;",
      "633: #line 951 \"ext/standard/var_unserializer.re\"",
      "635: #line 636 \"ext/standard/var_unserializer.c\"",
      "638:  if (yych == ':') goto yy17;",
      "642:  if (yych == ';') goto yy19;",
      "646:  if (yych == ':') goto yy21;",
      "650:  if (yych == ':') goto yy22;",
      "654:  if (yych == ':') goto yy23;",
      "658:  if (yych == ':') goto yy24;",
      "662:  if (yych == ':') goto yy25;",
      "666:  if (yych == ':') goto yy26;",
      "670:  if (yych == ':') goto yy27;",
      "674:  if (yych == ':') goto yy28;",
      "677:  yych = *(YYMARKER = ++YYCURSOR);",
      "678:  if (yych == ':') goto yy29;",
      "679:  goto yy3;",
      "680: yy15:",
      "682: #line 945 \"ext/standard/var_unserializer.re\"",
      "688: #line 689 \"ext/standard/var_unserializer.c\"",
      "692:   goto yy31;",
      "694:  if (yych == '+') goto yy30;",
      "699:  ++YYCURSOR;",
      "700: #line 629 \"ext/standard/var_unserializer.re\"",
      "701:  {",
      "703:  ZVAL_NULL(rval);",
      "704:  return 1;",
      "705: }",
      "706: #line 707 \"ext/standard/var_unserializer.c\"",
      "707: yy21:",
      "709:  if (yych <= ',') {",
      "710:   if (yych == '+') goto yy33;",
      "711:   goto yy18;",
      "712:  } else {",
      "713:   if (yych <= '-') goto yy33;",
      "714:   if (yych <= '/') goto yy18;",
      "715:   if (yych <= '9') goto yy34;",
      "716:   goto yy18;",
      "718: yy22:",
      "719:  yych = *++YYCURSOR;",
      "720:  if (yych == '+') goto yy36;",
      "721:  if (yych <= '/') goto yy18;",
      "722:  if (yych <= '9') goto yy37;",
      "724: yy23:",
      "725:  yych = *++YYCURSOR;",
      "726:  if (yych == '+') goto yy39;",
      "728:  if (yych <= '9') goto yy40;",
      "729:  goto yy18;",
      "730: yy24:",
      "732:  if (yych <= '/') goto yy18;",
      "733:  if (yych <= '1') goto yy42;",
      "734:  goto yy18;",
      "735: yy25:",
      "736:  yych = *++YYCURSOR;",
      "737:  if (yych <= '/') {",
      "738:   if (yych <= ',') {",
      "739:    if (yych == '+') goto yy43;",
      "740:    goto yy18;",
      "741:   } else {",
      "742:    if (yych <= '-') goto yy44;",
      "743:    if (yych <= '.') goto yy45;",
      "744:    goto yy18;",
      "746:  } else {",
      "747:   if (yych <= 'I') {",
      "748:    if (yych <= '9') goto yy46;",
      "749:    if (yych <= 'H') goto yy18;",
      "750:    goto yy48;",
      "751:   } else {",
      "752:    if (yych == 'N') goto yy49;",
      "753:    goto yy18;",
      "756: yy26:",
      "757:  yych = *++YYCURSOR;",
      "758:  if (yych <= ',') {",
      "759:   if (yych == '+') goto yy50;",
      "760:   goto yy18;",
      "761:  } else {",
      "762:   if (yych <= '-') goto yy50;",
      "763:   if (yych <= '/') goto yy18;",
      "764:   if (yych <= '9') goto yy51;",
      "765:   goto yy18;",
      "767: yy27:",
      "768:  yych = *++YYCURSOR;",
      "769:  if (yych <= ',') {",
      "770:   if (yych == '+') goto yy53;",
      "771:   goto yy18;",
      "772:  } else {",
      "773:   if (yych <= '-') goto yy53;",
      "774:   if (yych <= '/') goto yy18;",
      "775:   if (yych <= '9') goto yy54;",
      "776:   goto yy18;",
      "778: yy28:",
      "781:   if (yych == '+') goto yy56;",
      "782:   goto yy18;",
      "784:   if (yych <= '-') goto yy56;",
      "786:   if (yych <= '9') goto yy57;",
      "789: yy29:",
      "791:  if (yych == '+') goto yy59;",
      "793:  if (yych <= '9') goto yy60;",
      "794:  goto yy18;",
      "795: yy30:",
      "796:  yych = *++YYCURSOR;",
      "797:  if (yybm[0+yych] & 128) {",
      "798:   goto yy31;",
      "799:  }",
      "800:  goto yy18;",
      "801: yy31:",
      "805:  if (yybm[0+yych] & 128) {",
      "806:   goto yy31;",
      "807:  }",
      "809:  if (yych <= ':') goto yy62;",
      "810:  goto yy18;",
      "811: yy33:",
      "813:  if (yych <= '/') goto yy18;",
      "814:  if (yych >= ':') goto yy18;",
      "815: yy34:",
      "817:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
      "818:  yych = *YYCURSOR;",
      "821:  if (yych == ';') goto yy63;",
      "823: yy36:",
      "827: yy37:",
      "832:  if (yych <= '9') goto yy37;",
      "833:  if (yych <= ':') goto yy65;",
      "834:  goto yy18;",
      "835: yy39:",
      "837:  if (yych <= '/') goto yy18;",
      "838:  if (yych >= ':') goto yy18;",
      "839: yy40:",
      "841:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
      "842:  yych = *YYCURSOR;",
      "843:  if (yych <= '/') goto yy18;",
      "844:  if (yych <= '9') goto yy40;",
      "845:  if (yych <= ':') goto yy66;",
      "846:  goto yy18;",
      "847: yy42:",
      "848:  yych = *++YYCURSOR;",
      "849:  if (yych == ';') goto yy67;",
      "850:  goto yy18;",
      "851: yy43:",
      "852:  yych = *++YYCURSOR;",
      "853:  if (yych == '.') goto yy45;",
      "854:  if (yych <= '/') goto yy18;",
      "855:  if (yych <= '9') goto yy46;",
      "856:  goto yy18;",
      "857: yy44:",
      "858:  yych = *++YYCURSOR;",
      "859:  if (yych <= '/') {",
      "860:   if (yych != '.') goto yy18;",
      "861:  } else {",
      "862:   if (yych <= '9') goto yy46;",
      "863:   if (yych == 'I') goto yy48;",
      "864:   goto yy18;",
      "866: yy45:",
      "867:  yych = *++YYCURSOR;",
      "868:  if (yych <= '/') goto yy18;",
      "869:  if (yych <= '9') goto yy69;",
      "870:  goto yy18;",
      "871: yy46:",
      "872:  ++YYCURSOR;",
      "873:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
      "874:  yych = *YYCURSOR;",
      "875:  if (yych <= ':') {",
      "876:   if (yych <= '.') {",
      "877:    if (yych <= '-') goto yy18;",
      "878:    goto yy69;",
      "879:   } else {",
      "880:    if (yych <= '/') goto yy18;",
      "881:    if (yych <= '9') goto yy46;",
      "882:    goto yy18;",
      "883:   }",
      "884:  } else {",
      "885:   if (yych <= 'E') {",
      "886:    if (yych <= ';') goto yy71;",
      "887:    if (yych <= 'D') goto yy18;",
      "888:    goto yy73;",
      "889:   } else {",
      "890:    if (yych == 'e') goto yy73;",
      "891:    goto yy18;",
      "892:   }",
      "894: yy48:",
      "895:  yych = *++YYCURSOR;",
      "896:  if (yych == 'N') goto yy74;",
      "897:  goto yy18;",
      "898: yy49:",
      "899:  yych = *++YYCURSOR;",
      "900:  if (yych == 'A') goto yy75;",
      "901:  goto yy18;",
      "902: yy50:",
      "905:  if (yych >= ':') goto yy18;",
      "906: yy51:",
      "907:  ++YYCURSOR;",
      "908:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
      "909:  yych = *YYCURSOR;",
      "910:  if (yych <= '/') goto yy18;",
      "911:  if (yych <= '9') goto yy51;",
      "912:  if (yych == ';') goto yy76;",
      "914: yy53:",
      "918: yy54:",
      "923:  if (yych <= '9') goto yy54;",
      "924:  if (yych <= ':') goto yy78;",
      "925:  goto yy18;",
      "926: yy56:",
      "928:  if (yych <= '/') goto yy18;",
      "929:  if (yych >= ':') goto yy18;",
      "930: yy57:",
      "932:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
      "933:  yych = *YYCURSOR;",
      "935:  if (yych <= '9') goto yy57;",
      "936:  if (yych == ';') goto yy79;",
      "938: yy59:",
      "942: yy60:",
      "947:  if (yych <= '9') goto yy60;",
      "948:  if (yych <= ':') goto yy81;",
      "949:  goto yy18;",
      "950: yy62:",
      "952:  if (yych == '\"') goto yy82;",
      "953:  goto yy18;",
      "954: yy63:",
      "956: #line 580 \"ext/standard/var_unserializer.re\"",
      "958:  zend_long id;",
      "961:  if (!var_hash) return 0;",
      "963:  id = parse_iv(start + 2) - 1;",
      "964:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
      "968:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
      "972:  if (Z_ISREF_P(rval_ref)) {",
      "973:   ZVAL_COPY(rval, rval_ref);",
      "974:  } else {",
      "975:   ZVAL_NEW_REF(rval_ref, rval_ref);",
      "976:   ZVAL_COPY(rval, rval_ref);",
      "977:  }",
      "981: #line 982 \"ext/standard/var_unserializer.c\"",
      "982: yy65:",
      "984:  if (yych == '\"') goto yy84;",
      "986: yy66:",
      "988:  if (yych == '{') goto yy86;",
      "990: yy67:",
      "992: #line 635 \"ext/standard/var_unserializer.re\"",
      "993:  {",
      "995:  ZVAL_BOOL(rval, parse_iv(start + 2));",
      "996:  return 1;",
      "997: }",
      "998: #line 999 \"ext/standard/var_unserializer.c\"",
      "999: yy69:",
      "1005:   if (yych <= '9') goto yy69;",
      "1010:    goto yy73;",
      "1012:    if (yych == 'e') goto yy73;",
      "1016: yy71:",
      "1018: #line 683 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1160:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
      "1161:  return 1;",
      "1162: }",
      "1165:  yych = *++YYCURSOR;",
      "1166:  if (yych <= ',') {",
      "1168:  } else {",
      "1170:   if (yych <= '/') goto yy18;",
      "1172:   goto yy18;",
      "1173:  }",
      "1175:  yych = *++YYCURSOR;",
      "1191:  goto yy18;",
      "1193:  yych = *++YYCURSOR;",
      "1196:  goto yy18;",
      "1198:  ++YYCURSOR;",
      "1210:   } else {",
      "1213:   }",
      "1214:  }",
      "1219:  yych = *++YYCURSOR;",
      "1221:  ++YYCURSOR;",
      "1223:  {",
      "1234:  }",
      "1236:  return 1;",
      "1237: }",
      "1240:  yych = *++YYCURSOR;",
      "1242:  goto yy18;",
      "1258:  ++YYCURSOR;",
      "1266:  {",
      "1272:  }",
      "1281:    }",
      "1284:   }",
      "1290: }",
      "1298:  ++YYCURSOR;",
      "1300:  {",
      "1303:  return 1;",
      "1304: }",
      "1307:  ++YYCURSOR;",
      "1309:  {",
      "1313: }",
      "1316:  yych = *++YYCURSOR;",
      "1317:  if (yych <= ',') {",
      "1319:  } else {",
      "1321:   if (yych <= '/') goto yy18;",
      "1324:  }",
      "1330:  ++YYCURSOR;",
      "1331:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
      "1332:  yych = *YYCURSOR;",
      "1333:  if (yych <= '/') goto yy18;",
      "1336:  ++YYCURSOR;",
      "1338:  {",
      "1346:   return 0;",
      "1347:  }",
      "1350:   return 0;",
      "1351:  }",
      "1356:  }",
      "1360:  return 1;",
      "1361: }",
      "1373: yy96:",
      "1374:  yych = *++YYCURSOR;",
      "1375:  if (yych <= '/') goto yy18;",
      "1377: yy97:",
      "1378:  ++YYCURSOR;",
      "1386:  {",
      "1404:  } else {",
      "1407:  }",
      "1409:  return 1;",
      "1410: }",
      "1412: }",
      "1416:  return 0;",
      "",
      "[Removed Lines]",
      "1163: #line 1164 \"ext/standard/var_unserializer.c\"",
      "1164: yy65:",
      "1167:   if (yych != '+') goto yy18;",
      "1169:   if (yych <= '-') goto yy66;",
      "1171:   if (yych <= '9') goto yy67;",
      "1174: yy66:",
      "1176:  if (yych <= ',') {",
      "1177:   if (yych == '+') goto yy69;",
      "1178:   goto yy18;",
      "1179:  } else {",
      "1180:   if (yych <= '-') goto yy69;",
      "1181:   if (yych <= '/') goto yy18;",
      "1182:   if (yych >= ':') goto yy18;",
      "1183:  }",
      "1184: yy67:",
      "1185:  ++YYCURSOR;",
      "1186:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
      "1187:  yych = *YYCURSOR;",
      "1188:  if (yych <= '/') goto yy18;",
      "1189:  if (yych <= '9') goto yy67;",
      "1190:  if (yych == ';') goto yy63;",
      "1192: yy69:",
      "1194:  if (yych <= '/') goto yy18;",
      "1195:  if (yych <= '9') goto yy67;",
      "1197: yy70:",
      "1199:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
      "1200:  yych = *YYCURSOR;",
      "1201:  if (yych <= ';') {",
      "1202:   if (yych <= '/') goto yy18;",
      "1203:   if (yych <= '9') goto yy70;",
      "1204:   if (yych <= ':') goto yy18;",
      "1205:   goto yy63;",
      "1206:  } else {",
      "1207:   if (yych <= 'E') {",
      "1208:    if (yych <= 'D') goto yy18;",
      "1209:    goto yy65;",
      "1211:    if (yych == 'e') goto yy65;",
      "1212:    goto yy18;",
      "1215: yy72:",
      "1216:  yych = *++YYCURSOR;",
      "1217:  if (yych != 'F') goto yy18;",
      "1218: yy73:",
      "1220:  if (yych != ';') goto yy18;",
      "1222: #line 678 \"ext/standard/var_unserializer.re\"",
      "1226:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
      "1227:   ZVAL_DOUBLE(rval, php_get_nan());",
      "1228:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
      "1229:   ZVAL_DOUBLE(rval, php_get_inf());",
      "1230:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
      "1231:   ZVAL_DOUBLE(rval, -php_get_inf());",
      "1232:  } else {",
      "1233:   ZVAL_NULL(rval);",
      "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
      "1239: yy76:",
      "1241:  if (yych == 'N') goto yy73;",
      "1243: yy77:",
      "1244:  yych = *++YYCURSOR;",
      "1245:  if (yych <= ',') {",
      "1246:   if (yych != '+') goto yy18;",
      "1247:  } else {",
      "1248:   if (yych <= '-') goto yy78;",
      "1249:   if (yych <= '/') goto yy18;",
      "1250:   if (yych <= '9') goto yy79;",
      "1251:   goto yy18;",
      "1252:  }",
      "1253: yy78:",
      "1254:  yych = *++YYCURSOR;",
      "1255:  if (yych <= '/') goto yy18;",
      "1256:  if (yych >= ':') goto yy18;",
      "1257: yy79:",
      "1259:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
      "1260:  yych = *YYCURSOR;",
      "1261:  if (yych <= '/') goto yy18;",
      "1262:  if (yych <= '9') goto yy79;",
      "1263:  if (yych != ';') goto yy18;",
      "1264:  ++YYCURSOR;",
      "1265: #line 652 \"ext/standard/var_unserializer.re\"",
      "1267: #if SIZEOF_ZEND_LONG == 4",
      "1268:  int digits = YYCURSOR - start - 3;",
      "1270:  if (start[2] == '-' || start[2] == '+') {",
      "1271:   digits--;",
      "1275:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
      "1276:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
      "1277:    int cmp = strncmp((char*)YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
      "1279:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
      "1280:     goto use_double;",
      "1282:   } else {",
      "1283:    goto use_double;",
      "1285:  }",
      "1286: #endif",
      "1288:  ZVAL_LONG(rval, parse_iv(start + 2));",
      "1289:  return 1;",
      "1291: #line 1292 \"ext/standard/var_unserializer.c\"",
      "1292: yy83:",
      "1293:  yych = *++YYCURSOR;",
      "1294:  if (yych <= '/') goto yy18;",
      "1295:  if (yych >= '2') goto yy18;",
      "1296:  yych = *++YYCURSOR;",
      "1297:  if (yych != ';') goto yy18;",
      "1299: #line 646 \"ext/standard/var_unserializer.re\"",
      "1302:  ZVAL_BOOL(rval, parse_iv(start + 2));",
      "1305: #line 1306 \"ext/standard/var_unserializer.c\"",
      "1306: yy87:",
      "1308: #line 640 \"ext/standard/var_unserializer.re\"",
      "1311:  ZVAL_NULL(rval);",
      "1312:  return 1;",
      "1314: #line 1315 \"ext/standard/var_unserializer.c\"",
      "1315: yy89:",
      "1318:   if (yych != '+') goto yy18;",
      "1320:   if (yych <= '-') goto yy90;",
      "1322:   if (yych <= '9') goto yy91;",
      "1323:   goto yy18;",
      "1325: yy90:",
      "1326:  yych = *++YYCURSOR;",
      "1327:  if (yych <= '/') goto yy18;",
      "1328:  if (yych >= ':') goto yy18;",
      "1329: yy91:",
      "1334:  if (yych <= '9') goto yy91;",
      "1335:  if (yych != ';') goto yy18;",
      "1337: #line 615 \"ext/standard/var_unserializer.re\"",
      "1339:  zend_long id;",
      "1342:  if (!var_hash) return 0;",
      "1344:  id = parse_iv(start + 2) - 1;",
      "1345:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
      "1349:  if (rval_ref == rval) {",
      "1353:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
      "1354:   ZVAL_UNDEF(rval);",
      "1355:   return 1;",
      "1358:  ZVAL_COPY(rval, rval_ref);",
      "1362: #line 1363 \"ext/standard/var_unserializer.c\"",
      "1363: yy95:",
      "1364:  yych = *++YYCURSOR;",
      "1365:  if (yych <= ',') {",
      "1366:   if (yych != '+') goto yy18;",
      "1367:  } else {",
      "1368:   if (yych <= '-') goto yy96;",
      "1369:   if (yych <= '/') goto yy18;",
      "1370:   if (yych <= '9') goto yy97;",
      "1371:   goto yy18;",
      "1372:  }",
      "1376:  if (yych >= ':') goto yy18;",
      "1379:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
      "1380:  yych = *YYCURSOR;",
      "1381:  if (yych <= '/') goto yy18;",
      "1382:  if (yych <= '9') goto yy97;",
      "1383:  if (yych != ';') goto yy18;",
      "1384:  ++YYCURSOR;",
      "1385: #line 589 \"ext/standard/var_unserializer.re\"",
      "1387:  zend_long id;",
      "1390:  if (!var_hash) return 0;",
      "1392:  id = parse_iv(start + 2) - 1;",
      "1393:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
      "1394:   return 0;",
      "1395:  }",
      "1397:  zval_ptr_dtor(rval);",
      "1398:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
      "1399:   ZVAL_UNDEF(rval);",
      "1400:   return 1;",
      "1401:  }",
      "1402:  if (Z_ISREF_P(rval_ref)) {",
      "1403:   ZVAL_COPY(rval, rval_ref);",
      "1405:   ZVAL_NEW_REF(rval_ref, rval_ref);",
      "1406:   ZVAL_COPY(rval, rval_ref);",
      "1411: #line 1412 \"ext/standard/var_unserializer.c\"",
      "1413: #line 964 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1027: #line 1028 \"ext/standard/var_unserializer.c\"",
      "1028: yy73:",
      "1031:   if (yych == '+') goto yy88;",
      "1032:   goto yy18;",
      "1034:   if (yych <= '-') goto yy88;",
      "1036:   if (yych <= '9') goto yy89;",
      "1039: yy74:",
      "1041:  if (yych == 'F') goto yy91;",
      "1043: yy75:",
      "1045:  if (yych == 'N') goto yy91;",
      "1047: yy76:",
      "1049: #line 641 \"ext/standard/var_unserializer.re\"",
      "1050:  {",
      "1051: #if SIZEOF_ZEND_LONG == 4",
      "1052:  int digits = YYCURSOR - start - 3;",
      "1054:  if (start[2] == '-' || start[2] == '+') {",
      "1055:   digits--;",
      "1056:  }",
      "1059:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
      "1060:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
      "1061:    int cmp = strncmp((char*)YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
      "1063:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
      "1064:     goto use_double;",
      "1065:    }",
      "1067:    goto use_double;",
      "1070: #endif",
      "1072:  ZVAL_LONG(rval, parse_iv(start + 2));",
      "1073:  return 1;",
      "1074: }",
      "1075: #line 1076 \"ext/standard/var_unserializer.c\"",
      "1076: yy78:",
      "1078:  if (yych == '\"') goto yy92;",
      "1079:  goto yy18;",
      "1080: yy79:",
      "1082: #line 605 \"ext/standard/var_unserializer.re\"",
      "1084:  zend_long id;",
      "1087:  if (!var_hash) return 0;",
      "1089:  id = parse_iv(start + 2) - 1;",
      "1090:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
      "1091:   return 0;",
      "1092:  }",
      "1094:  if (rval_ref == rval) {",
      "1095:   return 0;",
      "1098:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
      "1099:   return 0;",
      "1100:  }",
      "1102:  ZVAL_COPY(rval, rval_ref);",
      "1106: #line 1107 \"ext/standard/var_unserializer.c\"",
      "1107: yy81:",
      "1109:  if (yych == '\"') goto yy94;",
      "1111: yy82:",
      "1113: #line 793 \"ext/standard/var_unserializer.re\"",
      "1115:  size_t len, len2, len3, maxlen;",
      "1116:  zend_long elements;",
      "1117:  char *str;",
      "1118:  zend_string *class_name;",
      "1119:  zend_class_entry *ce;",
      "1120:  int incomplete_class = 0;",
      "1122:  int custom_object = 0;",
      "1124:  zval user_func;",
      "1125:  zval retval;",
      "1126:  zval args[1];",
      "1128:     if (!var_hash) return 0;",
      "1129:  if (*start == 'C') {",
      "1130:   custom_object = 1;",
      "1133:  len2 = len = parse_uiv(start + 2);",
      "1134:  maxlen = max - YYCURSOR;",
      "1135:  if (maxlen < len || len == 0) {",
      "1137:   return 0;",
      "1138:  }",
      "1140:  str = (char*)YYCURSOR;",
      "1142:  YYCURSOR += len;",
      "1144:  if (*(YYCURSOR) != '\"') {",
      "1146:   return 0;",
      "1147:  }",
      "1148:  if (*(YYCURSOR+1) != ':') {",
      "1150:   return 0;",
      "1151:  }",
      "1153:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
      "1154:  if (len3 != len)",
      "1155:  {",
      "1157:   return 0;",
      "1158:  }",
      "1160:  class_name = zend_string_init(str, len, 0);",
      "1162:  do {",
      "1163:   if(!unserialize_allowed_class(class_name, classes)) {",
      "1164:    incomplete_class = 1;",
      "1165:    ce = PHP_IC_ENTRY;",
      "1166:    break;",
      "1167:   }",
      "1170:   BG(serialize_lock)++;",
      "1171:   ce = zend_lookup_class(class_name);",
      "1172:   if (ce) {",
      "1173:    BG(serialize_lock)--;",
      "1174:    if (EG(exception)) {",
      "1175:     zend_string_release(class_name);",
      "1176:     return 0;",
      "1178:    break;",
      "1180:   BG(serialize_lock)--;",
      "1182:   if (EG(exception)) {",
      "1183:    zend_string_release(class_name);",
      "1184:    return 0;",
      "1185:   }",
      "1188:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
      "1189:    incomplete_class = 1;",
      "1190:    ce = PHP_IC_ENTRY;",
      "1191:    break;",
      "1192:   }",
      "1195:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
      "1197:   ZVAL_STR_COPY(&args[0], class_name);",
      "1198:   BG(serialize_lock)++;",
      "1199:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
      "1200:    BG(serialize_lock)--;",
      "1201:    if (EG(exception)) {",
      "1202:     zend_string_release(class_name);",
      "1203:     zval_ptr_dtor(&user_func);",
      "1204:     zval_ptr_dtor(&args[0]);",
      "1205:     return 0;",
      "1206:    }",
      "1207:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
      "1208:    incomplete_class = 1;",
      "1209:    ce = PHP_IC_ENTRY;",
      "1210:    zval_ptr_dtor(&user_func);",
      "1211:    zval_ptr_dtor(&args[0]);",
      "1212:    break;",
      "1213:   }",
      "1214:   BG(serialize_lock)--;",
      "1215:   zval_ptr_dtor(&retval);",
      "1216:   if (EG(exception)) {",
      "1217:    zend_string_release(class_name);",
      "1218:    zval_ptr_dtor(&user_func);",
      "1219:    zval_ptr_dtor(&args[0]);",
      "1220:    return 0;",
      "1221:   }",
      "1224:   BG(serialize_lock)++;",
      "1225:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
      "1226:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
      "1227:    incomplete_class = 1;",
      "1228:    ce = PHP_IC_ENTRY;",
      "1229:   }",
      "1230:   BG(serialize_lock)--;",
      "1232:   zval_ptr_dtor(&user_func);",
      "1233:   zval_ptr_dtor(&args[0]);",
      "1234:   break;",
      "1235:  } while (1);",
      "1239:  if (custom_object) {",
      "1240:   int ret;",
      "1242:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
      "1244:   if (ret && incomplete_class) {",
      "1245:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
      "1246:   }",
      "1247:   zend_string_release(class_name);",
      "1248:   return ret;",
      "1249:  }",
      "1251:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "1253:  if (elements < 0) {",
      "1254:     zend_string_release(class_name);",
      "1255:     return 0;",
      "1256:  }",
      "1258:  if (incomplete_class) {",
      "1259:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
      "1260:  }",
      "1261:  zend_string_release(class_name);",
      "1263:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
      "1266: yy84:",
      "1268: #line 724 \"ext/standard/var_unserializer.re\"",
      "1270:  size_t len, maxlen;",
      "1271:  zend_string *str;",
      "1273:  len = parse_uiv(start + 2);",
      "1274:  maxlen = max - YYCURSOR;",
      "1275:  if (maxlen < len) {",
      "1277:   return 0;",
      "1278:  }",
      "1280:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
      "1281:   return 0;",
      "1282:  }",
      "1284:  if (*(YYCURSOR) != '\"') {",
      "1285:   zend_string_free(str);",
      "1287:   return 0;",
      "1288:  }",
      "1290:  if (*(YYCURSOR + 1) != ';') {",
      "1291:   efree(str);",
      "1293:   return 0;",
      "1294:  }",
      "1296:  YYCURSOR += 2;",
      "1299:  ZVAL_STR(rval, str);",
      "1302: #line 1303 \"ext/standard/var_unserializer.c\"",
      "1303: yy86:",
      "1305: #line 758 \"ext/standard/var_unserializer.re\"",
      "1307:  zend_long elements = parse_iv(start + 2);",
      "1310:     if (!var_hash) return 0;",
      "1312:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
      "1313:   return 0;",
      "1314:  }",
      "1316:  array_init_size(rval, elements);",
      "1317:  if (elements) {",
      "1320:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
      "1321:  }",
      "1323:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
      "1324:   return 0;",
      "1325:  }",
      "1327:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
      "1330: yy88:",
      "1333:   if (yych == '+') goto yy96;",
      "1334:   goto yy18;",
      "1336:   if (yych <= '-') goto yy96;",
      "1338:   if (yych >= ':') goto yy18;",
      "1340: yy89:",
      "1345:  if (yych <= '9') goto yy89;",
      "1346:  if (yych == ';') goto yy71;",
      "1347:  goto yy18;",
      "1348: yy91:",
      "1349:  yych = *++YYCURSOR;",
      "1350:  if (yych == ';') goto yy97;",
      "1351:  goto yy18;",
      "1352: yy92:",
      "1354: #line 782 \"ext/standard/var_unserializer.re\"",
      "1356:  zend_long elements;",
      "1357:     if (!var_hash) return 0;",
      "1359:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "1360:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
      "1361:   return 0;",
      "1362:  }",
      "1363:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "1364: }",
      "1365: #line 1366 \"ext/standard/var_unserializer.c\"",
      "1366: yy94:",
      "1367:  ++YYCURSOR;",
      "1368: #line 692 \"ext/standard/var_unserializer.re\"",
      "1369:  {",
      "1370:  size_t len, maxlen;",
      "1371:  char *str;",
      "1373:  len = parse_uiv(start + 2);",
      "1374:  maxlen = max - YYCURSOR;",
      "1375:  if (maxlen < len) {",
      "1380:  str = (char*)YYCURSOR;",
      "1382:  YYCURSOR += len;",
      "1384:  if (*(YYCURSOR) != '\"') {",
      "1389:  if (*(YYCURSOR + 1) != ';') {",
      "1391:   return 0;",
      "1394:  YYCURSOR += 2;",
      "1397:  ZVAL_STRINGL(rval, str, len);",
      "1400: #line 1401 \"ext/standard/var_unserializer.c\"",
      "1404:  if (yych <= '9') goto yy89;",
      "1405:  goto yy18;",
      "1408: #line 667 \"ext/standard/var_unserializer.re\"",
      "1412:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
      "1413:   ZVAL_DOUBLE(rval, php_get_nan());",
      "1414:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
      "1415:   ZVAL_DOUBLE(rval, php_get_inf());",
      "1416:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
      "1417:   ZVAL_DOUBLE(rval, -php_get_inf());",
      "1419:   ZVAL_NULL(rval);",
      "1424: #line 1425 \"ext/standard/var_unserializer.c\"",
      "1426: #line 953 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "409:    return 0;",
      "410:   }",
      "422:   zval_dtor(&key);",
      "424:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
      "",
      "[Removed Lines]",
      "412:   if (UNEXPECTED(Z_ISUNDEF_P(data))) {",
      "413:    if (Z_TYPE(key) == IS_LONG) {",
      "414:     zend_hash_index_del(ht, Z_LVAL(key));",
      "415:    } else {",
      "416:     zend_hash_del_ind(ht, Z_STR(key));",
      "417:    }",
      "418:   } else {",
      "419:    var_push_dtor(var_hash, data);",
      "420:   }",
      "",
      "[Added Lines]",
      "412:   var_push_dtor(var_hash, data);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "597:   return 0;",
      "598:  }",
      "601:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
      "604:  }",
      "605:  if (Z_ISREF_P(rval_ref)) {",
      "606:   ZVAL_COPY(rval, rval_ref);",
      "607:  } else {",
      "",
      "[Removed Lines]",
      "600:  zval_ptr_dtor(rval);",
      "602:   ZVAL_UNDEF(rval);",
      "603:   return 1;",
      "",
      "[Added Lines]",
      "592:   return 0;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "628:  }",
      "630:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
      "633:  }",
      "635:  ZVAL_COPY(rval, rval_ref);",
      "",
      "[Removed Lines]",
      "631:   ZVAL_UNDEF(rval);",
      "632:   return 1;",
      "",
      "[Added Lines]",
      "621:   return 0;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "7674b5e5749e8c0076357167ca553f153c94e6d1",
      "candidate_info": {
        "commit_hash": "7674b5e5749e8c0076357167ca553f153c94e6d1",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/7674b5e5749e8c0076357167ca553f153c94e6d1",
        "files": [
          "ext/standard/tests/serialize/bug74103.phpt"
        ],
        "message": "Fix test failure on 32-bit",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt"
          ],
          "candidate": [
            "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt": [
          "File: ext/standard/tests/serialize/bug74103.phpt -> ext/standard/tests/serialize/bug74103.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: var_dump(unserialize('a:7:{i:0;i:04;s:1:\"a\";i:2;i:00009617006;i:4;s:1:\"a\";i:4;s:1:\"a\";R:5;s:1:\"7\";R:3;s:1:\"a\";R:5;;s:18;}}'));",
          "6: ?>",
          "7: --EXPECTF--",
          "9: bool(false)",
          "",
          "[Removed Lines]",
          "8: Notice: unserialize(): Error at offset 68 of 100 bytes in %s on line %d",
          "",
          "[Added Lines]",
          "8: Notice: unserialize(): Error at offset %d of %d bytes in %s on line %d",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
      "candidate_info": {
        "commit_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/448c9be157f4147e121f1a2a524536c75c9c6059",
        "files": [
          "ext/standard/tests/strings/bug72663.phpt",
          "ext/standard/tests/strings/bug72663_2.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix bug #72663 - destroy broken object when unserializing",
        "before_after_code_files": [
          "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
          "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
          "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --FILE--",
          "4: <?php",
          "5: class obj implements Serializable {",
          "6:     var $data;",
          "7:     function serialize() {",
          "8:         return serialize($this->data);",
          "9:     }",
          "10:     function unserialize($data) {",
          "11:         $this->data = unserialize($data);",
          "12:     }",
          "13: }",
          "15: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
          "16: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
          "18: $data = unserialize($exploit);",
          "19: echo $data[1];",
          "20: ?>",
          "21: DONE",
          "22: --EXPECTF--",
          "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
          "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
          "26: DONE",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt": [
          "File: ext/standard/tests/strings/bug72663_2.phpt -> ext/standard/tests/strings/bug72663_2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --FILE--",
          "4: <?php",
          "6: ini_set('session.serialize_handler', 'php_serialize');",
          "7: session_start();",
          "8: $sess = 'O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:1;}';",
          "9: session_decode($sess);",
          "10: var_dump($_SESSION);",
          "11: ?>",
          "12: DONE",
          "13: --EXPECTF--",
          "14: Notice: session_decode(): Unexpected end of serialized data in %sbug72663_2.php on line %d",
          "15: array(0) {",
          "16: }",
          "17: DONE",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "434:  }",
          "436:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
          "437:   return 0;",
          "438:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "438:      zend_hash_clean(Z_OBJPROP_PP(rval));",
          "439:      ZVAL_NULL(*rval);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "486: {",
          "487:  YYCTYPE yych;",
          "488:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "485: #line 486 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "488: #line 489 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "542:  yych = *(YYMARKER = ++YYCURSOR);",
          "543:  if (yych == ':') goto yy95;",
          "544: yy3:",
          "546:  { return 0; }",
          "548: yy4:",
          "549:  yych = *(YYMARKER = ++YYCURSOR);",
          "550:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "545: #line 851 \"ext/standard/var_unserializer.re\"",
          "547: #line 548 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "548: #line 854 \"ext/standard/var_unserializer.re\"",
          "550: #line 551 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "587:  goto yy3;",
          "588: yy14:",
          "589:  ++YYCURSOR;",
          "591:  {",
          "593:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "595: }",
          "597: yy16:",
          "598:  yych = *++YYCURSOR;",
          "599:  goto yy3;",
          "",
          "[Removed Lines]",
          "590: #line 845 \"ext/standard/var_unserializer.re\"",
          "596: #line 597 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "593: #line 848 \"ext/standard/var_unserializer.re\"",
          "599: #line 600 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "619:  if (yybm[0+yych] & 128) {",
          "620:   goto yy20;",
          "621:  }",
          "623:  yych = *++YYCURSOR;",
          "624:  if (yych != '\"') goto yy18;",
          "625:  ++YYCURSOR;",
          "627:  {",
          "628:  size_t len, len2, len3, maxlen;",
          "629:  long elements;",
          "",
          "[Removed Lines]",
          "622:  if (yych != ':') goto yy18;",
          "626: #line 698 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "625:  if (yych <= '/') goto yy18;",
          "626:  if (yych >= ';') goto yy18;",
          "630: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "771:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "772: }",
          "774: yy25:",
          "775:  yych = *++YYCURSOR;",
          "776:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "773: #line 774 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "777: #line 778 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "795:  yych = *++YYCURSOR;",
          "796:  if (yych != '\"') goto yy18;",
          "797:  ++YYCURSOR;",
          "799:  {",
          "800:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "798: #line 689 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "802: #line 692 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "804:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "805:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "806: }",
          "808: yy32:",
          "809:  yych = *++YYCURSOR;",
          "810:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "807: #line 808 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "811: #line 812 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych != '{') goto yy18;",
          "827:  ++YYCURSOR;",
          "829:  {",
          "830:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "828: #line 668 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "832: #line 671 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "847:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "848: }",
          "850: yy39:",
          "851:  yych = *++YYCURSOR;",
          "852:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "849: #line 850 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "853: #line 854 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "867:  yych = *++YYCURSOR;",
          "868:  if (yych != '\"') goto yy18;",
          "869:  ++YYCURSOR;",
          "871:  {",
          "872:  size_t len, maxlen;",
          "873:  char *str;",
          "",
          "[Removed Lines]",
          "870: #line 633 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "874: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "902:  ZVAL_STRINGL(*rval, str, len, 0);",
          "903:  return 1;",
          "904: }",
          "906: yy46:",
          "907:  yych = *++YYCURSOR;",
          "908:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "905: #line 906 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "909: #line 910 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "923:  yych = *++YYCURSOR;",
          "924:  if (yych != '\"') goto yy18;",
          "925:  ++YYCURSOR;",
          "927:  {",
          "928:  size_t len, maxlen;",
          "929:  char *str;",
          "",
          "[Removed Lines]",
          "926: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "930: #line 603 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "956:  ZVAL_STRINGL(*rval, str, len, 1);",
          "957:  return 1;",
          "958: }",
          "960: yy53:",
          "961:  yych = *++YYCURSOR;",
          "962:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "959: #line 960 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "963: #line 964 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1044:  }",
          "1045: yy63:",
          "1046:  ++YYCURSOR;",
          "1048:  {",
          "1049: #if SIZEOF_LONG == 4",
          "1050: use_double:",
          "",
          "[Removed Lines]",
          "1047: #line 590 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1051: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1054:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1055:  return 1;",
          "1056: }",
          "1058: yy65:",
          "1059:  yych = *++YYCURSOR;",
          "1060:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1057: #line 1058 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1113:  yych = *++YYCURSOR;",
          "1114:  if (yych != ';') goto yy18;",
          "1115:  ++YYCURSOR;",
          "1117:  {",
          "1119:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1116: #line 575 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1120: #line 578 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1129:  return 1;",
          "1130: }",
          "1132: yy76:",
          "1133:  yych = *++YYCURSOR;",
          "1134:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1131: #line 1132 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1135: #line 1136 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1155:  if (yych <= '9') goto yy79;",
          "1156:  if (yych != ';') goto yy18;",
          "1157:  ++YYCURSOR;",
          "1159:  {",
          "1160: #if SIZEOF_LONG == 4",
          "1161:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1158: #line 548 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1162: #line 551 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1182:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1183:  return 1;",
          "1184: }",
          "1186: yy83:",
          "1187:  yych = *++YYCURSOR;",
          "1188:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1185: #line 1186 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1189: #line 1190 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1190:  yych = *++YYCURSOR;",
          "1191:  if (yych != ';') goto yy18;",
          "1192:  ++YYCURSOR;",
          "1194:  {",
          "1196:  INIT_PZVAL(*rval);",
          "1197:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1198:  return 1;",
          "1199: }",
          "1201: yy87:",
          "1202:  ++YYCURSOR;",
          "1204:  {",
          "1206:  INIT_PZVAL(*rval);",
          "1207:  ZVAL_NULL(*rval);",
          "1208:  return 1;",
          "1209: }",
          "1211: yy89:",
          "1212:  yych = *++YYCURSOR;",
          "1213:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1193: #line 541 \"ext/standard/var_unserializer.re\"",
          "1200: #line 1201 \"ext/standard/var_unserializer.c\"",
          "1203: #line 534 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1197: #line 544 \"ext/standard/var_unserializer.re\"",
          "1204: #line 1205 \"ext/standard/var_unserializer.c\"",
          "1207: #line 537 \"ext/standard/var_unserializer.re\"",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1230:  if (yych <= '9') goto yy91;",
          "1231:  if (yych != ';') goto yy18;",
          "1232:  ++YYCURSOR;",
          "1234:  {",
          "1235:  long id;",
          "",
          "[Removed Lines]",
          "1233: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1237: #line 514 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1254:  return 1;",
          "1255: }",
          "1257: yy95:",
          "1258:  yych = *++YYCURSOR;",
          "1259:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1256: #line 1257 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1260: #line 1261 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1276:  if (yych <= '9') goto yy97;",
          "1277:  if (yych != ';') goto yy18;",
          "1278:  ++YYCURSOR;",
          "1280:  {",
          "1281:  long id;",
          "",
          "[Removed Lines]",
          "1279: #line 490 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1283: #line 493 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1298:  return 1;",
          "1299: }",
          "1301: }",
          "1305:  return 0;",
          "",
          "[Removed Lines]",
          "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
          "1302: #line 853 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1304: #line 1305 \"ext/standard/var_unserializer.c\"",
          "1306: #line 856 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:  }",
          "440:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
          "441:   return 0;",
          "442:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "442:      zend_hash_clean(Z_OBJPROP_PP(rval));",
          "443:      ZVAL_NULL(*rval);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5100c51d52d019faf3528838db8e3f1e6ce5f3b8",
      "candidate_info": {
        "commit_hash": "5100c51d52d019faf3528838db8e3f1e6ce5f3b8",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/5100c51d52d019faf3528838db8e3f1e6ce5f3b8",
        "files": [
          "ext/standard/tests/serialize/bug74103.phpt"
        ],
        "message": "Made test 32/64-bit independent\n\n(cherry picked from commit 3bc12268041bdeec9941c99f08b71620f7572eb0)",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt"
          ],
          "candidate": [
            "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt": [
          "File: ext/standard/tests/serialize/bug74103.phpt -> ext/standard/tests/serialize/bug74103.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: Bug #74103: heap-use-after-free when unserializing invalid array size",
          "3: --FILE--",
          "4: <?php",
          "6: ?>",
          "7: --EXPECTF--",
          "9: bool(false)",
          "",
          "[Removed Lines]",
          "5: var_dump(unserialize('a:7:{i:0;i:04;s:1:\"a\";i:2;i:00009617006;i:4;s:1:\"a\";i:4;s:1:\"a\";R:5;s:1:\"7\";R:3;s:1:\"a\";R:5;;s:18;}}'));",
          "8: Notice: unserialize(): Error at offset 68 of 100 bytes in %s on line %d",
          "",
          "[Added Lines]",
          "5: var_dump(unserialize('a:7:{i:0;i:04;s:1:\"a\";i:2;i:9617006;i:4;s:1:\"a\";i:4;s:1:\"a\";R:5;s:1:\"7\";R:3;s:1:\"a\";R:5;;s:18;}}'));",
          "8: Notice: unserialize(): Error at offset 64 of 96 bytes in %s on line %d",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "13e9a471d79b5f845d087dd97c2f96d04493151e",
      "candidate_info": {
        "commit_hash": "13e9a471d79b5f845d087dd97c2f96d04493151e",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/13e9a471d79b5f845d087dd97c2f96d04493151e",
        "files": [
          "ext/standard/tests/serialize/bug76300.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix #76300 - Dont attempt to change visibility of a parent private",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug76300.phpt||ext/standard/tests/serialize/bug76300.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug76300.phpt||ext/standard/tests/serialize/bug76300.phpt": [
          "File: ext/standard/tests/serialize/bug76300.phpt -> ext/standard/tests/serialize/bug76300.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #76300: Unserialize of extended protected member broken",
          "3: --FILE--",
          "4: <?php",
          "5: class Base {",
          "6:  private $id;",
          "7:  public function __construct($id)",
          "8:  {",
          "9:   $this->id = $id;",
          "10:  }",
          "11: }",
          "12: class Derived extends Base {",
          "13:  protected $id;",
          "14:  public function __construct($id)",
          "15:  {",
          "16:   parent::__construct($id + 20);",
          "17:   $this->id = $id;",
          "18:  }",
          "19: }",
          "20: $a = new Derived(44);",
          "21: $s = serialize($a);",
          "22: $u = unserialize($s);",
          "23: print_r($u);",
          "24: --EXPECT--",
          "25: Derived Object",
          "26: (",
          "27:     [id:protected] => 44",
          "28:     [id:Base:private] => 64",
          "29: )",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "430:      unmangled = zend_string_init(unmangled_prop, unmangled_prop_len, 0);",
          "431:      if (Z_TYPE_P(rval) == IS_OBJECT",
          "432:        && ((existing_propinfo = zend_hash_find_ptr(&Z_OBJCE_P(rval)->properties_info, unmangled)) != NULL)",
          "433:        && (existing_propinfo->flags & ZEND_ACC_PPP_MASK)) {",
          "434:       if (existing_propinfo->flags & ZEND_ACC_PROTECTED) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "432:        && (unmangled_class == NULL || !strcmp(unmangled_class, \"*\") || !strcasecmp(unmangled_class, ZSTR_VAL(Z_OBJCE_P(rval)->name)))",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "644:  start = cursor;",
          "648: {",
          "649:  YYCTYPE yych;",
          "650:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "647: #line 648 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "648: #line 649 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "702: yy2:",
          "703:  ++YYCURSOR;",
          "704: yy3:",
          "706:  { return 0; }",
          "708: yy4:",
          "709:  yych = *(YYMARKER = ++YYCURSOR);",
          "710:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "705: #line 1035 \"ext/standard/var_unserializer.re\"",
          "707: #line 708 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "706: #line 1036 \"ext/standard/var_unserializer.re\"",
          "708: #line 709 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "751:  goto yy3;",
          "752: yy15:",
          "753:  ++YYCURSOR;",
          "755:  {",
          "757:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "759: }",
          "761: yy17:",
          "762:  yych = *++YYCURSOR;",
          "763:  if (yybm[0+yych] & 128) {",
          "",
          "[Removed Lines]",
          "754: #line 1029 \"ext/standard/var_unserializer.re\"",
          "760: #line 761 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "755: #line 1030 \"ext/standard/var_unserializer.re\"",
          "761: #line 762 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "768:  goto yy3;",
          "769: yy19:",
          "770:  ++YYCURSOR;",
          "772:  {",
          "774:  ZVAL_NULL(rval);",
          "775:  return 1;",
          "776: }",
          "778: yy21:",
          "779:  yych = *++YYCURSOR;",
          "780:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "771: #line 701 \"ext/standard/var_unserializer.re\"",
          "777: #line 778 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "772: #line 702 \"ext/standard/var_unserializer.re\"",
          "778: #line 779 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "973:  goto yy18;",
          "974: yy56:",
          "975:  ++YYCURSOR;",
          "977:  {",
          "978:  zend_long id;",
          "",
          "[Removed Lines]",
          "976: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "977: #line 653 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "999:  return 1;",
          "1000: }",
          "1002: yy58:",
          "1003:  yych = *++YYCURSOR;",
          "1004:  if (yych == '\"') goto yy77;",
          "",
          "[Removed Lines]",
          "1001: #line 1002 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1002: #line 1003 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1009:  goto yy18;",
          "1010: yy60:",
          "1011:  ++YYCURSOR;",
          "1013:  {",
          "1015:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1016:  return 1;",
          "1017: }",
          "1019: yy62:",
          "1020:  ++YYCURSOR;",
          "1021:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "",
          "[Removed Lines]",
          "1012: #line 707 \"ext/standard/var_unserializer.re\"",
          "1018: #line 1019 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1013: #line 708 \"ext/standard/var_unserializer.re\"",
          "1019: #line 1020 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1035:  }",
          "1036: yy64:",
          "1037:  ++YYCURSOR;",
          "1039:  {",
          "1040: #if SIZEOF_ZEND_LONG == 4",
          "1041: use_double:",
          "",
          "[Removed Lines]",
          "1038: #line 755 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1039: #line 756 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1044:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1045:  return 1;",
          "1046: }",
          "1048: yy66:",
          "1049:  yych = *++YYCURSOR;",
          "1050:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1047: #line 1048 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1048: #line 1049 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1066:  goto yy18;",
          "1067: yy69:",
          "1068:  ++YYCURSOR;",
          "1070:  {",
          "1071: #if SIZEOF_ZEND_LONG == 4",
          "1072:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1069: #line 713 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1070: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1092:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1093:  return 1;",
          "1094: }",
          "1096: yy71:",
          "1097:  yych = *++YYCURSOR;",
          "1098:  if (yych == '\"') goto yy85;",
          "1099:  goto yy18;",
          "1100: yy72:",
          "1101:  ++YYCURSOR;",
          "1103:  {",
          "1104:  zend_long id;",
          "",
          "[Removed Lines]",
          "1095: #line 1096 \"ext/standard/var_unserializer.c\"",
          "1102: #line 677 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1096: #line 1097 \"ext/standard/var_unserializer.c\"",
          "1103: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1124:  return 1;",
          "1125: }",
          "1127: yy74:",
          "1128:  yych = *++YYCURSOR;",
          "1129:  if (yych == '\"') goto yy87;",
          "1130:  goto yy18;",
          "1131: yy75:",
          "1132:  ++YYCURSOR;",
          "1134:  {",
          "1135:  size_t len, len2, len3, maxlen;",
          "1136:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1126: #line 1127 \"ext/standard/var_unserializer.c\"",
          "1133: #line 877 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1127: #line 1128 \"ext/standard/var_unserializer.c\"",
          "1134: #line 878 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1283:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1284: }",
          "1286: yy77:",
          "1287:  ++YYCURSOR;",
          "1289:  {",
          "1290:  size_t len, maxlen;",
          "1291:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1285: #line 1286 \"ext/standard/var_unserializer.c\"",
          "1288: #line 802 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1286: #line 1287 \"ext/standard/var_unserializer.c\"",
          "1289: #line 803 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1319:  ZVAL_STR(rval, str);",
          "1320:  return 1;",
          "1321: }",
          "1323: yy79:",
          "1324:  ++YYCURSOR;",
          "1326:  {",
          "1327:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "1325: #line 836 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1323: #line 1324 \"ext/standard/var_unserializer.c\"",
          "1326: #line 837 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1353:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1354: }",
          "1356: yy81:",
          "1357:  yych = *++YYCURSOR;",
          "1358:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1355: #line 1356 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1356: #line 1357 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1371:  goto yy18;",
          "1372: yy85:",
          "1373:  ++YYCURSOR;",
          "1375:  {",
          "1376:  zend_long elements;",
          "1377:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "1374: #line 866 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1375: #line 867 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1382:  }",
          "1383:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1384: }",
          "1386: yy87:",
          "1387:  ++YYCURSOR;",
          "1389:  {",
          "1390:  size_t len, maxlen;",
          "1391:  char *str;",
          "",
          "[Removed Lines]",
          "1385: #line 1386 \"ext/standard/var_unserializer.c\"",
          "1388: #line 764 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1386: #line 1387 \"ext/standard/var_unserializer.c\"",
          "1389: #line 765 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1423:  }",
          "1424:  return 1;",
          "1425: }",
          "1427: yy89:",
          "1428:  ++YYCURSOR;",
          "1430:  {",
          "",
          "[Removed Lines]",
          "1426: #line 1427 \"ext/standard/var_unserializer.c\"",
          "1429: #line 739 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1427: #line 1428 \"ext/standard/var_unserializer.c\"",
          "1430: #line 740 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1443:  return 1;",
          "1444: }",
          "1446: }",
          "1450:  return 0;",
          "",
          "[Removed Lines]",
          "1445: #line 1446 \"ext/standard/var_unserializer.c\"",
          "1447: #line 1037 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1446: #line 1447 \"ext/standard/var_unserializer.c\"",
          "1448: #line 1038 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "434:      unmangled = zend_string_init(unmangled_prop, unmangled_prop_len, 0);",
          "435:      if (Z_TYPE_P(rval) == IS_OBJECT",
          "436:        && ((existing_propinfo = zend_hash_find_ptr(&Z_OBJCE_P(rval)->properties_info, unmangled)) != NULL)",
          "437:        && (existing_propinfo->flags & ZEND_ACC_PPP_MASK)) {",
          "438:       if (existing_propinfo->flags & ZEND_ACC_PROTECTED) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "436:        && (unmangled_class == NULL || !strcmp(unmangled_class, \"*\") || !strcasecmp(unmangled_class, ZSTR_VAL(Z_OBJCE_P(rval)->name)))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d5f7e01f7cd2d3d51ea9bb96286da442b38e1d00",
      "candidate_info": {
        "commit_hash": "d5f7e01f7cd2d3d51ea9bb96286da442b38e1d00",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/d5f7e01f7cd2d3d51ea9bb96286da442b38e1d00",
        "files": [
          "ext/standard/var_unserializer.c"
        ],
        "message": "restore file deleted by mistake in a merge commit",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2: #line 1 \"ext/standard/var_unserializer.re\"",
          "4:   +----------------------------------------------------------------------+",
          "5:   | PHP Version 7                                                        |",
          "6:   +----------------------------------------------------------------------+",
          "7:   | Copyright (c) 1997-2017 The PHP Group                                |",
          "8:   +----------------------------------------------------------------------+",
          "9:   | This source file is subject to version 3.01 of the PHP license,      |",
          "10:   | that is bundled with this package in the file LICENSE, and is        |",
          "11:   | available through the world-wide-web at the following url:           |",
          "12:   | http://www.php.net/license/3_01.txt                                  |",
          "13:   | If you did not receive a copy of the PHP license and are unable to   |",
          "14:   | obtain it through the world-wide-web, please send a note to          |",
          "15:   | license@php.net so we can mail you a copy immediately.               |",
          "16:   +----------------------------------------------------------------------+",
          "17:   | Author: Sascha Schumann <sascha@schumann.cx>                         |",
          "18:   +----------------------------------------------------------------------+",
          "23: #include \"php.h\"",
          "24: #include \"ext/standard/php_var.h\"",
          "25: #include \"php_incomplete_class.h\"",
          "26: #include \"zend_portability.h\"",
          "28: struct php_unserialize_data {",
          "29:  void *first;",
          "30:  void *last;",
          "31:  void *first_dtor;",
          "32:  void *last_dtor;",
          "33:  HashTable *allowed_classes;",
          "34: };",
          "36: PHPAPI php_unserialize_data_t php_var_unserialize_init() {",
          "37:  php_unserialize_data_t d;",
          "39:  if (BG(serialize_lock) || !BG(unserialize).level) {",
          "40:   d = ecalloc(1, sizeof(struct php_unserialize_data));",
          "41:   if (!BG(serialize_lock)) {",
          "42:    BG(unserialize).data = d;",
          "43:    BG(unserialize).level = 1;",
          "44:   }",
          "45:  } else {",
          "46:   d = BG(unserialize).data;",
          "47:   ++BG(unserialize).level;",
          "48:  }",
          "49:  return d;",
          "50: }",
          "52: PHPAPI void php_var_unserialize_destroy(php_unserialize_data_t d) {",
          "54:  if (BG(serialize_lock) || BG(unserialize).level == 1) {",
          "55:   var_destroy(&d);",
          "56:   efree(d);",
          "57:  }",
          "58:  if (!BG(serialize_lock) && !--BG(unserialize).level) {",
          "59:   BG(unserialize).data = NULL;",
          "60:  }",
          "61: }",
          "63: PHPAPI HashTable *php_var_unserialize_get_allowed_classes(php_unserialize_data_t d) {",
          "64:  return d->allowed_classes;",
          "65: }",
          "66: PHPAPI void php_var_unserialize_set_allowed_classes(php_unserialize_data_t d, HashTable *classes) {",
          "67:  d->allowed_classes = classes;",
          "68: }",
          "72: #define VAR_ENTRIES_MAX 1024",
          "73: #define VAR_ENTRIES_DBG 0",
          "76: #define VAR_WAKEUP_FLAG 1",
          "78: typedef struct {",
          "79:  zval *data[VAR_ENTRIES_MAX];",
          "80:  zend_long used_slots;",
          "81:  void *next;",
          "82: } var_entries;",
          "84: typedef struct {",
          "85:  zval data[VAR_ENTRIES_MAX];",
          "86:  zend_long used_slots;",
          "87:  void *next;",
          "88: } var_dtor_entries;",
          "90: static inline void var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "91: {",
          "92:  var_entries *var_hash = (*var_hashx)->last;",
          "93: #if VAR_ENTRIES_DBG",
          "94:  fprintf(stderr, \"var_push(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_P(rval));",
          "95: #endif",
          "97:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "98:   var_hash = emalloc(sizeof(var_entries));",
          "99:   var_hash->used_slots = 0;",
          "100:   var_hash->next = 0;",
          "102:   if (!(*var_hashx)->first) {",
          "103:    (*var_hashx)->first = var_hash;",
          "104:   } else {",
          "105:    ((var_entries *) (*var_hashx)->last)->next = var_hash;",
          "106:   }",
          "108:   (*var_hashx)->last = var_hash;",
          "109:  }",
          "111:  var_hash->data[var_hash->used_slots++] = rval;",
          "112: }",
          "114: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "115: {",
          "116:  zval *tmp_var = var_tmp_var(var_hashx);",
          "117:     if (!tmp_var) {",
          "118:         return;",
          "119:     }",
          "120:  ZVAL_COPY(tmp_var, rval);",
          "121: }",
          "123: PHPAPI zval *var_tmp_var(php_unserialize_data_t *var_hashx)",
          "124: {",
          "125:     var_dtor_entries *var_hash;",
          "127:     if (!var_hashx || !*var_hashx) {",
          "128:         return NULL;",
          "129:     }",
          "131:     var_hash = (*var_hashx)->last_dtor;",
          "132:     if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "133:         var_hash = emalloc(sizeof(var_dtor_entries));",
          "134:         var_hash->used_slots = 0;",
          "135:         var_hash->next = 0;",
          "137:         if (!(*var_hashx)->first_dtor) {",
          "138:             (*var_hashx)->first_dtor = var_hash;",
          "139:         } else {",
          "140:             ((var_dtor_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "141:         }",
          "143:         (*var_hashx)->last_dtor = var_hash;",
          "144:     }",
          "145:     ZVAL_UNDEF(&var_hash->data[var_hash->used_slots]);",
          "146:  Z_EXTRA(var_hash->data[var_hash->used_slots]) = 0;",
          "147:     return &var_hash->data[var_hash->used_slots++];",
          "148: }",
          "150: PHPAPI void var_replace(php_unserialize_data_t *var_hashx, zval *ozval, zval *nzval)",
          "151: {",
          "152:  zend_long i;",
          "153:  var_entries *var_hash = (*var_hashx)->first;",
          "154: #if VAR_ENTRIES_DBG",
          "155:  fprintf(stderr, \"var_replace(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_P(nzval));",
          "156: #endif",
          "158:  while (var_hash) {",
          "159:   for (i = 0; i < var_hash->used_slots; i++) {",
          "160:    if (var_hash->data[i] == ozval) {",
          "161:     var_hash->data[i] = nzval;",
          "163:    }",
          "164:   }",
          "165:   var_hash = var_hash->next;",
          "166:  }",
          "167: }",
          "169: static zval *var_access(php_unserialize_data_t *var_hashx, zend_long id)",
          "170: {",
          "171:  var_entries *var_hash = (*var_hashx)->first;",
          "172: #if VAR_ENTRIES_DBG",
          "173:  fprintf(stderr, \"var_access(%ld): %ld\\n\", var_hash?var_hash->used_slots:-1L, id);",
          "174: #endif",
          "176:  while (id >= VAR_ENTRIES_MAX && var_hash && var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "177:   var_hash = var_hash->next;",
          "178:   id -= VAR_ENTRIES_MAX;",
          "179:  }",
          "181:  if (!var_hash) return NULL;",
          "183:  if (id < 0 || id >= var_hash->used_slots) return NULL;",
          "185:  return var_hash->data[id];",
          "186: }",
          "188: PHPAPI void var_destroy(php_unserialize_data_t *var_hashx)",
          "189: {",
          "190:  void *next;",
          "191:  zend_long i;",
          "192:  var_entries *var_hash = (*var_hashx)->first;",
          "193:  var_dtor_entries *var_dtor_hash = (*var_hashx)->first_dtor;",
          "194:  zend_bool wakeup_failed = 0;",
          "195:  zval wakeup_name;",
          "196:  ZVAL_UNDEF(&wakeup_name);",
          "198: #if VAR_ENTRIES_DBG",
          "199:  fprintf(stderr, \"var_destroy(%ld)\\n\", var_hash?var_hash->used_slots:-1L);",
          "200: #endif",
          "202:  while (var_hash) {",
          "203:   next = var_hash->next;",
          "204:   efree_size(var_hash, sizeof(var_entries));",
          "205:   var_hash = next;",
          "206:  }",
          "208:  while (var_dtor_hash) {",
          "209:   for (i = 0; i < var_dtor_hash->used_slots; i++) {",
          "210:    zval *zv = &var_dtor_hash->data[i];",
          "211: #if VAR_ENTRIES_DBG",
          "212:    fprintf(stderr, \"var_destroy dtor(%p, %ld)\\n\", var_dtor_hash->data[i], Z_REFCOUNT_P(var_dtor_hash->data[i]));",
          "213: #endif",
          "216:    if (Z_EXTRA_P(zv) == VAR_WAKEUP_FLAG) {",
          "217:     if (!wakeup_failed) {",
          "218:      zval retval;",
          "219:      if (Z_ISUNDEF(wakeup_name)) {",
          "220:       ZVAL_STRINGL(&wakeup_name, \"__wakeup\", sizeof(\"__wakeup\") - 1);",
          "221:      }",
          "223:      BG(serialize_lock)++;",
          "224:      if (call_user_function_ex(CG(function_table), zv, &wakeup_name, &retval, 0, 0, 1, NULL) == FAILURE || Z_ISUNDEF(retval)) {",
          "225:       wakeup_failed = 1;",
          "226:       GC_FLAGS(Z_OBJ_P(zv)) |= IS_OBJ_DESTRUCTOR_CALLED;",
          "227:      }",
          "228:      BG(serialize_lock)--;",
          "230:      zval_ptr_dtor(&retval);",
          "231:     } else {",
          "232:      GC_FLAGS(Z_OBJ_P(zv)) |= IS_OBJ_DESTRUCTOR_CALLED;",
          "233:     }",
          "234:    }",
          "236:    i_zval_ptr_dtor(zv ZEND_FILE_LINE_CC);",
          "237:   }",
          "238:   next = var_dtor_hash->next;",
          "239:   efree_size(var_dtor_hash, sizeof(var_dtor_entries));",
          "240:   var_dtor_hash = next;",
          "241:  }",
          "243:  zval_ptr_dtor_nogc(&wakeup_name);",
          "244: }",
          "248: static zend_string *unserialize_str(const unsigned char **p, size_t len, size_t maxlen)",
          "249: {",
          "250:  size_t i, j;",
          "251:  zend_string *str = zend_string_safe_alloc(1, len, 0, 0);",
          "252:  unsigned char *end = *(unsigned char **)p+maxlen;",
          "254:  if (end < *p) {",
          "255:   zend_string_free(str);",
          "256:   return NULL;",
          "257:  }",
          "259:  for (i = 0; i < len; i++) {",
          "260:   if (*p >= end) {",
          "261:    zend_string_free(str);",
          "262:    return NULL;",
          "263:   }",
          "264:   if (**p != '\\\\') {",
          "265:    ZSTR_VAL(str)[i] = (char)**p;",
          "266:   } else {",
          "267:    unsigned char ch = 0;",
          "269:    for (j = 0; j < 2; j++) {",
          "270:     (*p)++;",
          "271:     if (**p >= '0' && **p <= '9') {",
          "272:      ch = (ch << 4) + (**p -'0');",
          "273:     } else if (**p >= 'a' && **p <= 'f') {",
          "274:      ch = (ch << 4) + (**p -'a'+10);",
          "275:     } else if (**p >= 'A' && **p <= 'F') {",
          "276:      ch = (ch << 4) + (**p -'A'+10);",
          "277:     } else {",
          "278:      zend_string_free(str);",
          "279:      return NULL;",
          "280:     }",
          "281:    }",
          "282:    ZSTR_VAL(str)[i] = (char)ch;",
          "283:   }",
          "284:   (*p)++;",
          "285:  }",
          "286:  ZSTR_VAL(str)[i] = 0;",
          "287:  ZSTR_LEN(str) = i;",
          "288:  return str;",
          "289: }",
          "291: static inline int unserialize_allowed_class(",
          "292:   zend_string *class_name, php_unserialize_data_t *var_hashx)",
          "293: {",
          "294:  HashTable *classes = (*var_hashx)->allowed_classes;",
          "295:  zend_string *lcname;",
          "296:  int res;",
          "297:  ALLOCA_FLAG(use_heap)",
          "299:  if(classes == NULL) {",
          "300:   return 1;",
          "301:  }",
          "302:  if(!zend_hash_num_elements(classes)) {",
          "303:   return 0;",
          "304:  }",
          "306:  ZSTR_ALLOCA_ALLOC(lcname, ZSTR_LEN(class_name), use_heap);",
          "307:  zend_str_tolower_copy(ZSTR_VAL(lcname), ZSTR_VAL(class_name), ZSTR_LEN(class_name));",
          "308:  res = zend_hash_exists(classes, lcname);",
          "309:  ZSTR_ALLOCA_FREE(lcname, use_heap);",
          "310:  return res;",
          "311: }",
          "313: #define YYFILL(n) do { } while (0)",
          "314: #define YYCTYPE unsigned char",
          "315: #define YYCURSOR cursor",
          "316: #define YYLIMIT limit",
          "317: #define YYMARKER marker",
          "320: #line 325 \"ext/standard/var_unserializer.re\"",
          "325: static inline zend_long parse_iv2(const unsigned char *p, const unsigned char **q)",
          "326: {",
          "327:  char cursor;",
          "328:  zend_long result = 0;",
          "329:  int neg = 0;",
          "331:  switch (*p) {",
          "332:   case '-':",
          "333:    neg++;",
          "335:   case '+':",
          "336:    p++;",
          "337:  }",
          "339:  while (1) {",
          "340:   cursor = (char)*p;",
          "341:   if (cursor >= '0' && cursor <= '9') {",
          "342:    result = result * 10 + (size_t)(cursor - (unsigned char)'0');",
          "343:   } else {",
          "344:    break;",
          "345:   }",
          "346:   p++;",
          "347:  }",
          "348:  if (q) *q = p;",
          "349:  if (neg) return -result;",
          "350:  return result;",
          "351: }",
          "353: static inline zend_long parse_iv(const unsigned char *p)",
          "354: {",
          "355:  return parse_iv2(p, NULL);",
          "356: }",
          "359: static inline size_t parse_uiv(const unsigned char *p)",
          "360: {",
          "361:  unsigned char cursor;",
          "362:  size_t result = 0;",
          "364:  while (1) {",
          "365:   cursor = *p;",
          "366:   if (cursor >= '0' && cursor <= '9') {",
          "367:    result = result * 10 + (size_t)(cursor - (unsigned char)'0');",
          "368:   } else {",
          "369:    break;",
          "370:   }",
          "371:   p++;",
          "372:  }",
          "373:  return result;",
          "374: }",
          "376: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash",
          "377: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash",
          "379: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER);",
          "381: static zend_always_inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "382: {",
          "383:  while (elements-- > 0) {",
          "384:   zval key, *data, d, *old_data;",
          "385:   zend_ulong idx;",
          "387:   ZVAL_UNDEF(&key);",
          "389:   if (!php_var_unserialize_internal(&key, p, max, NULL)) {",
          "390:    zval_ptr_dtor(&key);",
          "391:    return 0;",
          "392:   }",
          "394:   data = NULL;",
          "395:   ZVAL_UNDEF(&d);",
          "397:   if (!objprops) {",
          "398:    if (Z_TYPE(key) == IS_LONG) {",
          "399:     idx = Z_LVAL(key);",
          "400: numeric_key:",
          "401:     if (UNEXPECTED((old_data = zend_hash_index_find(ht, idx)) != NULL)) {",
          "403:      var_push_dtor(var_hash, old_data);",
          "404:      data = zend_hash_index_update(ht, idx, &d);",
          "405:     } else {",
          "406:      data = zend_hash_index_add_new(ht, idx, &d);",
          "407:     }",
          "408:    } else if (Z_TYPE(key) == IS_STRING) {",
          "409:     if (UNEXPECTED(ZEND_HANDLE_NUMERIC(Z_STR(key), idx))) {",
          "410:      goto numeric_key;",
          "411:     }",
          "412:     if (UNEXPECTED((old_data = zend_hash_find(ht, Z_STR(key))) != NULL)) {",
          "414:      var_push_dtor(var_hash, old_data);",
          "415:      data = zend_hash_update(ht, Z_STR(key), &d);",
          "416:     } else {",
          "417:      data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "418:     }",
          "419:    } else {",
          "420:     zval_ptr_dtor(&key);",
          "421:     return 0;",
          "422:    }",
          "423:   } else {",
          "424:    if (EXPECTED(Z_TYPE(key) == IS_STRING)) {",
          "425: string_key:",
          "426:     {",
          "427:      zend_property_info *existing_propinfo;",
          "428:      zend_string *new_key, *unmangled;",
          "429:      const char *unmangled_class = NULL;",
          "430:      const char *unmangled_prop;",
          "431:      size_t unmangled_prop_len;",
          "433:      if (UNEXPECTED(zend_unmangle_property_name_ex(Z_STR(key), &unmangled_class, &unmangled_prop, &unmangled_prop_len) == FAILURE)) {",
          "434:       zval_ptr_dtor(&key);",
          "435:       return 0;",
          "436:      }",
          "438:      unmangled = zend_string_init(unmangled_prop, unmangled_prop_len, 0);",
          "439:      if (Z_TYPE_P(rval) == IS_OBJECT",
          "440:        && ((existing_propinfo = zend_hash_find_ptr(&Z_OBJCE_P(rval)->properties_info, unmangled)) != NULL)",
          "441:        && (existing_propinfo->flags & ZEND_ACC_PPP_MASK)) {",
          "442:       if (existing_propinfo->flags & ZEND_ACC_PROTECTED) {",
          "443:        new_key = zend_mangle_property_name(",
          "444:         \"*\", 1, ZSTR_VAL(unmangled), ZSTR_LEN(unmangled), Z_OBJCE_P(rval)->type & ZEND_INTERNAL_CLASS);",
          "445:        zend_string_release(unmangled);",
          "446:       } else if (existing_propinfo->flags & ZEND_ACC_PRIVATE) {",
          "447:        if (unmangled_class != NULL && strcmp(unmangled_class, \"*\") != 0) {",
          "448:         new_key = zend_mangle_property_name(",
          "449:          unmangled_class, strlen(unmangled_class),",
          "450:          ZSTR_VAL(unmangled), ZSTR_LEN(unmangled),",
          "451:          Z_OBJCE_P(rval)->type & ZEND_INTERNAL_CLASS);",
          "452:        } else {",
          "453:         new_key = zend_mangle_property_name(",
          "454:          ZSTR_VAL(existing_propinfo->ce->name), ZSTR_LEN(existing_propinfo->ce->name),",
          "455:          ZSTR_VAL(unmangled), ZSTR_LEN(unmangled),",
          "456:          Z_OBJCE_P(rval)->type & ZEND_INTERNAL_CLASS);",
          "457:        }",
          "458:        zend_string_release(unmangled);",
          "459:       } else {",
          "460:        ZEND_ASSERT(existing_propinfo->flags & ZEND_ACC_PUBLIC);",
          "461:        new_key = unmangled;",
          "462:       }",
          "463:       zend_string_release(Z_STR(key));",
          "464:       ZVAL_STR(&key, new_key);",
          "465:      } else {",
          "466:       zend_string_release(unmangled);",
          "467:      }",
          "469:      if ((old_data = zend_hash_find(ht, Z_STR(key))) != NULL) {",
          "470:       if (Z_TYPE_P(old_data) == IS_INDIRECT) {",
          "471:        old_data = Z_INDIRECT_P(old_data);",
          "472:       }",
          "473:       var_push_dtor(var_hash, old_data);",
          "474:       data = zend_hash_update_ind(ht, Z_STR(key), &d);",
          "475:      } else {",
          "476:       data = zend_hash_add_new(ht, Z_STR(key), &d);",
          "477:      }",
          "478:     }",
          "479:    } else if (Z_TYPE(key) == IS_LONG) {",
          "481:     convert_to_string(&key);",
          "482:     goto string_key;",
          "483:    } else {",
          "484:     zval_ptr_dtor(&key);",
          "485:     return 0;",
          "486:    }",
          "487:   }",
          "489:   if (!php_var_unserialize_internal(data, p, max, var_hash)) {",
          "490:    zval_ptr_dtor(&key);",
          "491:    return 0;",
          "492:   }",
          "494:   if (UNEXPECTED(Z_ISUNDEF_P(data))) {",
          "495:    if (Z_TYPE(key) == IS_LONG) {",
          "496:     zend_hash_index_del(ht, Z_LVAL(key));",
          "497:    } else {",
          "498:     zend_hash_del_ind(ht, Z_STR(key));",
          "499:    }",
          "500:   } else {",
          "501:    var_push_dtor(var_hash, data);",
          "502:   }",
          "504:   zval_ptr_dtor(&key);",
          "506:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "507:    (*p)--;",
          "508:    return 0;",
          "509:   }",
          "510:  }",
          "512:  return 1;",
          "513: }",
          "515: static inline int finish_nested_data(UNSERIALIZE_PARAMETER)",
          "516: {",
          "517:  if (*p >= max || **p != '}') {",
          "518:   return 0;",
          "519:  }",
          "521:  (*p)++;",
          "522:  return 1;",
          "523: }",
          "525: static inline int object_custom(UNSERIALIZE_PARAMETER, zend_class_entry *ce)",
          "526: {",
          "527:  zend_long datalen;",
          "529:  datalen = parse_iv2((*p) + 2, p);",
          "531:  (*p) += 2;",
          "533:  if (datalen < 0 || (max - (*p)) <= datalen) {",
          "534:   zend_error(E_WARNING, \"Insufficient data for unserializing - \" ZEND_LONG_FMT \" required, \" ZEND_LONG_FMT \" present\", datalen, (zend_long)(max - (*p)));",
          "535:   return 0;",
          "536:  }",
          "538:  if (ce->unserialize == NULL) {",
          "539:   zend_error(E_WARNING, \"Class %s has no unserializer\", ZSTR_VAL(ce->name));",
          "540:   object_init_ex(rval, ce);",
          "541:  } else if (ce->unserialize(rval, ce, (const unsigned char*)*p, datalen, (zend_unserialize_data *)var_hash) != SUCCESS) {",
          "542:   return 0;",
          "543:  }",
          "545:  (*p) += datalen;",
          "547:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "548: }",
          "550: static inline zend_long object_common1(UNSERIALIZE_PARAMETER, zend_class_entry *ce)",
          "551: {",
          "552:  zend_long elements;",
          "554:  if( *p >= max - 2) {",
          "555:   zend_error(E_WARNING, \"Bad unserialize data\");",
          "556:   return -1;",
          "557:  }",
          "559:  elements = parse_iv2((*p) + 2, p);",
          "561:  (*p) += 2;",
          "563:  if (ce->serialize == NULL) {",
          "564:   object_init_ex(rval, ce);",
          "565:  } else {",
          "568:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ZSTR_VAL(ce->name));",
          "569:   return -1;",
          "570:  }",
          "572:  return elements;",
          "573: }",
          "575: #ifdef PHP_WIN32",
          "576: # pragma optimize(\"\", off)",
          "577: #endif",
          "578: static inline int object_common2(UNSERIALIZE_PARAMETER, zend_long elements)",
          "579: {",
          "580:  HashTable *ht;",
          "581:  zend_bool has_wakeup;",
          "583:  if (Z_TYPE_P(rval) != IS_OBJECT) {",
          "584:   return 0;",
          "585:  }",
          "587:  has_wakeup = Z_OBJCE_P(rval) != PHP_IC_ENTRY",
          "588:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "590:  ht = Z_OBJPROP_P(rval);",
          "591:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "592:   return 0;",
          "593:  }",
          "595:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "596:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "597:   if (has_wakeup) {",
          "598:    ZVAL_DEREF(rval);",
          "599:    GC_FLAGS(Z_OBJ_P(rval)) |= IS_OBJ_DESTRUCTOR_CALLED;",
          "600:   }",
          "601:   return 0;",
          "602:  }",
          "604:  ZVAL_DEREF(rval);",
          "605:  if (has_wakeup) {",
          "607:   zval *wakeup_var = var_tmp_var(var_hash);",
          "608:   ZVAL_COPY(wakeup_var, rval);",
          "609:   Z_EXTRA_P(wakeup_var) = VAR_WAKEUP_FLAG;",
          "610:  }",
          "612:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "613: }",
          "614: #ifdef PHP_WIN32",
          "615: # pragma optimize(\"\", on)",
          "616: #endif",
          "618: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "619: {",
          "620:  var_entries *orig_var_entries = (*var_hash)->last;",
          "621:  zend_long orig_used_slots = orig_var_entries ? orig_var_entries->used_slots : 0;",
          "622:  int result;",
          "624:  result = php_var_unserialize_internal(UNSERIALIZE_PASSTHRU);",
          "626:  if (!result) {",
          "630:   var_entries *e = orig_var_entries;",
          "631:   zend_long s = orig_used_slots;",
          "632:   while (e) {",
          "633:    for (; s < e->used_slots; s++) {",
          "634:     e->data[s] = NULL;",
          "635:    }",
          "637:    e = e->next;",
          "638:    s = 0;",
          "639:   }",
          "640:  }",
          "642:  return result;",
          "643: }",
          "645: static int php_var_unserialize_internal(UNSERIALIZE_PARAMETER)",
          "646: {",
          "647:  const unsigned char *cursor, *limit, *marker, *start;",
          "648:  zval *rval_ref;",
          "650:  limit = max;",
          "651:  cursor = *p;",
          "653:  if (YYCURSOR >= YYLIMIT) {",
          "654:   return 0;",
          "655:  }",
          "657:  if (var_hash && (*p)[0] != 'R') {",
          "658:   var_push(var_hash, rval);",
          "659:  }",
          "661:  start = cursor;",
          "664: #line 665 \"ext/standard/var_unserializer.c\"",
          "665: {",
          "666:  YYCTYPE yych;",
          "667:  static const unsigned char yybm[] = {",
          "668:     0,   0,   0,   0,   0,   0,   0,   0,",
          "669:     0,   0,   0,   0,   0,   0,   0,   0,",
          "670:     0,   0,   0,   0,   0,   0,   0,   0,",
          "671:     0,   0,   0,   0,   0,   0,   0,   0,",
          "672:     0,   0,   0,   0,   0,   0,   0,   0,",
          "673:     0,   0,   0,   0,   0,   0,   0,   0,",
          "674:   128, 128, 128, 128, 128, 128, 128, 128,",
          "675:   128, 128,   0,   0,   0,   0,   0,   0,",
          "676:     0,   0,   0,   0,   0,   0,   0,   0,",
          "677:     0,   0,   0,   0,   0,   0,   0,   0,",
          "678:     0,   0,   0,   0,   0,   0,   0,   0,",
          "679:     0,   0,   0,   0,   0,   0,   0,   0,",
          "680:     0,   0,   0,   0,   0,   0,   0,   0,",
          "681:     0,   0,   0,   0,   0,   0,   0,   0,",
          "682:     0,   0,   0,   0,   0,   0,   0,   0,",
          "683:     0,   0,   0,   0,   0,   0,   0,   0,",
          "684:     0,   0,   0,   0,   0,   0,   0,   0,",
          "685:     0,   0,   0,   0,   0,   0,   0,   0,",
          "686:     0,   0,   0,   0,   0,   0,   0,   0,",
          "687:     0,   0,   0,   0,   0,   0,   0,   0,",
          "688:     0,   0,   0,   0,   0,   0,   0,   0,",
          "689:     0,   0,   0,   0,   0,   0,   0,   0,",
          "690:     0,   0,   0,   0,   0,   0,   0,   0,",
          "691:     0,   0,   0,   0,   0,   0,   0,   0,",
          "692:     0,   0,   0,   0,   0,   0,   0,   0,",
          "693:     0,   0,   0,   0,   0,   0,   0,   0,",
          "694:     0,   0,   0,   0,   0,   0,   0,   0,",
          "695:     0,   0,   0,   0,   0,   0,   0,   0,",
          "696:     0,   0,   0,   0,   0,   0,   0,   0,",
          "697:     0,   0,   0,   0,   0,   0,   0,   0,",
          "698:     0,   0,   0,   0,   0,   0,   0,   0,",
          "699:     0,   0,   0,   0,   0,   0,   0,   0,",
          "700:  };",
          "702:  if ((YYLIMIT - YYCURSOR) < 7) YYFILL(7);",
          "703:  yych = *YYCURSOR;",
          "704:  switch (yych) {",
          "705:  case 'C':",
          "706:  case 'O': goto yy13;",
          "707:  case 'N': goto yy5;",
          "708:  case 'R': goto yy2;",
          "709:  case 'S': goto yy10;",
          "710:  case 'a': goto yy11;",
          "711:  case 'b': goto yy6;",
          "712:  case 'd': goto yy8;",
          "713:  case 'i': goto yy7;",
          "714:  case 'o': goto yy12;",
          "715:  case 'r': goto yy4;",
          "716:  case 's': goto yy9;",
          "717:  case '}': goto yy14;",
          "718:  default: goto yy16;",
          "719:  }",
          "720: yy2:",
          "721:  yych = *(YYMARKER = ++YYCURSOR);",
          "722:  if (yych == ':') goto yy88;",
          "723: yy3:",
          "724: #line 1054 \"ext/standard/var_unserializer.re\"",
          "725:  { return 0; }",
          "726: #line 727 \"ext/standard/var_unserializer.c\"",
          "727: yy4:",
          "728:  yych = *(YYMARKER = ++YYCURSOR);",
          "729:  if (yych == ':') goto yy83;",
          "730:  goto yy3;",
          "731: yy5:",
          "732:  yych = *++YYCURSOR;",
          "733:  if (yych == ';') goto yy81;",
          "734:  goto yy3;",
          "735: yy6:",
          "736:  yych = *(YYMARKER = ++YYCURSOR);",
          "737:  if (yych == ':') goto yy77;",
          "738:  goto yy3;",
          "739: yy7:",
          "740:  yych = *(YYMARKER = ++YYCURSOR);",
          "741:  if (yych == ':') goto yy71;",
          "742:  goto yy3;",
          "743: yy8:",
          "744:  yych = *(YYMARKER = ++YYCURSOR);",
          "745:  if (yych == ':') goto yy48;",
          "746:  goto yy3;",
          "747: yy9:",
          "748:  yych = *(YYMARKER = ++YYCURSOR);",
          "749:  if (yych == ':') goto yy42;",
          "750:  goto yy3;",
          "751: yy10:",
          "752:  yych = *(YYMARKER = ++YYCURSOR);",
          "753:  if (yych == ':') goto yy36;",
          "754:  goto yy3;",
          "755: yy11:",
          "756:  yych = *(YYMARKER = ++YYCURSOR);",
          "757:  if (yych == ':') goto yy30;",
          "758:  goto yy3;",
          "759: yy12:",
          "760:  yych = *(YYMARKER = ++YYCURSOR);",
          "761:  if (yych == ':') goto yy24;",
          "762:  goto yy3;",
          "763: yy13:",
          "764:  yych = *(YYMARKER = ++YYCURSOR);",
          "765:  if (yych == ':') goto yy17;",
          "766:  goto yy3;",
          "767: yy14:",
          "768:  ++YYCURSOR;",
          "769: #line 1048 \"ext/standard/var_unserializer.re\"",
          "770:  {",
          "772:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "774: }",
          "775: #line 776 \"ext/standard/var_unserializer.c\"",
          "776: yy16:",
          "777:  yych = *++YYCURSOR;",
          "778:  goto yy3;",
          "779: yy17:",
          "780:  yych = *++YYCURSOR;",
          "781:  if (yybm[0+yych] & 128) {",
          "782:   goto yy19;",
          "783:  }",
          "784: yy18:",
          "785:  YYCURSOR = YYMARKER;",
          "786:  goto yy3;",
          "787: yy19:",
          "788:  ++YYCURSOR;",
          "789:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "790:  yych = *YYCURSOR;",
          "791:  if (yybm[0+yych] & 128) {",
          "792:   goto yy19;",
          "793:  }",
          "794:  if (yych <= '/') goto yy18;",
          "795:  if (yych >= ';') goto yy18;",
          "796:  yych = *++YYCURSOR;",
          "797:  if (yych != '\"') goto yy18;",
          "798:  ++YYCURSOR;",
          "799: #line 896 \"ext/standard/var_unserializer.re\"",
          "800:  {",
          "801:  size_t len, len2, len3, maxlen;",
          "802:  zend_long elements;",
          "803:  char *str;",
          "804:  zend_string *class_name;",
          "805:  zend_class_entry *ce;",
          "806:  int incomplete_class = 0;",
          "808:  int custom_object = 0;",
          "810:  zval user_func;",
          "811:  zval retval;",
          "812:  zval args[1];",
          "814:     if (!var_hash) return 0;",
          "815:  if (*start == 'C') {",
          "816:   custom_object = 1;",
          "817:  }",
          "819:  len2 = len = parse_uiv(start + 2);",
          "820:  maxlen = max - YYCURSOR;",
          "821:  if (maxlen < len || len == 0) {",
          "823:   return 0;",
          "824:  }",
          "826:  str = (char*)YYCURSOR;",
          "828:  YYCURSOR += len;",
          "830:  if (*(YYCURSOR) != '\"') {",
          "832:   return 0;",
          "833:  }",
          "834:  if (*(YYCURSOR+1) != ':') {",
          "836:   return 0;",
          "837:  }",
          "839:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "840:  if (len3 != len)",
          "841:  {",
          "843:   return 0;",
          "844:  }",
          "846:  class_name = zend_string_init(str, len, 0);",
          "848:  do {",
          "849:   if(!unserialize_allowed_class(class_name, var_hash)) {",
          "850:    incomplete_class = 1;",
          "851:    ce = PHP_IC_ENTRY;",
          "852:    break;",
          "853:   }",
          "856:   BG(serialize_lock)++;",
          "857:   ce = zend_lookup_class(class_name);",
          "858:   if (ce) {",
          "859:    BG(serialize_lock)--;",
          "860:    if (EG(exception)) {",
          "861:     zend_string_release(class_name);",
          "862:     return 0;",
          "863:    }",
          "864:    break;",
          "865:   }",
          "866:   BG(serialize_lock)--;",
          "868:   if (EG(exception)) {",
          "869:    zend_string_release(class_name);",
          "870:    return 0;",
          "871:   }",
          "874:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "875:    incomplete_class = 1;",
          "876:    ce = PHP_IC_ENTRY;",
          "877:    break;",
          "878:   }",
          "881:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
          "883:   ZVAL_STR_COPY(&args[0], class_name);",
          "884:   BG(serialize_lock)++;",
          "885:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
          "886:    BG(serialize_lock)--;",
          "887:    if (EG(exception)) {",
          "888:     zend_string_release(class_name);",
          "889:     zval_ptr_dtor(&user_func);",
          "890:     zval_ptr_dtor(&args[0]);",
          "891:     return 0;",
          "892:    }",
          "893:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
          "894:    incomplete_class = 1;",
          "895:    ce = PHP_IC_ENTRY;",
          "896:    zval_ptr_dtor(&user_func);",
          "897:    zval_ptr_dtor(&args[0]);",
          "898:    break;",
          "899:   }",
          "900:   BG(serialize_lock)--;",
          "901:   zval_ptr_dtor(&retval);",
          "902:   if (EG(exception)) {",
          "903:    zend_string_release(class_name);",
          "904:    zval_ptr_dtor(&user_func);",
          "905:    zval_ptr_dtor(&args[0]);",
          "906:    return 0;",
          "907:   }",
          "910:   BG(serialize_lock)++;",
          "911:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "912:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "913:    incomplete_class = 1;",
          "914:    ce = PHP_IC_ENTRY;",
          "915:   }",
          "916:   BG(serialize_lock)--;",
          "918:   zval_ptr_dtor(&user_func);",
          "919:   zval_ptr_dtor(&args[0]);",
          "920:   break;",
          "921:  } while (1);",
          "925:  if (custom_object) {",
          "926:   int ret;",
          "928:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "930:   if (ret && incomplete_class) {",
          "931:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "932:   }",
          "933:   zend_string_release(class_name);",
          "934:   return ret;",
          "935:  }",
          "937:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "939:  if (elements < 0) {",
          "940:     zend_string_release(class_name);",
          "941:     return 0;",
          "942:  }",
          "944:  if (incomplete_class) {",
          "945:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "946:  }",
          "947:  zend_string_release(class_name);",
          "949:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "950: }",
          "951: #line 952 \"ext/standard/var_unserializer.c\"",
          "952: yy24:",
          "953:  yych = *++YYCURSOR;",
          "954:  if (yych <= '/') goto yy18;",
          "955:  if (yych >= ':') goto yy18;",
          "956: yy25:",
          "957:  ++YYCURSOR;",
          "958:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "959:  yych = *YYCURSOR;",
          "960:  if (yych <= '/') goto yy18;",
          "961:  if (yych <= '9') goto yy25;",
          "962:  if (yych >= ';') goto yy18;",
          "963:  yych = *++YYCURSOR;",
          "964:  if (yych != '\"') goto yy18;",
          "965:  ++YYCURSOR;",
          "966: #line 885 \"ext/standard/var_unserializer.re\"",
          "967:  {",
          "968:  zend_long elements;",
          "969:     if (!var_hash) return 0;",
          "971:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "972:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "973:   return 0;",
          "974:  }",
          "975:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "976: }",
          "977: #line 978 \"ext/standard/var_unserializer.c\"",
          "978: yy30:",
          "979:  yych = *++YYCURSOR;",
          "980:  if (yych <= '/') goto yy18;",
          "981:  if (yych >= ':') goto yy18;",
          "982: yy31:",
          "983:  ++YYCURSOR;",
          "984:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "985:  yych = *YYCURSOR;",
          "986:  if (yych <= '/') goto yy18;",
          "987:  if (yych <= '9') goto yy31;",
          "988:  if (yych >= ';') goto yy18;",
          "989:  yych = *++YYCURSOR;",
          "990:  if (yych != '{') goto yy18;",
          "991:  ++YYCURSOR;",
          "992: #line 855 \"ext/standard/var_unserializer.re\"",
          "993:  {",
          "994:  zend_long elements = parse_iv(start + 2);",
          "997:     if (!var_hash) return 0;",
          "999:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "1000:   return 0;",
          "1001:  }",
          "1003:  array_init_size(rval, elements);",
          "1004:  if (elements) {",
          "1007:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "1008:  }",
          "1014:  HT_ALLOW_COW_VIOLATION(Z_ARRVAL_P(rval));",
          "1016:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "1017:   return 0;",
          "1018:  }",
          "1020:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1021: }",
          "1022: #line 1023 \"ext/standard/var_unserializer.c\"",
          "1023: yy36:",
          "1024:  yych = *++YYCURSOR;",
          "1025:  if (yych <= '/') goto yy18;",
          "1026:  if (yych >= ':') goto yy18;",
          "1027: yy37:",
          "1028:  ++YYCURSOR;",
          "1029:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "1030:  yych = *YYCURSOR;",
          "1031:  if (yych <= '/') goto yy18;",
          "1032:  if (yych <= '9') goto yy37;",
          "1033:  if (yych >= ';') goto yy18;",
          "1034:  yych = *++YYCURSOR;",
          "1035:  if (yych != '\"') goto yy18;",
          "1036:  ++YYCURSOR;",
          "1037: #line 821 \"ext/standard/var_unserializer.re\"",
          "1038:  {",
          "1039:  size_t len, maxlen;",
          "1040:  zend_string *str;",
          "1042:  len = parse_uiv(start + 2);",
          "1043:  maxlen = max - YYCURSOR;",
          "1044:  if (maxlen < len) {",
          "1046:   return 0;",
          "1047:  }",
          "1049:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "1050:   return 0;",
          "1051:  }",
          "1053:  if (*(YYCURSOR) != '\"') {",
          "1054:   zend_string_free(str);",
          "1056:   return 0;",
          "1057:  }",
          "1059:  if (*(YYCURSOR + 1) != ';') {",
          "1060:   efree(str);",
          "1062:   return 0;",
          "1063:  }",
          "1065:  YYCURSOR += 2;",
          "1068:  ZVAL_STR(rval, str);",
          "1069:  return 1;",
          "1070: }",
          "1071: #line 1072 \"ext/standard/var_unserializer.c\"",
          "1072: yy42:",
          "1073:  yych = *++YYCURSOR;",
          "1074:  if (yych <= '/') goto yy18;",
          "1075:  if (yych >= ':') goto yy18;",
          "1076: yy43:",
          "1077:  ++YYCURSOR;",
          "1078:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "1079:  yych = *YYCURSOR;",
          "1080:  if (yych <= '/') goto yy18;",
          "1081:  if (yych <= '9') goto yy43;",
          "1082:  if (yych >= ';') goto yy18;",
          "1083:  yych = *++YYCURSOR;",
          "1084:  if (yych != '\"') goto yy18;",
          "1085:  ++YYCURSOR;",
          "1086: #line 783 \"ext/standard/var_unserializer.re\"",
          "1087:  {",
          "1088:  size_t len, maxlen;",
          "1089:  char *str;",
          "1091:  len = parse_uiv(start + 2);",
          "1092:  maxlen = max - YYCURSOR;",
          "1093:  if (maxlen < len) {",
          "1095:   return 0;",
          "1096:  }",
          "1098:  str = (char*)YYCURSOR;",
          "1100:  YYCURSOR += len;",
          "1102:  if (*(YYCURSOR) != '\"') {",
          "1104:   return 0;",
          "1105:  }",
          "1107:  if (*(YYCURSOR + 1) != ';') {",
          "1109:   return 0;",
          "1110:  }",
          "1112:  YYCURSOR += 2;",
          "1115:  if (len == 0) {",
          "1116:   ZVAL_EMPTY_STRING(rval);",
          "1117:  } else if (len == 1) {",
          "1118:   ZVAL_INTERNED_STR(rval, ZSTR_CHAR((zend_uchar)*str));",
          "1119:  } else {",
          "1120:   ZVAL_STRINGL(rval, str, len);",
          "1121:  }",
          "1122:  return 1;",
          "1123: }",
          "1124: #line 1125 \"ext/standard/var_unserializer.c\"",
          "1125: yy48:",
          "1126:  yych = *++YYCURSOR;",
          "1127:  if (yych <= '/') {",
          "1128:   if (yych <= ',') {",
          "1129:    if (yych == '+') goto yy52;",
          "1130:    goto yy18;",
          "1131:   } else {",
          "1132:    if (yych <= '-') goto yy50;",
          "1133:    if (yych <= '.') goto yy55;",
          "1134:    goto yy18;",
          "1135:   }",
          "1136:  } else {",
          "1137:   if (yych <= 'I') {",
          "1138:    if (yych <= '9') goto yy53;",
          "1139:    if (yych <= 'H') goto yy18;",
          "1140:    goto yy51;",
          "1141:   } else {",
          "1142:    if (yych != 'N') goto yy18;",
          "1143:   }",
          "1144:  }",
          "1145:  yych = *++YYCURSOR;",
          "1146:  if (yych == 'A') goto yy70;",
          "1147:  goto yy18;",
          "1148: yy50:",
          "1149:  yych = *++YYCURSOR;",
          "1150:  if (yych <= '/') {",
          "1151:   if (yych == '.') goto yy55;",
          "1152:   goto yy18;",
          "1153:  } else {",
          "1154:   if (yych <= '9') goto yy53;",
          "1155:   if (yych != 'I') goto yy18;",
          "1156:  }",
          "1157: yy51:",
          "1158:  yych = *++YYCURSOR;",
          "1159:  if (yych == 'N') goto yy66;",
          "1160:  goto yy18;",
          "1161: yy52:",
          "1162:  yych = *++YYCURSOR;",
          "1163:  if (yych == '.') goto yy55;",
          "1164:  if (yych <= '/') goto yy18;",
          "1165:  if (yych >= ':') goto yy18;",
          "1166: yy53:",
          "1167:  ++YYCURSOR;",
          "1168:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "1169:  yych = *YYCURSOR;",
          "1170:  if (yych <= ':') {",
          "1171:   if (yych <= '.') {",
          "1172:    if (yych <= '-') goto yy18;",
          "1173:    goto yy64;",
          "1174:   } else {",
          "1175:    if (yych <= '/') goto yy18;",
          "1176:    if (yych <= '9') goto yy53;",
          "1177:    goto yy18;",
          "1178:   }",
          "1179:  } else {",
          "1180:   if (yych <= 'E') {",
          "1181:    if (yych <= ';') goto yy58;",
          "1182:    if (yych <= 'D') goto yy18;",
          "1183:    goto yy60;",
          "1184:   } else {",
          "1185:    if (yych == 'e') goto yy60;",
          "1186:    goto yy18;",
          "1187:   }",
          "1188:  }",
          "1189: yy55:",
          "1190:  yych = *++YYCURSOR;",
          "1191:  if (yych <= '/') goto yy18;",
          "1192:  if (yych >= ':') goto yy18;",
          "1193: yy56:",
          "1194:  ++YYCURSOR;",
          "1195:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "1196:  yych = *YYCURSOR;",
          "1197:  if (yych <= ';') {",
          "1198:   if (yych <= '/') goto yy18;",
          "1199:   if (yych <= '9') goto yy56;",
          "1200:   if (yych <= ':') goto yy18;",
          "1201:  } else {",
          "1202:   if (yych <= 'E') {",
          "1203:    if (yych <= 'D') goto yy18;",
          "1204:    goto yy60;",
          "1205:   } else {",
          "1206:    if (yych == 'e') goto yy60;",
          "1207:    goto yy18;",
          "1208:   }",
          "1209:  }",
          "1210: yy58:",
          "1211:  ++YYCURSOR;",
          "1212: #line 774 \"ext/standard/var_unserializer.re\"",
          "1213:  {",
          "1214: #if SIZEOF_ZEND_LONG == 4",
          "1215: use_double:",
          "1216: #endif",
          "1218:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1219:  return 1;",
          "1220: }",
          "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
          "1222: yy60:",
          "1223:  yych = *++YYCURSOR;",
          "1224:  if (yych <= ',') {",
          "1225:   if (yych != '+') goto yy18;",
          "1226:  } else {",
          "1227:   if (yych <= '-') goto yy61;",
          "1228:   if (yych <= '/') goto yy18;",
          "1229:   if (yych <= '9') goto yy62;",
          "1230:   goto yy18;",
          "1231:  }",
          "1232: yy61:",
          "1233:  yych = *++YYCURSOR;",
          "1234:  if (yych <= '/') goto yy18;",
          "1235:  if (yych >= ':') goto yy18;",
          "1236: yy62:",
          "1237:  ++YYCURSOR;",
          "1238:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1239:  yych = *YYCURSOR;",
          "1240:  if (yych <= '/') goto yy18;",
          "1241:  if (yych <= '9') goto yy62;",
          "1242:  if (yych == ';') goto yy58;",
          "1243:  goto yy18;",
          "1244: yy64:",
          "1245:  ++YYCURSOR;",
          "1246:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "1247:  yych = *YYCURSOR;",
          "1248:  if (yych <= ';') {",
          "1249:   if (yych <= '/') goto yy18;",
          "1250:   if (yych <= '9') goto yy64;",
          "1251:   if (yych <= ':') goto yy18;",
          "1252:   goto yy58;",
          "1253:  } else {",
          "1254:   if (yych <= 'E') {",
          "1255:    if (yych <= 'D') goto yy18;",
          "1256:    goto yy60;",
          "1257:   } else {",
          "1258:    if (yych == 'e') goto yy60;",
          "1259:    goto yy18;",
          "1260:   }",
          "1261:  }",
          "1262: yy66:",
          "1263:  yych = *++YYCURSOR;",
          "1264:  if (yych != 'F') goto yy18;",
          "1265: yy67:",
          "1266:  yych = *++YYCURSOR;",
          "1267:  if (yych != ';') goto yy18;",
          "1268:  ++YYCURSOR;",
          "1269: #line 758 \"ext/standard/var_unserializer.re\"",
          "1270:  {",
          "1273:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
          "1274:   ZVAL_DOUBLE(rval, ZEND_NAN);",
          "1275:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
          "1276:   ZVAL_DOUBLE(rval, ZEND_INFINITY);",
          "1277:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
          "1278:   ZVAL_DOUBLE(rval, -ZEND_INFINITY);",
          "1279:  } else {",
          "1280:   ZVAL_NULL(rval);",
          "1281:  }",
          "1283:  return 1;",
          "1284: }",
          "1285: #line 1286 \"ext/standard/var_unserializer.c\"",
          "1286: yy70:",
          "1287:  yych = *++YYCURSOR;",
          "1288:  if (yych == 'N') goto yy67;",
          "1289:  goto yy18;",
          "1290: yy71:",
          "1291:  yych = *++YYCURSOR;",
          "1292:  if (yych <= ',') {",
          "1293:   if (yych != '+') goto yy18;",
          "1294:  } else {",
          "1295:   if (yych <= '-') goto yy72;",
          "1296:   if (yych <= '/') goto yy18;",
          "1297:   if (yych <= '9') goto yy73;",
          "1298:   goto yy18;",
          "1299:  }",
          "1300: yy72:",
          "1301:  yych = *++YYCURSOR;",
          "1302:  if (yych <= '/') goto yy18;",
          "1303:  if (yych >= ':') goto yy18;",
          "1304: yy73:",
          "1305:  ++YYCURSOR;",
          "1306:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1307:  yych = *YYCURSOR;",
          "1308:  if (yych <= '/') goto yy18;",
          "1309:  if (yych <= '9') goto yy73;",
          "1310:  if (yych != ';') goto yy18;",
          "1311:  ++YYCURSOR;",
          "1312: #line 732 \"ext/standard/var_unserializer.re\"",
          "1313:  {",
          "1314: #if SIZEOF_ZEND_LONG == 4",
          "1315:  int digits = YYCURSOR - start - 3;",
          "1317:  if (start[2] == '-' || start[2] == '+') {",
          "1318:   digits--;",
          "1319:  }",
          "1322:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1323:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1324:    int cmp = strncmp((char*)YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1326:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1327:     goto use_double;",
          "1328:    }",
          "1329:   } else {",
          "1330:    goto use_double;",
          "1331:   }",
          "1332:  }",
          "1333: #endif",
          "1335:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1336:  return 1;",
          "1337: }",
          "1338: #line 1339 \"ext/standard/var_unserializer.c\"",
          "1339: yy77:",
          "1340:  yych = *++YYCURSOR;",
          "1341:  if (yych <= '/') goto yy18;",
          "1342:  if (yych >= '2') goto yy18;",
          "1343:  yych = *++YYCURSOR;",
          "1344:  if (yych != ';') goto yy18;",
          "1345:  ++YYCURSOR;",
          "1346: #line 726 \"ext/standard/var_unserializer.re\"",
          "1347:  {",
          "1349:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1350:  return 1;",
          "1351: }",
          "1352: #line 1353 \"ext/standard/var_unserializer.c\"",
          "1353: yy81:",
          "1354:  ++YYCURSOR;",
          "1355: #line 720 \"ext/standard/var_unserializer.re\"",
          "1356:  {",
          "1358:  ZVAL_NULL(rval);",
          "1359:  return 1;",
          "1360: }",
          "1361: #line 1362 \"ext/standard/var_unserializer.c\"",
          "1362: yy83:",
          "1363:  yych = *++YYCURSOR;",
          "1364:  if (yych <= '/') goto yy18;",
          "1365:  if (yych >= ':') goto yy18;",
          "1366: yy84:",
          "1367:  ++YYCURSOR;",
          "1368:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1369:  yych = *YYCURSOR;",
          "1370:  if (yych <= '/') goto yy18;",
          "1371:  if (yych <= '9') goto yy84;",
          "1372:  if (yych != ';') goto yy18;",
          "1373:  ++YYCURSOR;",
          "1374: #line 695 \"ext/standard/var_unserializer.re\"",
          "1375:  {",
          "1376:  zend_long id;",
          "1379:  if (!var_hash) return 0;",
          "1381:  id = parse_uiv(start + 2) - 1;",
          "1382:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1383:   return 0;",
          "1384:  }",
          "1386:  if (rval_ref == rval) {",
          "1387:   return 0;",
          "1388:  }",
          "1390:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1391:   ZVAL_UNDEF(rval);",
          "1392:   return 1;",
          "1393:  }",
          "1395:  ZVAL_COPY(rval, rval_ref);",
          "1397:  return 1;",
          "1398: }",
          "1399: #line 1400 \"ext/standard/var_unserializer.c\"",
          "1400: yy88:",
          "1401:  yych = *++YYCURSOR;",
          "1402:  if (yych <= '/') goto yy18;",
          "1403:  if (yych >= ':') goto yy18;",
          "1404: yy89:",
          "1405:  ++YYCURSOR;",
          "1406:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1407:  yych = *YYCURSOR;",
          "1408:  if (yych <= '/') goto yy18;",
          "1409:  if (yych <= '9') goto yy89;",
          "1410:  if (yych != ';') goto yy18;",
          "1411:  ++YYCURSOR;",
          "1412: #line 669 \"ext/standard/var_unserializer.re\"",
          "1413:  {",
          "1414:  zend_long id;",
          "1417:  if (!var_hash) return 0;",
          "1419:  id = parse_uiv(start + 2) - 1;",
          "1420:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1421:   return 0;",
          "1422:  }",
          "1424:  zval_ptr_dtor(rval);",
          "1425:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1426:   ZVAL_UNDEF(rval);",
          "1427:   return 1;",
          "1428:  }",
          "1429:  if (Z_ISREF_P(rval_ref)) {",
          "1430:   ZVAL_COPY(rval, rval_ref);",
          "1431:  } else {",
          "1432:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "1433:   ZVAL_COPY(rval, rval_ref);",
          "1434:  }",
          "1436:  return 1;",
          "1437: }",
          "1438: #line 1439 \"ext/standard/var_unserializer.c\"",
          "1439: }",
          "1440: #line 1056 \"ext/standard/var_unserializer.re\"",
          "1443:  return 0;",
          "1444: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}