{
  "cve_id": "CVE-2016-5732",
  "cve_desc": "Multiple cross-site scripting (XSS) vulnerabilities in the partition-range implementation in templates/table/structure/display_partitions.phtml in the table-structure page in phpMyAdmin 4.6.x before 4.6.3 allow remote attackers to inject arbitrary web script or HTML via crafted table parameters.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "0815af37f483f329f0c0565d68821fea9c47b5f5",
  "patch_info": {
    "commit_hash": "0815af37f483f329f0c0565d68821fea9c47b5f5",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/0815af37f483f329f0c0565d68821fea9c47b5f5",
    "files": [
      "templates/table/structure/display_partitions.phtml"
    ],
    "message": "Add missing escaping to partition listing\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
    "before_after_code_files": [
      "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
    ]
  },
  "patch_diff": {
    "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml": [
      "File: templates/table/structure/display_partitions.phtml -> templates/table/structure/display_partitions.phtml",
      "--- Hunk 1 ---",
      "[Context before]",
      "10:         <?php else: ?>",
      "11:             <p>",
      "12:                 <?= __('Partitioned by:');?>",
      "14:             </p>",
      "15:             <?php if ($hasSubPartitions): ?>",
      "16:                 <p>",
      "17:                     <?= __('Sub partitioned by:'); ?>",
      "19:                 <p>",
      "20:             <?php endif; ?>",
      "21:             <table>",
      "",
      "[Removed Lines]",
      "13:                 <code><?= $partitionMethod , '(' , $partitionExpression , ' )'; ?></code>",
      "18:                     <code><?= $subPartitionMethod , '(' , $subPartitionExpression , ' )'; ?></code>",
      "",
      "[Added Lines]",
      "13:                 <code><?= htmlspecialchars($partitionMethod) , '(' , htmlspecialchars($partitionExpression) , ' )'; ?></code>",
      "18:                     <code><?= htmlspecialchars($subPartitionMethod) , '(' , htmlspecialchars($subPartitionExpression) , ' )'; ?></code>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "139:             <?php endif; ?>",
      "140:         </form>",
      "141:     </fieldset>",
      "",
      "[Removed Lines]",
      "142: </div>",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d0efeac7446a855be88a7abc2c81a68e178bb316",
      "candidate_info": {
        "commit_hash": "d0efeac7446a855be88a7abc2c81a68e178bb316",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/d0efeac7446a855be88a7abc2c81a68e178bb316",
        "files": [
          "js/functions.js",
          "js/messages.php",
          "js/tbl_structure.js",
          "libraries/controllers/TableStructureController.class.php",
          "libraries/tbl_columns_definition_form.inc.php",
          "libraries/tbl_partition_definition.inc.php",
          "tbl_create.php",
          "templates/columns_definitions/column_definitions_form.phtml",
          "templates/columns_definitions/partitions.phtml",
          "templates/columns_definitions/partitions_form.phtml",
          "templates/table/structure/display_partitions.phtml",
          "templates/table/structure/display_structure.phtml",
          "templates/table/structure/partition_definition_form.phtml",
          "themes/pmahomme/css/common.css.php"
        ],
        "message": "Allow adding and editing partitions\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "js/functions.js||js/functions.js",
          "js/messages.php||js/messages.php",
          "js/tbl_structure.js||js/tbl_structure.js",
          "libraries/controllers/TableStructureController.class.php||libraries/controllers/TableStructureController.class.php",
          "libraries/tbl_columns_definition_form.inc.php||libraries/tbl_columns_definition_form.inc.php",
          "libraries/tbl_partition_definition.inc.php||libraries/tbl_partition_definition.inc.php",
          "tbl_create.php||tbl_create.php",
          "templates/columns_definitions/column_definitions_form.phtml||templates/columns_definitions/column_definitions_form.phtml",
          "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml",
          "templates/table/structure/display_structure.phtml||templates/table/structure/display_structure.phtml",
          "templates/table/structure/partition_definition_form.phtml||templates/table/structure/partition_definition_form.phtml",
          "themes/pmahomme/css/common.css.php||themes/pmahomme/css/common.css.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ],
          "candidate": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ]
        }
      },
      "candidate_diff": {
        "js/functions.js||js/functions.js": [
          "File: js/functions.js -> js/functions.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "2742:     $(document).off('submit', \"form.create_table_form.ajax\");",
          "2743:     $(document).off('click', \"form.create_table_form.ajax input[name=submit_num_fields]\");",
          "2744:     $(document).off('keyup', \"form.create_table_form.ajax input\");",
          "2748: });",
          "",
          "[Removed Lines]",
          "2745:     $(document).off('change', \"form.create_table_form.ajax input[name=partition_count],\" +",
          "2746:             \"form.create_table_form.ajax input[name=subpartition_count],\" +",
          "2747:             \"form.create_table_form.ajax select[name=partition_by]\");",
          "",
          "[Added Lines]",
          "2745:     $(document).off('change', \"input[name=partition_count],input[name=subpartition_count],select[name=partition_by]\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2920:     });",
          "2922:     $(\"input[value=AUTO_INCREMENT]\").change(function(){",
          "",
          "[Removed Lines]",
          "2916:     $(document).on('change', \"form.create_table_form.ajax input[name=partition_count],\" +",
          "2917:             \"form.create_table_form.ajax input[name=subpartition_count],\" +",
          "2918:             \"form.create_table_form.ajax select[name=partition_by]\", function (event) {",
          "2919:         submitChangesInCreateTableForm('submit_partition_change=1');",
          "",
          "[Added Lines]",
          "2914:     $(document).on('change', \"input[name=partition_count],input[name=subpartition_count],select[name=partition_by]\", function (event) {",
          "2915:         $this = $(this);",
          "2916:         $form = $this.parents('form');",
          "2917:         if ($form.is(\".create_table_form.ajax\")) {",
          "2918:             submitChangesInCreateTableForm('submit_partition_change=1');",
          "2919:         } else {",
          "2920:             $form.submit();",
          "2921:         }",
          "",
          "---------------"
        ],
        "js/messages.php||js/messages.php": [
          "File: js/messages.php -> js/messages.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "63: $js_messages['strDropRTEitems'] = __('Do you really want to delete the selected items?');",
          "64: $js_messages['strDropPartitionWarning'] = __('Do you really want to DROP the selected partition(s)? This will also DELETE the data related to the selected partition(s)!');",
          "65: $js_messages['strTruncatePartitionWarning'] = __('Do you really want to TRUNCATE the selected partition(s)?');",
          "66: $js_messages['strChangeColumnCollation'] = __(",
          "67:     'This operation will attempt to convert your data to the new collation. In '",
          "68:     . 'rare cases, especially where a character doesn\\'t exist in the new '",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "66: $js_messages['strRemovePartitioningWarning'] = __('Do you really want to remove partitioning?');",
          "",
          "---------------"
        ],
        "js/tbl_structure.js||js/tbl_structure.js": [
          "File: js/tbl_structure.js -> js/tbl_structure.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "86:     $(document).off('submit', \".append_fields_form.ajax\");",
          "87:     $('body').off('click', '#fieldsForm.ajax button[name=\"submit_mult\"], #fieldsForm.ajax input[name=\"submit_mult\"]');",
          "88:     $(document).off('click', 'a[name^=partition_action].ajax');",
          "89: });",
          "91: AJAX.registerOnload('tbl_structure.js', function () {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "89:     $(document).off('click', '#remove_partitioning.ajax');",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "462:             submitPartitionAction($link.attr('href'));",
          "463:         }",
          "464:     });",
          "465: });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "470:     $(document).on('click', '#remove_partitioning.ajax', function (e) {",
          "471:         e.preventDefault();",
          "472:         var $link = $(this);",
          "473:         var question = PMA_messages.strRemovePartitioningWarning;",
          "474:         $link.PMA_confirm(question, $link.attr('href'), function (url) {",
          "475:             var submitData = '&ajax_request=true&ajax_page_request=true';",
          "476:             PMA_ajaxShowMessage();",
          "477:             AJAX.source = $link;",
          "478:             $.post(url, submitData, AJAX.responseHandler);",
          "479:         });",
          "480:     });",
          "",
          "---------------"
        ],
        "libraries/controllers/TableStructureController.class.php||libraries/controllers/TableStructureController.class.php": [
          "File: libraries/controllers/TableStructureController.class.php -> libraries/controllers/TableStructureController.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "180:             return;",
          "181:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "186:         if (isset($_REQUEST['edit_partitioning'])",
          "187:             && ! isset($_REQUEST['save_partitioning'])",
          "188:         ) {",
          "189:             $this->displayHtmlForPartitionChange();",
          "190:             return;",
          "191:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "271:             }",
          "272:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "287:         if (isset($_REQUEST['save_partitioning'])) {",
          "288:             $this->updatePartitioning();",
          "289:         }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "516:         include 'libraries/tbl_columns_definition_form.inc.php';",
          "517:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "541:     protected function displayHtmlForPartitionChange()",
          "542:     {",
          "543:         $partitionDetails = null;",
          "544:         if (! isset($_REQUEST['partition_by'])) {",
          "545:             $partitionDetails = $this->_extractPartitionDetails();",
          "546:         }",
          "548:         include_once 'libraries/StorageEngine.class.php';",
          "549:         $this->response->addHTML(",
          "550:             \\PMA\\Template::get('table/structure/partition_definition_form')",
          "551:                 ->render(",
          "552:                     array(",
          "553:                         'db' => $this->db,",
          "554:                         'table' => $this->table,",
          "555:                         'partitionDetails' => $partitionDetails",
          "556:                     )",
          "557:                 )",
          "558:         );",
          "559:     }",
          "566:     private function _extractPartitionDetails()",
          "567:     {",
          "568:         $createTable = (new \\PMA_Table($this->table, $this->db))->showCreate();",
          "569:         if (! $createTable) {",
          "570:             return null;",
          "571:         }",
          "573:         $parser = new SqlParser\\Parser($createTable);",
          "577:         $stmt = $parser->statements[0];",
          "579:         $partitionDetails = array();",
          "581:         $partitionDetails['partition_by'] = '';",
          "582:         $partitionDetails['partition_expr'] = '';",
          "583:         $partitionDetails['partition_count'] = '';",
          "585:         if (! empty($stmt->partitionBy)) {",
          "586:             $openPos = strpos($stmt->partitionBy, \"(\");",
          "587:             $closePos = strrpos($stmt->partitionBy, \")\");",
          "589:             $partitionDetails['partition_by']",
          "590:                 = trim(substr($stmt->partitionBy, 0, $openPos));",
          "591:             $partitionDetails['partition_expr']",
          "592:                 = trim(substr($stmt->partitionBy, $openPos + 1, $closePos - ($openPos + 1)));",
          "593:             if (isset($stmt->partitionsNum)) {",
          "594:                 $count = $stmt->partitionsNum;",
          "595:             } else {",
          "596:                 $count = count($stmt->partitions);",
          "597:             }",
          "598:             $partitionDetails['partition_count'] = $count;",
          "599:         }",
          "601:         $partitionDetails['subpartition_by'] = '';",
          "602:         $partitionDetails['subpartition_expr'] = '';",
          "603:         $partitionDetails['subpartition_count'] = '';",
          "605:         if (! empty($stmt->subpartitionBy)) {",
          "606:             $openPos = strpos($stmt->subpartitionBy, \"(\");",
          "607:             $closePos = strrpos($stmt->subpartitionBy, \")\");",
          "609:             $partitionDetails['subpartition_by']",
          "610:                 = trim(substr($stmt->subpartitionBy, 0, $openPos));",
          "611:             $partitionDetails['subpartition_expr']",
          "612:                 = trim(substr($stmt->subpartitionBy, $openPos + 1, $closePos - ($openPos + 1)));",
          "613:             if (isset($stmt->subpartitionsNum)) {",
          "614:                 $count = $stmt->subpartitionsNum;",
          "615:             } else {",
          "616:                 $count = count($stmt->partitions[0]->subpartitions);",
          "617:             }",
          "618:             $partitionDetails['subpartition_count'] = $count;",
          "619:         }",
          "622:         $partitionDetails['can_have_subpartitions']",
          "623:             = $partitionDetails['partition_count'] > 1",
          "624:                 && ($partitionDetails['partition_by'] == 'RANGE'",
          "625:                 || $partitionDetails['partition_by'] == 'LIST');",
          "627:         $partitionDetails['partitions'] = array();",
          "629:         for ($i = 0; $i < intval($partitionDetails['partition_count']); $i++) {",
          "631:             if (! isset($stmt->partitions[$i])) {",
          "632:                 $partitionDetails['partitions'][$i] = array(",
          "633:                     'value_type' => '',",
          "634:                     'value' => '',",
          "635:                     'engine' => '',",
          "636:                     'comment' => '',",
          "637:                     'data_directory' => '',",
          "638:                     'index_directory' => '',",
          "639:                     'max_rows' => '',",
          "640:                     'min_rows' => '',",
          "641:                     'tablespace' => '',",
          "642:                     'node_group' => '',",
          "643:                 );",
          "644:             } else {",
          "645:                 $p = $stmt->partitions[$i];",
          "646:                 $type = $p->type;",
          "647:                 $expr = trim($p->expr, '()');",
          "648:                 if ($expr == 'MAXVALUE') {",
          "649:                     $type .= ' MAXVALUE';",
          "650:                     $expr = '';",
          "651:                 }",
          "652:                 $partitionDetails['partitions'][$i] = array(",
          "653:                     'value_type' => $type,",
          "654:                     'value' => $expr,",
          "655:                     'engine' => $p->options->has('ENGINE', true),",
          "656:                     'comment' => trim($p->options->has('COMMENT', true), \"'\"),",
          "657:                     'data_directory' => trim($p->options->has('DATA DIRECTORY', true), \"'\"),",
          "658:                     'index_directory' => trim($p->options->has('INDEX_DIRECTORY', true), \"'\"),",
          "659:                     'max_rows' => $p->options->has('MAX_ROWS', true),",
          "660:                     'min_rows' => $p->options->has('MIN_ROWS', true),",
          "661:                     'tablespace' => $p->options->has('TABLESPACE', true),",
          "662:                     'node_group' => $p->options->has('NODEGROUP', true),",
          "663:                 );",
          "664:             }",
          "666:             $partition =& $partitionDetails['partitions'][$i];",
          "667:             $partition['name'] = 'p' . $i;",
          "668:             $partition['prefix'] = 'partitions[' . $i . ']';",
          "671:             $partition['value_enabled'] = isset($partitionDetails['partition_by'])",
          "672:                 && ($partitionDetails['partition_by'] == 'RANGE'",
          "673:                 || $partitionDetails['partition_by'] == 'LIST');",
          "674:             if (! $partition['value_enabled']) {",
          "675:                 $partition['value_type'] = '';",
          "676:                 $partition['value'] = '';",
          "677:             }",
          "679:             if ($partitionDetails['subpartition_count'] > 1) {",
          "680:                 $partition['subpartition_count'] = $partitionDetails['subpartition_count'];",
          "681:                 $partition['subpartitions'] = array();",
          "683:                 for ($j = 0; $j < intval($partitionDetails['subpartition_count']); $j++) {",
          "684:                     if (! isset($stmt->partitions[$i]->subpartitions[$j])) {",
          "685:                         $partition['subpartitions'][$j] = array(",
          "686:                             'engine' => '',",
          "687:                             'comment' => '',",
          "688:                             'data_directory' => '',",
          "689:                             'index_directory' => '',",
          "690:                             'max_rows' => '',",
          "691:                             'min_rows' => '',",
          "692:                             'tablespace' => '',",
          "693:                             'node_group' => '',",
          "694:                         );",
          "695:                     } else {",
          "696:                         $sp = $stmt->partitions[$i]->subpartitions[$j];",
          "697:                         $partition['subpartitions'][$j] = array(",
          "698:                             'engine' => $sp->options->has('ENGINE', true),",
          "699:                             'comment' => trim($sp->options->has('COMMENT', true), \"'\"),",
          "700:                             'data_directory' => trim($sp->options->has('DATA DIRECTORY', true), \"'\"),",
          "701:                             'index_directory' => trim($sp->options->has('INDEX_DIRECTORY', true), \"'\"),",
          "702:                             'max_rows' => $sp->options->has('MAX_ROWS', true),",
          "703:                             'min_rows' => $sp->options->has('MIN_ROWS', true),",
          "704:                             'tablespace' => $sp->options->has('TABLESPACE', true),",
          "705:                             'node_group' => $sp->options->has('NODEGROUP', true),",
          "706:                         );",
          "707:                     }",
          "709:                     $subpartition =& $partition['subpartitions'][$j];",
          "710:                     $subpartition['name'] = 'p' . $i . 's' . $j;",
          "711:                     $subpartition['prefix'] = 'partitions[' . $i . ']'",
          "712:                         . '[subpartitions][' . $j . ']';",
          "713:                 }",
          "714:             }",
          "715:         }",
          "717:         return $partitionDetails;",
          "718:     }",
          "725:     protected function updatePartitioning()",
          "726:     {",
          "727:         require_once 'libraries/create_addfield.lib.php';",
          "729:         $sql_query = \"ALTER TABLE \" . \\PMA_Util::backquote($this->table) . \" \"",
          "730:             . PMA_getPartitionsDefinition();",
          "733:         $result = $this->dbi->tryQuery($sql_query);",
          "735:         if ($result !== false) {",
          "736:             $message = PMA_Message::success(",
          "737:                 __('Table %1$s has been altered successfully.')",
          "738:             );",
          "739:             $message->addParam($this->table);",
          "740:             $this->response->addHTML(",
          "741:                 PMA_Util::getMessage($message, $sql_query, 'success')",
          "742:             );",
          "743:         } else {",
          "744:             $this->response->isSuccess(false);",
          "745:             $this->response->addJSON(",
          "746:                 'message',",
          "747:                 PMA_Message::rawError(",
          "748:                     __('Query error') . ':<br />' . $this->dbi->getError()",
          "749:                 )",
          "750:             );",
          "751:         }",
          "752:     }",
          "",
          "---------------"
        ],
        "libraries/tbl_columns_definition_form.inc.php||libraries/tbl_columns_definition_form.inc.php": [
          "File: libraries/tbl_columns_definition_form.inc.php -> libraries/tbl_columns_definition_form.inc.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "409:         'action' => $action,",
          "410:         'form_params' => $form_params,",
          "411:         'content_cells' => $content_cells,",
          "413:     )",
          "414: );",
          "",
          "[Removed Lines]",
          "412:         'partitionDetails' => isset($partitionDetails) ? $partitionDetails : array()",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "libraries/tbl_partition_definition.inc.php||libraries/tbl_partition_definition.inc.php": [
          "File: libraries/tbl_partition_definition.inc.php -> libraries/tbl_partition_definition.inc.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <?php",
          "3: if (!isset($partitionDetails)) {",
          "5:     $partitionDetails = array();",
          "8:     $partitionParams = array(",
          "9:         'partition_by', 'partition_expr', 'partition_count',",
          "10:         'subpartition_by', 'subpartition_expr', 'subpartition_count'",
          "11:     );",
          "12:     foreach ($partitionParams as $partitionParam) {",
          "13:         $partitionDetails[$partitionParam] = isset($_REQUEST[$partitionParam])",
          "14:             ? $_REQUEST[$partitionParam] : '';",
          "15:     }",
          "18:     $partitionDetails['can_have_subpartitions'] = isset($_REQUEST['partition_count'])",
          "19:         && $_REQUEST['partition_count'] > 1",
          "20:         && isset($_REQUEST['partition_by'])",
          "21:         && ($_REQUEST['partition_by'] == 'RANGE' || $_REQUEST['partition_by'] == 'LIST');",
          "23:     if (PMA_isValid($_REQUEST['partition_count'], 'numeric')",
          "24:         && $_REQUEST['partition_count'] > 1",
          "25:     ) { // Has partitions",
          "26:         $partitions = isset($_REQUEST['partitions']) ? $_REQUEST['partitions'] : array();",
          "30:         array_splice($partitions, $_REQUEST['partition_count']);",
          "32:         for ($i = 0; $i < $_REQUEST['partition_count']; $i++) {",
          "33:             if (! isset($partitions[$i])) { // Newly added partition",
          "34:                 $partitions[$i] = array(",
          "35:                     'value_type' => '',",
          "36:                     'value' => '',",
          "37:                     'engine' => '',",
          "38:                     'comment' => '',",
          "39:                     'data_directory' => '',",
          "40:                     'index_directory' => '',",
          "41:                     'max_rows' => '',",
          "42:                     'min_rows' => '',",
          "43:                     'tablespace' => '',",
          "44:                     'node_group' => '',",
          "45:                 );",
          "46:             }",
          "48:             $partition =& $partitions[$i];",
          "49:             $partition['name'] = 'p' . $i;",
          "50:             $partition['prefix'] = 'partitions[' . $i . ']';",
          "53:             $partition['value_enabled'] = isset($_REQUEST['partition_by'])",
          "54:                 && ($_REQUEST['partition_by'] == 'RANGE'",
          "55:                 || $_REQUEST['partition_by'] == 'LIST');",
          "56:             if (! $partition['value_enabled']) {",
          "57:                 $partition['value_type'] = '';",
          "58:                 $partition['value'] = '';",
          "59:             }",
          "61:             if (PMA_isValid($_REQUEST['subpartition_count'], 'numeric')",
          "62:                 && $_REQUEST['subpartition_count'] > 1",
          "63:                 && $partitionDetails['can_have_subpartitions'] == true",
          "64:             ) { // Has subpartitions",
          "65:                 $partition['subpartition_count'] = $_REQUEST['subpartition_count'];",
          "67:                 if (! isset($partition['subpartitions'])) {",
          "68:                     $partition['subpartitions'] = array();",
          "69:                 }",
          "70:                 $subpartitions =& $partition['subpartitions'];",
          "74:                 array_splice($subpartitions, $_REQUEST['subpartition_count']);",
          "76:                 for ($j = 0; $j < $_REQUEST['subpartition_count']; $j++) {",
          "77:                     if (! isset($subpartitions[$j])) { // Newly added subpartition",
          "78:                         $subpartitions[$j] = array(",
          "79:                             'engine' => '',",
          "80:                             'comment' => '',",
          "81:                             'data_directory' => '',",
          "82:                             'index_directory' => '',",
          "83:                             'max_rows' => '',",
          "84:                             'min_rows' => '',",
          "85:                             'tablespace' => '',",
          "86:                             'node_group' => '',",
          "87:                         );",
          "88:                     }",
          "90:                     $subpartition =& $subpartitions[$j];",
          "91:                     $subpartition['name'] = 'p' . $i . 's' . $j;",
          "92:                     $subpartition['prefix'] = 'partitions[' . $i . ']'",
          "93:                         . '[subpartitions][' . $j . ']';",
          "94:                 }",
          "95:             } else { // No subpartitions",
          "96:                 unset($partition['subpartitions']);",
          "97:                 unset($partition['subpartition_count']);",
          "98:             }",
          "99:         }",
          "100:         $partitionDetails['partitions'] = $partitions;",
          "101:     }",
          "102: }",
          "104: echo PMA\\Template::get('columns_definitions/partitions')",
          "105:     ->render(array('partitionDetails' => $partitionDetails));",
          "",
          "---------------"
        ],
        "tbl_create.php||tbl_create.php": [
          "File: tbl_create.php -> tbl_create.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "101: $GLOBAL['table'] = '';",
          "",
          "[Removed Lines]",
          "103: $partitionDetails = array();",
          "106: $partitionParams = array(",
          "107:     'partition_by', 'partition_expr', 'partition_count',",
          "108:     'subpartition_by', 'subpartition_expr', 'subpartition_count'",
          "109: );",
          "110: foreach ($partitionParams as $partitionParam) {",
          "111:     $partitionDetails[$partitionParam] = isset($_REQUEST[$partitionParam])",
          "112:         ? $_REQUEST[$partitionParam] : '';",
          "113: }",
          "116: $partitionDetails['can_have_subpartitions'] = isset($_REQUEST['partition_count'])",
          "117:     && $_REQUEST['partition_count'] > 1",
          "118:     && isset($_REQUEST['partition_by'])",
          "119:     && ($_REQUEST['partition_by'] == 'RANGE' || $_REQUEST['partition_by'] == 'LIST');",
          "121: if (PMA_isValid($_REQUEST['partition_count'], 'numeric')",
          "122:     && $_REQUEST['partition_count'] > 1",
          "123: ) { // Has partitions",
          "124:     $partitions = isset($_REQUEST['partitions']) ? $_REQUEST['partitions'] : array();",
          "128:     array_splice($partitions, $_REQUEST['partition_count']);",
          "130:     for ($i = 0; $i < $_REQUEST['partition_count']; $i++) {",
          "131:         if (! isset($partitions[$i])) { // Newly added partition",
          "132:             $partitions[$i] = array(",
          "133:                 'value_type' => '',",
          "134:                 'value' => '',",
          "135:                 'engine' => '',",
          "136:                 'comment' => '',",
          "137:                 'data_directory' => '',",
          "138:                 'index_directory' => '',",
          "139:                 'max_rows' => '',",
          "140:                 'min_rows' => '',",
          "141:                 'tablespace' => '',",
          "142:                 'node_group' => '',",
          "143:             );",
          "144:         }",
          "146:         $partition =& $partitions[$i];",
          "147:         $partition['name'] = 'p' . $i;",
          "148:         $partition['prefix'] = 'partitions[' . $i . ']';",
          "151:         $partition['value_enabled'] = isset($_REQUEST['partition_by'])",
          "152:             && ($_REQUEST['partition_by'] == 'RANGE'",
          "153:             || $_REQUEST['partition_by'] == 'LIST');",
          "154:         if (! $partition['value_enabled']) {",
          "155:             $partition['value_type'] = '';",
          "156:             $partition['value'] = '';",
          "157:         }",
          "159:         if (PMA_isValid($_REQUEST['subpartition_count'], 'numeric')",
          "160:             && $_REQUEST['subpartition_count'] > 1",
          "161:             && $partitionDetails['can_have_subpartitions'] == true",
          "162:         ) { // Has subpartitions",
          "163:             $partition['subpartition_count'] = $_REQUEST['subpartition_count'];",
          "165:             if (! isset($partition['subpartitions'])) {",
          "166:                 $partition['subpartitions'] = array();",
          "167:             }",
          "168:             $subpartitions =& $partition['subpartitions'];",
          "172:             array_splice($subpartitions, $_REQUEST['subpartition_count']);",
          "174:             for ($j = 0; $j < $_REQUEST['subpartition_count']; $j++) {",
          "175:                 if (! isset($subpartitions[$j])) { // Newly added subpartition",
          "176:                     $subpartitions[$j] = array(",
          "177:                         'engine' => '',",
          "178:                         'comment' => '',",
          "179:                         'data_directory' => '',",
          "180:                         'index_directory' => '',",
          "181:                         'max_rows' => '',",
          "182:                         'min_rows' => '',",
          "183:                         'tablespace' => '',",
          "184:                         'node_group' => '',",
          "185:                     );",
          "186:                 }",
          "188:                 $subpartition =& $subpartitions[$j];",
          "189:                 $subpartition['name'] = 'p' . $i . 's' . $j;",
          "190:                 $subpartition['prefix'] = 'partitions[' . $i . ']'",
          "191:                     . '[subpartitions][' . $j . ']';",
          "192:             }",
          "193:         } else { // No subpartitions",
          "194:             unset($partition['subpartitions']);",
          "195:             unset($partition['subpartition_count']);",
          "196:         }",
          "197:     }",
          "198:     $partitionDetails['partitions'] = $partitions;",
          "199: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "templates/columns_definitions/column_definitions_form.phtml||templates/columns_definitions/column_definitions_form.phtml": [
          "File: templates/columns_definitions/column_definitions_form.phtml -> templates/columns_definitions/column_definitions_form.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "141:                 </tr>",
          "142:                 <tr>",
          "143:                     <td colspan=\"5\">",
          "146:                     </td>",
          "147:                 </tr>",
          "148:             <?php endif; ?>",
          "",
          "[Removed Lines]",
          "144:                         <?php echo PMA\\Template::get('columns_definitions/partitions_form')",
          "145:                             ->render(array('partitionDetails' => $partitionDetails)); ?>",
          "",
          "[Added Lines]",
          "144:                         <?php include 'libraries/tbl_partition_definition.inc.php'; ?>",
          "",
          "---------------"
        ],
        "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml": [
          "File: templates/table/structure/display_partitions.phtml -> templates/table/structure/display_partitions.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "3:         <legend><?php echo __('Partitions')",
          "4:             . PMA_Util::showMySQLDocu('partitioning'); ?>",
          "5:         </legend>",
          "11:             <p>",
          "54:                         </td>",
          "85:                         </td>",
          "95:                                     <td></td>",
          "124:     </fieldset>",
          "125: </div>",
          "",
          "[Removed Lines]",
          "6:         <p>",
          "7:             <?php echo __('Partitioned by:');?>",
          "8:             <code><?php echo $partitionMethod . '(' . $partitionExpression . ' )'; ?></code>",
          "9:         </p>",
          "10:         <?php if ($hasSubPartitions): ?>",
          "12:                 <?php echo __('Sub partitioned by:'); ?>",
          "13:                 <code><?php echo $subPartitionMethod . '(' . $subPartitionExpression . ' )'; ?></code>",
          "14:             <p>",
          "15:         <?php endif; ?>",
          "16:         <table>",
          "17:             <thead>",
          "18:                 <tr>",
          "19:                     <th colspan=\"2\">#</th>",
          "20:                     <th><?php echo __('Name'); ?></th>",
          "21:                     <?php if ($hasDescription): ?>",
          "22:                         <th><?php echo __('Expression'); ?></th>",
          "23:                     <?php endif; ?>",
          "24:                     <th><?php echo __('Rows'); ?></th>",
          "25:                     <th><?php echo __('Data length'); ?></th>",
          "26:                     <th><?php echo __('Index length'); ?></th>",
          "27:                     <th><?php echo __('Comment'); ?></th>",
          "28:                     <th colspan=\"<?php echo $rangeOrList ? '7' : '6'; ?>\">",
          "29:                         <?php echo __('Action'); ?>",
          "30:                     </th>",
          "31:                 </tr>",
          "32:             </thead>",
          "33:             <tbody>",
          "34:             <?php $odd = true; ?>",
          "35:             <?php foreach ($partitions as $partition): ?>",
          "36:                 <tr class=\"noclick <?php echo $odd ? 'odd' : 'even'; echo $hasSubPartitions ? ' marked' : '';?>\">",
          "37:                     <?php if ($hasSubPartitions): ?>",
          "38:                         <td><?php echo $partition->getOrdinal(); ?></td>",
          "39:                         <td></td>",
          "40:                     <?php else: ?>",
          "41:                         <td colspan=\"2\"><?php echo $partition->getOrdinal(); ?></td>",
          "42:                     <?php endif; ?>",
          "43:                     <th><?php echo htmlspecialchars($partition->getName()); ?></th>",
          "44:                     <?php if ($hasDescription): ?>",
          "45:                         <td>",
          "46:                             <code>",
          "47:                                 <?php",
          "48:                                 echo htmlspecialchars($partition->getExpression())",
          "49:                                     . ($partition->getMethod() == 'LIST' ? ' IN (' : ' < ')",
          "50:                                     . htmlspecialchars($partition->getDescription())",
          "51:                                     . ($partition->getMethod() == 'LIST' ? ')' : '');",
          "52:                                 ?>",
          "53:                             </code>",
          "55:                     <?php endif; ?>",
          "56:                     <td class=\"value\"><?php echo $partition->getRows(); ?></td>",
          "57:                     <td class=\"value\"><?php",
          "58:                         list($value, $unit) = PMA_Util::formatByteDown(",
          "59:                             $partition->getDataLength(), 3, 1",
          "60:                         );",
          "61:                         ?>",
          "62:                         <span><?php echo $value; ?></span>",
          "63:                         <span class=\"unit\"><?php echo $unit; ?></span>",
          "64:                     </td>",
          "65:                     <td class=\"value\"><?php",
          "66:                         list($value, $unit) = PMA_Util::formatByteDown(",
          "67:                             $partition->getIndexLength(), 3, 1",
          "68:                         );",
          "69:                         ?>",
          "70:                         <span><?php echo $value; ?></span>",
          "71:                         <span class=\"unit\"><?php echo $unit; ?></span>",
          "72:                     </td>",
          "73:                     <td><?php echo $partition->getComment(); ?></td>",
          "74:                     <?php foreach ($actionIcons as $action => $icon): ?>",
          "75:                         <td>",
          "76:                             <a  href=\"tbl_structure.php<?php echo $url_query; ?>&amp;partition_maintenance=1&amp;sql_query=<?php echo urlencode(",
          "77:                                     \"ALTER TABLE \" . PMA_Util::backquote($table) . $action . \" PARTITION \" . $partition->getName()",
          "78:                                 ) ?>\"",
          "79:                                 id=\"partition_action_<?php echo $action; ?>\"",
          "80:                                 name=\"partition_action_<?php echo $action; ?>\"",
          "81:                                 class=\"ajax\"",
          "82:                             >",
          "83:                                 <?php echo $icon; ?>",
          "84:                             </a>",
          "86:                     <?php endforeach; ?>",
          "88:                     <?php if ($hasSubPartitions): ?>",
          "89:                         <?php foreach ($partition->getSubPartitions() as $subParition): ?>",
          "90:                             <tr class=\"noclick <?php echo $odd ? 'odd' : 'even' ?>\">",
          "91:                                 <td></td>",
          "92:                                 <td><?php echo $subParition->getOrdinal(); ?></td>",
          "93:                                 <td><?php echo htmlspecialchars($subParition->getName()); ?></td>",
          "94:                                 <?php if ($hasDescription): ?>",
          "96:                                 <?php endif; ?>",
          "97:                                 <td class=\"value\"><?php echo $subParition->getRows(); ?></td>",
          "98:                                 <td class=\"value\"><?php",
          "99:                                     list($value, $unit) = PMA_Util::formatByteDown(",
          "100:                                         $subParition->getDataLength(), 3, 1",
          "101:                                     );",
          "102:                                     ?>",
          "103:                                     <span><?php echo $value; ?></span>",
          "104:                                     <span class=\"unit\"><?php echo $unit; ?></span>",
          "105:                                 </td>",
          "106:                                 <td class=\"value\"><?php",
          "107:                                     list($value, $unit) = PMA_Util::formatByteDown(",
          "108:                                         $subParition->getIndexLength(), 3, 1",
          "109:                                     );",
          "110:                                     ?>",
          "111:                                     <span><?php echo $value; ?></span>",
          "112:                                     <span class=\"unit\"><?php echo $unit; ?></span>",
          "113:                                 </td>",
          "114:                                 <td><?php echo $subParition->getComment(); ?></td>",
          "115:                                 <td colspan=\"<?php echo $rangeOrList ? '7' : '6'; ?>\"></td>",
          "116:                             </tr>",
          "117:                         <?php endforeach; ?>",
          "118:                     <?php endif; ?>",
          "119:                 </tr>",
          "120:                 <?php $odd = ! $odd; ?>",
          "121:             <?php endforeach; ?>",
          "122:             </tbody>",
          "123:         </table>",
          "",
          "[Added Lines]",
          "6:         <?php if (empty($partitions)): ?>",
          "7:             <?php echo PMA_Message::notice(__('No partitioning defined!'))->getDisplay(); ?>",
          "8:         <?php else: ?>",
          "10:                 <?php echo __('Partitioned by:');?>",
          "11:                 <code><?php echo $partitionMethod . '(' . $partitionExpression . ' )'; ?></code>",
          "12:             </p>",
          "13:             <?php if ($hasSubPartitions): ?>",
          "14:                 <p>",
          "15:                     <?php echo __('Sub partitioned by:'); ?>",
          "16:                     <code><?php echo $subPartitionMethod . '(' . $subPartitionExpression . ' )'; ?></code>",
          "17:                 <p>",
          "18:             <?php endif; ?>",
          "19:             <table>",
          "20:                 <thead>",
          "21:                     <tr>",
          "22:                         <th colspan=\"2\">#</th>",
          "23:                         <th><?php echo __('Name'); ?></th>",
          "24:                         <?php if ($hasDescription): ?>",
          "25:                             <th><?php echo __('Expression'); ?></th>",
          "26:                         <?php endif; ?>",
          "27:                         <th><?php echo __('Rows'); ?></th>",
          "28:                         <th><?php echo __('Data length'); ?></th>",
          "29:                         <th><?php echo __('Index length'); ?></th>",
          "30:                         <th><?php echo __('Comment'); ?></th>",
          "31:                         <th colspan=\"<?php echo $rangeOrList ? '7' : '6'; ?>\">",
          "32:                             <?php echo __('Action'); ?>",
          "33:                         </th>",
          "34:                     </tr>",
          "35:                 </thead>",
          "36:                 <tbody>",
          "37:                 <?php $odd = true; ?>",
          "38:                 <?php foreach ($partitions as $partition): ?>",
          "39:                     <tr class=\"noclick <?php echo $odd ? 'odd' : 'even'; echo $hasSubPartitions ? ' marked' : '';?>\">",
          "40:                         <?php if ($hasSubPartitions): ?>",
          "41:                             <td><?php echo $partition->getOrdinal(); ?></td>",
          "42:                             <td></td>",
          "43:                         <?php else: ?>",
          "44:                             <td colspan=\"2\"><?php echo $partition->getOrdinal(); ?></td>",
          "45:                         <?php endif; ?>",
          "46:                         <th><?php echo htmlspecialchars($partition->getName()); ?></th>",
          "47:                         <?php if ($hasDescription): ?>",
          "48:                             <td>",
          "49:                                 <code>",
          "50:                                     <?php",
          "51:                                     echo htmlspecialchars($partition->getExpression())",
          "52:                                         . ($partition->getMethod() == 'LIST' ? ' IN (' : ' < ')",
          "53:                                         . htmlspecialchars($partition->getDescription())",
          "54:                                         . ($partition->getMethod() == 'LIST' ? ')' : '');",
          "55:                                     ?>",
          "56:                                 </code>",
          "57:                             </td>",
          "58:                         <?php endif; ?>",
          "59:                         <td class=\"value\"><?php echo $partition->getRows(); ?></td>",
          "60:                         <td class=\"value\"><?php",
          "61:                             list($value, $unit) = PMA_Util::formatByteDown(",
          "62:                                 $partition->getDataLength(), 3, 1",
          "63:                             );",
          "64:                             ?>",
          "65:                             <span><?php echo $value; ?></span>",
          "66:                             <span class=\"unit\"><?php echo $unit; ?></span>",
          "68:                         <td class=\"value\"><?php",
          "69:                             list($value, $unit) = PMA_Util::formatByteDown(",
          "70:                                 $partition->getIndexLength(), 3, 1",
          "71:                             );",
          "72:                             ?>",
          "73:                             <span><?php echo $value; ?></span>",
          "74:                             <span class=\"unit\"><?php echo $unit; ?></span>",
          "76:                         <td><?php echo $partition->getComment(); ?></td>",
          "77:                         <?php foreach ($actionIcons as $action => $icon): ?>",
          "78:                             <td>",
          "79:                                 <a  href=\"tbl_structure.php<?php echo $url_query; ?>&amp;partition_maintenance=1&amp;sql_query=<?php echo urlencode(",
          "80:                                         \"ALTER TABLE \" . PMA_Util::backquote($table) . $action . \" PARTITION \" . $partition->getName()",
          "81:                                     ) ?>\"",
          "82:                                     id=\"partition_action_<?php echo $action; ?>\"",
          "83:                                     name=\"partition_action_<?php echo $action; ?>\"",
          "84:                                     class=\"ajax\"",
          "85:                                 >",
          "86:                                     <?php echo $icon; ?>",
          "87:                                 </a>",
          "88:                             </td>",
          "89:                         <?php endforeach; ?>",
          "91:                         <?php if ($hasSubPartitions): ?>",
          "92:                             <?php foreach ($partition->getSubPartitions() as $subParition): ?>",
          "93:                                 <tr class=\"noclick <?php echo $odd ? 'odd' : 'even' ?>\">",
          "95:                                     <td><?php echo $subParition->getOrdinal(); ?></td>",
          "96:                                     <td><?php echo htmlspecialchars($subParition->getName()); ?></td>",
          "97:                                     <?php if ($hasDescription): ?>",
          "98:                                         <td></td>",
          "99:                                     <?php endif; ?>",
          "100:                                     <td class=\"value\"><?php echo $subParition->getRows(); ?></td>",
          "101:                                     <td class=\"value\"><?php",
          "102:                                         list($value, $unit) = PMA_Util::formatByteDown(",
          "103:                                             $subParition->getDataLength(), 3, 1",
          "104:                                         );",
          "105:                                         ?>",
          "106:                                         <span><?php echo $value; ?></span>",
          "107:                                         <span class=\"unit\"><?php echo $unit; ?></span>",
          "108:                                     </td>",
          "109:                                     <td class=\"value\"><?php",
          "110:                                         list($value, $unit) = PMA_Util::formatByteDown(",
          "111:                                             $subParition->getIndexLength(), 3, 1",
          "112:                                         );",
          "113:                                         ?>",
          "114:                                         <span><?php echo $value; ?></span>",
          "115:                                         <span class=\"unit\"><?php echo $unit; ?></span>",
          "116:                                     </td>",
          "117:                                     <td><?php echo $subParition->getComment(); ?></td>",
          "118:                                     <td colspan=\"<?php echo $rangeOrList ? '7' : '6'; ?>\"></td>",
          "119:                                 </tr>",
          "120:                             <?php endforeach; ?>",
          "121:                         <?php endif; ?>",
          "122:                     </tr>",
          "123:                     <?php $odd = ! $odd; ?>",
          "124:                 <?php endforeach; ?>",
          "125:                 </tbody>",
          "126:             </table>",
          "127:         <?php endif; ?>",
          "128:     </fieldset>",
          "129:     <fieldset class=\"tblFooters print_ignore\">",
          "130:         <form action=\"tbl_structure.php\" method=\"post\">",
          "131:             <?php echo PMA_URL_getHiddenInputs($db, $table); ?>",
          "132:             <input type=\"hidden\" name=\"edit_partitioning\" value=\"true\" />",
          "133:             <?php if (empty($partitions)): ?>",
          "134:                 <input type=\"submit\" name=\"edit_partitioning\" value=\"<?php echo __('Partition table'); ?>\" />",
          "135:             <?php else: ?>",
          "136:                 <?php echo PMA_Util::linkOrButton($removeUrl, __('Remove partitioning'), ['class' => 'button ajax', 'id' => 'remove_partitioning'])?>",
          "137:                 <input type=\"submit\" name=\"edit_partitioning\" value=\"<?php echo __('Edit partitioning'); ?>\" />",
          "138:             <?php endif; ?>",
          "139:         </form>",
          "",
          "---------------"
        ],
        "templates/table/structure/display_structure.phtml||templates/table/structure/display_structure.phtml": [
          "File: templates/table/structure/display_structure.phtml -> templates/table/structure/display_structure.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "162: <?php endif; ?>",
          "164: <!--Display partition details-->",
          "218: <!--Displays Space usage and row statistics-->",
          "219: <?php if ($GLOBALS['cfg']['ShowStats']): ?>",
          "",
          "[Removed Lines]",
          "165: <?php",
          "166: $partition_names = PMA_Partition::getPartitionNames($db, $table);",
          "168: if (! empty($partition_names) && ! is_null($partition_names[0])) {",
          "170:     $partitions = PMA_Partition::getPartitions($db, $table);",
          "171:     $firstPartition = $partitions[0];",
          "172:     $rangeOrList = $firstPartition->getMethod() == 'RANGE'",
          "173:         || $firstPartition->getMethod() == 'LIST';",
          "174:     $subParitions = $firstPartition->getSubPartitions();",
          "175:     $hasSubPartitions = $firstPartition->hasSubPartitions();",
          "176:     if ($hasSubPartitions) {",
          "177:         $firstSubPartition = $subParitions[0];",
          "178:     }",
          "180:     $actionIcons = array(",
          "181:         'ANALYZE' => PMA_Util::getIcon('b_search.png', __('Analyze')),",
          "182:         'CHECK' => PMA_Util::getIcon('eye.png', __('Check')),",
          "183:         'OPTIMIZE' => PMA_Util::getIcon('normalize.png', __('Optimize')),",
          "184:         'REBUILD' => PMA_Util::getIcon('s_tbl.png', __('Rebuild')),",
          "185:         'REPAIR' => PMA_Util::getIcon('b_tblops.png', __('Repair')),",
          "186:         'TRUNCATE' => PMA_Util::getIcon('b_empty.png', __('Truncate')),",
          "187:     );",
          "188:     if ($rangeOrList) {",
          "189:         $actionIcons['DROP'] = PMA_Util::getIcon('b_drop.png', __('Drop'));",
          "190:     }",
          "192:     echo PMA_Util::getDivForSliderEffect(",
          "193:         'partitions', __('Partitions')",
          "194:     );",
          "196:     $tmp_partition_description = $firstPartition->getDescription();",
          "198:     echo PMA\\Template::get('table/structure/display_partitions')->render(",
          "199:         array(",
          "200:             'table' => $table,",
          "201:             'url_query'  => $url_query,",
          "202:             'partitions' => $partitions,",
          "203:             'partitionMethod' => $firstPartition->getMethod(),",
          "204:             'partitionExpression' => $firstPartition->getExpression(),",
          "205:             'hasDescription' => ! empty($tmp_partition_description),",
          "206:             'hasSubPartitions' => $hasSubPartitions,",
          "207:             'subPartitionMethod' => $hasSubPartitions ? $firstSubPartition->getMethod() : null,",
          "208:             'subPartitionExpression' => $hasSubPartitions ? $firstSubPartition->getExpression() : null,",
          "209:             'actionIcons' => $actionIcons,",
          "210:             'rangeOrList' => $rangeOrList,",
          "211:         )",
          "212:     );",
          "213: ?>",
          "214: <!-- For closing Slider effect div-->",
          "215: </div>",
          "216: <?php } ?>",
          "",
          "[Added Lines]",
          "165: <?php if (PMA_Partition::havePartitioning()):",
          "166:     $partition_names = PMA_Partition::getPartitionNames($db, $table);",
          "169:     if (! empty($partition_names) && ! is_null($partition_names[0])):",
          "171:         $partitions = PMA_Partition::getPartitions($db, $table);",
          "172:         $firstPartition = $partitions[0];",
          "173:         $rangeOrList = $firstPartition->getMethod() == 'RANGE'",
          "174:             || $firstPartition->getMethod() == 'LIST';",
          "175:         $subParitions = $firstPartition->getSubPartitions();",
          "176:         $hasSubPartitions = $firstPartition->hasSubPartitions();",
          "177:         if ($hasSubPartitions) {",
          "178:             $firstSubPartition = $subParitions[0];",
          "179:         }",
          "181:         $actionIcons = array(",
          "182:             'ANALYZE' => PMA_Util::getIcon('b_search.png', __('Analyze')),",
          "183:             'CHECK' => PMA_Util::getIcon('eye.png', __('Check')),",
          "184:             'OPTIMIZE' => PMA_Util::getIcon('normalize.png', __('Optimize')),",
          "185:             'REBUILD' => PMA_Util::getIcon('s_tbl.png', __('Rebuild')),",
          "186:             'REPAIR' => PMA_Util::getIcon('b_tblops.png', __('Repair')),",
          "187:             'TRUNCATE' => PMA_Util::getIcon('b_empty.png', __('Truncate')),",
          "188:         );",
          "189:         if ($rangeOrList) {",
          "190:             $actionIcons['DROP'] = PMA_Util::getIcon('b_drop.png', __('Drop'));",
          "191:         }",
          "193:         echo PMA_Util::getDivForSliderEffect(",
          "194:             'partitions', __('Partitions')",
          "195:         );",
          "197:         $tmp_partition_description = $firstPartition->getDescription();",
          "199:         $removeSQL = \"ALTER TABLE \" . PMA_Util::backquote($table) . \" REMOVE PARTITIONING\";",
          "200:         $removeUrl = 'sql.php' . $url_query . '&sql_query=' . urldecode($removeSQL);",
          "202:         echo PMA\\Template::get('table/structure/display_partitions')->render(",
          "203:             array(",
          "204:                 'db' => $db,",
          "205:                 'table' => $table,",
          "206:                 'url_query'  => $url_query,",
          "207:                 'partitions' => $partitions,",
          "208:                 'partitionMethod' => $firstPartition->getMethod(),",
          "209:                 'partitionExpression' => $firstPartition->getExpression(),",
          "210:                 'hasDescription' => ! empty($tmp_partition_description),",
          "211:                 'hasSubPartitions' => $hasSubPartitions,",
          "212:                 'subPartitionMethod' => $hasSubPartitions ? $firstSubPartition->getMethod() : null,",
          "213:                 'subPartitionExpression' => $hasSubPartitions ? $firstSubPartition->getExpression() : null,",
          "214:                 'actionIcons' => $actionIcons,",
          "215:                 'rangeOrList' => $rangeOrList,",
          "216:                 'removeUrl' => $removeUrl,",
          "217:             )",
          "218:         );",
          "219:     else:",
          "220:         echo PMA\\Template::get('table/structure/display_partitions')->render(",
          "221:             array(",
          "222:                 'db' => $db,",
          "223:                 'table' => $table,",
          "224:             )",
          "225:         );",
          "226:     endif;",
          "227:     ?>",
          "228:     <!-- For closing Slider effect div-->",
          "229:     </div>",
          "230: <?php endif; ?>",
          "",
          "---------------"
        ],
        "templates/table/structure/partition_definition_form.phtml||templates/table/structure/partition_definition_form.phtml": [
          "File: templates/table/structure/partition_definition_form.phtml -> templates/table/structure/partition_definition_form.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <form action=\"tbl_structure.php\" method=\"post\">",
          "3:     <?php echo PMA_URL_getHiddenInputs($db, $table); ?>",
          "4:     <input type=\"hidden\" name=\"edit_partitioning\" value=\"true\" />",
          "6:     <fieldset>",
          "7:         <legend><?php echo __('Edit partitioning'); ?></legend>",
          "8:         <?php include 'libraries/tbl_partition_definition.inc.php'; ?>",
          "9:     </fieldset>",
          "10:     <fieldset class=\"tblFooters\">",
          "11:         <input type=\"submit\" name=\"save_partitioning\" value=\"<?php echo __('Save'); ?>\">",
          "12:     </fieldset>",
          "13: </form>",
          "",
          "---------------"
        ],
        "themes/pmahomme/css/common.css.php||themes/pmahomme/css/common.css.php": [
          "File: themes/pmahomme/css/common.css.php -> themes/pmahomme/css/common.css.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1596: #sectionlinks a,",
          "1597: .buttonlinks a,",
          "1598: a.button {",
          "1600:     font-weight: bold;",
          "1601:     text-shadow: 0 1px 0 #fff;",
          "1602:     line-height: 35px;",
          "1603:     margin-<?php echo $left; ?>: 7px;",
          "1604:     border: 1px solid #aaa;",
          "1607:     text-decoration: none;",
          "1608:     background: #ddd;",
          "1609:     white-space: nowrap;",
          "1610:     border-radius: 20px;",
          "1611:     -webkit-border-radius: 20px;",
          "1612:     -moz-border-radius: 20px;",
          "1620: }",
          "1621: #sectionlinks a:hover,",
          "1622: .buttonlinks a:hover,",
          "1623: a.button:hover {",
          "1625: }",
          "1627: div#sqlquerycontainer {",
          "",
          "[Removed Lines]",
          "1599:     font-size: .88em;",
          "1605:     padding: 5px 10px;",
          "1606:     color: #111;",
          "1613:     box-shadow: <?php echo $GLOBALS['text_dir'] === 'rtl' ? '-' : ''; ?>1px 1px 2px rgba(0,0,0,.5);",
          "1615:     -webkit-box-shadow: <?php echo $GLOBALS['text_dir'] === 'rtl' ? '-' : ''; ?>1px 1px 2px rgba(0,0,0,.5);",
          "1616:     -moz-box-shadow: <?php echo $GLOBALS['text_dir'] === 'rtl' ? '-' : ''; ?>1px 1px 2px rgba(0,0,0,.5);",
          "1617:     text-shadow: #fff 0 1px 0;",
          "1619:     <?php echo $_SESSION['PMA_Theme']->getCssGradient('ffffff', 'cccccc'); ?>",
          "1624:     <?php echo $_SESSION['PMA_Theme']->getCssGradient('cccccc', 'dddddd'); ?>",
          "",
          "[Added Lines]",
          "1604:     padding: 3px 7px;",
          "1605:     color: #111 !important;",
          "1612:     <?php echo $_SESSION['PMA_Theme']->getCssGradient('f8f8f8', 'd8d8d8'); ?>",
          "1617:     <?php echo $_SESSION['PMA_Theme']->getCssGradient('ffffff', 'dddddd'); ?>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8e70f48817dd51763de0098e79702b14e4e0952e",
      "candidate_info": {
        "commit_hash": "8e70f48817dd51763de0098e79702b14e4e0952e",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/8e70f48817dd51763de0098e79702b14e4e0952e",
        "files": [
          "libraries/Partition.class.php",
          "templates/table/structure/display_partitions.phtml"
        ],
        "message": "Mark partition if it has sub partitions\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "libraries/Partition.class.php||libraries/Partition.class.php",
          "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ],
          "candidate": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ]
        }
      },
      "candidate_diff": {
        "libraries/Partition.class.php||libraries/Partition.class.php": [
          "File: libraries/Partition.class.php -> libraries/Partition.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "203:     {",
          "204:         return ! empty($this->subPartitions);",
          "205:     }",
          "",
          "[Removed Lines]",
          "202:     public function hasSubParitions()",
          "",
          "[Added Lines]",
          "202:     public function hasSubPartitions()",
          "",
          "---------------"
        ],
        "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml": [
          "File: templates/table/structure/display_partitions.phtml -> templates/table/structure/display_partitions.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:                 );",
          "29:             ?>",
          "30:             <?php foreach ($partitions as $partition): ?>",
          "33:                         <td><?php echo $partition->getOrdinal(); ?></td>",
          "34:                         <td></td>",
          "35:                     <?php else: ?>",
          "",
          "[Removed Lines]",
          "31:                 <tr class=\"noclick <?php echo $odd ? 'odd' : 'even' ?>\">",
          "32:                     <?php if ($partition->hasSubParitions()): ?>",
          "",
          "[Added Lines]",
          "31:                 <?php $hasSubPartitions = $partition->hasSubPartitions(); ?>",
          "32:                 <tr class=\"noclick <?php echo $odd ? 'odd' : 'even'; echo $hasSubPartitions ? ' marked' : '';?>\">",
          "33:                     <?php if ($hasSubPartitions): ?>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "63:                         </td>",
          "64:                     <?php endforeach; ?>",
          "67:                         <?php foreach ($partition->getSubParitions() as $subParition): ?>",
          "68:                             <tr class=\"noclick <?php echo $odd ? 'odd' : 'even' ?>\">",
          "69:                                 <td></td>",
          "",
          "[Removed Lines]",
          "66:                     <?php if ($partition->hasSubParitions()): ?>",
          "",
          "[Added Lines]",
          "67:                     <?php if ($hasSubPartitions): ?>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9ee3931c091f12d1501b393ff8d763ddade768dd",
      "candidate_info": {
        "commit_hash": "9ee3931c091f12d1501b393ff8d763ddade768dd",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/9ee3931c091f12d1501b393ff8d763ddade768dd",
        "files": [
          "index.php",
          "js/messages.php",
          "libraries/plugins/auth/AuthenticationCookie.php",
          "libraries/plugins/auth/swekey/swekey.auth.lib.php",
          "libraries/plugins/schema/ExportRelationSchema.php",
          "libraries/rte/rte_export.lib.php",
          "libraries/rte/rte_routines.lib.php",
          "setup/lib/form_processing.lib.php",
          "setup/lib/index.lib.php",
          "templates/database/structure/body_for_table_summary.phtml",
          "templates/database/structure/check_all_tables.phtml",
          "templates/database/structure/structure_table_row.phtml",
          "templates/table/chart/tbl_chart.phtml",
          "templates/table/gis_visualization/gis_visualization.phtml",
          "templates/table/search/input_box.phtml",
          "templates/table/structure/display_partitions.phtml",
          "transformation_overview.php",
          "url.php"
        ],
        "message": "Remove some unnecessary string concatenations\n\nhttps://github.com/dseguy/clearPHP/blob/master/rules/no-unnecessary-string-concatenation.md\n\nSigned-off-by: Marc Delisle <marc@infomarc.info>",
        "before_after_code_files": [
          "index.php||index.php",
          "js/messages.php||js/messages.php",
          "libraries/plugins/auth/AuthenticationCookie.php||libraries/plugins/auth/AuthenticationCookie.php",
          "libraries/plugins/auth/swekey/swekey.auth.lib.php||libraries/plugins/auth/swekey/swekey.auth.lib.php",
          "libraries/plugins/schema/ExportRelationSchema.php||libraries/plugins/schema/ExportRelationSchema.php",
          "libraries/rte/rte_export.lib.php||libraries/rte/rte_export.lib.php",
          "libraries/rte/rte_routines.lib.php||libraries/rte/rte_routines.lib.php",
          "setup/lib/form_processing.lib.php||setup/lib/form_processing.lib.php",
          "setup/lib/index.lib.php||setup/lib/index.lib.php",
          "templates/database/structure/body_for_table_summary.phtml||templates/database/structure/body_for_table_summary.phtml",
          "templates/database/structure/check_all_tables.phtml||templates/database/structure/check_all_tables.phtml",
          "templates/database/structure/structure_table_row.phtml||templates/database/structure/structure_table_row.phtml",
          "templates/table/chart/tbl_chart.phtml||templates/table/chart/tbl_chart.phtml",
          "templates/table/gis_visualization/gis_visualization.phtml||templates/table/gis_visualization/gis_visualization.phtml",
          "templates/table/search/input_box.phtml||templates/table/search/input_box.phtml",
          "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml",
          "transformation_overview.php||transformation_overview.php",
          "url.php||url.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ],
          "candidate": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ]
        }
      },
      "candidate_diff": {
        "index.php||index.php": [
          "File: index.php -> index.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "201:             }",
          "202:         } // end if",
          "203:         echo '    <li id=\"li_select_mysql_collation\" class=\"no_bullets\" >';",
          "205:            . PMA_URL_getHiddenInputs(null, null, 4, 'collation_connection')",
          "206:            . '            <label for=\"select_collation_connection\">' . \"\\n\"",
          "207:            . '                ' . PMA\\libraries\\Util::getImage('s_asci.png')",
          "",
          "[Removed Lines]",
          "204:         echo '        <form method=\"post\" action=\"index.php\">' . \"\\n\"",
          "",
          "[Added Lines]",
          "204:         echo '        <form method=\"post\" action=\"index.php\">' , \"\\n\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "307:     );",
          "309:     echo '    <li id=\"li_select_mysql_charset\">';",
          "311:        . '        <span lang=\"en\" dir=\"ltr\">';",
          "314:        . '        </span>'",
          "315:        . '    </li>'",
          "316:        . '  </ul>'",
          "",
          "[Removed Lines]",
          "310:     echo '        ' . __('Server charset:') . ' '",
          "312:     echo '           ' . $mysql_charsets_descriptions[$mysql_charset_map['utf-8']];",
          "313:     echo '           (' . $mysql_charset_map['utf-8'] . ')'",
          "",
          "[Added Lines]",
          "310:     echo '        ' , __('Server charset:') , ' '",
          "312:     echo '           ' , $mysql_charsets_descriptions[$mysql_charset_map['utf-8']];",
          "313:     echo '           (' , $mysql_charset_map['utf-8'] , ')'",
          "",
          "---------------"
        ],
        "js/messages.php||js/messages.php": [
          "File: js/messages.php -> js/messages.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "715: }",
          "728: $maxInputVars = ini_get('max_input_vars');",
          "",
          "[Removed Lines]",
          "718: echo \"var themeCalendarImage = '\" . $GLOBALS['pmaThemeImage']",
          "719:     . 'b_calendar.png' . \"';\\n\";",
          "722: echo \"var pmaThemeImage = '\" . $GLOBALS['pmaThemeImage'] . \"';\\n\";",
          "724: echo \"var mysql_doc_template = '\" . PMA\\libraries\\Util::getMySQLDocuURL('%s')",
          "725:     . \"';\\n\";",
          "",
          "[Added Lines]",
          "718: echo \"var themeCalendarImage = '\" , $GLOBALS['pmaThemeImage']",
          "719:     , 'b_calendar.png' , \"';\\n\";",
          "722: echo \"var pmaThemeImage = '\" , $GLOBALS['pmaThemeImage'] , \"';\\n\";",
          "724: echo \"var mysql_doc_template = '\" , PMA\\libraries\\Util::getMySQLDocuURL('%s')",
          "725:     , \"';\\n\";",
          "",
          "---------------"
        ],
        "libraries/plugins/auth/AuthenticationCookie.php||libraries/plugins/auth/AuthenticationCookie.php": [
          "File: libraries/plugins/auth/AuthenticationCookie.php -> libraries/plugins/auth/AuthenticationCookie.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "220:             echo '</select></div>';",
          "221:         } else {",
          "222:             echo '    <input type=\"hidden\" name=\"server\" value=\"'",
          "224:         } // end if (server choice)",
          "",
          "[Removed Lines]",
          "223:                 . $GLOBALS['server'] . '\" />';",
          "",
          "[Added Lines]",
          "223:                 , $GLOBALS['server'] , '\" />';",
          "",
          "---------------"
        ],
        "libraries/plugins/auth/swekey/swekey.auth.lib.php||libraries/plugins/auth/swekey/swekey.auth.lib.php": [
          "File: libraries/plugins/auth/swekey/swekey.auth.lib.php -> libraries/plugins/auth/swekey/swekey.auth.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "99:     {",
          "100:         var valids = \"<?php",
          "101:         foreach ($_SESSION['SWEKEY']['VALID_SWEKEYS'] as $key => $value) {",
          "103:         }",
          "104:         ?>\";",
          "105:         var connected_keys = Swekey_ListKeyIds().split(\",\");",
          "",
          "[Removed Lines]",
          "102:                 echo $key . ',';",
          "",
          "[Added Lines]",
          "102:                 echo $key , ',';",
          "",
          "---------------"
        ],
        "libraries/plugins/schema/ExportRelationSchema.php||libraries/plugins/schema/ExportRelationSchema.php": [
          "File: libraries/plugins/schema/ExportRelationSchema.php -> libraries/plugins/schema/ExportRelationSchema.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "286:     public static function dieSchema($pageNumber, $type = '', $error_message = '')",
          "287:     {",
          "289:         if (!empty($error_message)) {",
          "290:             $error_message = htmlspecialchars($error_message);",
          "291:         }",
          "",
          "[Removed Lines]",
          "288:         echo \"<p><strong>\" . __(\"SCHEMA ERROR: \") . $type . \"</strong></p>\" . \"\\n\";",
          "",
          "[Added Lines]",
          "288:         echo \"<p><strong>\" , __(\"SCHEMA ERROR: \") , $type , \"</strong></p>\" , \"\\n\";",
          "",
          "---------------"
        ],
        "libraries/rte/rte_export.lib.php||libraries/rte/rte_export.lib.php": [
          "File: libraries/rte/rte_export.lib.php -> libraries/rte/rte_export.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:             $export_data = '<textarea cols=\"40\" rows=\"15\" style=\"width: 100%;\">'",
          "38:                . $export_data . '</textarea>';",
          "39:             echo \"<fieldset>\\n\"",
          "43:         }",
          "44:     } else {",
          "45:         $_db = htmlspecialchars(PMA\\libraries\\Util::backquote($db));",
          "",
          "[Removed Lines]",
          "40:                . \"<legend>$title</legend>\\n\"",
          "41:                . $export_data",
          "42:                . \"</fieldset>\\n\";",
          "",
          "[Added Lines]",
          "40:                , \"<legend>$title</legend>\\n\"",
          "41:                , $export_data",
          "42:                , \"</fieldset>\\n\";",
          "",
          "---------------"
        ],
        "libraries/rte/rte_routines.lib.php||libraries/rte/rte_routines.lib.php": [
          "File: libraries/rte/rte_routines.lib.php -> libraries/rte/rte_routines.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1471:             $response->addJSON('dialog', false);",
          "1472:             exit;",
          "1473:         } else {",
          "1475:             if ($message->isError()) {",
          "",
          "[Removed Lines]",
          "1474:             echo $message->getDisplay() . $output;",
          "",
          "[Added Lines]",
          "1474:             echo $message->getDisplay() , $output;",
          "",
          "---------------"
        ],
        "setup/lib/form_processing.lib.php||setup/lib/form_processing.lib.php": [
          "File: setup/lib/form_processing.lib.php -> setup/lib/form_processing.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "49:     <div class=\"error\">",
          "50:         <h4><?php echo __('Warning') ?></h4>",
          "51:         <?php echo __('Submitted form contains errors') ?><br />",
          "53:             <?php echo __('Try to revert erroneous fields to their default values') ?>",
          "54:         </a>",
          "55:     </div>",
          "",
          "[Removed Lines]",
          "52:         <a href=\"<?php echo PMA_URL_getCommon() . $separator ?>page=<?php echo $page . $formset . $formId . $separator ?>mode=revert\">",
          "",
          "[Added Lines]",
          "52:         <a href=\"<?php echo PMA_URL_getCommon() , $separator ?>page=<?php echo $page , $formset , $formId , $separator ?>mode=revert\">",
          "",
          "---------------"
        ],
        "setup/lib/index.lib.php||setup/lib/index.lib.php": [
          "File: setup/lib/index.lib.php -> setup/lib/index.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "91:         }",
          "92:     }",
          "95:     foreach ($old_ids as $id) {",
          "96:         echo \"\\nhiddenMessages.push('$id');\";",
          "97:     }",
          "",
          "[Removed Lines]",
          "94:     echo \"\\n\" . '<script type=\"text/javascript\">';",
          "",
          "[Added Lines]",
          "94:     echo \"\\n\" , '<script type=\"text/javascript\">';",
          "",
          "---------------"
        ],
        "templates/database/structure/body_for_table_summary.phtml||templates/database/structure/body_for_table_summary.phtml": [
          "File: templates/database/structure/body_for_table_summary.phtml -> templates/database/structure/body_for_table_summary.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "66:         list($overhead_formatted, $overhead_unit)",
          "67:             = PMA\\libraries\\Util::formatByteDown($overhead_size, 3, 1);",
          "68:     ?>",
          "71: <?php endif; ?>",
          "72: <?php if ($GLOBALS['cfg']['ShowDbStructureComment']): ?>",
          "73:     <th></th>",
          "",
          "[Removed Lines]",
          "69:     <th class=\"value tbl_size\"><?php echo $sum_formatted . ' ' . $unit; ?></th>",
          "70:     <th class=\"value tbl_overhead\"><?php echo $overhead_formatted . ' ' . $overhead_unit; ?></th>",
          "",
          "[Added Lines]",
          "69:     <th class=\"value tbl_size\"><?php echo $sum_formatted , ' ' , $unit; ?></th>",
          "70:     <th class=\"value tbl_overhead\"><?php echo $overhead_formatted , ' ' , $overhead_unit; ?></th>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "90:                 : '-');?></th>",
          "91: <?php endif; ?>",
          "92: </tr>",
          "",
          "[Removed Lines]",
          "93: </tbody>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "templates/database/structure/check_all_tables.phtml||templates/database/structure/check_all_tables.phtml": [
          "File: templates/database/structure/check_all_tables.phtml -> templates/database/structure/check_all_tables.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: <div class=\"clearfloat print_ignore\">",
          "3:     <input type=\"checkbox\" id=\"tablesForm_checkall\" class=\"checkall_box\" title=\"<?php echo __('Check all'); ?>\" />",
          "4:     <label for=\"tablesForm_checkall\"><?php echo __('Check all'); ?></label>",
          "5:     <?php if ($overhead_check != ''): ?>",
          "",
          "[Removed Lines]",
          "2:     <img class=\"selectallarrow\" src=\"<?php echo $pmaThemeImage . 'arrow_' . $text_dir . '.png'; ?>\" width=\"38\" height=\"22\" alt=\"<?php __('With selected:'); ?>\" />",
          "",
          "[Added Lines]",
          "2:     <img class=\"selectallarrow\" src=\"<?php echo $pmaThemeImage , 'arrow_' , $text_dir , '.png'; ?>\" width=\"38\" height=\"22\" alt=\"<?php __('With selected:'); ?>\" />",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "38:         <?php endif; ?>",
          "39:     </select>",
          "40:     <?php echo implode(\"\\n\", $hidden_fields); ?>",
          "",
          "[Removed Lines]",
          "41: </div>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "templates/database/structure/structure_table_row.phtml||templates/database/structure/structure_table_row.phtml": [
          "File: templates/database/structure/structure_table_row.phtml -> templates/database/structure/structure_table_row.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "8:                id=\"checkbox_tbl_<?php echo $curr; ?>\" />",
          "9:     </td>",
          "10:     <th>",
          "12:     </th>",
          "13:     <?php if ($server_slave_status): ?>",
          "14:         <td class=\"center\">",
          "",
          "[Removed Lines]",
          "11:         <?php echo $browse_table_label . $tracking_icon; ?>",
          "",
          "[Added Lines]",
          "11:         <?php echo $browse_table_label , $tracking_icon; ?>",
          "",
          "---------------"
        ],
        "templates/table/chart/tbl_chart.phtml||templates/table/chart/tbl_chart.phtml": [
          "File: templates/table/chart/tbl_chart.phtml -> templates/table/chart/tbl_chart.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "86:                 <input type=\"hidden\" name=\"dateTimeCols\" value=\"<?php $date_time_types = array('date', 'datetime', 'timestamp');",
          "87:                     foreach ($keys as $idx => $key) {",
          "88:                         if (in_array($fields_meta[$idx]->type, $date_time_types)) {",
          "90:                         }",
          "91:                     }?>\"",
          "92:                 />",
          "93:                 <input type=\"hidden\" name=\"numericCols\" value=\"<?php",
          "94:                     foreach ($keys as $idx => $key) {",
          "95:                         if (in_array($fields_meta[$idx]->type, $numeric_types)) {",
          "97:                         }",
          "98:                     }?>\"",
          "99:                 />",
          "",
          "[Removed Lines]",
          "89:                             echo $idx . ' ';",
          "96:                             echo $idx . ' ';",
          "",
          "[Added Lines]",
          "89:                             echo $idx , ' ';",
          "96:                             echo $idx , ' ';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "156:             </div>",
          "157:         </fieldset>",
          "158:     </form>",
          "",
          "[Removed Lines]",
          "159: </div>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "templates/table/gis_visualization/gis_visualization.phtml||templates/table/gis_visualization/gis_visualization.phtml": [
          "File: templates/table/gis_visualization/gis_visualization.phtml -> templates/table/gis_visualization/gis_visualization.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "49:                     </span>",
          "50:                     <ul>",
          "51:                         <li class=\"warp_link\">",
          "53:                         </li>",
          "54:                         <li class=\"warp_link\">",
          "56:                         </li>",
          "57:                         <li class=\"warp_link\">",
          "59:                         </li>",
          "60:                     </ul>",
          "61:                 </div>",
          "",
          "[Removed Lines]",
          "52:                             <a href=\"<?php echo $downloadUrl . '&fileFormat=png'; ?>\" class=\"disableAjax\">PNG</a>",
          "55:                             <a href=\"<?php echo $downloadUrl . '&fileFormat=pdf'; ?>\" class=\"disableAjax\">PDF</a>",
          "58:                             <a href=\"<?php echo $downloadUrl . '&fileFormat=svg'; ?>\" class=\"disableAjax\">SVG</a>",
          "",
          "[Added Lines]",
          "52:                             <a href=\"<?php echo $downloadUrl , '&fileFormat=png'; ?>\" class=\"disableAjax\">PNG</a>",
          "55:                             <a href=\"<?php echo $downloadUrl , '&fileFormat=pdf'; ?>\" class=\"disableAjax\">PDF</a>",
          "58:                             <a href=\"<?php echo $downloadUrl , '&fileFormat=svg'; ?>\" class=\"disableAjax\">SVG</a>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "79:             }",
          "80:         </script>",
          "81:     </fieldset>",
          "",
          "[Removed Lines]",
          "82: </div>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "templates/table/search/input_box.phtml||templates/table/search/input_box.phtml": [
          "File: templates/table/search/input_box.phtml -> templates/table/search/input_box.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "5:     && PMA_searchColumnInForeigners($_foreigners, $column_name)): ?>",
          "6:     <?php if (is_array($foreignData['disp_row'])): ?>",
          "7:         <select name=\"criteriaValues[<?php echo $column_index; ?>]\"",
          "9:             <?php echo PMA_foreignDropdown(",
          "10:                 $foreignData['disp_row'], $foreignData['foreign_field'],",
          "11:                 $foreignData['foreign_display'], '', $foreignMaxLimit",
          "",
          "[Removed Lines]",
          "8:                 id=\"<?php echo $column_id . $column_index; ?>\">",
          "",
          "[Added Lines]",
          "8:                 id=\"<?php echo $column_id , $column_index; ?>\">",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "13:         </select>",
          "14:     <?php elseif ($foreignData['foreign_link'] == true): ?>",
          "15:         <input type=\"text\"",
          "17:                name=\"criteriaValues[<?php echo $column_index; ?>]\"",
          "18:                id=\"field_<?php echo md5($column_name); ?>[<?php echo $column_index; ?>]\"",
          "19:                class=\"textfield\"",
          "",
          "[Removed Lines]",
          "16:                id=\"<?php echo $column_id . $column_index; ?>\"",
          "",
          "[Added Lines]",
          "16:                id=\"<?php echo $column_id , $column_index; ?>\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "79:         || (strncasecmp($column_type, 'set', 3) && $in_zoom_search_edit)",
          "80:     ): ?>",
          "81:         <select name=\"criteriaValues[<?php echo $column_index; ?>]\"",
          "83:     <?php else: ?>",
          "84:         <select name=\"criteriaValues[<?php echo $column_index; ?>]\"",
          "86:                 multiple=\"multiple\"",
          "87:                 size=\"<?php echo min(3, $cnt_value); ?>\">",
          "88:     <?php endif; ?>",
          "",
          "[Removed Lines]",
          "82:                 id=\"<?php echo $column_id . $column_index; ?>\">",
          "85:                 id=\"<?php echo $column_id . $column_index; ?>\"",
          "",
          "[Added Lines]",
          "82:                 id=\"<?php echo $column_id , $column_index; ?>\">",
          "85:                 id=\"<?php echo $column_id , $column_index; ?>\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "125:            name=\"criteriaValues[<?php echo $column_index; ?>]\"",
          "126:            size=\"40\"",
          "127:            class=\"<?php echo $the_class; ?>\"",
          "129:            <?php if (isset($criteriaValues[$column_index])",
          "130:                && is_string($criteriaValues[$column_index])",
          "131:            ): ?>",
          "132:                value=\"<?php echo $criteriaValues[$column_index]; ?>\"",
          "133:            <?php endif; ?>/>",
          "",
          "[Removed Lines]",
          "128:            id=\"<?php echo $column_id .  $column_index; ?>\"",
          "135: <?php endif; ?>",
          "",
          "[Added Lines]",
          "128:            id=\"<?php echo $column_id , $column_index; ?>\"",
          "",
          "---------------"
        ],
        "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml": [
          "File: templates/table/structure/display_partitions.phtml -> templates/table/structure/display_partitions.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "10:         <?php else: ?>",
          "11:             <p>",
          "12:                 <?php echo __('Partitioned by:');?>",
          "14:             </p>",
          "15:             <?php if ($hasSubPartitions): ?>",
          "16:                 <p>",
          "17:                     <?php echo __('Sub partitioned by:'); ?>",
          "19:                 <p>",
          "20:             <?php endif; ?>",
          "21:             <table>",
          "",
          "[Removed Lines]",
          "13:                 <code><?php echo $partitionMethod . '(' . $partitionExpression . ' )'; ?></code>",
          "18:                     <code><?php echo $subPartitionMethod . '(' . $subPartitionExpression . ' )'; ?></code>",
          "",
          "[Added Lines]",
          "13:                 <code><?php echo $partitionMethod , '(' , $partitionExpression , ' )'; ?></code>",
          "18:                     <code><?php echo $subPartitionMethod , '(' , $subPartitionExpression , ' )'; ?></code>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "140:             <?php endif; ?>",
          "141:         </form>",
          "142:     </fieldset>",
          "",
          "[Removed Lines]",
          "143: </div>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "transformation_overview.php||transformation_overview.php": [
          "File: transformation_overview.php -> transformation_overview.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:     if (isset($types['empty_mimetype'][$mimetype])) {",
          "27:         echo '<i>' . $mimetype . '</i><br />';",
          "28:     } else {",
          "30:     }",
          "32: }",
          "",
          "[Removed Lines]",
          "29:         echo $mimetype . '<br />';",
          "",
          "[Added Lines]",
          "29:         echo $mimetype , '<br />';",
          "",
          "---------------"
        ],
        "url.php||url.php": [
          "File: url.php -> url.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "29:     echo \"<script type='text/javascript'>",
          "30:             window.onload=function(){",
          "32:             }",
          "33:         </script>\";",
          "",
          "[Removed Lines]",
          "31:                 window.location='\" . PMA_escapeJsString($_REQUEST['url']) . \"';",
          "",
          "[Added Lines]",
          "31:                 window.location='\" , PMA_escapeJsString($_REQUEST['url']) , \"';",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e6756427e4bc461d4e939460012929c2bafec7f9",
      "candidate_info": {
        "commit_hash": "e6756427e4bc461d4e939460012929c2bafec7f9",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/e6756427e4bc461d4e939460012929c2bafec7f9",
        "files": [
          "libraries/controllers/TableStructureController.class.php",
          "libraries/sql.lib.php",
          "templates/table/structure/display_partitions.phtml",
          "templates/table/structure/display_structure.phtml"
        ],
        "message": "Add partition maintenance actions\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "libraries/controllers/TableStructureController.class.php||libraries/controllers/TableStructureController.class.php",
          "libraries/sql.lib.php||libraries/sql.lib.php",
          "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml",
          "templates/table/structure/display_structure.phtml||templates/table/structure/display_structure.phtml"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ],
          "candidate": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ]
        }
      },
      "candidate_diff": {
        "libraries/controllers/TableStructureController.class.php||libraries/controllers/TableStructureController.class.php": [
          "File: libraries/controllers/TableStructureController.class.php -> libraries/controllers/TableStructureController.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "282:             $db = $this->db;",
          "",
          "[Removed Lines]",
          "279:         if (isset($_REQUEST['add_key'])) {",
          "",
          "[Added Lines]",
          "279:         if (isset($_REQUEST['add_key'])",
          "280:             || isset($_REQUEST['partition_maintenance'])",
          "281:         ) {",
          "",
          "---------------"
        ],
        "libraries/sql.lib.php||libraries/sql.lib.php": [
          "File: libraries/sql.lib.php -> libraries/sql.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1234:     include_once 'libraries/transformations.lib.php';",
          "1235:     $statement = $analyzed_sql_results['statement'];",
          "1236:     if ($statement instanceof SqlParser\\Statements\\AlterStatement) {",
          "1238:             if (!empty($statement->altered[0]->field->column)) {",
          "1239:                 PMA_clearTransformations(",
          "1240:                     $db,",
          "",
          "[Removed Lines]",
          "1237:         if ($statement->altered[0]->options->has('DROP')) {",
          "",
          "[Added Lines]",
          "1237:         if (!empty($statement->altered[0])",
          "1238:             && $statement->altered[0]->options->has('DROP')",
          "1239:         ) {",
          "",
          "---------------"
        ],
        "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml": [
          "File: templates/table/structure/display_partitions.phtml -> templates/table/structure/display_partitions.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "11:                     <th><?php echo __('Rows'); ?></th>",
          "12:                     <th><?php echo __('Data length'); ?></th>",
          "13:                     <th><?php echo __('Index length'); ?></th>",
          "15:                 </tr>",
          "16:             </thead>",
          "17:             <tbody>",
          "18:             <?php $odd = true; ?>",
          "19:             <?php foreach ($partitions as $partition): ?>",
          "20:                 <tr class=\"noclick <?php echo $odd ? 'odd' : 'even' ?>\">",
          "21:                     <?php if ($partition->hasSubParitions()): ?>",
          "",
          "[Removed Lines]",
          "14:                     <th><?php echo __('Action'); ?></th>",
          "",
          "[Added Lines]",
          "14:                     <th colspan=\"7\"><?php echo __('Action'); ?></th>",
          "19:             <?php",
          "20:                 $titles = array(",
          "21:                     'ANALYZE' => PMA_Util::getIcon('b_empty.png', __('Analyze')),",
          "22:                     'CHECK' => PMA_Util::getIcon('eye.png', __('Check')),",
          "23:                     'OPTIMIZE' => PMA_Util::getIcon('normalize.png', __('Optimize')),",
          "24:                     'REBUILD' => PMA_Util::getIcon('b_empty.png', __('Rebuild')),",
          "25:                     'REPAIR' => PMA_Util::getIcon('b_tblops.png', __('Repair')),",
          "26:                     'TRUNCATE' => PMA_Util::getIcon('b_empty.png', __('Truncate')),",
          "27:                     'DROP' => PMA_Util::getIcon('b_drop.png', __('Drop'))",
          "28:                 );",
          "29:             ?>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "42:                         <span><?php echo $value; ?></span>",
          "43:                         <span class=\"unit\"><?php echo $unit; ?></span>",
          "44:                     </td>",
          "46:                     <?php if ($partition->hasSubParitions()): ?>",
          "47:                         <?php foreach ($partition->getSubParitions() as $subParition): ?>",
          "48:                             <tr class=\"noclick <?php echo $odd ? 'odd' : 'even' ?>\">",
          "",
          "[Removed Lines]",
          "45:                     <td></td>",
          "",
          "[Added Lines]",
          "56:                     <?php foreach ($titles as $operation => $title): ?>",
          "57:                         <td>",
          "58:                             <a href=\"tbl_structure.php<?php echo $url_query; ?>&amp;partition_maintenance=1&amp;sql_query=<?php echo urlencode(",
          "59:                                 \"ALTER TABLE \" . PMA_Util::backquote($table) . $operation . \" PARTITION \" . $partition->getName()",
          "60:                             ) ?>\">",
          "61:                                 <?php echo $title; ?>",
          "62:                             </a>",
          "63:                         </td>",
          "64:                     <?php endforeach; ?>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "66:                                     <span><?php echo $value; ?></span>",
          "67:                                     <span class=\"unit\"><?php echo $unit; ?></span>",
          "68:                                 </td>",
          "70:                             </tr>",
          "71:                         <?php endforeach; ?>",
          "72:                     <?php endif; ?>",
          "",
          "[Removed Lines]",
          "69:                                 <td></td>",
          "",
          "[Added Lines]",
          "89:                                 <td colspan=\"7\"></td>",
          "",
          "---------------"
        ],
        "templates/table/structure/display_structure.phtml||templates/table/structure/display_structure.phtml": [
          "File: templates/table/structure/display_structure.phtml -> templates/table/structure/display_structure.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "168: if (! is_null($partition_names[0])) {",
          "169:     echo PMA\\Template::get('table/structure/display_partitions')->render(",
          "170:         array(",
          "172:         )",
          "173:     );",
          "174: }",
          "",
          "[Removed Lines]",
          "171:             'partitions' => PMA_Partition::getParititions($db, $table)",
          "",
          "[Added Lines]",
          "171:             'table' => $table,",
          "172:             'url_query'  => $url_query,",
          "173:             'partitions' => PMA_Partition::getParititions($db, $table),",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "57af2402bc98681346709efbcb8299fd9249ff65",
      "candidate_info": {
        "commit_hash": "57af2402bc98681346709efbcb8299fd9249ff65",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/57af2402bc98681346709efbcb8299fd9249ff65",
        "files": [
          "libraries/Partition.class.php",
          "templates/table/structure/display_partitions.phtml"
        ],
        "message": "Add comment column to partition details\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "libraries/Partition.class.php||libraries/Partition.class.php",
          "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ],
          "candidate": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ]
        }
      },
      "candidate_diff": {
        "libraries/Partition.class.php||libraries/Partition.class.php": [
          "File: libraries/Partition.class.php -> libraries/Partition.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "54:     protected $indexLength;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "58:     protected $comment;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "62:     {",
          "63:         $this->db = $row['TABLE_SCHEMA'];",
          "64:         $this->table = $row['TABLE_NAME'];",
          "65:         $this->loadData($row);",
          "66:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "69:         $this->comment = $row['PARTITION_COMMENT'];",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "164:     {",
          "165:         return $this->indexLength;",
          "166:     }",
          "167: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "178:     public function getComment()",
          "179:     {",
          "180:         return $this->comment;",
          "181:     }",
          "",
          "---------------"
        ],
        "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml": [
          "File: templates/table/structure/display_partitions.phtml -> templates/table/structure/display_partitions.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "24:                     <th><?php echo __('Rows'); ?></th>",
          "25:                     <th><?php echo __('Data length'); ?></th>",
          "26:                     <th><?php echo __('Index length'); ?></th>",
          "27:                     <th colspan=\"7\"><?php echo __('Action'); ?></th>",
          "28:                 </tr>",
          "29:             </thead>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "27:                     <th><?php echo __('Comment'); ?></th>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "67:                         <span><?php echo $value; ?></span>",
          "68:                         <span class=\"unit\"><?php echo $unit; ?></span>",
          "69:                     </td>",
          "70:                     <?php foreach ($actionIcons as $action => $icon): ?>",
          "71:                         <td>",
          "72:                             <a  href=\"tbl_structure.php<?php echo $url_query; ?>&amp;partition_maintenance=1&amp;sql_query=<?php echo urlencode(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "71:                     <td><?php echo $partition->getComment(); ?></td>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "107:                                     <span><?php echo $value; ?></span>",
          "108:                                     <span class=\"unit\"><?php echo $unit; ?></span>",
          "109:                                 </td>",
          "110:                                 <td colspan=\"7\"></td>",
          "111:                             </tr>",
          "112:                         <?php endforeach; ?>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "112:                                 <td><?php echo $subParition->getComment(); ?></td>",
          "",
          "---------------"
        ]
      }
    }
  ]
}