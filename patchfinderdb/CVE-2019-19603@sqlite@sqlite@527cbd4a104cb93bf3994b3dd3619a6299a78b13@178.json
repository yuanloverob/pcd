{
  "cve_id": "CVE-2019-19603",
  "cve_desc": "SQLite 3.30.1 mishandles certain SELECT statements with a nonexistent VIEW, leading to an application crash.",
  "repo": "sqlite/sqlite",
  "patch_hash": "527cbd4a104cb93bf3994b3dd3619a6299a78b13",
  "patch_info": {
    "commit_hash": "527cbd4a104cb93bf3994b3dd3619a6299a78b13",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/527cbd4a104cb93bf3994b3dd3619a6299a78b13",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/build.c",
      "src/sqliteInt.h",
      "test/altertab.test"
    ],
    "message": "Do not allow CREATE TABLE or CREATE VIEW of an object with a name that looks like a shadow table name.\n\nFossilOrigin-Name: 6aef58b629d89955f85f65191ba2be67b2adfac4f0327fe9a7141cb2705dbc00",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/build.c||src/build.c",
      "src/sqliteInt.h||src/sqliteInt.h",
      "test/altertab.test||test/altertab.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 8ad34d36a141fa8f5d9bd784dfeb892c983897a6dc6b867607cc668508acf944",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/build.c||src/build.c": [
      "File: src/build.c -> src/build.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "856:       }",
      "857:     }",
      "858:   }else{",
      "861:     ){",
      "862:       sqlite3ErrorMsg(pParse, \"object name reserved for internal use: %s\",",
      "863:                       zName);",
      "864:       return SQLITE_ERROR;",
      "865:     }",
      "866:   }",
      "867:   return SQLITE_OK;",
      "868: }",
      "",
      "[Removed Lines]",
      "859:     if( pParse->nested==0",
      "860:      && 0==sqlite3StrNICmp(zName, \"sqlite_\", 7)",
      "",
      "[Added Lines]",
      "859:     if( (pParse->nested==0 && 0==sqlite3StrNICmp(zName, \"sqlite_\", 7))",
      "860:      || (sqlite3ReadOnlyShadowTables(db) && sqlite3ShadowTableName(db, zName))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "2132: static int isShadowTableName(sqlite3 *db, char *zName){",
      "",
      "[Added Lines]",
      "2133: int sqlite3ShadowTableName(sqlite3 *db, const char *zName){",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "2147:   if( pMod->pModule->xShadowName==0 ) return 0;",
      "2148:   return pMod->pModule->xShadowName(zTail+1);",
      "2149: }",
      "",
      "[Removed Lines]",
      "2150: #else",
      "2151: # define isShadowTableName(x,y) 0",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "2190:   p = pParse->pNewTable;",
      "2191:   if( p==0 ) return;",
      "2194:     p->tabFlags |= TF_Shadow;",
      "2195:   }",
      "",
      "[Removed Lines]",
      "2193:   if( pSelect==0 && isShadowTableName(db, p->zName) ){",
      "",
      "[Added Lines]",
      "2192:   if( pSelect==0 && sqlite3ShadowTableName(db, p->zName) ){",
      "",
      "---------------"
    ],
    "src/sqliteInt.h||src/sqliteInt.h": [
      "File: src/sqliteInt.h -> src/sqliteInt.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "4548: #  define sqlite3VtabInSync(db) ((db)->nVTrans>0 && (db)->aVTrans==0)",
      "4549: #endif",
      "4550: int sqlite3ReadOnlyShadowTables(sqlite3 *db);",
      "4551: int sqlite3VtabEponymousTableInit(Parse*,Module*);",
      "4552: void sqlite3VtabEponymousTableClear(sqlite3*,Module*);",
      "4553: void sqlite3VtabMakeWritable(Parse*,Table*);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4551: #ifndef SQLITE_OMIT_VIRTUALTABLE",
      "4552:   int sqlite3ShadowTableName(sqlite3 *db, const char *zName);",
      "4553: #else",
      "4554: # define sqlite3ShadowTableName(A,B) 0",
      "4555: #endif",
      "",
      "---------------"
    ],
    "test/altertab.test||test/altertab.test": [
      "File: test/altertab.test -> test/altertab.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "547:   } {1 {table y1_segments may not be modified}}",
      "549:   do_catchsql_test 16.20 {",
      "554:     DROP TABLE y1_segments;",
      "555:   } {1 {table y1_segments may not be dropped}}",
      "557:   do_execsql_test 16.30 {",
      "558:     ALTER TABLE y1 RENAME TO z1;",
      "559:   }",
      "",
      "[Removed Lines]",
      "550:     ALTER TABLE y1_segments RENAME TO abc;",
      "551:   } {1 {table y1_segments may not be altered}}",
      "553:   do_catchsql_test 16.21 {",
      "",
      "[Added Lines]",
      "553:   do_catchsql_test 16.20 {",
      "554:     ALTER TABLE y1_segments RENAME TO abc;",
      "555:   } {1 {table y1_segments may not be altered}}",
      "556:   sqlite3_db_config db DEFENSIVE 0",
      "557:   do_catchsql_test 16.22 {",
      "558:     ALTER TABLE y1_segments RENAME TO abc;",
      "559:   } {0 {}}",
      "560:   sqlite3_db_config db DEFENSIVE 1",
      "561:   do_catchsql_test 16.23 {",
      "562:     CREATE TABLE y1_segments AS SELECT * FROM abc;",
      "563:   } {1 {object name reserved for internal use: y1_segments}}",
      "564:   do_catchsql_test 16.24 {",
      "565:     CREATE VIEW y1_segments AS SELECT * FROM abc;",
      "566:   } {1 {object name reserved for internal use: y1_segments}}",
      "567:   sqlite3_db_config db DEFENSIVE 0",
      "568:   do_catchsql_test 16.25 {",
      "569:     ALTER TABLE abc RENAME TO y1_segments;",
      "570:   } {0 {}}",
      "571:   sqlite3_db_config db DEFENSIVE 1",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "62742fd2647ccd6a5cd2f899db70b6062f671c33",
      "candidate_info": {
        "commit_hash": "62742fd2647ccd6a5cd2f899db70b6062f671c33",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/62742fd2647ccd6a5cd2f899db70b6062f671c33",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/select.c",
          "src/window.c",
          "test/window9.test"
        ],
        "message": "Ensure collation sequences and affinities work in window function queries. Fix for [9ece23d2].\n\nFossilOrigin-Name: 28196d894ac9fad9d8f877c7bf17ec9d299d12acdcc942f9ea0783777b14fdc5",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/select.c||src/select.c",
          "src/window.c||src/window.c",
          "test/window9.test||test/window9.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: cb3dec427e399064eeec31c15565346f045bd7c46d2f7860b1cd346bbcccb124",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/select.c||src/select.c": [
          "File: src/select.c -> src/select.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2096:   if( pTab==0 ){",
          "2097:     return 0;",
          "2098:   }",
          "2102:   pTab->nTabRef = 1;",
          "2103:   pTab->zName = 0;",
          "2104:   pTab->nRowLogEst = 200; assert( 200==sqlite3LogEst(1048576) );",
          "",
          "[Removed Lines]",
          "2101:   assert( db->lookaside.bDisable );",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/window.c||src/window.c": [
          "File: src/window.c -> src/window.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "736:   Window *pWin;",
          "737:   SrcList *pSrc;",
          "738:   ExprList *pSub;",
          "740: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "739:   Table *pTab;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "796:         pExpr->op = TK_COLUMN;",
          "797:         pExpr->iColumn = p->pSub->nExpr-1;",
          "798:         pExpr->iTable = p->pWin->iEphCsr;",
          "799:       }",
          "801:       break;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "800:         pExpr->y.pTab = p->pTab;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "839:   Window *pWin,",
          "840:   SrcList *pSrc,",
          "843: ){",
          "844:   Walker sWalker;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "844:   Table *pTab,",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "850:   sRewrite.pSub = *ppSub;",
          "851:   sRewrite.pWin = pWin;",
          "852:   sRewrite.pSrc = pSrc;",
          "854:   sWalker.pParse = pParse;",
          "855:   sWalker.xExprCallback = selectWindowRewriteExprCb;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "856:   sRewrite.pTab = pTab;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "913:     p->pSrc = 0;",
          "914:     p->pWhere = 0;",
          "915:     p->pGroupBy = 0;",
          "916:     p->pHaving = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "916:     Table *pTab;",
          "918:     pTab = sqlite3DbMallocZero(db, sizeof(Table));",
          "919:     if( pTab==0 ){",
          "920:       return SQLITE_NOMEM;",
          "921:     }",
          "927:     p->selFlags &= ~SF_Aggregate;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "933:     pMWin->iEphCsr = pParse->nTab++;",
          "934:     pParse->nTab += 3;",
          "938:     pMWin->nBufferCol = (pSublist ? pSublist->nExpr : 0);",
          "",
          "[Removed Lines]",
          "936:     selectWindowRewriteEList(pParse, pMWin, pSrc, p->pEList, &pSublist);",
          "937:     selectWindowRewriteEList(pParse, pMWin, pSrc, p->pOrderBy, &pSublist);",
          "",
          "[Added Lines]",
          "947:     selectWindowRewriteEList(pParse, pMWin, pSrc, p->pEList, pTab, &pSublist);",
          "948:     selectWindowRewriteEList(pParse, pMWin, pSrc, p->pOrderBy, pTab, &pSublist);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "976:     );",
          "977:     p->pSrc = sqlite3SrcListAppend(pParse, 0, 0, 0);",
          "978:     if( p->pSrc ){",
          "979:       p->pSrc->a[0].pSelect = pSub;",
          "980:       sqlite3SrcListAssignCursors(pParse, p->pSrc);",
          "982:         rc = SQLITE_NOMEM;",
          "983:       }else{",
          "987:       }",
          "989:       sqlite3VdbeAddOp2(v, OP_OpenEphemeral, pMWin->iEphCsr, pSublist->nExpr);",
          "990:       sqlite3VdbeAddOp2(v, OP_OpenDup, pMWin->iEphCsr+1, pMWin->iEphCsr);",
          "991:       sqlite3VdbeAddOp2(v, OP_OpenDup, pMWin->iEphCsr+2, pMWin->iEphCsr);",
          "",
          "[Removed Lines]",
          "981:       if( sqlite3ExpandSubquery(pParse, &p->pSrc->a[0]) ){",
          "984:         pSub->selFlags |= SF_Expanded;",
          "985:         p->selFlags &= ~SF_Aggregate;",
          "986:         sqlite3SelectPrep(pParse, pSub, 0);",
          "",
          "[Added Lines]",
          "990:       Table *pTab2;",
          "993:       pSub->selFlags |= SF_Expanded;",
          "994:       pTab2 = sqlite3ResultSetOfSelect(pParse, pSub);",
          "995:       if( pTab2==0 ){",
          "998:         memcpy(pTab, pTab2, sizeof(Table));",
          "999:         pTab->tabFlags |= TF_Ephemeral;",
          "1000:         p->pSrc->a[0].pTab = pTab;",
          "1001:         pTab = pTab2;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "994:       sqlite3SelectDelete(db, pSub);",
          "995:     }",
          "996:     if( db->mallocFailed ) rc = SQLITE_NOMEM;",
          "997:   }",
          "999:   return rc;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1011:     sqlite3DbFree(db, pTab);",
          "",
          "---------------"
        ],
        "test/window9.test||test/window9.test": [
          "File: test/window9.test -> test/window9.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # 2019 June 8",
          "2: #",
          "3: # The author disclaims copyright to this source code.  In place of",
          "4: # a legal notice, here is a blessing:",
          "5: #",
          "6: #    May you do good and not evil.",
          "7: #    May you find forgiveness for yourself and forgive others.",
          "8: #    May you share freely, never taking more than you give.",
          "9: #",
          "10: #***********************************************************************",
          "11: # This file implements regression tests for SQLite library.",
          "12: #",
          "14: set testdir [file dirname $argv0]",
          "15: source $testdir/tester.tcl",
          "16: set testprefix window9",
          "18: ifcapable !windowfunc {",
          "19:   finish_test",
          "20:   return",
          "21: }",
          "23: do_execsql_test 1.0 {",
          "24:   CREATE TABLE fruits(",
          "25:      name TEXT COLLATE NOCASE,",
          "26:      color TEXT COLLATE NOCASE",
          "27:   );",
          "28: }",
          "30: do_execsql_test 1.1 {",
          "31:   INSERT INTO fruits (name, color) VALUES ('apple', 'RED');",
          "32:   INSERT INTO fruits (name, color) VALUES ('APPLE', 'yellow');",
          "33:   INSERT INTO fruits (name, color) VALUES ('pear', 'YELLOW');",
          "34:   INSERT INTO fruits (name, color) VALUES ('PEAR', 'green');",
          "35: }",
          "37: do_execsql_test 1.2 {",
          "38:   SELECT name, color, dense_rank() OVER (ORDER BY name) FROM fruits;",
          "39: } {",
          "40:   apple RED    1",
          "41:   APPLE yellow 1",
          "42:   pear  YELLOW 2",
          "43:   PEAR  green  2",
          "44: }",
          "46: do_execsql_test 1.3 {",
          "47:   SELECT name, color,",
          "48:     dense_rank() OVER (PARTITION BY name ORDER BY color)",
          "49:   FROM fruits;",
          "50: } {",
          "51:   apple RED    1",
          "52:   APPLE yellow 2",
          "53:   PEAR green   1",
          "54:   pear YELLOW  2",
          "55: }",
          "57: do_execsql_test 1.4 {",
          "58:   SELECT name, color,",
          "59:     dense_rank() OVER (ORDER BY name),",
          "60:     dense_rank() OVER (PARTITION BY name ORDER BY color)",
          "61:   FROM fruits;",
          "62: } {",
          "63:   apple RED    1 1",
          "64:   APPLE yellow 1 2",
          "65:   PEAR  green  2 1",
          "66:   pear  YELLOW 2 2",
          "67: }",
          "69: do_execsql_test 1.5 {",
          "70:   SELECT name, color,",
          "71:     dense_rank() OVER (ORDER BY name),",
          "72:     dense_rank() OVER (PARTITION BY name ORDER BY color)",
          "73:   FROM fruits ORDER BY color;",
          "74: } {",
          "75:   PEAR  green  2 1",
          "76:   apple RED    1 1",
          "77:   APPLE yellow 1 2",
          "78:   pear  YELLOW 2 2",
          "79: }",
          "81: do_execsql_test 2.0 {",
          "82:   CREATE TABLE t1(a BLOB, b INTEGER, c COLLATE nocase);",
          "83:   INSERT INTO t1 VALUES(1, 2, 'abc');",
          "84:   INSERT INTO t1 VALUES(3, 4, 'ABC');",
          "85: }",
          "87: do_execsql_test 2.1.1 {",
          "88:   SELECT c=='Abc' FROM t1",
          "89: } {1     1}",
          "90: do_execsql_test 2.1.2 {",
          "91:   SELECT c=='Abc', rank() OVER (ORDER BY b) FROM t1",
          "92: } {1 1   1 2}",
          "94: do_execsql_test 2.2.1 {",
          "95:   SELECT b=='2' FROM t1",
          "96: } {1     0}",
          "97: do_execsql_test 2.2.2 {",
          "98:   SELECT b=='2', rank() OVER (ORDER BY a) FROM t1",
          "99: } {1 1   0 2}",
          "101: finish_test",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7e427337fe5df62439b980e2e091a89b36001d79",
      "candidate_info": {
        "commit_hash": "7e427337fe5df62439b980e2e091a89b36001d79",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/7e427337fe5df62439b980e2e091a89b36001d79",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/util.c"
        ],
        "message": "Faster and smaller implementation of sqlite3StrICmp().\n\nFossilOrigin-Name: 7ac500fb5abfe1ad60f2ffdcc8fbe5ccc1c641bbeed53f00940e9ff78788e53d",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/util.c||src/util.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 884b4b7e502b4e991677b53971277adfaf0a04a284f8e483e2553d0f83156b50",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/util.c||src/util.c": [
          "File: src/util.c -> src/util.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "322: }",
          "323: int sqlite3StrICmp(const char *zLeft, const char *zRight){",
          "324:   unsigned char *a, *b;",
          "326:   a = (unsigned char *)zLeft;",
          "327:   b = (unsigned char *)zRight;",
          "328:   for(;;){",
          "331:     a++;",
          "332:     b++;",
          "333:   }",
          "",
          "[Removed Lines]",
          "325:   int c;",
          "329:     c = (int)UpperToLower[*a] - (int)UpperToLower[*b];",
          "330:     if( c || *a==0 ) break;",
          "",
          "[Added Lines]",
          "325:   int c, x;",
          "329:     c = *a;",
          "330:     x = *b;",
          "331:     if( c==x ){",
          "332:       if( c==0 ) break;",
          "333:     }else{",
          "334:       c = (int)UpperToLower[c] - (int)UpperToLower[x];",
          "335:       if( c ) break;",
          "336:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "119e1ffc5eb7783dbee1553f0239c3fea587a11d",
      "candidate_info": {
        "commit_hash": "119e1ffc5eb7783dbee1553f0239c3fea587a11d",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/119e1ffc5eb7783dbee1553f0239c3fea587a11d",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/btree.c"
        ],
        "message": "The defragmentPage() routine detects corruption in the first-free-slot fields at offset 1 in the header and throws an error, rather than asserting.\n\nFossilOrigin-Name: fb125bd338ab32b33d02fe61b76497b6d4a2a160056d6e759e15c94903e61a41",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/btree.c||src/btree.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: e3fde56da46e9592143b8beeee5eba4d74b8ef67edb7bf73a85edd2e0f7a8d21",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/btree.c||src/btree.c": [
          "File: src/btree.c -> src/btree.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1433:   if( (int)data[hdr+7]<=nMaxFrag ){",
          "1434:     int iFree = get2byte(&data[hdr+1]);",
          "1440:     if( iFree ){",
          "1441:       int iFree2 = get2byte(&data[iFree]);",
          "1442:       if( iFree2>usableSize-4 ) return SQLITE_CORRUPT_PAGE(pPage);",
          "",
          "[Removed Lines]",
          "1439:     assert( iFree<=usableSize-4 );",
          "",
          "[Added Lines]",
          "1435:     if( iFree>usableSize-4 ) return SQLITE_CORRUPT_PAGE(pPage);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fcb02429ecf97820b363f4ad505afa2f3d779dc5",
      "candidate_info": {
        "commit_hash": "fcb02429ecf97820b363f4ad505afa2f3d779dc5",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/fcb02429ecf97820b363f4ad505afa2f3d779dc5",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/attach.c",
          "test/corruptL.test",
          "test/memdb1.test"
        ],
        "message": "When deserializing a database (sqlite3_deserialize()), do not attempt to parse the schema before the data is loaded.\n\nFossilOrigin-Name: 4e1b005e8b397a22161a6b89cbd3f17bda70a6e0a86d8abdc61856edf2a74da4",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/attach.c||src/attach.c",
          "test/corruptL.test||test/corruptL.test",
          "test/memdb1.test||test/memdb1.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: c4f0568fde1d4070e7522ec36c0958be7426076002a7fa2da12a46411ab2e92d",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/attach.c||src/attach.c": [
          "File: src/attach.c -> src/attach.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "234:     sqlite3BtreeEnterAll(db);",
          "235:     db->init.iDb = 0;",
          "236:     db->mDbFlags &= ~(DBFLAG_SchemaKnownOk);",
          "238:     sqlite3BtreeLeaveAll(db);",
          "239:     assert( zErrDyn==0 || rc!=SQLITE_OK );",
          "240:   }",
          "",
          "[Removed Lines]",
          "237:     rc = sqlite3Init(db, &zErrDyn);",
          "",
          "[Added Lines]",
          "237:     if( !REOPEN_AS_MEMDB(db) ){",
          "238:       rc = sqlite3Init(db, &zErrDyn);",
          "239:     }",
          "",
          "---------------"
        ],
        "test/corruptL.test||test/corruptL.test": [
          "File: test/corruptL.test -> test/corruptL.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "123: do_catchsql_test 1.1 {",
          "124:   PRAGMA cell_size_check = off;",
          "125:   DROP INDEX t1x1;",
          "128: do_catchsql_test 1.2 {",
          "129:   SELECT sum(s+length(b)) FROM t1 WHERE a IN (110,10,150) AND q IS NULL;",
          "132: do_catchsql_test 1.3 {",
          "133:   REINDEX t1;",
          "136: #-------------------------------------------------------------------------",
          "137: reset_db",
          "",
          "[Removed Lines]",
          "126: } {1 {no such index: t1x1}}",
          "130: } {1 {no such table: t1}}",
          "134: } {1 {unable to identify the object to be reindexed}}",
          "",
          "[Added Lines]",
          "126: } {1 {database disk image is malformed}}",
          "130: } {1 {database disk image is malformed}}",
          "134: } {1 {database disk image is malformed}}",
          "136: do_catchsql_test 1.4 {",
          "137:   PRAGMA integrity_check",
          "138: } {1 {database disk image is malformed}}",
          "",
          "---------------"
        ],
        "test/memdb1.test||test/memdb1.test": [
          "File: test/memdb1.test -> test/memdb1.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "185:   lappend rc $msg",
          "186: } {1 {wrong # args: should be \"db serialize ?DATABASE?\"}}",
          "188: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "188: #-------------------------------------------------------------------------",
          "189: reset_db",
          "190: do_execsql_test 700 {",
          "191:   CREATE TABLE t1(a, b);",
          "192:   PRAGMA schema_version = 0;",
          "193: }",
          "194: do_test 710 {",
          "195:   set ser [db serialize main]",
          "196:   db close",
          "197:   sqlite3 db",
          "198:   db deserialize main $ser",
          "199:   catchsql {",
          "200:     CREATE VIRTUAL TABLE t1 USING rtree(id, a, b, c, d);",
          "201:   }",
          "202: } {1 {table t1 already exists}}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bcb0e64c82f21787a1996eac3539fba1d9fc690f",
      "candidate_info": {
        "commit_hash": "bcb0e64c82f21787a1996eac3539fba1d9fc690f",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/bcb0e64c82f21787a1996eac3539fba1d9fc690f",
        "files": [
          "ext/rtree/rtree.c",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Performance optimizations in the rtreeStepToLeaf() routine of RTree.\n\nFossilOrigin-Name: 4e34e3615ff31f4a6432033797b2e1a6604007ea0e501d714ecb362632776150",
        "before_after_code_files": [
          "ext/rtree/rtree.c||ext/rtree/rtree.c",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/rtree/rtree.c||ext/rtree/rtree.c": [
          "File: ext/rtree/rtree.c -> ext/rtree/rtree.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1565:   eInt = pRtree->eCoordType==RTREE_COORD_INT32;",
          "1566:   while( (p = rtreeSearchPointFirst(pCur))!=0 && p->iLevel>0 ){",
          "1567:     pNode = rtreeNodeOfFirstSearchPoint(pCur, &rc);",
          "1568:     if( rc ) return rc;",
          "1569:     nCell = NCELL(pNode);",
          "1570:     assert( nCell<200 );",
          "1571:     while( p->iCell<nCell ){",
          "1572:       sqlite3_rtree_dbl rScore = (sqlite3_rtree_dbl)-1;",
          "1574:       eWithin = FULLY_WITHIN;",
          "1575:       for(ii=0; ii<nConstraint; ii++){",
          "1576:         RtreeConstraint *pConstraint = pCur->aConstraint + ii;",
          "",
          "[Removed Lines]",
          "1573:       u8 *pCellData = pNode->zData + (4+pRtree->nBytesPerCell*p->iCell);",
          "",
          "[Added Lines]",
          "1567:     u8 *pCellData;",
          "1572:     pCellData = pNode->zData + (4+pRtree->nBytesPerCell*p->iCell);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1583:         }else{",
          "1584:           rtreeNonleafConstraint(pConstraint, eInt, pCellData, &eWithin);",
          "1585:         }",
          "1587:       }",
          "1589:       if( eWithin==NOT_WITHIN ) continue;",
          "1590:       x.iLevel = p->iLevel - 1;",
          "1591:       if( x.iLevel ){",
          "1592:         x.id = readInt64(pCellData);",
          "",
          "[Removed Lines]",
          "1586:         if( eWithin==NOT_WITHIN ) break;",
          "1588:       p->iCell++;",
          "",
          "[Added Lines]",
          "1587:         if( eWithin==NOT_WITHIN ){",
          "1588:           p->iCell++;",
          "1589:           pCellData += pRtree->nBytesPerCell;",
          "1590:           break;",
          "1591:         }",
          "1594:       p->iCell++;",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 39be3c61bd809cc89bdfdba90afc391ac9c2f81dfd8bb68a9b085b0ca8cd1fba",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}