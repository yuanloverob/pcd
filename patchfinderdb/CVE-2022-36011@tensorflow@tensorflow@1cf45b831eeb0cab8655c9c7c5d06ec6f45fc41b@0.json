{
  "cve_id": "CVE-2022-36011",
  "cve_desc": "TensorFlow is an open source platform for machine learning. When `mlir::tfg::ConvertGenericFunctionToFunctionDef` is given empty function attributes, it gives a null dereference. We have patched the issue in GitHub commit 1cf45b831eeb0cab8655c9c7c5d06ec6f45fc41b. The fix will be included in TensorFlow 2.10.0. We will also cherrypick this commit on TensorFlow 2.9.1, TensorFlow 2.8.1, and TensorFlow 2.7.2, as these are also affected and still in supported range. There are no known workarounds for this issue.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "1cf45b831eeb0cab8655c9c7c5d06ec6f45fc41b",
  "patch_info": {
    "commit_hash": "1cf45b831eeb0cab8655c9c7c5d06ec6f45fc41b",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/1cf45b831eeb0cab8655c9c7c5d06ec6f45fc41b",
    "files": [
      "tensorflow/core/ir/importexport/functiondef_import.cc",
      "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt"
    ],
    "message": "[tfg][functiondef_import] Emit error on empty function attributes\n\nDisallow empty function attributes. Emit an error when one is encountered.\n\nPiperOrigin-RevId: 448629968",
    "before_after_code_files": [
      "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc",
      "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt"
    ]
  },
  "patch_diff": {
    "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc": [
      "File: tensorflow/core/ir/importexport/functiondef_import.cc -> tensorflow/core/ir/importexport/functiondef_import.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "335:   for (const auto& namedAttr : func.attr()) {",
      "336:     const std::string& name = \"tf.\" + namedAttr.first;",
      "337:     const AttrValue& tf_attr = namedAttr.second;",
      "338:     TF_ASSIGN_OR_RETURN(Attribute attr,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "336:     if (namedAttr.first.empty())",
      "337:       return InvalidArgument(\"Invalid function attribute name\");",
      "",
      "---------------"
    ],
    "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt": [
      "File: tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt -> tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: # RUN: not tfg-translate -graphdef-to-mlir %s 2>&1 | FileCheck %s",
      "3: # CHECK: Invalid function attribute name",
      "5: library {",
      "6:   function {",
      "7:     signature {",
      "8:       name: \"foo\"",
      "9:       input_arg {",
      "10:         name: \"a\"",
      "11:       }",
      "12:       output_arg {",
      "13:         name: \"d\"",
      "14:       }",
      "15:     }",
      "16:     node_def {",
      "17:       op: \"Const\"",
      "18:       attr {",
      "19:         key: \"_b\"",
      "20:         value {",
      "21:           placeholder: \"T\"",
      "22:         }",
      "23:       }",
      "24:       attr {",
      "25:         key: \"dtype\"",
      "26:         value {",
      "27:           type: DT_INT32",
      "28:         }",
      "29:       }",
      "30:       attr {",
      "31:         key: \"value\"",
      "32:         value {",
      "33:           tensor {",
      "34:             dtype: DT_INT32",
      "35:             tensor_shape {",
      "36:             }",
      "37:           }",
      "38:         }",
      "39:       }",
      "40:     }",
      "41:     ret {",
      "42:       key: \"d\"",
      "43:       value: \"a\"",
      "44:     }",
      "45:     attr {",
      "46:       key: \"\"",
      "47:       value {",
      "48:         s: \"a\"",
      "49:       }",
      "50:     }",
      "51:   }",
      "52: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "7850f7f697112112726013ea54c86d1336d74800",
      "candidate_info": {
        "commit_hash": "7850f7f697112112726013ea54c86d1336d74800",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/7850f7f697112112726013ea54c86d1336d74800",
        "files": [
          "tensorflow/core/ir/importexport/functiondef_import.cc",
          "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt"
        ],
        "message": "[tfg][functiondef_import] Emit error on empty function attributes\n\nDisallow empty function attributes. Emit an error when one is encountered.\n\nPiperOrigin-RevId: 448629968",
        "before_after_code_files": [
          "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc",
          "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc",
            "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt"
          ],
          "candidate": [
            "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc",
            "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc": [
          "File: tensorflow/core/ir/importexport/functiondef_import.cc -> tensorflow/core/ir/importexport/functiondef_import.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "339:   for (const auto& namedAttr : func.attr()) {",
          "340:     const std::string& name = \"tf.\" + namedAttr.first;",
          "341:     const AttrValue& tf_attr = namedAttr.second;",
          "342:     TF_ASSIGN_OR_RETURN(Attribute attr,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "340:     if (namedAttr.first.empty())",
          "341:       return InvalidArgument(\"Invalid function attribute name\");",
          "",
          "---------------"
        ],
        "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt": [
          "File: tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt -> tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # RUN: not tfg-translate -graphdef-to-mlir %s 2>&1 | FileCheck %s",
          "3: # CHECK: Invalid function attribute name",
          "5: library {",
          "6:   function {",
          "7:     signature {",
          "8:       name: \"foo\"",
          "9:       input_arg {",
          "10:         name: \"a\"",
          "11:       }",
          "12:       output_arg {",
          "13:         name: \"d\"",
          "14:       }",
          "15:     }",
          "16:     node_def {",
          "17:       op: \"Const\"",
          "18:       attr {",
          "19:         key: \"_b\"",
          "20:         value {",
          "21:           placeholder: \"T\"",
          "22:         }",
          "23:       }",
          "24:       attr {",
          "25:         key: \"dtype\"",
          "26:         value {",
          "27:           type: DT_INT32",
          "28:         }",
          "29:       }",
          "30:       attr {",
          "31:         key: \"value\"",
          "32:         value {",
          "33:           tensor {",
          "34:             dtype: DT_INT32",
          "35:             tensor_shape {",
          "36:             }",
          "37:           }",
          "38:         }",
          "39:       }",
          "40:     }",
          "41:     ret {",
          "42:       key: \"d\"",
          "43:       value: \"a\"",
          "44:     }",
          "45:     attr {",
          "46:       key: \"\"",
          "47:       value {",
          "48:         s: \"a\"",
          "49:       }",
          "50:     }",
          "51:   }",
          "52: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ffc81ad0a4c3418d44e8dbd4d7fdf0e5be775a16",
      "candidate_info": {
        "commit_hash": "ffc81ad0a4c3418d44e8dbd4d7fdf0e5be775a16",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/ffc81ad0a4c3418d44e8dbd4d7fdf0e5be775a16",
        "files": [
          "tensorflow/core/ir/importexport/functiondef_import.cc",
          "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt"
        ],
        "message": "[tfg][functiondef_import] Emit error on empty function attributes\n\nDisallow empty function attributes. Emit an error when one is encountered.\n\nPiperOrigin-RevId: 448629968",
        "before_after_code_files": [
          "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc",
          "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc",
            "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt"
          ],
          "candidate": [
            "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc",
            "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc": [
          "File: tensorflow/core/ir/importexport/functiondef_import.cc -> tensorflow/core/ir/importexport/functiondef_import.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "326:   for (const auto& namedAttr : func.attr()) {",
          "327:     const std::string& name = \"tf.\" + namedAttr.first;",
          "328:     const AttrValue& tf_attr = namedAttr.second;",
          "329:     TF_ASSIGN_OR_RETURN(Attribute attr,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "327:     if (namedAttr.first.empty())",
          "328:       return InvalidArgument(\"Invalid function attribute name\");",
          "",
          "---------------"
        ],
        "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt": [
          "File: tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt -> tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_generic_function_attr_name.pbtxt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # RUN: not tfg-translate -graphdef-to-mlir %s 2>&1 | FileCheck %s",
          "3: # CHECK: Invalid function attribute name",
          "5: library {",
          "6:   function {",
          "7:     signature {",
          "8:       name: \"foo\"",
          "9:       input_arg {",
          "10:         name: \"a\"",
          "11:       }",
          "12:       output_arg {",
          "13:         name: \"d\"",
          "14:       }",
          "15:     }",
          "16:     node_def {",
          "17:       op: \"Const\"",
          "18:       attr {",
          "19:         key: \"_b\"",
          "20:         value {",
          "21:           placeholder: \"T\"",
          "22:         }",
          "23:       }",
          "24:       attr {",
          "25:         key: \"dtype\"",
          "26:         value {",
          "27:           type: DT_INT32",
          "28:         }",
          "29:       }",
          "30:       attr {",
          "31:         key: \"value\"",
          "32:         value {",
          "33:           tensor {",
          "34:             dtype: DT_INT32",
          "35:             tensor_shape {",
          "36:             }",
          "37:           }",
          "38:         }",
          "39:       }",
          "40:     }",
          "41:     ret {",
          "42:       key: \"d\"",
          "43:       value: \"a\"",
          "44:     }",
          "45:     attr {",
          "46:       key: \"\"",
          "47:       value {",
          "48:         s: \"a\"",
          "49:       }",
          "50:     }",
          "51:   }",
          "52: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e784f0e69fbaea5ca0b9e9e08afd3addee090b22",
      "candidate_info": {
        "commit_hash": "e784f0e69fbaea5ca0b9e9e08afd3addee090b22",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/e784f0e69fbaea5ca0b9e9e08afd3addee090b22",
        "files": [
          "tensorflow/core/ir/importexport/functiondef_import.cc",
          "tensorflow/core/ir/importexport/tests/graphdef-to-mlir/invalid_generic_function_attr_name.pbtxt"
        ],
        "message": "[tfg][functiondef_import] Emit error on empty function attributes\n\nDisallow empty function attributes. Emit an error when one is encountered.\n\nPiperOrigin-RevId: 448629968",
        "before_after_code_files": [
          "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc",
          "tensorflow/core/ir/importexport/tests/graphdef-to-mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef-to-mlir/invalid_generic_function_attr_name.pbtxt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc"
          ],
          "candidate": [
            "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/ir/importexport/functiondef_import.cc||tensorflow/core/ir/importexport/functiondef_import.cc": [
          "File: tensorflow/core/ir/importexport/functiondef_import.cc -> tensorflow/core/ir/importexport/functiondef_import.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "326:   for (const auto& namedAttr : func.attr()) {",
          "327:     const std::string& name = \"tf.\" + namedAttr.first;",
          "328:     const AttrValue& tf_attr = namedAttr.second;",
          "329:     TF_ASSIGN_OR_RETURN(Attribute attr,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "327:     if (namedAttr.first.empty())",
          "328:       return InvalidArgument(\"Invalid function attribute name\");",
          "",
          "---------------"
        ],
        "tensorflow/core/ir/importexport/tests/graphdef-to-mlir/invalid_generic_function_attr_name.pbtxt||tensorflow/core/ir/importexport/tests/graphdef-to-mlir/invalid_generic_function_attr_name.pbtxt": [
          "File: tensorflow/core/ir/importexport/tests/graphdef-to-mlir/invalid_generic_function_attr_name.pbtxt -> tensorflow/core/ir/importexport/tests/graphdef-to-mlir/invalid_generic_function_attr_name.pbtxt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # RUN: not tfg-translate -graphdef-to-mlir %s 2>&1 | FileCheck %s",
          "3: # CHECK: Invalid function attribute name",
          "5: library {",
          "6:   function {",
          "7:     signature {",
          "8:       name: \"foo\"",
          "9:       input_arg {",
          "10:         name: \"a\"",
          "11:       }",
          "12:       output_arg {",
          "13:         name: \"d\"",
          "14:       }",
          "15:     }",
          "16:     node_def {",
          "17:       op: \"Const\"",
          "18:       attr {",
          "19:         key: \"_b\"",
          "20:         value {",
          "21:           placeholder: \"T\"",
          "22:         }",
          "23:       }",
          "24:       attr {",
          "25:         key: \"dtype\"",
          "26:         value {",
          "27:           type: DT_INT32",
          "28:         }",
          "29:       }",
          "30:       attr {",
          "31:         key: \"value\"",
          "32:         value {",
          "33:           tensor {",
          "34:             dtype: DT_INT32",
          "35:             tensor_shape {",
          "36:             }",
          "37:           }",
          "38:         }",
          "39:       }",
          "40:     }",
          "41:     ret {",
          "42:       key: \"d\"",
          "43:       value: \"a\"",
          "44:     }",
          "45:     attr {",
          "46:       key: \"\"",
          "47:       value {",
          "48:         s: \"a\"",
          "49:       }",
          "50:     }",
          "51:   }",
          "52: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}