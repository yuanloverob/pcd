{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0cf65a0f5fdd72b950887e717f1f20d66ba30942",
      "candidate_info": {
        "commit_hash": "0cf65a0f5fdd72b950887e717f1f20d66ba30942",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/0cf65a0f5fdd72b950887e717f1f20d66ba30942",
        "files": [
          "crypto/bn/bn_exp.c"
        ],
        "message": "Ensure we test all parameters for BN_FLG_CONSTTIME\n\nRSA_setup_blinding() calls BN_BLINDING_create_param() which later calls\nBN_mod_exp() as follows:\n\nBN_mod_exp(ret->A, ret->A, ret->e, ret->mod, ctx)\n\nret->mod will have BN_FLG_CONSTTIME set, but ret->e does not. In\nBN_mod_exp() we only test the third param for the existence of this flag.\nWe should test all the inputs.\n\nThanks to Samuel Weiser (samuel.weiser@iaik.tugraz.at) for reporting this\nissue.\n\nThis typically only happens once at key load, so this is unlikely to be\nexploitable in any real scenario.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4477)\n\n(cherry picked from commit e913d11f444e0b46ec1ebbf3340813693f4d869d)",
        "before_after_code_files": [
          "crypto/bn/bn_exp.c||crypto/bn/bn_exp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/bn/bn_exp.c||crypto/bn/bn_exp.c": [
          "File: crypto/bn/bn_exp.c -> crypto/bn/bn_exp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "43:     int i, bits, ret = 0;",
          "44:     BIGNUM *v, *rr;",
          "48:         BNerr(BN_F_BN_EXP, ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED);",
          "49:         return 0;",
          "",
          "[Removed Lines]",
          "46:     if (BN_get_flags(p, BN_FLG_CONSTTIME) != 0) {",
          "",
          "[Added Lines]",
          "46:     if (BN_get_flags(p, BN_FLG_CONSTTIME) != 0",
          "47:             || BN_get_flags(a, BN_FLG_CONSTTIME) != 0) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "143:     if (BN_is_odd(m)) {",
          "144: # ifdef MONT_EXP_WORD",
          "145:         if (a->top == 1 && !a->neg",
          "147:             BN_ULONG A = a->d[0];",
          "148:             ret = BN_mod_exp_mont_word(r, A, p, m, ctx, NULL);",
          "149:         } else",
          "",
          "[Removed Lines]",
          "146:             && (BN_get_flags(p, BN_FLG_CONSTTIME) == 0)) {",
          "",
          "[Added Lines]",
          "147:             && (BN_get_flags(p, BN_FLG_CONSTTIME) == 0)",
          "148:             && (BN_get_flags(a, BN_FLG_CONSTTIME) == 0)",
          "149:             && (BN_get_flags(m, BN_FLG_CONSTTIME) == 0)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "175:     BIGNUM *val[TABLE_SIZE];",
          "176:     BN_RECP_CTX recp;",
          "180:         BNerr(BN_F_BN_MOD_EXP_RECP, ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED);",
          "181:         return 0;",
          "",
          "[Removed Lines]",
          "178:     if (BN_get_flags(p, BN_FLG_CONSTTIME) != 0) {",
          "",
          "[Added Lines]",
          "181:     if (BN_get_flags(p, BN_FLG_CONSTTIME) != 0",
          "182:             || BN_get_flags(a, BN_FLG_CONSTTIME) != 0",
          "183:             || BN_get_flags(m, BN_FLG_CONSTTIME) != 0) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "309:     BIGNUM *val[TABLE_SIZE];",
          "310:     BN_MONT_CTX *mont = NULL;",
          "313:         return BN_mod_exp_mont_consttime(rr, a, p, m, ctx, in_mont);",
          "314:     }",
          "",
          "[Removed Lines]",
          "312:     if (BN_get_flags(p, BN_FLG_CONSTTIME) != 0) {",
          "",
          "[Added Lines]",
          "317:     if (BN_get_flags(p, BN_FLG_CONSTTIME) != 0",
          "318:             || BN_get_flags(a, BN_FLG_CONSTTIME) != 0",
          "319:             || BN_get_flags(m, BN_FLG_CONSTTIME) != 0) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1121: #define BN_TO_MONTGOMERY_WORD(r, w, mont) \\",
          "1122:                 (BN_set_word(r, (w)) && BN_to_montgomery(r, r, (mont), ctx))",
          "1126:         BNerr(BN_F_BN_MOD_EXP_MONT_WORD, ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED);",
          "1127:         return 0;",
          "",
          "[Removed Lines]",
          "1124:     if (BN_get_flags(p, BN_FLG_CONSTTIME) != 0) {",
          "",
          "[Added Lines]",
          "1131:     if (BN_get_flags(p, BN_FLG_CONSTTIME) != 0",
          "1132:             || BN_get_flags(m, BN_FLG_CONSTTIME) != 0) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1253:     BIGNUM *val[TABLE_SIZE];",
          "1257:         BNerr(BN_F_BN_MOD_EXP_SIMPLE, ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED);",
          "1258:         return 0;",
          "",
          "[Removed Lines]",
          "1255:     if (BN_get_flags(p, BN_FLG_CONSTTIME) != 0) {",
          "",
          "[Added Lines]",
          "1263:     if (BN_get_flags(p, BN_FLG_CONSTTIME) != 0",
          "1264:             || BN_get_flags(a, BN_FLG_CONSTTIME) != 0",
          "1265:             || BN_get_flags(m, BN_FLG_CONSTTIME) != 0) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5a4aa73076f9bda34c051c3628fb378f42c5257a",
      "candidate_info": {
        "commit_hash": "5a4aa73076f9bda34c051c3628fb378f42c5257a",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/5a4aa73076f9bda34c051c3628fb378f42c5257a",
        "files": [
          "Configurations/10-main.conf"
        ],
        "message": "Fix spelling: adroideabi -> androideabi\n\nCLA: trivial\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Ben Kaduk <kaduk@mit.edu>\n(Merged from https://github.com/openssl/openssl/pull/5029)\n\n(cherry picked from commit bebef673607b9701bc21a0f7b7dbf92434af2588)",
        "before_after_code_files": [
          "Configurations/10-main.conf||Configurations/10-main.conf"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/10-main.conf||Configurations/10-main.conf": [
          "File: Configurations/10-main.conf -> Configurations/10-main.conf",
          "--- Hunk 1 ---",
          "[Context before]",
          "896:     #",
          "897:     # ANDROID_NDK=/some/where/android-ndk-10d",
          "898:     # CROSS_SYSROOT=$ANDROID_NDK/platforms/android-14/arch-arm",
          "900:     # PATH=$ANDROID_NDK/toolchains/arm-linux-androideabi-4.8/prebuild/linux-x86_64/bin",
          "901:     #",
          "902:     \"android\" => {",
          "",
          "[Removed Lines]",
          "899:     # CROSS_COMPILE=arm-linux-adroideabi-",
          "",
          "[Added Lines]",
          "899:     # CROSS_COMPILE=arm-linux-androideabi-",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "48ad955fc5f0e19acbc8acaa100af6526bc6b158",
      "candidate_info": {
        "commit_hash": "48ad955fc5f0e19acbc8acaa100af6526bc6b158",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/48ad955fc5f0e19acbc8acaa100af6526bc6b158",
        "files": [
          "test/handshake_helper.c"
        ],
        "message": "Fix a gcc fallthru warning\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4941)",
        "before_after_code_files": [
          "test/handshake_helper.c||test/handshake_helper.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/handshake_helper.c||test/handshake_helper.c": [
          "File: test/handshake_helper.c -> test/handshake_helper.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "805:             return INTERNAL_ERROR;",
          "806:         }",
          "808:     case PEER_RETRY:",
          "809:         if (previous_status == PEER_RETRY) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "807:         break;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "84f870be664e3b94cb3d81809da046a8d9cc2ca0",
      "candidate_info": {
        "commit_hash": "84f870be664e3b94cb3d81809da046a8d9cc2ca0",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/84f870be664e3b94cb3d81809da046a8d9cc2ca0",
        "files": [
          "Configurations/unix-Makefile.tmpl"
        ],
        "message": "Configurations/unix-Makefile.tmpl: fix HP-UX build.\n\nHP-UX make doesn't recognize $< in explict target rules, only in\ninference ones such as .c.o.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4697)\n\n(cherry picked from commit b6705d4893d1566c3a5427e387ce99344497758d)",
        "before_after_code_files": [
          "Configurations/unix-Makefile.tmpl||Configurations/unix-Makefile.tmpl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/unix-Makefile.tmpl||Configurations/unix-Makefile.tmpl": [
          "File: Configurations/unix-Makefile.tmpl -> Configurations/unix-Makefile.tmpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "818:           }",
          "819:           return <<\"EOF\";",
          "820: $args{src}: $args{generator}->[0] $deps",
          "822:  \\$(PERL) -ne '/^#(line)?\\\\s*[0-9]+/ or print' > \\$@",
          "823: EOF",
          "824:       }",
          "",
          "[Removed Lines]",
          "821:  \\$(CC) $incs \\$(CFLAGS) -E \\$< | \\\\",
          "",
          "[Added Lines]",
          "821:  \\$(CC) $incs \\$(CFLAGS) -E $args{generator}->[0] | \\\\",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3b8986d39d4c04f1d1238caebb859123c89c3e1d",
      "candidate_info": {
        "commit_hash": "3b8986d39d4c04f1d1238caebb859123c89c3e1d",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/3b8986d39d4c04f1d1238caebb859123c89c3e1d",
        "files": [
          "test/smime-certs/mksmime-certs.sh",
          "test/smime-certs/smec3.pem"
        ],
        "message": "Add alternative CMS P-256 cert\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4134)\n\n(cherry picked from commit 1aee92bf0f3fe243192fb5440f7c9789d5a08c67)",
        "before_after_code_files": [
          "test/smime-certs/mksmime-certs.sh||test/smime-certs/mksmime-certs.sh",
          "test/smime-certs/smec3.pem||test/smime-certs/smec3.pem"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/smime-certs/mksmime-certs.sh||test/smime-certs/mksmime-certs.sh": [
          "File: test/smime-certs/mksmime-certs.sh -> test/smime-certs/mksmime-certs.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:  -keyout smec2.pem -out req.pem -newkey ec:ecp2.pem",
          "65: $OPENSSL x509 -req -in req.pem -CA smroot.pem -days 3600 \\",
          "66:  -extfile ca.cnf -extensions usr_cert -CAcreateserial >>smec2.pem",
          "67: # Create X9.42 DH parameters.",
          "68: $OPENSSL genpkey -genparam -algorithm DH -pkeyopt dh_paramgen_type:2 \\",
          "69:  -out dhp.pem",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67: CN=\"Test S/MIME EE EC #3\" $OPENSSL req -config ca.cnf -nodes \\",
          "68:  -keyout smec3.pem -out req.pem -newkey ec:ecp.pem",
          "69: $OPENSSL x509 -req -in req.pem -CA smroot.pem -days 3600 \\",
          "70:  -extfile ca.cnf -extensions usr_cert -CAcreateserial >>smec3.pem",
          "",
          "---------------"
        ],
        "test/smime-certs/smec3.pem||test/smime-certs/smec3.pem": [
          "File: test/smime-certs/smec3.pem -> test/smime-certs/smec3.pem",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: -----BEGIN PRIVATE KEY-----",
          "2: MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQga03Rl+2K38wgwVyJ",
          "3: zSy+knGorGWZBGG5p//ke0WUSbqhRANCAARH8uHBHkuOfuyXgJj7V3lNqUEPiQNo",
          "4: xG8ntGjVmKRHfywdUoQJ1PgfbkCEsBk334rRFmja1r+MYyqn/A9ARiGB",
          "5: -----END PRIVATE KEY-----",
          "6: -----BEGIN CERTIFICATE-----",
          "7: MIICoDCCAYigAwIBAgIJAPaEOllWs/pjMA0GCSqGSIb3DQEBCwUAMEQxCzAJBgNV",
          "8: BAYTAlVLMRYwFAYDVQQKDA1PcGVuU1NMIEdyb3VwMR0wGwYDVQQDDBRUZXN0IFMv",
          "9: TUlNRSBSU0EgUm9vdDAeFw0xNzA4MTAxNTQyMDhaFw0yNzA2MTkxNTQyMDhaMEQx",
          "10: CzAJBgNVBAYTAlVLMRYwFAYDVQQKDA1PcGVuU1NMIEdyb3VwMR0wGwYDVQQDDBRU",
          "11: ZXN0IFMvTUlNRSBFRSBFQyAjMzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABEfy",
          "12: 4cEeS45+7JeAmPtXeU2pQQ+JA2jEbye0aNWYpEd/LB1ShAnU+B9uQISwGTffitEW",
          "13: aNrWv4xjKqf8D0BGIYGjYDBeMAwGA1UdEwEB/wQCMAAwDgYDVR0PAQH/BAQDAgXg",
          "14: MB0GA1UdDgQWBBQLR+H9CmAY/KDyXWdVUM9FP766WzAfBgNVHSMEGDAWgBT3YQTy",
          "15: KJTdSIrnOcPj3pm5oVNtazANBgkqhkiG9w0BAQsFAAOCAQEAmMRuf8Iz5fr9f0GA",
          "16: HaNiOM5S7AIfZ6W7zzdeF63EF1j9HqP1DJsUW4y5b9azWmpp62kKuNaM4CGPUVvm",
          "17: diLKJVlrDcc+6lW9oROpnBsskhjqFMTjTANPQSAKZeKiG2W3U8Q103VQpuYvE4Nj",
          "18: OU9JT+5e4RZS7wxYk/IsvnyF/DkoF1FTMHo9/3Wiw4V4KRhpJIPnqojWNcfipmhM",
          "19: UDpbw0Oyj5fE7x6wvaoOUr8GNJE5NudtV/5QDh9REkjyKUdVYsuUrWwKqn3NT8EI",
          "20: OLl8wx3RqA8htRg/W+SoESx87rvW1saPGvfypBp4cl18B1IzTlC+FMbHFJvZqQn8",
          "21: Ci1l4Q==",
          "22: -----END CERTIFICATE-----",
          "",
          "---------------"
        ]
      }
    }
  ]
}