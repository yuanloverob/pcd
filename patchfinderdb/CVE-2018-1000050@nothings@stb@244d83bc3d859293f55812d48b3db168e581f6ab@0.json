{
  "cve_id": "CVE-2018-1000050",
  "cve_desc": "Sean Barrett stb_vorbis version 1.12 and earlier contains a Buffer Overflow vulnerability in All vorbis decoding paths. that can result in memory corruption, denial of service, comprised execution of host program. This attack appear to be exploitable via Victim must open a specially crafted Ogg Vorbis file. This vulnerability appears to have been fixed in 1.13.",
  "repo": "nothings/stb",
  "patch_hash": "244d83bc3d859293f55812d48b3db168e581f6ab",
  "patch_info": {
    "commit_hash": "244d83bc3d859293f55812d48b3db168e581f6ab",
    "repo": "nothings/stb",
    "commit_url": "https://github.com/nothings/stb/commit/244d83bc3d859293f55812d48b3db168e581f6ab",
    "files": [
      "stb_vorbis.c"
    ],
    "message": "fix unchecked length in stb_vorbis that could crash on corrupt/invalid files",
    "before_after_code_files": [
      "stb_vorbis.c||stb_vorbis.c"
    ]
  },
  "patch_diff": {
    "stb_vorbis.c||stb_vorbis.c": [
      "File: stb_vorbis.c -> stb_vorbis.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2049:    int rtype = f->residue_types[rn];",
      "2050:    int c = r->classbook;",
      "2051:    int classwords = f->codebooks[c].dimensions;",
      "2053:    int part_read = n_read / r->part_size;",
      "2054:    int temp_alloc_point = temp_alloc_save(f);",
      "2055:    #ifndef STB_VORBIS_DIVIDES_IN_RESIDUE",
      "",
      "[Removed Lines]",
      "2052:    int n_read = r->end - r->begin;",
      "",
      "[Added Lines]",
      "2055:    unsigned int actual_size = rtype == 2 ? n*2 : n;",
      "2056:    unsigned int limit_r_begin = (r->begin < actual_size ? r->begin : actual_size);",
      "2057:    unsigned int limit_r_end   = (r->end   < actual_size ? r->end   : actual_size);",
      "2058:    int n_read = limit_r_end - limit_r_begin;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "4077:       int i,max_part_read=0;",
      "4078:       for (i=0; i < f->residue_count; ++i) {",
      "4079:          Residue *r = f->residue_config + i;",
      "4081:          int part_read = n_read / r->part_size;",
      "4082:          if (part_read > max_part_read)",
      "4083:             max_part_read = part_read;",
      "",
      "[Removed Lines]",
      "4080:          int n_read = r->end - r->begin;",
      "",
      "[Added Lines]",
      "4086:          unsigned int actual_size = f->blocksize_1 / 2;",
      "4087:          unsigned int limit_r_begin = r->begin < actual_size ? r->begin : actual_size;",
      "4088:          unsigned int limit_r_end   = r->end   < actual_size ? r->end   : actual_size;",
      "4089:          int n_read = limit_r_end - limit_r_begin;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "5351: #endif // STB_VORBIS_NO_PULLDATA_API",
      "5354:     1.10    - 2017/03/03 - more robust seeking; fix negative ilog(); clear error in open_memory",
      "5355:     1.09    - 2016/04/04 - back out 'avoid discarding last frame' fix from previous version",
      "5356:     1.08    - 2016/04/02 - fixed multiple warnings; fix setup memory leaks;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "5365:     1.12    - 2017/11/21 - limit residue begin/end to blocksize/2 to avoid large temp allocs in bad/corrupt files",
      "5366:     1.11    - 2017/07/23 - fix MinGW compilation",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ac66307576973693366a6200c036801e6269d97b",
      "candidate_info": {
        "commit_hash": "ac66307576973693366a6200c036801e6269d97b",
        "repo": "nothings/stb",
        "commit_url": "https://github.com/nothings/stb/commit/ac66307576973693366a6200c036801e6269d97b",
        "files": [
          "stb_vorbis.c"
        ],
        "message": "docs",
        "before_after_code_files": [
          "stb_vorbis.c||stb_vorbis.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "stb_vorbis.c||stb_vorbis.c"
          ],
          "candidate": [
            "stb_vorbis.c||stb_vorbis.c"
          ]
        }
      },
      "candidate_diff": {
        "stb_vorbis.c||stb_vorbis.c": [
          "File: stb_vorbis.c -> stb_vorbis.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "5362: #endif // STB_VORBIS_NO_PULLDATA_API",
          "5370:                            avoid discarding last frame of audio data",
          "5372:                            some more crash fixes when out of memory or with corrupt files",
          "5374:                            some crash fixes when out of memory or with corrupt files",
          "5381:                            (API change) report sample rate for decode-full-file funcs",
          "5382:     0.99996 - bracket #include <malloc.h> for macintosh compilation by Laurent Gomila",
          "5383:     0.99995 - use union instead of pointer-cast for fast-float-to-int to avoid alias-optimization problem",
          "",
          "[Removed Lines]",
          "5365:     1.12    - 2017/11/21 - limit residue begin/end to blocksize/2 to avoid large temp allocs in bad/corrupt files",
          "5366:     1.11    - 2017/07/23 - fix MinGW compilation",
          "5367:     1.10    - 2017/03/03 - more robust seeking; fix negative ilog(); clear error in open_memory",
          "5368:     1.09    - 2016/04/04 - back out 'avoid discarding last frame' fix from previous version",
          "5369:     1.08    - 2016/04/02 - fixed multiple warnings; fix setup memory leaks;",
          "5371:     1.07    - 2015/01/16 - fixed some warnings, fix mingw, const-correct API",
          "5373:     1.06    - 2015/08/31 - full, correct support for seeking API (Dougall Johnson)",
          "5375:     1.05    - 2015/04/19 - don't define __forceinline if it's redundant",
          "5376:     1.04    - 2014/08/27 - fix missing const-correct case in API",
          "5377:     1.03    - 2014/08/07 - Warning fixes",
          "5378:     1.02    - 2014/07/09 - Declare qsort compare function _cdecl on windows",
          "5379:     1.01    - 2014/06/18 - fix stb_vorbis_get_samples_float",
          "5380:     1.0     - 2014/05/26 - fix memory leaks; fix warnings; fix bugs in multichannel",
          "",
          "[Added Lines]",
          "5365:     1.12    - 2017-11-21 - limit residue begin/end to blocksize/2 to avoid large temp allocs in bad/corrupt files",
          "5366:     1.11    - 2017-07-23 - fix MinGW compilation",
          "5367:     1.10    - 2017-03-03 - more robust seeking; fix negative ilog(); clear error in open_memory",
          "5368:     1.09    - 2016-04-04 - back out 'avoid discarding last frame' fix from previous version",
          "5369:     1.08    - 2016-04-02 - fixed multiple warnings; fix setup memory leaks;",
          "5371:     1.07    - 2015-01-16 - fixed some warnings, fix mingw, const-correct API",
          "5373:     1.06    - 2015-08-31 - full, correct support for seeking API (Dougall Johnson)",
          "5375:     1.05    - 2015-04-19 - don't define __forceinline if it's redundant",
          "5376:     1.04    - 2014-08-27 - fix missing const-correct case in API",
          "5377:     1.03    - 2014-08-07 - Warning fixes",
          "5378:     1.02    - 2014-07-09 - Declare qsort compare function _cdecl on windows",
          "5379:     1.01    - 2014-06-18 - fix stb_vorbis_get_samples_float",
          "5380:     1.0     - 2014-05-26 - fix memory leaks; fix warnings; fix bugs in multichannel",
          "",
          "---------------"
        ]
      }
    }
  ]
}