{
  "cve_id": "CVE-2019-19923",
  "cve_desc": "flattenSubquery in select.c in SQLite 3.30.1 mishandles certain uses of SELECT DISTINCT involving a LEFT JOIN in which the right-hand side is a view. This can cause a NULL pointer dereference (or incorrect results).",
  "repo": "sqlite/sqlite",
  "patch_hash": "396afe6f6aa90a31303c183e11b2b2d4b7956b35",
  "patch_info": {
    "commit_hash": "396afe6f6aa90a31303c183e11b2b2d4b7956b35",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/396afe6f6aa90a31303c183e11b2b2d4b7956b35",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/select.c",
      "test/join.test"
    ],
    "message": "Continue to back away from the LEFT JOIN optimization of check-in [41c27bc0ff1d3135] by disallowing query flattening if the outer query is DISTINCT.  Without this fix, if an index scan is run on the table within the view on the right-hand side of the LEFT JOIN, stale result registers might be accessed yielding incorrect results, and/or an OP_IfNullRow opcode might be invoked on the un-opened table, resulting in a NULL-pointer dereference.  This problem was found by the Yongheng and Rui fuzzer.\n\nFossilOrigin-Name: 862974312edf00e9d1068115d1a39b7235b7db68b6d86b81d38a12f025a4748e",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/select.c||src/select.c",
      "test/join.test||test/join.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 289158aa24b066c453d2bce4bc2dead1c56fb0b23c3f7c4810b34b13627cef34",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/select.c||src/select.c": [
      "File: src/select.c -> src/select.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3797:   if( (pSubitem->fg.jointype & JT_OUTER)!=0 ){",
      "3798:     isLeftJoin = 1;",
      "3801:       return 0;",
      "3802:     }",
      "3803:   }",
      "",
      "[Removed Lines]",
      "3799:     if( pSubSrc->nSrc>1 || isAgg || IsVirtual(pSubSrc->a[0].pTab) ){",
      "",
      "[Added Lines]",
      "3804:     ){",
      "",
      "---------------"
    ],
    "test/join.test||test/join.test": [
      "File: test/join.test -> test/join.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "975:   SELECT 24, * FROM t1 LEFT JOIN t0 ON +aa ISNULL;",
      "976: } {13 1 {} 14 1 {} 23 1 {} 24 1 {}}",
      "978: finish_test",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "978: # 2019-12-18 problem with a LEFT JOIN where the RHS is a view.",
      "979: # Detected by Yongheng and Rui.",
      "980: # Follows from the optimization attempt of check-in 41c27bc0ff1d3135",
      "981: # on 2017-04-18",
      "982: #",
      "983: reset_db",
      "984: do_execsql_test join-22.10 {",
      "985:   CREATE TABLE t0(a, b);",
      "986:   CREATE INDEX t0a ON t0(a);",
      "987:   INSERT INTO t0 VALUES(10,10),(10,11),(10,12);",
      "988:   SELECT DISTINCT c FROM t0 LEFT JOIN (SELECT a+1 AS c FROM t0) ORDER BY c ;",
      "989: } {11}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "01a3b6b1b2dae46b1a54264ce78ff95fb7fc2d95",
      "candidate_info": {
        "commit_hash": "01a3b6b1b2dae46b1a54264ce78ff95fb7fc2d95",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/01a3b6b1b2dae46b1a54264ce78ff95fb7fc2d95",
        "files": [
          "ext/misc/json1.c",
          "manifest",
          "manifest.uuid",
          "src/sqlite.h.in",
          "src/window.c"
        ],
        "message": "Change the meaning of the SQLITE_SUBTYPE flag so that it indicates that the user-defined function cares about the subtypes of its arguments.\n\nFossilOrigin-Name: af1bc20f502816db460d2b2d353f715da5cf660e59095de5214c829c1cb20981",
        "before_after_code_files": [
          "ext/misc/json1.c||ext/misc/json1.c",
          "manifest.uuid||manifest.uuid",
          "src/sqlite.h.in||src/sqlite.h.in",
          "src/window.c||src/window.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/misc/json1.c||ext/misc/json1.c": [
          "File: ext/misc/json1.c -> ext/misc/json1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2504: #endif",
          "2505:   for(i=0; i<sizeof(aFunc)/sizeof(aFunc[0]) && rc==SQLITE_OK; i++){",
          "2506:     rc = sqlite3_create_function(db, aFunc[i].zName, aFunc[i].nArg,",
          "2510:   }",
          "2511: #ifndef SQLITE_OMIT_WINDOWFUNC",
          "2512:   for(i=0; i<sizeof(aAgg)/sizeof(aAgg[0]) && rc==SQLITE_OK; i++){",
          "2513:     rc = sqlite3_create_window_function(db, aAgg[i].zName, aAgg[i].nArg,",
          "2515:                                  aAgg[i].xStep, aAgg[i].xFinal,",
          "2516:                                  aAgg[i].xValue, jsonGroupInverse, 0);",
          "2517:   }",
          "",
          "[Removed Lines]",
          "2507:                         SQLITE_UTF8 | SQLITE_DETERMINISTIC | SQLITE_SUBTYPE,",
          "2508:                         (void*)&aFunc[i].flag,",
          "2509:                         aFunc[i].xFunc, 0, 0);",
          "2514:                                  SQLITE_UTF8 | SQLITE_DETERMINISTIC, 0,",
          "",
          "[Added Lines]",
          "2507:                                  SQLITE_UTF8 | SQLITE_DETERMINISTIC,",
          "2508:                                  (void*)&aFunc[i].flag,",
          "2509:                                  aFunc[i].xFunc, 0, 0);",
          "2514:                 SQLITE_SUBTYPE | SQLITE_UTF8 | SQLITE_DETERMINISTIC, 0,",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 14ef7543465dd14d8fa141fcceb1950b5c2d265a3e862323969d747b39c0cd8c",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/sqlite.h.in||src/sqlite.h.in": [
          "File: src/sqlite.h.in -> src/sqlite.h.in"
        ],
        "src/window.c||src/window.c": [
          "File: src/window.c -> src/window.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "869: }",
          "",
          "[Removed Lines]",
          "875: int exprListContainsSubtype(Parse *pParse, ExprList *pList){",
          "876:   if( pList ){",
          "877:     sqlite3 *db = pParse->db;",
          "878:     int i;",
          "879:     for(i=0; i<pList->nExpr; i++){",
          "880:       Expr *p = pList->a[i].pExpr;",
          "881:       if( p->op==TK_FUNCTION ){",
          "882:         FuncDef *pDef;",
          "883:         int nArg = 0;",
          "884:         if( !ExprHasProperty(p, EP_TokenOnly) && p->x.pList ){",
          "885:           nArg = p->x.pList->nExpr;",
          "886:         }",
          "887:         pDef = sqlite3FindFunction(db, p->u.zToken, nArg, db->enc, 0);",
          "888:         if( pDef && (pDef->funcFlags & SQLITE_FUNC_SUBTYPE) ){",
          "889:           return 1;",
          "890:         }",
          "891:       }",
          "892:     }",
          "893:   }",
          "894:   return 0;",
          "895: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "993:     for(pWin=pMWin; pWin; pWin=pWin->pNextWin){",
          "994:       ExprList *pArgs = pWin->pOwner->x.pList;",
          "996:         selectWindowRewriteEList(pParse, pMWin, pSrc, pArgs, pTab, &pSublist);",
          "997:         pWin->iArgCol = (pSublist ? pSublist->nExpr : 0);",
          "998:         pWin->bExprArgs = 1;",
          "",
          "[Removed Lines]",
          "995:       if( exprListContainsSubtype(pParse, pArgs) ){",
          "",
          "[Added Lines]",
          "969:       if( pWin->pFunc->funcFlags & SQLITE_FUNC_SUBTYPE ){",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b8a8d523cbfa1371e35a4e5d1fc4727128e74ead",
      "candidate_info": {
        "commit_hash": "b8a8d523cbfa1371e35a4e5d1fc4727128e74ead",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/b8a8d523cbfa1371e35a4e5d1fc4727128e74ead",
        "files": [
          "ext/rbu/rbuprogress.test",
          "ext/rbu/sqlite3rbu.c",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Fix a problem with RBU function sqlite3rbu_bp_progress() when used during an RBU vacuum.\n\nFossilOrigin-Name: 8c44b02f1479cec61554800702a3c1d806e4ee64b41ba2af17320f62794a02fe",
        "before_after_code_files": [
          "ext/rbu/rbuprogress.test||ext/rbu/rbuprogress.test",
          "ext/rbu/sqlite3rbu.c||ext/rbu/sqlite3rbu.c",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/rbu/rbuprogress.test||ext/rbu/rbuprogress.test": [
          "File: ext/rbu/rbuprogress.test -> ext/rbu/rbuprogress.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "414:   }",
          "415: }",
          "418: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "417: #-------------------------------------------------------------------------",
          "418: # Test that sqlite3_bp_progress() works with an RBU vacuum if there",
          "419: # is an rbu_count table in the db being vacuumed.",
          "420: #",
          "421: reset_db",
          "422: do_execsql_test 6.0 {",
          "423:   CREATE TABLE t1(a, b, c);",
          "424:   CREATE INDEX i1 ON t1(a);",
          "425:   CREATE INDEX i2 ON t1(b);",
          "426:   WITH s(i) AS (",
          "427:     SELECT 1 UNION ALL SELECT i+1 FROM s WHERE i<100",
          "428:   )",
          "429:   INSERT INTO t1 SELECT i, i, i FROM s;",
          "430:   CREATE TABLE rbu_count(tbl TEXT PRIMARY KEY, cnt INTEGER) WITHOUT ROWID;",
          "431:   INSERT INTO rbu_count VALUES('t1', (SELECT count(*) FROM t1));",
          "432:   INSERT INTO rbu_count VALUES('rbu_count', 2);",
          "433: }",
          "435: forcedelete state.db",
          "436: do_test 6.1 {",
          "437:   set maxA 0",
          "438:   set maxB 0",
          "439:   sqlite3rbu_vacuum rbu test.db state.db",
          "440:   while {[rbu step]==\"SQLITE_OK\"} {",
          "441:     foreach {a b} [rbu bp_progress] {",
          "442:       if {$a > $maxA} { set maxA $a }",
          "443:       if {$b > $maxB} { set maxB $b }",
          "444:     }",
          "445:   }",
          "446:   list [rbu close] $maxA $maxB",
          "447: } {SQLITE_DONE 10000 10000}",
          "",
          "---------------"
        ],
        "ext/rbu/sqlite3rbu.c||ext/rbu/sqlite3rbu.c": [
          "File: ext/rbu/sqlite3rbu.c -> ext/rbu/sqlite3rbu.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "944:   zIn = (const char*)sqlite3_value_text(argv[0]);",
          "945:   if( zIn ){",
          "946:     if( rbuIsVacuum(p) ){",
          "949:         sqlite3_result_text(pCtx, zIn, -1, SQLITE_STATIC);",
          "950:       }",
          "951:     }else{",
          "",
          "[Removed Lines]",
          "947:       assert( argc==2 );",
          "948:       if( 0==sqlite3_value_int(argv[1]) ){",
          "",
          "[Added Lines]",
          "947:       assert( argc==2 || argc==1 );",
          "948:       if( argc==1 || 0==sqlite3_value_int(argv[1]) ){",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3860:   sqlite3_stmt *pStmt = 0;",
          "3861:   char *zErrmsg = 0;",
          "3862:   int rc;",
          "3864:   assert( nVal==1 );",
          "3867:       sqlite3_mprintf(\"SELECT count(*) FROM sqlite_master \"",
          "3868:         \"WHERE type='index' AND tbl_name = %Q\", sqlite3_value_text(apVal[0]))",
          "3869:   );",
          "",
          "[Removed Lines]",
          "3866:   rc = prepareFreeAndCollectError(p->dbMain, &pStmt, &zErrmsg,",
          "",
          "[Added Lines]",
          "3863:   sqlite3 *db = (rbuIsVacuum(p) ? p->dbRbu : p->dbMain);",
          "3867:   rc = prepareFreeAndCollectError(db, &pStmt, &zErrmsg,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3878:     if( rc==SQLITE_OK ){",
          "3879:       sqlite3_result_int(pCtx, nIndex);",
          "3880:     }else{",
          "3882:     }",
          "3883:   }",
          "",
          "[Removed Lines]",
          "3881:       sqlite3_result_error(pCtx, sqlite3_errmsg(p->dbMain), -1);",
          "",
          "[Added Lines]",
          "3882:       sqlite3_result_error(pCtx, sqlite3_errmsg(db), -1);",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 7dae7b969ed314605a3a2da2cfdce4d81152740f5d3bfbc2a6e311b13ee325a7",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "38e3853240798ae59815320f745a6325f1da10cc",
      "candidate_info": {
        "commit_hash": "38e3853240798ae59815320f745a6325f1da10cc",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/38e3853240798ae59815320f745a6325f1da10cc",
        "files": [
          "ext/fts5/test/fts5circref.test",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Add tests for the use of SQLITE_PREPARE_NO_VTAB in fts5.\n\nFossilOrigin-Name: 1999612010e310fc2430d1f00076f69fade0c66d202771dbb0f3d5597ac0a03c",
        "before_after_code_files": [
          "ext/fts5/test/fts5circref.test||ext/fts5/test/fts5circref.test",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/fts5/test/fts5circref.test||ext/fts5/test/fts5circref.test": [
          "File: ext/fts5/test/fts5circref.test -> ext/fts5/test/fts5circref.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # 2018 Dec 22",
          "2: #",
          "3: # The author disclaims copyright to this source code.  In place of",
          "4: # a legal notice, here is a blessing:",
          "5: #",
          "6: #    May you do good and not evil.",
          "7: #    May you find forgiveness for yourself and forgive others.",
          "8: #    May you share freely, never taking more than you give.",
          "9: #",
          "10: #*************************************************************************",
          "11: # This file implements regression tests for SQLite library.  The",
          "12: # focus of this script is testing the FTS5 module.",
          "13: #",
          "15: source [file join [file dirname [info script]] fts5_common.tcl]",
          "16: set testprefix fts5circref",
          "18: # If SQLITE_ENABLE_FTS5 is not defined, omit this file.",
          "19: ifcapable !fts5 {",
          "20:   finish_test",
          "21:   return",
          "22: }",
          "24: do_execsql_test 1.0 {",
          "25:   CREATE VIRTUAL TABLE tt USING fts5(a);",
          "26:   SELECT name FROM sqlite_master ORDER BY 1;",
          "27: } {",
          "28:   tt tt_config tt_content tt_data tt_docsize tt_idx",
          "29: }",
          "30: db_save_and_close",
          "32: foreach {tn schema sql} {",
          "33:   1 {",
          "34:     CREATE TRIGGER tr1 AFTER INSERT ON tt_config BEGIN",
          "35:       SELECT * FROM tt;",
          "36:     END;",
          "37:   } {",
          "38:     INSERT INTO tt(tt, rank) VALUES('usermerge', 4);",
          "39:   }",
          "41:   2 {",
          "42:     CREATE TRIGGER tr1 AFTER INSERT ON tt_docsize BEGIN",
          "43:       SELECT * FROM tt;",
          "44:     END;",
          "45:   } {",
          "46:     INSERT INTO tt(a) VALUES('one two three');",
          "47:   }",
          "49:   3 {",
          "50:     CREATE TRIGGER tr1 AFTER INSERT ON tt_content BEGIN",
          "51:       SELECT * FROM tt;",
          "52:     END;",
          "53:   } {",
          "54:     INSERT INTO tt(a) VALUES('one two three');",
          "55:   }",
          "57:   4 {",
          "58:     CREATE TRIGGER tr1 AFTER INSERT ON tt_data BEGIN",
          "59:       SELECT * FROM tt;",
          "60:     END;",
          "61:   } {",
          "62:     INSERT INTO tt(a) VALUES('one two three');",
          "63:   }",
          "65:   5 {",
          "66:     CREATE TRIGGER tr1 AFTER INSERT ON tt_idx BEGIN",
          "67:       SELECT * FROM tt;",
          "68:     END;",
          "69:   } {",
          "70:     INSERT INTO tt(a) VALUES('one two three');",
          "71:   }",
          "72: } {",
          "73:   db_restore_and_reopen",
          "74:   do_execsql_test 1.1.$tn.1 $schema",
          "75:   do_catchsql_test 1.1.$tn.2 $sql {1 {SQL logic error}}",
          "76:   db close",
          "77: }",
          "80: finish_test",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 25666e3d03950caf753295cdb55df162e07dbcf6840b05875c6e0b127c469ecb",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2b454e0335cbe14bc96b460ff3695007185fbb6e",
      "candidate_info": {
        "commit_hash": "2b454e0335cbe14bc96b460ff3695007185fbb6e",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/2b454e0335cbe14bc96b460ff3695007185fbb6e",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/tokenize.c"
        ],
        "message": "Fix a harmless compiler warning that only comes up during debug builds.\n\nFossilOrigin-Name: 848869ced988ca4d0ac76d43f984360fd11997a580719cccf8d55becea4e8fb1",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/tokenize.c||src/tokenize.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 35cbee7fe4a0b7ca06206ca2f69fc35abe3de4929070d6585ab765af82027438",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/tokenize.c||src/tokenize.c": [
          "File: src/tokenize.c -> src/tokenize.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "564: #ifdef sqlite3Parser_ENGINEALWAYSONSTACK",
          "566: #endif",
          "568:   assert( zSql!=0 );",
          "569:   mxSqlLen = db->aLimit[SQLITE_LIMIT_SQL_LENGTH];",
          "",
          "[Removed Lines]",
          "563:   VVA_ONLY( u8 startedWithOom = db->mallocFailed );",
          "",
          "[Added Lines]",
          "566:   VVA_ONLY( u8 startedWithOom = db->mallocFailed );",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "be812624006aa7ca3acef17161ed6ea8de24d004",
      "candidate_info": {
        "commit_hash": "be812624006aa7ca3acef17161ed6ea8de24d004",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/be812624006aa7ca3acef17161ed6ea8de24d004",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/vdbe.c",
          "test/intreal.test"
        ],
        "message": "Always store a REAL value in a column with REAL affinity if the integer equivalent would require 8 bytes of storage. Fix for [3c27b97e3].\n\nFossilOrigin-Name: 14c00b1016ba53ab2dc177c59a27b6b9209202973685f0f274112d296ba7dfcb",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/vdbe.c||src/vdbe.c",
          "test/intreal.test||test/intreal.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 1eb2a628e4bfae51fea43e8f40fedfe23f2118024d9cce35828c3cbe92a9b392",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/vdbe.c||src/vdbe.c": [
          "File: src/vdbe.c -> src/vdbe.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2884:     pRec = pData0;",
          "2885:     do{",
          "2886:       applyAffinity(pRec, zAffinity[0], encoding);",
          "2887:       REGISTER_TRACE((int)(pRec-aMem), pRec);",
          "2888:       zAffinity++;",
          "2889:       pRec++;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2887:       if( zAffinity[0]==SQLITE_AFF_REAL && (pRec->flags & MEM_Int) ){",
          "2888:         pRec->flags |= MEM_IntReal;",
          "2889:         pRec->flags &= ~(MEM_Int);",
          "2890:       }",
          "",
          "---------------"
        ],
        "test/intreal.test||test/intreal.test": [
          "File: test/intreal.test -> test/intreal.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "46:          max(1,intreal(5),intreal(3),4);",
          "47: } {5.0 5.0}",
          "52: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "49: #-------------------------------------------------------------------------",
          "50: do_execsql_test 2.1 {",
          "51:   CREATE TABLE t2(a REAL);",
          "52:   INSERT INTO t2 VALUES( 836627109860825358 );",
          "53:   SELECT substr(a,1,4) FROM t2 WHERE a = CAST(836627109860825358 AS REAL);",
          "54: } {8.36}",
          "56: do_execsql_test 2.2 {",
          "57:   CREATE INDEX i2 ON t2(a);",
          "58:   SELECT substr(a,1,4) FROM t2 WHERE a = CAST(836627109860825358 AS REAL);",
          "59: } {8.36}",
          "61: do_execsql_test 2.3 {",
          "62:   CREATE TABLE t0 (c0);",
          "63:   CREATE TABLE t1 (c1 REAL);",
          "64:   INSERT INTO t1(c1) VALUES (8366271098608253588);",
          "65:   INSERT INTO t0(c0) VALUES ('a');",
          "66: }",
          "67: set D [db one {SELECT c1 FROM t1}]",
          "69: do_execsql_test 2.4 {",
          "70:   SELECT * FROM t1 WHERE (t1.c1 = CAST(8366271098608253588 AS REAL));",
          "71: } $D",
          "73: do_execsql_test 2.5 {",
          "74:   SELECT * FROM t0, t1 WHERE (t1.c1 = CAST(8366271098608253588 AS REAL));",
          "75: } [list a $D]",
          "77: do_execsql_test 2.6 {",
          "78:   SELECT * FROM t0, t1",
          "79:   WHERE (",
          "80:         t1.c1 >= CAST(8366271098608253588 AS REAL)",
          "81:     AND t1.c1 <= CAST(8366271098608253588 AS REAL)",
          "82:   );",
          "83: } [list a $D]",
          "",
          "---------------"
        ]
      }
    }
  ]
}