{
  "cve_id": "CVE-2020-7670",
  "cve_desc": "agoo prior to 2.14.0 allows request smuggling attacks where agoo is used as a backend and a frontend proxy also being vulnerable. HTTP pipelining issues and request smuggling attacks might be possible due to incorrect Content-Length and Transfer encoding header parsing. It is possible to conduct HTTP request smuggling attacks where `agoo` is used as part of a chain of backend servers due to insufficient `Content-Length` and `Transfer Encoding` parsing.",
  "repo": "ohler55/agoo",
  "patch_hash": "23d03535cf7b50d679a60a953a0cae9519a4a130",
  "patch_info": {
    "commit_hash": "23d03535cf7b50d679a60a953a0cae9519a4a130",
    "repo": "ohler55/agoo",
    "commit_url": "https://github.com/ohler55/agoo/commit/23d03535cf7b50d679a60a953a0cae9519a4a130",
    "files": [
      "CHANGELOG.md",
      "ext/agoo/con.c",
      "ext/agoo/con.h",
      "ext/agoo/http.c",
      "ext/agoo/req.h",
      "ext/agoo/request.c",
      "ext/agoo/server.c",
      "ext/agoo/websocket.c",
      "lib/agoo/version.rb",
      "test/base_handler_test.rb",
      "test/rack_handler_test.rb"
    ],
    "message": "Remote addr (#99)\n\n* REMOTE_ADDR added\n\n* Ready for merge",
    "before_after_code_files": [
      "ext/agoo/con.c||ext/agoo/con.c",
      "ext/agoo/con.h||ext/agoo/con.h",
      "ext/agoo/http.c||ext/agoo/http.c",
      "ext/agoo/req.h||ext/agoo/req.h",
      "ext/agoo/request.c||ext/agoo/request.c",
      "ext/agoo/server.c||ext/agoo/server.c",
      "ext/agoo/websocket.c||ext/agoo/websocket.c",
      "lib/agoo/version.rb||lib/agoo/version.rb",
      "test/base_handler_test.rb||test/base_handler_test.rb",
      "test/rack_handler_test.rb||test/rack_handler_test.rb"
    ]
  },
  "patch_diff": {
    "ext/agoo/con.c||ext/agoo/con.c": [
      "File: ext/agoo/con.c -> ext/agoo/con.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "63:     if (NULL == (c = (agooCon)AGOO_CALLOC(1, sizeof(struct _agooCon)))) {",
      "64:  AGOO_ERR_MEM(err, \"Connection\");",
      "65:     } else {",
      "66:  c->sock = sock;",
      "67:  c->id = id;",
      "68:  c->timeout = dtime() + CON_TIMEOUT;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "69:  struct sockaddr_storage addr;",
      "70:  socklen_t  len = sizeof(addr);",
      "72:  getpeername(sock, (struct sockaddr*)&addr, &len);",
      "73:  if (addr.ss_family == AF_INET) {",
      "74:      struct sockaddr_in *s = (struct sockaddr_in*)&addr;",
      "76:      inet_ntop(AF_INET, &s->sin_addr, c->remote, sizeof(c->remote));",
      "77:  } else {",
      "78:      struct sockaddr_in6 *s = (struct sockaddr_in6*)&addr;",
      "80:      inet_ntop(AF_INET6, &s->sin6_addr, c->remote, sizeof(c->remote));",
      "81:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "437:     c->req->method = method;",
      "438:     c->req->upgrade = AGOO_UP_NONE;",
      "439:     c->req->up = NULL;",
      "440:     c->req->path.start = c->req->msg + (path.start - c->buf);",
      "441:     c->req->path.len = (int)(path.end - path.start);",
      "442:     c->req->query.start = c->req->msg + (query - c->buf);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "456:     memcpy(c->req->remote, c->remote, sizeof(c->remote));",
      "",
      "---------------"
    ],
    "ext/agoo/con.h||ext/agoo/con.h": [
      "File: ext/agoo/con.h -> ext/agoo/con.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: #ifndef AGOO_CON_H",
      "4: #define AGOO_CON_H",
      "6: #include <poll.h>",
      "7: #include <pthread.h>",
      "8: #include <stdbool.h>",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6: #include <arpa/inet.h>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "45:     struct _agooBind  *bind;",
      "46:     struct pollfd  *pp;",
      "47:     uint64_t   id;",
      "48:     char   buf[MAX_HEADER_SIZE];",
      "49:     size_t   bcnt;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "49:     char   remote[INET6_ADDRSTRLEN];",
      "",
      "---------------"
    ],
    "ext/agoo/http.c||ext/agoo/http.c": [
      "File: ext/agoo/http.c -> ext/agoo/http.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "50:     \"Accept-Encoding\",",
      "51:     \"Accept-Features\",",
      "52:     \"Accept-Language\",",
      "54:     \"Accept-Patch\",",
      "55:     \"Accept-Post\",",
      "56:     \"Accept-Ranges\",",
      "",
      "[Removed Lines]",
      "53:     \"Accept-Language\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "74:     \"Approved\",",
      "75:     \"Archive\",",
      "76:     \"Archived-At\",",
      "78:     \"Article-Names\",",
      "79:     \"Article-Updates\",",
      "80:     \"Authentication-Control\",",
      "",
      "[Removed Lines]",
      "77:     \"Archived-At\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "99:     \"Cc\",",
      "100:     \"Close\",",
      "101:     \"Comments\",",
      "103:     \"Compliance\",",
      "104:     \"Connection\",",
      "105:     \"Content-Alternative\",",
      "106:     \"Content-Base\",",
      "108:     \"Content-Description\",",
      "109:     \"Content-Disposition\",",
      "111:     \"Content-Duration\",",
      "112:     \"Content-Encoding\",",
      "113:     \"Content-ID\",",
      "115:     \"Content-Identifier\",",
      "116:     \"Content-Language\",",
      "118:     \"Content-Length\",",
      "119:     \"Content-Location\",",
      "122:     \"Content-MD5\",",
      "123:     \"Content-Range\",",
      "124:     \"Content-Return\",",
      "125:     \"Content-Script-Type\",",
      "126:     \"Content-Style-Type\",",
      "127:     \"Content-Transfer-Encoding\",",
      "129:     \"Content-Translation-Type\",",
      "130:     \"Content-Type\",",
      "132:     \"Content-Version\",",
      "133:     \"Content-features\",",
      "134:     \"Control\",",
      "",
      "[Removed Lines]",
      "102:     \"Comments\",",
      "107:     \"Content-Base\",",
      "110:     \"Content-Disposition\",",
      "114:     \"Content-ID\",",
      "117:     \"Content-Language\",",
      "120:     \"Content-Location\",",
      "121:     \"Content-MD5\",",
      "128:     \"Content-Transfer-Encoding\",",
      "131:     \"Content-Type\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "141:     \"DAV\",",
      "142:     \"DKIM-Signature\",",
      "143:     \"DL-Expansion-History\",",
      "146:     \"Date\",",
      "147:     \"Date-Received\",",
      "148:     \"Default-Style\",",
      "",
      "[Removed Lines]",
      "144:     \"Date\",",
      "145:     \"Date\",",
      "",
      "[Added Lines]",
      "133:     \"DNT\",",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "182:     \"Downgraded-Sender\",",
      "183:     \"Downgraded-To\",",
      "184:     \"EDIINT-Features\",",
      "186:     \"ETag\",",
      "187:     \"Eesst-Version\",",
      "188:     \"Encoding\",",
      "",
      "[Removed Lines]",
      "185:     \"EDIINT-Features\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "190:     \"Errors-To\",",
      "191:     \"Expect\",",
      "192:     \"Expires\",",
      "195:     \"Expiry-Date\",",
      "196:     \"Ext\",",
      "197:     \"Followup-To\",",
      "198:     \"Form-Sub\",",
      "199:     \"Forwarded\",",
      "200:     \"From\",",
      "203:     \"Generate-Delivery-Report\",",
      "204:     \"GetProfile\",",
      "205:     \"HTTP2-Settings\",",
      "",
      "[Removed Lines]",
      "193:     \"Expires\",",
      "194:     \"Expires\",",
      "201:     \"From\",",
      "202:     \"From\",",
      "",
      "[Added Lines]",
      "186:     \"Front-End-Https\",",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "219:     \"Injection-Date\",",
      "220:     \"Injection-Info\",",
      "221:     \"Jabber-ID\",",
      "223:     \"Keep-Alive\",",
      "224:     \"Keywords\",",
      "226:     \"Label\",",
      "227:     \"Language\",",
      "228:     \"Last-Modified\",",
      "",
      "[Removed Lines]",
      "222:     \"Jabber-ID\",",
      "225:     \"Keywords\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "240:     \"Location\",",
      "241:     \"Lock-Token\",",
      "242:     \"MIME-Version\",",
      "244:     \"MMHS-Acp127-Message-Identifier\",",
      "245:     \"MMHS-Authorizing-Users\",",
      "246:     \"MMHS-Codress-Message-Indicator\",",
      "",
      "[Removed Lines]",
      "243:     \"MIME-Version\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "262:     \"Memento-Datetime\",",
      "263:     \"Message-Context\",",
      "264:     \"Message-ID\",",
      "267:     \"Message-Type\",",
      "268:     \"Meter\",",
      "269:     \"Method-Check\",",
      "",
      "[Removed Lines]",
      "265:     \"Message-ID\",",
      "266:     \"Message-ID\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "279:     \"Optional-WWW-Authenticate\",",
      "280:     \"Ordering-Type\",",
      "281:     \"Organization\",",
      "283:     \"Origin\",",
      "284:     \"Original-Encoded-Information-Types\",",
      "285:     \"Original-From\",",
      "",
      "[Removed Lines]",
      "282:     \"Organization\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "292:     \"P3P\",",
      "293:     \"PEP\",",
      "294:     \"PICS-Label\",",
      "296:     \"Path\",",
      "297:     \"Pep-Info\",",
      "298:     \"Position\",",
      "",
      "[Removed Lines]",
      "295:     \"PICS-Label\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "311:     \"Proxy-Authenticate\",",
      "312:     \"Proxy-Authentication-Info\",",
      "313:     \"Proxy-Authorization\",",
      "314:     \"Proxy-Features\",",
      "315:     \"Proxy-Instruction\",",
      "316:     \"Public\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "291:     \"Proxy-Connection\",",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "321:     \"Received-SPF\",",
      "322:     \"Redirect-Ref\",",
      "323:     \"References\",",
      "325:     \"Referer\",",
      "326:     \"Referer-Root\",",
      "327:     \"Relay-Version\",",
      "328:     \"Reply-By\",",
      "329:     \"Reply-To\",",
      "331:     \"Require-Recipient-Valid-Since\",",
      "332:     \"Resent-Bcc\",",
      "333:     \"Resent-Cc\",",
      "",
      "[Removed Lines]",
      "324:     \"References\",",
      "330:     \"Reply-To\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "345:     \"SIO-Label-History\",",
      "346:     \"SLUG\",",
      "347:     \"Safe\",",
      "348:     \"Schedule-Reply\",",
      "349:     \"Schedule-Tag\",",
      "350:     \"Sec-WebSocket-Accept\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "324:     \"Save-Data\",",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "367:     \"Strict-Transport-Security\",",
      "368:     \"SubOK\",",
      "369:     \"Subject\",",
      "371:     \"Subst\",",
      "372:     \"Summary\",",
      "373:     \"Supersedes\",",
      "375:     \"Surrogate-Capability\",",
      "376:     \"Surrogate-Control\",",
      "377:     \"TCN\",",
      "",
      "[Removed Lines]",
      "370:     \"Subject\",",
      "374:     \"Supersedes\",",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "390:     \"UA-Windowpixels\",",
      "391:     \"URI\",",
      "392:     \"Upgrade\",",
      "393:     \"Urgency\",",
      "394:     \"User-Agent\",",
      "396:     \"VBR-Info\",",
      "397:     \"Variant-Vary\",",
      "398:     \"Vary\",",
      "",
      "[Removed Lines]",
      "395:     \"User-Agent\",",
      "",
      "[Added Lines]",
      "368:     \"Upgrade-Insecure-Requests\",",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "401:     \"WWW-Authenticate\",",
      "402:     \"Want-Digest\",",
      "403:     \"Warning\",",
      "405:     \"X-Archived-At\",",
      "406:     \"X-Content-Type-Options\",",
      "407:     \"X-Device-Accept\",",
      "408:     \"X-Device-Accept-Charset\",",
      "409:     \"X-Device-Accept-Encoding\",",
      "410:     \"X-Device-Accept-Language\",",
      "411:     \"X-Device-User-Agent\",",
      "412:     \"X-Frame-Options\",",
      "413:     \"X-Mittente\",",
      "414:     \"X-PGP-Sig\",",
      "415:     \"X-Ricevuta\",",
      "416:     \"X-Riferimento-Message-ID\",",
      "417:     \"X-TipoRicevuta\",",
      "418:     \"X-Trasporto\",",
      "419:     \"X-VerificaSicurezza\",",
      "420:     \"X-XSS-Protection\",",
      "421:     \"X400-Content-Identifier\",",
      "422:     \"X400-Content-Return\",",
      "",
      "[Removed Lines]",
      "404:     \"X-Archived-At\",",
      "",
      "[Added Lines]",
      "379:     \"X-ATT-DeviceId\",",
      "382:     \"X-Correlation-ID\",",
      "383:     \"X-Csrf-Token\",",
      "389:     \"X-Forwarded-For\",",
      "390:     \"X-Forwarded-Host\",",
      "391:     \"X-Forwarded-Proto\",",
      "393:     \"X-Http-Method-Override\",",
      "396:     \"X-Request-ID\",",
      "397:     \"X-Requested-With\",",
      "402:     \"X-UIDH\",",
      "404:     \"X-Wap-Profile\",",
      "",
      "---------------"
    ],
    "ext/agoo/req.h||ext/agoo/req.h": [
      "File: ext/agoo/req.h -> ext/agoo/req.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: #ifndef AGOO_REQ_H",
      "4: #define AGOO_REQ_H",
      "6: #include <stdint.h>",
      "8: #include \"hook.h\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6: #include <arpa/inet.h>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "32:     struct _agooStr  query;",
      "33:     struct _agooStr  header;",
      "34:     struct _agooStr  body;",
      "35:     void   *env;",
      "36:     agooHook   hook;",
      "37:     size_t   mlen;   // allocated msg length",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "36:     char   remote[INET6_ADDRSTRLEN];",
      "",
      "---------------"
    ],
    "ext/agoo/request.c||ext/agoo/request.c": [
      "File: ext/agoo/request.c -> ext/agoo/request.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "43: static VALUE rack_url_scheme_val = Qundef;",
      "44: static VALUE rack_version_val = Qundef;",
      "45: static VALUE rack_version_val_val = Qundef;",
      "46: static VALUE request_method_val = Qundef;",
      "47: static VALUE script_name_val = Qundef;",
      "48: static VALUE server_name_val = Qundef;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "46: static VALUE remote_addr_val = Qundef;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "96:     return req_method((agooReq)DATA_PTR(self));",
      "97: }",
      "99: static VALUE",
      "100: req_script_name(agooReq r) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "100: static VALUE",
      "101: req_remote_addr(agooReq r) {",
      "103:     if (NULL == r) {",
      "104:  rb_raise(rb_eArgError, \"Request is no longer valid.\");",
      "105:     }",
      "106:     return rb_str_new(r->remote, strlen(r->remote));",
      "107: }",
      "115: static VALUE",
      "116: remote_addr(VALUE self) {",
      "117:     return req_remote_addr((agooReq)DATA_PTR(self));",
      "118: }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "367: static void",
      "368: add_header_value(VALUE hh, const char *key, int klen, const char *val, int vlen) {",
      "369:     if (sizeof(content_type) - 1 == klen && 0 == strncasecmp(key, content_type, sizeof(content_type) - 1)) {",
      "371:     } else if (sizeof(content_length) - 1 == klen && 0 == strncasecmp(key, content_length, sizeof(content_length) - 1)) {",
      "373:     } else {",
      "374:  char  hkey[1024];",
      "375:  char  *k = hkey;",
      "376:  volatile VALUE sval = rb_str_new(val, vlen);",
      "378:  strcpy(hkey, \"HTTP_\");",
      "379:  k = hkey + 5;",
      "",
      "[Removed Lines]",
      "370:  rb_hash_aset(hh, content_type_val, rb_str_new(val, vlen));",
      "372:  rb_hash_aset(hh, content_length_val, rb_str_new(val, vlen));",
      "",
      "[Added Lines]",
      "391:     VALUE v;",
      "394:  if (Qnil == (v = rb_hash_lookup2(hh, content_type_val, Qnil))) {",
      "395:      rb_hash_aset(hh, content_type_val, rb_str_new(val, vlen));",
      "396:  } else {",
      "397:      volatile VALUE a = rb_ary_new();",
      "399:      rb_ary_push(a, v);",
      "400:      rb_ary_push(a, rb_str_new(val, vlen));",
      "401:      rb_hash_aset(hh, content_type_val, a);",
      "402:  }",
      "404:  if (Qnil == (v = rb_hash_lookup2(hh, content_length_val, Qnil))) {",
      "405:      rb_hash_aset(hh, content_length_val, rb_str_new(val, vlen));",
      "406:  } else {",
      "407:      rb_raise(rb_eArgError, \"Multiple Content-Length headers.\");",
      "408:  }",
      "413:  volatile VALUE kval;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "393:      }",
      "394:  }",
      "396:     }",
      "397: }",
      "",
      "[Removed Lines]",
      "395:  rb_hash_aset(hh, rb_str_new(hkey, klen + 5), sval);",
      "",
      "[Added Lines]",
      "432:  kval = rb_str_new(hkey, klen + 5);",
      "433:  if (Qnil == (v = rb_hash_lookup2(hh, kval, Qnil))) {",
      "434:      rb_hash_aset(hh, kval, sval);",
      "435:  } else {",
      "436:      volatile VALUE a = rb_ary_new();",
      "438:      rb_ary_push(a, v);",
      "439:      rb_ary_push(a, sval);",
      "440:      rb_hash_aset(hh, kval, a);",
      "441:  }",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "545:  rb_hash_aset(env, script_name_val, req_script_name(req));",
      "546:  rb_hash_aset(env, path_info_val, req_path_info(req));",
      "547:  rb_hash_aset(env, query_string_val, req_query_string(req));",
      "549:  rb_hash_aset(env, server_port_val, req_server_port(req));",
      "550:  fill_headers(req, env);",
      "551:  rb_hash_aset(env, rack_version_val, rack_version_val_val);",
      "552:  rb_hash_aset(env, rack_url_scheme_val, req_rack_url_scheme(req));",
      "",
      "[Removed Lines]",
      "548:  rb_hash_aset(env, server_name_val, req_server_name(req));",
      "",
      "[Added Lines]",
      "594:  rb_hash_aset(env, remote_addr_val, req_remote_addr(req));",
      "596:  rb_hash_aset(env, server_name_val, req_server_name(req));",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "663:     rb_define_method(req_class, \"query_string\", query_string, 0);",
      "664:     rb_define_method(req_class, \"server_name\", server_name, 0);",
      "665:     rb_define_method(req_class, \"server_port\", server_port, 0);",
      "666:     rb_define_method(req_class, \"rack_version\", rack_version, 0);",
      "667:     rb_define_method(req_class, \"rack_url_scheme\", rack_url_scheme, 0);",
      "668:     rb_define_method(req_class, \"rack_input\", rack_input, 0);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "713:     rb_define_method(req_class, \"remote_addr\", remote_addr, 0);",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "713:     rack_upgrade_val = rb_str_new_cstr(\"rack.upgrade?\"); rb_gc_register_address(&rack_upgrade_val);",
      "714:     rack_url_scheme_val = rb_str_new_cstr(\"rack.url_scheme\"); rb_gc_register_address(&rack_url_scheme_val);",
      "715:     rack_version_val = rb_str_new_cstr(\"rack.version\");  rb_gc_register_address(&rack_version_val);",
      "716:     request_method_val = rb_str_new_cstr(\"REQUEST_METHOD\"); rb_gc_register_address(&request_method_val);",
      "717:     script_name_val = rb_str_new_cstr(\"SCRIPT_NAME\");  rb_gc_register_address(&script_name_val);",
      "718:     server_name_val = rb_str_new_cstr(\"SERVER_NAME\");  rb_gc_register_address(&server_name_val);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "764:     remote_addr_val = rb_str_new_cstr(\"REMOTE_ADDR\");  rb_gc_register_address(&remote_addr_val);",
      "",
      "---------------"
    ],
    "ext/agoo/server.c||ext/agoo/server.c": [
      "File: ext/agoo/server.c -> ext/agoo/server.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "161:       setsockopt(client_sock, SOL_SOCKET, SO_KEEPALIVE, &optval, sizeof(optval));",
      "162:       setsockopt(client_sock, IPPROTO_TCP, TCP_NODELAY, &optval, sizeof(optval));",
      "166:       con_cnt = atomic_fetch_add(&agoo_server.con_cnt, 1);",
      "167:       if (agoo_server.loop_max > agoo_server.loop_cnt && agoo_server.loop_cnt * LOOP_UP < con_cnt) {",
      "",
      "[Removed Lines]",
      "163:       agoo_log_cat(&agoo_con_cat, \"Server with pid %d accepted connection %llu on %s [%d]\",",
      "164:      getpid(), (unsigned long long)cnt, b->id, con->sock);",
      "",
      "[Added Lines]",
      "163:       agoo_log_cat(&agoo_con_cat, \"Server with pid %d accepted connection %llu on %s [%d] from %s\",",
      "164:      getpid(), (unsigned long long)cnt, b->id, con->sock, con->remote);",
      "",
      "---------------"
    ],
    "ext/agoo/websocket.c||ext/agoo/websocket.c": [
      "File: ext/agoo/websocket.c -> ext/agoo/websocket.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "189:     c->req->method = (AGOO_WS_OP_BIN == op) ? AGOO_ON_BIN : AGOO_ON_MSG;",
      "190:     c->req->upgrade = AGOO_UP_NONE;",
      "191:     c->req->up = c->up;",
      "192:     c->req->res = NULL;",
      "193:     if (c->up->on_msg) {",
      "194:  c->req->hook = agoo_hook_create(AGOO_NONE, NULL, c->up->ctx, PUSH_HOOK, &agoo_server.eval_queue);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "192:     memcpy(c->req->remote, c->remote, sizeof(c->remote));",
      "",
      "---------------"
    ],
    "lib/agoo/version.rb||lib/agoo/version.rb": [
      "File: lib/agoo/version.rb -> lib/agoo/version.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "2: module Agoo",
      "3:   # Agoo version.",
      "5: end",
      "",
      "[Removed Lines]",
      "4:   VERSION = '2.13.0'",
      "",
      "[Added Lines]",
      "4:   VERSION = '2.14.0'",
      "",
      "---------------"
    ],
    "test/base_handler_test.rb||test/base_handler_test.rb": [
      "File: test/base_handler_test.rb -> test/base_handler_test.rb"
    ],
    "test/rack_handler_test.rb||test/rack_handler_test.rb": [
      "File: test/rack_handler_test.rb -> test/rack_handler_test.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "105:       \"PATH_INFO\" => \"/tellme\",",
      "106:       \"QUERY_STRING\" => \"a=1\",",
      "107:       \"REQUEST_METHOD\" => \"GET\",",
      "108:       \"SCRIPT_NAME\" => \"\",",
      "109:       \"SERVER_NAME\" => \"localhost\",",
      "110:       \"SERVER_PORT\" => \"6467\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "108:       \"REMOTE_ADDR\" => \"127.0.0.1\",",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8d34c3d09dea2e579114a3371ed6110c06212edc",
      "candidate_info": {
        "commit_hash": "8d34c3d09dea2e579114a3371ed6110c06212edc",
        "repo": "ohler55/agoo",
        "commit_url": "https://github.com/ohler55/agoo/commit/8d34c3d09dea2e579114a3371ed6110c06212edc",
        "files": [
          "CHANGELOG.md",
          "lib/agoo/version.rb"
        ],
        "message": "Release version update",
        "before_after_code_files": [
          "lib/agoo/version.rb||liagoo/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ],
          "candidate": [
            "lib/agoo/version.rb||liagoo/version.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/agoo/version.rb||liagoo/version.rb": [
          "File: lib/agoo/version.rb -> liagoo/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3:   # Agoo version.",
          "5: end",
          "",
          "[Removed Lines]",
          "4:   VERSION = '2.12.3'",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f40f5b403f2e45af2119462fff6c1b181ec8d285",
      "candidate_info": {
        "commit_hash": "f40f5b403f2e45af2119462fff6c1b181ec8d285",
        "repo": "ohler55/agoo",
        "commit_url": "https://github.com/ohler55/agoo/commit/f40f5b403f2e45af2119462fff6c1b181ec8d285",
        "files": [
          "CHANGELOG.md",
          "bin/agoo_stubs",
          "example/graphql/song.graphql",
          "lib/agoo/version.rb"
        ],
        "message": "Complete stub generator",
        "before_after_code_files": [
          "example/graphql/song.graphql||example/graphql/song.graphql",
          "lib/agoo/version.rb||liagoo/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ],
          "candidate": [
            "lib/agoo/version.rb||liagoo/version.rb"
          ]
        }
      },
      "candidate_diff": {
        "example/graphql/song.graphql||example/graphql/song.graphql": [
          "File: example/graphql/song.graphql -> example/graphql/song.graphql",
          "--- Hunk 1 ---",
          "[Context before]",
          "8:   like(artist: String!, song: String!): Song",
          "9: }",
          "11: type Artist {",
          "12:   name: String!",
          "13:   songs: [Song]",
          "14:   origin: [String]",
          "15: }",
          "17: type Song {",
          "18:   name: String!",
          "19:   artist: Artist",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "11: \"Represents a music artist.\"",
          "18: \"Information about a song of an artist.\"",
          "",
          "---------------"
        ],
        "lib/agoo/version.rb||liagoo/version.rb": [
          "File: lib/agoo/version.rb -> liagoo/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3:   # Agoo version.",
          "5: end",
          "",
          "[Removed Lines]",
          "4:   VERSION = '2.12.1'",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9bfa1dfd32b03b1f79e3fb08e45d46ba690e9bd3",
      "candidate_info": {
        "commit_hash": "9bfa1dfd32b03b1f79e3fb08e45d46ba690e9bd3",
        "repo": "ohler55/agoo",
        "commit_url": "https://github.com/ohler55/agoo/commit/9bfa1dfd32b03b1f79e3fb08e45d46ba690e9bd3",
        "files": [
          "CHANGELOG.md",
          "ext/agoo/extconf.rb",
          "lib/agoo/version.rb"
        ],
        "message": "Added compiler directives to allow building on Alpine linux",
        "before_after_code_files": [
          "ext/agoo/extconf.rb||ext/agoo/extconf.rb",
          "lib/agoo/version.rb||liagoo/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ],
          "candidate": [
            "lib/agoo/version.rb||liagoo/version.rb"
          ]
        }
      },
      "candidate_diff": {
        "ext/agoo/extconf.rb||ext/agoo/extconf.rb": [
          "File: ext/agoo/extconf.rb -> ext/agoo/extconf.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "11:   $CFLAGS += ' -std=c11'",
          "12: end",
          "14: # Adding the __attribute__ flag only works with gcc compilers and even then it",
          "15: # does not work to check args with varargs so just remove the check.",
          "16: CONFIG['warnflags'].slice!(/ -Wsuggest-attribute=format/)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "14: $CFLAGS += ' -D_POSIX_SOURCE -D_GNU_SOURCE'",
          "",
          "---------------"
        ],
        "lib/agoo/version.rb||liagoo/version.rb": [
          "File: lib/agoo/version.rb -> liagoo/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3:   # Agoo version.",
          "5: end",
          "",
          "[Removed Lines]",
          "4:   VERSION = '2.11.4'",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8ca3cfc0d9f2333882605f5d78e142175bf1ff2e",
      "candidate_info": {
        "commit_hash": "8ca3cfc0d9f2333882605f5d78e142175bf1ff2e",
        "repo": "ohler55/agoo",
        "commit_url": "https://github.com/ohler55/agoo/commit/8ca3cfc0d9f2333882605f5d78e142175bf1ff2e",
        "files": [
          "CHANGELOG.md",
          "agoo.gemspec",
          "example/Gemfile",
          "ext/agoo/extconf.rb",
          "ext/agoo/rgraphql.c",
          "ext/agoo/rserver.c",
          "lib/agoo.rb",
          "lib/agoo/version.rb"
        ],
        "message": "Cleanup for Ruby 2.7.0",
        "before_after_code_files": [
          "agoo.gemspec||agoo.gemspec",
          "ext/agoo/extconf.rb||ext/agoo/extconf.rb",
          "ext/agoo/rgraphql.c||ext/agoo/rgraphql.c",
          "ext/agoo/rserver.c||ext/agoo/rserver.c",
          "lib/agoo.rb||liagoo.rb",
          "lib/agoo/version.rb||liagoo/version.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ],
          "candidate": [
            "lib/agoo/version.rb||liagoo/version.rb"
          ]
        }
      },
      "candidate_diff": {
        "agoo.gemspec||agoo.gemspec": [
          "File: agoo.gemspec -> agoo.gemspec",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:   s.required_ruby_version = '>= 2.5'",
          "27:   s.requirements << 'Linux or macOS'",
          "31: end",
          "",
          "[Removed Lines]",
          "29:   s.add_development_dependency 'oj', '~> 3.7', '>= 3.7.1'",
          "",
          "[Added Lines]",
          "29:   s.add_development_dependency 'oj', '~> 3.10', '>= 3.10.0'",
          "",
          "---------------"
        ],
        "ext/agoo/extconf.rb||ext/agoo/extconf.rb": [
          "File: ext/agoo/extconf.rb -> ext/agoo/extconf.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: # does not work to check args with varargs so just remove the check.",
          "18: CONFIG['warnflags'].slice!(/ -Wsuggest-attribute=format/)",
          "19: CONFIG['warnflags'].slice!(/ -Wdeclaration-after-statement/)",
          "21: have_header('stdatomic.h')",
          "22: #have_header('sys/epoll.h')",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: CONFIG['warnflags'].slice!(/ -Wmissing-noreturn/)",
          "",
          "---------------"
        ],
        "ext/agoo/rgraphql.c||ext/agoo/rgraphql.c": [
          "File: ext/agoo/rgraphql.c -> ext/agoo/rgraphql.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "62: }",
          "64: static VALUE",
          "66:     Eval  eval = (Eval)x;",
          "67:     volatile VALUE info = rb_errinfo();",
          "68:     volatile VALUE msg = rb_funcall(info, rb_intern(\"message\"), 0);",
          "",
          "[Removed Lines]",
          "65: rescue_error(VALUE x) {",
          "",
          "[Added Lines]",
          "65: rescue_error(VALUE x, VALUE ignore) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "75: }",
          "77: static VALUE",
          "81:     eval->value = gql_doc_eval(eval->err, eval->doc);",
          "",
          "[Removed Lines]",
          "78: call_eval(void *x) {",
          "79:     Eval eval = (Eval)x;",
          "",
          "[Added Lines]",
          "78: call_eval(VALUE x) {",
          "79:     Eval eval = (Eval)(void*)x;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "548: }",
          "550: static VALUE",
          "552:     agooErr  err = (agooErr)x;",
          "553:     volatile VALUE info = rb_errinfo();",
          "554:     volatile VALUE msg = rb_funcall(info, rb_intern(\"message\"), 0);",
          "",
          "[Removed Lines]",
          "551: rescue_yield_error(VALUE x) {",
          "",
          "[Added Lines]",
          "551: rescue_yield_error(VALUE x, VALUE ignore) {",
          "",
          "---------------"
        ],
        "ext/agoo/rserver.c||ext/agoo/rserver.c": [
          "File: ext/agoo/rserver.c -> ext/agoo/rserver.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "325: static const char bad500[] = \"HTTP/1.1 500 Internal Error\\r\\nConnection: Close\\r\\nContent-Length: \";",
          "327: static VALUE",
          "329:     agooReq  req = (agooReq)x;",
          "330:     volatile VALUE info = rb_errinfo();",
          "331:     volatile VALUE msg = rb_funcall(info, rb_intern(\"message\"), 0);",
          "",
          "[Removed Lines]",
          "328: rescue_error(VALUE x) {",
          "",
          "[Added Lines]",
          "328: rescue_error(VALUE x, VALUE ignore) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "364: }",
          "366: static VALUE",
          "369:     volatile VALUE rr = request_wrap(req);",
          "370:     volatile VALUE rres = response_new();",
          "",
          "[Removed Lines]",
          "367: handle_base_inner(void *x) {",
          "368:     agooReq  req = (agooReq)x;",
          "",
          "[Added Lines]",
          "367: handle_base_inner(VALUE x) {",
          "368:     agooReq  req = (agooReq)(void*)x;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "387: }",
          "389: static int",
          "391:     const char  *ks = StringValuePtr(key);",
          "392:     int   klen = (int)RSTRING_LEN(key);",
          "393:     const char  *vs = StringValuePtr(value);",
          "",
          "[Removed Lines]",
          "390: header_cb(VALUE key, VALUE value, agooText *tp) {",
          "",
          "[Added Lines]",
          "390: header_cb(VALUE key, VALUE value, VALUE tv) {",
          "391:     agooText  *tp = (agooText*)tv;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "424: }",
          "426: static VALUE",
          "430:     return Qnil;",
          "431: }",
          "433: static VALUE",
          "437:     return Qnil;",
          "438: }",
          "440: static VALUE",
          "444:     return Qnil;",
          "445: }",
          "447: static VALUE",
          "449:     agooReq  req = (agooReq)x;",
          "450:     agooText  t;",
          "451:     volatile VALUE env = request_env(req, request_wrap(req));",
          "",
          "[Removed Lines]",
          "427: header_each_cb(VALUE kv, agooText *tp) {",
          "428:     header_cb(rb_ary_entry(kv, 0), rb_ary_entry(kv, 1), tp);",
          "434: body_len_cb(VALUE v, int *sizep) {",
          "441: body_append_cb(VALUE v, agooText *tp) {",
          "448: handle_rack_inner(void *x) {",
          "",
          "[Added Lines]",
          "428: header_each_cb(VALUE kv, VALUE cb_arg, int argc, const VALUE *argv, VALUE blockarg) {",
          "429:     agooText *tp = (agooText*)cb_arg;",
          "431:     header_cb(rb_ary_entry(kv, 0), rb_ary_entry(kv, 1), (VALUE)tp);",
          "437: body_len_cb(VALUE v, VALUE cb_arg, int argc, const VALUE *argv, VALUE blockarg) {",
          "438:     int *sizep = (int*)cb_arg;",
          "446: body_append_cb(VALUE v, VALUE cb_arg, int argc, const VALUE *argv, VALUE blockarg) {",
          "447:     agooText *tp = (agooText*)cb_arg;",
          "455: handle_rack_inner(VALUE x) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "611: }",
          "613: static VALUE",
          "615:     agooReq  req = (agooReq)x;",
          "616:     volatile VALUE rr = request_wrap(req);",
          "617:     volatile VALUE rres = response_new();",
          "",
          "[Removed Lines]",
          "614: handle_wab_inner(void *x) {",
          "",
          "[Added Lines]",
          "621: handle_wab_inner(VALUE x) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "634: }",
          "636: static VALUE",
          "638:     agooReq req = (agooReq)x;",
          "640:     switch (req->method) {",
          "",
          "[Removed Lines]",
          "637: handle_push_inner(void *x) {",
          "",
          "[Added Lines]",
          "644: handle_push_inner(VALUE x) {",
          "",
          "---------------"
        ],
        "lib/agoo.rb||liagoo.rb": [
          "File: lib/agoo.rb -> liagoo.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3: end",
          "5: require 'agoo/version'",
          "6: require 'rack/handler/agoo'",
          "7: require 'agoo/agoo' # C extension",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lib/agoo/version.rb||liagoo/version.rb": [
          "File: lib/agoo/version.rb -> liagoo/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3:   # Agoo version.",
          "5: end",
          "",
          "[Removed Lines]",
          "4:   VERSION = '2.11.6'",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "af8080ed75800e5fd1a4af9c943c927272703c71",
      "candidate_info": {
        "commit_hash": "af8080ed75800e5fd1a4af9c943c927272703c71",
        "repo": "ohler55/agoo",
        "commit_url": "https://github.com/ohler55/agoo/commit/af8080ed75800e5fd1a4af9c943c927272703c71",
        "files": [
          "CHANGELOG.md",
          "ext/agoo/gqleval.c",
          "ext/agoo/graphql.c",
          "ext/agoo/graphql.h",
          "ext/agoo/rgraphql.c",
          "lib/agoo/version.rb",
          "misc/song.md",
          "notes",
          "test/graphql_test.rb"
        ],
        "message": "Request GraphQL access",
        "before_after_code_files": [
          "ext/agoo/gqleval.c||ext/agoo/gqleval.c",
          "ext/agoo/graphql.c||ext/agoo/graphql.c",
          "ext/agoo/graphql.h||ext/agoo/graphql.h",
          "ext/agoo/rgraphql.c||ext/agoo/rgraphql.c",
          "lib/agoo/version.rb||liagoo/version.rb",
          "test/graphql_test.rb||test/graphql_test.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/agoo/version.rb||lib/agoo/version.rb"
          ],
          "candidate": [
            "lib/agoo/version.rb||liagoo/version.rb"
          ]
        }
      },
      "candidate_diff": {
        "ext/agoo/gqleval.c||ext/agoo/gqleval.c": [
          "File: ext/agoo/gqleval.c -> ext/agoo/gqleval.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "416:  return;",
          "417:     }",
          "418:     set_doc_op(doc, op_name, oplen);",
          "420:     if (NULL == gql_doc_eval_func) {",
          "421:  result = gql_doc_eval(&err, doc);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "419:     doc->req = req;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "559:  return NULL;",
          "560:     }",
          "561:     set_doc_op(doc, op_name, oplen);",
          "563:     if (NULL == gql_doc_eval_func) {",
          "564:  result = gql_doc_eval(err, doc);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "561:     doc->req = req;",
          "",
          "---------------"
        ],
        "ext/agoo/graphql.c||ext/agoo/graphql.c": [
          "File: ext/agoo/graphql.c -> ext/agoo/graphql.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1355:  doc->ops = NULL;",
          "1356:  doc->vars = NULL;",
          "1357:  doc->frags = NULL;",
          "1358:     }",
          "1359:     return doc;",
          "1360: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1358:  doc->req = NULL;",
          "1359:  doc->ctx = NULL;",
          "1360:  doc->ctx_free = NULL;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1474:  doc->frags = frag->next;",
          "1475:  gql_frag_destroy(frag);",
          "1476:     }",
          "1477:     AGOO_FREE(doc);",
          "1478: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1480:     if (NULL != doc->ctx_free) {",
          "1481:  doc->ctx_free(doc->ctx);",
          "1482:     }",
          "",
          "---------------"
        ],
        "ext/agoo/graphql.h||ext/agoo/graphql.h": [
          "File: ext/agoo/graphql.h -> ext/agoo/graphql.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "202:     gqlFrag  frags;",
          "203:     gqlOp  op; // the op to execute",
          "204:     struct _gqlFuncs funcs;",
          "205: } *gqlDoc;",
          "207: extern int gql_init(agooErr err);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "205:     struct _agooReq *req;",
          "206:     void  *ctx;",
          "207:     void  (*ctx_free)(void*);",
          "",
          "---------------"
        ],
        "ext/agoo/rgraphql.c||ext/agoo/rgraphql.c": [
          "File: ext/agoo/rgraphql.c -> ext/agoo/rgraphql.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: #include \"gqlvalue.h\"",
          "14: #include \"graphql.h\"",
          "15: #include \"pub.h\"",
          "16: #include \"sdl.h\"",
          "17: #include \"server.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16: #include \"request.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "33: static TypeClass type_class_map = NULL;",
          "35: static int",
          "37:     gqlType  type;",
          "38:     gqlDirUse  use;",
          "39:     volatile VALUE v;",
          "",
          "[Removed Lines]",
          "36: make_ruby_use(agooErr err, VALUE root, const char *method, const char *type_name, bool fresh, gqlType schema_type, const char *desc) {",
          "",
          "[Added Lines]",
          "37: make_ruby_use(agooErr    err,",
          "38:        VALUE      root,",
          "39:        const char *method,",
          "40:        const char *type_name,",
          "41:        bool       fresh,",
          "42:        gqlType    schema_type,",
          "43:        const char *desc) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "372:     return type;",
          "373: }",
          "375: static int",
          "376: resolve(agooErr err, gqlDoc doc, gqlRef target, gqlField field, gqlSel sel, gqlValue result, int depth) {",
          "377:     volatile VALUE child;",
          "378:     VALUE  obj = (VALUE)target;",
          "379:     int   d2 = depth + 1;",
          "380:     const char  *key = sel->name;",
          "382:     if ('_' == *sel->name && '_' == sel->name[1]) {",
          "383:  if (0 == strcmp(\"__typename\", sel->name)) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "382: static VALUE",
          "383: make_plan(gqlSel sel) {",
          "389:     return Qnil;",
          "390: }",
          "395:     volatile VALUE rreq = Qnil;",
          "399:     ID   method;",
          "400:     int   arity;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "397:      return agoo_err_set(err, AGOO_ERR_EVAL, \"Not a valid operation on the root object.\");",
          "398:  }",
          "399:     }",
          "402:     } else {",
          "403:  volatile VALUE rargs = rb_hash_new();",
          "404:  gqlSelArg sa;",
          "",
          "[Removed Lines]",
          "400:     if (NULL == sel->args) {",
          "401:  child = rb_funcall(obj, rb_intern(sel->name), 0);",
          "",
          "[Added Lines]",
          "420:     method = rb_intern(sel->name);",
          "421:     arity = rb_obj_method_arity(obj, method);",
          "422:     if (0 == arity) {",
          "423:  child = rb_funcall(obj, method, 0);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "429:      }",
          "430:      rb_hash_aset(rargs, rb_str_new_cstr(sa->name), gval_to_ruby(v));",
          "431:  }",
          "433:     }",
          "434:     if (GQL_SUBSCRIPTION == doc->op->kind && RUBY_T_STRING == rb_type(child)) {",
          "435:  gqlValue c;",
          "",
          "[Removed Lines]",
          "432:  child = rb_funcall(obj, rb_intern(sel->name), 1, rargs);",
          "",
          "[Added Lines]",
          "454:  if (-1 == arity || 1 == arity) {",
          "455:      child = rb_funcall(obj, method, 1, rargs);",
          "456:  } else {",
          "457:      if (NULL == doc->ctx) {",
          "458:   rreq = request_wrap(doc->req);",
          "459:   doc->ctx = (void*)rreq;",
          "460:      } else {",
          "461:   rreq = (VALUE)doc->ctx;",
          "462:      }",
          "463:      if (-2 == arity || 2 == arity) {",
          "464:   child = rb_funcall(obj, method, 2, rargs, rreq);",
          "465:      } else {",
          "466:   child = rb_funcall(obj, method, 3, rargs, rreq, make_plan(sel));",
          "467:      }",
          "468:  }",
          "",
          "---------------"
        ],
        "lib/agoo/version.rb||liagoo/version.rb": [
          "File: lib/agoo/version.rb -> liagoo/version.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: module Agoo",
          "3:   # Agoo version.",
          "5: end",
          "",
          "[Removed Lines]",
          "4:   VERSION = '2.11.7'",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/graphql_test.rb||test/graphql_test.rb": [
          "File: test/graphql_test.rb -> test/graphql_test.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:     @likes = 0",
          "27:   end",
          "30:     @songs[args['name']]",
          "31:   end",
          "",
          "[Removed Lines]",
          "29:   def song(args={})",
          "",
          "[Added Lines]",
          "29:   def song(args)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "35:     @songs << song",
          "36:   end",
          "39:     g = args['genre']",
          "40:     a = []",
          "41:     @songs.each { |s|",
          "",
          "[Removed Lines]",
          "38:   def genre_songs(args={})",
          "",
          "[Added Lines]",
          "38:   def genre_songs(args)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "126:     @artists = artists",
          "127:   end",
          "130:     @artists[args['name']]",
          "131:   end",
          "132: end",
          "",
          "[Removed Lines]",
          "129:   def artist(args={})",
          "",
          "[Added Lines]",
          "129:   def artist(args)",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "138:     @artists = artists",
          "139:   end",
          "142:     artist = @artists[args['artist']]",
          "143:     artist.like",
          "144:     artist",
          "",
          "[Removed Lines]",
          "141:   def like(args={})",
          "",
          "[Added Lines]",
          "141:   def like(args)",
          "",
          "---------------"
        ]
      }
    }
  ]
}