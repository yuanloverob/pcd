{
  "cve_id": "CVE-2016-10192",
  "cve_desc": "Heap-based buffer overflow in ffserver.c in FFmpeg before 2.8.10, 3.0.x before 3.0.5, 3.1.x before 3.1.6, and 3.2.x before 3.2.2 allows remote attackers to execute arbitrary code by leveraging failure to check chunk size.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "a5d25faa3f4b18dac737fdb35d0dd68eb0dc2156",
  "patch_info": {
    "commit_hash": "a5d25faa3f4b18dac737fdb35d0dd68eb0dc2156",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/a5d25faa3f4b18dac737fdb35d0dd68eb0dc2156",
    "files": [
      "ffserver.c"
    ],
    "message": "ffserver: Check chunk size\n\nFixes out of array access\n\nFixes: poc_ffserver.py\nFound-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
    "before_after_code_files": [
      "ffserver.c||ffserver.c"
    ]
  },
  "patch_diff": {
    "ffserver.c||ffserver.c": [
      "File: ffserver.c -> ffserver.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2738:         } else if (c->buffer_ptr - c->buffer >= 2 &&",
      "2739:                    !memcmp(c->buffer_ptr - 1, \"\\r\\n\", 2)) {",
      "2740:             c->chunk_size = strtol(c->buffer, 0, 16);",
      "2742:                 goto fail;",
      "2743:             c->buffer_ptr = c->buffer;",
      "2744:             break;",
      "2745:         } else if (++loop_run > 10)",
      "",
      "[Removed Lines]",
      "2741:             if (c->chunk_size == 0) // end of stream",
      "",
      "[Added Lines]",
      "2741:             if (c->chunk_size <= 0) { // end of stream or invalid chunk size",
      "2742:                 c->chunk_size = 0;",
      "2744:             }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2762:             goto fail;",
      "2763:         else {",
      "2764:             c->chunk_size -= len;",
      "2765:             c->buffer_ptr += len;",
      "2766:             c->data_count += len;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2766:             av_assert0(len <= c->chunk_size);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "a07cf6423ec30be54493d46ad541c8f91fe1c13e",
      "candidate_info": {
        "commit_hash": "a07cf6423ec30be54493d46ad541c8f91fe1c13e",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/a07cf6423ec30be54493d46ad541c8f91fe1c13e",
        "files": [
          "ffserver.c"
        ],
        "message": "ffserver: Check chunk size\n\nFixes out of array access\n\nFixes: poc_ffserver.py\nFound-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit a5d25faa3f4b18dac737fdb35d0dd68eb0dc2156)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "ffserver.c||ffserver.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ffserver.c||ffserver.c"
          ],
          "candidate": [
            "ffserver.c||ffserver.c"
          ]
        }
      },
      "candidate_diff": {
        "ffserver.c||ffserver.c": [
          "File: ffserver.c -> ffserver.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2704:         } else if (c->buffer_ptr - c->buffer >= 2 &&",
          "2705:                    !memcmp(c->buffer_ptr - 1, \"\\r\\n\", 2)) {",
          "2706:             c->chunk_size = strtol(c->buffer, 0, 16);",
          "2708:                 goto fail;",
          "2709:             c->buffer_ptr = c->buffer;",
          "2710:             break;",
          "2711:         } else if (++loop_run > 10) {",
          "",
          "[Removed Lines]",
          "2707:             if (c->chunk_size == 0) // end of stream",
          "",
          "[Added Lines]",
          "2707:             if (c->chunk_size <= 0) { // end of stream or invalid chunk size",
          "2708:                 c->chunk_size = 0;",
          "2710:             }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2729:             goto fail;",
          "2730:         else {",
          "2731:             c->chunk_size -= len;",
          "2732:             c->buffer_ptr += len;",
          "2733:             c->data_count += len;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2733:             av_assert0(len <= c->chunk_size);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1768e02a046ac05cb212991ae23021ad412cd15a",
      "candidate_info": {
        "commit_hash": "1768e02a046ac05cb212991ae23021ad412cd15a",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/1768e02a046ac05cb212991ae23021ad412cd15a",
        "files": [
          "ffserver.c"
        ],
        "message": "ffserver: Check chunk size\n\nFixes out of array access\n\nFixes: poc_ffserver.py\nFound-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit a5d25faa3f4b18dac737fdb35d0dd68eb0dc2156)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "ffserver.c||ffserver.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ffserver.c||ffserver.c"
          ],
          "candidate": [
            "ffserver.c||ffserver.c"
          ]
        }
      },
      "candidate_diff": {
        "ffserver.c||ffserver.c": [
          "File: ffserver.c -> ffserver.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2701:         } else if (c->buffer_ptr - c->buffer >= 2 &&",
          "2702:                    !memcmp(c->buffer_ptr - 1, \"\\r\\n\", 2)) {",
          "2703:             c->chunk_size = strtol(c->buffer, 0, 16);",
          "2705:                 goto fail;",
          "2706:             c->buffer_ptr = c->buffer;",
          "2707:             break;",
          "2708:         } else if (++loop_run > 10)",
          "",
          "[Removed Lines]",
          "2704:             if (c->chunk_size == 0) // end of stream",
          "",
          "[Added Lines]",
          "2704:             if (c->chunk_size <= 0) { // end of stream or invalid chunk size",
          "2705:                 c->chunk_size = 0;",
          "2707:             }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2725:             goto fail;",
          "2726:         else {",
          "2727:             c->chunk_size -= len;",
          "2728:             c->buffer_ptr += len;",
          "2729:             c->data_count += len;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2729:             av_assert0(len <= c->chunk_size);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c12ee64e80af2517005231388fdf4ea78f16bb0e",
      "candidate_info": {
        "commit_hash": "c12ee64e80af2517005231388fdf4ea78f16bb0e",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/c12ee64e80af2517005231388fdf4ea78f16bb0e",
        "files": [
          "ffserver.c"
        ],
        "message": "ffserver: Check chunk size\n\nFixes out of array access\n\nFixes: poc_ffserver.py\nFound-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit a5d25faa3f4b18dac737fdb35d0dd68eb0dc2156)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "ffserver.c||ffserver.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ffserver.c||ffserver.c"
          ],
          "candidate": [
            "ffserver.c||ffserver.c"
          ]
        }
      },
      "candidate_diff": {
        "ffserver.c||ffserver.c": [
          "File: ffserver.c -> ffserver.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2702:         } else if (c->buffer_ptr - c->buffer >= 2 &&",
          "2703:                    !memcmp(c->buffer_ptr - 1, \"\\r\\n\", 2)) {",
          "2704:             c->chunk_size = strtol(c->buffer, 0, 16);",
          "2706:                 goto fail;",
          "2707:             c->buffer_ptr = c->buffer;",
          "2708:             break;",
          "2709:         } else if (++loop_run > 10)",
          "",
          "[Removed Lines]",
          "2705:             if (c->chunk_size == 0) // end of stream",
          "",
          "[Added Lines]",
          "2705:             if (c->chunk_size <= 0) { // end of stream or invalid chunk size",
          "2706:                 c->chunk_size = 0;",
          "2708:             }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2726:             goto fail;",
          "2727:         else {",
          "2728:             c->chunk_size -= len;",
          "2729:             c->buffer_ptr += len;",
          "2730:             c->data_count += len;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2730:             av_assert0(len <= c->chunk_size);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "37904d11779482f375b13da24f33f75daf13638f",
      "candidate_info": {
        "commit_hash": "37904d11779482f375b13da24f33f75daf13638f",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/37904d11779482f375b13da24f33f75daf13638f",
        "files": [
          "ffserver.c"
        ],
        "message": "ffserver: Check chunk size\n\nFixes out of array access\n\nFixes: poc_ffserver.py\nFound-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit a5d25faa3f4b18dac737fdb35d0dd68eb0dc2156)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "ffserver.c||ffserver.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ffserver.c||ffserver.c"
          ],
          "candidate": [
            "ffserver.c||ffserver.c"
          ]
        }
      },
      "candidate_diff": {
        "ffserver.c||ffserver.c": [
          "File: ffserver.c -> ffserver.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2702:         } else if (c->buffer_ptr - c->buffer >= 2 &&",
          "2703:                    !memcmp(c->buffer_ptr - 1, \"\\r\\n\", 2)) {",
          "2704:             c->chunk_size = strtol(c->buffer, 0, 16);",
          "2706:                 goto fail;",
          "2707:             c->buffer_ptr = c->buffer;",
          "2708:             break;",
          "2709:         } else if (++loop_run > 10)",
          "",
          "[Removed Lines]",
          "2705:             if (c->chunk_size == 0) // end of stream",
          "",
          "[Added Lines]",
          "2705:             if (c->chunk_size <= 0) { // end of stream or invalid chunk size",
          "2706:                 c->chunk_size = 0;",
          "2708:             }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2726:             goto fail;",
          "2727:         else {",
          "2728:             c->chunk_size -= len;",
          "2729:             c->buffer_ptr += len;",
          "2730:             c->data_count += len;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2730:             av_assert0(len <= c->chunk_size);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e0cb113f9b4b7a26ac0053a483f92c26a4a90f0e",
      "candidate_info": {
        "commit_hash": "e0cb113f9b4b7a26ac0053a483f92c26a4a90f0e",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/e0cb113f9b4b7a26ac0053a483f92c26a4a90f0e",
        "files": [
          "ffserver.c"
        ],
        "message": "ffserver: Check chunk size\n\nFixes out of array access\n\nFixes: poc_ffserver.py\nFound-by: Paul Cher <paulcher@icloud.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit a5d25faa3f4b18dac737fdb35d0dd68eb0dc2156)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "ffserver.c||ffserver.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ffserver.c||ffserver.c"
          ],
          "candidate": [
            "ffserver.c||ffserver.c"
          ]
        }
      },
      "candidate_diff": {
        "ffserver.c||ffserver.c": [
          "File: ffserver.c -> ffserver.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2580:         } else if (c->buffer_ptr - c->buffer >= 2 &&",
          "2581:                    !memcmp(c->buffer_ptr - 1, \"\\r\\n\", 2)) {",
          "2582:             c->chunk_size = strtol(c->buffer, 0, 16);",
          "2584:                 goto fail;",
          "2585:             c->buffer_ptr = c->buffer;",
          "2586:             break;",
          "2587:         } else if (++loop_run > 10)",
          "",
          "[Removed Lines]",
          "2583:             if (c->chunk_size == 0) // end of stream",
          "",
          "[Added Lines]",
          "2583:             if (c->chunk_size <= 0) { // end of stream or invalid chunk size",
          "2584:                 c->chunk_size = 0;",
          "2586:             }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2604:             goto fail;",
          "2605:         else {",
          "2606:             c->chunk_size -= len;",
          "2607:             c->buffer_ptr += len;",
          "2608:             c->data_count += len;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2608:             av_assert0(len <= c->chunk_size);",
          "",
          "---------------"
        ]
      }
    }
  ]
}