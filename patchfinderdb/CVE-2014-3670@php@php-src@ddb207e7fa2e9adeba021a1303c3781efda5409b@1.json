{
  "cve_id": "CVE-2014-3670",
  "cve_desc": "The exif_ifd_make_value function in exif.c in the EXIF extension in PHP before 5.4.34, 5.5.x before 5.5.18, and 5.6.x before 5.6.2 operates on floating-point arrays incorrectly, which allows remote attackers to cause a denial of service (heap memory corruption and application crash) or possibly execute arbitrary code via a crafted JPEG image with TIFF thumbnail data that is improperly handled by the exif_thumbnail function.",
  "repo": "php/php-src",
  "patch_hash": "ddb207e7fa2e9adeba021a1303c3781efda5409b",
  "patch_info": {
    "commit_hash": "ddb207e7fa2e9adeba021a1303c3781efda5409b",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/ddb207e7fa2e9adeba021a1303c3781efda5409b",
    "files": [
      "ext/exif/exif.c",
      "ext/exif/tests/bug68113.jpg",
      "ext/exif/tests/bug68113.phpt"
    ],
    "message": "Fix bug #68113 (Heap corruption in exif_thumbnail())",
    "before_after_code_files": [
      "ext/exif/exif.c||ext/exif/exif.c",
      "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
    ]
  },
  "patch_diff": {
    "ext/exif/exif.c||ext/exif/exif.c": [
      "File: ext/exif/exif.c -> ext/exif/exif.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2426:      data_ptr += 8;",
      "2427:      break;",
      "2428:     case TAG_FMT_SINGLE:",
      "2430:      data_ptr += 4;",
      "2431:      break;",
      "2432:     case TAG_FMT_DOUBLE:",
      "2434:      data_ptr += 8;",
      "2435:      break;",
      "2436:    }",
      "",
      "[Removed Lines]",
      "2429:      memmove(data_ptr, &info_data->value.f, byte_count);",
      "2433:      memmove(data_ptr, &info_data->value.d, byte_count);",
      "",
      "[Added Lines]",
      "2429:      memmove(data_ptr, &info_value->f, 4);",
      "2433:      memmove(data_ptr, &info_value->d, 8);",
      "",
      "---------------"
    ],
    "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt": [
      "File: ext/exif/tests/bug68113.phpt -> ext/exif/tests/bug68113.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #68113 (Heap corruption in exif_thumbnail())",
      "3: --SKIPIF--",
      "4: <?php",
      "5: extension_loaded(\"exif\") or die(\"skip need exif\");",
      "6: ?>",
      "7: --FILE--",
      "8: <?php",
      "9: var_dump(exif_thumbnail(__DIR__.\"/bug68113.jpg\"));",
      "10: ?>",
      "11: Done",
      "12: --EXPECTF--",
      "13: Warning: exif_thumbnail(bug68113.jpg): File structure corrupted in %s/bug68113.php on line 2",
      "15: Warning: exif_thumbnail(bug68113.jpg): Invalid JPEG file in %s/bug68113.php on line 2",
      "16: bool(false)",
      "17: Done",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d0a6b7d1242bab3ebd4f1687bfa56b01e6767f67",
      "candidate_info": {
        "commit_hash": "d0a6b7d1242bab3ebd4f1687bfa56b01e6767f67",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/d0a6b7d1242bab3ebd4f1687bfa56b01e6767f67",
        "files": [
          "ext/curl/interface.c",
          "ext/exif/exif.c",
          "ext/exif/tests/bug68113.jpg",
          "ext/exif/tests/bug68113.phpt"
        ],
        "message": "Fix bug #68113 (Heap corruption in exif_thumbnail())",
        "before_after_code_files": [
          "ext/curl/interface.c||ext/curl/interface.c",
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/exif/exif.c||ext/exif/exif.c",
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ],
          "candidate": [
            "ext/exif/exif.c||ext/exif/exif.c",
            "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/curl/interface.c||ext/curl/interface.c": [
          "File: ext/curl/interface.c -> ext/curl/interface.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "172:  if (strlen(str) != len) {",
          "173:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Curl option contains invalid characters (\\\\0)\");",
          "175:  }",
          "177: #if LIBCURL_VERSION_NUM >= 0x071100",
          "",
          "[Removed Lines]",
          "174:   return 0;",
          "",
          "[Added Lines]",
          "174:   return FAILURE;",
          "",
          "---------------"
        ],
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2426:      data_ptr += 8;",
          "2427:      break;",
          "2428:     case TAG_FMT_SINGLE:",
          "2430:      data_ptr += 4;",
          "2431:      break;",
          "2432:     case TAG_FMT_DOUBLE:",
          "2434:      data_ptr += 8;",
          "2435:      break;",
          "2436:    }",
          "",
          "[Removed Lines]",
          "2429:      memmove(data_ptr, &info_data->value.f, byte_count);",
          "2433:      memmove(data_ptr, &info_data->value.d, byte_count);",
          "",
          "[Added Lines]",
          "2429:      memmove(data_ptr, &info_value->f, 4);",
          "2433:      memmove(data_ptr, &info_value->d, 8);",
          "",
          "---------------"
        ],
        "ext/exif/tests/bug68113.phpt||ext/exif/tests/bug68113.phpt": [
          "File: ext/exif/tests/bug68113.phpt -> ext/exif/tests/bug68113.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68113 (Heap corruption in exif_thumbnail())",
          "3: --SKIPIF--",
          "4: <?php",
          "5: extension_loaded(\"exif\") or die(\"skip need exif\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "9: var_dump(exif_thumbnail(__DIR__.\"/bug68113.jpg\"));",
          "10: ?>",
          "11: Done",
          "12: --EXPECTF--",
          "13: Warning: exif_thumbnail(bug68113.jpg): File structure corrupted in %s/bug68113.php on line 2",
          "15: Warning: exif_thumbnail(bug68113.jpg): Invalid JPEG file in %s/bug68113.php on line 2",
          "16: bool(false)",
          "17: Done",
          "",
          "---------------"
        ]
      }
    }
  ]
}