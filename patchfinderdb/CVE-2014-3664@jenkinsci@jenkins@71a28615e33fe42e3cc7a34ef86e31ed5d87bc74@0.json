{
  "cve_id": "CVE-2014-3664",
  "cve_desc": "Directory traversal vulnerability in Jenkins before 1.583 and LTS before 1.565.3 allows remote authenticated users with the Overall/READ permission to read arbitrary files via unspecified vectors.",
  "repo": "jenkinsci/jenkins",
  "patch_hash": "71a28615e33fe42e3cc7a34ef86e31ed5d87bc74",
  "patch_info": {
    "commit_hash": "71a28615e33fe42e3cc7a34ef86e31ed5d87bc74",
    "repo": "jenkinsci/jenkins",
    "commit_url": "https://github.com/jenkinsci/jenkins/commit/71a28615e33fe42e3cc7a34ef86e31ed5d87bc74",
    "files": [
      "core/src/main/java/hudson/Plugin.java",
      "test/src/test/java/hudson/PluginTest.java"
    ],
    "message": "[FIXED SECURITY-131] Recode restOfPath before constructing URLs from it, so it cannot be used for directory traversal.",
    "before_after_code_files": [
      "core/src/main/java/hudson/Plugin.java||core/src/main/java/hudson/Plugin.java",
      "test/src/test/java/hudson/PluginTest.java||test/src/test/java/hudson/PluginTest.java"
    ]
  },
  "patch_diff": {
    "core/src/main/java/hudson/Plugin.java||core/src/main/java/hudson/Plugin.java": [
      "File: core/src/main/java/hudson/Plugin.java -> core/src/main/java/hudson/Plugin.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "30: import hudson.model.listeners.ItemListener;",
      "31: import hudson.model.listeners.SaveableListener;",
      "32: import hudson.model.Descriptor.FormException;",
      "34: import org.kohsuke.stapler.StaplerRequest;",
      "35: import org.kohsuke.stapler.StaplerResponse;",
      "37: import javax.servlet.ServletContext;",
      "38: import javax.servlet.ServletException;",
      "40: import java.io.IOException;",
      "41: import java.io.File;",
      "44: import net.sf.json.JSONObject;",
      "45: import com.thoughtworks.xstream.XStream;",
      "",
      "[Removed Lines]",
      "33: import org.kohsuke.stapler.MetaClass;",
      "39: import javax.servlet.http.HttpServletResponse;",
      "42: import java.net.URL;",
      "",
      "[Added Lines]",
      "43: import java.net.URI;",
      "44: import java.net.URISyntaxException;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "204:         if(path.length()==0)",
      "205:             path = \"/\";",
      "",
      "[Removed Lines]",
      "207:         if(path.indexOf(\"..\")!=-1 || path.length()<1) {",
      "209:             rsp.sendError(HttpServletResponse.SC_BAD_REQUEST);",
      "210:             return;",
      "211:         }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "219:         long expires = staticLink ? TimeUnit2.DAYS.toMillis(365) : -1;",
      "223:     }",
      "",
      "[Removed Lines]",
      "222:         rsp.serveLocalizedFile(req, new URL(wrapper.baseResourceURL,'.'+path),expires);",
      "",
      "[Added Lines]",
      "215:         try {",
      "216:             rsp.serveLocalizedFile(req, wrapper.baseResourceURL.toURI().resolve(new URI(null, '.' + path, null)).toURL(), expires);",
      "217:         } catch (URISyntaxException x) {",
      "218:             throw new IOException(x);",
      "219:         }",
      "",
      "---------------"
    ],
    "test/src/test/java/hudson/PluginTest.java||test/src/test/java/hudson/PluginTest.java": [
      "File: test/src/test/java/hudson/PluginTest.java -> test/src/test/java/hudson/PluginTest.java",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "25: package hudson;",
      "27: import javax.servlet.http.HttpServletResponse;",
      "28: import org.junit.Test;",
      "29: import org.junit.Rule;",
      "30: import org.jvnet.hudson.test.JenkinsRule;",
      "32: public class PluginTest {",
      "34:     @Rule public JenkinsRule r = new JenkinsRule();",
      "37:     @Test public void doDynamic() throws Exception {",
      "38:         r.createWebClient().goTo(\"plugin/credentials/images/24x24/credentials.png\", \"image/png\");",
      "40:         r.createWebClient().assertFails(\"plugin/credentials/images/../images/24x24/credentials.png\", HttpServletResponse.SC_BAD_REQUEST);",
      "42:         r.createWebClient().assertFails(\"plugin/credentials/images/%2E%2E/images/24x24/credentials.png\", HttpServletResponse.SC_INTERNAL_SERVER_ERROR); // IAE from TokenList.<init>",
      "43:         r.createWebClient().assertFails(\"plugin/credentials/images/%252E%252E/images/24x24/credentials.png\", HttpServletResponse.SC_NOT_FOUND); // SECURITY-131",
      "44:         r.createWebClient().assertFails(\"plugin/credentials/images/%25252E%25252E/images/24x24/credentials.png\", HttpServletResponse.SC_NOT_FOUND); // just checking",
      "45:     }",
      "47: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3e15684f75bb80c0e138052ca71033ce6d6b58cd",
      "candidate_info": {
        "commit_hash": "3e15684f75bb80c0e138052ca71033ce6d6b58cd",
        "repo": "jenkinsci/jenkins",
        "commit_url": "https://github.com/jenkinsci/jenkins/commit/3e15684f75bb80c0e138052ca71033ce6d6b58cd",
        "files": [
          "core/src/main/java/hudson/Plugin.java"
        ],
        "message": "This is failing the animal sniffer test",
        "before_after_code_files": [
          "core/src/main/java/hudson/Plugin.java||core/src/main/java/hudson/Plugin.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "core/src/main/java/hudson/Plugin.java||core/src/main/java/hudson/Plugin.java"
          ],
          "candidate": [
            "core/src/main/java/hudson/Plugin.java||core/src/main/java/hudson/Plugin.java"
          ]
        }
      },
      "candidate_diff": {
        "core/src/main/java/hudson/Plugin.java||core/src/main/java/hudson/Plugin.java": [
          "File: core/src/main/java/hudson/Plugin.java -> core/src/main/java/hudson/Plugin.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: package hudson;",
          "26: import hudson.util.TimeUnit2;",
          "27: import jenkins.model.Jenkins;",
          "28: import hudson.model.Descriptor;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26: import hudson.util.IOException2;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "220:         try {",
          "221:             rsp.serveLocalizedFile(req, wrapper.baseResourceURL.toURI().resolve(new URI(null, '.' + path, null)).toURL(), expires);",
          "222:         } catch (URISyntaxException x) {",
          "224:         }",
          "225:     }",
          "",
          "[Removed Lines]",
          "223:             throw new IOException(x);",
          "",
          "[Added Lines]",
          "224:             throw new IOException2(x);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c80741615b27f4414542b7a1aa8999eef2cd3475",
      "candidate_info": {
        "commit_hash": "c80741615b27f4414542b7a1aa8999eef2cd3475",
        "repo": "jenkinsci/jenkins",
        "commit_url": "https://github.com/jenkinsci/jenkins/commit/c80741615b27f4414542b7a1aa8999eef2cd3475",
        "files": [
          "core/src/main/java/hudson/Plugin.java"
        ],
        "message": "Revert \"This is failing the animal sniffer test\"\n\nThis reverts commit 3e15684f75bb80c0e138052ca71033ce6d6b58cd.\nNot necessary after getting 5e7b844b6.",
        "before_after_code_files": [
          "core/src/main/java/hudson/Plugin.java||core/src/main/java/hudson/Plugin.java"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "core/src/main/java/hudson/Plugin.java||core/src/main/java/hudson/Plugin.java"
          ],
          "candidate": [
            "core/src/main/java/hudson/Plugin.java||core/src/main/java/hudson/Plugin.java"
          ]
        }
      },
      "candidate_diff": {
        "core/src/main/java/hudson/Plugin.java||core/src/main/java/hudson/Plugin.java": [
          "File: core/src/main/java/hudson/Plugin.java -> core/src/main/java/hudson/Plugin.java",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: package hudson;",
          "27: import hudson.util.TimeUnit2;",
          "28: import jenkins.model.Jenkins;",
          "29: import hudson.model.Descriptor;",
          "",
          "[Removed Lines]",
          "26: import hudson.util.IOException2;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "221:         try {",
          "222:             rsp.serveLocalizedFile(req, wrapper.baseResourceURL.toURI().resolve(new URI(null, '.' + path, null)).toURL(), expires);",
          "223:         } catch (URISyntaxException x) {",
          "225:         }",
          "226:     }",
          "",
          "[Removed Lines]",
          "224:             throw new IOException2(x);",
          "",
          "[Added Lines]",
          "223:             throw new IOException(x);",
          "",
          "---------------"
        ]
      }
    }
  ]
}