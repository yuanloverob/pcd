{
  "cve_id": "CVE-2015-7551",
  "cve_desc": "The Fiddle::Handle implementation in ext/fiddle/handle.c in Ruby before 2.0.0-p648, 2.1 before 2.1.8, and 2.2 before 2.2.4, as distributed in Apple OS X before 10.11.4 and other products, mishandles tainting, which allows context-dependent attackers to execute arbitrary code or cause a denial of service (application crash) via a crafted string, related to the DL module and the libffi library.  NOTE: this vulnerability exists because of a CVE-2009-5147 regression.",
  "repo": "ruby/ruby",
  "patch_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
  "patch_info": {
    "commit_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
    "repo": "ruby/ruby",
    "commit_url": "https://github.com/ruby/ruby/commit/339e11a7f178312d937b7c95dd3115ce7236597a",
    "files": [
      "ChangeLog",
      "ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb",
      "version.h"
    ],
    "message": "merge revision(s): 53153 and 23405@ruby_1_9_1\n\n\t* ext/fiddle/handle.c: check tainted string arguments.\n\t  Patch provided by tenderlove and nobu.\n\n\t* test/fiddle/test_handle.rb (class TestHandle): add test for above.\n\n\t* ext/dl/handle.c (rb_dlhandle_initialize): prohibits DL::dlopen\n\t  with a tainted name of library.\n\t  Patch by sheepman <sheepman AT sheepman.sakura.ne.jp>.\n\n\t* ext/dl/handle.c (rb_dlhandle_sym): ditto\n\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53156 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
    "before_after_code_files": [
      "ext/fiddle/handle.c||ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb",
      "version.h||version.h"
    ]
  },
  "patch_diff": {
    "ext/fiddle/handle.c||ext/fiddle/handle.c": [
      "File: ext/fiddle/handle.c -> ext/fiddle/handle.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #include <ruby.h>",
      "2: #include <fiddle.h>",
      "4: VALUE rb_cHandle;",
      "6: struct dl_handle {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4: #define SafeStringValueCStr(v) (rb_check_safe_obj(rb_string_value(&v)), StringValueCStr(v))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "143:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "144:  break;",
      "145:       case 1:",
      "147:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "148:  break;",
      "149:       case 2:",
      "151:  cflag = NUM2INT(flag);",
      "152:  break;",
      "153:       default:",
      "",
      "[Removed Lines]",
      "146:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "150:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "",
      "[Added Lines]",
      "148:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "152:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "263:     return PTR2NUM(fiddle_handle);",
      "264: }",
      "",
      "[Removed Lines]",
      "266: static VALUE fiddle_handle_sym(void *handle, const char *symbol);",
      "",
      "[Added Lines]",
      "268: static VALUE fiddle_handle_sym(void *handle, VALUE symbol);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "282:  rb_raise(rb_eFiddleError, \"closed handle\");",
      "283:     }",
      "286: }",
      "288: #ifndef RTLD_NEXT",
      "",
      "[Removed Lines]",
      "285:     return fiddle_handle_sym(fiddle_handle->ptr, StringValueCStr(sym));",
      "",
      "[Added Lines]",
      "287:     return fiddle_handle_sym(fiddle_handle->ptr, sym);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "305: static VALUE",
      "306: rb_fiddle_handle_s_sym(VALUE self, VALUE sym)",
      "307: {",
      "309: }",
      "311: static VALUE",
      "313: {",
      "314: #if defined(HAVE_DLERROR)",
      "315:     const char *err;",
      "",
      "[Removed Lines]",
      "308:     return fiddle_handle_sym(RTLD_NEXT, StringValueCStr(sym));",
      "312: fiddle_handle_sym(void *handle, const char *name)",
      "",
      "[Added Lines]",
      "310:     return fiddle_handle_sym(RTLD_NEXT, sym);",
      "314: fiddle_handle_sym(void *handle, VALUE symbol)",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "318: # define CHECK_DLERROR",
      "319: #endif",
      "320:     void (*func)();",
      "322:     rb_secure(2);",
      "323: #ifdef HAVE_DLERROR",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "323:     const char *name = SafeStringValueCStr(symbol);",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "367:     }",
      "368: #endif",
      "369:     if( !func ){",
      "371:     }",
      "373:     return PTR2NUM(func);",
      "",
      "[Removed Lines]",
      "370:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%s\\\"\", name);",
      "",
      "[Added Lines]",
      "373:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%\"PRIsVALUE\"\\\"\", symbol);",
      "",
      "---------------"
    ],
    "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb": [
      "File: test/fiddle/test_handle.rb -> test/fiddle/test_handle.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "11:     include Test::Unit::Assertions",
      "13:     def test_to_i",
      "14:       handle = Fiddle::Handle.new(LIBC_SO)",
      "15:       assert_kind_of Integer, handle.to_i",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "13:     def test_safe_handle_open",
      "14:       t = Thread.new do",
      "15:         $SAFE = 1",
      "16:         Fiddle::Handle.new(LIBC_SO.taint)",
      "17:       end",
      "18:       assert_raise(SecurityError) { t.value }",
      "19:     end",
      "21:     def test_safe_function_lookup",
      "22:       t = Thread.new do",
      "23:         h = Fiddle::Handle.new(LIBC_SO)",
      "24:         $SAFE = 1",
      "25:         h[\"qsort\".taint]",
      "26:       end",
      "27:       assert_raise(SecurityError) { t.value }",
      "28:     end",
      "",
      "---------------"
    ],
    "version.h||version.h": [
      "File: version.h -> version.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #define RUBY_VERSION \"2.1.8\"",
      "2: #define RUBY_RELEASE_DATE \"2015-12-16\"",
      "5: #define RUBY_RELEASE_YEAR 2015",
      "6: #define RUBY_RELEASE_MONTH 12",
      "",
      "[Removed Lines]",
      "3: #define RUBY_PATCHLEVEL 438",
      "",
      "[Added Lines]",
      "3: #define RUBY_PATCHLEVEL 439",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "cb826f3ff9b14107e3d94f431acdfed4b1d76e04",
      "candidate_info": {
        "commit_hash": "cb826f3ff9b14107e3d94f431acdfed4b1d76e04",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/cb826f3ff9b14107e3d94f431acdfed4b1d76e04",
        "files": [
          "ChangeLog",
          "ext/digest/bubblebabble/bubblebabble.c",
          "ext/digest/bubblebabble/extconf.rb",
          "ext/digest/md5/extconf.rb",
          "ext/digest/md5/md5.h",
          "ext/digest/md5/md5init.c",
          "ext/digest/rmd160/extconf.rb",
          "ext/digest/rmd160/rmd160.c",
          "ext/digest/rmd160/rmd160.h",
          "ext/digest/rmd160/rmd160init.c",
          "ext/digest/rmd160/rmd160ossl.c",
          "ext/digest/sha1/extconf.rb",
          "ext/digest/sha1/sha1.h",
          "ext/digest/sha1/sha1init.c",
          "ext/digest/sha2/extconf.rb",
          "ext/digest/sha2/sha2.c",
          "ext/digest/sha2/sha2init.c",
          "ext/digest/sha2/sha2ossl.c",
          "version.h"
        ],
        "message": "merge revision(s) 52694: [Backport #3231]\n\n\t* ext/digest/*/*.[ch]: include ruby.h before digest.h to avoid\n\t  includeing ext/digest/extconf.h. [Bug #3231]\n\t  https://msdn.microsoft.com/library/36k2cdd4.aspx\n\n\t* ext/digest/*/extconf.rb: remove ext/digest from include search path\n\t  to avoid confusion of cl.exe.\n\n\t* ext/digest/*/*.[ch]: explicitly specify def.h's path.\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@52797 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "ext/digest/bubblebabble/bubblebabble.c||ext/digest/bubblebabble/bubblebabble.c",
          "ext/digest/bubblebabble/extconf.rb||ext/digest/bubblebabble/extconf.rb",
          "ext/digest/md5/extconf.rb||ext/digest/md5/extconf.rb",
          "ext/digest/md5/md5.h||ext/digest/md5/md5.h",
          "ext/digest/md5/md5init.c||ext/digest/md5/md5init.c",
          "ext/digest/rmd160/extconf.rb||ext/digest/rmd160/extconf.rb",
          "ext/digest/rmd160/rmd160.c||ext/digest/rmd160/rmd160.c",
          "ext/digest/rmd160/rmd160.h||ext/digest/rmd160/rmd160.h",
          "ext/digest/rmd160/rmd160init.c||ext/digest/rmd160/rmd160init.c",
          "ext/digest/rmd160/rmd160ossl.c||ext/digest/rmd160/rmd160ossl.c",
          "ext/digest/sha1/extconf.rb||ext/digest/sha1/extconf.rb",
          "ext/digest/sha1/sha1.h||ext/digest/sha1/sha1.h",
          "ext/digest/sha1/sha1init.c||ext/digest/sha1/sha1init.c",
          "ext/digest/sha2/extconf.rb||ext/digest/sha2/extconf.rb",
          "ext/digest/sha2/sha2.c||ext/digest/sha2/sha2.c",
          "ext/digest/sha2/sha2init.c||ext/digest/sha2/sha2init.c",
          "ext/digest/sha2/sha2ossl.c||ext/digest/sha2/sha2ossl.c",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/digest/bubblebabble/bubblebabble.c||ext/digest/bubblebabble/bubblebabble.c": [
          "File: ext/digest/bubblebabble/bubblebabble.c -> ext/digest/bubblebabble/bubblebabble.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: static ID id_digest;",
          "",
          "[Removed Lines]",
          "14: #include \"ruby.h\"",
          "15: #include \"digest.h\"",
          "",
          "[Added Lines]",
          "14: #include <ruby/ruby.h>",
          "15: #include \"../digest.h\"",
          "",
          "---------------"
        ],
        "ext/digest/bubblebabble/extconf.rb||ext/digest/bubblebabble/extconf.rb": [
          "File: ext/digest/bubblebabble/extconf.rb -> ext/digest/bubblebabble/extconf.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: require 'mkmf'",
          "3: $defs << \"-DHAVE_CONFIG_H\"",
          "6: create_makefile('digest/bubblebabble')",
          "",
          "[Removed Lines]",
          "4: $INCFLAGS << \" -I$(srcdir)/..\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/digest/md5/extconf.rb||ext/digest/md5/extconf.rb": [
          "File: ext/digest/md5/extconf.rb -> ext/digest/md5/extconf.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: require \"mkmf\"",
          "7: $defs << \"-DHAVE_CONFIG_H\"",
          "10: $objs = [ \"md5init.#{$OBJEXT}\" ]",
          "",
          "[Removed Lines]",
          "8: $INCFLAGS << \" -I$(srcdir)/..\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/digest/md5/md5.h||ext/digest/md5/md5.h": [
          "File: ext/digest/md5/md5.h -> ext/digest/md5/md5.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "46: #ifndef MD5_INCLUDED",
          "47: #  define MD5_INCLUDED",
          "",
          "[Removed Lines]",
          "49: #include \"defs.h\"",
          "",
          "[Added Lines]",
          "49: #include \"../defs.h\"",
          "",
          "---------------"
        ],
        "ext/digest/md5/md5init.c||ext/digest/md5/md5init.c": [
          "File: ext/digest/md5/md5init.c -> ext/digest/md5/md5init.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #if defined(HAVE_OPENSSL_MD5_H)",
          "6: #include \"md5ossl.h\"",
          "7: #else",
          "",
          "[Removed Lines]",
          "4: #include \"digest.h\"",
          "",
          "[Added Lines]",
          "4: #include <ruby/ruby.h>",
          "5: #include \"../digest.h\"",
          "",
          "---------------"
        ],
        "ext/digest/rmd160/extconf.rb||ext/digest/rmd160/extconf.rb": [
          "File: ext/digest/rmd160/extconf.rb -> ext/digest/rmd160/extconf.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: require \"mkmf\"",
          "7: $defs << \"-DNDEBUG\" << \"-DHAVE_CONFIG_H\"",
          "10: $objs = [ \"rmd160init.#{$OBJEXT}\" ]",
          "",
          "[Removed Lines]",
          "8: $INCFLAGS << \" -I$(srcdir)/..\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/digest/rmd160/rmd160.c||ext/digest/rmd160/rmd160.c": [
          "File: ext/digest/rmd160/rmd160.c -> ext/digest/rmd160/rmd160.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: #include \"rmd160.h\"",
          "25: #ifndef lint",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "23: #include \"../defs.h\"",
          "",
          "---------------"
        ],
        "ext/digest/rmd160/rmd160.h||ext/digest/rmd160/rmd160.h": [
          "File: ext/digest/rmd160/rmd160.h -> ext/digest/rmd160/rmd160.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "26: #ifndef _RMD160_H_",
          "27: #define _RMD160_H_",
          "31: typedef struct {",
          "",
          "[Removed Lines]",
          "29: #include \"defs.h\"",
          "",
          "[Added Lines]",
          "29: #include \"../defs.h\"",
          "",
          "---------------"
        ],
        "ext/digest/rmd160/rmd160init.c||ext/digest/rmd160/rmd160init.c": [
          "File: ext/digest/rmd160/rmd160init.c -> ext/digest/rmd160/rmd160init.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #if defined(HAVE_OPENSSL_RIPEMD_H)",
          "6: #include \"rmd160ossl.h\"",
          "7: #else",
          "",
          "[Removed Lines]",
          "4: #include \"digest.h\"",
          "",
          "[Added Lines]",
          "4: #include <ruby/ruby.h>",
          "5: #include \"../digest.h\"",
          "",
          "---------------"
        ],
        "ext/digest/rmd160/rmd160ossl.c||ext/digest/rmd160/rmd160ossl.c": [
          "File: ext/digest/rmd160/rmd160ossl.c -> ext/digest/rmd160/rmd160ossl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: #include \"rmd160ossl.h\"",
          "6: void RMD160_Finish(RMD160_CTX *ctx, char *buf) {",
          "",
          "[Removed Lines]",
          "3: #include \"defs.h\"",
          "",
          "[Added Lines]",
          "3: #include \"../defs.h\"",
          "",
          "---------------"
        ],
        "ext/digest/sha1/extconf.rb||ext/digest/sha1/extconf.rb": [
          "File: ext/digest/sha1/extconf.rb -> ext/digest/sha1/extconf.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: require \"mkmf\"",
          "7: $defs << \"-DHAVE_CONFIG_H\"",
          "10: $objs = [ \"sha1init.#{$OBJEXT}\" ]",
          "",
          "[Removed Lines]",
          "8: $INCFLAGS << \" -I$(srcdir)/..\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/digest/sha1/sha1.h||ext/digest/sha1/sha1.h": [
          "File: ext/digest/sha1/sha1.h -> ext/digest/sha1/sha1.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: #ifndef _SYS_SHA1_H_",
          "12: #define _SYS_SHA1_H_",
          "16: typedef struct {",
          "17:  uint32_t state[5];",
          "",
          "[Removed Lines]",
          "14: #include \"defs.h\"",
          "",
          "[Added Lines]",
          "14: #include \"../defs.h\"",
          "",
          "---------------"
        ],
        "ext/digest/sha1/sha1init.c||ext/digest/sha1/sha1init.c": [
          "File: ext/digest/sha1/sha1init.c -> ext/digest/sha1/sha1init.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #if defined(HAVE_OPENSSL_SHA_H)",
          "6: #include \"sha1ossl.h\"",
          "7: #else",
          "",
          "[Removed Lines]",
          "4: #include \"digest.h\"",
          "",
          "[Added Lines]",
          "4: #include <ruby/ruby.h>",
          "5: #include \"../digest.h\"",
          "",
          "---------------"
        ],
        "ext/digest/sha2/extconf.rb||ext/digest/sha2/extconf.rb": [
          "File: ext/digest/sha2/extconf.rb -> ext/digest/sha2/extconf.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: require \"mkmf\"",
          "7: $defs << \"-DHAVE_CONFIG_H\"",
          "10: $objs = [ \"sha2init.#{$OBJEXT}\" ]",
          "",
          "[Removed Lines]",
          "8: $INCFLAGS << \" -I$(srcdir)/..\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "29: $preload = %w[digest]",
          "",
          "[Removed Lines]",
          "31: if have_type(\"uint64_t\", \"defs.h\", $defs.join(' '))",
          "32:   create_makefile(\"digest/sha2\")",
          "33: end",
          "",
          "[Added Lines]",
          "30: create_makefile(\"digest/sha2\")",
          "",
          "---------------"
        ],
        "ext/digest/sha2/sha2.c||ext/digest/sha2/sha2.c": [
          "File: ext/digest/sha2/sha2.c -> ext/digest/sha2/sha2.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "40: #include \"sha2.h\"",
          "",
          "[Removed Lines]",
          "37: #include \"defs.h\"",
          "",
          "[Added Lines]",
          "37: #include \"../defs.h\"",
          "",
          "---------------"
        ],
        "ext/digest/sha2/sha2init.c||ext/digest/sha2/sha2init.c": [
          "File: ext/digest/sha2/sha2init.c -> ext/digest/sha2/sha2init.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #if defined(SHA2_USE_OPENSSL)",
          "6: #include \"sha2ossl.h\"",
          "7: #else",
          "",
          "[Removed Lines]",
          "4: #include \"digest.h\"",
          "",
          "[Added Lines]",
          "4: #include <ruby/ruby.h>",
          "5: #include \"../digest.h\"",
          "",
          "---------------"
        ],
        "ext/digest/sha2/sha2ossl.c||ext/digest/sha2/sha2ossl.c": [
          "File: ext/digest/sha2/sha2ossl.c -> ext/digest/sha2/sha2ossl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: #include \"sha2ossl.h\"",
          "4: #define SHA_Finish(bit) \\",
          "",
          "[Removed Lines]",
          "1: #include \"defs.h\"",
          "",
          "[Added Lines]",
          "1: #include \"../defs.h\"",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.8\"",
          "2: #define RUBY_RELEASE_DATE \"2015-11-30\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 11",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 422",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 423",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a1171a95b2b6f6d7e90d5dc50911ec12c02cb96d",
      "candidate_info": {
        "commit_hash": "a1171a95b2b6f6d7e90d5dc50911ec12c02cb96d",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/a1171a95b2b6f6d7e90d5dc50911ec12c02cb96d",
        "files": [
          "ChangeLog",
          "ext/digest/sha1/sha1ossl.c",
          "version.h"
        ],
        "message": "* ext/digest/sha1/sha1ossl.c: fixed build error introduced at r52797.\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@52828 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "ext/digest/sha1/sha1ossl.c||ext/digest/sha1/sha1ossl.c",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/digest/sha1/sha1ossl.c||ext/digest/sha1/sha1ossl.c": [
          "File: ext/digest/sha1/sha1ossl.c -> ext/digest/sha1/sha1ossl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: #include \"sha1ossl.h\"",
          "6: void",
          "",
          "[Removed Lines]",
          "3: #include \"defs.h\"",
          "",
          "[Added Lines]",
          "3: #include \"../defs.h\"",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.8\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "9: #include \"ruby/version.h\"",
          "",
          "[Removed Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-11-30\"",
          "3: #define RUBY_PATCHLEVEL 428",
          "6: #define RUBY_RELEASE_MONTH 11",
          "7: #define RUBY_RELEASE_DAY 30",
          "",
          "[Added Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-12-01\"",
          "3: #define RUBY_PATCHLEVEL 429",
          "6: #define RUBY_RELEASE_MONTH 12",
          "7: #define RUBY_RELEASE_DAY 1",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ee1a685178e57213723559c544ac3ad8a61fe5c6",
      "candidate_info": {
        "commit_hash": "ee1a685178e57213723559c544ac3ad8a61fe5c6",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/ee1a685178e57213723559c544ac3ad8a61fe5c6",
        "files": [
          "ChangeLog",
          "test/ruby/test_io.rb",
          "version.h"
        ],
        "message": "merge revision(s) 53227: [Backport #11852]\n\n\t* test/ruby/test_io.rb: handled rlimit value same as r52277\n\t  [Bug #11852][ruby-dev:49446]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@54436 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "test/ruby/test_io.rb||test/ruby/test_io.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "test/ruby/test_io.rb||test/ruby/test_io.rb": [
          "File: test/ruby/test_io.rb -> test/ruby/test_io.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "1067:     args = ['-e', '$>.write($<.read)'] if args.empty?",
          "1068:     ruby = EnvUtil.rubybin",
          "1069:     opts = {}",
          "1071:     f = IO.popen([ruby] + args, 'r+', opts)",
          "1072:     pid = f.pid",
          "1073:     yield(f)",
          "",
          "[Removed Lines]",
          "1070:     opts[:rlimit_nproc] = 1024 if defined?(Process::RLIMIT_NPROC)",
          "",
          "[Added Lines]",
          "1070:     if defined?(Process::RLIMIT_NPROC)",
          "1071:       lim = Process.getrlimit(Process::RLIMIT_NPROC)[1]",
          "1072:       opts[:rlimit_nproc] = [lim, 1024].min",
          "1073:     end",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.9\"",
          "5: #define RUBY_RELEASE_YEAR 2016",
          "6: #define RUBY_RELEASE_MONTH 3",
          "9: #include \"ruby/version.h\"",
          "",
          "[Removed Lines]",
          "2: #define RUBY_RELEASE_DATE \"2016-03-29\"",
          "3: #define RUBY_PATCHLEVEL 489",
          "7: #define RUBY_RELEASE_DAY 29",
          "",
          "[Added Lines]",
          "2: #define RUBY_RELEASE_DATE \"2016-03-30\"",
          "3: #define RUBY_PATCHLEVEL 490",
          "7: #define RUBY_RELEASE_DAY 30",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "976bf35c12581658f817541450cac253df3bc2d2",
      "candidate_info": {
        "commit_hash": "976bf35c12581658f817541450cac253df3bc2d2",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/976bf35c12581658f817541450cac253df3bc2d2",
        "files": [
          "ChangeLog",
          "ext/-test-/dln/empty/empty.c",
          "ext/-test-/dln/empty/extconf.rb",
          "ext/-test-/win32/dln/empty/extconf.rb",
          "test/-ext-/win32/test_dln.rb",
          "test/fiddle/test_handle.rb",
          "version.h"
        ],
        "message": "merge revision(s) 49154,49155,49156,49159: [Backport #10384] [Backport #11085]\n\n\text/-test-/dln/empty: move from ext/-test-/win32/dln\n\t* test/fiddle/test_handle.rb: fix syntax.\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@50383 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "ext/-test-/dln/empty/extconf.rb||ext/-test-/dln/empty/extconf.rb",
          "ext/-test-/win32/dln/empty/extconf.rb||ext/-test-/win32/dln/empty/extconf.rb",
          "test/-ext-/win32/test_dln.rb||test/-ext-/win32/test_dln.rb",
          "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb",
            "version.h||version.h"
          ],
          "candidate": [
            "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb",
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/-test-/dln/empty/extconf.rb||ext/-test-/dln/empty/extconf.rb": [
          "File: ext/-test-/dln/empty/extconf.rb -> ext/-test-/dln/empty/extconf.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: create_makefile(\"-test-/dln/empty\")",
          "",
          "---------------"
        ],
        "ext/-test-/win32/dln/empty/extconf.rb||ext/-test-/win32/dln/empty/extconf.rb": [
          "File: ext/-test-/win32/dln/empty/extconf.rb -> ext/-test-/win32/dln/empty/extconf.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/-ext-/win32/test_dln.rb||test/-ext-/win32/test_dln.rb": [
          "File: test/-ext-/win32/test_dln.rb -> test/-ext-/win32/test_dln.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "14:       def test_nonascii_load",
          "15:         bug9699 = '[ruby-core:61845] [Bug #9699]'",
          "17:         so = $:.find {|d| d = ::File.join(d, so); break d if ::File.exist?(d)}",
          "18:         assert_not_nil(so)",
          "19:         Dir.mkdir(dir = ::File.join(testdir = Dir.mktmpdir(\"test\"), \"\\u{30c6 30b9 30c8}\"))",
          "",
          "[Removed Lines]",
          "16:         so = \"-test-/win32/dln/empty.\" + RbConfig::CONFIG[\"DLEXT\"]",
          "",
          "[Added Lines]",
          "16:         so = \"-test-/dln/empty.\" + RbConfig::CONFIG[\"DLEXT\"]",
          "",
          "---------------"
        ],
        "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb": [
          "File: test/fiddle/test_handle.rb -> test/fiddle/test_handle.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "30:     end",
          "32:     def test_static_sym",
          "34:       begin",
          "35:         # Linux / Darwin / FreeBSD",
          "36:         refute_nil Fiddle::Handle.sym('dlopen')",
          "37:         assert_equal Fiddle::Handle.sym('dlopen'), Fiddle::Handle['dlopen']",
          "38:       rescue",
          "39:         # NetBSD",
          "40:         require '-test-/dln/empty'",
          "41:         refute_nil Fiddle::Handle.sym('Init_empty')",
          "42:         assert_equal Fiddle::Handle.sym('Init_empty'), Fiddle::Handle['Init_empty']",
          "43:       end",
          "46:     def test_sym_closed_handle",
          "47:       handle = Fiddle::Handle.new(LIBC_SO)",
          "",
          "[Removed Lines]",
          "33:       skip \"Fiddle::Handle.sym is not supported\" if /mswin|mingw/ =~ RUBY_PLATFORM",
          "44:     end",
          "",
          "[Added Lines]",
          "37:         return",
          "39:       end",
          "41:       begin",
          "46:         return",
          "47:       rescue",
          "49:     end unless /mswin|mingw/ =~ RUBY_PLATFORM",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "152:         # --- Ubuntu Linux 8.04 dlsym(3)",
          "153:         handle = Handle::NEXT",
          "154:         refute_nil handle['malloc']",
          "155:       rescue",
          "156:         # BSD",
          "157:         #",
          "158:         # If dlsym() is called with the special handle RTLD_NEXT, then the search",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "160:         return",
          "162:       end",
          "164:       begin",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "169:         require '-test-/dln/empty'",
          "170:         handle = Handle::NEXT",
          "171:         refute_nil handle['Init_empty']",
          "172:       end",
          "173:     end unless /mswin|mingw/ =~ RUBY_PLATFORM",
          "175:     def test_DEFAULT",
          "177:       handle = Handle::DEFAULT",
          "178:       refute_nil handle['malloc']",
          "179:     end unless /mswin|mingw/ =~ RUBY_PLATFORM",
          "",
          "[Removed Lines]",
          "176:       skip \"Handle::DEFAULT is not supported\" if /mswin|mingw/ =~ RUBY_PLATFORM",
          "",
          "[Added Lines]",
          "181:         return",
          "182:       rescue",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.7\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 4",
          "9: #include \"ruby/version.h\"",
          "",
          "[Removed Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-04-14\"",
          "3: #define RUBY_PATCHLEVEL 337",
          "7: #define RUBY_RELEASE_DAY 14",
          "",
          "[Added Lines]",
          "2: #define RUBY_RELEASE_DATE \"2015-04-24\"",
          "3: #define RUBY_PATCHLEVEL 338",
          "7: #define RUBY_RELEASE_DAY 24",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "baa85be5519976b13c2bf1cc295bea0623165aa6",
      "candidate_info": {
        "commit_hash": "baa85be5519976b13c2bf1cc295bea0623165aa6",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/baa85be5519976b13c2bf1cc295bea0623165aa6",
        "files": [
          "ChangeLog",
          "configure.in",
          "version.h"
        ],
        "message": "merge revision(s) r48886: [Backport #10210]\n\n\t* configure.in (rb_cv_binary_elf): get rid of -e option of cat\n\t  which is not available on BusyBox, use tr instead.\n\t  [ruby-core:64824] [Bug #10210]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@49470 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "configure.in||configure.in",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "2621: AC_CACHE_CHECK(whether ELF binaries are produced, rb_cv_binary_elf,",
          "2622: [AC_TRY_LINK([],[], [",
          "2625: rb_cv_binary_elf=no)])",
          "2627: if test \"$rb_cv_binary_elf\" = yes; then",
          "",
          "[Removed Lines]",
          "2623: AS_CASE([\"`head -1 conftest$EXEEXT | cat -e`\"],",
          "2624: ['^?ELF'*], [rb_cv_binary_elf=yes], [rb_cv_binary_elf=no])],",
          "",
          "[Added Lines]",
          "2623: AS_CASE([\"`head -1 conftest$EXEEXT | tr -dc '\\177ELF' | tr '\\177' .`\"],",
          "2624: [.ELF*], [rb_cv_binary_elf=yes], [rb_cv_binary_elf=no])],",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.5\"",
          "2: #define RUBY_RELEASE_DATE \"2015-02-02\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 2",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 286",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 287",
          "",
          "---------------"
        ]
      }
    }
  ]
}