{
  "cve_id": "CVE-2014-8142",
  "cve_desc": "Use-after-free vulnerability in the process_nested_data function in ext/standard/var_unserializer.re in PHP before 5.4.36, 5.5.x before 5.5.20, and 5.6.x before 5.6.4 allows remote attackers to execute arbitrary code via a crafted unserialize call that leverages improper handling of duplicate keys within the serialized properties of an object, a different vulnerability than CVE-2004-1019.",
  "repo": "php/php-src",
  "patch_hash": "630f9c33c23639de85c3fd306b209b538b73b4c9",
  "patch_info": {
    "commit_hash": "630f9c33c23639de85c3fd306b209b538b73b4c9",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/630f9c33c23639de85c3fd306b209b538b73b4c9",
    "files": [
      "NEWS",
      "ext/standard/tests/serialize/bug68594.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #68594 - Use after free vulnerability in unserialize()",
    "before_after_code_files": [
      "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt": [
      "File: ext/standard/tests/serialize/bug68594.phpt -> ext/standard/tests/serialize/bug68594.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #68545 Use after free vulnerability in unserialize()",
      "3: --FILE--",
      "4: <?php",
      "5: for ($i=4; $i<100; $i++) {",
      "6:  $m = new StdClass();",
      "8:  $u = array(1);",
      "10:  $m->aaa = array(1,2,&$u,4,5);",
      "11:  $m->bbb = 1;",
      "12:  $m->ccc = &$u;",
      "13:  $m->ddd = str_repeat(\"A\", $i);",
      "15:  $z = serialize($m);",
      "16:  $z = str_replace(\"bbb\", \"aaa\", $z);",
      "17:  $y = unserialize($z);",
      "18:  $z = serialize($y);",
      "19: }",
      "20: ?>",
      "21: ===DONE===",
      "22: --EXPECTF--",
      "23: ===DONE===",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "343:   } else {",
      "345:    convert_to_string(key);",
      "346:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
      "347:      sizeof data, NULL);",
      "348:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "346:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
      "347:     var_push_dtor(var_hash, old_data);",
      "348:    }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "484: {",
      "485:  YYCTYPE yych;",
      "486:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "483: #line 484 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "486: #line 487 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "540:  yych = *(YYMARKER = ++YYCURSOR);",
      "541:  if (yych == ':') goto yy95;",
      "542: yy3:",
      "544:  { return 0; }",
      "546: yy4:",
      "547:  yych = *(YYMARKER = ++YYCURSOR);",
      "548:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "543: #line 835 \"ext/standard/var_unserializer.re\"",
      "545: #line 546 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "546: #line 838 \"ext/standard/var_unserializer.re\"",
      "548: #line 549 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "585:  goto yy3;",
      "586: yy14:",
      "587:  ++YYCURSOR;",
      "589:  {",
      "591:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "593: }",
      "595: yy16:",
      "596:  yych = *++YYCURSOR;",
      "597:  goto yy3;",
      "",
      "[Removed Lines]",
      "588: #line 829 \"ext/standard/var_unserializer.re\"",
      "594: #line 595 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "591: #line 832 \"ext/standard/var_unserializer.re\"",
      "597: #line 598 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "617:  if (yybm[0+yych] & 128) {",
      "618:   goto yy20;",
      "619:  }",
      "621:  yych = *++YYCURSOR;",
      "622:  if (yych != '\"') goto yy18;",
      "623:  ++YYCURSOR;",
      "625:  {",
      "626:  size_t len, len2, len3, maxlen;",
      "627:  long elements;",
      "",
      "[Removed Lines]",
      "620:  if (yych != ':') goto yy18;",
      "624: #line 683 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "623:  if (yych <= '/') goto yy18;",
      "624:  if (yych >= ';') goto yy18;",
      "628: #line 686 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "768:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "769: }",
      "771: yy25:",
      "772:  yych = *++YYCURSOR;",
      "773:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "770: #line 771 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "774: #line 775 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "792:  yych = *++YYCURSOR;",
      "793:  if (yych != '\"') goto yy18;",
      "794:  ++YYCURSOR;",
      "796:  {",
      "798:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "795: #line 675 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "799: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "800:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "801:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "802: }",
      "804: yy32:",
      "805:  yych = *++YYCURSOR;",
      "806:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "803: #line 804 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "807: #line 808 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "821:  yych = *++YYCURSOR;",
      "822:  if (yych != '{') goto yy18;",
      "823:  ++YYCURSOR;",
      "825:  {",
      "826:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "824: #line 655 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "828: #line 658 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "842:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "843: }",
      "845: yy39:",
      "846:  yych = *++YYCURSOR;",
      "847:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "844: #line 845 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "848: #line 849 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "862:  yych = *++YYCURSOR;",
      "863:  if (yych != '\"') goto yy18;",
      "864:  ++YYCURSOR;",
      "866:  {",
      "867:  size_t len, maxlen;",
      "868:  char *str;",
      "",
      "[Removed Lines]",
      "865: #line 626 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "869: #line 629 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "891:  ZVAL_STRINGL(*rval, str, len, 0);",
      "892:  return 1;",
      "893: }",
      "895: yy46:",
      "896:  yych = *++YYCURSOR;",
      "897:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "894: #line 895 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "898: #line 899 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "912:  yych = *++YYCURSOR;",
      "913:  if (yych != '\"') goto yy18;",
      "914:  ++YYCURSOR;",
      "916:  {",
      "917:  size_t len, maxlen;",
      "918:  char *str;",
      "",
      "[Removed Lines]",
      "915: #line 598 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "919: #line 601 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "940:  ZVAL_STRINGL(*rval, str, len, 1);",
      "941:  return 1;",
      "942: }",
      "944: yy53:",
      "945:  yych = *++YYCURSOR;",
      "946:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "943: #line 944 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "947: #line 948 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1028:  }",
      "1029: yy63:",
      "1030:  ++YYCURSOR;",
      "1032:  {",
      "1033: #if SIZEOF_LONG == 4",
      "1034: use_double:",
      "",
      "[Removed Lines]",
      "1031: #line 588 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1035: #line 591 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1038:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1039:  return 1;",
      "1040: }",
      "1042: yy65:",
      "1043:  yych = *++YYCURSOR;",
      "1044:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1041: #line 1042 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1045: #line 1046 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1097:  yych = *++YYCURSOR;",
      "1098:  if (yych != ';') goto yy18;",
      "1099:  ++YYCURSOR;",
      "1101:  {",
      "1103:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1100: #line 573 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1104: #line 576 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1113:  return 1;",
      "1114: }",
      "1116: yy76:",
      "1117:  yych = *++YYCURSOR;",
      "1118:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1115: #line 1116 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1119: #line 1120 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1139:  if (yych <= '9') goto yy79;",
      "1140:  if (yych != ';') goto yy18;",
      "1141:  ++YYCURSOR;",
      "1143:  {",
      "1144: #if SIZEOF_LONG == 4",
      "1145:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1142: #line 546 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1146: #line 549 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1166:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1167:  return 1;",
      "1168: }",
      "1170: yy83:",
      "1171:  yych = *++YYCURSOR;",
      "1172:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1169: #line 1170 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1173: #line 1174 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1174:  yych = *++YYCURSOR;",
      "1175:  if (yych != ';') goto yy18;",
      "1176:  ++YYCURSOR;",
      "1178:  {",
      "1180:  INIT_PZVAL(*rval);",
      "1181:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1182:  return 1;",
      "1183: }",
      "1185: yy87:",
      "1186:  ++YYCURSOR;",
      "1188:  {",
      "1190:  INIT_PZVAL(*rval);",
      "1191:  ZVAL_NULL(*rval);",
      "1192:  return 1;",
      "1193: }",
      "1195: yy89:",
      "1196:  yych = *++YYCURSOR;",
      "1197:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1177: #line 539 \"ext/standard/var_unserializer.re\"",
      "1184: #line 1185 \"ext/standard/var_unserializer.c\"",
      "1187: #line 532 \"ext/standard/var_unserializer.re\"",
      "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1181: #line 542 \"ext/standard/var_unserializer.re\"",
      "1188: #line 1189 \"ext/standard/var_unserializer.c\"",
      "1191: #line 535 \"ext/standard/var_unserializer.re\"",
      "1198: #line 1199 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1214:  if (yych <= '9') goto yy91;",
      "1215:  if (yych != ';') goto yy18;",
      "1216:  ++YYCURSOR;",
      "1218:  {",
      "1219:  long id;",
      "",
      "[Removed Lines]",
      "1217: #line 509 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1221: #line 512 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1238:  return 1;",
      "1239: }",
      "1241: yy95:",
      "1242:  yych = *++YYCURSOR;",
      "1243:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1240: #line 1241 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1244: #line 1245 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1260:  if (yych <= '9') goto yy97;",
      "1261:  if (yych != ';') goto yy18;",
      "1262:  ++YYCURSOR;",
      "1264:  {",
      "1265:  long id;",
      "",
      "[Removed Lines]",
      "1263: #line 488 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1267: #line 491 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1282:  return 1;",
      "1283: }",
      "1285: }",
      "1289:  return 0;",
      "",
      "[Removed Lines]",
      "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
      "1286: #line 837 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1288: #line 1289 \"ext/standard/var_unserializer.c\"",
      "1290: #line 840 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "347:   } else {",
      "349:    convert_to_string(key);",
      "350:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
      "351:      sizeof data, NULL);",
      "352:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "350:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
      "351:     var_push_dtor(var_hash, old_data);",
      "352:    }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d76b293ac71aa5bd4e9a433192afef6e0dd5a4ee",
      "candidate_info": {
        "commit_hash": "d76b293ac71aa5bd4e9a433192afef6e0dd5a4ee",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/d76b293ac71aa5bd4e9a433192afef6e0dd5a4ee",
        "files": [
          "ext/standard/var_unserializer.c"
        ],
        "message": "forgot to commit this one",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "392:    return 0;",
          "393:   }",
          "395:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "396:    (*p)--;",
          "397:    return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "395:   var_push_dtor(var_hash, data);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "522:  start = cursor;",
          "526: {",
          "527:  YYCTYPE yych;",
          "528:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "525: #line 526 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "527: #line 528 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "582:  yych = *(YYMARKER = ++YYCURSOR);",
          "583:  if (yych == ':') goto yy95;",
          "584: yy3:",
          "586:  { return 0; }",
          "588: yy4:",
          "589:  yych = *(YYMARKER = ++YYCURSOR);",
          "590:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "585: #line 873 \"ext/standard/var_unserializer.re\"",
          "587: #line 588 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "587: #line 875 \"ext/standard/var_unserializer.re\"",
          "589: #line 590 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "627:  goto yy3;",
          "628: yy14:",
          "629:  ++YYCURSOR;",
          "631:  {",
          "633:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "635: }",
          "637: yy16:",
          "638:  yych = *++YYCURSOR;",
          "639:  goto yy3;",
          "",
          "[Removed Lines]",
          "630: #line 867 \"ext/standard/var_unserializer.re\"",
          "636: #line 637 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "632: #line 869 \"ext/standard/var_unserializer.re\"",
          "638: #line 639 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "659:  if (yybm[0+yych] & 128) {",
          "660:   goto yy20;",
          "661:  }",
          "663:  yych = *++YYCURSOR;",
          "664:  if (yych != '\"') goto yy18;",
          "665:  ++YYCURSOR;",
          "667:  {",
          "668:  size_t len, len2, len3, maxlen;",
          "669:  zend_long elements;",
          "",
          "[Removed Lines]",
          "662:  if (yych != ':') goto yy18;",
          "666: #line 722 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "664:  if (yych <= '/') goto yy18;",
          "665:  if (yych >= ';') goto yy18;",
          "669: #line 724 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "809:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "810: }",
          "812: yy25:",
          "813:  yych = *++YYCURSOR;",
          "814:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "811: #line 812 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "814: #line 815 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "833:  yych = *++YYCURSOR;",
          "834:  if (yych != '\"') goto yy18;",
          "835:  ++YYCURSOR;",
          "837:  {",
          "",
          "[Removed Lines]",
          "836: #line 714 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "839: #line 716 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "841:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "842:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "843: }",
          "845: yy32:",
          "846:  yych = *++YYCURSOR;",
          "847:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "844: #line 845 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "847: #line 848 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "862:  yych = *++YYCURSOR;",
          "863:  if (yych != '{') goto yy18;",
          "864:  ++YYCURSOR;",
          "866:  {",
          "867:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "865: #line 693 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "868: #line 695 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "884:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "885: }",
          "887: yy39:",
          "888:  yych = *++YYCURSOR;",
          "889:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "886: #line 887 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "889: #line 890 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "904:  yych = *++YYCURSOR;",
          "905:  if (yych != '\"') goto yy18;",
          "906:  ++YYCURSOR;",
          "908:  {",
          "909:  size_t len, maxlen;",
          "910:  zend_string *str;",
          "",
          "[Removed Lines]",
          "907: #line 665 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "910: #line 667 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "932:  ZVAL_STR(rval, str);",
          "933:  return 1;",
          "934: }",
          "936: yy46:",
          "937:  yych = *++YYCURSOR;",
          "938:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "935: #line 936 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "938: #line 939 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "953:  yych = *++YYCURSOR;",
          "954:  if (yych != '\"') goto yy18;",
          "955:  ++YYCURSOR;",
          "957:  {",
          "958:  size_t len, maxlen;",
          "959:  char *str;",
          "",
          "[Removed Lines]",
          "956: #line 638 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "959: #line 640 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "980:  ZVAL_STRINGL(rval, str, len);",
          "981:  return 1;",
          "982: }",
          "984: yy53:",
          "985:  yych = *++YYCURSOR;",
          "986:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "983: #line 984 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "986: #line 987 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1068:  }",
          "1069: yy63:",
          "1070:  ++YYCURSOR;",
          "1072:  {",
          "1073: #if SIZEOF_ZEND_LONG == 4",
          "1074: use_double:",
          "",
          "[Removed Lines]",
          "1071: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1074: #line 631 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1077:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1078:  return 1;",
          "1079: }",
          "1081: yy65:",
          "1082:  yych = *++YYCURSOR;",
          "1083:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1080: #line 1081 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1083: #line 1084 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1136:  yych = *++YYCURSOR;",
          "1137:  if (yych != ';') goto yy18;",
          "1138:  ++YYCURSOR;",
          "1140:  {",
          "",
          "[Removed Lines]",
          "1139: #line 613 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1142: #line 615 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1153:  return 1;",
          "1154: }",
          "1156: yy76:",
          "1157:  yych = *++YYCURSOR;",
          "1158:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1155: #line 1156 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1158: #line 1159 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1179:  if (yych <= '9') goto yy79;",
          "1180:  if (yych != ';') goto yy18;",
          "1181:  ++YYCURSOR;",
          "1183:  {",
          "1184: #if SIZEOF_ZEND_LONG == 4",
          "1185:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1182: #line 587 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1185: #line 589 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1205:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1206:  return 1;",
          "1207: }",
          "1209: yy83:",
          "1210:  yych = *++YYCURSOR;",
          "1211:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1208: #line 1209 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1213:  yych = *++YYCURSOR;",
          "1214:  if (yych != ';') goto yy18;",
          "1215:  ++YYCURSOR;",
          "1217:  {",
          "1219:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1220:  return 1;",
          "1221: }",
          "1223: yy87:",
          "1224:  ++YYCURSOR;",
          "1226:  {",
          "1228:  ZVAL_NULL(rval);",
          "1229:  return 1;",
          "1230: }",
          "1232: yy89:",
          "1233:  yych = *++YYCURSOR;",
          "1234:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1216: #line 581 \"ext/standard/var_unserializer.re\"",
          "1222: #line 1223 \"ext/standard/var_unserializer.c\"",
          "1225: #line 575 \"ext/standard/var_unserializer.re\"",
          "1231: #line 1232 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1219: #line 583 \"ext/standard/var_unserializer.re\"",
          "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
          "1228: #line 577 \"ext/standard/var_unserializer.re\"",
          "1234: #line 1235 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1251:  if (yych <= '9') goto yy91;",
          "1252:  if (yych != ';') goto yy18;",
          "1253:  ++YYCURSOR;",
          "1255:  {",
          "1256:  zend_long id;",
          "",
          "[Removed Lines]",
          "1254: #line 552 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1257: #line 554 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1275:  return 1;",
          "1276: }",
          "1278: yy95:",
          "1279:  yych = *++YYCURSOR;",
          "1280:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1280: #line 1281 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1297:  if (yych <= '9') goto yy97;",
          "1298:  if (yych != ';') goto yy18;",
          "1299:  ++YYCURSOR;",
          "1301:  {",
          "1302:  zend_long id;",
          "",
          "[Removed Lines]",
          "1300: #line 530 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1303: #line 532 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1320:  return 1;",
          "1321: }",
          "1323: }",
          "1327:  return 0;",
          "",
          "[Removed Lines]",
          "1322: #line 1323 \"ext/standard/var_unserializer.c\"",
          "1324: #line 875 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1325: #line 1326 \"ext/standard/var_unserializer.c\"",
          "1327: #line 877 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "681a1afd3f76e97b243184e83ab826633e851cc3",
      "candidate_info": {
        "commit_hash": "681a1afd3f76e97b243184e83ab826633e851cc3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/681a1afd3f76e97b243184e83ab826633e851cc3",
        "files": [
          "ext/standard/tests/serialize/bug68594.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-5.5' into PHP-5.6\n\n* PHP-5.5:\n  update news\n  add CVE\n  add missing test file\n  Fix bug #68594 - Use after free vulnerability in unserialize()\n\nConflicts:\n\text/standard/var_unserializer.c",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt": [
          "File: ext/standard/tests/serialize/bug68594.phpt -> ext/standard/tests/serialize/bug68594.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68545 Use after free vulnerability in unserialize()",
          "3: --FILE--",
          "4: <?php",
          "5: for ($i=4; $i<100; $i++) {",
          "6:  $m = new StdClass();",
          "8:  $u = array(1);",
          "10:  $m->aaa = array(1,2,&$u,4,5);",
          "11:  $m->bbb = 1;",
          "12:  $m->ccc = &$u;",
          "13:  $m->ddd = str_repeat(\"A\", $i);",
          "15:  $z = serialize($m);",
          "16:  $z = str_replace(\"bbb\", \"aaa\", $z);",
          "17:  $y = unserialize($z);",
          "18:  $z = serialize($y);",
          "19: }",
          "20: ?>",
          "21: ===DONE===",
          "22: --EXPECTF--",
          "23: ===DONE===",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "342:   } else {",
          "344:    convert_to_string(key);",
          "345:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "346:      sizeof data, NULL);",
          "347:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "345:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "346:     var_push_dtor(var_hash, old_data);",
          "347:    }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "479: {",
          "480:  YYCTYPE yych;",
          "481:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "478: #line 479 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "481: #line 482 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "535:  yych = *(YYMARKER = ++YYCURSOR);",
          "536:  if (yych == ':') goto yy95;",
          "537: yy3:",
          "539:  { return 0; }",
          "541: yy4:",
          "542:  yych = *(YYMARKER = ++YYCURSOR);",
          "543:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "538: #line 830 \"ext/standard/var_unserializer.re\"",
          "540: #line 541 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "541: #line 833 \"ext/standard/var_unserializer.re\"",
          "543: #line 544 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "580:  goto yy3;",
          "581: yy14:",
          "582:  ++YYCURSOR;",
          "584:  {",
          "586:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "588: }",
          "590: yy16:",
          "591:  yych = *++YYCURSOR;",
          "592:  goto yy3;",
          "",
          "[Removed Lines]",
          "583: #line 824 \"ext/standard/var_unserializer.re\"",
          "589: #line 590 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "586: #line 827 \"ext/standard/var_unserializer.re\"",
          "592: #line 593 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "612:  if (yybm[0+yych] & 128) {",
          "613:   goto yy20;",
          "614:  }",
          "616:  yych = *++YYCURSOR;",
          "617:  if (yych != '\"') goto yy18;",
          "618:  ++YYCURSOR;",
          "620:  {",
          "621:  size_t len, len2, len3, maxlen;",
          "622:  long elements;",
          "",
          "[Removed Lines]",
          "615:  if (yych != ':') goto yy18;",
          "619: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "618:  if (yych <= '/') goto yy18;",
          "619:  if (yych >= ';') goto yy18;",
          "623: #line 681 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "763:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "764: }",
          "766: yy25:",
          "767:  yych = *++YYCURSOR;",
          "768:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "765: #line 766 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "769: #line 770 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "787:  yych = *++YYCURSOR;",
          "788:  if (yych != '\"') goto yy18;",
          "789:  ++YYCURSOR;",
          "791:  {",
          "793:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "790: #line 670 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "794: #line 673 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "795:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "796:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "797: }",
          "799: yy32:",
          "800:  yych = *++YYCURSOR;",
          "801:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "798: #line 799 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "802: #line 803 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "816:  yych = *++YYCURSOR;",
          "817:  if (yych != '{') goto yy18;",
          "818:  ++YYCURSOR;",
          "820:  {",
          "821:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "819: #line 650 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "823: #line 653 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "837:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "838: }",
          "840: yy39:",
          "841:  yych = *++YYCURSOR;",
          "842:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "839: #line 840 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "843: #line 844 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "857:  yych = *++YYCURSOR;",
          "858:  if (yych != '\"') goto yy18;",
          "859:  ++YYCURSOR;",
          "861:  {",
          "862:  size_t len, maxlen;",
          "863:  char *str;",
          "",
          "[Removed Lines]",
          "860: #line 621 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "864: #line 624 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "886:  ZVAL_STRINGL(*rval, str, len, 0);",
          "887:  return 1;",
          "888: }",
          "890: yy46:",
          "891:  yych = *++YYCURSOR;",
          "892:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "889: #line 890 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "907:  yych = *++YYCURSOR;",
          "908:  if (yych != '\"') goto yy18;",
          "909:  ++YYCURSOR;",
          "911:  {",
          "912:  size_t len, maxlen;",
          "913:  char *str;",
          "",
          "[Removed Lines]",
          "910: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "914: #line 596 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "935:  ZVAL_STRINGL(*rval, str, len, 1);",
          "936:  return 1;",
          "937: }",
          "939: yy53:",
          "940:  yych = *++YYCURSOR;",
          "941:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "938: #line 939 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1023:  }",
          "1024: yy63:",
          "1025:  ++YYCURSOR;",
          "1027:  {",
          "1028: #if SIZEOF_LONG == 4",
          "1029: use_double:",
          "",
          "[Removed Lines]",
          "1026: #line 583 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1030: #line 586 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1033:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1034:  return 1;",
          "1035: }",
          "1037: yy65:",
          "1038:  yych = *++YYCURSOR;",
          "1039:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1036: #line 1037 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1040: #line 1041 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1092:  yych = *++YYCURSOR;",
          "1093:  if (yych != ';') goto yy18;",
          "1094:  ++YYCURSOR;",
          "1096:  {",
          "1098:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1095: #line 568 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1099: #line 571 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1108:  return 1;",
          "1109: }",
          "1111: yy76:",
          "1112:  yych = *++YYCURSOR;",
          "1113:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1110: #line 1111 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1114: #line 1115 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1134:  if (yych <= '9') goto yy79;",
          "1135:  if (yych != ';') goto yy18;",
          "1136:  ++YYCURSOR;",
          "1138:  {",
          "1139: #if SIZEOF_LONG == 4",
          "1140:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1137: #line 541 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1141: #line 544 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1161:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1162:  return 1;",
          "1163: }",
          "1165: yy83:",
          "1166:  yych = *++YYCURSOR;",
          "1167:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1164: #line 1165 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1168: #line 1169 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1169:  yych = *++YYCURSOR;",
          "1170:  if (yych != ';') goto yy18;",
          "1171:  ++YYCURSOR;",
          "1173:  {",
          "1175:  INIT_PZVAL(*rval);",
          "1176:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1177:  return 1;",
          "1178: }",
          "1180: yy87:",
          "1181:  ++YYCURSOR;",
          "1183:  {",
          "1185:  INIT_PZVAL(*rval);",
          "1186:  ZVAL_NULL(*rval);",
          "1187:  return 1;",
          "1188: }",
          "1190: yy89:",
          "1191:  yych = *++YYCURSOR;",
          "1192:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1172: #line 534 \"ext/standard/var_unserializer.re\"",
          "1179: #line 1180 \"ext/standard/var_unserializer.c\"",
          "1182: #line 527 \"ext/standard/var_unserializer.re\"",
          "1189: #line 1190 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1176: #line 537 \"ext/standard/var_unserializer.re\"",
          "1183: #line 1184 \"ext/standard/var_unserializer.c\"",
          "1186: #line 530 \"ext/standard/var_unserializer.re\"",
          "1193: #line 1194 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1209:  if (yych <= '9') goto yy91;",
          "1210:  if (yych != ';') goto yy18;",
          "1211:  ++YYCURSOR;",
          "1213:  {",
          "1214:  long id;",
          "",
          "[Removed Lines]",
          "1212: #line 504 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1216: #line 507 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1233:  return 1;",
          "1234: }",
          "1236: yy95:",
          "1237:  yych = *++YYCURSOR;",
          "1238:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1235: #line 1236 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1239: #line 1240 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1255:  if (yych <= '9') goto yy97;",
          "1256:  if (yych != ';') goto yy18;",
          "1257:  ++YYCURSOR;",
          "1259:  {",
          "1260:  long id;",
          "",
          "[Removed Lines]",
          "1258: #line 483 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1262: #line 486 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1277:  return 1;",
          "1278: }",
          "1280: }",
          "1284:  return 0;",
          "",
          "[Removed Lines]",
          "1279: #line 1280 \"ext/standard/var_unserializer.c\"",
          "1281: #line 832 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "1285: #line 835 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "346:   } else {",
          "348:    convert_to_string(key);",
          "349:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "350:      sizeof data, NULL);",
          "351:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "349:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "350:     var_push_dtor(var_hash, old_data);",
          "351:    }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9d7c5dbed941c4d4c18d7d5ed308a07897b7596d",
      "candidate_info": {
        "commit_hash": "9d7c5dbed941c4d4c18d7d5ed308a07897b7596d",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/9d7c5dbed941c4d4c18d7d5ed308a07897b7596d",
        "files": [
          "ext/standard/php_var.h",
          "ext/standard/tests/serialize/serialization_error_001.phpt",
          "ext/standard/tests/serialize/unserialize_classes.phpt",
          "ext/standard/var.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "secured unserialize\n\n- update for BC-compatible unserialize\n- add tests",
        "before_after_code_files": [
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/tests/serialize/serialization_error_001.phpt||ext/standard/tests/serialize/serialization_error_001.phpt",
          "ext/standard/tests/serialize/unserialize_classes.phpt||ext/standard/tests/serialize/unserialize_classes.phpt",
          "ext/standard/var.c||ext/standard/var.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "57: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "58: PHPAPI int php_var_unserialize_ref(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "59: PHPAPI int php_var_unserialize_intern(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC);",
          "61: #define PHP_VAR_SERIALIZE_INIT(d) \\",
          "62: do  { \\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: PHPAPI int php_var_unserialize_ex(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes TSRMLS_DC);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/serialization_error_001.phpt||ext/standard/tests/serialize/serialization_error_001.phpt": [
          "File: ext/standard/tests/serialize/serialization_error_001.phpt -> ext/standard/tests/serialize/serialization_error_001.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: var_dump( serialize(1,2) );",
          "26: echo \"Done\";",
          "27: ?>",
          "",
          "[Removed Lines]",
          "24: var_dump( unserialize(1,2) );",
          "",
          "[Added Lines]",
          "24: var_dump( unserialize(1,2,3) );",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "31: Warning: serialize() expects exactly 1 parameter, 0 given in %s on line 16",
          "32: NULL",
          "35: bool(false)",
          "37: Warning: serialize() expects exactly 1 parameter, 2 given in %s on line 20",
          "38: NULL",
          "41: bool(false)",
          "42: Done",
          "",
          "[Removed Lines]",
          "34: Warning: unserialize() expects exactly 1 parameter, 0 given in %s on line 17",
          "40: Warning: unserialize() expects exactly 1 parameter, 2 given in %s on line 21",
          "",
          "[Added Lines]",
          "34: Warning: unserialize() expects at least 1 parameter, 0 given in %s on line 17",
          "40: Warning: unserialize() expects at most 2 parameters, 3 given in %s on line 21",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/unserialize_classes.phpt||ext/standard/tests/serialize/unserialize_classes.phpt": [
          "File: ext/standard/tests/serialize/unserialize_classes.phpt -> ext/standard/tests/serialize/unserialize_classes.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Test unserialize() with second parameter",
          "3: --FILE--",
          "4: <?php",
          "5: class foo {",
          "6:         public $x = \"bar\";",
          "7: }",
          "8: $z = array(new foo(), 2, \"3\");",
          "9: $s = serialize($z);",
          "11: var_dump(unserialize($s));",
          "12: var_dump(unserialize($s, [\"allowed_classes\" => false]));",
          "13: var_dump(unserialize($s, [\"allowed_classes\" => true]));",
          "14: var_dump(unserialize($s, [\"allowed_classes\" => [\"bar\"]]));",
          "15: var_dump(unserialize($s, [\"allowed_classes\" => [\"FOO\"]]));",
          "16: var_dump(unserialize($s, [\"allowed_classes\" => [\"bar\", \"foO\"]]));",
          "18: --EXPECTF--",
          "19: array(3) {",
          "20:   [0]=>",
          "21:   object(foo)#%d (1) {",
          "22:     [\"x\"]=>",
          "23:     string(3) \"bar\"",
          "24:   }",
          "25:   [1]=>",
          "26:   int(2)",
          "27:   [2]=>",
          "28:   string(1) \"3\"",
          "29: }",
          "30: array(3) {",
          "31:   [0]=>",
          "32:   object(__PHP_Incomplete_Class)#%d (2) {",
          "33:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "34:     string(3) \"foo\"",
          "35:     [\"x\"]=>",
          "36:     string(3) \"bar\"",
          "37:   }",
          "38:   [1]=>",
          "39:   int(2)",
          "40:   [2]=>",
          "41:   string(1) \"3\"",
          "42: }",
          "43: array(3) {",
          "44:   [0]=>",
          "45:   object(foo)#%d (1) {",
          "46:     [\"x\"]=>",
          "47:     string(3) \"bar\"",
          "48:   }",
          "49:   [1]=>",
          "50:   int(2)",
          "51:   [2]=>",
          "52:   string(1) \"3\"",
          "53: }",
          "54: array(3) {",
          "55:   [0]=>",
          "56:   object(__PHP_Incomplete_Class)#%d (2) {",
          "57:     [\"__PHP_Incomplete_Class_Name\"]=>",
          "58:     string(3) \"foo\"",
          "59:     [\"x\"]=>",
          "60:     string(3) \"bar\"",
          "61:   }",
          "62:   [1]=>",
          "63:   int(2)",
          "64:   [2]=>",
          "65:   string(1) \"3\"",
          "66: }",
          "67: array(3) {",
          "68:   [0]=>",
          "69:   object(foo)#%d (1) {",
          "70:     [\"x\"]=>",
          "71:     string(3) \"bar\"",
          "72:   }",
          "73:   [1]=>",
          "74:   int(2)",
          "75:   [2]=>",
          "76:   string(1) \"3\"",
          "77: }",
          "78: array(3) {",
          "79:   [0]=>",
          "80:   object(foo)#%d (1) {",
          "81:     [\"x\"]=>",
          "82:     string(3) \"bar\"",
          "83:   }",
          "84:   [1]=>",
          "85:   int(2)",
          "86:   [2]=>",
          "87:   string(1) \"3\"",
          "88: }",
          "",
          "---------------"
        ],
        "ext/standard/var.c||ext/standard/var.c": [
          "File: ext/standard/var.c -> ext/standard/var.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "998:  size_t buf_len;",
          "999:  const unsigned char *p;",
          "1000:  php_unserialize_data_t var_hash;",
          "1003:   RETURN_FALSE;",
          "1004:  }",
          "",
          "[Removed Lines]",
          "1002:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"s\", &buf, &buf_len) == FAILURE) {",
          "",
          "[Added Lines]",
          "1001:  zval *options = NULL, *classes = NULL;",
          "1002:  HashTable *class_hash = NULL;",
          "1004:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"s|a\", &buf, &buf_len, &options) == FAILURE) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1010:  p = (const unsigned char*) buf;",
          "1011:  PHP_VAR_UNSERIALIZE_INIT(var_hash);",
          "1013:   PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1014:   zval_dtor(return_value);",
          "1015:   if (!EG(exception)) {",
          "1016:    php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Error at offset \" ZEND_LONG_FMT \" of %d bytes\", (zend_long)((char*)p - buf), buf_len);",
          "",
          "[Removed Lines]",
          "1012:  if (!php_var_unserialize(return_value, &p, p + buf_len, &var_hash TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "1014:  if(options != NULL) {",
          "1015:   classes = zend_hash_str_find(Z_ARRVAL_P(options), \"allowed_classes\", sizeof(\"allowed_classes\")-1);",
          "1016:   if(classes && (Z_TYPE_P(classes) == IS_ARRAY || !zend_is_true(classes TSRMLS_CC))) {",
          "1017:    ALLOC_HASHTABLE(class_hash);",
          "1018:    zend_hash_init(class_hash, (Z_TYPE_P(classes) == IS_ARRAY)?zend_hash_num_elements(Z_ARRVAL_P(classes)):0, NULL, NULL, 0);",
          "1019:   }",
          "1020:   if(class_hash && Z_TYPE_P(classes) == IS_ARRAY) {",
          "1021:    zval *entry;",
          "1022:    zend_string *lcname;",
          "1024:    ZEND_HASH_FOREACH_VAL(Z_ARRVAL_P(classes), entry) {",
          "1025:     convert_to_string_ex(entry);",
          "1026:     lcname = zend_string_alloc(Z_STRLEN_P(entry), 0);",
          "1027:     zend_str_tolower_copy(lcname->val, Z_STRVAL_P(entry), Z_STRLEN_P(entry));",
          "1028:     zend_hash_add_empty_element(class_hash, lcname);",
          "1029:           zend_string_release(lcname);",
          "1030:    } ZEND_HASH_FOREACH_END();",
          "1031:   }",
          "1032:  }",
          "1034:  if (!php_var_unserialize_ex(return_value, &p, p + buf_len, &var_hash, class_hash TSRMLS_CC)) {",
          "1036:   if(class_hash) {",
          "1037:    zend_hash_destroy(class_hash);",
          "1038:    FREE_HASHTABLE(class_hash);",
          "1039:   }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1018:   RETURN_FALSE;",
          "1019:  }",
          "1020:  PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1021: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1047:  if(class_hash) {",
          "1048:   zend_hash_destroy(class_hash);",
          "1049:   FREE_HASHTABLE(class_hash);",
          "1050:  }",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "226:  return str;",
          "227: }",
          "229: #define YYFILL(n) do { } while (0)",
          "230: #define YYCTYPE unsigned char",
          "231: #define YYCURSOR cursor",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "229: static inline int unserialize_allowed_class(zend_string *class_name, HashTable *classes)",
          "230: {",
          "231:  zend_string *lcname;",
          "232:  int res;",
          "233:  ALLOCA_FLAG(use_heap)",
          "235:  if(classes == NULL) {",
          "236:   return 1;",
          "237:  }",
          "238:  if(!zend_hash_num_elements(classes)) {",
          "239:   return 0;",
          "240:  }",
          "242:  STR_ALLOCA_ALLOC(lcname, class_name->len, use_heap);",
          "243:  zend_str_tolower_copy(lcname->val, class_name->val, class_name->len);",
          "244:  res = zend_hash_exists(classes, lcname);",
          "245:  STR_ALLOCA_FREE(lcname, use_heap);",
          "246:  return res;",
          "247: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "233: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "236: #line 241 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "256: #line 261 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "293:  return result;",
          "294: }",
          "299: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "300: {",
          "",
          "[Removed Lines]",
          "296: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC",
          "297: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash TSRMLS_CC",
          "",
          "[Added Lines]",
          "316: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes TSRMLS_DC",
          "317: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes TSRMLS_CC",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "302:   zval key, *data, d, *old_data;",
          "304:   ZVAL_UNDEF(&key);",
          "306:    zval_dtor(&key);",
          "307:    return 0;",
          "308:   }",
          "",
          "[Removed Lines]",
          "305:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "326:   if (!php_var_unserialize_ex(&key, p, max, NULL, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "355:   zval_dtor(&key);",
          "358:    return 0;",
          "359:   }",
          "",
          "[Removed Lines]",
          "357:   if (!php_var_unserialize(data, p, max, var_hash TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "378:   if (!php_var_unserialize_ex(data, p, max, var_hash, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "462: # pragma optimize(\"\", on)",
          "463: #endif",
          "466: {",
          "467:  const unsigned char *cursor, *limit, *marker, *start;",
          "468:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "465: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "486: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC)",
          "487: {",
          "488:  HashTable *classes = NULL;",
          "489:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "490: }",
          "493: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "481:  start = cursor;",
          "485: {",
          "486:  YYCTYPE yych;",
          "487:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "484: #line 485 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "512: #line 513 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "541:  yych = *(YYMARKER = ++YYCURSOR);",
          "542:  if (yych == ':') goto yy95;",
          "543: yy3:",
          "545:  { return 0; }",
          "547: yy4:",
          "548:  yych = *(YYMARKER = ++YYCURSOR);",
          "549:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "544: #line 826 \"ext/standard/var_unserializer.re\"",
          "546: #line 547 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "572: #line 860 \"ext/standard/var_unserializer.re\"",
          "574: #line 575 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "586:  goto yy3;",
          "587: yy14:",
          "588:  ++YYCURSOR;",
          "590:  {",
          "592:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "594: }",
          "596: yy16:",
          "597:  yych = *++YYCURSOR;",
          "598:  goto yy3;",
          "",
          "[Removed Lines]",
          "589: #line 820 \"ext/standard/var_unserializer.re\"",
          "595: #line 596 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "617: #line 854 \"ext/standard/var_unserializer.re\"",
          "623: #line 624 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "618:  if (yybm[0+yych] & 128) {",
          "619:   goto yy20;",
          "620:  }",
          "622:  yych = *++YYCURSOR;",
          "623:  if (yych != '\"') goto yy18;",
          "624:  ++YYCURSOR;",
          "626:  {",
          "627:  size_t len, len2, len3, maxlen;",
          "628:  zend_long elements;",
          "",
          "[Removed Lines]",
          "621:  if (yych != ':') goto yy18;",
          "625: #line 681 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "649:  if (yych <= '/') goto yy18;",
          "650:  if (yych >= ';') goto yy18;",
          "654: #line 709 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "672:  class_name = zend_string_init(str, len, 0);",
          "674:  do {",
          "676:   BG(serialize_lock)++;",
          "677:   ce = zend_lookup_class(class_name TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "704:   if(!unserialize_allowed_class(class_name, classes)) {",
          "705:    incomplete_class = 1;",
          "706:    ce = PHP_IC_ENTRY;",
          "707:    break;",
          "708:   }",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "762:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "763: }",
          "765: yy25:",
          "766:  yych = *++YYCURSOR;",
          "767:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "764: #line 765 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "799: #line 800 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "786:  yych = *++YYCURSOR;",
          "787:  if (yych != '\"') goto yy18;",
          "788:  ++YYCURSOR;",
          "790:  {",
          "",
          "[Removed Lines]",
          "789: #line 673 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "824: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "794:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "795:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "796: }",
          "798: yy32:",
          "799:  yych = *++YYCURSOR;",
          "800:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "797: #line 798 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "832: #line 833 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "815:  yych = *++YYCURSOR;",
          "816:  if (yych != '{') goto yy18;",
          "817:  ++YYCURSOR;",
          "819:  {",
          "820:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "818: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "853: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "837:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "838: }",
          "840: yy39:",
          "841:  yych = *++YYCURSOR;",
          "842:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "839: #line 840 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "874: #line 875 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "857:  yych = *++YYCURSOR;",
          "858:  if (yych != '\"') goto yy18;",
          "859:  ++YYCURSOR;",
          "861:  {",
          "862:  size_t len, maxlen;",
          "863:  zend_string *str;",
          "",
          "[Removed Lines]",
          "860: #line 624 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "895: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "885:  ZVAL_STR(rval, str);",
          "886:  return 1;",
          "887: }",
          "889: yy46:",
          "890:  yych = *++YYCURSOR;",
          "891:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "888: #line 889 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "923: #line 924 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "906:  yych = *++YYCURSOR;",
          "907:  if (yych != '\"') goto yy18;",
          "908:  ++YYCURSOR;",
          "910:  {",
          "911:  size_t len, maxlen;",
          "912:  char *str;",
          "",
          "[Removed Lines]",
          "909: #line 597 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "944: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "933:  ZVAL_STRINGL(rval, str, len);",
          "934:  return 1;",
          "935: }",
          "937: yy53:",
          "938:  yych = *++YYCURSOR;",
          "939:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "936: #line 937 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "971: #line 972 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1021:  }",
          "1022: yy63:",
          "1023:  ++YYCURSOR;",
          "1025:  {",
          "1026: #if SIZEOF_ZEND_LONG == 4",
          "1027: use_double:",
          "",
          "[Removed Lines]",
          "1024: #line 588 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1059: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1030:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1031:  return 1;",
          "1032: }",
          "1034: yy65:",
          "1035:  yych = *++YYCURSOR;",
          "1036:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1033: #line 1034 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1089:  yych = *++YYCURSOR;",
          "1090:  if (yych != ';') goto yy18;",
          "1091:  ++YYCURSOR;",
          "1093:  {",
          "",
          "[Removed Lines]",
          "1092: #line 572 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1127: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1106:  return 1;",
          "1107: }",
          "1109: yy76:",
          "1110:  yych = *++YYCURSOR;",
          "1111:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1108: #line 1109 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1143: #line 1144 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1132:  if (yych <= '9') goto yy79;",
          "1133:  if (yych != ';') goto yy18;",
          "1134:  ++YYCURSOR;",
          "1136:  {",
          "1137: #if SIZEOF_ZEND_LONG == 4",
          "1138:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1135: #line 546 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1170: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1158:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1159:  return 1;",
          "1160: }",
          "1162: yy83:",
          "1163:  yych = *++YYCURSOR;",
          "1164:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "1166:  yych = *++YYCURSOR;",
          "1167:  if (yych != ';') goto yy18;",
          "1168:  ++YYCURSOR;",
          "1170:  {",
          "1172:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1173:  return 1;",
          "1174: }",
          "1176: yy87:",
          "1177:  ++YYCURSOR;",
          "1179:  {",
          "1181:  ZVAL_NULL(rval);",
          "1182:  return 1;",
          "1183: }",
          "1185: yy89:",
          "1186:  yych = *++YYCURSOR;",
          "1187:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1169: #line 540 \"ext/standard/var_unserializer.re\"",
          "1175: #line 1176 \"ext/standard/var_unserializer.c\"",
          "1178: #line 534 \"ext/standard/var_unserializer.re\"",
          "1184: #line 1185 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1204: #line 568 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "1213: #line 562 \"ext/standard/var_unserializer.re\"",
          "1219: #line 1220 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "1204:  if (yych <= '9') goto yy91;",
          "1205:  if (yych != ';') goto yy18;",
          "1206:  ++YYCURSOR;",
          "1208:  {",
          "1209:  zend_long id;",
          "",
          "[Removed Lines]",
          "1207: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1242: #line 539 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "1228:  return 1;",
          "1229: }",
          "1231: yy95:",
          "1232:  yych = *++YYCURSOR;",
          "1233:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1230: #line 1231 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1265: #line 1266 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "1250:  if (yych <= '9') goto yy97;",
          "1251:  if (yych != ';') goto yy18;",
          "1252:  ++YYCURSOR;",
          "1254:  {",
          "1255:  zend_long id;",
          "",
          "[Removed Lines]",
          "1253: #line 489 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1288: #line 517 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "1273:  return 1;",
          "1274: }",
          "1276: }",
          "1280:  return 0;",
          "",
          "[Removed Lines]",
          "1275: #line 1276 \"ext/standard/var_unserializer.c\"",
          "1277: #line 828 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1312: #line 862 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "224:  return str;",
          "225: }",
          "227: #define YYFILL(n) do { } while (0)",
          "228: #define YYCTYPE unsigned char",
          "229: #define YYCURSOR cursor",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "227: static inline int unserialize_allowed_class(zend_string *class_name, HashTable *classes)",
          "228: {",
          "229:  zend_string *lcname;",
          "230:  int res;",
          "231:  ALLOCA_FLAG(use_heap)",
          "233:  if(classes == NULL) {",
          "234:   return 1;",
          "235:  }",
          "236:  if(!zend_hash_num_elements(classes)) {",
          "237:   return 0;",
          "238:  }",
          "240:  STR_ALLOCA_ALLOC(lcname, class_name->len, use_heap);",
          "241:  zend_str_tolower_copy(lcname->val, class_name->val, class_name->len);",
          "242:  res = zend_hash_exists(classes, lcname);",
          "243:  STR_ALLOCA_FREE(lcname, use_heap);",
          "244:  return res;",
          "245: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "297:  return result;",
          "298: }",
          "303: static inline int process_nested_data(UNSERIALIZE_PARAMETER, HashTable *ht, zend_long elements, int objprops)",
          "304: {",
          "",
          "[Removed Lines]",
          "300: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC",
          "301: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash TSRMLS_CC",
          "",
          "[Added Lines]",
          "320: #define UNSERIALIZE_PARAMETER zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash, HashTable *classes TSRMLS_DC",
          "321: #define UNSERIALIZE_PASSTHRU rval, p, max, var_hash, classes TSRMLS_CC",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "306:   zval key, *data, d, *old_data;",
          "308:   ZVAL_UNDEF(&key);",
          "310:    zval_dtor(&key);",
          "311:    return 0;",
          "312:   }",
          "",
          "[Removed Lines]",
          "309:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "330:   if (!php_var_unserialize_ex(&key, p, max, NULL, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "359:   zval_dtor(&key);",
          "362:    return 0;",
          "363:   }",
          "",
          "[Removed Lines]",
          "361:   if (!php_var_unserialize(data, p, max, var_hash TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "382:   if (!php_var_unserialize_ex(data, p, max, var_hash, classes TSRMLS_CC)) {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "466: # pragma optimize(\"\", on)",
          "467: #endif",
          "470: {",
          "471:  const unsigned char *cursor, *limit, *marker, *start;",
          "472:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "469: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "490: PHPAPI int php_var_unserialize(zval *rval, const unsigned char **p, const unsigned char *max, php_unserialize_data_t *var_hash TSRMLS_DC)",
          "491: {",
          "492:  HashTable *classes = NULL;",
          "493:  return php_var_unserialize_ex(UNSERIALIZE_PASSTHRU);",
          "494: }",
          "497: PHPAPI int php_var_unserialize_ex(UNSERIALIZE_PARAMETER)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "727:  class_name = zend_string_init(str, len, 0);",
          "729:  do {",
          "731:   BG(serialize_lock)++;",
          "732:   ce = zend_lookup_class(class_name TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "758:   if(!unserialize_allowed_class(class_name, classes)) {",
          "759:    incomplete_class = 1;",
          "760:    ce = PHP_IC_ENTRY;",
          "761:    break;",
          "762:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "feeb2fba93a451c467ec70963995ca6371b3a568",
      "candidate_info": {
        "commit_hash": "feeb2fba93a451c467ec70963995ca6371b3a568",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/feeb2fba93a451c467ec70963995ca6371b3a568",
        "files": [
          "Zend/zend_exceptions.c",
          "ext/date/tests/bug53437_var5.phpt",
          "ext/spl/spl_array.c",
          "ext/spl/spl_dllist.c",
          "ext/spl/spl_observer.c",
          "ext/standard/php_var.h",
          "ext/standard/tests/serialize/bug69793.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "fix merge",
        "before_after_code_files": [
          "Zend/zend_exceptions.c||Zend/zend_exceptions.c",
          "ext/date/tests/bug53437_var5.phpt||ext/date/tests/bug53437_var5.phpt",
          "ext/spl/spl_array.c||ext/spl/spl_array.c",
          "ext/spl/spl_dllist.c||ext/spl/spl_dllist.c",
          "ext/spl/spl_observer.c||ext/spl/spl_observer.c",
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/tests/serialize/bug69793.phpt||ext/standard/tests/serialize/bug69793.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/zend_exceptions.c||Zend/zend_exceptions.c": [
          "File: Zend/zend_exceptions.c -> Zend/zend_exceptions.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "284: #define CHECK_EXC_TYPE(name, type) \\",
          "287:   zval tmp; \\",
          "288:   ZVAL_STRINGL(&tmp, name, sizeof(name) - 1); \\",
          "289:   Z_OBJ_HANDLER_P(object, unset_property)(object, &tmp, NULL); \\",
          "",
          "[Removed Lines]",
          "285:  if(zend_read_property(i_get_exception_base(object), (object), name, sizeof(name) - 1, 1, &value) != &EG(uninitialized_zval) \\",
          "286:   && Z_TYPE(value) != type) { \\",
          "",
          "[Added Lines]",
          "285:  ZVAL_UNDEF(&value); \\",
          "286:  pvalue = zend_read_property(i_get_exception_base(object), (object), name, sizeof(name) - 1, 1, &value); \\",
          "287:  if(Z_TYPE_P(pvalue) != IS_UNDEF && Z_TYPE_P(pvalue) != type) { \\",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "293: ZEND_METHOD(exception, __wakeup)",
          "294: {",
          "296:  zval *object = getThis();",
          "297:  CHECK_EXC_TYPE(\"message\", IS_STRING);",
          "298:  CHECK_EXC_TYPE(\"string\", IS_STRING);",
          "",
          "[Removed Lines]",
          "295:  zval value;",
          "",
          "[Added Lines]",
          "296:  zval value, *pvalue;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "711:  exception = getThis();",
          "712:  ZVAL_STRINGL(&fname, \"gettraceasstring\", sizeof(\"gettraceasstring\")-1);",
          "715:   zend_string *prev_str = str;",
          "716:   zend_string *message = zval_get_string(GET_PROPERTY(exception, \"message\"));",
          "717:   zend_string *file = zval_get_string(GET_PROPERTY(exception, \"file\"));",
          "",
          "[Removed Lines]",
          "714:  while (exception && Z_TYPE_P(exception) == IS_OBJECT) {",
          "",
          "[Added Lines]",
          "715:  while (exception && Z_TYPE_P(exception) == IS_OBJECT && instanceof_function(Z_OBJCE_P(exception), zend_ce_throwable)) {",
          "",
          "---------------"
        ],
        "ext/date/tests/bug53437_var5.phpt||ext/date/tests/bug53437_var5.phpt": [
          "File: ext/date/tests/bug53437_var5.phpt -> ext/date/tests/bug53437_var5.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "14: --EXPECTF--",
          "15: object(DateInterval)#%d (15) {",
          "16:   [\"y\"]=>",
          "18:   [\"m\"]=>",
          "20:   [\"d\"]=>",
          "22:   [\"h\"]=>",
          "24:   [\"i\"]=>",
          "26:   [\"s\"]=>",
          "28:   [\"weekday\"]=>",
          "29:   int(10)",
          "30:   [\"weekday_behavior\"]=>",
          "",
          "[Removed Lines]",
          "17:   int(-1)",
          "19:   int(-1)",
          "21:   int(-1)",
          "23:   int(-1)",
          "25:   int(-1)",
          "27:   int(-1)",
          "",
          "[Added Lines]",
          "17:   int(2)",
          "19:   int(0)",
          "21:   int(0)",
          "23:   int(6)",
          "25:   int(8)",
          "27:   int(0)",
          "",
          "---------------"
        ],
        "ext/spl/spl_array.c||ext/spl/spl_array.c": [
          "File: ext/spl/spl_array.c -> ext/spl/spl_array.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1710:  size_t buf_len;",
          "1711:  const unsigned char *p, *s;",
          "1712:  php_unserialize_data_t var_hash;",
          "1714:  HashTable *aht;",
          "1715:  zend_long flags;",
          "",
          "[Removed Lines]",
          "1713:  zval members, zflags;",
          "",
          "[Added Lines]",
          "1713:  zval *members, *zflags;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1737:  }",
          "1738:  ++p;",
          "1741:   goto outexcept;",
          "1742:  }",
          "",
          "[Removed Lines]",
          "1740:  if (!php_var_unserialize(&zflags, &p, s + buf_len, &var_hash) || Z_TYPE(zflags) != IS_LONG) {",
          "1744:  var_push_dtor(&var_hash, &zflags);",
          "1746:  flags = Z_LVAL(zflags);",
          "",
          "[Added Lines]",
          "1740:  zflags = var_tmp_var(&var_hash);",
          "1741:  if (!php_var_unserialize(zflags, &p, s + buf_len, &var_hash) || Z_TYPE_P(zflags) != IS_LONG) {",
          "1746:  flags = Z_LVAL_P(zflags);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1777:  }",
          "1778:  ++p;",
          "1783:   goto outexcept;",
          "1784:  }",
          "1793:  PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1794:  return;",
          "",
          "[Removed Lines]",
          "1780:  ZVAL_UNDEF(&members);",
          "1781:  if (!php_var_unserialize(&members, &p, s + buf_len, &var_hash) || Z_TYPE(members) != IS_ARRAY) {",
          "1782:   zval_ptr_dtor(&members);",
          "1786:  var_push_dtor(&var_hash, &members);",
          "1788:  object_properties_load(&intern->std, Z_ARRVAL(members));",
          "1789:  zval_ptr_dtor(&members);",
          "",
          "[Added Lines]",
          "1780:  members = var_tmp_var(&var_hash);",
          "1781:  if (!php_var_unserialize(members, &p, s + buf_len, &var_hash) || Z_TYPE_P(members) != IS_ARRAY) {",
          "1786:  object_properties_load(&intern->std, Z_ARRVAL_P(members));",
          "",
          "---------------"
        ],
        "ext/spl/spl_dllist.c||ext/spl/spl_dllist.c": [
          "File: ext/spl/spl_dllist.c -> ext/spl/spl_dllist.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1178: SPL_METHOD(SplDoublyLinkedList, unserialize)",
          "1179: {",
          "1180:  spl_dllist_object *intern = Z_SPLDLLIST_P(getThis());",
          "1182:  char *buf;",
          "1183:  size_t buf_len;",
          "1184:  const unsigned char *p, *s;",
          "",
          "[Removed Lines]",
          "1181:  zval flags, elem;",
          "",
          "[Added Lines]",
          "1181:  zval *flags, *elem;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1196:  PHP_VAR_UNSERIALIZE_INIT(var_hash);",
          "1200:   goto error;",
          "1201:  }",
          "1212:  while(*p == ':') {",
          "1213:   ++p;",
          "1215:    goto error;",
          "1216:   }",
          "1220:  }",
          "1222:  if (*p != '\\0') {",
          "",
          "[Removed Lines]",
          "1199:  if (!php_var_unserialize(&flags, &p, s + buf_len, &var_hash)) {",
          "1203:  if (Z_TYPE(flags) != IS_LONG) {",
          "1204:   zval_ptr_dtor(&flags);",
          "1205:   goto error;",
          "1206:  }",
          "1208:  intern->flags = (int)Z_LVAL(flags);",
          "1209:  zval_ptr_dtor(&flags);",
          "1214:   if (!php_var_unserialize(&elem, &p, s + buf_len, &var_hash)) {",
          "1218:   spl_ptr_llist_push(intern->llist, &elem);",
          "1219:   zval_ptr_dtor(&elem);",
          "",
          "[Added Lines]",
          "1199:  flags = var_tmp_var(&var_hash);",
          "1200:  if (!php_var_unserialize(flags, &p, s + buf_len, &var_hash) || Z_TYPE_P(flags) != IS_LONG) {",
          "1204:  intern->flags = (int)Z_LVAL_P(flags);",
          "1209:   elem = var_tmp_var(&var_hash);",
          "1210:   if (!php_var_unserialize(elem, &p, s + buf_len, &var_hash)) {",
          "1214:   spl_ptr_llist_push(intern->llist, elem);",
          "",
          "---------------"
        ],
        "ext/spl/spl_observer.c||ext/spl/spl_observer.c": [
          "File: ext/spl/spl_observer.c -> ext/spl/spl_observer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "780:  size_t buf_len;",
          "781:  const unsigned char *p, *s;",
          "782:  php_unserialize_data_t var_hash;",
          "784:  spl_SplObjectStorageElement *element;",
          "785:  zend_long count;",
          "",
          "[Removed Lines]",
          "783:  zval entry, pmembers, pcount, inf;",
          "",
          "[Added Lines]",
          "783:  zval entry, inf;",
          "784:  zval *pcount, *pmembers;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "801:  }",
          "802:  ++p;",
          "809:   goto outexcept;",
          "810:  }",
          "816:  while (count-- > 0) {",
          "817:   spl_SplObjectStorageElement *pelement;",
          "",
          "[Removed Lines]",
          "804:  if (!php_var_unserialize(&pcount, &p, s + buf_len, &var_hash)) {",
          "805:   goto outexcept;",
          "806:  }",
          "807:  if (Z_TYPE(pcount) != IS_LONG) {",
          "808:   zval_ptr_dtor(&pcount);",
          "812:  var_push_dtor(&var_hash, &pcount);",
          "814:  count = Z_LVAL(pcount);",
          "",
          "[Added Lines]",
          "805:  pcount = var_tmp_var(&var_hash);",
          "806:  if (!php_var_unserialize(pcount, &p, s + buf_len, &var_hash) || Z_TYPE_P(pcount) != IS_LONG) {",
          "811:  count = Z_LVAL_P(pcount);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "838:     zval_ptr_dtor(&entry);",
          "839:     goto outexcept;",
          "840:    }",
          "841:   }",
          "843:   hash = spl_object_storage_get_hash(intern, getThis(), &entry);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "838:   } else {",
          "839:    ZVAL_UNDEF(&inf);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "856:     var_push_dtor(&var_hash, &pelement->obj);",
          "857:    }",
          "858:   }",
          "860:   var_replace(&var_hash, &entry, &element->obj);",
          "861:   var_replace(&var_hash, &inf, &element->inf);",
          "862:   zval_ptr_dtor(&entry);",
          "",
          "[Removed Lines]",
          "859:   element = spl_object_storage_attach(intern, getThis(), &entry, &inf);",
          "",
          "[Added Lines]",
          "858:   element = spl_object_storage_attach(intern, getThis(), &entry, Z_ISUNDEF(inf)?NULL:&inf);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "874:  }",
          "875:  ++p;",
          "880:   goto outexcept;",
          "881:  }",
          "885:  if (!intern->std.properties) {",
          "886:   rebuild_object_properties(&intern->std);",
          "887:  }",
          "891:  PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "892:  return;",
          "",
          "[Removed Lines]",
          "877:  ZVAL_UNDEF(&pmembers);",
          "878:  if (!php_var_unserialize(&pmembers, &p, s + buf_len, &var_hash) || Z_TYPE(pmembers) != IS_ARRAY) {",
          "879:   zval_ptr_dtor(&pmembers);",
          "883:  var_push_dtor(&var_hash, &pmembers);",
          "888:  zend_hash_copy(intern->std.properties, Z_ARRVAL(pmembers), (copy_ctor_func_t) zval_add_ref);",
          "889:  zval_ptr_dtor(&pmembers);",
          "",
          "[Added Lines]",
          "876:  pmembers = var_tmp_var(&var_hash);",
          "877:  if (!php_var_unserialize(pmembers, &p, s + buf_len, &var_hash) || Z_TYPE_P(pmembers) != IS_ARRAY) {",
          "885:  zend_hash_copy(intern->std.properties, Z_ARRVAL_P(pmembers), (copy_ctor_func_t) zval_add_ref);",
          "",
          "---------------"
        ],
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "118: PHPAPI void var_replace(php_unserialize_data_t *var_hash, zval *ozval, zval *nzval);",
          "119: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hash, zval *val);",
          "121: PHPAPI void var_destroy(php_unserialize_data_t *var_hash);",
          "",
          "[Removed Lines]",
          "120: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval);",
          "",
          "[Added Lines]",
          "120: PHPAPI zval *var_tmp_var(php_unserialize_data_t *var_hashx);",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug69793.phpt||ext/standard/tests/serialize/bug69793.phpt": [
          "File: ext/standard/tests/serialize/bug69793.phpt -> ext/standard/tests/serialize/bug69793.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "12: Notice: Undefined property: Exception::$file in %s/bug69793.php on line %d",
          "14: Notice: Undefined property: Exception::$previous in %s/bug69793.php on line %d",
          "16: Stack trace:",
          "17: #0 {main}\"",
          "",
          "[Removed Lines]",
          "15: string(53) \"exception 'Exception' in :1337",
          "",
          "[Added Lines]",
          "15: string(41) \"Exception in :1337",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "67: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "68: {",
          "96: }",
          "",
          "[Removed Lines]",
          "69:  var_dtor_entries *var_hash;",
          "71:  if (!var_hashx || !*var_hashx) {",
          "72:   return;",
          "73:  }",
          "75:  var_hash = (*var_hashx)->last_dtor;",
          "76: #if VAR_ENTRIES_DBG",
          "77:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "78: #endif",
          "80:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "81:   var_hash = emalloc(sizeof(var_dtor_entries));",
          "82:   var_hash->used_slots = 0;",
          "83:   var_hash->next = 0;",
          "85:   if (!(*var_hashx)->first_dtor) {",
          "86:    (*var_hashx)->first_dtor = var_hash;",
          "87:   } else {",
          "88:    ((var_dtor_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "89:   }",
          "91:   (*var_hashx)->last_dtor = var_hash;",
          "92:  }",
          "94:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "95:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "69:  zval *tmp_var = var_tmp_var(var_hashx);",
          "70:     if (!tmp_var) {",
          "71:         return;",
          "72:     }",
          "73:  ZVAL_COPY(tmp_var, rval);",
          "74: }",
          "76: PHPAPI zval *var_tmp_var(php_unserialize_data_t *var_hashx)",
          "77: {",
          "78:     var_dtor_entries *var_hash;",
          "80:     if (!var_hashx || !*var_hashx) {",
          "81:         return NULL;",
          "82:     }",
          "84:     var_hash = (*var_hashx)->last_dtor;",
          "85:     if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "86:         var_hash = emalloc(sizeof(var_dtor_entries));",
          "87:         var_hash->used_slots = 0;",
          "88:         var_hash->next = 0;",
          "90:         if (!(*var_hashx)->first_dtor) {",
          "91:             (*var_hashx)->first_dtor = var_hash;",
          "92:         } else {",
          "93:             ((var_dtor_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "94:         }",
          "96:         (*var_hashx)->last_dtor = var_hash;",
          "97:     }",
          "98:     ZVAL_UNDEF(&var_hash->data[var_hash->used_slots]);",
          "99:     return &var_hash->data[var_hash->used_slots++];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "259: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "262: #line 267 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "266: #line 271 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "524:  start = cursor;",
          "528: {",
          "529:  YYCTYPE yych;",
          "530:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "527: #line 528 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "531: #line 532 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "584:  yych = *(YYMARKER = ++YYCURSOR);",
          "585:  if (yych == ':') goto yy95;",
          "586: yy3:",
          "588:  { return 0; }",
          "590: yy4:",
          "591:  yych = *(YYMARKER = ++YYCURSOR);",
          "592:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "587: #line 875 \"ext/standard/var_unserializer.re\"",
          "589: #line 590 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "591: #line 879 \"ext/standard/var_unserializer.re\"",
          "593: #line 594 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "629:  goto yy3;",
          "630: yy14:",
          "631:  ++YYCURSOR;",
          "633:  {",
          "635:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "637: }",
          "639: yy16:",
          "640:  yych = *++YYCURSOR;",
          "641:  goto yy3;",
          "",
          "[Removed Lines]",
          "632: #line 869 \"ext/standard/var_unserializer.re\"",
          "638: #line 639 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "636: #line 873 \"ext/standard/var_unserializer.re\"",
          "642: #line 643 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "661:  if (yybm[0+yych] & 128) {",
          "662:   goto yy20;",
          "663:  }",
          "665:  yych = *++YYCURSOR;",
          "666:  if (yych != '\"') goto yy18;",
          "667:  ++YYCURSOR;",
          "669:  {",
          "670:  size_t len, len2, len3, maxlen;",
          "671:  zend_long elements;",
          "",
          "[Removed Lines]",
          "664:  if (yych != ':') goto yy18;",
          "668: #line 724 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "668:  if (yych <= '/') goto yy18;",
          "669:  if (yych >= ';') goto yy18;",
          "673: #line 728 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "811:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "812: }",
          "814: yy25:",
          "815:  yych = *++YYCURSOR;",
          "816:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "813: #line 814 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "818: #line 819 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "835:  yych = *++YYCURSOR;",
          "836:  if (yych != '\"') goto yy18;",
          "837:  ++YYCURSOR;",
          "839:  {",
          "",
          "[Removed Lines]",
          "838: #line 716 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "843: #line 720 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "843:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "844:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "845: }",
          "847: yy32:",
          "848:  yych = *++YYCURSOR;",
          "849:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "846: #line 847 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "851: #line 852 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "864:  yych = *++YYCURSOR;",
          "865:  if (yych != '{') goto yy18;",
          "866:  ++YYCURSOR;",
          "868:  {",
          "869:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "867: #line 695 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "872: #line 699 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "886:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "887: }",
          "889: yy39:",
          "890:  yych = *++YYCURSOR;",
          "891:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "888: #line 889 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "906:  yych = *++YYCURSOR;",
          "907:  if (yych != '\"') goto yy18;",
          "908:  ++YYCURSOR;",
          "910:  {",
          "911:  size_t len, maxlen;",
          "912:  zend_string *str;",
          "",
          "[Removed Lines]",
          "909: #line 667 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "914: #line 671 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "934:  ZVAL_STR(rval, str);",
          "935:  return 1;",
          "936: }",
          "938: yy46:",
          "939:  yych = *++YYCURSOR;",
          "940:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "937: #line 938 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "955:  yych = *++YYCURSOR;",
          "956:  if (yych != '\"') goto yy18;",
          "957:  ++YYCURSOR;",
          "959:  {",
          "960:  size_t len, maxlen;",
          "961:  char *str;",
          "",
          "[Removed Lines]",
          "958: #line 640 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "963: #line 644 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "982:  ZVAL_STRINGL(rval, str, len);",
          "983:  return 1;",
          "984: }",
          "986: yy53:",
          "987:  yych = *++YYCURSOR;",
          "988:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "985: #line 986 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "990: #line 991 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1070:  }",
          "1071: yy63:",
          "1072:  ++YYCURSOR;",
          "1074:  {",
          "1075: #if SIZEOF_ZEND_LONG == 4",
          "1076: use_double:",
          "",
          "[Removed Lines]",
          "1073: #line 631 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1078: #line 635 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1079:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1080:  return 1;",
          "1081: }",
          "1083: yy65:",
          "1084:  yych = *++YYCURSOR;",
          "1085:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1082: #line 1083 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1087: #line 1088 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1138:  yych = *++YYCURSOR;",
          "1139:  if (yych != ';') goto yy18;",
          "1140:  ++YYCURSOR;",
          "1142:  {",
          "",
          "[Removed Lines]",
          "1141: #line 615 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1146: #line 619 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1155:  return 1;",
          "1156: }",
          "1158: yy76:",
          "1159:  yych = *++YYCURSOR;",
          "1160:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1157: #line 1158 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1162: #line 1163 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1181:  if (yych <= '9') goto yy79;",
          "1182:  if (yych != ';') goto yy18;",
          "1183:  ++YYCURSOR;",
          "1185:  {",
          "1186: #if SIZEOF_ZEND_LONG == 4",
          "1187:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1184: #line 589 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1189: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1207:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1208:  return 1;",
          "1209: }",
          "1211: yy83:",
          "1212:  yych = *++YYCURSOR;",
          "1213:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1215: #line 1216 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1215:  yych = *++YYCURSOR;",
          "1216:  if (yych != ';') goto yy18;",
          "1217:  ++YYCURSOR;",
          "1219:  {",
          "1221:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1222:  return 1;",
          "1223: }",
          "1225: yy87:",
          "1226:  ++YYCURSOR;",
          "1228:  {",
          "1230:  ZVAL_NULL(rval);",
          "1231:  return 1;",
          "1232: }",
          "1234: yy89:",
          "1235:  yych = *++YYCURSOR;",
          "1236:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1218: #line 583 \"ext/standard/var_unserializer.re\"",
          "1224: #line 1225 \"ext/standard/var_unserializer.c\"",
          "1227: #line 577 \"ext/standard/var_unserializer.re\"",
          "1233: #line 1234 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1223: #line 587 \"ext/standard/var_unserializer.re\"",
          "1229: #line 1230 \"ext/standard/var_unserializer.c\"",
          "1232: #line 581 \"ext/standard/var_unserializer.re\"",
          "1238: #line 1239 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1253:  if (yych <= '9') goto yy91;",
          "1254:  if (yych != ';') goto yy18;",
          "1255:  ++YYCURSOR;",
          "1257:  {",
          "1258:  zend_long id;",
          "",
          "[Removed Lines]",
          "1256: #line 554 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1261: #line 558 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1277:  return 1;",
          "1278: }",
          "1280: yy95:",
          "1281:  yych = *++YYCURSOR;",
          "1282:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1279: #line 1280 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1299:  if (yych <= '9') goto yy97;",
          "1300:  if (yych != ';') goto yy18;",
          "1301:  ++YYCURSOR;",
          "1303:  {",
          "1304:  zend_long id;",
          "",
          "[Removed Lines]",
          "1302: #line 532 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1307: #line 536 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "1322:  return 1;",
          "1323: }",
          "1325: }",
          "1329:  return 0;",
          "",
          "[Removed Lines]",
          "1324: #line 1325 \"ext/standard/var_unserializer.c\"",
          "1326: #line 877 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1329: #line 1330 \"ext/standard/var_unserializer.c\"",
          "1331: #line 881 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "65: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "66: {",
          "94: }",
          "",
          "[Removed Lines]",
          "67:  var_dtor_entries *var_hash;",
          "69:  if (!var_hashx || !*var_hashx) {",
          "70:   return;",
          "71:  }",
          "73:  var_hash = (*var_hashx)->last_dtor;",
          "74: #if VAR_ENTRIES_DBG",
          "75:  fprintf(stderr, \"var_push_dtor(%ld): %d\\n\", var_hash?var_hash->used_slots:-1L, Z_TYPE_PP(rval));",
          "76: #endif",
          "78:  if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "79:   var_hash = emalloc(sizeof(var_dtor_entries));",
          "80:   var_hash->used_slots = 0;",
          "81:   var_hash->next = 0;",
          "83:   if (!(*var_hashx)->first_dtor) {",
          "84:    (*var_hashx)->first_dtor = var_hash;",
          "85:   } else {",
          "86:    ((var_dtor_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "87:   }",
          "89:   (*var_hashx)->last_dtor = var_hash;",
          "90:  }",
          "92:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "93:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "67:  zval *tmp_var = var_tmp_var(var_hashx);",
          "68:     if (!tmp_var) {",
          "69:         return;",
          "70:     }",
          "71:  ZVAL_COPY(tmp_var, rval);",
          "72: }",
          "74: PHPAPI zval *var_tmp_var(php_unserialize_data_t *var_hashx)",
          "75: {",
          "76:     var_dtor_entries *var_hash;",
          "78:     if (!var_hashx || !*var_hashx) {",
          "79:         return NULL;",
          "80:     }",
          "82:     var_hash = (*var_hashx)->last_dtor;",
          "83:     if (!var_hash || var_hash->used_slots == VAR_ENTRIES_MAX) {",
          "84:         var_hash = emalloc(sizeof(var_dtor_entries));",
          "85:         var_hash->used_slots = 0;",
          "86:         var_hash->next = 0;",
          "88:         if (!(*var_hashx)->first_dtor) {",
          "89:             (*var_hashx)->first_dtor = var_hash;",
          "90:         } else {",
          "91:             ((var_dtor_entries *) (*var_hashx)->last_dtor)->next = var_hash;",
          "92:         }",
          "94:         (*var_hashx)->last_dtor = var_hash;",
          "95:     }",
          "96:     ZVAL_UNDEF(&var_hash->data[var_hash->used_slots]);",
          "97:     return &var_hash->data[var_hash->used_slots++];",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "672a396d4a961a10f7483727973777e444ff7022",
      "candidate_info": {
        "commit_hash": "672a396d4a961a10f7483727973777e444ff7022",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/672a396d4a961a10f7483727973777e444ff7022",
        "files": [
          "ext/standard/tests/serialize/bug69139.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-5.5' into PHP-5.6\n\nConflicts:\n\text/standard/var_unserializer.c",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug69139.phpt||ext/standard/tests/serialize/bug69139.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug69139.phpt||ext/standard/tests/serialize/bug69139.phpt": [
          "File: ext/standard/tests/serialize/bug69139.phpt -> ext/standard/tests/serialize/bug69139.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #69139 (Crash in gc_zval_possible_root on unserialize)",
          "3: --FILE--",
          "4: <?php",
          "5: $str = 'a:1126666:{i:0;r:1;i:-09610;r:1;i:-0;i:0;i:0;O:1:\"A\":2119X:i:0;i:0;i:0;i:0;i:0;O:1:\"A\":2116:{i:0;r:5;i:-096766610;r:1;i:-610;r:1;i:0;i:0;';",
          "6: @unserialize($str);",
          "7: echo \"Alive\";",
          "8: ?>",
          "9: --EXPECT--",
          "10: Alive",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "319:   if (!php_var_unserialize(&data, p, max, var_hash TSRMLS_CC)) {",
          "320:    zval_dtor(key);",
          "321:    FREE_ZVAL(key);",
          "324:    return 0;",
          "325:   }",
          "",
          "[Removed Lines]",
          "322:    zval_dtor(data);",
          "323:    FREE_ZVAL(data);",
          "",
          "[Added Lines]",
          "322:    zval_ptr_dtor(&data);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "482: {",
          "483:  YYCTYPE yych;",
          "484:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "481: #line 482 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "480: #line 481 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "538:  yych = *(YYMARKER = ++YYCURSOR);",
          "539:  if (yych == ':') goto yy95;",
          "540: yy3:",
          "542:  { return 0; }",
          "544: yy4:",
          "545:  yych = *(YYMARKER = ++YYCURSOR);",
          "546:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "541: #line 833 \"ext/standard/var_unserializer.re\"",
          "543: #line 544 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "540: #line 832 \"ext/standard/var_unserializer.re\"",
          "542: #line 543 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "583:  goto yy3;",
          "584: yy14:",
          "585:  ++YYCURSOR;",
          "587:  {",
          "589:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "591: }",
          "593: yy16:",
          "594:  yych = *++YYCURSOR;",
          "595:  goto yy3;",
          "",
          "[Removed Lines]",
          "586: #line 827 \"ext/standard/var_unserializer.re\"",
          "592: #line 593 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "585: #line 826 \"ext/standard/var_unserializer.re\"",
          "591: #line 592 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "615:  if (yybm[0+yych] & 128) {",
          "616:   goto yy20;",
          "617:  }",
          "620:  yych = *++YYCURSOR;",
          "621:  if (yych != '\"') goto yy18;",
          "622:  ++YYCURSOR;",
          "624:  {",
          "625:  size_t len, len2, len3, maxlen;",
          "626:  long elements;",
          "",
          "[Removed Lines]",
          "618:  if (yych <= '/') goto yy18;",
          "619:  if (yych >= ';') goto yy18;",
          "623: #line 681 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "617:  if (yych != ':') goto yy18;",
          "621: #line 680 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "767:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "768: }",
          "770: yy25:",
          "771:  yych = *++YYCURSOR;",
          "772:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "769: #line 770 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "767: #line 768 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "791:  yych = *++YYCURSOR;",
          "792:  if (yych != '\"') goto yy18;",
          "793:  ++YYCURSOR;",
          "795:  {",
          "797:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "794: #line 673 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "792: #line 672 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "799:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "800:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "801: }",
          "803: yy32:",
          "804:  yych = *++YYCURSOR;",
          "805:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "802: #line 803 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "800: #line 801 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "820:  yych = *++YYCURSOR;",
          "821:  if (yych != '{') goto yy18;",
          "822:  ++YYCURSOR;",
          "824:  {",
          "825:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "823: #line 653 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "821: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "841:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "842: }",
          "844: yy39:",
          "845:  yych = *++YYCURSOR;",
          "846:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "843: #line 844 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "841: #line 842 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "861:  yych = *++YYCURSOR;",
          "862:  if (yych != '\"') goto yy18;",
          "863:  ++YYCURSOR;",
          "865:  {",
          "866:  size_t len, maxlen;",
          "867:  char *str;",
          "",
          "[Removed Lines]",
          "864: #line 624 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "862: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "890:  ZVAL_STRINGL(*rval, str, len, 0);",
          "891:  return 1;",
          "892: }",
          "894: yy46:",
          "895:  yych = *++YYCURSOR;",
          "896:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "893: #line 894 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "891: #line 892 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "911:  yych = *++YYCURSOR;",
          "912:  if (yych != '\"') goto yy18;",
          "913:  ++YYCURSOR;",
          "915:  {",
          "916:  size_t len, maxlen;",
          "917:  char *str;",
          "",
          "[Removed Lines]",
          "914: #line 596 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "912: #line 595 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "939:  ZVAL_STRINGL(*rval, str, len, 1);",
          "940:  return 1;",
          "941: }",
          "943: yy53:",
          "944:  yych = *++YYCURSOR;",
          "945:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "942: #line 943 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "940: #line 941 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1027:  }",
          "1028: yy63:",
          "1029:  ++YYCURSOR;",
          "1031:  {",
          "1032: #if SIZEOF_LONG == 4",
          "1033: use_double:",
          "",
          "[Removed Lines]",
          "1030: #line 586 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1028: #line 585 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1037:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1038:  return 1;",
          "1039: }",
          "1041: yy65:",
          "1042:  yych = *++YYCURSOR;",
          "1043:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1040: #line 1041 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1038: #line 1039 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1096:  yych = *++YYCURSOR;",
          "1097:  if (yych != ';') goto yy18;",
          "1098:  ++YYCURSOR;",
          "1100:  {",
          "1102:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1099: #line 571 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1097: #line 570 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1112:  return 1;",
          "1113: }",
          "1115: yy76:",
          "1116:  yych = *++YYCURSOR;",
          "1117:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1114: #line 1115 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1112: #line 1113 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1138:  if (yych <= '9') goto yy79;",
          "1139:  if (yych != ';') goto yy18;",
          "1140:  ++YYCURSOR;",
          "1142:  {",
          "1143: #if SIZEOF_LONG == 4",
          "1144:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1141: #line 544 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1139: #line 543 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1165:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1166:  return 1;",
          "1167: }",
          "1169: yy83:",
          "1170:  yych = *++YYCURSOR;",
          "1171:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1168: #line 1169 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1166: #line 1167 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1173:  yych = *++YYCURSOR;",
          "1174:  if (yych != ';') goto yy18;",
          "1175:  ++YYCURSOR;",
          "1177:  {",
          "1179:  INIT_PZVAL(*rval);",
          "1180:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1181:  return 1;",
          "1182: }",
          "1184: yy87:",
          "1185:  ++YYCURSOR;",
          "1187:  {",
          "1189:  INIT_PZVAL(*rval);",
          "1190:  ZVAL_NULL(*rval);",
          "1191:  return 1;",
          "1192: }",
          "1194: yy89:",
          "1195:  yych = *++YYCURSOR;",
          "1196:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1176: #line 537 \"ext/standard/var_unserializer.re\"",
          "1183: #line 1184 \"ext/standard/var_unserializer.c\"",
          "1186: #line 530 \"ext/standard/var_unserializer.re\"",
          "1193: #line 1194 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1174: #line 536 \"ext/standard/var_unserializer.re\"",
          "1181: #line 1182 \"ext/standard/var_unserializer.c\"",
          "1184: #line 529 \"ext/standard/var_unserializer.re\"",
          "1191: #line 1192 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1213:  if (yych <= '9') goto yy91;",
          "1214:  if (yych != ';') goto yy18;",
          "1215:  ++YYCURSOR;",
          "1217:  {",
          "1218:  long id;",
          "",
          "[Removed Lines]",
          "1216: #line 507 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1214: #line 506 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1237:  return 1;",
          "1238: }",
          "1240: yy95:",
          "1241:  yych = *++YYCURSOR;",
          "1242:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1239: #line 1240 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1237: #line 1238 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1259:  if (yych <= '9') goto yy97;",
          "1260:  if (yych != ';') goto yy18;",
          "1261:  ++YYCURSOR;",
          "1263:  {",
          "1264:  long id;",
          "",
          "[Removed Lines]",
          "1262: #line 486 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1260: #line 485 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1281:  return 1;",
          "1282: }",
          "1284: }",
          "1288:  return 0;",
          "",
          "[Removed Lines]",
          "1283: #line 1284 \"ext/standard/var_unserializer.c\"",
          "1285: #line 835 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1281: #line 1282 \"ext/standard/var_unserializer.c\"",
          "1283: #line 834 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "323:   if (!php_var_unserialize(&data, p, max, var_hash TSRMLS_CC)) {",
          "324:    zval_dtor(key);",
          "325:    FREE_ZVAL(key);",
          "328:    return 0;",
          "329:   }",
          "",
          "[Removed Lines]",
          "326:    zval_dtor(data);",
          "327:    FREE_ZVAL(data);",
          "",
          "[Added Lines]",
          "326:    zval_ptr_dtor(&data);",
          "",
          "---------------"
        ]
      }
    }
  ]
}