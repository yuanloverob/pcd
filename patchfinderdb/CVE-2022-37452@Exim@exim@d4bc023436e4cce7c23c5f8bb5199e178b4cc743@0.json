{
  "cve_id": "CVE-2022-37452",
  "cve_desc": "Exim before 4.95 has a heap-based buffer overflow for the alias list in host_name_lookup in host.c when sender_host_name is set.",
  "repo": "Exim/exim",
  "patch_hash": "d4bc023436e4cce7c23c5f8bb5199e178b4cc743",
  "patch_info": {
    "commit_hash": "d4bc023436e4cce7c23c5f8bb5199e178b4cc743",
    "repo": "Exim/exim",
    "commit_url": "https://github.com/Exim/exim/commit/d4bc023436e4cce7c23c5f8bb5199e178b4cc743",
    "files": [
      "src/src/host.c"
    ],
    "message": "Fix host_name_lookup (Close 2747)\n\nThanks to Nico R for providing a reproducing configuration.\n\n        host_lookup             = *\n        message_size_limit      = ${if def:sender_host_name {32M}{32M}}\n        acl_smtp_connect        = acl_smtp_connect\n        acl_smtp_rcpt           = acl_smtp_rcpt\n\n        begin acl\n          acl_smtp_connect:\n                warn ratelimit = 256 / 1m / per_conn\n                accept\n\n          acl_smtp_rcpt:\n                accept hosts = 127.0.0.*\n\n        begin routers\n        null:\n          driver          = accept\n          transport       = null\n\n        begin transports\n        null:\n          driver          = appendfile\n          file            = /dev/null\n\nTested with\n\n        swaks -f mailbox@example.org -t mailbox@example.org --pipe 'exim -bh 127.0.0.1 -C /opt/exim/etc/exim-bug.conf'\n\nThe IP must have a PTR to \"localhost.\" to reproduce it.\n\n(cherry picked from commit 20812729e3e47a193a21d326ecd036d67a8b2724)",
    "before_after_code_files": [
      "src/src/host.c||src/src/host.c"
    ]
  },
  "patch_diff": {
    "src/src/host.c||src/src/host.c": [
      "File: src/src/host.c -> src/src/host.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1583:   if (hosts->h_aliases)",
      "1584:     {",
      "1586:     uschar **ptr;",
      "1588:     for (uschar ** aliases = USS hosts->h_aliases; *aliases; aliases++) count++;",
      "",
      "[Removed Lines]",
      "1585:     int count = 1;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1691:       {",
      "1692:       uschar **aptr = NULL;",
      "1693:       int ssize = 264;",
      "1695:       int old_pool = store_pool;",
      "1697:       sender_host_dnssec = dns_is_secure(dnsa);",
      "",
      "[Removed Lines]",
      "1694:       int count = 0;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "20812729e3e47a193a21d326ecd036d67a8b2724",
      "candidate_info": {
        "commit_hash": "20812729e3e47a193a21d326ecd036d67a8b2724",
        "repo": "Exim/exim",
        "commit_url": "https://github.com/Exim/exim/commit/20812729e3e47a193a21d326ecd036d67a8b2724",
        "files": [
          "src/src/host.c"
        ],
        "message": "Fix host_name_lookup (Close 2747)\n\nThanks to Nico R for providing a reproducing configuration.\n\n        host_lookup             = *\n        message_size_limit      = ${if def:sender_host_name {32M}{32M}}\n        acl_smtp_connect        = acl_smtp_connect\n        acl_smtp_rcpt           = acl_smtp_rcpt\n\n        begin acl\n          acl_smtp_connect:\n                warn ratelimit = 256 / 1m / per_conn\n                accept\n\n          acl_smtp_rcpt:\n                accept hosts = 127.0.0.*\n\n        begin routers\n        null:\n          driver          = accept\n          transport       = null\n\n        begin transports\n        null:\n          driver          = appendfile\n          file            = /dev/null\n\nTested with\n\n        swaks -f mailbox@example.org -t mailbox@example.org --pipe 'exim -bh 127.0.0.1 -C /opt/exim/etc/exim-bug.conf'\n\nThe IP must have a PTR to \"localhost.\" to reproduce it.",
        "before_after_code_files": [
          "src/src/host.c||src/src/host.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/src/host.c||src/src/host.c"
          ],
          "candidate": [
            "src/src/host.c||src/src/host.c"
          ]
        }
      },
      "candidate_diff": {
        "src/src/host.c||src/src/host.c": [
          "File: src/src/host.c -> src/src/host.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1582:   if (hosts->h_aliases)",
          "1583:     {",
          "1585:     uschar **ptr;",
          "1587:     for (uschar ** aliases = USS hosts->h_aliases; *aliases; aliases++) count++;",
          "",
          "[Removed Lines]",
          "1584:     int count = 1;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1690:       {",
          "1691:       uschar **aptr = NULL;",
          "1692:       int ssize = 264;",
          "1694:       int old_pool = store_pool;",
          "1696:       sender_host_dnssec = dns_is_secure(dnsa);",
          "",
          "[Removed Lines]",
          "1693:       int count = 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}