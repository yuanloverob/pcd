{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "cc5cea35b0e25352ff40780532d4c5a6bba00359",
      "candidate_info": {
        "commit_hash": "cc5cea35b0e25352ff40780532d4c5a6bba00359",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/cc5cea35b0e25352ff40780532d4c5a6bba00359",
        "files": [
          "deps/uv/src/unix/internal.h"
        ],
        "message": "uv: upgrade to 803f5a0",
        "before_after_code_files": [
          "deps/uv/src/unix/internal.h||deps/uv/src/unix/internal.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "deps/uv/src/unix/internal.h||deps/uv/src/unix/internal.h": [
          "File: deps/uv/src/unix/internal.h -> deps/uv/src/unix/internal.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "59: #  define HAVE_SYS_ACCEPT4 1",
          "60: # endif",
          "62: # if HAVE_SYS_UTIMESAT",
          "63: inline static int sys_utimesat(int dirfd,",
          "64:                                const char* path,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: # endif",
          "62: # ifndef O_CLOEXEC",
          "63: #  define O_CLOEXEC 02000000",
          "64: # endif",
          "66: # ifndef SOCK_CLOEXEC",
          "67: #  define SOCK_CLOEXEC O_CLOEXEC",
          "68: # endif",
          "70: # ifndef SOCK_NONBLOCK",
          "71: #  define SOCK_NONBLOCK O_NONBLOCK",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f2a9ed487369ab7222522e1097708550adbe165c",
      "candidate_info": {
        "commit_hash": "f2a9ed487369ab7222522e1097708550adbe165c",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/f2a9ed487369ab7222522e1097708550adbe165c",
        "files": [
          "lib/sys.js"
        ],
        "message": "Fix #3577 Un-break require('sys')",
        "before_after_code_files": [
          "lib/sys.js||lisys.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/sys.js||lisys.js": [
          "File: lib/sys.js -> lisys.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: throw new Error('The \"sys\" module is now called \"util\".');",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2ba96451a9bf5d91e5df2cbff372c4983da16dd4",
      "candidate_info": {
        "commit_hash": "2ba96451a9bf5d91e5df2cbff372c4983da16dd4",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/2ba96451a9bf5d91e5df2cbff372c4983da16dd4",
        "files": [
          "lib/punycode.js",
          "test/simple/test-punycode.js"
        ],
        "message": "punycode: update to v1.1.1",
        "before_after_code_files": [
          "lib/punycode.js||lipunycode.js",
          "test/simple/test-punycode.js||test/simple/test-punycode.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/punycode.js||lipunycode.js": [
          "File: lib/punycode.js -> lipunycode.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "36:  errors = {",
          "37:   'overflow': 'Overflow: input needs wider integers to process.',",
          "40:   'not-basic': 'Illegal input >= 0x80 (not a basic code point)',",
          "41:   'invalid-input': 'Invalid input'",
          "42:  },",
          "",
          "[Removed Lines]",
          "38:   'ucs2decode': 'UCS-2(decode): illegal sequence',",
          "39:   'ucs2encode': 'UCS-2(encode): illegal value',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "112:       extra;",
          "113:   while (counter < length) {",
          "114:    value = string.charCodeAt(counter++);",
          "116:     extra = string.charCodeAt(counter++);",
          "119:     }",
          "121:    }",
          "123:   }",
          "124:   return output;",
          "125:  }",
          "",
          "[Removed Lines]",
          "115:    if ((value & 0xF800) == 0xD800) {",
          "117:     if ((value & 0xFC00) != 0xD800 || (extra & 0xFC00) != 0xDC00) {",
          "118:      error('ucs2decode');",
          "120:     value = ((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000;",
          "122:    output.push(value);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "135:  function ucs2encode(array) {",
          "136:   return map(array, function(value) {",
          "137:    var output = '';",
          "141:    if (value > 0xFFFF) {",
          "142:     value -= 0x10000;",
          "143:     output += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);",
          "",
          "[Removed Lines]",
          "138:    if ((value & 0xF800) == 0xD800) {",
          "139:     error('ucs2encode');",
          "140:    }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "475:   'version': '1.0.0',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/simple/test-punycode.js||test/simple/test-punycode.js": [
          "File: test/simple/test-punycode.js -> test/simple/test-punycode.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "179:   }",
          "180: }",
          "182: assert.equal(errors, 0);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "183: assert.equal(punycode.ucs2.encode([0x61]), 'a');",
          "185: assert.equal(punycode.ucs2.encode([0x1D306]), '\\uD834\\uDF06');",
          "187: assert.equal(punycode.ucs2.encode([0xD800]), '\\uD800');",
          "189: assert.equal(punycode.ucs2.encode([0xD800, 0x61, 0x62]), '\\uD800ab');",
          "191: assert.equal(punycode.ucs2.encode([0xDC00]), '\\uDC00');",
          "193: assert.equal(punycode.ucs2.encode([0xDC00, 0x61, 0x62]), '\\uDC00ab');",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "57ddf5f50ae3c7e3fe463da9a36c3e0bd615519c",
      "candidate_info": {
        "commit_hash": "57ddf5f50ae3c7e3fe463da9a36c3e0bd615519c",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/57ddf5f50ae3c7e3fe463da9a36c3e0bd615519c",
        "files": [
          "test/simple/test-dgram-multicast-multi-process.js",
          "test/simple/test-dgram-multicast-setTTL.js"
        ],
        "message": "test: fix typos in error messages",
        "before_after_code_files": [
          "test/simple/test-dgram-multicast-multi-process.js||test/simple/test-dgram-multicast-multi-process.js",
          "test/simple/test-dgram-multicast-setTTL.js||test/simple/test-dgram-multicast-setTTL.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/simple/test-dgram-multicast-multi-process.js||test/simple/test-dgram-multicast-multi-process.js": [
          "File: test/simple/test-dgram-multicast-multi-process.js -> test/simple/test-dgram-multicast-multi-process.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "85:                 }",
          "86:               });",
          "89:                     , count);",
          "91:               assert.equal(count, messages.length",
          "",
          "[Removed Lines]",
          "88:               console.error('%d received %d matching messges.', worker.pid",
          "",
          "[Added Lines]",
          "88:               console.error('%d received %d matching messages.', worker.pid",
          "",
          "---------------"
        ],
        "test/simple/test-dgram-multicast-setTTL.js||test/simple/test-dgram-multicast-setTTL.js": [
          "File: test/simple/test-dgram-multicast-setTTL.js -> test/simple/test-dgram-multicast-setTTL.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "35:     thrown = true;",
          "36: }",
          "",
          "[Removed Lines]",
          "38: assert(thrown, 'Setting an invalid mutlicast TTL should throw some error');",
          "41: socket.close();",
          "",
          "[Added Lines]",
          "38: assert(thrown, 'Setting an invalid multicast TTL should throw some error');",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e8067cb68563e3f3ab760e3ce8d0aeb873198f36",
      "candidate_info": {
        "commit_hash": "e8067cb68563e3f3ab760e3ce8d0aeb873198f36",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/e8067cb68563e3f3ab760e3ce8d0aeb873198f36",
        "files": [
          "src/node_version.h"
        ],
        "message": "Now working on v0.6.16",
        "before_after_code_files": [
          "src/node_version.h||src/node_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/node_version.h||src/node_version.h": [
          "File: src/node_version.h -> src/node_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #define NODE_MAJOR_VERSION 0",
          "30: #define NODE_MINOR_VERSION 6",
          "34: #ifndef NODE_STRINGIFY",
          "35: #define NODE_STRINGIFY(n) NODE_STRINGIFY_HELPER(n)",
          "",
          "[Removed Lines]",
          "31: #define NODE_PATCH_VERSION 15",
          "32: #define NODE_VERSION_IS_RELEASE 1",
          "",
          "[Added Lines]",
          "31: #define NODE_PATCH_VERSION 16",
          "32: #define NODE_VERSION_IS_RELEASE 0",
          "",
          "---------------"
        ]
      }
    }
  ]
}