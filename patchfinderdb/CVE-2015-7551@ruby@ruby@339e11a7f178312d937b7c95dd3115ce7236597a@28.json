{
  "cve_id": "CVE-2015-7551",
  "cve_desc": "The Fiddle::Handle implementation in ext/fiddle/handle.c in Ruby before 2.0.0-p648, 2.1 before 2.1.8, and 2.2 before 2.2.4, as distributed in Apple OS X before 10.11.4 and other products, mishandles tainting, which allows context-dependent attackers to execute arbitrary code or cause a denial of service (application crash) via a crafted string, related to the DL module and the libffi library.  NOTE: this vulnerability exists because of a CVE-2009-5147 regression.",
  "repo": "ruby/ruby",
  "patch_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
  "patch_info": {
    "commit_hash": "339e11a7f178312d937b7c95dd3115ce7236597a",
    "repo": "ruby/ruby",
    "commit_url": "https://github.com/ruby/ruby/commit/339e11a7f178312d937b7c95dd3115ce7236597a",
    "files": [
      "ChangeLog",
      "ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb",
      "version.h"
    ],
    "message": "merge revision(s): 53153 and 23405@ruby_1_9_1\n\n\t* ext/fiddle/handle.c: check tainted string arguments.\n\t  Patch provided by tenderlove and nobu.\n\n\t* test/fiddle/test_handle.rb (class TestHandle): add test for above.\n\n\t* ext/dl/handle.c (rb_dlhandle_initialize): prohibits DL::dlopen\n\t  with a tainted name of library.\n\t  Patch by sheepman <sheepman AT sheepman.sakura.ne.jp>.\n\n\t* ext/dl/handle.c (rb_dlhandle_sym): ditto\n\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53156 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
    "before_after_code_files": [
      "ext/fiddle/handle.c||ext/fiddle/handle.c",
      "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb",
      "version.h||version.h"
    ]
  },
  "patch_diff": {
    "ext/fiddle/handle.c||ext/fiddle/handle.c": [
      "File: ext/fiddle/handle.c -> ext/fiddle/handle.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #include <ruby.h>",
      "2: #include <fiddle.h>",
      "4: VALUE rb_cHandle;",
      "6: struct dl_handle {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4: #define SafeStringValueCStr(v) (rb_check_safe_obj(rb_string_value(&v)), StringValueCStr(v))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "143:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "144:  break;",
      "145:       case 1:",
      "147:  cflag = RTLD_LAZY | RTLD_GLOBAL;",
      "148:  break;",
      "149:       case 2:",
      "151:  cflag = NUM2INT(flag);",
      "152:  break;",
      "153:       default:",
      "",
      "[Removed Lines]",
      "146:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "150:  clib = NIL_P(lib) ? NULL : StringValuePtr(lib);",
      "",
      "[Added Lines]",
      "148:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "152:  clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "263:     return PTR2NUM(fiddle_handle);",
      "264: }",
      "",
      "[Removed Lines]",
      "266: static VALUE fiddle_handle_sym(void *handle, const char *symbol);",
      "",
      "[Added Lines]",
      "268: static VALUE fiddle_handle_sym(void *handle, VALUE symbol);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "282:  rb_raise(rb_eFiddleError, \"closed handle\");",
      "283:     }",
      "286: }",
      "288: #ifndef RTLD_NEXT",
      "",
      "[Removed Lines]",
      "285:     return fiddle_handle_sym(fiddle_handle->ptr, StringValueCStr(sym));",
      "",
      "[Added Lines]",
      "287:     return fiddle_handle_sym(fiddle_handle->ptr, sym);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "305: static VALUE",
      "306: rb_fiddle_handle_s_sym(VALUE self, VALUE sym)",
      "307: {",
      "309: }",
      "311: static VALUE",
      "313: {",
      "314: #if defined(HAVE_DLERROR)",
      "315:     const char *err;",
      "",
      "[Removed Lines]",
      "308:     return fiddle_handle_sym(RTLD_NEXT, StringValueCStr(sym));",
      "312: fiddle_handle_sym(void *handle, const char *name)",
      "",
      "[Added Lines]",
      "310:     return fiddle_handle_sym(RTLD_NEXT, sym);",
      "314: fiddle_handle_sym(void *handle, VALUE symbol)",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "318: # define CHECK_DLERROR",
      "319: #endif",
      "320:     void (*func)();",
      "322:     rb_secure(2);",
      "323: #ifdef HAVE_DLERROR",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "323:     const char *name = SafeStringValueCStr(symbol);",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "367:     }",
      "368: #endif",
      "369:     if( !func ){",
      "371:     }",
      "373:     return PTR2NUM(func);",
      "",
      "[Removed Lines]",
      "370:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%s\\\"\", name);",
      "",
      "[Added Lines]",
      "373:  rb_raise(rb_eFiddleError, \"unknown symbol \\\"%\"PRIsVALUE\"\\\"\", symbol);",
      "",
      "---------------"
    ],
    "test/fiddle/test_handle.rb||test/fiddle/test_handle.rb": [
      "File: test/fiddle/test_handle.rb -> test/fiddle/test_handle.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "11:     include Test::Unit::Assertions",
      "13:     def test_to_i",
      "14:       handle = Fiddle::Handle.new(LIBC_SO)",
      "15:       assert_kind_of Integer, handle.to_i",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "13:     def test_safe_handle_open",
      "14:       t = Thread.new do",
      "15:         $SAFE = 1",
      "16:         Fiddle::Handle.new(LIBC_SO.taint)",
      "17:       end",
      "18:       assert_raise(SecurityError) { t.value }",
      "19:     end",
      "21:     def test_safe_function_lookup",
      "22:       t = Thread.new do",
      "23:         h = Fiddle::Handle.new(LIBC_SO)",
      "24:         $SAFE = 1",
      "25:         h[\"qsort\".taint]",
      "26:       end",
      "27:       assert_raise(SecurityError) { t.value }",
      "28:     end",
      "",
      "---------------"
    ],
    "version.h||version.h": [
      "File: version.h -> version.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: #define RUBY_VERSION \"2.1.8\"",
      "2: #define RUBY_RELEASE_DATE \"2015-12-16\"",
      "5: #define RUBY_RELEASE_YEAR 2015",
      "6: #define RUBY_RELEASE_MONTH 12",
      "",
      "[Removed Lines]",
      "3: #define RUBY_PATCHLEVEL 438",
      "",
      "[Added Lines]",
      "3: #define RUBY_PATCHLEVEL 439",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "9c0d8283ecc8b9b1960249f65f0b0e045cc58741",
      "candidate_info": {
        "commit_hash": "9c0d8283ecc8b9b1960249f65f0b0e045cc58741",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/9c0d8283ecc8b9b1960249f65f0b0e045cc58741",
        "files": [
          "ChangeLog",
          "cont.c",
          "doc/ChangeLog-1.8.0",
          "doc/ChangeLog-1.9.3",
          "doc/ChangeLog-YARV",
          "ext/tk/lib/tkextlib/SUPPORT_STATUS",
          "ext/tk/sample/demos-en/combo.rb",
          "ext/tk/sample/demos-en/rolodex",
          "ext/tk/sample/demos-jp/rolodex",
          "ext/tk/sample/tkextlib/blt/pareto.rb",
          "ext/tk/sample/tkextlib/tkHTML/page4/index.html",
          "include/ruby/version.h",
          "test/net/http/test_http.rb",
          "test/openssl/test_config.rb",
          "test/rexml/test_core.rb",
          "test/webrick/test_httpserver.rb",
          "version.h"
        ],
        "message": "merge revision(s) 53299: [Backport #11870]\n\nfix common misspelling [ci skip]\n\n    compile.c, cont.c, doc, man: fix common misspelling. [Bug #11870]\n\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53925 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "cont.c||cont.c",
          "ext/tk/sample/demos-en/combo.rb||ext/tk/sample/demos-en/combo.rb",
          "ext/tk/sample/tkextlib/blt/pareto.rb||ext/tk/sample/tkextliblt/pareto.rb",
          "ext/tk/sample/tkextlib/tkHTML/page4/index.html||ext/tk/sample/tkextlitkHTML/page4/index.html",
          "include/ruby/version.h||include/ruby/version.h",
          "test/net/http/test_http.rb||test/net/http/test_http.rb",
          "test/openssl/test_config.rb||test/openssl/test_config.rb",
          "test/rexml/test_core.rb||test/rexml/test_core.rb",
          "test/webrick/test_httpserver.rb||test/webrick/test_httpserver.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "cont.c||cont.c": [
          "File: cont.c -> cont.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "145: #if FIBER_USE_NATIVE",
          "146: #ifdef _WIN32",
          "",
          "[Removed Lines]",
          "143:     int transfered;",
          "",
          "[Added Lines]",
          "143:     int transferred;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1485:     if (fib->prev != Qnil || fib->cont.type == ROOT_FIBER_CONTEXT) {",
          "1486:  rb_raise(rb_eFiberError, \"double resume\");",
          "1487:     }",
          "1489:  rb_raise(rb_eFiberError, \"cannot resume transferred Fiber\");",
          "1490:     }",
          "",
          "[Removed Lines]",
          "1488:     if (fib->transfered != 0) {",
          "",
          "[Added Lines]",
          "1488:     if (fib->transferred != 0) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1599: {",
          "1600:     rb_fiber_t *fib;",
          "1601:     GetFiberPtr(fibval, fib);",
          "1603:     return rb_fiber_transfer(fibval, argc, argv);",
          "1604: }",
          "",
          "[Removed Lines]",
          "1602:     fib->transfered = 1;",
          "",
          "[Added Lines]",
          "1602:     fib->transferred = 1;",
          "",
          "---------------"
        ],
        "ext/tk/sample/demos-en/combo.rb||ext/tk/sample/demos-en/combo.rb": [
          "File: ext/tk/sample/demos-en/combo.rb -> ext/tk/sample/demos-en/combo.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "71: ]",
          "75: ozCity.value = 'Sydney'",
          "77: Tk.pack(Ttk::Labelframe.new(frame, :text=>'Fully Editable'){|f|",
          "",
          "[Removed Lines]",
          "74: secondValue.value = 'unchangable'",
          "",
          "[Added Lines]",
          "74: secondValue.value = 'unchangeable'",
          "",
          "---------------"
        ],
        "ext/tk/sample/tkextlib/blt/pareto.rb||ext/tk/sample/tkextliblt/pareto.rb": [
          "File: ext/tk/sample/tkextlib/blt/pareto.rb -> ext/tk/sample/tkextliblt/pareto.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "67:                   :foreground=>'red4', :anchor=>:center, :yoffset=>-5)",
          "68: }",
          "71: b.axis_configure('y2', :hide=>false, :min=>0.0, :max=>100.0,",
          "72:                  :title=>'Percentage')",
          "",
          "[Removed Lines]",
          "70: # Display an auxillary y-axis for percentages.",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/tk/sample/tkextlib/tkHTML/page4/index.html||ext/tk/sample/tkextlitkHTML/page4/index.html": [
          "File: ext/tk/sample/tkextlib/tkHTML/page4/index.html -> ext/tk/sample/tkextlitkHTML/page4/index.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "117: <B><FONT SIZE=\"+2\">nmpg 1.1.3</FONT></B><BR>",
          "118: <SMALL><B><A HREF=\"mailto:narkos@linuxmail.org\">Joel Lindau</A> - January 29th 2000, 18:18 EST</B></SMALL>",
          "119: <DIV ALIGN=\"justify\"><P>nmpg is a small command-driven frontend and network-jukebox for mpg123.</DIV>",
          "121: <P><B>Urgency:</B> low",
          "122: <P ALIGN=\"right\"><B>[ <A HREF=\"/news/2000/01/29/949187896.html\">comments (0)</A> ]</B>",
          "123: </FONT></TD></TR></TABLE></TD></TR><TR><TD VALIGN=\"middle\">",
          "",
          "[Removed Lines]",
          "120: <P><B>Changes:</B> Bugfixes, better memory managment, a new .nmpgrc parser, and new options.",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "include/ruby/version.h||include/ruby/version.h": [
          "File: include/ruby/version.h -> include/ruby/version.h"
        ],
        "test/net/http/test_http.rb||test/net/http/test_http.rb": [
          "File: test/net/http/test_http.rb -> test/net/http/test_http.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "141:   def test_proxy_port",
          "142:     clean_http_proxy_env do",
          "144:       assert_equal 'proxy.example', http.proxy_address",
          "145:       assert_equal 80, http.proxy_port",
          "147:       assert_equal 8000, http.proxy_port",
          "149:       assert_equal nil, http.proxy_port",
          "150:     end",
          "151:   end",
          "",
          "[Removed Lines]",
          "143:       http = Net::HTTP.new 'exmaple', nil, 'proxy.example'",
          "146:       http = Net::HTTP.new 'exmaple', nil, 'proxy.example', 8000",
          "148:       http = Net::HTTP.new 'exmaple', nil",
          "",
          "[Added Lines]",
          "143:       http = Net::HTTP.new 'example', nil, 'proxy.example'",
          "146:       http = Net::HTTP.new 'example', nil, 'proxy.example', 8000",
          "148:       http = Net::HTTP.new 'example', nil",
          "",
          "---------------"
        ],
        "test/openssl/test_config.rb||test/openssl/test_config.rb": [
          "File: test/openssl/test_config.rb -> test/openssl/test_config.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "167:   end",
          "169:   def test_value",
          "171:     OpenSSL::TestUtils.silent do",
          "172:       assert_equal('CA_default', @it.value('ca', 'default_ca'))",
          "173:       assert_equal(nil, @it.value('ca', 'no such key'))",
          "",
          "[Removed Lines]",
          "170:     # supress deprecation warnings",
          "",
          "[Added Lines]",
          "170:     # suppress deprecation warnings",
          "",
          "---------------"
        ],
        "test/rexml/test_core.rb||test/rexml/test_core.rb": [
          "File: test/rexml/test_core.rb -> test/rexml/test_core.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "616:   def test_stream",
          "617:     c = Listener.new",
          "618:     Document.parse_stream( File.new(fixture_path(\"documentation.xml\")), c )",
          "620:     assert(c.te, \"Stream parsing dropped end tag for documentation\")",
          "622:     Document.parse_stream(\"<a.b> <c/> </a.b>\", c)",
          "",
          "[Removed Lines]",
          "619:     assert(c.ts, \"Stream parsing apparantly didn't parse the whole file\")",
          "",
          "[Added Lines]",
          "619:     assert(c.ts, \"Stream parsing apparently didn't parse the whole file\")",
          "",
          "---------------"
        ],
        "test/webrick/test_httpserver.rb||test/webrick/test_httpserver.rb": [
          "File: test/webrick/test_httpserver.rb -> test/webrick/test_httpserver.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "344:           http.request(req){|res| assert_equal(\"foo\", res.body) }",
          "345:         end",
          "346:       rescue Timeout::Error",
          "348:       end",
          "349:     }",
          "350:   end",
          "",
          "[Removed Lines]",
          "347:         flunk('corrupted reponse')",
          "",
          "[Added Lines]",
          "347:         flunk('corrupted response')",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.9\"",
          "2: #define RUBY_RELEASE_DATE \"2016-02-25\"",
          "5: #define RUBY_RELEASE_YEAR 2016",
          "6: #define RUBY_RELEASE_MONTH 2",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 446",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 447",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a61756e094462e6548113a7407652230f1f85161",
      "candidate_info": {
        "commit_hash": "a61756e094462e6548113a7407652230f1f85161",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/a61756e094462e6548113a7407652230f1f85161",
        "files": [
          "ChangeLog",
          "lib/time.rb",
          "test/test_time.rb",
          "version.h"
        ],
        "message": "merge revision(s) 49788,49790: [Backport #10904]\n\n\t* lib/time.rb (strptime): Support %s.%N.\n\t  [ruby-core:68301] [Bug #10904] Patch by Sadayuki Furuhashi.\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@51599 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "lib/time.rb||lib/time.rb",
          "test/test_time.rb||test/test_time.rb",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "lib/time.rb||lib/time.rb": [
          "File: lib/time.rb -> lib/time.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "393:       d = Date._strptime(date, format)",
          "394:       raise ArgumentError, \"invalid strptime format - `#{format}'\" unless d",
          "395:       if seconds = d[:seconds]",
          "396:         if offset = d[:offset]",
          "398:         else",
          "400:         end",
          "401:       else",
          "402:         year = d[:year]",
          "",
          "[Removed Lines]",
          "397:           Time.at(seconds).localtime(offset)",
          "399:           Time.at(seconds)",
          "",
          "[Added Lines]",
          "396:         if sec_fraction = d[:sec_fraction]",
          "397:           usec = sec_fraction * 1000000",
          "398:           usec *= -1 if seconds < 0",
          "399:         else",
          "400:           usec = 0",
          "401:         end",
          "403:           Time.at(seconds, usec).localtime(offset)",
          "405:           Time.at(seconds, usec)",
          "",
          "---------------"
        ],
        "test/test_time.rb||test/test_time.rb": [
          "File: test/test_time.rb -> test/test_time.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "404:     assert_equal(3600, Time.strptime('0 +0100', '%s %z').utc_offset)",
          "405:   end",
          "407:   def test_nsec",
          "408:     assert_equal(123456789, Time.xmlschema(\"2000-01-01T00:00:00.123456789+00:00\").tv_nsec)",
          "409:     assert_equal(123456789, Time.parse(\"2000-01-01T00:00:00.123456789+00:00\").tv_nsec)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "407:   def test_strptime_s_N",
          "408:     assert_equal(Time.at(1, 500000), Time.strptime(\"1.5\", \"%s.%N\"))",
          "409:     assert_equal(Time.at(-2, 500000), Time.strptime(\"-1.5\", \"%s.%N\"))",
          "410:     t = Time.strptime(\"1.000000000001\", \"%s.%N\")",
          "411:     assert_equal(1, t.to_i)",
          "412:     assert_equal(Rational(\"0.000000000001\"), t.subsec)",
          "413:     t = Time.strptime(\"-1.000000000001\", \"%s.%N\")",
          "414:     assert_equal(-2, t.to_i)",
          "415:     assert_equal(1-Rational(\"0.000000000001\"), t.subsec)",
          "416:   end",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.7\"",
          "2: #define RUBY_RELEASE_DATE \"2015-08-17\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 8",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 382",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 383",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2e1523316d1de17fc80257a601aadac6df452fde",
      "candidate_info": {
        "commit_hash": "2e1523316d1de17fc80257a601aadac6df452fde",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/2e1523316d1de17fc80257a601aadac6df452fde",
        "files": [
          "ChangeLog",
          "configure.in",
          "version.h"
        ],
        "message": "merge revision(s) 52199: [Backport #11792]\n\n\t* configure.in: pthread_getattr_np is broken on AIX.\n\t  More specifically, the stack address and size returned are\n\t  not correct.\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53146 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "configure.in||configure.in",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "2473:  AC_MSG_WARN(\"Don't know how to find pthread library on your system -- thread support disabled\")",
          "2474:     fi",
          "2475:     AC_CHECK_FUNCS(sched_yield pthread_attr_setinheritsched \\",
          "2477:  pthread_get_stackaddr_np pthread_get_stacksize_np \\",
          "2478:  thr_stksegment pthread_stackseg_np pthread_getthrds_np \\",
          "2479:  pthread_cond_init pthread_condattr_setclock pthread_condattr_init \\",
          "2480:  pthread_sigmask pthread_setname_np)",
          "2481:     if test \"${host_os}\" = \"nacl\"; then",
          "2482:       ac_cv_func_pthread_attr_init=no",
          "2483:     else",
          "",
          "[Removed Lines]",
          "2476:  pthread_getattr_np pthread_attr_get_np pthread_attr_getstack\\",
          "",
          "[Added Lines]",
          "2476:  pthread_attr_get_np pthread_attr_getstack\\",
          "2481:     AS_CASE([\"$target_os\"],[aix*],[ac_cv_func_pthread_getattr_np=no],[AC_CHECK_FUNCS(pthread_getattr_np)])",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.8\"",
          "2: #define RUBY_RELEASE_DATE \"2015-12-16\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 12",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 435",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 436",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f2016423a6e52b0b779265151b27361aeefedd54",
      "candidate_info": {
        "commit_hash": "f2016423a6e52b0b779265151b27361aeefedd54",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/f2016423a6e52b0b779265151b27361aeefedd54",
        "files": [
          "ChangeLog",
          "ext/socket/ancdata.c",
          "version.h"
        ],
        "message": "merge revision(s) 50685: [Backport #11198]\n\n\t* ext/socket/ancdata.c: use RB_GC_GUARD instead of volatile\n\t  [ruby-core:69419] [Feature #11198]\n\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@50809 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "ext/socket/ancdata.c||ext/socket/ancdata.c",
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/socket/ancdata.c||ext/socket/ancdata.c": [
          "File: ext/socket/ancdata.c -> ext/socket/ancdata.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1133:     struct msghdr mh;",
          "1134:     struct iovec iov;",
          "1135: #if defined(HAVE_STRUCT_MSGHDR_MSG_CONTROL)",
          "1137:     VALUE *controls_ptr = NULL;",
          "1138:     int family;",
          "1139: #endif",
          "",
          "[Removed Lines]",
          "1136:     volatile VALUE controls_str = 0;",
          "",
          "[Added Lines]",
          "1136:     VALUE controls_str = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1289:             rb_readwrite_sys_fail(RB_IO_WAIT_WRITABLE, \"sendmsg(2) would block\");",
          "1290:  rb_sys_fail(\"sendmsg(2)\");",
          "1291:     }",
          "1293:     return SSIZET2NUM(ss);",
          "1294: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1292: #if defined(HAVE_STRUCT_MSGHDR_MSG_CONTROL)",
          "1293:     RB_GC_GUARD(controls_str);",
          "1294: #endif",
          "",
          "---------------"
        ],
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.7\"",
          "2: #define RUBY_RELEASE_DATE \"2015-06-09\"",
          "5: #define RUBY_RELEASE_YEAR 2015",
          "6: #define RUBY_RELEASE_MONTH 6",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 365",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 366",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "63b34adea2eb7af969f7523d34a72427b8b8dbde",
      "candidate_info": {
        "commit_hash": "63b34adea2eb7af969f7523d34a72427b8b8dbde",
        "repo": "ruby/ruby",
        "commit_url": "https://github.com/ruby/ruby/commit/63b34adea2eb7af969f7523d34a72427b8b8dbde",
        "files": [
          "version.h"
        ],
        "message": "* version.h: commit miss\n\ngit-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_1@53933 b2dd03c8-39d4-4d8f-98ff-823fe69b080e",
        "before_after_code_files": [
          "version.h||version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "version.h||version.h"
          ],
          "candidate": [
            "version.h||version.h"
          ]
        }
      },
      "candidate_diff": {
        "version.h||version.h": [
          "File: version.h -> version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #define RUBY_VERSION \"2.1.9\"",
          "2: #define RUBY_RELEASE_DATE \"2016-02-25\"",
          "5: #define RUBY_RELEASE_YEAR 2016",
          "6: #define RUBY_RELEASE_MONTH 2",
          "",
          "[Removed Lines]",
          "3: #define RUBY_PATCHLEVEL 451",
          "",
          "[Added Lines]",
          "3: #define RUBY_PATCHLEVEL 452",
          "",
          "---------------"
        ]
      }
    }
  ]
}