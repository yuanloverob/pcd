{
  "cve_id": "CVE-2015-0564",
  "cve_desc": "Buffer underflow in the ssl_decrypt_record function in epan/dissectors/packet-ssl-utils.c in Wireshark 1.10.x before 1.10.12 and 1.12.x before 1.12.3 allows remote attackers to cause a denial of service (application crash) via a crafted packet that is improperly handled during decryption of an SSL session.",
  "repo": "wireshark/wireshark",
  "patch_hash": "d3581aecda62d2a51ea7088fd46975415b03ec57",
  "patch_info": {
    "commit_hash": "d3581aecda62d2a51ea7088fd46975415b03ec57",
    "repo": "wireshark/wireshark",
    "commit_url": "https://github.com/wireshark/wireshark/commit/d3581aecda62d2a51ea7088fd46975415b03ec57",
    "files": [
      "epan/dissectors/packet-ssl-utils.c"
    ],
    "message": "Make sure we don't underrun a buffer when decrypting SSL.\n\nDiscovered by Noam Rathaus.\n\nChange-Id: Ia0275601b2a825ba616656064d9a6eca109e34fa\nReviewed-on: https://code.wireshark.org/review/6256\nPetri-Dish: Gerald Combs <gerald@wireshark.org>\nReviewed-by: Gerald Combs <gerald@wireshark.org>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Evan Huus <eapache@gmail.com>",
    "before_after_code_files": [
      "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
    ]
  },
  "patch_diff": {
    "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c": [
      "File: epan/dissectors/packet-ssl-utils.c -> epan/dissectors/packet-ssl-utils.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3315:     if (decoder->cipher_suite->mode == MODE_CBC) {",
      "3316:         pad=out_str->data[inl-1];",
      "3317:         if (worklen <= pad) {",
      "3318:             ssl_debug_printf(\"ssl_decrypt_record failed: padding %d too large for work %d\\n\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "3317:             ssl_debug_printf(\"ssl_decrypt_record failed: input length %d too small\\n\", inl);",
      "3318:             return -1;",
      "3319:         }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f4f119946a4070f5aa9826c8c41e435760cd81f7",
      "candidate_info": {
        "commit_hash": "f4f119946a4070f5aa9826c8c41e435760cd81f7",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/f4f119946a4070f5aa9826c8c41e435760cd81f7",
        "files": [
          "epan/dissectors/packet-ssl-utils.c"
        ],
        "message": "Make sure we don't underrun a buffer when decrypting SSL.\n\nDiscovered by Noam Rathaus.\n\nChange-Id: Ia0275601b2a825ba616656064d9a6eca109e34fa\nReviewed-on: https://code.wireshark.org/review/6256\nPetri-Dish: Gerald Combs <gerald@wireshark.org>\nReviewed-by: Gerald Combs <gerald@wireshark.org>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Evan Huus <eapache@gmail.com>\n(cherry picked from commit d3581aecda62d2a51ea7088fd46975415b03ec57)\nReviewed-on: https://code.wireshark.org/review/6324\n(cherry picked from commit f5e435ab8bccaf64ca93dc6e2330090b2e99e532)\nReviewed-on: https://code.wireshark.org/review/6428\nReviewed-by: Michael Mann <mmann78@netscape.net>",
        "before_after_code_files": [
          "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
          ],
          "candidate": [
            "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c": [
          "File: epan/dissectors/packet-ssl-utils.c -> epan/dissectors/packet-ssl-utils.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3195:     if (decoder->cipher_suite->mode == MODE_CBC) {",
          "3196:         pad=out_str->data[inl-1];",
          "3197:         if (worklen <= pad) {",
          "3198:             ssl_debug_printf(\"ssl_decrypt_record failed: padding %d too large for work %d\\n\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3197:             ssl_debug_printf(\"ssl_decrypt_record failed: input length %d too small\\n\", inl);",
          "3198:             return -1;",
          "3199:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b98bcd46b3678fef89c989312d25154bbfcc4a26",
      "candidate_info": {
        "commit_hash": "b98bcd46b3678fef89c989312d25154bbfcc4a26",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/b98bcd46b3678fef89c989312d25154bbfcc4a26",
        "files": [
          "epan/dissectors/packet-ssl-utils.c"
        ],
        "message": "Make sure we don't underrun a buffer when decrypting SSL.\n\nDiscovered by Noam Rathaus.\n\nChange-Id: Ia0275601b2a825ba616656064d9a6eca109e34fa\nReviewed-on: https://code.wireshark.org/review/6256\nPetri-Dish: Gerald Combs <gerald@wireshark.org>\nReviewed-by: Gerald Combs <gerald@wireshark.org>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Evan Huus <eapache@gmail.com>\n(cherry picked from commit d3581aecda62d2a51ea7088fd46975415b03ec57)\nConflicts:\n\tepan/dissectors/packet-ssl-utils.c\nReviewed-on: https://code.wireshark.org/review/6325\n(cherry picked from commit 7fc3a06b9bdcb4cb5760a3b55aa9bc76ff135d2c)\nReviewed-on: https://code.wireshark.org/review/6431\nReviewed-by: Michael Mann <mmann78@netscape.net>",
        "before_after_code_files": [
          "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
          ],
          "candidate": [
            "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c": [
          "File: epan/dissectors/packet-ssl-utils.c -> epan/dissectors/packet-ssl-utils.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2560:     if(decoder->cipher_suite->block!=1) {",
          "2561:         pad=out_str->data[inl-1];",
          "2562:         worklen-=(pad+1);",
          "2563:         ssl_debug_printf(\"ssl_decrypt_record found padding %d final len %d\\n\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2562:             ssl_debug_printf(\"ssl_decrypt_record failed: input length %d too small\\n\", inl);",
          "2563:             return -1;",
          "2564:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f5e435ab8bccaf64ca93dc6e2330090b2e99e532",
      "candidate_info": {
        "commit_hash": "f5e435ab8bccaf64ca93dc6e2330090b2e99e532",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/f5e435ab8bccaf64ca93dc6e2330090b2e99e532",
        "files": [
          "epan/dissectors/packet-ssl-utils.c"
        ],
        "message": "Make sure we don't underrun a buffer when decrypting SSL.\n\nDiscovered by Noam Rathaus.\n\nChange-Id: Ia0275601b2a825ba616656064d9a6eca109e34fa\nReviewed-on: https://code.wireshark.org/review/6256\nPetri-Dish: Gerald Combs <gerald@wireshark.org>\nReviewed-by: Gerald Combs <gerald@wireshark.org>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Evan Huus <eapache@gmail.com>\n(cherry picked from commit d3581aecda62d2a51ea7088fd46975415b03ec57)\nReviewed-on: https://code.wireshark.org/review/6324",
        "before_after_code_files": [
          "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
          ],
          "candidate": [
            "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c": [
          "File: epan/dissectors/packet-ssl-utils.c -> epan/dissectors/packet-ssl-utils.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3195:     if (decoder->cipher_suite->mode == MODE_CBC) {",
          "3196:         pad=out_str->data[inl-1];",
          "3197:         if (worklen <= pad) {",
          "3198:             ssl_debug_printf(\"ssl_decrypt_record failed: padding %d too large for work %d\\n\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3197:             ssl_debug_printf(\"ssl_decrypt_record failed: input length %d too small\\n\", inl);",
          "3198:             return -1;",
          "3199:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7fc3a06b9bdcb4cb5760a3b55aa9bc76ff135d2c",
      "candidate_info": {
        "commit_hash": "7fc3a06b9bdcb4cb5760a3b55aa9bc76ff135d2c",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/7fc3a06b9bdcb4cb5760a3b55aa9bc76ff135d2c",
        "files": [
          "epan/dissectors/packet-ssl-utils.c"
        ],
        "message": "Make sure we don't underrun a buffer when decrypting SSL.\n\nDiscovered by Noam Rathaus.\n\nChange-Id: Ia0275601b2a825ba616656064d9a6eca109e34fa\nReviewed-on: https://code.wireshark.org/review/6256\nPetri-Dish: Gerald Combs <gerald@wireshark.org>\nReviewed-by: Gerald Combs <gerald@wireshark.org>\nTested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>\nReviewed-by: Evan Huus <eapache@gmail.com>\n(cherry picked from commit d3581aecda62d2a51ea7088fd46975415b03ec57)\nConflicts:\n\tepan/dissectors/packet-ssl-utils.c\nReviewed-on: https://code.wireshark.org/review/6325",
        "before_after_code_files": [
          "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
          ],
          "candidate": [
            "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-ssl-utils.c||epan/dissectors/packet-ssl-utils.c": [
          "File: epan/dissectors/packet-ssl-utils.c -> epan/dissectors/packet-ssl-utils.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2684:     if(decoder->cipher_suite->block!=1) {",
          "2685:         pad=out_str->data[inl-1];",
          "2686:         worklen-=(pad+1);",
          "2687:         ssl_debug_printf(\"ssl_decrypt_record found padding %d final len %d\\n\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2686:             ssl_debug_printf(\"ssl_decrypt_record failed: input length %d too small\\n\", inl);",
          "2687:             return -1;",
          "2688:         }",
          "",
          "---------------"
        ]
      }
    }
  ]
}