{
  "cve_id": "CVE-2016-4540",
  "cve_desc": "The grapheme_stripos function in ext/intl/grapheme/grapheme_string.c in PHP before 5.5.35, 5.6.x before 5.6.21, and 7.x before 7.0.6 allows remote attackers to cause a denial of service (out-of-bounds read) or possibly have unspecified other impact via a negative offset.",
  "repo": "php/php-src",
  "patch_hash": "fd9689745c44341b1bd6af4756f324be8abba2fb",
  "patch_info": {
    "commit_hash": "fd9689745c44341b1bd6af4756f324be8abba2fb",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/fd9689745c44341b1bd6af4756f324be8abba2fb",
    "files": [
      "ext/intl/grapheme/grapheme_string.c",
      "ext/intl/tests/bug72061.phpt"
    ],
    "message": "Fix bug #72061 - Out-of-bounds reads in zif_grapheme_stripos with negative offset",
    "before_after_code_files": [
      "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c",
      "ext/intl/tests/bug72061.phpt||ext/intl/tests/bug72061.phpt"
    ]
  },
  "patch_diff": {
    "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c": [
      "File: ext/intl/grapheme/grapheme_string.c -> ext/intl/grapheme/grapheme_string.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "112:  int haystack_len, needle_len;",
      "113:  unsigned char *found;",
      "114:  long loffset = 0;",
      "116:  int ret_pos;",
      "118:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"ss|l\", (char **)&haystack, &haystack_len, (char **)&needle, &needle_len, &loffset) == FAILURE) {",
      "",
      "[Removed Lines]",
      "115:  int32_t offset = 0;",
      "",
      "[Added Lines]",
      "115:  int32_t offset = 0, noffset = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "134:  offset = (int32_t) loffset;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "135:  noffset = offset >= 0 ? offset : haystack_len + offset;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "152:  if (!found) {",
      "",
      "[Removed Lines]",
      "149:  found = (unsigned char *)php_memnstr((char *)haystack + offset, (char *)needle, needle_len, (char *)haystack + haystack_len);",
      "",
      "[Added Lines]",
      "150:  found = (unsigned char *)php_memnstr((char *)haystack + noffset, (char *)needle, needle_len, (char *)haystack + haystack_len);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "214:  is_ascii = ( grapheme_ascii_check(haystack, haystack_len) >= 0 );",
      "216:  if ( is_ascii ) {",
      "217:   needle_dup = (unsigned char *)estrndup((char *)needle, needle_len);",
      "218:   php_strtolower((char *)needle_dup, needle_len);",
      "219:   haystack_dup = (unsigned char *)estrndup((char *)haystack, haystack_len);",
      "220:   php_strtolower((char *)haystack_dup, haystack_len);",
      "224:   efree(haystack_dup);",
      "225:   efree(needle_dup);",
      "",
      "[Removed Lines]",
      "222:   found = (unsigned char*) php_memnstr((char *)haystack_dup + offset, (char *)needle_dup, needle_len, (char *)haystack_dup + haystack_len);",
      "",
      "[Added Lines]",
      "218:   int32_t noffset = offset >= 0 ? offset : haystack_len + offset;",
      "224:   found = (unsigned char*) php_memnstr((char *)haystack_dup + noffset, (char *)needle_dup, needle_len, (char *)haystack_dup + haystack_len);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "537:    efree(ustr);",
      "538:   }",
      "539:   ubrk_close(bi);",
      "541:  }",
      "",
      "[Removed Lines]",
      "540:   RETURN_EMPTY_STRING();",
      "",
      "[Added Lines]",
      "542:   RETURN_EMPTY_STRING();",
      "",
      "---------------"
    ],
    "ext/intl/tests/bug72061.phpt||ext/intl/tests/bug72061.phpt": [
      "File: ext/intl/tests/bug72061.phpt -> ext/intl/tests/bug72061.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72061: Out-of-bounds reads in zif_grapheme_stripos with negative offset",
      "3: --SKIPIF--",
      "4: <?php if( !extension_loaded( 'intl' ) ) print 'skip'; ?>",
      "5: --FILE--",
      "6: <?php",
      "8: var_dump(grapheme_stripos(str_repeat(\"ABCD\", 16384), \"A\", -201));",
      "9: var_dump(grapheme_strpos(str_repeat(\"ABCD\", 16384), \"A\", -201));",
      "10: ?>",
      "11: DONE",
      "12: --EXPECT--",
      "13: int(65336)",
      "14: int(65336)",
      "15: DONE",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8c44d07fd485a8e8d62bc6e4fe14bec5493ebc58",
      "candidate_info": {
        "commit_hash": "8c44d07fd485a8e8d62bc6e4fe14bec5493ebc58",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/8c44d07fd485a8e8d62bc6e4fe14bec5493ebc58",
        "files": [
          "ext/intl/grapheme/grapheme_string.c"
        ],
        "message": "Fix bug #73634 - grapheme_strpos illegal memory access",
        "before_after_code_files": [
          "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c"
          ],
          "candidate": [
            "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c": [
          "File: ext/intl/grapheme/grapheme_string.c -> ext/intl/grapheme/grapheme_string.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "110:  size_t haystack_len, needle_len;",
          "111:  const char *found;",
          "112:  zend_long loffset = 0;",
          "114:  zend_long ret_pos;",
          "116:  if (zend_parse_parameters(ZEND_NUM_ARGS(), \"ss|l\", &haystack, &haystack_len, &needle, &needle_len, &loffset) == FAILURE) {",
          "",
          "[Removed Lines]",
          "113:  int32_t offset = 0, noffset = 0;",
          "",
          "[Added Lines]",
          "113:  int32_t offset = 0;",
          "114:  size_t noffset = 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "16d0b9c836b793f9338c5a6296fba1b272bbae06",
      "candidate_info": {
        "commit_hash": "16d0b9c836b793f9338c5a6296fba1b272bbae06",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/16d0b9c836b793f9338c5a6296fba1b272bbae06",
        "files": [
          "ext/intl/grapheme/grapheme_string.c",
          "ext/intl/tests/bug72061.phpt"
        ],
        "message": "Fix bug #72061 - Out-of-bounds reads in zif_grapheme_stripos with negative offset",
        "before_after_code_files": [
          "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c",
          "ext/intl/tests/bug72061.phpt||ext/intl/tests/bug72061.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c",
            "ext/intl/tests/bug72061.phpt||ext/intl/tests/bug72061.phpt"
          ],
          "candidate": [
            "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c",
            "ext/intl/tests/bug72061.phpt||ext/intl/tests/bug72061.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c": [
          "File: ext/intl/grapheme/grapheme_string.c -> ext/intl/grapheme/grapheme_string.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "112:  int haystack_len, needle_len;",
          "113:  unsigned char *found;",
          "114:  long loffset = 0;",
          "116:  int ret_pos;",
          "118:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"ss|l\", (char **)&haystack, &haystack_len, (char **)&needle, &needle_len, &loffset) == FAILURE) {",
          "",
          "[Removed Lines]",
          "115:  int32_t offset = 0;",
          "",
          "[Added Lines]",
          "115:  int32_t offset = 0, noffset = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "134:  offset = (int32_t) loffset;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "135:  noffset = offset >= 0 ? offset : haystack_len + offset;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "152:  if (!found) {",
          "",
          "[Removed Lines]",
          "149:  found = (unsigned char *)php_memnstr((char *)haystack + offset, (char *)needle, needle_len, (char *)haystack + haystack_len);",
          "",
          "[Added Lines]",
          "150:  found = (unsigned char *)php_memnstr((char *)haystack + noffset, (char *)needle, needle_len, (char *)haystack + haystack_len);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "214:  is_ascii = ( grapheme_ascii_check(haystack, haystack_len) >= 0 );",
          "216:  if ( is_ascii ) {",
          "217:   needle_dup = (unsigned char *)estrndup((char *)needle, needle_len);",
          "218:   php_strtolower((char *)needle_dup, needle_len);",
          "219:   haystack_dup = (unsigned char *)estrndup((char *)haystack, haystack_len);",
          "220:   php_strtolower((char *)haystack_dup, haystack_len);",
          "224:   efree(haystack_dup);",
          "225:   efree(needle_dup);",
          "",
          "[Removed Lines]",
          "222:   found = (unsigned char*) php_memnstr((char *)haystack_dup + offset, (char *)needle_dup, needle_len, (char *)haystack_dup + haystack_len);",
          "",
          "[Added Lines]",
          "218:   int32_t noffset = offset >= 0 ? offset : haystack_len + offset;",
          "224:   found = (unsigned char*) php_memnstr((char *)haystack_dup + noffset, (char *)needle_dup, needle_len, (char *)haystack_dup + haystack_len);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "537:    efree(ustr);",
          "538:   }",
          "539:   ubrk_close(bi);",
          "541:  }",
          "",
          "[Removed Lines]",
          "540:   RETURN_EMPTY_STRING();",
          "",
          "[Added Lines]",
          "542:   RETURN_EMPTY_STRING();",
          "",
          "---------------"
        ],
        "ext/intl/tests/bug72061.phpt||ext/intl/tests/bug72061.phpt": [
          "File: ext/intl/tests/bug72061.phpt -> ext/intl/tests/bug72061.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72061: Out-of-bounds reads in zif_grapheme_stripos with negative offset",
          "3: --SKIPIF--",
          "4: <?php if( !extension_loaded( 'intl' ) ) print 'skip'; ?>",
          "5: --FILE--",
          "6: <?php",
          "8: var_dump(grapheme_stripos(str_repeat(\"ABCD\", 16384), \"A\", -201));",
          "9: var_dump(grapheme_strpos(str_repeat(\"ABCD\", 16384), \"A\", -201));",
          "10: ?>",
          "11: DONE",
          "12: --EXPECT--",
          "13: int(65336)",
          "14: int(65336)",
          "15: DONE",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4c0d91caef05aa122e0bec1b177237ea252ff27b",
      "candidate_info": {
        "commit_hash": "4c0d91caef05aa122e0bec1b177237ea252ff27b",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/4c0d91caef05aa122e0bec1b177237ea252ff27b",
        "files": [
          "ext/bcmath/bcmath.c",
          "ext/bcmath/tests/bug72093.phpt",
          "ext/exif/exif.c",
          "ext/exif/tests/bug72094.phpt",
          "ext/exif/tests/bug72094_1.jpg",
          "ext/exif/tests/bug72094_2.jpg",
          "ext/exif/tests/bug72094_3.jpg",
          "ext/exif/tests/bug72094_4.jpg",
          "ext/gd/libgd/gd_gd2.c",
          "ext/gd/tests/bug71912.phpt",
          "ext/gd/tests/invalid_neg_size.gd2",
          "ext/intl/grapheme/grapheme_string.c",
          "ext/intl/tests/bug72061.phpt",
          "ext/xml/tests/bug72099.phpt",
          "ext/xml/xml.c"
        ],
        "message": "Merge branch 'PHP-5.6' into PHP-7.0\n\n* PHP-5.6:\n  Fix memory leak\n  Fix bug #72099: xml_parse_into_struct segmentation fault\n  5.5.36 now\n  Fix bug #72094 - Out of bounds heap read access in exif header processing\n  Fix bug #72093: bcpowmod accepts negative scale and corrupts _one_ definition\n  Fix bug #72061 - Out-of-bounds reads in zif_grapheme_stripos with negative offset\n  Fix for bug #71912 (libgd: signedness vulnerability)\n  Typo in NEWS",
        "before_after_code_files": [
          "ext/bcmath/bcmath.c||ext/bcmath/bcmath.c",
          "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt",
          "ext/exif/exif.c||ext/exif/exif.c",
          "ext/exif/tests/bug72094.phpt||ext/exif/tests/bug72094.phpt",
          "ext/gd/libgd/gd_gd2.c||ext/gd/libgd/gd_gd2.c",
          "ext/gd/tests/bug71912.phpt||ext/gd/tests/bug71912.phpt",
          "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c",
          "ext/intl/tests/bug72061.phpt||ext/intl/tests/bug72061.phpt",
          "ext/xml/tests/bug72099.phpt||ext/xml/tests/bug72099.phpt",
          "ext/xml/xml.c||ext/xml/xml.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c",
            "ext/intl/tests/bug72061.phpt||ext/intl/tests/bug72061.phpt"
          ],
          "candidate": [
            "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c",
            "ext/intl/tests/bug72061.phpt||ext/intl/tests/bug72061.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/bcmath/bcmath.c||ext/bcmath/bcmath.c": [
          "File: ext/bcmath/bcmath.c -> ext/bcmath/bcmath.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "207: }",
          "212: PHP_FUNCTION(bcadd)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "212: static bc_num split_bc_num(bc_num num) {",
          "213:  bc_num newnum;",
          "214:  if (num->n_refs >= 1) {",
          "215:   return num;",
          "216:  }",
          "217:  newnum = _bc_new_num_ex(0, 0, 0);",
          "219:  newnum->n_refs = 1;",
          "220:  num->n_refs--;",
          "221:  return newnum;",
          "222: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "233:  bc_add (first, second, &result, scale);",
          "235:  if (result->n_scale > scale) {",
          "236:   result->n_scale = scale;",
          "237:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "251:   result = split_bc_num(result);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "270:  bc_sub (first, second, &result, scale);",
          "272:  if (result->n_scale > scale) {",
          "273:   result->n_scale = scale;",
          "274:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "289:   result = split_bc_num(result);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "307:  bc_multiply (first, second, &result, scale);",
          "309:  if (result->n_scale > scale) {",
          "310:   result->n_scale = scale;",
          "311:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "327:   result = split_bc_num(result);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "345:  switch (bc_divide(first, second, &result, scale)) {",
          "347:    if (result->n_scale > scale) {",
          "348:     result->n_scale = scale;",
          "349:    }",
          "350:    RETVAL_STR(bc_num2str(result));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "366:     result = split_bc_num(result);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "462:  bc_raise (first, second, &result, scale);",
          "464:  if (result->n_scale > scale) {",
          "465:   result->n_scale = scale;",
          "466:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "484:   result = split_bc_num(result);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "497:  if (bc_sqrt (&result, scale) != 0) {",
          "498:   if (result->n_scale > scale) {",
          "499:    result->n_scale = scale;",
          "500:   }",
          "501:   RETVAL_STR(bc_num2str(result));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "519:    result = split_bc_num(result);",
          "",
          "---------------"
        ],
        "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt": [
          "File: ext/bcmath/tests/bug72093.phpt -> ext/bcmath/tests/bug72093.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug 72093: bcpowmod accepts negative scale and corrupts _one_ definition",
          "3: --SKIPIF--",
          "4: <?php if(!extension_loaded(\"bcmath\")) print \"skip\"; ?>",
          "5: --FILE--",
          "6: <?php",
          "7: var_dump(bcpowmod(1, \"A\", 128, -200));",
          "8: var_dump(bcpowmod(1, 1.2, 1, 1));",
          "9: ?>",
          "10: --EXPECTF--",
          "11: string(1) \"1\"",
          "12: bc math warning: non-zero scale in exponent",
          "13: string(3) \"0.0\"",
          "",
          "---------------"
        ],
        "ext/exif/exif.c||ext/exif/exif.c": [
          "File: ext/exif/exif.c -> ext/exif/exif.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2947:       ImageInfo->CopyrightPhotographer  = estrdup(value_ptr);",
          "2948:       ImageInfo->CopyrightEditor        = estrndup(value_ptr+length+1, byte_count-length-1);",
          "",
          "[Removed Lines]",
          "2949:       spprintf(&ImageInfo->Copyright, 0, \"%s, %s\", value_ptr, value_ptr+length+1);",
          "",
          "[Added Lines]",
          "2949:       spprintf(&ImageInfo->Copyright, 0, \"%s, %s\", ImageInfo->CopyrightPhotographer, ImageInfo->CopyrightEditor);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3116:  ImageInfo->sections_found |= FOUND_IFD0;",
          "3118:  NumDirEntries = php_ifd_get16u(dir_start, ImageInfo->motorola_intel);",
          "3120:  if ((dir_start+2+NumDirEntries*12) > (offset_base+IFDlength)) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3118:  if ((dir_start + 2) >= (offset_base+IFDlength)) {",
          "3119:   exif_error_docref(\"exif_read_data#error_ifd\" EXIFERR_CC, ImageInfo, E_WARNING, \"Illegal IFD size\");",
          "3120:   return FALSE;",
          "3121:  }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3141:  NextDirOffset = php_ifd_get32u(dir_start+2+12*de, ImageInfo->motorola_intel);",
          "3142:  if (NextDirOffset) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3146:  if ((dir_start+2+12*de + 4) >= (offset_base+IFDlength)) {",
          "3147:   exif_error_docref(\"exif_read_data#error_ifd\" EXIFERR_CC, ImageInfo, E_WARNING, \"Illegal IFD size\");",
          "3148:   return FALSE;",
          "3149:  }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3187:  }",
          "3190:  exif_value_2a = php_ifd_get16u(CharBuf+2, ImageInfo->motorola_intel);",
          "3191:  offset_of_ifd = php_ifd_get32u(CharBuf+4, ImageInfo->motorola_intel);",
          "3193:   exif_error_docref(NULL EXIFERR_CC, ImageInfo, E_WARNING, \"Invalid TIFF start (1)\");",
          "3194:   return;",
          "3195:  }",
          "",
          "[Removed Lines]",
          "3192:  if ( exif_value_2a != 0x2a || offset_of_ifd < 0x08) {",
          "",
          "[Added Lines]",
          "3199:  if (length < 8) {",
          "3200:   exif_error_docref(NULL EXIFERR_CC, ImageInfo, E_WARNING, \"Invalid TIFF start (1)\");",
          "3201:   return;",
          "3202:  }",
          "3205:  if (exif_value_2a != 0x2a || offset_of_ifd < 0x08) {",
          "",
          "---------------"
        ],
        "ext/exif/tests/bug72094.phpt||ext/exif/tests/bug72094.phpt": [
          "File: ext/exif/tests/bug72094.phpt -> ext/exif/tests/bug72094.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72094: Out of bounds heap read access in exif header processing",
          "3: --SKIPIF--",
          "4: <?php if (!extension_loaded('exif')) print 'skip exif extension not available';?>",
          "5: --FILE--",
          "6: <?php",
          "7: print_r(exif_read_data(__DIR__ . '/bug72094_1.jpg'));",
          "8: print_r(exif_read_data(__DIR__ . '/bug72094_2.jpg'));",
          "9: print_r(exif_read_data(__DIR__ . '/bug72094_3.jpg'));",
          "10: print_r(exif_read_data(__DIR__ . '/bug72094_4.jpg'));",
          "11: ?>",
          "12: DONE",
          "13: --EXPECTF--",
          "14: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "16: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "18: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "20: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "22: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "24: Warning: exif_read_data(bug72094_1.jpg): Process tag(x8298=Copyright  ): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "26: Warning: exif_read_data(bug72094_1.jpg): Illegal IFD offset in %s/bug72094.php on line %d",
          "28: Warning: exif_read_data(bug72094_1.jpg): File structure corrupted in %s/bug72094.php on line %d",
          "30: Warning: exif_read_data(bug72094_1.jpg): Invalid JPEG file in %s/bug72094.php on line %d",
          "32: Warning: exif_read_data(bug72094_2.jpg): Illegal IFD size in %s/bug72094.php on line %d",
          "34: Warning: exif_read_data(bug72094_2.jpg): File structure corrupted in %s/bug72094.php on line %d",
          "36: Warning: exif_read_data(bug72094_2.jpg): Invalid JPEG file in %s/bug72094.php on line %d",
          "38: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "40: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "42: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "44: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "46: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "48: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "50: Warning: exif_read_data(bug72094_3.jpg): Illegal IFD size in %s/bug72094.php on line %d",
          "52: Warning: exif_read_data(bug72094_3.jpg): File structure corrupted in %s/bug72094.php on line %d",
          "54: Warning: exif_read_data(bug72094_3.jpg): Invalid JPEG file in %s/bug72094.php on line %d",
          "56: Warning: exif_read_data(bug72094_4.jpg): Invalid TIFF start (1) in %s/bug72094.php on line %d",
          "58: Warning: exif_read_data(bug72094_4.jpg): File structure corrupted in %s/bug72094.php on line %d",
          "60: Warning: exif_read_data(bug72094_4.jpg): Invalid JPEG file in %s/bug72094.php on line %d",
          "61: DONE",
          "",
          "---------------"
        ],
        "ext/gd/libgd/gd_gd2.c||ext/gd/libgd/gd_gd2.c": [
          "File: ext/gd/libgd/gd_gd2.c -> ext/gd/libgd/gd_gd2.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "145:   cidx = gdCalloc(sidx, 1);",
          "146:   for (i = 0; i < nc; i++) {",
          "147:    if (gdGetInt(&cidx[i].offset, in) != 1) {",
          "148:     goto fail1;",
          "149:    }",
          "150:    if (gdGetInt(&cidx[i].size, in) != 1) {",
          "151:     goto fail1;",
          "152:    }",
          "153:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "148:     gdFree(cidx);",
          "152:     gdFree(cidx);",
          "153:     goto fail1;",
          "154:    }",
          "155:    if (cidx[i].offset < 0 || cidx[i].size < 0) {",
          "156:     gdFree(cidx);",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug71912.phpt||ext/gd/tests/bug71912.phpt": [
          "File: ext/gd/tests/bug71912.phpt -> ext/gd/tests/bug71912.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #71912 (libgd: signedness vulnerability)",
          "3: --SKIPIF--",
          "4: <?php",
          "5:         if(!extension_loaded('gd')){ die('skip gd extension not available'); }",
          "6:         if(!function_exists('imagecreatefromgd2')) die('skip imagecreatefromgd2() not available');",
          "7: ?>",
          "8: --FILE--",
          "9: <?php",
          "10: imagecreatefromgd2(__DIR__.\"/invalid_neg_size.gd2\");",
          "11: ?>",
          "12: OK",
          "13: --EXPECTF--",
          "15: Warning: imagecreatefromgd2(): '%s/invalid_neg_size.gd2' is not a valid GD2 file in %s/bug71912.php on line %d",
          "16: OK",
          "",
          "---------------"
        ],
        "ext/intl/grapheme/grapheme_string.c||ext/intl/grapheme/grapheme_string.c": [
          "File: ext/intl/grapheme/grapheme_string.c -> ext/intl/grapheme/grapheme_string.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "110:  size_t haystack_len, needle_len;",
          "111:  const char *found;",
          "112:  zend_long loffset = 0;",
          "114:  zend_long ret_pos;",
          "116:  if (zend_parse_parameters(ZEND_NUM_ARGS(), \"ss|l\", &haystack, &haystack_len, &needle, &needle_len, &loffset) == FAILURE) {",
          "",
          "[Removed Lines]",
          "113:  int32_t offset = 0;",
          "",
          "[Added Lines]",
          "113:  int32_t offset = 0, noffset = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "128:  offset = (int32_t) loffset;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "129:  noffset = offset >= 0 ? offset : haystack_len + offset;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "144:  if (!found) {",
          "",
          "[Removed Lines]",
          "141:  found = php_memnstr(haystack + offset, needle, needle_len, haystack + haystack_len);",
          "",
          "[Added Lines]",
          "142:  found = php_memnstr(haystack + noffset, needle, needle_len, haystack + haystack_len);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "199:  is_ascii = ( grapheme_ascii_check((unsigned char*)haystack, haystack_len) >= 0 );",
          "201:  if ( is_ascii ) {",
          "202:   needle_dup = estrndup(needle, needle_len);",
          "203:   php_strtolower(needle_dup, needle_len);",
          "204:   haystack_dup = estrndup(haystack, haystack_len);",
          "205:   php_strtolower(haystack_dup, haystack_len);",
          "209:   efree(haystack_dup);",
          "210:   efree(needle_dup);",
          "",
          "[Removed Lines]",
          "207:   found = php_memnstr(haystack_dup + offset, needle_dup, needle_len, haystack_dup + haystack_len);",
          "",
          "[Added Lines]",
          "203:   int32_t noffset = offset >= 0 ? offset : haystack_len + offset;",
          "209:   found = php_memnstr(haystack_dup + noffset, needle_dup, needle_len, haystack_dup + haystack_len);",
          "",
          "---------------"
        ],
        "ext/intl/tests/bug72061.phpt||ext/intl/tests/bug72061.phpt": [
          "File: ext/intl/tests/bug72061.phpt -> ext/intl/tests/bug72061.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72061: Out-of-bounds reads in zif_grapheme_stripos with negative offset",
          "3: --SKIPIF--",
          "4: <?php if( !extension_loaded( 'intl' ) ) print 'skip'; ?>",
          "5: --FILE--",
          "6: <?php",
          "8: var_dump(grapheme_stripos(str_repeat(\"ABCD\", 16384), \"A\", -201));",
          "9: var_dump(grapheme_strpos(str_repeat(\"ABCD\", 16384), \"A\", -201));",
          "10: ?>",
          "11: DONE",
          "12: --EXPECT--",
          "13: int(65336)",
          "14: int(65336)",
          "15: DONE",
          "",
          "---------------"
        ],
        "ext/xml/tests/bug72099.phpt||ext/xml/tests/bug72099.phpt": [
          "File: ext/xml/tests/bug72099.phpt -> ext/xml/tests/bug72099.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72099: xml_parse_into_struct segmentation fault",
          "3: --SKIPIF--",
          "4: <?php",
          "5: require_once(\"skipif.inc\");",
          "6: ?>",
          "7: --FILE--",
          "8: <?php",
          "9: $var1=xml_parser_create_ns();",
          "10: $var2=str_repeat(\"a\", 10);",
          "11: $var3=[];",
          "12: $var4=[];",
          "13: xml_parse_into_struct($var1, $var2, $var3, $var4);",
          "14: var_dump($var3);",
          "15: --EXPECT--",
          "16: array(0) {",
          "17: }",
          "",
          "---------------"
        ],
        "ext/xml/xml.c||ext/xml/xml.c": [
          "File: ext/xml/xml.c -> ext/xml/xml.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "286: static XML_Memory_Handling_Suite php_xml_mem_hdlrs;",
          "",
          "[Removed Lines]",
          "289: static int le_xml_parser;",
          "",
          "[Added Lines]",
          "289: static int le_xml_parser;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "920:       break;",
          "921:      } ZEND_HASH_FOREACH_END();",
          "924:       array_init(&tag);",
          "926:       _xml_add_to_info(parser,parser->ltags[parser->level-1] + parser->toffset);",
          "",
          "[Removed Lines]",
          "923:      if (parser->level <= XML_MAXLEVEL) {",
          "",
          "[Added Lines]",
          "923:      if (parser->level <= XML_MAXLEVEL && parser->level > 0) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "982:            const XML_Char *base,",
          "983:            const XML_Char *systemId,",
          "984:            const XML_Char *publicId,",
          "",
          "[Removed Lines]",
          "980: void _xml_unparsedEntityDeclHandler(void *userData,",
          "981:            const XML_Char *entityName,",
          "",
          "[Added Lines]",
          "980: void _xml_unparsedEntityDeclHandler(void *userData,",
          "981:            const XML_Char *entityName,",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1146: }",
          "1151: PHP_FUNCTION(xml_parser_create)",
          "1152: {",
          "1154: }",
          "1159: PHP_FUNCTION(xml_parser_create_ns)",
          "1160: {",
          "",
          "[Removed Lines]",
          "1153:  php_xml_parser_create_impl(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);",
          "",
          "[Added Lines]",
          "1153:  php_xml_parser_create_impl(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1190:  ZVAL_COPY(&parser->object, mythis);",
          "",
          "[Removed Lines]",
          "1187:  zval_add_ref(&parser->object);",
          "",
          "[Added Lines]",
          "1187:  zval_add_ref(&parser->object);",
          "",
          "---------------"
        ]
      }
    }
  ]
}