{
  "cve_id": "CVE-2017-12643",
  "cve_desc": "ImageMagick 7.0.6-1 has a memory exhaustion vulnerability in ReadOneJNGImage in coders\\png.c.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "d9ccd8227c4c88a907cda5278408b73552cb0c07",
  "patch_info": {
    "commit_hash": "d9ccd8227c4c88a907cda5278408b73552cb0c07",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/d9ccd8227c4c88a907cda5278408b73552cb0c07",
    "files": [
      "coders/png.c"
    ],
    "message": "https://github.com/ImageMagick/ImageMagick/issues/549",
    "before_after_code_files": [
      "coders/png.c||coders/png.c"
    ]
  },
  "patch_diff": {
    "coders/png.c||coders/png.c": [
      "File: coders/png.c -> coders/png.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "4384:         type[0],type[1],type[2],type[3],(double) length);",
      "4386:     if (length > PNG_UINT_31_MAX || count == 0)",
      "4387:       ThrowReaderException(CorruptImageError,\"CorruptImage\");",
      "4389:     p=NULL;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4387:       ThrowReaderException(CorruptImageError,\"CorruptImage\");",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "5260:           }",
      "5262:         if (count == 0)",
      "5263:           ThrowReaderException(CorruptImageError,\"CorruptImage\");",
      "5265:         p=NULL;",
      "5266:         chunk=(unsigned char *) NULL;",
      "5269:           {",
      "5270:             chunk=(unsigned char *) AcquireQuantumMemory(length+",
      "5271:              MagickPathExtent,sizeof(*chunk));",
      "",
      "[Removed Lines]",
      "5268:         if (length != 0)",
      "",
      "[Added Lines]",
      "5265:           ThrowReaderException(CorruptImageError,\"CorruptImage\");",
      "5267:         p=NULL;",
      "5272:             if (length > GetBlobSize(image))",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "280e5924d3c97c916819fbfb4f7c5027dcbc20f8",
      "candidate_info": {
        "commit_hash": "280e5924d3c97c916819fbfb4f7c5027dcbc20f8",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/280e5924d3c97c916819fbfb4f7c5027dcbc20f8",
        "files": [
          "coders/png.c"
        ],
        "message": "Temporary over-allocation until Glenn applies a proper fix:   https://github.com/ImageMagick/ImageMagick/issues/538   https://github.com/ImageMagick/ImageMagick/issues/540   https://github.com/ImageMagick/ImageMagick/issues/541",
        "before_after_code_files": [
          "coders/png.c||coders/png.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/png.c||coders/png.c"
          ],
          "candidate": [
            "coders/png.c||coders/png.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/png.c||coders/png.c": [
          "File: coders/png.c -> coders/png.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4384:         type[0],type[1],type[2],type[3],(double) length);",
          "4386:     if (length > PNG_UINT_31_MAX || count == 0)",
          "4389:     p=NULL;",
          "4390:     chunk=(unsigned char *) NULL;",
          "",
          "[Removed Lines]",
          "4387:       ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "",
          "[Added Lines]",
          "4387:       ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "5259:           }",
          "5261:         if (count == 0)",
          "5264:         p=NULL;",
          "5265:         chunk=(unsigned char *) NULL;",
          "",
          "[Removed Lines]",
          "5262:           ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "",
          "[Added Lines]",
          "5263:           ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1c79788fb05b29478f6aa53f6ca518eb9197c8f5",
      "candidate_info": {
        "commit_hash": "1c79788fb05b29478f6aa53f6ca518eb9197c8f5",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/1c79788fb05b29478f6aa53f6ca518eb9197c8f5",
        "files": [
          "coders/png.c"
        ],
        "message": "Folded long lines in coders/png.c",
        "before_after_code_files": [
          "coders/png.c||coders/png.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/png.c||coders/png.c"
          ],
          "candidate": [
            "coders/png.c||coders/png.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/png.c||coders/png.c": [
          "File: coders/png.c -> coders/png.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "869: #define QuantumToCharToQuantumEqQuantum(quantum) \\",
          "870:   ((ScaleCharToQuantum((unsigned char) ScaleQuantumToChar(quantum))) == quantum)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "946:             (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "947:                 \"    OK to reduce PNG bit depth to 8 without loss of info\");",
          "948:           }",
          "950:           {",
          "951:             (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "952:                 \"    Not OK to reduce PNG bit depth to 8 without loss of info\");",
          "",
          "[Removed Lines]",
          "949:         else",
          "",
          "[Added Lines]",
          "949:         else",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1269: %",
          "1270: %  ReadPNGImage() reads a Portable Network Graphics (PNG) or",
          "1271: %  Multiple-image Network Graphics (MNG) image file and returns it.  It",
          "1273: %  pointer to the new image or set of images.",
          "1274: %",
          "1275: %  MNG support written by Glenn Randers-Pehrson, glennrp@image...",
          "",
          "[Removed Lines]",
          "1272: %  allocates the memory necessary for the new Image structure and returns a",
          "",
          "[Added Lines]",
          "1272: %  allocates the memory necessary for the new Image structure and returns a",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1582:   if (box.right > box2.right)",
          "1583:     box.right=box2.right;",
          "1585:   if (box.bottom > box2.bottom)",
          "1586:     box.bottom=box2.bottom;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1585:   if (box.bottom > box2.bottom)",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1866:         \" recognized eXIf|exIf chunk\");",
          "1868:       image=(Image *) png_get_user_chunk_ptr(ping);",
          "1870:       error_info=(PNGErrorInfo *) png_get_error_ptr(ping);",
          "1872:       profile=BlobToStringInfo((const void *) NULL,chunk->size+6);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1871:       error_info=(PNGErrorInfo *) png_get_error_ptr(ping);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "2204:   {",
          "2205:     (void)LogMagickEvent(CoderEvent,GetMagickModule(),",
          "2206:        \"    Before reading:\\n\"",
          "2208:        \"      image->rendering_intent=%d\\n\"",
          "2209:        \"      image->colorspace=%d\\n\"",
          "2210:        \"      image->gamma=%f\",",
          "",
          "[Removed Lines]",
          "2207:        \"      image->alpha_trait=%d\"",
          "",
          "[Added Lines]",
          "2209:        \"      image->alpha_trait=%d\"",
          "2210:        \"      image->rendering_intent=%d\\n\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "2445:      if (value != NULL)",
          "2446:         png_set_swap(ping);",
          "2451:       char",
          "2452:         msg[MagickPathExtent];",
          "",
          "[Removed Lines]",
          "2447:   }",
          "2450:   {",
          "",
          "[Added Lines]",
          "2450:   }",
          "2454:       char",
          "2455:         msg[MagickPathExtent];",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "2626:                           Magick_RenderingIntent_from_PNG_RenderingIntent(",
          "2627:                              sRGB_info[icheck].intent);",
          "2628:                         }",
          "2630:                      }",
          "2631:                    }",
          "2632:                  }",
          "",
          "[Removed Lines]",
          "2629:                         break;",
          "",
          "[Added Lines]",
          "2634:                         break;",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "2907:            bkgd_scale *= 257;",
          "2909:         ping_background->red *= bkgd_scale;",
          "2913:         if (logging != MagickFalse)",
          "2914:           {",
          "",
          "[Removed Lines]",
          "2910:         ping_background->green *= bkgd_scale;",
          "2911:         ping_background->blue *= bkgd_scale;",
          "",
          "[Added Lines]",
          "2915:         ping_background->green *= bkgd_scale;",
          "2916:         ping_background->blue *= bkgd_scale;",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "3159:       char",
          "3160:         msg[MagickPathExtent];",
          "3165:      (void) FormatLocaleString(msg,MagickPathExtent,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "3182:      else if (ping_interlace_method == 1)",
          "3183:        {",
          "3184:          (void) FormatLocaleString(msg,MagickPathExtent,\"%d (Adam7 method)\",",
          "3186:        }",
          "3187:      else",
          "3188:        {",
          "",
          "[Removed Lines]",
          "3185:             (int) ping_interlace_method);",
          "",
          "[Added Lines]",
          "3191:             (int) ping_interlace_method);",
          "3192:        }",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "3995:             (double) x_resolution,(double) y_resolution, unit_type);",
          "3996:          (void) SetImageProperty(image,\"png:pHYs\",msg,",
          "3997:                 exception);",
          "3999: #endif",
          "4001: #if defined(PNG_oFFs_SUPPORTED)",
          "",
          "[Removed Lines]",
          "3998:        }",
          "",
          "[Added Lines]",
          "4005:        }",
          "4006: #endif",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "4060:   return(image);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "4370:     if (memcmp(type,mng_JHDR,4) == 0)",
          "4371:       {",
          "4373:           {",
          "4374:             jng_width=(size_t) ((p[0] << 24) | (p[1] << 16) |",
          "4375:               (p[2] << 8) | p[3]);",
          "",
          "[Removed Lines]",
          "4372:         if (length == 16)",
          "",
          "[Added Lines]",
          "4381:         if (length == 16)",
          "4382:           {",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "4456:         if (status == MagickFalse)",
          "4457:           return((Image *) NULL);",
          "4459:         if ((image_info->ping == MagickFalse) && (jng_color_type >= 12))",
          "4460:           {",
          "4461:             alpha_image_info=(ImageInfo *)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4469:         if ((image_info->ping == MagickFalse) && (jng_color_type >= 12))",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "4925: %         *exception)",
          "4926: %",
          "4927: %  A description of each parameter follows:",
          "4929: %    o image_info: the image info.",
          "4930: %",
          "4931: %    o exception: return any errors or warnings in this structure.",
          "",
          "[Removed Lines]",
          "4928: %",
          "",
          "[Added Lines]",
          "4939: %",
          "4940: %    o image_info: the image info.",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "4949:     magic_number[MagickPathExtent];",
          "4951:   size_t",
          "4955:     Open image file.",
          "",
          "[Removed Lines]",
          "4952:     count;",
          "",
          "[Added Lines]",
          "4964:     count;",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "5013:       ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "5014:     }",
          "5017:     (void) LogMagickEvent(CoderEvent,GetMagickModule(),\"exit ReadJNGImage()\");",
          "5019:   return(image);",
          "",
          "[Removed Lines]",
          "5016:   if (logging != MagickFalse)",
          "",
          "[Added Lines]",
          "5029:   if (logging != MagickFalse)",
          "5030:     (void) LogMagickEvent(CoderEvent,GetMagickModule(),\"exit ReadJNGImage()\");",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "5117:   previous_fb.right=0;",
          "5118:   default_fb.top=0;",
          "5119:   default_fb.bottom=0;",
          "5121:   default_fb.right=0;",
          "",
          "[Removed Lines]",
          "5120:   default_fb.left=0;",
          "",
          "[Added Lines]",
          "5134:   default_fb.left=0;",
          "5135:   default_fb.right=0;",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "5223:           }",
          "5225:         if (count == 0)",
          "5228:         p=NULL;",
          "5231:         if (length != 0)",
          "5232:           {",
          "",
          "[Removed Lines]",
          "5226:           ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "5229:         chunk=(unsigned char *) NULL;",
          "",
          "[Added Lines]",
          "5241:           ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "5246:         if (length != 0)",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "5817:                 image->page.x=mng_info->clip.left;",
          "5818:                 image->page.y=mng_info->clip.top;",
          "5819:                 image->background_color=mng_background_color;",
          "5822:                 (void) SetImageBackgroundColor(image,exception);",
          "5824:                 if (logging != MagickFalse)",
          "",
          "[Removed Lines]",
          "5820:                 image->alpha_trait=UndefinedPixelTrait;",
          "5821:                 image->delay=0;",
          "",
          "[Added Lines]",
          "5837:                 image->alpha_trait=UndefinedPixelTrait;",
          "5838:                 image->delay=0;",
          "5839:                 (void) SetImageBackgroundColor(image,exception);",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "6002:                 else",
          "6003:                   {",
          "6005:                       {",
          "6006:                         mng_info->loop_count[loop_level]--;",
          "6007:                         mng_info->loop_iteration[loop_level]++;",
          "",
          "[Removed Lines]",
          "6004:                     if (mng_info->loop_active[loop_level] == 1)",
          "",
          "[Added Lines]",
          "6023:                     if (mng_info->loop_active[loop_level] == 1)",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "6724:                       magn_methy=2;",
          "6726:                     if (magn_methy == 5)",
          "6728:                   }",
          "",
          "[Removed Lines]",
          "6727:                       magn_methy=3;",
          "",
          "[Added Lines]",
          "6746:                       magn_methy=3;",
          "6747:                   }",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "6923:                 DeleteImageFromList(&image);",
          "6927:                 mng_info->image=image;",
          "",
          "[Removed Lines]",
          "6925:                 image=large_image;",
          "",
          "[Added Lines]",
          "6945:                 image=large_image;",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "6944:                     x < (ssize_t) image->columns; x++)",
          "6945:                   {",
          "6948:                     if (x == (ssize_t) (image->columns-length))",
          "6949:                       m=(ssize_t) mng_info->magn_ml;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6969:                     if (x == (ssize_t) (image->columns-length))",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "7025:                               }",
          "7026:                             }",
          "7027:                         }",
          "7032:                           if (i <= ((m+1) << 1))",
          "7033:                           {",
          "",
          "[Removed Lines]",
          "7030:                         {",
          "",
          "[Added Lines]",
          "7054:                           if (i <= ((m+1) << 1))",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "7064:                     break;",
          "7065:                 }",
          "7066: #if (MAGICKCORE_QUANTUM_DEPTH > 16)",
          "7068:                 {",
          "7070:                    Rescale pixels to Quantum",
          "",
          "[Removed Lines]",
          "7067:               if (magn_methx != 1 || magn_methy != 1)",
          "",
          "[Added Lines]",
          "7091:               if (magn_methx != 1 || magn_methy != 1)",
          "7092:                 {",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "7361:       (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "7362:         \"  Before coalesce:\");",
          "7365:         \"    scene 0 delay=%.20g\",(double) image->delay);",
          "7367:       while (GetNextImageInList(image) != (Image *) NULL)",
          "",
          "[Removed Lines]",
          "7364:       (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "",
          "[Added Lines]",
          "7389:       (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "7390:         \"    scene 0 delay=%.20g\",(double) image->delay);",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "7377:   if (insert_layers)",
          "7378:     {",
          "7379:       Image",
          "7383:       size_t",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "7454:   image=GetFirstImageInList(image);",
          "7455:   MngInfoFreeStruct(mng_info,&have_mng_structure);",
          "7456:   have_mng_structure=MagickFalse;",
          "7458:   if (logging != MagickFalse)",
          "7459:     (void) LogMagickEvent(CoderEvent,GetMagickModule(),\"exit ReadMNGImage()\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7485:   if (logging != MagickFalse)",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "7465: {",
          "7466:   printf(\"Your PNG library is too old: You have libpng-%s\\n\",",
          "7467:      PNG_LIBPNG_VER_STRING);",
          "7469:   (void) ThrowMagickException(exception,GetMagickModule(),CoderError,",
          "7470:     \"PNG library is too old\",\"`%s'\",image_info->filename);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7497:   (void) ThrowMagickException(exception,GetMagickModule(),CoderError,",
          "",
          "---------------",
          "--- Hunk 32 ---",
          "[Context before]",
          "7527:     {",
          "7529:       \"format.\"",
          "7530:     };",
          "",
          "[Removed Lines]",
          "7528:       \"See http://www.libpng.org/pub/mng/ for details about the MNG\\n\"",
          "",
          "[Added Lines]",
          "7557:       \"See http://www.libpng.org/pub/mng/ for details about the MNG\\n\"",
          "7558:       \"format.\"",
          "",
          "---------------",
          "--- Hunk 33 ---",
          "[Context before]",
          "8343:                           image->rendering_intent=",
          "8344:                           Magick_RenderingIntent_from_PNG_RenderingIntent(",
          "8345:                              sRGB_info[icheck].intent);",
          "8347:                         ping_exclude_iCCP = MagickTrue;",
          "8348:                         ping_exclude_zCCP = MagickTrue;",
          "8349:                         ping_have_sRGB = MagickTrue;",
          "",
          "[Removed Lines]",
          "8346:                         }",
          "",
          "[Added Lines]",
          "8376:                         }",
          "",
          "---------------",
          "--- Hunk 34 ---",
          "[Context before]",
          "8534:   if (image->depth > 8)",
          "8535:       image->depth=16;",
          "8538: #if (MAGICKCORE_QUANTUM_DEPTH > 8)",
          "8539:   if (image->depth > 8)",
          "",
          "[Removed Lines]",
          "8536: #endif",
          "",
          "[Added Lines]",
          "8566: #endif",
          "",
          "---------------",
          "--- Hunk 35 ---",
          "[Context before]",
          "9461:            else",
          "9462:              (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "9463:                  \"   Cheap transparency is possible.\");",
          "9465:      }",
          "9466:   else",
          "9467:     ping_have_cheap_transparency = MagickFalse;",
          "",
          "[Removed Lines]",
          "9464:          }",
          "",
          "[Added Lines]",
          "9495:          }",
          "9496:      }",
          "",
          "---------------",
          "--- Hunk 36 ---",
          "[Context before]",
          "9920:       if (ping_bit_depth < 8)",
          "9921:         {",
          "9923:               ping_color_type == PNG_COLOR_TYPE_RGB ||",
          "9924:               ping_color_type == PNG_COLOR_TYPE_RGB_ALPHA)",
          "9925:             ping_bit_depth=8;",
          "",
          "[Removed Lines]",
          "9922:           if (ping_color_type == PNG_COLOR_TYPE_GRAY_ALPHA ||",
          "",
          "[Added Lines]",
          "9954:           if (ping_color_type == PNG_COLOR_TYPE_GRAY_ALPHA ||",
          "9955:               ping_color_type == PNG_COLOR_TYPE_RGB ||",
          "",
          "---------------",
          "--- Hunk 37 ---",
          "[Context before]",
          "10188:         if (image_depth <= 8)",
          "10189:           {",
          "10191:               Set image palette.",
          "10193:             ping_color_type=(png_byte) PNG_COLOR_TYPE_PALETTE;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10224:               Set image palette.",
          "",
          "---------------",
          "--- Hunk 38 ---",
          "[Context before]",
          "11253:                 {",
          "11254:                   if (logging != MagickFalse)",
          "11255:                     (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "11258:                   SetQuantumDepth(image,quantum_info,8);",
          "11259:                   image_depth=8;",
          "",
          "[Removed Lines]",
          "11256:                       \"  pass %d, Image Is not GRAY or GRAY_ALPHA\",pass);",
          "",
          "[Added Lines]",
          "11290:                       \"  pass %d, Image Is not GRAY or GRAY_ALPHA\",pass);",
          "",
          "---------------",
          "--- Hunk 39 ---",
          "[Context before]",
          "11981:         mng_info->write_png_colortype = 5;",
          "11983:       else if (LocaleCompare(value,\"6\") == 0)",
          "11986:       else",
          "11987:         (void) ThrowMagickException(exception,",
          "",
          "[Removed Lines]",
          "11984:         mng_info->write_png_colortype = 7;",
          "",
          "[Added Lines]",
          "12019:         mng_info->write_png_colortype = 7;",
          "",
          "---------------",
          "--- Hunk 40 ---",
          "[Context before]",
          "12557:   if (transparent != 0)",
          "12558:     {",
          "12559:       if (jng_alpha_compression_method==0)",
          "12560:         {",
          "12561:           const char",
          "12565:           status=OpenBlob(jpeg_image_info,jpeg_image,WriteBinaryBlobMode,",
          "12566:             exception);",
          "12567:           if (status == MagickFalse)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "12601:           status=OpenBlob(jpeg_image_info,jpeg_image,WriteBinaryBlobMode,",
          "",
          "---------------",
          "--- Hunk 41 ---",
          "[Context before]",
          "12585:           value=GetImageProperty(jpeg_image,\"png:bit-depth-written\",exception);",
          "12586:           if (value != (char *) NULL)",
          "12587:             jng_alpha_sample_depth= (unsigned int) value[0];",
          "12588:         }",
          "12590:         {",
          "12593:           status=OpenBlob(jpeg_image_info,jpeg_image,WriteBinaryBlobMode,",
          "12594:             exception);",
          "12596:             ThrowWriterException(ResourceLimitError,\"MemoryAllocationFailed\");",
          "",
          "[Removed Lines]",
          "12589:       else",
          "12595:           if (status == MagickFalse)",
          "",
          "[Added Lines]",
          "12625:         }",
          "12626:       else",
          "12632:           if (status == MagickFalse)",
          "12633:             ThrowWriterException(ResourceLimitError,\"MemoryAllocationFailed\");",
          "",
          "---------------",
          "--- Hunk 42 ---",
          "[Context before]",
          "13015: %      MagickBooleanType WriteJNGImage(const ImageInfo *image_info,",
          "13016: %        Image *image,ExceptionInfo *exception)",
          "13017: %",
          "13020: %    o image_info: the image info.",
          "13021: %",
          "13022: %    o image:  The image.",
          "",
          "[Removed Lines]",
          "13018: %  A description of each parameter follows:",
          "13019: %",
          "",
          "[Added Lines]",
          "13056: %  A description of each parameter follows:",
          "13057: %",
          "",
          "---------------",
          "--- Hunk 43 ---",
          "[Context before]",
          "13068:   (void) WriteBlob(image,8,(const unsigned char *) \"\\213JNG\\r\\n\\032\\n\");",
          "13070:   status=WriteOneJNGImage(mng_info,image_info,image,exception);",
          "13073:   (void) CatchImageException(image);",
          "13074:   MngInfoFreeStruct(mng_info,&have_mng_structure);",
          "13075:   if (logging != MagickFalse)",
          "",
          "[Removed Lines]",
          "13071:   (void) CloseBlob(image);",
          "",
          "[Added Lines]",
          "13109:   (void) CloseBlob(image);",
          "",
          "---------------",
          "--- Hunk 44 ---",
          "[Context before]",
          "13277:       mng_info->equal_srgbs=MagickTrue;",
          "13278:       mng_info->equal_backgrounds=MagickTrue;",
          "13279:       image_count=0;",
          "13281:     defined(PNG_MNG_FEATURES_SUPPORTED)",
          "13282:       all_images_are_gray=MagickTrue;",
          "13283:       mng_info->equal_palettes=MagickFalse;",
          "",
          "[Removed Lines]",
          "13280: #if defined(PNG_WRITE_EMPTY_PLTE_SUPPORTED) || \\",
          "",
          "[Added Lines]",
          "13318: #if defined(PNG_WRITE_EMPTY_PLTE_SUPPORTED) || \\",
          "13319:     defined(PNG_MNG_FEATURES_SUPPORTED)",
          "",
          "---------------",
          "--- Hunk 45 ---",
          "[Context before]",
          "13465:              if (need_defi || mng_info->need_fram || use_global_plte)",
          "13468:              else",
          "13500:            }",
          "13502:      (void) WriteBlob(image,32,chunk);",
          "13503:      (void) WriteBlobMSBULong(image,crc32(0,chunk,32));",
          "13504:      option=GetImageOption(image_info,\"mng:need-cacheoff\");",
          "",
          "[Removed Lines]",
          "13470:            }",
          "13472:          else",
          "13473:            {",
          "13474:              if (need_defi || mng_info->need_fram || use_global_plte)",
          "13477:              else",
          "13479:            }",
          "13480:        }",
          "13482:      else",
          "13483:        {",
          "13484:          if (need_matte)",
          "13485:            {",
          "13486:              if (need_defi || mng_info->need_fram || use_global_plte)",
          "13489:              else",
          "13491:            }",
          "13493:          else",
          "13494:            {",
          "13495:              if (need_defi || mng_info->need_fram || use_global_plte)",
          "13498:              else",
          "13501:        }",
          "",
          "[Added Lines]",
          "13509:            }",
          "",
          "---------------",
          "--- Hunk 46 ---",
          "[Context before]",
          "13951:     Relinquish resources.",
          "13954:   MngInfoFreeStruct(mng_info,&have_mng_structure);",
          "13956:   if (logging != MagickFalse)",
          "",
          "[Removed Lines]",
          "13953:   (void) CloseBlob(image);",
          "",
          "[Added Lines]",
          "13961:   (void) CloseBlob(image);",
          "13962:   MngInfoFreeStruct(mng_info,&have_mng_structure);",
          "",
          "---------------",
          "--- Hunk 47 ---",
          "[Context before]",
          "13960: }",
          "13964: {",
          "13965:   (void) image;",
          "13966:   printf(\"Your PNG library is too old: You have libpng-%s\\n\",",
          "",
          "[Removed Lines]",
          "13963: static MagickBooleanType WritePNGImage(const ImageInfo *image_info,Image *image)",
          "",
          "[Added Lines]",
          "13972:   Image *image)",
          "13973: {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6162f69576986b6e397166b9a7c4fcab2ada9ac1",
      "candidate_info": {
        "commit_hash": "6162f69576986b6e397166b9a7c4fcab2ada9ac1",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/6162f69576986b6e397166b9a7c4fcab2ada9ac1",
        "files": [
          "coders/png.c"
        ],
        "message": "Eliminate compiler syntax error",
        "before_after_code_files": [
          "coders/png.c||coders/png.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/png.c||coders/png.c"
          ],
          "candidate": [
            "coders/png.c||coders/png.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/png.c||coders/png.c": [
          "File: coders/png.c -> coders/png.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "5260:           }",
          "5262:         if (count == 0)",
          "5265:         p=NULL;",
          "5266:         chunk=(unsigned char *) NULL;",
          "",
          "[Removed Lines]",
          "5263:           ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "",
          "[Added Lines]",
          "5263:           ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "387adbe4b05a545b9f3972e862602480c850303c",
      "candidate_info": {
        "commit_hash": "387adbe4b05a545b9f3972e862602480c850303c",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/387adbe4b05a545b9f3972e862602480c850303c",
        "files": [
          "coders/png.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/618",
        "before_after_code_files": [
          "coders/png.c||coders/png.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/png.c||coders/png.c"
          ],
          "candidate": [
            "coders/png.c||coders/png.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/png.c||coders/png.c": [
          "File: coders/png.c -> coders/png.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4405:           &alpha_image,&alpha_image_info);",
          "4406:         ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "4407:       }",
          "4409:     p=NULL;",
          "4410:     chunk=(unsigned char *) NULL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4409:     p=NULL;",
          "4410:     chunk=(unsigned char *) NULL;",
          "4412:     if (length != 0)",
          "4413:       {",
          "4414:         if (length > GetBlobSize(image))",
          "4415:           {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1828667e81e53345cfb3eb46539d78757f1aa680",
      "candidate_info": {
        "commit_hash": "1828667e81e53345cfb3eb46539d78757f1aa680",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/1828667e81e53345cfb3eb46539d78757f1aa680",
        "files": [
          "ChangeLog",
          "coders/png.c"
        ],
        "message": "Fix improper use of NULL in the JNG decoder (Issue 632)",
        "before_after_code_files": [
          "coders/png.c||coders/png.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/png.c||coders/png.c"
          ],
          "candidate": [
            "coders/png.c||coders/png.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/png.c||coders/png.c": [
          "File: coders/png.c -> coders/png.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4502:         ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "4503:       }",
          "4506:     chunk=(unsigned char *) NULL;",
          "4508:     if (length != 0)",
          "",
          "[Removed Lines]",
          "4505:     p=NULL;",
          "",
          "[Added Lines]",
          "4505:     p=NULL;",
          "4506:     chunk=(unsigned char *) NULL;",
          "",
          "---------------"
        ]
      }
    }
  ]
}