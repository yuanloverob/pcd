{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2701a6bd483218acf512591b4d99ce59f5227c5d",
      "candidate_info": {
        "commit_hash": "2701a6bd483218acf512591b4d99ce59f5227c5d",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/2701a6bd483218acf512591b4d99ce59f5227c5d",
        "files": [
          "deps/v8/build/common.gypi"
        ],
        "message": "Unbreak the snapshotted build on Windows\n\nThe v8 team apparently decided that all build products should go\ninto ./build/\u00abtype\u00bb, and updated their common.gypi file to do so.\nUnfortunately v8's common.gypi is only used for some targets. All\nthe other targets would still look in the old place to find their\ntheir dependencies, which effectively broke the build.\n\nIn the long run it would be good for node to send all build\noutput to ./build too, on all platforms.",
        "before_after_code_files": [
          "deps/v8/build/common.gypi||deps/v8/build/common.gypi"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "deps/v8/build/common.gypi||deps/v8/build/common.gypi": [
          "File: deps/v8/build/common.gypi -> deps/v8/build/common.gypi",
          "--- Hunk 1 ---",
          "[Context before]",
          "239:           'WIN32',",
          "240:         ],",
          "241:         'msvs_configuration_attributes': {",
          "243:           'IntermediateDirectory': '$(OutDir)\\\\obj\\\\$(ProjectName)',",
          "244:           'CharacterSet': '1',",
          "245:         },",
          "",
          "[Removed Lines]",
          "242:           'OutputDirectory': '<(DEPTH)\\\\build\\\\$(ConfigurationName)',",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0187b657ae5c12ea98da8266c493d493566e1fc9",
      "candidate_info": {
        "commit_hash": "0187b657ae5c12ea98da8266c493d493566e1fc9",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/0187b657ae5c12ea98da8266c493d493566e1fc9",
        "files": [
          "node.gyp",
          "src/res/node.ico",
          "src/res/node.rc",
          "tools/msvs/res/node.ico",
          "tools/msvs/res/node.rc"
        ],
        "message": "Move resource files to src/res.\n\ntools/msvs/res is not an appropriate place.",
        "before_after_code_files": [
          "node.gyp||node.gyp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "node.gyp||node.gyp": [
          "File: node.gyp -> node.gyp",
          "--- Hunk 1 ---",
          "[Context before]",
          "184:         [ 'OS==\"win\"', {",
          "185:           'sources': [",
          "187:           ],",
          "188:           'defines': [",
          "189:             'FD_SETSIZE=1024',",
          "",
          "[Removed Lines]",
          "186:             'tools/msvs/res/node.rc',",
          "",
          "[Added Lines]",
          "186:             'src/res/node.rc',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d227084339315e42623434027a68d96cdf1fff23",
      "candidate_info": {
        "commit_hash": "d227084339315e42623434027a68d96cdf1fff23",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/d227084339315e42623434027a68d96cdf1fff23",
        "files": [
          "deps/uv/include/uv.h",
          "deps/uv/src/unix/error.c",
          "deps/uv/src/unix/stream.c",
          "deps/uv/src/win/error.c",
          "deps/uv/src/win/winapi.h"
        ],
        "message": "Upgrade libuv to 8409a67",
        "before_after_code_files": [
          "deps/uv/include/uv.h||deps/uv/include/uv.h",
          "deps/uv/src/unix/error.c||deps/uv/src/unix/error.c",
          "deps/uv/src/unix/stream.c||deps/uv/src/unix/stream.c",
          "deps/uv/src/win/error.c||deps/uv/src/win/error.c",
          "deps/uv/src/win/winapi.h||deps/uv/src/win/winapi.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "deps/uv/include/uv.h||deps/uv/include/uv.h": [
          "File: deps/uv/include/uv.h -> deps/uv/include/uv.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "120:   XX( 50, EPERM, \"operation not permitted\") \\",
          "121:   XX( 51, ELOOP, \"too many symbolic links encountered\") \\",
          "122:   XX( 52, EXDEV, \"cross-device link not permitted\") \\",
          "126: #define UV_ERRNO_GEN(val, name, s) UV_##name = val,",
          "",
          "[Removed Lines]",
          "123:   XX( 53, ENOTEMPTY, \"directory not empty\")",
          "",
          "[Added Lines]",
          "123:   XX( 53, ENOTEMPTY, \"directory not empty\") \\",
          "124:   XX( 54, ENOSPC, \"no space left on device\")",
          "",
          "---------------"
        ],
        "deps/uv/src/unix/error.c||deps/uv/src/unix/error.c": [
          "File: deps/uv/src/unix/error.c -> deps/uv/src/unix/error.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "90:     case EXDEV: return UV_EXDEV;",
          "91:     case EBUSY: return UV_EBUSY;",
          "92:     case ENOTEMPTY: return UV_ENOTEMPTY;",
          "93:     default: return UV_UNKNOWN;",
          "94:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "93:     case ENOSPC: return UV_ENOSPC;",
          "",
          "---------------"
        ],
        "deps/uv/src/unix/stream.c||deps/uv/src/unix/stream.c": [
          "File: deps/uv/src/unix/stream.c -> deps/uv/src/unix/stream.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "182:       } else if (errno == EMFILE) {",
          "184:         return;",
          "185:       } else {",
          "186:         uv__set_sys_error(stream->loop, errno);",
          "187:         stream->connection_cb((uv_stream_t*)stream, -1);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "185:       } else if (errno == ECONNABORTED) {",
          "187:         continue;",
          "",
          "---------------"
        ],
        "deps/uv/src/win/error.c||deps/uv/src/win/error.c": [
          "File: deps/uv/src/win/error.c -> deps/uv/src/win/error.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "104:     case WSAENETUNREACH:                    return UV_ENETUNREACH;",
          "105:     case WSAENOBUFS:                        return UV_ENOBUFS;",
          "106:     case ERROR_OUTOFMEMORY:                 return UV_ENOMEM;",
          "107:     case ERROR_NOT_CONNECTED:               return UV_ENOTCONN;",
          "108:     case WSAENOTCONN:                       return UV_ENOTCONN;",
          "109:     case ERROR_DIR_NOT_EMPTY:               return UV_ENOTEMPTY;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "107:     case ERROR_CANNOT_MAKE:                 return UV_ENOSPC;",
          "108:     case ERROR_DISK_FULL:                   return UV_ENOSPC;",
          "109:     case ERROR_EA_TABLE_FULL:               return UV_ENOSPC;",
          "110:     case ERROR_END_OF_MEDIA:                return UV_ENOSPC;",
          "111:     case ERROR_HANDLE_DISK_FULL:            return UV_ENOSPC;",
          "",
          "---------------"
        ],
        "deps/uv/src/win/winapi.h||deps/uv/src/win/winapi.h": [
          "File: deps/uv/src/win/winapi.h -> deps/uv/src/win/winapi.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "4331: #ifdef __MINGW32__",
          "4332:   typedef struct _OVERLAPPED_ENTRY {",
          "",
          "[Removed Lines]",
          "4326: #define FILE_SKIP_COMPLETION_PORT_ON_SUCCESS    0x1",
          "4327: #define FILE_SKIP_SET_EVENT_ON_HANDLE           0x2",
          "4329: #define SYMBOLIC_LINK_FLAG_DIRECTORY            0x1",
          "",
          "[Added Lines]",
          "4326: #ifndef FILE_SKIP_COMPLETION_PORT_ON_SUCCESS",
          "4327: # define FILE_SKIP_COMPLETION_PORT_ON_SUCCESS 0x1",
          "4328: #endif",
          "4330: #ifndef FILE_SKIP_SET_EVENT_ON_HANDLE",
          "4331: # define FILE_SKIP_SET_EVENT_ON_HANDLE 0x2",
          "4332: #endif",
          "4334: #ifndef SYMBOLIC_LINK_FLAG_DIRECTORY",
          "4335: # define SYMBOLIC_LINK_FLAG_DIRECTORY 0x1",
          "4336: #endif",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8c476371f5996a261d17a6d4af6c8d9bb127eff9",
      "candidate_info": {
        "commit_hash": "8c476371f5996a261d17a6d4af6c8d9bb127eff9",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/8c476371f5996a261d17a6d4af6c8d9bb127eff9",
        "files": [
          "test/simple/test-isolates.js"
        ],
        "message": "Change isolate test to demo EIO bug",
        "before_after_code_files": [
          "test/simple/test-isolates.js||test/simple/test-isolates.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/simple/test-isolates.js||test/simple/test-isolates.js": [
          "File: test/simple/test-isolates.js -> test/simple/test-isolates.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: var fs = require('fs');",
          "3: console.log(\"count: %d\", process._countIsolate());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2: var http = require('http');",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "8:   console.error(\"master\");",
          "9:   fs.stat(__dirname, function(err, stat) {",
          "15:   });",
          "16:   console.log(\"thread 1 count: %d\", process._countIsolate());",
          "17: } else {",
          "18:   console.error(\"slave\");",
          "19:   fs.stat(__dirname, function(err, stat) {",
          "25:   });",
          "26:   console.error(\"thread 2 count: %d\", process._countIsolate());",
          "27: }",
          "",
          "[Removed Lines]",
          "10:     if (err) {",
          "11:       console.error(\"thread 1 error!\");",
          "12:       throw err;",
          "13:     }",
          "14:     console.error('thread 1', stat);",
          "20:     if (err) {",
          "21:       console.error(\"thread 2 error!\");",
          "22:       throw err;",
          "23:     }",
          "24:     console.error('thread 2', stat);",
          "",
          "[Added Lines]",
          "11:     if (err) throw err;",
          "12:     console.error('thread 1', stat.mtime);",
          "15:   setTimeout(function() {",
          "16:     fs.stat(__dirname, function(err, stat) {",
          "17:       if (err) throw err;",
          "18:       console.error('thread 1', stat.mtime);",
          "19:     });",
          "20:   }, 500);",
          "26:     if (err) throw err;",
          "27:     console.error('thread 2', stat.mtime);",
          "30:   setTimeout(function() {",
          "31:     fs.stat(__dirname, function(err, stat) {",
          "32:       if (err) throw err;",
          "33:       console.error('thread 2', stat.mtime);",
          "34:     });",
          "35:   }, 500);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2726c22f0b84c08d7a4c3a2d9f63248675374089",
      "candidate_info": {
        "commit_hash": "2726c22f0b84c08d7a4c3a2d9f63248675374089",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/2726c22f0b84c08d7a4c3a2d9f63248675374089",
        "files": [
          "lib/tty.js"
        ],
        "message": "Revert \"tty: add keypress event for backwards-compat\"\n\nIn this case, backwards compatibility is not worth the API\ninconsistency.  We can just document the change.\n\nThis reverts commit b521ff3b4f8e79c5e28a1f4915d4203d8bcb0ab7.",
        "before_after_code_files": [
          "lib/tty.js||litty.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/tty.js||litty.js": [
          "File: lib/tty.js -> litty.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "49:   this.readable = true;",
          "50:   this.writable = false;",
          "51:   this.isRaw = false;",
          "54: }",
          "55: inherits(ReadStream, net.Socket);",
          "",
          "[Removed Lines]",
          "53:   require('readline').emitKeypressEvents(this);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}