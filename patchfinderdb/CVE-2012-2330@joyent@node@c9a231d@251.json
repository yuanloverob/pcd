{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "41e1b171ec644a1a5645e819cec7c8ccc0ba5f2e",
      "candidate_info": {
        "commit_hash": "41e1b171ec644a1a5645e819cec7c8ccc0ba5f2e",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/41e1b171ec644a1a5645e819cec7c8ccc0ba5f2e",
        "files": [
          "lib/stream.js"
        ],
        "message": "stream.pipe: Don't call destroy() unless it's a function",
        "before_after_code_files": [
          "lib/stream.js||listream.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/stream.js||listream.js": [
          "File: lib/stream.js -> listream.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "71:     if (didOnEnd) return;",
          "72:     didOnEnd = true;",
          "75:   }",
          "",
          "[Removed Lines]",
          "74:     dest.destroy();",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "19ecc17e6b6ed9c883a6cc939f0f3211c6dbc37c",
      "candidate_info": {
        "commit_hash": "19ecc17e6b6ed9c883a6cc939f0f3211c6dbc37c",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/19ecc17e6b6ed9c883a6cc939f0f3211c6dbc37c",
        "files": [
          "src/node.js",
          "test/simple/test-next-tick.js"
        ],
        "message": "nextTick: explicitly no-op when _exiting",
        "before_after_code_files": [
          "src/node.js||src/node.js",
          "test/simple/test-next-tick.js||test/simple/test-next-tick.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/node.js||src/node.js": [
          "File: src/node.js -> src/node.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "309:     };",
          "311:     process.nextTick = function(callback) {",
          "312:       var tock = { callback: callback };",
          "313:       if (process.domain) tock.domain = process.domain;",
          "314:       nextTickQueue.push(tock);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "314:       if (process._exiting) return;",
          "",
          "---------------"
        ],
        "test/simple/test-next-tick.js||test/simple/test-next-tick.js": [
          "File: test/simple/test-next-tick.js -> test/simple/test-next-tick.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "44:   complete++;",
          "45: });",
          "48: process.on('exit', function() {",
          "49:   assert.equal(5, complete);",
          "50: });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "49:   process.nextTick(function() {",
          "50:     throw new Error('this should not occur');",
          "51:   });",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ba055115e08b5ec46fc4350b6c3e95695a073b6f",
      "candidate_info": {
        "commit_hash": "ba055115e08b5ec46fc4350b6c3e95695a073b6f",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/ba055115e08b5ec46fc4350b6c3e95695a073b6f",
        "files": [
          "tools/msvs/msi/product.wxs"
        ],
        "message": "Windows: installer shows license agreement dialog",
        "before_after_code_files": [
          "tools/msvs/msi/product.wxs||tools/msvs/msi/product.wxs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/msvs/msi/product.wxs||tools/msvs/msi/product.wxs": [
          "File: tools/msvs/msi/product.wxs -> tools/msvs/msi/product.wxs",
          "--- Hunk 1 ---",
          "[Context before]",
          "102:       <DialogRef Id=\"ProgressDlg\" />",
          "103:       <DialogRef Id=\"ResumeDlg\" />",
          "104:       <DialogRef Id=\"UserExit\" />",
          "108:       <Publish Dialog=\"ExitDialog\" Control=\"Finish\" Event=\"EndDialog\" Value=\"Return\" Order=\"999\">1</Publish>",
          "109:       <Publish Dialog=\"VerifyReadyDlg\" Control=\"Back\" Event=\"NewDialog\" Value=\"MaintenanceTypeDlg\">1</Publish>",
          "110:       <Publish Dialog=\"MaintenanceWelcomeDlg\" Control=\"Next\" Event=\"NewDialog\" Value=\"MaintenanceTypeDlg\">1</Publish>",
          "",
          "[Removed Lines]",
          "105:       <DialogRef Id=\"WelcomeDlg\" />",
          "107:       <Publish Dialog=\"WelcomeDlg\" Control=\"Next\" Event=\"NewDialog\" Value=\"PrepareDlg\">1</Publish>",
          "",
          "[Added Lines]",
          "105:       <DialogRef Id=\"WelcomeDlg\" />",
          "106:       <DialogRef Id=\"LicenseAgreementDlg\"/>",
          "108:       <Publish Dialog=\"WelcomeDlg\" Control=\"Next\" Event=\"NewDialog\" Value=\"LicenseAgreementDlg\">1</Publish>",
          "109:       <Publish Dialog=\"LicenseAgreementDlg\" Control=\"Back\" Event=\"NewDialog\" Value=\"WelcomeDlg\">1</Publish>",
          "110:       <Publish Dialog=\"LicenseAgreementDlg\" Control=\"Next\" Event=\"NewDialog\" Value=\"PrepareDlg\">1</Publish>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "120:     <UIRef Id=\"WixUI_Common\" />",
          "121:     <WixVariable Id=\"WixUIBannerBmp\" Value=\"..\\..\\..\\doc\\thin-white-stripe.jpg\" />",
          "122:     <WixVariable Id=\"WixUIDialogBmp\" Value=\"..\\..\\..\\doc\\full-white-stripe.jpg\" />",
          "123:   </Product>",
          "125: </Wix>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "126:     <WixVariable Id=\"WixUILicenseRtf\" Value=\"$(var.sourcedir)\\LICENSE.rtf\" />",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8a411bae665aba016724df50dc76b38b9f7d3619",
      "candidate_info": {
        "commit_hash": "8a411bae665aba016724df50dc76b38b9f7d3619",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/8a411bae665aba016724df50dc76b38b9f7d3619",
        "files": [
          "tools/test.py"
        ],
        "message": "Revert \"tests: kill process group on failure\"\n\nThis reverts commit 0cebfc8ddb509fbf5f865bb660b73e96680b3f65.",
        "before_after_code_files": [
          "tools/test.py||tools/test.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/test.py||tools/test.py": [
          "File: tools/test.py -> tools/test.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1439: if __name__ == '__main__':",
          "",
          "[Removed Lines]",
          "1440:   ret = 0",
          "1441:   try:",
          "1442:     ret = Main()",
          "1443:     sys.exit(ret)",
          "1444:   finally:",
          "1445:     if ret and not utils.IsWindows():",
          "1446:       os.killpg(0, signal.SIGKILL)",
          "",
          "[Added Lines]",
          "1440:   sys.exit(Main())",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "713b9249e1e7cbc028e7e4f29ef7dd6a68e03375",
      "candidate_info": {
        "commit_hash": "713b9249e1e7cbc028e7e4f29ef7dd6a68e03375",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/713b9249e1e7cbc028e7e4f29ef7dd6a68e03375",
        "files": [
          "lib/events.js",
          "test/simple/test-event-emitter-remove-listeners.js"
        ],
        "message": "Revert \"events: don't delete the listeners array in removeListener()\"\n\nThis reverts commit 928ea564d16da47e615ddac627e0b4d4a40d8196.\n\nKeeping the original Array instance in-place essentially causes a memory leak\non EventEmitters that use an infinite number of event names (an incrementing\ncounter, for example), which isn't an unreasonable thing to want to do.\n\nFixes #3702.",
        "before_after_code_files": [
          "lib/events.js||lievents.js",
          "test/simple/test-event-emitter-remove-listeners.js||test/simple/test-event-emitter-remove-listeners.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/events.js||lievents.js": [
          "File: lib/events.js -> lievents.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "215:     if (position < 0) return this;",
          "216:     list.splice(position, 1);",
          "217:   } else if (list === listener ||",
          "218:              (list.listener && list.listener === listener))",
          "219:   {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/simple/test-event-emitter-remove-listeners.js||test/simple/test-event-emitter-remove-listeners.js": [
          "File: test/simple/test-event-emitter-remove-listeners.js -> test/simple/test-event-emitter-remove-listeners.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "42: }",
          "44: var e1 = new events.EventEmitter();",
          "46: e1.on('hello', listener1);",
          "48: e1.removeListener('hello', listener1);",
          "49: assert.deepEqual([], e1.listeners('hello'));",
          "54: var e2 = new events.EventEmitter();",
          "55: e2.on('hello', listener1);",
          "56: e2.removeListener('hello', listener2);",
          "",
          "[Removed Lines]",
          "45: var e1listeners = e1.listeners('hello');",
          "47: assert.equal(e1listeners.length, 1);",
          "52: assert.equal(e1listeners, e1.listeners('hello'));",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "59: var e3 = new events.EventEmitter();",
          "60: e3.on('hello', listener1);",
          "61: e3.on('hello', listener2);",
          "64: e3.removeListener('hello', listener1);",
          "66: assert.deepEqual([listener2], e3.listeners('hello'));",
          "",
          "[Removed Lines]",
          "62: var e3listeners = e3.listeners('hello');",
          "63: assert.equal(e3listeners.length, 2)",
          "65: assert.equal(e3listeners.length, 1)",
          "68: assert.equal(e3listeners, e3.listeners('hello'));",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}