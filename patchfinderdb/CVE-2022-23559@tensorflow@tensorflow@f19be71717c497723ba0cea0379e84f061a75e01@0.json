{
  "cve_id": "CVE-2022-23559",
  "cve_desc": "Tensorflow is an Open Source Machine Learning Framework. An attacker can craft a TFLite model that would cause an integer overflow in embedding lookup operations. Both `embedding_size` and `lookup_size` are products of values provided by the user. Hence, a malicious user could trigger overflows in the multiplication. In certain scenarios, this can then result in heap OOB read/write. Users are advised to upgrade to a patched version.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "f19be71717c497723ba0cea0379e84f061a75e01",
  "patch_info": {
    "commit_hash": "f19be71717c497723ba0cea0379e84f061a75e01",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/f19be71717c497723ba0cea0379e84f061a75e01",
    "files": [
      "tensorflow/lite/BUILD",
      "tensorflow/lite/core/subgraph.cc",
      "tensorflow/lite/util.cc",
      "tensorflow/lite/util.h",
      "tensorflow/lite/util_test.cc"
    ],
    "message": "[lite] Move MultiplyAndCheckOverflow to util to be able to share it.\n\nPiperOrigin-RevId: 416897229\nChange-Id: I5feb44881bdcbb6ed911da4f17c55bb978754059",
    "before_after_code_files": [
      "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc",
      "tensorflow/lite/util.cc||tensorflow/lite/util.cc",
      "tensorflow/lite/util.h||tensorflow/lite/util.h",
      "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc": [
      "File: tensorflow/lite/core/subgraph.cc -> tensorflow/lite/core/subgraph.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "690:   return kTfLiteOk;",
      "691: }",
      "714: TfLiteStatus Subgraph::BytesRequired(TfLiteType type, const int* dims,",
      "715:                                      size_t dims_size, size_t* bytes) {",
      "716:   TF_LITE_ENSURE(&context_, bytes != nullptr);",
      "",
      "[Removed Lines]",
      "693: namespace {",
      "698: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product) {",
      "702:   constexpr size_t size_t_bits = 8 * sizeof(size_t);",
      "703:   constexpr size_t overflow_upper_half_bit_position = size_t_bits / 2;",
      "707:   if (TFLITE_EXPECT_FALSE((a | b) >> overflow_upper_half_bit_position != 0)) {",
      "708:     if (a != 0 && *product / a != b) return kTfLiteError;",
      "709:   }",
      "710:   return kTfLiteOk;",
      "711: }",
      "712: }  // namespace",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "tensorflow/lite/util.cc||tensorflow/lite/util.cc": [
      "File: tensorflow/lite/util.cc -> tensorflow/lite/util.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "28: #include \"tensorflow/lite/builtin_ops.h\"",
      "29: #include \"tensorflow/lite/c/common.h\"",
      "30: #include \"tensorflow/lite/schema/schema_generated.h\"",
      "32: namespace tflite {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "30: #include \"tensorflow/lite/core/macros.h\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "177:   return name && std::string(name).find(kValidationSubgraphNamePrefix) == 0;",
      "178: }",
      "179: }  // namespace tflite",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "181: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product) {",
      "185:   constexpr size_t size_t_bits = 8 * sizeof(size_t);",
      "186:   constexpr size_t overflow_upper_half_bit_position = size_t_bits / 2;",
      "190:   if (TFLITE_EXPECT_FALSE((a | b) >> overflow_upper_half_bit_position != 0)) {",
      "191:     if (a != 0 && *product / a != b) return kTfLiteError;",
      "192:   }",
      "193:   return kTfLiteOk;",
      "194: }",
      "",
      "---------------"
    ],
    "tensorflow/lite/util.h||tensorflow/lite/util.h": [
      "File: tensorflow/lite/util.h -> tensorflow/lite/util.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "101: bool IsValidationSubgraph(const char* name);",
      "102: }  // namespace tflite",
      "104: #endif  // TENSORFLOW_LITE_UTIL_H_",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "107: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product);",
      "",
      "---------------"
    ],
    "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc": [
      "File: tensorflow/lite/util_test.cc -> tensorflow/lite/util_test.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "22: #include <vector>",
      "24: #include <gtest/gtest.h>",
      "25: #include \"tensorflow/lite/c/common.h\"",
      "26: #include \"tensorflow/lite/schema/schema_generated.h\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "25: #include \"tensorflow/lite/c/c_api_types.h\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "130:   EXPECT_TRUE(IsValidationSubgraph(\"VALIDATION:main\"));",
      "131: }",
      "133: }  // namespace",
      "134: }  // namespace tflite",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "134: TEST(MultiplyAndCheckOverflow, Validate) {",
      "135:   size_t res = 0;",
      "136:   EXPECT_TRUE(MultiplyAndCheckOverflow(1, 2, &res) == kTfLiteOk);",
      "137:   EXPECT_FALSE(MultiplyAndCheckOverflow(static_cast<size_t>(123456789023),",
      "138:                                         1223423425, &res) == kTfLiteOk);",
      "139: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6e3bc73e10b6f546876014b7d88e3690f16e440f",
      "candidate_info": {
        "commit_hash": "6e3bc73e10b6f546876014b7d88e3690f16e440f",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/6e3bc73e10b6f546876014b7d88e3690f16e440f",
        "files": [
          "tensorflow/lite/core/subgraph.cc"
        ],
        "message": "Add a comment about the initial value when computing bytes required.\n\nPiperOrigin-RevId: 387228734\nChange-Id: I37d3a523696eba2f7d6da737ee3279991a074a56",
        "before_after_code_files": [
          "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc"
          ],
          "candidate": [
            "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc": [
          "File: tensorflow/lite/core/subgraph.cc -> tensorflow/lite/core/subgraph.cc"
        ]
      }
    },
    {
      "candidate_hash": "f53160aa134d1040c82512ba86081ee46eb9d1c7",
      "candidate_info": {
        "commit_hash": "f53160aa134d1040c82512ba86081ee46eb9d1c7",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/f53160aa134d1040c82512ba86081ee46eb9d1c7",
        "files": [
          "tensorflow/lite/BUILD",
          "tensorflow/lite/core/subgraph.cc",
          "tensorflow/lite/util.cc",
          "tensorflow/lite/util.h",
          "tensorflow/lite/util_test.cc"
        ],
        "message": "[lite] Move MultiplyAndCheckOverflow to util to be able to share it.\n\nPiperOrigin-RevId: 416897229\nChange-Id: I5feb44881bdcbb6ed911da4f17c55bb978754059",
        "before_after_code_files": [
          "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc",
          "tensorflow/lite/util.cc||tensorflow/lite/util.cc",
          "tensorflow/lite/util.h||tensorflow/lite/util.h",
          "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc",
            "tensorflow/lite/util.cc||tensorflow/lite/util.cc",
            "tensorflow/lite/util.h||tensorflow/lite/util.h",
            "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc"
          ],
          "candidate": [
            "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc",
            "tensorflow/lite/util.cc||tensorflow/lite/util.cc",
            "tensorflow/lite/util.h||tensorflow/lite/util.h",
            "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc": [
          "File: tensorflow/lite/core/subgraph.cc -> tensorflow/lite/core/subgraph.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "649:   return kTfLiteOk;",
          "650: }",
          "673: TfLiteStatus Subgraph::BytesRequired(TfLiteType type, const int* dims,",
          "674:                                      size_t dims_size, size_t* bytes) {",
          "675:   TF_LITE_ENSURE(&context_, bytes != nullptr);",
          "",
          "[Removed Lines]",
          "652: namespace {",
          "657: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product) {",
          "661:   constexpr size_t size_t_bits = 8 * sizeof(size_t);",
          "662:   constexpr size_t overflow_upper_half_bit_position = size_t_bits / 2;",
          "666:   if (TFLITE_EXPECT_FALSE((a | b) >> overflow_upper_half_bit_position != 0)) {",
          "667:     if (a != 0 && *product / a != b) return kTfLiteError;",
          "668:   }",
          "669:   return kTfLiteOk;",
          "670: }",
          "671: }  // namespace",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "tensorflow/lite/util.cc||tensorflow/lite/util.cc": [
          "File: tensorflow/lite/util.cc -> tensorflow/lite/util.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: #include \"tensorflow/lite/builtin_ops.h\"",
          "29: #include \"tensorflow/lite/c/common.h\"",
          "30: #include \"tensorflow/lite/schema/schema_generated.h\"",
          "32: namespace tflite {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include \"tensorflow/lite/core/macros.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "177:   return name && std::string(name).find(kValidationSubgraphNamePrefix) == 0;",
          "178: }",
          "179: }  // namespace tflite",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "181: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product) {",
          "185:   constexpr size_t size_t_bits = 8 * sizeof(size_t);",
          "186:   constexpr size_t overflow_upper_half_bit_position = size_t_bits / 2;",
          "190:   if (TFLITE_EXPECT_FALSE((a | b) >> overflow_upper_half_bit_position != 0)) {",
          "191:     if (a != 0 && *product / a != b) return kTfLiteError;",
          "192:   }",
          "193:   return kTfLiteOk;",
          "194: }",
          "",
          "---------------"
        ],
        "tensorflow/lite/util.h||tensorflow/lite/util.h": [
          "File: tensorflow/lite/util.h -> tensorflow/lite/util.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "101: bool IsValidationSubgraph(const char* name);",
          "102: }  // namespace tflite",
          "104: #endif  // TENSORFLOW_LITE_UTIL_H_",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "107: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product);",
          "",
          "---------------"
        ],
        "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc": [
          "File: tensorflow/lite/util_test.cc -> tensorflow/lite/util_test.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: #include <vector>",
          "24: #include <gtest/gtest.h>",
          "25: #include \"tensorflow/lite/c/common.h\"",
          "26: #include \"tensorflow/lite/schema/schema_generated.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: #include \"tensorflow/lite/c/c_api_types.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "130:   EXPECT_TRUE(IsValidationSubgraph(\"VALIDATION:main\"));",
          "131: }",
          "133: }  // namespace",
          "134: }  // namespace tflite",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "134: TEST(MultiplyAndCheckOverflow, Validate) {",
          "135:   size_t res = 0;",
          "136:   EXPECT_TRUE(MultiplyAndCheckOverflow(1, 2, &res) == kTfLiteOk);",
          "137:   EXPECT_FALSE(MultiplyAndCheckOverflow(static_cast<size_t>(123456789023),",
          "138:                                         1223423425, &res) == kTfLiteOk);",
          "139: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "24780dc4824ae2ebc03c2685d96a6bf75370d671",
      "candidate_info": {
        "commit_hash": "24780dc4824ae2ebc03c2685d96a6bf75370d671",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/24780dc4824ae2ebc03c2685d96a6bf75370d671",
        "files": [
          "tensorflow/lite/BUILD",
          "tensorflow/lite/core/subgraph.cc",
          "tensorflow/lite/util.cc",
          "tensorflow/lite/util.h",
          "tensorflow/lite/util_test.cc"
        ],
        "message": "[lite] Move MultiplyAndCheckOverflow to util to be able to share it.\n\nPiperOrigin-RevId: 416897229\nChange-Id: I5feb44881bdcbb6ed911da4f17c55bb978754059",
        "before_after_code_files": [
          "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc",
          "tensorflow/lite/util.cc||tensorflow/lite/util.cc",
          "tensorflow/lite/util.h||tensorflow/lite/util.h",
          "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc",
            "tensorflow/lite/util.cc||tensorflow/lite/util.cc",
            "tensorflow/lite/util.h||tensorflow/lite/util.h",
            "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc"
          ],
          "candidate": [
            "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc",
            "tensorflow/lite/util.cc||tensorflow/lite/util.cc",
            "tensorflow/lite/util.h||tensorflow/lite/util.h",
            "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc": [
          "File: tensorflow/lite/core/subgraph.cc -> tensorflow/lite/core/subgraph.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "629:   return kTfLiteOk;",
          "630: }",
          "653: TfLiteStatus Subgraph::BytesRequired(TfLiteType type, const int* dims,",
          "654:                                      size_t dims_size, size_t* bytes) {",
          "655:   TF_LITE_ENSURE(&context_, bytes != nullptr);",
          "",
          "[Removed Lines]",
          "632: namespace {",
          "637: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product) {",
          "641:   constexpr size_t size_t_bits = 8 * sizeof(size_t);",
          "642:   constexpr size_t overflow_upper_half_bit_position = size_t_bits / 2;",
          "646:   if (TFLITE_EXPECT_FALSE((a | b) >> overflow_upper_half_bit_position != 0)) {",
          "647:     if (a != 0 && *product / a != b) return kTfLiteError;",
          "648:   }",
          "649:   return kTfLiteOk;",
          "650: }",
          "651: }  // namespace",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "tensorflow/lite/util.cc||tensorflow/lite/util.cc": [
          "File: tensorflow/lite/util.cc -> tensorflow/lite/util.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: #include \"tensorflow/lite/builtin_ops.h\"",
          "29: #include \"tensorflow/lite/c/common.h\"",
          "30: #include \"tensorflow/lite/schema/schema_generated.h\"",
          "32: namespace tflite {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include \"tensorflow/lite/core/macros.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "177:   return name && std::string(name).find(kValidationSubgraphNamePrefix) == 0;",
          "178: }",
          "179: }  // namespace tflite",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "181: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product) {",
          "185:   constexpr size_t size_t_bits = 8 * sizeof(size_t);",
          "186:   constexpr size_t overflow_upper_half_bit_position = size_t_bits / 2;",
          "190:   if (TFLITE_EXPECT_FALSE((a | b) >> overflow_upper_half_bit_position != 0)) {",
          "191:     if (a != 0 && *product / a != b) return kTfLiteError;",
          "192:   }",
          "193:   return kTfLiteOk;",
          "194: }",
          "",
          "---------------"
        ],
        "tensorflow/lite/util.h||tensorflow/lite/util.h": [
          "File: tensorflow/lite/util.h -> tensorflow/lite/util.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "101: bool IsValidationSubgraph(const char* name);",
          "102: }  // namespace tflite",
          "104: #endif  // TENSORFLOW_LITE_UTIL_H_",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "107: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product);",
          "",
          "---------------"
        ],
        "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc": [
          "File: tensorflow/lite/util_test.cc -> tensorflow/lite/util_test.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: #include <vector>",
          "24: #include <gtest/gtest.h>",
          "25: #include \"tensorflow/lite/c/common.h\"",
          "26: #include \"tensorflow/lite/schema/schema_generated.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: #include \"tensorflow/lite/c/c_api_types.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "130:   EXPECT_TRUE(IsValidationSubgraph(\"VALIDATION:main\"));",
          "131: }",
          "133: }  // namespace",
          "134: }  // namespace tflite",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "134: TEST(MultiplyAndCheckOverflow, Validate) {",
          "135:   size_t res = 0;",
          "136:   EXPECT_TRUE(MultiplyAndCheckOverflow(1, 2, &res) == kTfLiteOk);",
          "137:   EXPECT_FALSE(MultiplyAndCheckOverflow(static_cast<size_t>(123456789023),",
          "138:                                         1223423425, &res) == kTfLiteOk);",
          "139: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bbe1891deee238ebfcb0b0dd1ba6eebe965e3639",
      "candidate_info": {
        "commit_hash": "bbe1891deee238ebfcb0b0dd1ba6eebe965e3639",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/bbe1891deee238ebfcb0b0dd1ba6eebe965e3639",
        "files": [
          "tensorflow/lite/BUILD",
          "tensorflow/lite/core/subgraph.cc",
          "tensorflow/lite/util.cc",
          "tensorflow/lite/util.h",
          "tensorflow/lite/util_test.cc"
        ],
        "message": "[lite] Move MultiplyAndCheckOverflow to util to be able to share it.\n\nPiperOrigin-RevId: 416897229\nChange-Id: I5feb44881bdcbb6ed911da4f17c55bb978754059",
        "before_after_code_files": [
          "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc",
          "tensorflow/lite/util.cc||tensorflow/lite/util.cc",
          "tensorflow/lite/util.h||tensorflow/lite/util.h",
          "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc",
            "tensorflow/lite/util.cc||tensorflow/lite/util.cc",
            "tensorflow/lite/util.h||tensorflow/lite/util.h",
            "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc"
          ],
          "candidate": [
            "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc",
            "tensorflow/lite/util.cc||tensorflow/lite/util.cc",
            "tensorflow/lite/util.h||tensorflow/lite/util.h",
            "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc": [
          "File: tensorflow/lite/core/subgraph.cc -> tensorflow/lite/core/subgraph.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "690:   return kTfLiteOk;",
          "691: }",
          "714: TfLiteStatus Subgraph::BytesRequired(TfLiteType type, const int* dims,",
          "715:                                      size_t dims_size, size_t* bytes) {",
          "716:   TF_LITE_ENSURE(&context_, bytes != nullptr);",
          "",
          "[Removed Lines]",
          "693: namespace {",
          "698: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product) {",
          "702:   constexpr size_t size_t_bits = 8 * sizeof(size_t);",
          "703:   constexpr size_t overflow_upper_half_bit_position = size_t_bits / 2;",
          "707:   if (TFLITE_EXPECT_FALSE((a | b) >> overflow_upper_half_bit_position != 0)) {",
          "708:     if (a != 0 && *product / a != b) return kTfLiteError;",
          "709:   }",
          "710:   return kTfLiteOk;",
          "711: }",
          "712: }  // namespace",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "tensorflow/lite/util.cc||tensorflow/lite/util.cc": [
          "File: tensorflow/lite/util.cc -> tensorflow/lite/util.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: #include \"tensorflow/lite/builtin_ops.h\"",
          "29: #include \"tensorflow/lite/c/common.h\"",
          "30: #include \"tensorflow/lite/schema/schema_generated.h\"",
          "32: namespace tflite {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: #include \"tensorflow/lite/core/macros.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "177:   return name && std::string(name).find(kValidationSubgraphNamePrefix) == 0;",
          "178: }",
          "179: }  // namespace tflite",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "181: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product) {",
          "185:   constexpr size_t size_t_bits = 8 * sizeof(size_t);",
          "186:   constexpr size_t overflow_upper_half_bit_position = size_t_bits / 2;",
          "190:   if (TFLITE_EXPECT_FALSE((a | b) >> overflow_upper_half_bit_position != 0)) {",
          "191:     if (a != 0 && *product / a != b) return kTfLiteError;",
          "192:   }",
          "193:   return kTfLiteOk;",
          "194: }",
          "",
          "---------------"
        ],
        "tensorflow/lite/util.h||tensorflow/lite/util.h": [
          "File: tensorflow/lite/util.h -> tensorflow/lite/util.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "101: bool IsValidationSubgraph(const char* name);",
          "102: }  // namespace tflite",
          "104: #endif  // TENSORFLOW_LITE_UTIL_H_",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "107: TfLiteStatus MultiplyAndCheckOverflow(size_t a, size_t b, size_t* product);",
          "",
          "---------------"
        ],
        "tensorflow/lite/util_test.cc||tensorflow/lite/util_test.cc": [
          "File: tensorflow/lite/util_test.cc -> tensorflow/lite/util_test.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: #include <vector>",
          "24: #include <gtest/gtest.h>",
          "25: #include \"tensorflow/lite/c/common.h\"",
          "26: #include \"tensorflow/lite/schema/schema_generated.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: #include \"tensorflow/lite/c/c_api_types.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "130:   EXPECT_TRUE(IsValidationSubgraph(\"VALIDATION:main\"));",
          "131: }",
          "133: }  // namespace",
          "134: }  // namespace tflite",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "134: TEST(MultiplyAndCheckOverflow, Validate) {",
          "135:   size_t res = 0;",
          "136:   EXPECT_TRUE(MultiplyAndCheckOverflow(1, 2, &res) == kTfLiteOk);",
          "137:   EXPECT_FALSE(MultiplyAndCheckOverflow(static_cast<size_t>(123456789023),",
          "138:                                         1223423425, &res) == kTfLiteOk);",
          "139: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}