{
  "cve_id": "CVE-2016-9387",
  "cve_desc": "Integer overflow in the jpc_dec_process_siz function in libjasper/jpc/jpc_dec.c in JasPer before 1.900.13 allows remote attackers to have unspecified impact via a crafted file, which triggers an assertion failure.",
  "repo": "mdadams/jasper",
  "patch_hash": "d91198abd00fc435a397fe6bad906a4c1748e9cf",
  "patch_info": {
    "commit_hash": "d91198abd00fc435a397fe6bad906a4c1748e9cf",
    "repo": "mdadams/jasper",
    "commit_url": "https://github.com/mdadams/jasper/commit/d91198abd00fc435a397fe6bad906a4c1748e9cf",
    "files": [
      "src/libjasper/jpc/jpc_dec.c"
    ],
    "message": "Fixed another integer overflow problem.",
    "before_after_code_files": [
      "src/libjasper/jpc/jpc_dec.c||src/libjasper/jpc/jpc_dec.c"
    ]
  },
  "patch_diff": {
    "src/libjasper/jpc/jpc_dec.c||src/libjasper/jpc/jpc_dec.c": [
      "File: src/libjasper/jpc/jpc_dec.c -> src/libjasper/jpc/jpc_dec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1195:  int htileno;",
      "1196:  int vtileno;",
      "1197:  jpc_dec_cmpt_t *cmpt;",
      "1199:  dec->xstart = siz->xoff;",
      "1200:  dec->ystart = siz->yoff;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1198:  size_t size;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1232:  dec->numhtiles = JPC_CEILDIV(dec->xend - dec->tilexoff, dec->tilewidth);",
      "1233:  dec->numvtiles = JPC_CEILDIV(dec->yend - dec->tileyoff, dec->tileheight);",
      "1235:  JAS_DBGLOG(10, (\"numtiles = %d; numhtiles = %d; numvtiles = %d;\\n\",",
      "1236:    dec->numtiles, dec->numhtiles, dec->numvtiles));",
      "1237:  if (!(dec->tiles = jas_alloc2(dec->numtiles, sizeof(jpc_dec_tile_t)))) {",
      "",
      "[Removed Lines]",
      "1234:  dec->numtiles = dec->numhtiles * dec->numvtiles;",
      "",
      "[Added Lines]",
      "1235:  if (!jas_safe_size_mul(dec->numhtiles, dec->numvtiles, &size)) {",
      "1236:   return -1;",
      "1237:  }",
      "1238:  dec->numtiles = size;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "a712a2041085e7cd5f2b153e1532ac2a2954ffaa",
      "candidate_info": {
        "commit_hash": "a712a2041085e7cd5f2b153e1532ac2a2954ffaa",
        "repo": "mdadams/jasper",
        "commit_url": "https://github.com/mdadams/jasper/commit/a712a2041085e7cd5f2b153e1532ac2a2954ffaa",
        "files": [
          "src/libjasper/jpc/jpc_dec.c"
        ],
        "message": "Added some additional checking to prevent a potential integer overflow due to conversion in the JPC decoder.",
        "before_after_code_files": [
          "src/libjasper/jpc/jpc_dec.c||src/libjasper/jpc/jpc_dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/libjasper/jpc/jpc_dec.c||src/libjasper/jpc/jpc_dec.c"
          ],
          "candidate": [
            "src/libjasper/jpc/jpc_dec.c||src/libjasper/jpc/jpc_dec.c"
          ]
        }
      },
      "candidate_diff": {
        "src/libjasper/jpc/jpc_dec.c||src/libjasper/jpc/jpc_dec.c": [
          "File: src/libjasper/jpc/jpc_dec.c -> src/libjasper/jpc/jpc_dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1295:  dec->numhtiles = JPC_CEILDIV(dec->xend - dec->tilexoff, dec->tilewidth);",
          "1296:  dec->numvtiles = JPC_CEILDIV(dec->yend - dec->tileyoff, dec->tileheight);",
          "1298:   return -1;",
          "1299:  }",
          "1300:  dec->numtiles = size;",
          "",
          "[Removed Lines]",
          "1297:  if (!jas_safe_size_mul(dec->numhtiles, dec->numvtiles, &size)) {",
          "",
          "[Added Lines]",
          "1297:  assert(dec->numhtiles >= 0);",
          "1298:  assert(dec->numvtiles >= 0);",
          "1299:  if (!jas_safe_size_mul(dec->numhtiles, dec->numvtiles, &size) ||",
          "1300:    size > INT_MAX) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}