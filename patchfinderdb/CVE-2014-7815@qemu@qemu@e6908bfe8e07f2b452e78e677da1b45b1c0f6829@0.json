{
  "cve_id": "CVE-2014-7815",
  "cve_desc": "The set_pixel_format function in ui/vnc.c in QEMU allows remote attackers to cause a denial of service (crash) via a small bytes_per_pixel value.",
  "repo": "qemu/qemu",
  "patch_hash": "e6908bfe8e07f2b452e78e677da1b45b1c0f6829",
  "patch_info": {
    "commit_hash": "e6908bfe8e07f2b452e78e677da1b45b1c0f6829",
    "repo": "qemu/qemu",
    "commit_url": "https://github.com/qemu/qemu/commit/e6908bfe8e07f2b452e78e677da1b45b1c0f6829",
    "files": [
      "ui/vnc.c"
    ],
    "message": "vnc: sanitize bits_per_pixel from the client\n\nbits_per_pixel that are less than 8 could result in accessing\nnon-initialized buffers later in the code due to the expectation\nthat bytes_per_pixel value that is used to initialize these buffers is\nnever zero.\n\nTo fix this check that bits_per_pixel from the client is one of the\nvalues that the rfb protocol specification allows.\n\nThis is CVE-2014-7815.\n\nSigned-off-by: Petr Matousek <pmatouse@redhat.com>\n\n[ kraxel: apply codestyle fix ]\n\nSigned-off-by: Gerd Hoffmann <kraxel@redhat.com>",
    "before_after_code_files": [
      "ui/vnc.c||ui/vnc.c"
    ]
  },
  "patch_diff": {
    "ui/vnc.c||ui/vnc.c": [
      "File: ui/vnc.c -> ui/vnc.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2026:         return;",
      "2027:     }",
      "2029:     vs->client_pf.rmax = red_max;",
      "2030:     vs->client_pf.rbits = hweight_long(red_max);",
      "2031:     vs->client_pf.rshift = red_shift;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2029:     switch (bits_per_pixel) {",
      "2030:     case 8:",
      "2031:     case 16:",
      "2032:     case 32:",
      "2033:         break;",
      "2034:     default:",
      "2035:         vnc_client_error(vs);",
      "2036:         return;",
      "2037:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b2f1d90530301d7915dddc8a750063757675b21a",
      "candidate_info": {
        "commit_hash": "b2f1d90530301d7915dddc8a750063757675b21a",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/b2f1d90530301d7915dddc8a750063757675b21a",
        "files": [
          "ui/vnc.c"
        ],
        "message": "vnc: sanitize bits_per_pixel from the client\n\nbits_per_pixel that are less than 8 could result in accessing\nnon-initialized buffers later in the code due to the expectation\nthat bytes_per_pixel value that is used to initialize these buffers is\nnever zero.\n\nTo fix this check that bits_per_pixel from the client is one of the\nvalues that the rfb protocol specification allows.\n\nThis is CVE-2014-7815.\n\nSigned-off-by: Petr Matousek <pmatouse@redhat.com>\n\n[ kraxel: apply codestyle fix ]\n\nSigned-off-by: Gerd Hoffmann <kraxel@redhat.com>\n(cherry picked from commit e6908bfe8e07f2b452e78e677da1b45b1c0f6829)\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "ui/vnc.c||ui/vnc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ui/vnc.c||ui/vnc.c"
          ],
          "candidate": [
            "ui/vnc.c||ui/vnc.c"
          ]
        }
      },
      "candidate_diff": {
        "ui/vnc.c||ui/vnc.c": [
          "File: ui/vnc.c -> ui/vnc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2026:         return;",
          "2027:     }",
          "2029:     vs->client_pf.rmax = red_max;",
          "2030:     vs->client_pf.rbits = hweight_long(red_max);",
          "2031:     vs->client_pf.rshift = red_shift;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2029:     switch (bits_per_pixel) {",
          "2030:     case 8:",
          "2031:     case 16:",
          "2032:     case 32:",
          "2033:         break;",
          "2034:     default:",
          "2035:         vnc_client_error(vs);",
          "2036:         return;",
          "2037:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}