{
  "cve_id": "CVE-2017-11462",
  "cve_desc": "Double free vulnerability in MIT Kerberos 5 (aka krb5) allows attackers to have unspecified impact via vectors involving automatic deletion of security contexts on error.",
  "repo": "krb5/krb5",
  "patch_hash": "56f7b1bc95a2a3eeb420e069e7655fb181ade5cf",
  "patch_info": {
    "commit_hash": "56f7b1bc95a2a3eeb420e069e7655fb181ade5cf",
    "repo": "krb5/krb5",
    "commit_url": "https://github.com/krb5/krb5/commit/56f7b1bc95a2a3eeb420e069e7655fb181ade5cf",
    "files": [
      "src/lib/gssapi/mechglue/g_accept_sec_context.c",
      "src/lib/gssapi/mechglue/g_complete_auth_token.c",
      "src/lib/gssapi/mechglue/g_context_time.c",
      "src/lib/gssapi/mechglue/g_delete_sec_context.c",
      "src/lib/gssapi/mechglue/g_exp_sec_context.c",
      "src/lib/gssapi/mechglue/g_init_sec_context.c",
      "src/lib/gssapi/mechglue/g_inq_context.c",
      "src/lib/gssapi/mechglue/g_prf.c",
      "src/lib/gssapi/mechglue/g_process_context.c",
      "src/lib/gssapi/mechglue/g_seal.c",
      "src/lib/gssapi/mechglue/g_sign.c",
      "src/lib/gssapi/mechglue/g_unseal.c",
      "src/lib/gssapi/mechglue/g_unwrap_aead.c",
      "src/lib/gssapi/mechglue/g_unwrap_iov.c",
      "src/lib/gssapi/mechglue/g_verify.c",
      "src/lib/gssapi/mechglue/g_wrap_aead.c",
      "src/lib/gssapi/mechglue/g_wrap_iov.c"
    ],
    "message": "Preserve GSS context on init/accept failure\n\nAfter gss_init_sec_context() or gss_accept_sec_context() has created a\ncontext, don't delete the mechglue context on failures from subsequent\ncalls, even if the mechanism deletes the mech-specific context (which\nis allowed by RFC 2744 but not preferred).  Check for union contexts\nwith no mechanism context in each GSS function which accepts a\ngss_ctx_id_t.\n\nCVE-2017-11462:\n\nRFC 2744 permits a GSS-API implementation to delete an existing\nsecurity context on a second or subsequent call to\ngss_init_sec_context() or gss_accept_sec_context() if the call results\nin an error.  This API behavior has been found to be dangerous,\nleading to the possibility of memory errors in some callers.  For\nsafety, GSS-API implementations should instead preserve existing\nsecurity contexts on error until the caller deletes them.\n\nAll versions of MIT krb5 prior to this change may delete acceptor\ncontexts on error.  Versions 1.13.4 through 1.13.7, 1.14.1 through\n1.14.5, and 1.15 through 1.15.1 may also delete initiator contexts on\nerror.\n\nticket: 8598 (new)\ntarget_version: 1.15-next\ntarget_version: 1.14-next\ntags: pullup",
    "before_after_code_files": [
      "src/lib/gssapi/mechglue/g_accept_sec_context.c||src/lib/gssapi/mechglue/g_accept_sec_context.c",
      "src/lib/gssapi/mechglue/g_complete_auth_token.c||src/lib/gssapi/mechglue/g_complete_auth_token.c",
      "src/lib/gssapi/mechglue/g_context_time.c||src/lib/gssapi/mechglue/g_context_time.c",
      "src/lib/gssapi/mechglue/g_delete_sec_context.c||src/lib/gssapi/mechglue/g_delete_sec_context.c",
      "src/lib/gssapi/mechglue/g_exp_sec_context.c||src/lib/gssapi/mechglue/g_exp_sec_context.c",
      "src/lib/gssapi/mechglue/g_init_sec_context.c||src/lib/gssapi/mechglue/g_init_sec_context.c",
      "src/lib/gssapi/mechglue/g_inq_context.c||src/lib/gssapi/mechglue/g_inq_context.c",
      "src/lib/gssapi/mechglue/g_prf.c||src/lib/gssapi/mechglue/g_prf.c",
      "src/lib/gssapi/mechglue/g_process_context.c||src/lib/gssapi/mechglue/g_process_context.c",
      "src/lib/gssapi/mechglue/g_seal.c||src/lib/gssapi/mechglue/g_seal.c",
      "src/lib/gssapi/mechglue/g_sign.c||src/lib/gssapi/mechglue/g_sign.c",
      "src/lib/gssapi/mechglue/g_unseal.c||src/lib/gssapi/mechglue/g_unseal.c",
      "src/lib/gssapi/mechglue/g_unwrap_aead.c||src/lib/gssapi/mechglue/g_unwrap_aead.c",
      "src/lib/gssapi/mechglue/g_unwrap_iov.c||src/lib/gssapi/mechglue/g_unwrap_iov.c",
      "src/lib/gssapi/mechglue/g_verify.c||src/lib/gssapi/mechglue/g_verify.c",
      "src/lib/gssapi/mechglue/g_wrap_aead.c||src/lib/gssapi/mechglue/g_wrap_aead.c",
      "src/lib/gssapi/mechglue/g_wrap_iov.c||src/lib/gssapi/mechglue/g_wrap_iov.c"
    ]
  },
  "patch_diff": {
    "src/lib/gssapi/mechglue/g_accept_sec_context.c||src/lib/gssapi/mechglue/g_accept_sec_context.c": [
      "File: src/lib/gssapi/mechglue/g_accept_sec_context.c -> src/lib/gssapi/mechglue/g_accept_sec_context.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "216:     } else {",
      "217:  union_ctx_id = (gss_union_ctx_id_t)*context_handle;",
      "218:  selected_mech = union_ctx_id->mech_type;",
      "219:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "219:  if (union_ctx_id->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "220:      return (GSS_S_NO_CONTEXT);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "277:      d_cred ? &tmp_d_cred : NULL);",
      "281:   return GSS_S_CONTINUE_NEEDED;",
      "284:      if (status != GSS_S_COMPLETE) {",
      "",
      "[Removed Lines]",
      "280:      if (status == GSS_S_CONTINUE_NEEDED)",
      "",
      "[Added Lines]",
      "279:      if (status == GSS_S_CONTINUE_NEEDED) {",
      "282:      }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "365:      if (ret_flags != NULL)",
      "368:     } else {",
      "370:  status = GSS_S_BAD_MECH;",
      "371:     }",
      "373: error_out:",
      "375:  if (union_ctx_id->mech_type) {",
      "376:      if (union_ctx_id->mech_type->elements)",
      "377:   free(union_ctx_id->mech_type->elements);",
      "",
      "[Removed Lines]",
      "367:      return (status);",
      "374:     if (union_ctx_id) {",
      "",
      "[Added Lines]",
      "369:      return GSS_S_COMPLETE;",
      "383:     if (union_ctx_id && *context_handle == GSS_C_NO_CONTEXT) {",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_complete_auth_token.c||src/lib/gssapi/mechglue/g_complete_auth_token.c": [
      "File: src/lib/gssapi/mechglue/g_complete_auth_token.c -> src/lib/gssapi/mechglue/g_complete_auth_token.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "54:     ctx = (gss_union_ctx_id_t) context_handle;",
      "55:     mech = gssint_get_mechanism (ctx->mech_type);",
      "57:     if (mech != NULL) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "55:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "56:  return GSS_S_NO_CONTEXT;",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_context_time.c||src/lib/gssapi/mechglue/g_context_time.c": [
      "File: src/lib/gssapi/mechglue/g_context_time.c -> src/lib/gssapi/mechglue/g_context_time.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "60:     ctx = (gss_union_ctx_id_t) context_handle;",
      "61:     mech = gssint_get_mechanism (ctx->mech_type);",
      "63:     if (mech) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "61:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "62:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_delete_sec_context.c||src/lib/gssapi/mechglue/g_delete_sec_context.c": [
      "File: src/lib/gssapi/mechglue/g_delete_sec_context.c -> src/lib/gssapi/mechglue/g_delete_sec_context.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "87:     if (GSSINT_CHK_LOOP(ctx))",
      "88:  return (GSS_S_CALL_INACCESSIBLE_READ | GSS_S_NO_CONTEXT);",
      "98:     free(ctx->mech_type->elements);",
      "",
      "[Removed Lines]",
      "90:     status = gssint_delete_internal_sec_context(minor_status,",
      "91:       ctx->mech_type,",
      "92:       &ctx->internal_ctx_id,",
      "93:       output_token);",
      "94:     if (status)",
      "95:  return status;",
      "",
      "[Added Lines]",
      "90:     if (ctx->internal_ctx_id != GSS_C_NO_CONTEXT) {",
      "91:  status = gssint_delete_internal_sec_context(minor_status,",
      "92:           ctx->mech_type,",
      "93:           &ctx->internal_ctx_id,",
      "94:           output_token);",
      "95:  if (status)",
      "96:      return status;",
      "97:     }",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_exp_sec_context.c||src/lib/gssapi/mechglue/g_exp_sec_context.c": [
      "File: src/lib/gssapi/mechglue/g_exp_sec_context.c -> src/lib/gssapi/mechglue/g_exp_sec_context.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "97:     ctx = (gss_union_ctx_id_t) *context_handle;",
      "98:     mech = gssint_get_mechanism (ctx->mech_type);",
      "99:     if (!mech)",
      "100:  return GSS_S_BAD_MECH;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "98:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "99:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_init_sec_context.c||src/lib/gssapi/mechglue/g_init_sec_context.c": [
      "File: src/lib/gssapi/mechglue/g_init_sec_context.c -> src/lib/gssapi/mechglue/g_init_sec_context.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "194:  union_ctx_id->internal_ctx_id = GSS_C_NO_CONTEXT;",
      "196:  union_ctx_id = (gss_union_ctx_id_t)*context_handle;",
      "",
      "[Removed Lines]",
      "195:     } else",
      "",
      "[Added Lines]",
      "195:     } else {",
      "197:  if (union_ctx_id->internal_ctx_id == GSS_C_NO_CONTEXT) {",
      "198:      status = GSS_S_NO_CONTEXT;",
      "199:      goto end;",
      "200:  }",
      "201:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "225:     if (status != GSS_S_COMPLETE && status != GSS_S_CONTINUE_NEEDED) {",
      "233:  map_error(minor_status, mech);",
      "236:  if (*context_handle == GSS_C_NO_CONTEXT) {",
      "237:      free(union_ctx_id->mech_type->elements);",
      "238:      free(union_ctx_id->mech_type);",
      "",
      "[Removed Lines]",
      "234:  if (union_ctx_id->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_inq_context.c||src/lib/gssapi/mechglue/g_inq_context.c": [
      "File: src/lib/gssapi/mechglue/g_inq_context.c -> src/lib/gssapi/mechglue/g_inq_context.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "106:     ctx = (gss_union_ctx_id_t) context_handle;",
      "107:     mech = gssint_get_mechanism (ctx->mech_type);",
      "109:     if (!mech || !mech->gss_inquire_context || !mech->gss_display_name ||",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "107:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "108:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_prf.c||src/lib/gssapi/mechglue/g_prf.c": [
      "File: src/lib/gssapi/mechglue/g_prf.c -> src/lib/gssapi/mechglue/g_prf.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "61:     ctx = (gss_union_ctx_id_t) context_handle;",
      "62:     mech = gssint_get_mechanism (ctx->mech_type);",
      "64:     if (mech != NULL) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "62:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "63:  return GSS_S_NO_CONTEXT;",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_process_context.c||src/lib/gssapi/mechglue/g_process_context.c": [
      "File: src/lib/gssapi/mechglue/g_process_context.c -> src/lib/gssapi/mechglue/g_process_context.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "63:     ctx = (gss_union_ctx_id_t) context_handle;",
      "64:     mech = gssint_get_mechanism (ctx->mech_type);",
      "66:     if (mech) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "64:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "65:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_seal.c||src/lib/gssapi/mechglue/g_seal.c": [
      "File: src/lib/gssapi/mechglue/g_seal.c -> src/lib/gssapi/mechglue/g_seal.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "94:     ctx = (gss_union_ctx_id_t) context_handle;",
      "95:     mech = gssint_get_mechanism (ctx->mech_type);",
      "97:     if (mech) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "95:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "96:         return (GSS_S_NO_CONTEXT);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "228:     ctx = (gss_union_ctx_id_t) context_handle;",
      "229:     mech = gssint_get_mechanism (ctx->mech_type);",
      "231:     if (!mech)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "231:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "232:         return (GSS_S_NO_CONTEXT);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_sign.c||src/lib/gssapi/mechglue/g_sign.c": [
      "File: src/lib/gssapi/mechglue/g_sign.c -> src/lib/gssapi/mechglue/g_sign.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "96:     ctx = (gss_union_ctx_id_t) context_handle;",
      "97:     mech = gssint_get_mechanism (ctx->mech_type);",
      "99:     if (mech) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "97:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "98:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_unseal.c||src/lib/gssapi/mechglue/g_unseal.c": [
      "File: src/lib/gssapi/mechglue/g_unseal.c -> src/lib/gssapi/mechglue/g_unseal.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "78:     ctx = (gss_union_ctx_id_t) context_handle;",
      "79:     mech = gssint_get_mechanism (ctx->mech_type);",
      "81:     if (mech) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "79:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "80:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_unwrap_aead.c||src/lib/gssapi/mechglue/g_unwrap_aead.c": [
      "File: src/lib/gssapi/mechglue/g_unwrap_aead.c -> src/lib/gssapi/mechglue/g_unwrap_aead.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "188:     ctx = (gss_union_ctx_id_t) context_handle;",
      "189:     mech = gssint_get_mechanism (ctx->mech_type);",
      "191:     if (!mech)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "189:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "190:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_unwrap_iov.c||src/lib/gssapi/mechglue/g_unwrap_iov.c": [
      "File: src/lib/gssapi/mechglue/g_unwrap_iov.c -> src/lib/gssapi/mechglue/g_unwrap_iov.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "91:     ctx = (gss_union_ctx_id_t) context_handle;",
      "92:     mech = gssint_get_mechanism (ctx->mech_type);",
      "94:     if (mech) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "92:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "93:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "130:     ctx = (gss_union_ctx_id_t)context_handle;",
      "131:     mech = gssint_get_mechanism(ctx->mech_type);",
      "132:     if (mech == NULL)",
      "133:  return GSS_S_BAD_MECH;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "133:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "134:  return GSS_S_NO_CONTEXT;",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_verify.c||src/lib/gssapi/mechglue/g_verify.c": [
      "File: src/lib/gssapi/mechglue/g_verify.c -> src/lib/gssapi/mechglue/g_verify.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "67:     ctx = (gss_union_ctx_id_t) context_handle;",
      "68:     mech = gssint_get_mechanism (ctx->mech_type);",
      "70:     if (mech) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "68:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "69:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_wrap_aead.c||src/lib/gssapi/mechglue/g_wrap_aead.c": [
      "File: src/lib/gssapi/mechglue/g_wrap_aead.c -> src/lib/gssapi/mechglue/g_wrap_aead.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "258:     ctx = (gss_union_ctx_id_t)context_handle;",
      "259:     mech = gssint_get_mechanism (ctx->mech_type);",
      "260:     if (!mech)",
      "261:  return (GSS_S_BAD_MECH);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "259:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "260:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------"
    ],
    "src/lib/gssapi/mechglue/g_wrap_iov.c||src/lib/gssapi/mechglue/g_wrap_iov.c": [
      "File: src/lib/gssapi/mechglue/g_wrap_iov.c -> src/lib/gssapi/mechglue/g_wrap_iov.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "95:     ctx = (gss_union_ctx_id_t) context_handle;",
      "96:     mech = gssint_get_mechanism (ctx->mech_type);",
      "98:     if (mech) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "96:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "97:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "153:     ctx = (gss_union_ctx_id_t) context_handle;",
      "154:     mech = gssint_get_mechanism (ctx->mech_type);",
      "156:     if (mech) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "156:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "157:  return (GSS_S_NO_CONTEXT);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "192:     ctx = (gss_union_ctx_id_t)context_handle;",
      "193:     mech = gssint_get_mechanism(ctx->mech_type);",
      "194:     if (mech == NULL)",
      "195:  return GSS_S_BAD_MECH;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "197:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "198:  return GSS_S_NO_CONTEXT;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "220:     ctx = (gss_union_ctx_id_t)context_handle;",
      "221:     mech = gssint_get_mechanism(ctx->mech_type);",
      "222:     if (mech == NULL)",
      "223:  return GSS_S_BAD_MECH;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "227:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
      "228:  return GSS_S_NO_CONTEXT;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5949691d76eb41bb2c50c3d742a5cb03d1478d06",
      "candidate_info": {
        "commit_hash": "5949691d76eb41bb2c50c3d742a5cb03d1478d06",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/5949691d76eb41bb2c50c3d742a5cb03d1478d06",
        "files": [
          "src/lib/gssapi/mechglue/g_accept_sec_context.c",
          "src/lib/gssapi/mechglue/g_complete_auth_token.c",
          "src/lib/gssapi/mechglue/g_context_time.c",
          "src/lib/gssapi/mechglue/g_delete_sec_context.c",
          "src/lib/gssapi/mechglue/g_exp_sec_context.c",
          "src/lib/gssapi/mechglue/g_init_sec_context.c",
          "src/lib/gssapi/mechglue/g_inq_context.c",
          "src/lib/gssapi/mechglue/g_prf.c",
          "src/lib/gssapi/mechglue/g_process_context.c",
          "src/lib/gssapi/mechglue/g_seal.c",
          "src/lib/gssapi/mechglue/g_sign.c",
          "src/lib/gssapi/mechglue/g_unseal.c",
          "src/lib/gssapi/mechglue/g_unwrap_aead.c",
          "src/lib/gssapi/mechglue/g_unwrap_iov.c",
          "src/lib/gssapi/mechglue/g_verify.c",
          "src/lib/gssapi/mechglue/g_wrap_aead.c",
          "src/lib/gssapi/mechglue/g_wrap_iov.c"
        ],
        "message": "Preserve GSS context on init/accept failure\n\nAfter gss_init_sec_context() or gss_accept_sec_context() has created a\ncontext, don't delete the mechglue context on failures from subsequent\ncalls, even if the mechanism deletes the mech-specific context (which\nis allowed by RFC 2744 but not preferred).  Check for union contexts\nwith no mechanism context in each GSS function which accepts a\ngss_ctx_id_t.\n\nCVE-2017-11462:\n\nRFC 2744 permits a GSS-API implementation to delete an existing\nsecurity context on a second or subsequent call to\ngss_init_sec_context() or gss_accept_sec_context() if the call results\nin an error.  This API behavior has been found to be dangerous,\nleading to the possibility of memory errors in some callers.  For\nsafety, GSS-API implementations should instead preserve existing\nsecurity contexts on error until the caller deletes them.\n\nAll versions of MIT krb5 prior to this change may delete acceptor\ncontexts on error.  Versions 1.13.4 through 1.13.7, 1.14.1 through\n1.14.5, and 1.15 through 1.15.1 may also delete initiator contexts on\nerror.\n\n(cherry picked from commit 56f7b1bc95a2a3eeb420e069e7655fb181ade5cf)\n\nticket: 8598\nversion_fixed: 1.14.6",
        "before_after_code_files": [
          "src/lib/gssapi/mechglue/g_accept_sec_context.c||src/lib/gssapi/mechglue/g_accept_sec_context.c",
          "src/lib/gssapi/mechglue/g_complete_auth_token.c||src/lib/gssapi/mechglue/g_complete_auth_token.c",
          "src/lib/gssapi/mechglue/g_context_time.c||src/lib/gssapi/mechglue/g_context_time.c",
          "src/lib/gssapi/mechglue/g_delete_sec_context.c||src/lib/gssapi/mechglue/g_delete_sec_context.c",
          "src/lib/gssapi/mechglue/g_exp_sec_context.c||src/lib/gssapi/mechglue/g_exp_sec_context.c",
          "src/lib/gssapi/mechglue/g_init_sec_context.c||src/lib/gssapi/mechglue/g_init_sec_context.c",
          "src/lib/gssapi/mechglue/g_inq_context.c||src/lib/gssapi/mechglue/g_inq_context.c",
          "src/lib/gssapi/mechglue/g_prf.c||src/lib/gssapi/mechglue/g_prf.c",
          "src/lib/gssapi/mechglue/g_process_context.c||src/lib/gssapi/mechglue/g_process_context.c",
          "src/lib/gssapi/mechglue/g_seal.c||src/lib/gssapi/mechglue/g_seal.c",
          "src/lib/gssapi/mechglue/g_sign.c||src/lib/gssapi/mechglue/g_sign.c",
          "src/lib/gssapi/mechglue/g_unseal.c||src/lib/gssapi/mechglue/g_unseal.c",
          "src/lib/gssapi/mechglue/g_unwrap_aead.c||src/lib/gssapi/mechglue/g_unwrap_aead.c",
          "src/lib/gssapi/mechglue/g_unwrap_iov.c||src/lib/gssapi/mechglue/g_unwrap_iov.c",
          "src/lib/gssapi/mechglue/g_verify.c||src/lib/gssapi/mechglue/g_verify.c",
          "src/lib/gssapi/mechglue/g_wrap_aead.c||src/lib/gssapi/mechglue/g_wrap_aead.c",
          "src/lib/gssapi/mechglue/g_wrap_iov.c||src/lib/gssapi/mechglue/g_wrap_iov.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/gssapi/mechglue/g_accept_sec_context.c||src/lib/gssapi/mechglue/g_accept_sec_context.c",
            "src/lib/gssapi/mechglue/g_complete_auth_token.c||src/lib/gssapi/mechglue/g_complete_auth_token.c",
            "src/lib/gssapi/mechglue/g_context_time.c||src/lib/gssapi/mechglue/g_context_time.c",
            "src/lib/gssapi/mechglue/g_delete_sec_context.c||src/lib/gssapi/mechglue/g_delete_sec_context.c",
            "src/lib/gssapi/mechglue/g_exp_sec_context.c||src/lib/gssapi/mechglue/g_exp_sec_context.c",
            "src/lib/gssapi/mechglue/g_init_sec_context.c||src/lib/gssapi/mechglue/g_init_sec_context.c",
            "src/lib/gssapi/mechglue/g_inq_context.c||src/lib/gssapi/mechglue/g_inq_context.c",
            "src/lib/gssapi/mechglue/g_prf.c||src/lib/gssapi/mechglue/g_prf.c",
            "src/lib/gssapi/mechglue/g_process_context.c||src/lib/gssapi/mechglue/g_process_context.c",
            "src/lib/gssapi/mechglue/g_seal.c||src/lib/gssapi/mechglue/g_seal.c",
            "src/lib/gssapi/mechglue/g_sign.c||src/lib/gssapi/mechglue/g_sign.c",
            "src/lib/gssapi/mechglue/g_unseal.c||src/lib/gssapi/mechglue/g_unseal.c",
            "src/lib/gssapi/mechglue/g_unwrap_aead.c||src/lib/gssapi/mechglue/g_unwrap_aead.c",
            "src/lib/gssapi/mechglue/g_unwrap_iov.c||src/lib/gssapi/mechglue/g_unwrap_iov.c",
            "src/lib/gssapi/mechglue/g_verify.c||src/lib/gssapi/mechglue/g_verify.c",
            "src/lib/gssapi/mechglue/g_wrap_aead.c||src/lib/gssapi/mechglue/g_wrap_aead.c",
            "src/lib/gssapi/mechglue/g_wrap_iov.c||src/lib/gssapi/mechglue/g_wrap_iov.c"
          ],
          "candidate": [
            "src/lib/gssapi/mechglue/g_accept_sec_context.c||src/lib/gssapi/mechglue/g_accept_sec_context.c",
            "src/lib/gssapi/mechglue/g_complete_auth_token.c||src/lib/gssapi/mechglue/g_complete_auth_token.c",
            "src/lib/gssapi/mechglue/g_context_time.c||src/lib/gssapi/mechglue/g_context_time.c",
            "src/lib/gssapi/mechglue/g_delete_sec_context.c||src/lib/gssapi/mechglue/g_delete_sec_context.c",
            "src/lib/gssapi/mechglue/g_exp_sec_context.c||src/lib/gssapi/mechglue/g_exp_sec_context.c",
            "src/lib/gssapi/mechglue/g_init_sec_context.c||src/lib/gssapi/mechglue/g_init_sec_context.c",
            "src/lib/gssapi/mechglue/g_inq_context.c||src/lib/gssapi/mechglue/g_inq_context.c",
            "src/lib/gssapi/mechglue/g_prf.c||src/lib/gssapi/mechglue/g_prf.c",
            "src/lib/gssapi/mechglue/g_process_context.c||src/lib/gssapi/mechglue/g_process_context.c",
            "src/lib/gssapi/mechglue/g_seal.c||src/lib/gssapi/mechglue/g_seal.c",
            "src/lib/gssapi/mechglue/g_sign.c||src/lib/gssapi/mechglue/g_sign.c",
            "src/lib/gssapi/mechglue/g_unseal.c||src/lib/gssapi/mechglue/g_unseal.c",
            "src/lib/gssapi/mechglue/g_unwrap_aead.c||src/lib/gssapi/mechglue/g_unwrap_aead.c",
            "src/lib/gssapi/mechglue/g_unwrap_iov.c||src/lib/gssapi/mechglue/g_unwrap_iov.c",
            "src/lib/gssapi/mechglue/g_verify.c||src/lib/gssapi/mechglue/g_verify.c",
            "src/lib/gssapi/mechglue/g_wrap_aead.c||src/lib/gssapi/mechglue/g_wrap_aead.c",
            "src/lib/gssapi/mechglue/g_wrap_iov.c||src/lib/gssapi/mechglue/g_wrap_iov.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/gssapi/mechglue/g_accept_sec_context.c||src/lib/gssapi/mechglue/g_accept_sec_context.c": [
          "File: src/lib/gssapi/mechglue/g_accept_sec_context.c -> src/lib/gssapi/mechglue/g_accept_sec_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "216:     } else {",
          "217:  union_ctx_id = (gss_union_ctx_id_t)*context_handle;",
          "218:  selected_mech = union_ctx_id->mech_type;",
          "219:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "219:  if (union_ctx_id->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "220:      return (GSS_S_NO_CONTEXT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "277:      d_cred ? &tmp_d_cred : NULL);",
          "281:   return GSS_S_CONTINUE_NEEDED;",
          "284:      if (status != GSS_S_COMPLETE) {",
          "",
          "[Removed Lines]",
          "280:      if (status == GSS_S_CONTINUE_NEEDED)",
          "",
          "[Added Lines]",
          "279:      if (status == GSS_S_CONTINUE_NEEDED) {",
          "282:      }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "365:      if (ret_flags != NULL)",
          "368:     } else {",
          "370:  status = GSS_S_BAD_MECH;",
          "371:     }",
          "373: error_out:",
          "375:  if (union_ctx_id->mech_type) {",
          "376:      if (union_ctx_id->mech_type->elements)",
          "377:   free(union_ctx_id->mech_type->elements);",
          "",
          "[Removed Lines]",
          "367:      return (status);",
          "374:     if (union_ctx_id) {",
          "",
          "[Added Lines]",
          "369:      return GSS_S_COMPLETE;",
          "383:     if (union_ctx_id && *context_handle == GSS_C_NO_CONTEXT) {",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_complete_auth_token.c||src/lib/gssapi/mechglue/g_complete_auth_token.c": [
          "File: src/lib/gssapi/mechglue/g_complete_auth_token.c -> src/lib/gssapi/mechglue/g_complete_auth_token.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "54:     ctx = (gss_union_ctx_id_t) context_handle;",
          "55:     mech = gssint_get_mechanism (ctx->mech_type);",
          "57:     if (mech != NULL) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "55:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "56:  return GSS_S_NO_CONTEXT;",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_context_time.c||src/lib/gssapi/mechglue/g_context_time.c": [
          "File: src/lib/gssapi/mechglue/g_context_time.c -> src/lib/gssapi/mechglue/g_context_time.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "60:     ctx = (gss_union_ctx_id_t) context_handle;",
          "61:     mech = gssint_get_mechanism (ctx->mech_type);",
          "63:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "61:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "62:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_delete_sec_context.c||src/lib/gssapi/mechglue/g_delete_sec_context.c": [
          "File: src/lib/gssapi/mechglue/g_delete_sec_context.c -> src/lib/gssapi/mechglue/g_delete_sec_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "87:     if (GSSINT_CHK_LOOP(ctx))",
          "88:  return (GSS_S_CALL_INACCESSIBLE_READ | GSS_S_NO_CONTEXT);",
          "98:     free(ctx->mech_type->elements);",
          "",
          "[Removed Lines]",
          "90:     status = gssint_delete_internal_sec_context(minor_status,",
          "91:       ctx->mech_type,",
          "92:       &ctx->internal_ctx_id,",
          "93:       output_token);",
          "94:     if (status)",
          "95:  return status;",
          "",
          "[Added Lines]",
          "90:     if (ctx->internal_ctx_id != GSS_C_NO_CONTEXT) {",
          "91:  status = gssint_delete_internal_sec_context(minor_status,",
          "92:           ctx->mech_type,",
          "93:           &ctx->internal_ctx_id,",
          "94:           output_token);",
          "95:  if (status)",
          "96:      return status;",
          "97:     }",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_exp_sec_context.c||src/lib/gssapi/mechglue/g_exp_sec_context.c": [
          "File: src/lib/gssapi/mechglue/g_exp_sec_context.c -> src/lib/gssapi/mechglue/g_exp_sec_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "97:     ctx = (gss_union_ctx_id_t) *context_handle;",
          "98:     mech = gssint_get_mechanism (ctx->mech_type);",
          "99:     if (!mech)",
          "100:  return GSS_S_BAD_MECH;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "98:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "99:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_init_sec_context.c||src/lib/gssapi/mechglue/g_init_sec_context.c": [
          "File: src/lib/gssapi/mechglue/g_init_sec_context.c -> src/lib/gssapi/mechglue/g_init_sec_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "194:  union_ctx_id->internal_ctx_id = GSS_C_NO_CONTEXT;",
          "196:  union_ctx_id = (gss_union_ctx_id_t)*context_handle;",
          "",
          "[Removed Lines]",
          "195:     } else",
          "",
          "[Added Lines]",
          "195:     } else {",
          "197:  if (union_ctx_id->internal_ctx_id == GSS_C_NO_CONTEXT) {",
          "198:      status = GSS_S_NO_CONTEXT;",
          "199:      goto end;",
          "200:  }",
          "201:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "225:     if (status != GSS_S_COMPLETE && status != GSS_S_CONTINUE_NEEDED) {",
          "233:  map_error(minor_status, mech);",
          "236:  if (*context_handle == GSS_C_NO_CONTEXT) {",
          "237:      free(union_ctx_id->mech_type->elements);",
          "238:      free(union_ctx_id->mech_type);",
          "",
          "[Removed Lines]",
          "234:  if (union_ctx_id->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_inq_context.c||src/lib/gssapi/mechglue/g_inq_context.c": [
          "File: src/lib/gssapi/mechglue/g_inq_context.c -> src/lib/gssapi/mechglue/g_inq_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "106:     ctx = (gss_union_ctx_id_t) context_handle;",
          "107:     mech = gssint_get_mechanism (ctx->mech_type);",
          "109:     if (!mech || !mech->gss_inquire_context || !mech->gss_display_name ||",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "107:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "108:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_prf.c||src/lib/gssapi/mechglue/g_prf.c": [
          "File: src/lib/gssapi/mechglue/g_prf.c -> src/lib/gssapi/mechglue/g_prf.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "61:     ctx = (gss_union_ctx_id_t) context_handle;",
          "62:     mech = gssint_get_mechanism (ctx->mech_type);",
          "64:     if (mech != NULL) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "62:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "63:  return GSS_S_NO_CONTEXT;",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_process_context.c||src/lib/gssapi/mechglue/g_process_context.c": [
          "File: src/lib/gssapi/mechglue/g_process_context.c -> src/lib/gssapi/mechglue/g_process_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "63:     ctx = (gss_union_ctx_id_t) context_handle;",
          "64:     mech = gssint_get_mechanism (ctx->mech_type);",
          "66:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "64:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "65:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_seal.c||src/lib/gssapi/mechglue/g_seal.c": [
          "File: src/lib/gssapi/mechglue/g_seal.c -> src/lib/gssapi/mechglue/g_seal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "94:     ctx = (gss_union_ctx_id_t) context_handle;",
          "95:     mech = gssint_get_mechanism (ctx->mech_type);",
          "97:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "95:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "96:         return (GSS_S_NO_CONTEXT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "228:     ctx = (gss_union_ctx_id_t) context_handle;",
          "229:     mech = gssint_get_mechanism (ctx->mech_type);",
          "231:     if (!mech)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "231:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "232:         return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_sign.c||src/lib/gssapi/mechglue/g_sign.c": [
          "File: src/lib/gssapi/mechglue/g_sign.c -> src/lib/gssapi/mechglue/g_sign.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "96:     ctx = (gss_union_ctx_id_t) context_handle;",
          "97:     mech = gssint_get_mechanism (ctx->mech_type);",
          "99:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "97:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "98:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_unseal.c||src/lib/gssapi/mechglue/g_unseal.c": [
          "File: src/lib/gssapi/mechglue/g_unseal.c -> src/lib/gssapi/mechglue/g_unseal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "78:     ctx = (gss_union_ctx_id_t) context_handle;",
          "79:     mech = gssint_get_mechanism (ctx->mech_type);",
          "81:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "79:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "80:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_unwrap_aead.c||src/lib/gssapi/mechglue/g_unwrap_aead.c": [
          "File: src/lib/gssapi/mechglue/g_unwrap_aead.c -> src/lib/gssapi/mechglue/g_unwrap_aead.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "188:     ctx = (gss_union_ctx_id_t) context_handle;",
          "189:     mech = gssint_get_mechanism (ctx->mech_type);",
          "191:     if (!mech)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "189:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "190:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_unwrap_iov.c||src/lib/gssapi/mechglue/g_unwrap_iov.c": [
          "File: src/lib/gssapi/mechglue/g_unwrap_iov.c -> src/lib/gssapi/mechglue/g_unwrap_iov.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "91:     ctx = (gss_union_ctx_id_t) context_handle;",
          "92:     mech = gssint_get_mechanism (ctx->mech_type);",
          "94:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "92:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "93:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "130:     ctx = (gss_union_ctx_id_t)context_handle;",
          "131:     mech = gssint_get_mechanism(ctx->mech_type);",
          "132:     if (mech == NULL)",
          "133:  return GSS_S_BAD_MECH;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "133:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "134:  return GSS_S_NO_CONTEXT;",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_verify.c||src/lib/gssapi/mechglue/g_verify.c": [
          "File: src/lib/gssapi/mechglue/g_verify.c -> src/lib/gssapi/mechglue/g_verify.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "67:     ctx = (gss_union_ctx_id_t) context_handle;",
          "68:     mech = gssint_get_mechanism (ctx->mech_type);",
          "70:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "68:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "69:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_wrap_aead.c||src/lib/gssapi/mechglue/g_wrap_aead.c": [
          "File: src/lib/gssapi/mechglue/g_wrap_aead.c -> src/lib/gssapi/mechglue/g_wrap_aead.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "258:     ctx = (gss_union_ctx_id_t)context_handle;",
          "259:     mech = gssint_get_mechanism (ctx->mech_type);",
          "260:     if (!mech)",
          "261:  return (GSS_S_BAD_MECH);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "259:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "260:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_wrap_iov.c||src/lib/gssapi/mechglue/g_wrap_iov.c": [
          "File: src/lib/gssapi/mechglue/g_wrap_iov.c -> src/lib/gssapi/mechglue/g_wrap_iov.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "95:     ctx = (gss_union_ctx_id_t) context_handle;",
          "96:     mech = gssint_get_mechanism (ctx->mech_type);",
          "98:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "96:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "97:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "153:     ctx = (gss_union_ctx_id_t) context_handle;",
          "154:     mech = gssint_get_mechanism (ctx->mech_type);",
          "156:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "156:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "157:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "192:     ctx = (gss_union_ctx_id_t)context_handle;",
          "193:     mech = gssint_get_mechanism(ctx->mech_type);",
          "194:     if (mech == NULL)",
          "195:  return GSS_S_BAD_MECH;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "197:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "198:  return GSS_S_NO_CONTEXT;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "220:     ctx = (gss_union_ctx_id_t)context_handle;",
          "221:     mech = gssint_get_mechanism(ctx->mech_type);",
          "222:     if (mech == NULL)",
          "223:  return GSS_S_BAD_MECH;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "227:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "228:  return GSS_S_NO_CONTEXT;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3659e55443962a50fdbe564bc5333e32dafd22f9",
      "candidate_info": {
        "commit_hash": "3659e55443962a50fdbe564bc5333e32dafd22f9",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/3659e55443962a50fdbe564bc5333e32dafd22f9",
        "files": [
          "src/lib/gssapi/mechglue/g_accept_sec_context.c",
          "src/lib/gssapi/mechglue/g_complete_auth_token.c",
          "src/lib/gssapi/mechglue/g_context_time.c",
          "src/lib/gssapi/mechglue/g_delete_sec_context.c",
          "src/lib/gssapi/mechglue/g_exp_sec_context.c",
          "src/lib/gssapi/mechglue/g_init_sec_context.c",
          "src/lib/gssapi/mechglue/g_inq_context.c",
          "src/lib/gssapi/mechglue/g_prf.c",
          "src/lib/gssapi/mechglue/g_process_context.c",
          "src/lib/gssapi/mechglue/g_seal.c",
          "src/lib/gssapi/mechglue/g_sign.c",
          "src/lib/gssapi/mechglue/g_unseal.c",
          "src/lib/gssapi/mechglue/g_unwrap_aead.c",
          "src/lib/gssapi/mechglue/g_unwrap_iov.c",
          "src/lib/gssapi/mechglue/g_verify.c",
          "src/lib/gssapi/mechglue/g_wrap_aead.c",
          "src/lib/gssapi/mechglue/g_wrap_iov.c"
        ],
        "message": "Preserve GSS context on init/accept failure\n\nAfter gss_init_sec_context() or gss_accept_sec_context() has created a\ncontext, don't delete the mechglue context on failures from subsequent\ncalls, even if the mechanism deletes the mech-specific context (which\nis allowed by RFC 2744 but not preferred).  Check for union contexts\nwith no mechanism context in each GSS function which accepts a\ngss_ctx_id_t.\n\nCVE-2017-11462:\n\nRFC 2744 permits a GSS-API implementation to delete an existing\nsecurity context on a second or subsequent call to\ngss_init_sec_context() or gss_accept_sec_context() if the call results\nin an error.  This API behavior has been found to be dangerous,\nleading to the possibility of memory errors in some callers.  For\nsafety, GSS-API implementations should instead preserve existing\nsecurity contexts on error until the caller deletes them.\n\nAll versions of MIT krb5 prior to this change may delete acceptor\ncontexts on error.  Versions 1.13.4 through 1.13.7, 1.14.1 through\n1.14.5, and 1.15 through 1.15.1 may also delete initiator contexts on\nerror.\n\n(cherry picked from commit 56f7b1bc95a2a3eeb420e069e7655fb181ade5cf)\n\nticket: 8598\nversion_fixed: 1.15.2",
        "before_after_code_files": [
          "src/lib/gssapi/mechglue/g_accept_sec_context.c||src/lib/gssapi/mechglue/g_accept_sec_context.c",
          "src/lib/gssapi/mechglue/g_complete_auth_token.c||src/lib/gssapi/mechglue/g_complete_auth_token.c",
          "src/lib/gssapi/mechglue/g_context_time.c||src/lib/gssapi/mechglue/g_context_time.c",
          "src/lib/gssapi/mechglue/g_delete_sec_context.c||src/lib/gssapi/mechglue/g_delete_sec_context.c",
          "src/lib/gssapi/mechglue/g_exp_sec_context.c||src/lib/gssapi/mechglue/g_exp_sec_context.c",
          "src/lib/gssapi/mechglue/g_init_sec_context.c||src/lib/gssapi/mechglue/g_init_sec_context.c",
          "src/lib/gssapi/mechglue/g_inq_context.c||src/lib/gssapi/mechglue/g_inq_context.c",
          "src/lib/gssapi/mechglue/g_prf.c||src/lib/gssapi/mechglue/g_prf.c",
          "src/lib/gssapi/mechglue/g_process_context.c||src/lib/gssapi/mechglue/g_process_context.c",
          "src/lib/gssapi/mechglue/g_seal.c||src/lib/gssapi/mechglue/g_seal.c",
          "src/lib/gssapi/mechglue/g_sign.c||src/lib/gssapi/mechglue/g_sign.c",
          "src/lib/gssapi/mechglue/g_unseal.c||src/lib/gssapi/mechglue/g_unseal.c",
          "src/lib/gssapi/mechglue/g_unwrap_aead.c||src/lib/gssapi/mechglue/g_unwrap_aead.c",
          "src/lib/gssapi/mechglue/g_unwrap_iov.c||src/lib/gssapi/mechglue/g_unwrap_iov.c",
          "src/lib/gssapi/mechglue/g_verify.c||src/lib/gssapi/mechglue/g_verify.c",
          "src/lib/gssapi/mechglue/g_wrap_aead.c||src/lib/gssapi/mechglue/g_wrap_aead.c",
          "src/lib/gssapi/mechglue/g_wrap_iov.c||src/lib/gssapi/mechglue/g_wrap_iov.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/gssapi/mechglue/g_accept_sec_context.c||src/lib/gssapi/mechglue/g_accept_sec_context.c",
            "src/lib/gssapi/mechglue/g_complete_auth_token.c||src/lib/gssapi/mechglue/g_complete_auth_token.c",
            "src/lib/gssapi/mechglue/g_context_time.c||src/lib/gssapi/mechglue/g_context_time.c",
            "src/lib/gssapi/mechglue/g_delete_sec_context.c||src/lib/gssapi/mechglue/g_delete_sec_context.c",
            "src/lib/gssapi/mechglue/g_exp_sec_context.c||src/lib/gssapi/mechglue/g_exp_sec_context.c",
            "src/lib/gssapi/mechglue/g_init_sec_context.c||src/lib/gssapi/mechglue/g_init_sec_context.c",
            "src/lib/gssapi/mechglue/g_inq_context.c||src/lib/gssapi/mechglue/g_inq_context.c",
            "src/lib/gssapi/mechglue/g_prf.c||src/lib/gssapi/mechglue/g_prf.c",
            "src/lib/gssapi/mechglue/g_process_context.c||src/lib/gssapi/mechglue/g_process_context.c",
            "src/lib/gssapi/mechglue/g_seal.c||src/lib/gssapi/mechglue/g_seal.c",
            "src/lib/gssapi/mechglue/g_sign.c||src/lib/gssapi/mechglue/g_sign.c",
            "src/lib/gssapi/mechglue/g_unseal.c||src/lib/gssapi/mechglue/g_unseal.c",
            "src/lib/gssapi/mechglue/g_unwrap_aead.c||src/lib/gssapi/mechglue/g_unwrap_aead.c",
            "src/lib/gssapi/mechglue/g_unwrap_iov.c||src/lib/gssapi/mechglue/g_unwrap_iov.c",
            "src/lib/gssapi/mechglue/g_verify.c||src/lib/gssapi/mechglue/g_verify.c",
            "src/lib/gssapi/mechglue/g_wrap_aead.c||src/lib/gssapi/mechglue/g_wrap_aead.c",
            "src/lib/gssapi/mechglue/g_wrap_iov.c||src/lib/gssapi/mechglue/g_wrap_iov.c"
          ],
          "candidate": [
            "src/lib/gssapi/mechglue/g_accept_sec_context.c||src/lib/gssapi/mechglue/g_accept_sec_context.c",
            "src/lib/gssapi/mechglue/g_complete_auth_token.c||src/lib/gssapi/mechglue/g_complete_auth_token.c",
            "src/lib/gssapi/mechglue/g_context_time.c||src/lib/gssapi/mechglue/g_context_time.c",
            "src/lib/gssapi/mechglue/g_delete_sec_context.c||src/lib/gssapi/mechglue/g_delete_sec_context.c",
            "src/lib/gssapi/mechglue/g_exp_sec_context.c||src/lib/gssapi/mechglue/g_exp_sec_context.c",
            "src/lib/gssapi/mechglue/g_init_sec_context.c||src/lib/gssapi/mechglue/g_init_sec_context.c",
            "src/lib/gssapi/mechglue/g_inq_context.c||src/lib/gssapi/mechglue/g_inq_context.c",
            "src/lib/gssapi/mechglue/g_prf.c||src/lib/gssapi/mechglue/g_prf.c",
            "src/lib/gssapi/mechglue/g_process_context.c||src/lib/gssapi/mechglue/g_process_context.c",
            "src/lib/gssapi/mechglue/g_seal.c||src/lib/gssapi/mechglue/g_seal.c",
            "src/lib/gssapi/mechglue/g_sign.c||src/lib/gssapi/mechglue/g_sign.c",
            "src/lib/gssapi/mechglue/g_unseal.c||src/lib/gssapi/mechglue/g_unseal.c",
            "src/lib/gssapi/mechglue/g_unwrap_aead.c||src/lib/gssapi/mechglue/g_unwrap_aead.c",
            "src/lib/gssapi/mechglue/g_unwrap_iov.c||src/lib/gssapi/mechglue/g_unwrap_iov.c",
            "src/lib/gssapi/mechglue/g_verify.c||src/lib/gssapi/mechglue/g_verify.c",
            "src/lib/gssapi/mechglue/g_wrap_aead.c||src/lib/gssapi/mechglue/g_wrap_aead.c",
            "src/lib/gssapi/mechglue/g_wrap_iov.c||src/lib/gssapi/mechglue/g_wrap_iov.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/gssapi/mechglue/g_accept_sec_context.c||src/lib/gssapi/mechglue/g_accept_sec_context.c": [
          "File: src/lib/gssapi/mechglue/g_accept_sec_context.c -> src/lib/gssapi/mechglue/g_accept_sec_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "216:     } else {",
          "217:  union_ctx_id = (gss_union_ctx_id_t)*context_handle;",
          "218:  selected_mech = union_ctx_id->mech_type;",
          "219:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "219:  if (union_ctx_id->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "220:      return (GSS_S_NO_CONTEXT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "277:      d_cred ? &tmp_d_cred : NULL);",
          "281:   return GSS_S_CONTINUE_NEEDED;",
          "284:      if (status != GSS_S_COMPLETE) {",
          "",
          "[Removed Lines]",
          "280:      if (status == GSS_S_CONTINUE_NEEDED)",
          "",
          "[Added Lines]",
          "279:      if (status == GSS_S_CONTINUE_NEEDED) {",
          "282:      }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "365:      if (ret_flags != NULL)",
          "368:     } else {",
          "370:  status = GSS_S_BAD_MECH;",
          "371:     }",
          "373: error_out:",
          "375:  if (union_ctx_id->mech_type) {",
          "376:      if (union_ctx_id->mech_type->elements)",
          "377:   free(union_ctx_id->mech_type->elements);",
          "",
          "[Removed Lines]",
          "367:      return (status);",
          "374:     if (union_ctx_id) {",
          "",
          "[Added Lines]",
          "369:      return GSS_S_COMPLETE;",
          "383:     if (union_ctx_id && *context_handle == GSS_C_NO_CONTEXT) {",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_complete_auth_token.c||src/lib/gssapi/mechglue/g_complete_auth_token.c": [
          "File: src/lib/gssapi/mechglue/g_complete_auth_token.c -> src/lib/gssapi/mechglue/g_complete_auth_token.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "54:     ctx = (gss_union_ctx_id_t) context_handle;",
          "55:     mech = gssint_get_mechanism (ctx->mech_type);",
          "57:     if (mech != NULL) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "55:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "56:  return GSS_S_NO_CONTEXT;",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_context_time.c||src/lib/gssapi/mechglue/g_context_time.c": [
          "File: src/lib/gssapi/mechglue/g_context_time.c -> src/lib/gssapi/mechglue/g_context_time.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "60:     ctx = (gss_union_ctx_id_t) context_handle;",
          "61:     mech = gssint_get_mechanism (ctx->mech_type);",
          "63:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "61:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "62:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_delete_sec_context.c||src/lib/gssapi/mechglue/g_delete_sec_context.c": [
          "File: src/lib/gssapi/mechglue/g_delete_sec_context.c -> src/lib/gssapi/mechglue/g_delete_sec_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "87:     if (GSSINT_CHK_LOOP(ctx))",
          "88:  return (GSS_S_CALL_INACCESSIBLE_READ | GSS_S_NO_CONTEXT);",
          "98:     free(ctx->mech_type->elements);",
          "",
          "[Removed Lines]",
          "90:     status = gssint_delete_internal_sec_context(minor_status,",
          "91:       ctx->mech_type,",
          "92:       &ctx->internal_ctx_id,",
          "93:       output_token);",
          "94:     if (status)",
          "95:  return status;",
          "",
          "[Added Lines]",
          "90:     if (ctx->internal_ctx_id != GSS_C_NO_CONTEXT) {",
          "91:  status = gssint_delete_internal_sec_context(minor_status,",
          "92:           ctx->mech_type,",
          "93:           &ctx->internal_ctx_id,",
          "94:           output_token);",
          "95:  if (status)",
          "96:      return status;",
          "97:     }",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_exp_sec_context.c||src/lib/gssapi/mechglue/g_exp_sec_context.c": [
          "File: src/lib/gssapi/mechglue/g_exp_sec_context.c -> src/lib/gssapi/mechglue/g_exp_sec_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "97:     ctx = (gss_union_ctx_id_t) *context_handle;",
          "98:     mech = gssint_get_mechanism (ctx->mech_type);",
          "99:     if (!mech)",
          "100:  return GSS_S_BAD_MECH;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "98:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "99:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_init_sec_context.c||src/lib/gssapi/mechglue/g_init_sec_context.c": [
          "File: src/lib/gssapi/mechglue/g_init_sec_context.c -> src/lib/gssapi/mechglue/g_init_sec_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "194:  union_ctx_id->internal_ctx_id = GSS_C_NO_CONTEXT;",
          "196:  union_ctx_id = (gss_union_ctx_id_t)*context_handle;",
          "",
          "[Removed Lines]",
          "195:     } else",
          "",
          "[Added Lines]",
          "195:     } else {",
          "197:  if (union_ctx_id->internal_ctx_id == GSS_C_NO_CONTEXT) {",
          "198:      status = GSS_S_NO_CONTEXT;",
          "199:      goto end;",
          "200:  }",
          "201:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "225:     if (status != GSS_S_COMPLETE && status != GSS_S_CONTINUE_NEEDED) {",
          "233:  map_error(minor_status, mech);",
          "236:  if (*context_handle == GSS_C_NO_CONTEXT) {",
          "237:      free(union_ctx_id->mech_type->elements);",
          "238:      free(union_ctx_id->mech_type);",
          "",
          "[Removed Lines]",
          "234:  if (union_ctx_id->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_inq_context.c||src/lib/gssapi/mechglue/g_inq_context.c": [
          "File: src/lib/gssapi/mechglue/g_inq_context.c -> src/lib/gssapi/mechglue/g_inq_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "106:     ctx = (gss_union_ctx_id_t) context_handle;",
          "107:     mech = gssint_get_mechanism (ctx->mech_type);",
          "109:     if (!mech || !mech->gss_inquire_context || !mech->gss_display_name ||",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "107:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "108:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_prf.c||src/lib/gssapi/mechglue/g_prf.c": [
          "File: src/lib/gssapi/mechglue/g_prf.c -> src/lib/gssapi/mechglue/g_prf.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "61:     ctx = (gss_union_ctx_id_t) context_handle;",
          "62:     mech = gssint_get_mechanism (ctx->mech_type);",
          "64:     if (mech != NULL) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "62:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "63:  return GSS_S_NO_CONTEXT;",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_process_context.c||src/lib/gssapi/mechglue/g_process_context.c": [
          "File: src/lib/gssapi/mechglue/g_process_context.c -> src/lib/gssapi/mechglue/g_process_context.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "63:     ctx = (gss_union_ctx_id_t) context_handle;",
          "64:     mech = gssint_get_mechanism (ctx->mech_type);",
          "66:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "64:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "65:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_seal.c||src/lib/gssapi/mechglue/g_seal.c": [
          "File: src/lib/gssapi/mechglue/g_seal.c -> src/lib/gssapi/mechglue/g_seal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "94:     ctx = (gss_union_ctx_id_t) context_handle;",
          "95:     mech = gssint_get_mechanism (ctx->mech_type);",
          "97:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "95:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "96:         return (GSS_S_NO_CONTEXT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "228:     ctx = (gss_union_ctx_id_t) context_handle;",
          "229:     mech = gssint_get_mechanism (ctx->mech_type);",
          "231:     if (!mech)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "231:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "232:         return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_sign.c||src/lib/gssapi/mechglue/g_sign.c": [
          "File: src/lib/gssapi/mechglue/g_sign.c -> src/lib/gssapi/mechglue/g_sign.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "96:     ctx = (gss_union_ctx_id_t) context_handle;",
          "97:     mech = gssint_get_mechanism (ctx->mech_type);",
          "99:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "97:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "98:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_unseal.c||src/lib/gssapi/mechglue/g_unseal.c": [
          "File: src/lib/gssapi/mechglue/g_unseal.c -> src/lib/gssapi/mechglue/g_unseal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "78:     ctx = (gss_union_ctx_id_t) context_handle;",
          "79:     mech = gssint_get_mechanism (ctx->mech_type);",
          "81:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "79:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "80:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_unwrap_aead.c||src/lib/gssapi/mechglue/g_unwrap_aead.c": [
          "File: src/lib/gssapi/mechglue/g_unwrap_aead.c -> src/lib/gssapi/mechglue/g_unwrap_aead.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "188:     ctx = (gss_union_ctx_id_t) context_handle;",
          "189:     mech = gssint_get_mechanism (ctx->mech_type);",
          "191:     if (!mech)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "189:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "190:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_unwrap_iov.c||src/lib/gssapi/mechglue/g_unwrap_iov.c": [
          "File: src/lib/gssapi/mechglue/g_unwrap_iov.c -> src/lib/gssapi/mechglue/g_unwrap_iov.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "91:     ctx = (gss_union_ctx_id_t) context_handle;",
          "92:     mech = gssint_get_mechanism (ctx->mech_type);",
          "94:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "92:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "93:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "130:     ctx = (gss_union_ctx_id_t)context_handle;",
          "131:     mech = gssint_get_mechanism(ctx->mech_type);",
          "132:     if (mech == NULL)",
          "133:  return GSS_S_BAD_MECH;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "133:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "134:  return GSS_S_NO_CONTEXT;",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_verify.c||src/lib/gssapi/mechglue/g_verify.c": [
          "File: src/lib/gssapi/mechglue/g_verify.c -> src/lib/gssapi/mechglue/g_verify.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "67:     ctx = (gss_union_ctx_id_t) context_handle;",
          "68:     mech = gssint_get_mechanism (ctx->mech_type);",
          "70:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "68:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "69:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_wrap_aead.c||src/lib/gssapi/mechglue/g_wrap_aead.c": [
          "File: src/lib/gssapi/mechglue/g_wrap_aead.c -> src/lib/gssapi/mechglue/g_wrap_aead.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "258:     ctx = (gss_union_ctx_id_t)context_handle;",
          "259:     mech = gssint_get_mechanism (ctx->mech_type);",
          "260:     if (!mech)",
          "261:  return (GSS_S_BAD_MECH);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "259:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "260:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------"
        ],
        "src/lib/gssapi/mechglue/g_wrap_iov.c||src/lib/gssapi/mechglue/g_wrap_iov.c": [
          "File: src/lib/gssapi/mechglue/g_wrap_iov.c -> src/lib/gssapi/mechglue/g_wrap_iov.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "95:     ctx = (gss_union_ctx_id_t) context_handle;",
          "96:     mech = gssint_get_mechanism (ctx->mech_type);",
          "98:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "96:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "97:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "153:     ctx = (gss_union_ctx_id_t) context_handle;",
          "154:     mech = gssint_get_mechanism (ctx->mech_type);",
          "156:     if (mech) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "156:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "157:  return (GSS_S_NO_CONTEXT);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "192:     ctx = (gss_union_ctx_id_t)context_handle;",
          "193:     mech = gssint_get_mechanism(ctx->mech_type);",
          "194:     if (mech == NULL)",
          "195:  return GSS_S_BAD_MECH;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "197:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "198:  return GSS_S_NO_CONTEXT;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "220:     ctx = (gss_union_ctx_id_t)context_handle;",
          "221:     mech = gssint_get_mechanism(ctx->mech_type);",
          "222:     if (mech == NULL)",
          "223:  return GSS_S_BAD_MECH;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "227:     if (ctx->internal_ctx_id == GSS_C_NO_CONTEXT)",
          "228:  return GSS_S_NO_CONTEXT;",
          "",
          "---------------"
        ]
      }
    }
  ]
}