{
  "cve_id": "CVE-2017-10965",
  "cve_desc": "An issue was discovered in Irssi before 1.0.4. When receiving messages with invalid time stamps, Irssi would try to dereference a NULL pointer.",
  "repo": "irssi/irssi",
  "patch_hash": "5e26325317c72a04c1610ad952974e206384d291",
  "patch_info": {
    "commit_hash": "5e26325317c72a04c1610ad952974e206384d291",
    "repo": "irssi/irssi",
    "commit_url": "https://github.com/irssi/irssi/commit/5e26325317c72a04c1610ad952974e206384d291",
    "files": [
      "src/core/misc.c",
      "src/core/nicklist.c"
    ],
    "message": "Merge branch 'security' into 'master'\n\nSecurity\n\nCloses #10\n\nSee merge request !17",
    "before_after_code_files": [
      "src/core/misc.c||src/core/misc.c",
      "src/core/nicklist.c||src/core/nicklist.c"
    ]
  },
  "patch_diff": {
    "src/core/misc.c||src/core/misc.c": [
      "File: src/core/misc.c -> src/core/misc.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "556:         int len;",
      "558:  tm = localtime(&t);",
      "559:  str = g_strdup(asctime(tm));",
      "561:  len = strlen(str);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "559:  if (tm == NULL)",
      "560:      return g_strdup(\"???\");",
      "",
      "---------------"
    ],
    "src/core/nicklist.c||src/core/nicklist.c": [
      "File: src/core/nicklist.c -> src/core/nicklist.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "55: static void nick_hash_remove(CHANNEL_REC *channel, NICK_REC *nick)",
      "56: {",
      "59:  list = g_hash_table_lookup(channel->nicks, nick->nick);",
      "60:  if (list == NULL)",
      "61:   return;",
      "69:  } else {",
      "70:   while (list->next != nick)",
      "71:    list = list->next;",
      "72:   list->next = nick->next;",
      "73:  }",
      "74: }",
      "",
      "[Removed Lines]",
      "57:  NICK_REC *list;",
      "63:  if (list == nick || list->next == NULL) {",
      "64:   g_hash_table_remove(channel->nicks, nick->nick);",
      "65:   if (list->next != NULL) {",
      "66:    g_hash_table_insert(channel->nicks, nick->next->nick,",
      "67:          nick->next);",
      "68:   }",
      "",
      "[Added Lines]",
      "57:  NICK_REC *list, *newlist;",
      "63:  if (list == nick) {",
      "64:   newlist = nick->next;",
      "66:   newlist = list;",
      "72:  g_hash_table_remove(channel->nicks, nick->nick);",
      "73:  if (newlist != NULL) {",
      "74:   g_hash_table_insert(channel->nicks, newlist->nick,",
      "75:         newlist);",
      "76:  }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5e46c6dda0993aff058baba03726d4454139ccfe",
      "candidate_info": {
        "commit_hash": "5e46c6dda0993aff058baba03726d4454139ccfe",
        "repo": "irssi/irssi",
        "commit_url": "https://github.com/irssi/irssi/commit/5e46c6dda0993aff058baba03726d4454139ccfe",
        "files": [
          "src/core/misc.c",
          "src/core/nicklist.c"
        ],
        "message": "Merge branch 'security' into 'master'\n\nSecurity\n\nCloses #10\n\nSee merge request !17\n\n(cherry picked from commit 5e26325317c72a04c1610ad952974e206384d291)",
        "before_after_code_files": [
          "src/core/misc.c||src/core/misc.c",
          "src/core/nicklist.c||src/core/nicklist.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/core/misc.c||src/core/misc.c",
            "src/core/nicklist.c||src/core/nicklist.c"
          ],
          "candidate": [
            "src/core/misc.c||src/core/misc.c",
            "src/core/nicklist.c||src/core/nicklist.c"
          ]
        }
      },
      "candidate_diff": {
        "src/core/misc.c||src/core/misc.c": [
          "File: src/core/misc.c -> src/core/misc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "560:         int len;",
          "562:  tm = localtime(&t);",
          "563:  str = g_strdup(asctime(tm));",
          "565:  len = strlen(str);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "563:  if (tm == NULL)",
          "564:      return g_strdup(\"???\");",
          "",
          "---------------"
        ],
        "src/core/nicklist.c||src/core/nicklist.c": [
          "File: src/core/nicklist.c -> src/core/nicklist.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "55: static void nick_hash_remove(CHANNEL_REC *channel, NICK_REC *nick)",
          "56: {",
          "59:  list = g_hash_table_lookup(channel->nicks, nick->nick);",
          "60:  if (list == NULL)",
          "61:   return;",
          "69:  } else {",
          "70:   while (list->next != nick)",
          "71:    list = list->next;",
          "72:   list->next = nick->next;",
          "73:  }",
          "74: }",
          "",
          "[Removed Lines]",
          "57:  NICK_REC *list;",
          "63:  if (list == nick || list->next == NULL) {",
          "64:   g_hash_table_remove(channel->nicks, nick->nick);",
          "65:   if (list->next != NULL) {",
          "66:    g_hash_table_insert(channel->nicks, nick->next->nick,",
          "67:          nick->next);",
          "68:   }",
          "",
          "[Added Lines]",
          "57:  NICK_REC *list, *newlist;",
          "63:  if (list == nick) {",
          "64:   newlist = nick->next;",
          "66:   newlist = list;",
          "72:  g_hash_table_remove(channel->nicks, nick->nick);",
          "73:  if (newlist != NULL) {",
          "74:   g_hash_table_insert(channel->nicks, newlist->nick,",
          "75:         newlist);",
          "76:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "29ebac987da1da2c892aed5ed329256b7bc94bca",
      "candidate_info": {
        "commit_hash": "29ebac987da1da2c892aed5ed329256b7bc94bca",
        "repo": "irssi/irssi",
        "commit_url": "https://github.com/irssi/irssi/commit/29ebac987da1da2c892aed5ed329256b7bc94bca",
        "files": [
          "src/core/misc.c"
        ],
        "message": "Check return value of localtime\n\nFixes #10",
        "before_after_code_files": [
          "src/core/misc.c||src/core/misc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "src/core/misc.c||src/core/misc.c"
          ],
          "candidate": [
            "src/core/misc.c||src/core/misc.c"
          ]
        }
      },
      "candidate_diff": {
        "src/core/misc.c||src/core/misc.c": [
          "File: src/core/misc.c -> src/core/misc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "560:         int len;",
          "562:  tm = localtime(&t);",
          "563:  str = g_strdup(asctime(tm));",
          "565:  len = strlen(str);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "563:  if (tm == NULL)",
          "564:      return g_strdup(\"???\");",
          "",
          "---------------"
        ]
      }
    }
  ]
}