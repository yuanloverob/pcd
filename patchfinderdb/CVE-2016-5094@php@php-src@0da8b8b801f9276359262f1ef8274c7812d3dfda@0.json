{
  "cve_id": "CVE-2016-5094",
  "cve_desc": "Integer overflow in the php_html_entities function in ext/standard/html.c in PHP before 5.5.36 and 5.6.x before 5.6.22 allows remote attackers to cause a denial of service or possibly have unspecified other impact by triggering a large output string from the htmlspecialchars function.",
  "repo": "php/php-src",
  "patch_hash": "0da8b8b801f9276359262f1ef8274c7812d3dfda",
  "patch_info": {
    "commit_hash": "0da8b8b801f9276359262f1ef8274c7812d3dfda",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/0da8b8b801f9276359262f1ef8274c7812d3dfda",
    "files": [
      "ext/standard/html.c"
    ],
    "message": "Fix bug #72135 - don't create strings with lengths outside int range",
    "before_after_code_files": [
      "ext/standard/html.c||ext/standard/html.c"
    ]
  },
  "patch_diff": {
    "ext/standard/html.c||ext/standard/html.c": [
      "File: ext/standard/html.c -> ext/standard/html.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "572:   if (code > 0xFF) {",
      "573:    return FAILURE;",
      "576:   break;",
      "",
      "[Removed Lines]",
      "574:   }",
      "",
      "[Added Lines]",
      "574:   }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1111:  if (retlen == 0) {",
      "1112:   goto empty_source;",
      "1113:  }",
      "1115:  inverse_map = unescape_inverse_map(all, flags);",
      "1118:  traverse_for_entities(old, oldlen, ret, &retlen, all, flags, inverse_map, charset);",
      "1122:  return ret;",
      "1123: }",
      "",
      "[Removed Lines]",
      "1120: empty_source:",
      "",
      "[Added Lines]",
      "1120: empty_source:",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1162:   if (!(*cursor < oldlen))",
      "1163:    goto no_suitable_2nd;",
      "1167:   if (status == FAILURE)",
      "1168:    goto no_suitable_2nd;",
      "",
      "[Removed Lines]",
      "1165:   next_char = get_next_char(charset, old, oldlen, cursor, &status);",
      "",
      "[Added Lines]",
      "1165:   next_char = get_next_char(charset, old, oldlen, cursor, &status);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1188:    c->data.multicodepoint_table[0].leading_entry.default_entity;",
      "1191: }",
      "",
      "[Removed Lines]",
      "1190:  }",
      "",
      "[Added Lines]",
      "1190:  }",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1257:  if (oldlen < 64) {",
      "1259:  } else {",
      "1260:   maxlen = 2 * oldlen;",
      "1261:   if (maxlen < oldlen) {",
      "",
      "[Removed Lines]",
      "1258:   maxlen = 128;",
      "",
      "[Added Lines]",
      "1258:   maxlen = 128;",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1444:  }",
      "1446:  replaced = php_escape_html_entities_ex(str, str_len, &new_len, all, (int) flags, hint_charset, double_encode TSRMLS_CC);",
      "1447:  RETVAL_STRINGL(replaced, (int)new_len, 0);",
      "1448: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1447:  if (new_len > INT_MAX) {",
      "1448:   efree(replaced);",
      "1449:   RETURN_FALSE;",
      "1450:  }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e9559131152ab0fa89737db11ebe8f43e1435b96",
      "candidate_info": {
        "commit_hash": "e9559131152ab0fa89737db11ebe8f43e1435b96",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/e9559131152ab0fa89737db11ebe8f43e1435b96",
        "files": [
          "ext/standard/html.c"
        ],
        "message": "Better fix for bug #72135",
        "before_after_code_files": [
          "ext/standard/html.c||ext/standard/html.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/html.c||ext/standard/html.c"
          ],
          "candidate": [
            "ext/standard/html.c||ext/standard/html.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/html.c||ext/standard/html.c": [
          "File: ext/standard/html.c -> ext/standard/html.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1423:  }",
          "1424:  replaced[len] = '\\0';",
          "1427:  return replaced;",
          "1428: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1426:  if(len > INT_MAX) {",
          "1427:   zend_error_noreturn(E_ERROR, \"Escaped string is too long\");",
          "1428:   efree(replaced);",
          "1429:   return NULL;",
          "1430:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1444:  }",
          "1446:  replaced = php_escape_html_entities_ex(str, str_len, &new_len, all, (int) flags, hint_charset, double_encode TSRMLS_CC);",
          "1451:  RETVAL_STRINGL(replaced, (int)new_len, 0);",
          "1452: }",
          "",
          "[Removed Lines]",
          "1447:  if (new_len > INT_MAX) {",
          "1448:   efree(replaced);",
          "1449:   RETURN_FALSE;",
          "1450:  }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}