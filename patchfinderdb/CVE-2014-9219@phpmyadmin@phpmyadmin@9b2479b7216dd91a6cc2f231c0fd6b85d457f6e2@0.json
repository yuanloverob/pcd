{
  "cve_id": "CVE-2014-9219",
  "cve_desc": "Cross-site scripting (XSS) vulnerability in the redirection feature in url.php in phpMyAdmin 4.2.x before 4.2.13.1 allows remote attackers to inject arbitrary web script or HTML via the url parameter.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "9b2479b7216dd91a6cc2f231c0fd6b85d457f6e2",
  "patch_info": {
    "commit_hash": "9b2479b7216dd91a6cc2f231c0fd6b85d457f6e2",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/9b2479b7216dd91a6cc2f231c0fd6b85d457f6e2",
    "files": [
      "ChangeLog",
      "url.php"
    ],
    "message": "bug #4612 [security] XSS vulnerability in redirection mechanism\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
    "before_after_code_files": [
      "url.php||url.php"
    ]
  },
  "patch_diff": {
    "url.php||url.php": [
      "File: url.php -> url.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "12: define('PMA_MINIMUM_COMMON', true);",
      "13: require_once './libraries/common.inc.php';",
      "15: if (! PMA_isValid($_GET['url'])",
      "16:     || ! preg_match('/^https?:\\/\\/[^\\n\\r]*$/', $_GET['url'])",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "17: require_once './libraries/js_escape.lib.php';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "25:     echo \"<script type='text/javascript'>",
      "26:             window.onload=function(){",
      "28:             }",
      "29:         </script>\";",
      "",
      "[Removed Lines]",
      "27:                 window.location='\" . htmlspecialchars($_GET['url']) . \"';",
      "",
      "[Added Lines]",
      "31:                 window.location='\" . PMA_escapeJsString($_GET['url']) . \"';",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1daa32fb97b90fd1bf233cae9ed249e37fa175c4",
      "candidate_info": {
        "commit_hash": "1daa32fb97b90fd1bf233cae9ed249e37fa175c4",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/1daa32fb97b90fd1bf233cae9ed249e37fa175c4",
        "files": [
          "ChangeLog",
          "url.php"
        ],
        "message": "bug #4612 [security] XSS vulnerability in redirection mechanism\n\nSigned-off-by: Marc Delisle <marc@infomarc.info>",
        "before_after_code_files": [
          "url.php||url.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "url.php||url.php"
          ],
          "candidate": [
            "url.php||url.php"
          ]
        }
      },
      "candidate_diff": {
        "url.php||url.php": [
          "File: url.php -> url.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "12: define('PMA_MINIMUM_COMMON', true);",
          "13: require_once './libraries/common.inc.php';",
          "15: if (! PMA_isValid($_GET['url'])",
          "16:     || ! preg_match('/^https?:\\/\\/[^\\n\\r]*$/', $_GET['url'])",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "17: require_once './libraries/js_escape.lib.php';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "25:     echo \"<script type='text/javascript'>",
          "26:             window.onload=function(){",
          "28:             }",
          "29:         </script>\";",
          "",
          "[Removed Lines]",
          "27:                 window.location='\" . htmlspecialchars($_GET['url']) . \"';",
          "",
          "[Added Lines]",
          "31:                 window.location='\" . PMA_escapeJsString($_GET['url']) . \"';",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5e9cf1807372f56a251df1d1ec36d33e5ffd7e29",
      "candidate_info": {
        "commit_hash": "5e9cf1807372f56a251df1d1ec36d33e5ffd7e29",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/5e9cf1807372f56a251df1d1ec36d33e5ffd7e29",
        "files": [
          "url.php"
        ],
        "message": "Improvements in URL redirector\n\n- do not concatenate message to allow better translation\n- avoid possbile XSS",
        "before_after_code_files": [
          "url.php||url.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "url.php||url.php"
          ],
          "candidate": [
            "url.php||url.php"
          ]
        }
      },
      "candidate_diff": {
        "url.php||url.php": [
          "File: url.php -> url.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:         echo \"<script type='text/javascript'>",
          "27:                 window.onload=function(){",
          "29:                 }",
          "30:             </script>\";",
          "33:     } else {",
          "34:         header('Location: ' . $cfg['PmaAbsoluteUri']);",
          "35:     }",
          "",
          "[Removed Lines]",
          "28:                     window.location='\" . $_GET['url'] . \"';",
          "32:         echo __('Taking you to ') . ($_GET['url']);",
          "",
          "[Added Lines]",
          "28:                     window.location='\" . htmlspecialchars($_GET['url']) . \"';",
          "32:         printf(__('Taking you to %s.'), htmlspecialchars($_GET['url']));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d938eb9eb10b5f5380c4a2cb6786d3239cfb6fe8",
      "candidate_info": {
        "commit_hash": "d938eb9eb10b5f5380c4a2cb6786d3239cfb6fe8",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/d938eb9eb10b5f5380c4a2cb6786d3239cfb6fe8",
        "files": [
          "url.php"
        ],
        "message": "Simplify url redirectory code, no need for two branchs",
        "before_after_code_files": [
          "url.php||url.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "url.php||url.php"
          ],
          "candidate": [
            "url.php||url.php"
          ]
        }
      },
      "candidate_diff": {
        "url.php||url.php": [
          "File: url.php -> url.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "15: if (! PMA_isValid($_GET['url'])",
          "16:     || ! preg_match('/^https?:\\/\\/[^\\n\\r]*$/', $_GET['url'])",
          "17: ) {",
          "18:     header('Location: ' . $cfg['PmaAbsoluteUri']);",
          "19: } else {",
          "36: }",
          "37: die();",
          "38: ?>",
          "",
          "[Removed Lines]",
          "21:     if (PMA_isAllowedDomain($_GET['url'])) {",
          "26:         echo \"<script type='text/javascript'>",
          "27:                 window.onload=function(){",
          "28:                     window.location='\" . htmlspecialchars($_GET['url']) . \"';",
          "29:                 }",
          "30:             </script>\";",
          "32:         printf(__('Taking you to %s.'), htmlspecialchars($_GET['url']));",
          "33:     } else {",
          "34:         header('Location: ' . $cfg['PmaAbsoluteUri']);",
          "35:     }",
          "",
          "[Added Lines]",
          "17:     || ! PMA_isAllowedDomain($_GET['url'])",
          "25:     echo \"<script type='text/javascript'>",
          "26:             window.onload=function(){",
          "27:                 window.location='\" . htmlspecialchars($_GET['url']) . \"';",
          "28:             }",
          "29:         </script>\";",
          "31:     printf(__('Taking you to %s.'), htmlspecialchars($_GET['url']));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5c5673f4cfb93be704b9a20cb306e4626b647676",
      "candidate_info": {
        "commit_hash": "5c5673f4cfb93be704b9a20cb306e4626b647676",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/5c5673f4cfb93be704b9a20cb306e4626b647676",
        "files": [
          "url.php"
        ],
        "message": "Fix coding style; add localization\n\nSigned-off-by: Marc Delisle <marc@infomarc.info>",
        "before_after_code_files": [
          "url.php||url.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "url.php||url.php"
          ],
          "candidate": [
            "url.php||url.php"
          ]
        }
      },
      "candidate_diff": {
        "url.php||url.php": [
          "File: url.php -> url.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:     if (PMA_isAllowedDomain($_GET['url'])) {",
          "26:        window.onload=function(){",
          "28:       }",
          "29:       </script>\";",
          "35:     }",
          "36: }",
          "37: die();",
          "",
          "[Removed Lines]",
          "25:      echo \"<script type='text/javascript'>",
          "27:         window.location='\".$_GET['url'].\"';",
          "30:         echo 'Taking you to '.($_GET['url']); // Display redirecting msg on screen.",
          "31:     }",
          "32:     else",
          "33:     {",
          "34:      header('Location: ' . $cfg['PmaAbsoluteUri']);",
          "",
          "[Added Lines]",
          "28:         echo \"<script type='text/javascript'>",
          "30:         window.location='\" . $_GET['url'] . \"';",
          "34:         echo __('Taking you to ') . ($_GET['url']);",
          "35:     } else {",
          "36:         header('Location: ' . $cfg['PmaAbsoluteUri']);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "09dec45ffab059f133063b64b2c72c2a5a76d429",
      "candidate_info": {
        "commit_hash": "09dec45ffab059f133063b64b2c72c2a5a76d429",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/09dec45ffab059f133063b64b2c72c2a5a76d429",
        "files": [
          "url.php"
        ],
        "message": "Remove commented debugging code. Replace tabs with spaces\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "url.php||url.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "url.php||url.php"
          ],
          "candidate": [
            "url.php||url.php"
          ]
        }
      },
      "candidate_diff": {
        "url.php||url.php": [
          "File: url.php -> url.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: ) {",
          "18:     header('Location: ' . $cfg['PmaAbsoluteUri']);",
          "19: } else {",
          "23:     if (PMA_isAllowedDomain($_GET['url'])) {",
          "28:         echo \"<script type='text/javascript'>",
          "34:         echo __('Taking you to ') . ($_GET['url']);",
          "35:     } else {",
          "",
          "[Removed Lines]",
          "29:        window.onload=function(){",
          "30:         window.location='\" . $_GET['url'] . \"';",
          "31:       }",
          "32:       </script>\";",
          "",
          "[Added Lines]",
          "27:                 window.onload=function(){",
          "28:                     window.location='\" . $_GET['url'] . \"';",
          "29:                 }",
          "30:             </script>\";",
          "",
          "---------------"
        ]
      }
    }
  ]
}