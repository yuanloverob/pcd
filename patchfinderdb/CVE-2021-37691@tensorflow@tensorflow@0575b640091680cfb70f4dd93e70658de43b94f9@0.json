{
  "cve_id": "CVE-2021-37691",
  "cve_desc": "TensorFlow is an end-to-end open source platform for machine learning. In affected versions an attacker can craft a TFLite model that would trigger a division by zero error in LSH [implementation](https://github.com/tensorflow/tensorflow/blob/149562d49faa709ea80df1d99fc41d005b81082a/tensorflow/lite/kernels/lsh_projection.cc#L118). We have patched the issue in GitHub commit 0575b640091680cfb70f4dd93e70658de43b94f9. The fix will be included in TensorFlow 2.6.0. We will also cherrypick thiscommit on TensorFlow 2.5.1, TensorFlow 2.4.3, and TensorFlow 2.3.4, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "0575b640091680cfb70f4dd93e70658de43b94f9",
  "patch_info": {
    "commit_hash": "0575b640091680cfb70f4dd93e70658de43b94f9",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/0575b640091680cfb70f4dd93e70658de43b94f9",
    "files": [
      "tensorflow/lite/kernels/lsh_projection.cc"
    ],
    "message": "Prevent division by 0 in LSH projection.\n\nPiperOrigin-RevId: 387225857\nChange-Id: Iaeb572a763618c64f503e0026f6dd9fd769bf50c",
    "before_after_code_files": [
      "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc": [
      "File: tensorflow/lite/kernels/lsh_projection.cc -> tensorflow/lite/kernels/lsh_projection.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "82:   const TfLiteTensor* input;",
      "83:   TF_LITE_ENSURE_OK(context, GetInputSafe(context, node, 1, &input));",
      "84:   TF_LITE_ENSURE(context, NumDimensions(input) >= 1);",
      "86:   if (NumInputs(node) == 3) {",
      "87:     const TfLiteTensor* weight;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "85:   TF_LITE_ENSURE(context, SizeOfDimension(input, 0) >= 1);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c11c9ff50f74de84f82c33920af7ccec93d03863",
      "candidate_info": {
        "commit_hash": "c11c9ff50f74de84f82c33920af7ccec93d03863",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/c11c9ff50f74de84f82c33920af7ccec93d03863",
        "files": [
          "tensorflow/lite/kernels/lsh_projection.cc"
        ],
        "message": "Prevent division by 0 in LSH projection.\n\nPiperOrigin-RevId: 387225857\nChange-Id: Iaeb572a763618c64f503e0026f6dd9fd769bf50c",
        "before_after_code_files": [
          "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc": [
          "File: tensorflow/lite/kernels/lsh_projection.cc -> tensorflow/lite/kernels/lsh_projection.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "82:   const TfLiteTensor* input;",
          "83:   TF_LITE_ENSURE_OK(context, GetInputSafe(context, node, 1, &input));",
          "84:   TF_LITE_ENSURE(context, NumDimensions(input) >= 1);",
          "86:   if (NumInputs(node) == 3) {",
          "87:     const TfLiteTensor* weight;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "85:   TF_LITE_ENSURE(context, SizeOfDimension(input, 0) >= 1);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "85cdce7e2ee1ce99f674fd6bbb349e63e96c708d",
      "candidate_info": {
        "commit_hash": "85cdce7e2ee1ce99f674fd6bbb349e63e96c708d",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/85cdce7e2ee1ce99f674fd6bbb349e63e96c708d",
        "files": [
          "tensorflow/lite/kernels/lsh_projection.cc"
        ],
        "message": "Prevent division by 0 in LSH projection.\n\nPiperOrigin-RevId: 387225857\nChange-Id: Iaeb572a763618c64f503e0026f6dd9fd769bf50c",
        "before_after_code_files": [
          "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc": [
          "File: tensorflow/lite/kernels/lsh_projection.cc -> tensorflow/lite/kernels/lsh_projection.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "82:   const TfLiteTensor* input;",
          "83:   TF_LITE_ENSURE_OK(context, GetInputSafe(context, node, 1, &input));",
          "84:   TF_LITE_ENSURE(context, NumDimensions(input) >= 1);",
          "86:   if (NumInputs(node) == 3) {",
          "87:     const TfLiteTensor* weight;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "85:   TF_LITE_ENSURE(context, SizeOfDimension(input, 0) >= 1);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f20119917f86b9c582fc19efc3b9c80700b09a75",
      "candidate_info": {
        "commit_hash": "f20119917f86b9c582fc19efc3b9c80700b09a75",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/f20119917f86b9c582fc19efc3b9c80700b09a75",
        "files": [
          "tensorflow/lite/kernels/lsh_projection.cc"
        ],
        "message": "Prevent division by 0 in LSH projection.\n\nPiperOrigin-RevId: 387225857\nChange-Id: Iaeb572a763618c64f503e0026f6dd9fd769bf50c",
        "before_after_code_files": [
          "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc": [
          "File: tensorflow/lite/kernels/lsh_projection.cc -> tensorflow/lite/kernels/lsh_projection.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "81:   const TfLiteTensor* input = GetInput(context, node, 1);",
          "82:   TF_LITE_ENSURE(context, NumDimensions(input) >= 1);",
          "84:   if (NumInputs(node) == 3) {",
          "85:     const TfLiteTensor* weight = GetInput(context, node, 2);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "83:   TF_LITE_ENSURE(context, SizeOfDimension(input, 0) >= 1);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "085ae7a3a20c16919ec2f3756adfa524d2863de9",
      "candidate_info": {
        "commit_hash": "085ae7a3a20c16919ec2f3756adfa524d2863de9",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/085ae7a3a20c16919ec2f3756adfa524d2863de9",
        "files": [
          "tensorflow/lite/kernels/lsh_projection.cc"
        ],
        "message": "Prevent division by 0 in LSH projection.\n\nPiperOrigin-RevId: 387225857\nChange-Id: Iaeb572a763618c64f503e0026f6dd9fd769bf50c",
        "before_after_code_files": [
          "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/lsh_projection.cc||tensorflow/lite/kernels/lsh_projection.cc": [
          "File: tensorflow/lite/kernels/lsh_projection.cc -> tensorflow/lite/kernels/lsh_projection.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "82:   const TfLiteTensor* input;",
          "83:   TF_LITE_ENSURE_OK(context, GetInputSafe(context, node, 1, &input));",
          "84:   TF_LITE_ENSURE(context, NumDimensions(input) >= 1);",
          "86:   if (NumInputs(node) == 3) {",
          "87:     const TfLiteTensor* weight;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "85:   TF_LITE_ENSURE(context, SizeOfDimension(input, 0) >= 1);",
          "",
          "---------------"
        ]
      }
    }
  ]
}