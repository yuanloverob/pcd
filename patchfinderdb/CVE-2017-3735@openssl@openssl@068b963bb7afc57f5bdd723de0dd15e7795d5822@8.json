{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "64b5b5bd7cfdef1f1204fa305e9d685de8bf5b7f",
      "candidate_info": {
        "commit_hash": "64b5b5bd7cfdef1f1204fa305e9d685de8bf5b7f",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/64b5b5bd7cfdef1f1204fa305e9d685de8bf5b7f",
        "files": [
          "test/fatalerrtest.c"
        ],
        "message": "Fix the buffer sizing in the fatalerrtest\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4868)",
        "before_after_code_files": [
          "test/fatalerrtest.c||test/fatalerrtest.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/fatalerrtest.c||test/fatalerrtest.c": [
          "File: test/fatalerrtest.c -> test/fatalerrtest.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "69:     }",
          "73:         buf[len] = '\\0';",
          "74:         printf(\"Unexpected success reading data: %s\\n\", buf);",
          "75:         goto err;",
          "",
          "[Removed Lines]",
          "72:     if ((len = SSL_read(sssl, buf, sizeof(buf - 1))) > 0) {",
          "",
          "[Added Lines]",
          "72:     if ((len = SSL_read(sssl, buf, sizeof(buf) - 1)) > 0) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e68f0ea8d3c87a018646ac652b57a18da41cfbf6",
      "candidate_info": {
        "commit_hash": "e68f0ea8d3c87a018646ac652b57a18da41cfbf6",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/e68f0ea8d3c87a018646ac652b57a18da41cfbf6",
        "files": [
          "include/openssl/ssl.h",
          "ssl/ssl_lib.c"
        ],
        "message": "Make SSL_is_server() accept a const SSL\n\nFixes #1526\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3360)\n(cherry picked from commit 6944311688015ad293bd788ce78f3226738ebf00)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_lib.c||ssl/ssl_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1832: # endif",
          "1834: __owur int SSL_session_reused(SSL *s);",
          "1837: __owur __owur SSL_CONF_CTX *SSL_CONF_CTX_new(void);",
          "1838: int SSL_CONF_CTX_finish(SSL_CONF_CTX *cctx);",
          "",
          "[Removed Lines]",
          "1835: __owur int SSL_is_server(SSL *s);",
          "",
          "[Added Lines]",
          "1835: __owur int SSL_is_server(const SSL *s);",
          "",
          "---------------"
        ],
        "ssl/ssl_lib.c||ssl/ssl_lib.c": [
          "File: ssl/ssl_lib.c -> ssl/ssl_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3776:     return s->hit;",
          "3777: }",
          "3780: {",
          "3781:     return s->server;",
          "3782: }",
          "",
          "[Removed Lines]",
          "3779: int SSL_is_server(SSL *s)",
          "",
          "[Added Lines]",
          "3779: int SSL_is_server(const SSL *s)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bd97dde41e96193aa076260fb0057e9ce0f6861b",
      "candidate_info": {
        "commit_hash": "bd97dde41e96193aa076260fb0057e9ce0f6861b",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/bd97dde41e96193aa076260fb0057e9ce0f6861b",
        "files": [
          "crypto/cast/c_enc.c",
          "crypto/ec/ecp_nistz256.c",
          "crypto/include/internal/bn_dh.h",
          "crypto/o_str.c"
        ],
        "message": "Address some -Wold-style-declaration warnings\n\ngcc's -Wextra pulls in -Wold-style-declaration, which triggers when a\ndeclaration has a storage-class specifier as a non-initial qualifier.\nThe ISO C formal grammar requires the storage-class to be the first\ncomponent of the declaration, if present.\n\nSeeint as the register storage-class specifier does not really have any effect\nanymore with modern compilers, remove it entirely while we're here, instead of\nfixing up the order.\n\nInterestingly, the gcc devteam warnings do not pull in -Wextra, though\nthe clang ones do.\n\n[extended tests]\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3239)\n(cherry picked from commit f44903a428cc63ce88bfba26e8e4e2e9b21f058d)",
        "before_after_code_files": [
          "crypto/cast/c_enc.c||crypto/cast/c_enc.c",
          "crypto/ec/ecp_nistz256.c||crypto/ec/ecp_nistz256.c",
          "crypto/include/internal/bn_dh.h||crypto/include/internal/bn_dh.h",
          "crypto/o_str.c||crypto/o_str.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/cast/c_enc.c||crypto/cast/c_enc.c": [
          "File: crypto/cast/c_enc.c -> crypto/cast/c_enc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: void CAST_encrypt(CAST_LONG *data, const CAST_KEY *key)",
          "14: {",
          "18:     k = &(key->data[0]);",
          "19:     l = data[0];",
          "",
          "[Removed Lines]",
          "15:     register CAST_LONG l, r, t;",
          "16:     const register CAST_LONG *k;",
          "",
          "[Added Lines]",
          "15:     CAST_LONG l, r, t;",
          "16:     const CAST_LONG *k;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45: void CAST_decrypt(CAST_LONG *data, const CAST_KEY *key)",
          "46: {",
          "50:     k = &(key->data[0]);",
          "51:     l = data[0];",
          "",
          "[Removed Lines]",
          "47:     register CAST_LONG l, r, t;",
          "48:     const register CAST_LONG *k;",
          "",
          "[Added Lines]",
          "47:     CAST_LONG l, r, t;",
          "48:     const CAST_LONG *k;",
          "",
          "---------------"
        ],
        "crypto/ec/ecp_nistz256.c||crypto/ec/ecp_nistz256.c": [
          "File: crypto/ec/ecp_nistz256.c -> crypto/ec/ecp_nistz256.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "757: }",
          "761:     TOBN(0x79e730d4, 0x18a9143c), TOBN(0x75ba95fc, 0x5fedb601),",
          "762:     TOBN(0x79fb732b, 0x77622510), TOBN(0x18905f76, 0xa53755c6)",
          "763: };",
          "766:     TOBN(0xddf25357, 0xce95560a), TOBN(0x8b4ab8e4, 0xba19e45c),",
          "767:     TOBN(0xd2e88688, 0xdd21f325), TOBN(0x8571ff18, 0x25885d85)",
          "768: };",
          "",
          "[Removed Lines]",
          "760: const static BN_ULONG def_xG[P256_LIMBS] = {",
          "765: const static BN_ULONG def_yG[P256_LIMBS] = {",
          "",
          "[Added Lines]",
          "760: static const BN_ULONG def_xG[P256_LIMBS] = {",
          "765: static const BN_ULONG def_yG[P256_LIMBS] = {",
          "",
          "---------------"
        ],
        "crypto/include/internal/bn_dh.h||crypto/include/internal/bn_dh.h": [
          "File: crypto/include/internal/bn_dh.h -> crypto/include/internal/bn_dh.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "10: #define declare_dh_bn(x) \\",
          "15: declare_dh_bn(1024_160)",
          "16: declare_dh_bn(2048_224)",
          "",
          "[Removed Lines]",
          "11:     const extern BIGNUM _bignum_dh##x##_p;              \\",
          "12:     const extern BIGNUM _bignum_dh##x##_g;              \\",
          "13:     const extern BIGNUM _bignum_dh##x##_q;",
          "",
          "[Added Lines]",
          "11:     extern const BIGNUM _bignum_dh##x##_p;              \\",
          "12:     extern const BIGNUM _bignum_dh##x##_g;              \\",
          "13:     extern const BIGNUM _bignum_dh##x##_q;",
          "",
          "---------------"
        ],
        "crypto/o_str.c||crypto/o_str.c": [
          "File: crypto/o_str.c -> crypto/o_str.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "194: char *OPENSSL_buf2hexstr(const unsigned char *buffer, long len)",
          "195: {",
          "197:     char *tmp, *q;",
          "198:     const unsigned char *p;",
          "199:     int i;",
          "",
          "[Removed Lines]",
          "196:     const static char hexdig[] = \"0123456789ABCDEF\";",
          "",
          "[Added Lines]",
          "196:     static const char hexdig[] = \"0123456789ABCDEF\";",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "17bbc10a08b4f133d12d17f84801c5355aa1f526",
      "candidate_info": {
        "commit_hash": "17bbc10a08b4f133d12d17f84801c5355aa1f526",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/17bbc10a08b4f133d12d17f84801c5355aa1f526",
        "files": [
          "crypto/bio/b_sock.c"
        ],
        "message": "Clean away needless VMS check\n\nBIO_socket_ioctl is only implemented on VMS for VMS version 7.0 and\nup, but since we only support version 7.1 and up, there's no need to\ncheck the VMS version.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3448)\n(cherry picked from commit b57f0c598bde43e147a886c9ffb0d6fdb3141d72)",
        "before_after_code_files": [
          "crypto/bio/b_sock.c||crypto/bio/b_sock.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/bio/b_sock.c||crypto/bio/b_sock.c": [
          "File: crypto/bio/b_sock.c -> crypto/bio/b_sock.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "167: # endif",
          "168: }",
          "172: int BIO_socket_ioctl(int fd, long type, void *arg)",
          "173: {",
          "174:     int i;",
          "",
          "[Removed Lines]",
          "170: # if !defined(OPENSSL_SYS_VMS) || __VMS_VER >= 70000000",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5dd8e67a7b9ede8d90744660abbb40adf07890aa",
      "candidate_info": {
        "commit_hash": "5dd8e67a7b9ede8d90744660abbb40adf07890aa",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/5dd8e67a7b9ede8d90744660abbb40adf07890aa",
        "files": [
          "crypto/err/err.c"
        ],
        "message": "err/err.c: fix \"wraparound\" bug in ERR_set_error_data.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit d3d880ce01cfaf0091f46a2f6b5bd146d47a93e7)",
        "before_after_code_files": [
          "crypto/err/err.c||crypto/err/err.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/err/err.c||crypto/err/err.c": [
          "File: crypto/err/err.c -> crypto/err/err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "702:         return;",
          "704:     i = es->top;",
          "708:     err_clear_data(es, i);",
          "709:     es->err_data[i] = data;",
          "",
          "[Removed Lines]",
          "705:     if (i == 0)",
          "706:         i = ERR_NUM_ERRORS - 1;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}