{
  "cve_id": "CVE-2016-10052",
  "cve_desc": "Buffer overflow in the WriteProfile function in coders/jpeg.c in ImageMagick before 6.9.5-6 allows remote attackers to cause a denial of service (application crash) or have other unspecified impact via a crafted file.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "13267a10845a8dadabed63072b537f050cec6daa",
  "patch_info": {
    "commit_hash": "13267a10845a8dadabed63072b537f050cec6daa",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/13267a10845a8dadabed63072b537f050cec6daa",
    "files": [
      "coders/jpeg.c",
      "config/english.xml"
    ],
    "message": "Changed the JPEG writer to raise a warning when the exif profile exceeds 65533 bytes and truncate it.",
    "before_after_code_files": [
      "coders/jpeg.c||coders/jpeg.c"
    ]
  },
  "patch_diff": {
    "coders/jpeg.c||coders/jpeg.c": [
      "File: coders/jpeg.c -> coders/jpeg.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1908:       ssize_t",
      "1909:         count;",
      "1912:         destination->manager.free_in_buffer,destination->buffer);",
      "1913:       if (count != (ssize_t)",
      "1914:           (MaxBufferExtent-destination->manager.free_in_buffer))",
      "",
      "[Removed Lines]",
      "1911:       count=WriteBlob(destination->image,MaxBufferExtent-",
      "",
      "[Added Lines]",
      "1911:       count=WriteBlob(destination->image,MaxBufferExtent-",
      "1912:         destination->manager.free_in_buffer,destination->buffer);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1941:     Save image profile as a APP marker.",
      "1943:   iptc=MagickFalse;",
      "1946:   for (name=GetNextImageProfile(image); name != (const char *) NULL; )",
      "1947:   {",
      "1948:     profile=GetImageProfile(image,name);",
      "",
      "[Removed Lines]",
      "1944:   custom_profile=AcquireStringInfo(65535L);",
      "1945:   ResetImageProfileIterator(image);",
      "",
      "[Added Lines]",
      "1944:   iptc=MagickFalse;",
      "1945:   custom_profile=AcquireStringInfo(65535L);",
      "1946:   ResetImageProfileIterator(image);",
      "1947:   for (name=GetNextImageProfile(image); name != (const char *) NULL; )",
      "1948:   {",
      "1949:     profile=GetImageProfile(image,name);",
      "1950:     if (LocaleCompare(name,\"EXIF\") == 0)",
      "1951:       {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "2670:       }",
      "2671:     }",
      "2675:   value=GetImageProperty(image,\"comment\",exception);",
      "2676:   if (value != (char *) NULL)",
      "",
      "[Removed Lines]",
      "2673:     Write JPEG profiles.",
      "",
      "[Added Lines]",
      "2679:     Write JPEG profiles.",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2c02f097b503b29aad7db4c2456ddd0d5ddee8d7",
      "candidate_info": {
        "commit_hash": "2c02f097b503b29aad7db4c2456ddd0d5ddee8d7",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/2c02f097b503b29aad7db4c2456ddd0d5ddee8d7",
        "files": [
          "ChangeLog",
          "coders/jpeg.c"
        ],
        "message": "Eliminate compiler warning",
        "before_after_code_files": [
          "coders/jpeg.c||coders/jpeg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/jpeg.c||coders/jpeg.c"
          ],
          "candidate": [
            "coders/jpeg.c||coders/jpeg.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/jpeg.c||coders/jpeg.c": [
          "File: coders/jpeg.c -> coders/jpeg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1945:   custom_profile=AcquireStringInfo(65535L);",
          "1946:   ResetImageProfileIterator(image);",
          "1947:   for (name=GetNextImageProfile(image); name != (const char *) NULL; )",
          "1949:     profile=GetImageProfile(image,name);",
          "1950:     if (LocaleCompare(name,\"EXIF\") == 0)",
          "1951:       {",
          "",
          "[Removed Lines]",
          "1948:   {",
          "",
          "[Added Lines]",
          "1948:   {",
          "1949:     profile=GetImageProfile(image,name);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2342:           (double) image->quality);",
          "2343:     }",
          "2344:   else",
          "2346: #if !defined(C_LOSSLESS_SUPPORTED)",
          "2347:       quality=100;",
          "2348:       if (image->debug != MagickFalse)",
          "",
          "[Removed Lines]",
          "2345:     {",
          "",
          "[Added Lines]",
          "2346:     {",
          "",
          "---------------"
        ]
      }
    }
  ]
}