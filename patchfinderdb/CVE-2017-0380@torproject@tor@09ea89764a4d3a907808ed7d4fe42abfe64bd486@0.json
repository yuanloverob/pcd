{
  "cve_id": "CVE-2017-0380",
  "cve_desc": "The rend_service_intro_established function in or/rendservice.c in Tor before 0.2.8.15, 0.2.9.x before 0.2.9.12, 0.3.0.x before 0.3.0.11, 0.3.1.x before 0.3.1.7, and 0.3.2.x before 0.3.2.1-alpha, when SafeLogging is disabled, allows attackers to obtain sensitive information by leveraging access to the log files of a hidden service, because uninitialized stack data is included in an error message about construction of an introduction point circuit.",
  "repo": "torproject/tor",
  "patch_hash": "09ea89764a4d3a907808ed7d4fe42abfe64bd486",
  "patch_info": {
    "commit_hash": "09ea89764a4d3a907808ed7d4fe42abfe64bd486",
    "repo": "torproject/tor",
    "commit_url": "https://github.com/torproject/tor/commit/09ea89764a4d3a907808ed7d4fe42abfe64bd486",
    "files": [
      "changes/trove-2017-008",
      "src/or/rendservice.c"
    ],
    "message": "Fix log-uninitialized-stack bug in rend_service_intro_established.\n\nFixes bug 23490; bugfix on 0.2.7.2-alpha.\n\nTROVE-2017-008\nCVE-2017-0380",
    "before_after_code_files": [
      "src/or/rendservice.c||src/or/rendservice.c"
    ]
  },
  "patch_diff": {
    "src/or/rendservice.c||src/or/rendservice.c": [
      "File: src/or/rendservice.c -> src/or/rendservice.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3372:              (unsigned)circuit->base_.n_circ_id);",
      "3373:     goto err;",
      "3374:   }",
      "3377:   intro = find_intro_point(circuit);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "3375:   base32_encode(serviceid, REND_SERVICE_ID_LEN_BASE32 + 1,",
      "3376:                 rend_pk_digest, REND_SERVICE_ID_LEN);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3388:   service->desc_is_dirty = time(NULL);",
      "3389:   circuit_change_purpose(TO_CIRCUIT(circuit), CIRCUIT_PURPOSE_S_INTRO);",
      "3393:   log_info(LD_REND,",
      "3394:            \"Received INTRO_ESTABLISHED cell on circuit %u for service %s\",",
      "3395:            (unsigned)circuit->base_.n_circ_id, serviceid);",
      "",
      "[Removed Lines]",
      "3391:   base32_encode(serviceid, REND_SERVICE_ID_LEN_BASE32 + 1,",
      "3392:                 rend_pk_digest, REND_SERVICE_ID_LEN);",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4a2cbea6ce585fcdaf86a80ccf39bceb4137e86a",
      "candidate_info": {
        "commit_hash": "4a2cbea6ce585fcdaf86a80ccf39bceb4137e86a",
        "repo": "torproject/tor",
        "commit_url": "https://github.com/torproject/tor/commit/4a2cbea6ce585fcdaf86a80ccf39bceb4137e86a",
        "files": [
          "changes/trove-2017-008",
          "src/or/rendservice.c"
        ],
        "message": "Fix log-uninitialized-stack bug in rend_service_intro_established.\n\nFixes bug 23490; bugfix on 0.2.7.2-alpha.\n\nTROVE-2017-008\nCVE-2017-0380",
        "before_after_code_files": [
          "src/or/rendservice.c||src/or/rendservice.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "src/or/rendservice.c||src/or/rendservice.c"
          ],
          "candidate": [
            "src/or/rendservice.c||src/or/rendservice.c"
          ]
        }
      },
      "candidate_diff": {
        "src/or/rendservice.c||src/or/rendservice.c": [
          "File: src/or/rendservice.c -> src/or/rendservice.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2859:              (unsigned)circuit->base_.n_circ_id);",
          "2860:     goto err;",
          "2861:   }",
          "2864:   intro = find_intro_point(circuit);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2862:   base32_encode(serviceid, REND_SERVICE_ID_LEN_BASE32 + 1,",
          "2863:                 circuit->rend_data->rend_pk_digest, REND_SERVICE_ID_LEN);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2875:   service->desc_is_dirty = time(NULL);",
          "2876:   circuit_change_purpose(TO_CIRCUIT(circuit), CIRCUIT_PURPOSE_S_INTRO);",
          "2880:   log_info(LD_REND,",
          "2881:            \"Received INTRO_ESTABLISHED cell on circuit %u for service %s\",",
          "2882:            (unsigned)circuit->base_.n_circ_id, serviceid);",
          "",
          "[Removed Lines]",
          "2878:   base32_encode(serviceid, REND_SERVICE_ID_LEN_BASE32 + 1,",
          "2879:                 circuit->rend_data->rend_pk_digest, REND_SERVICE_ID_LEN);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}