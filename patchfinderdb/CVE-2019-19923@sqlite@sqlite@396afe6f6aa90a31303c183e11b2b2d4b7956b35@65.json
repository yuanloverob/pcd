{
  "cve_id": "CVE-2019-19923",
  "cve_desc": "flattenSubquery in select.c in SQLite 3.30.1 mishandles certain uses of SELECT DISTINCT involving a LEFT JOIN in which the right-hand side is a view. This can cause a NULL pointer dereference (or incorrect results).",
  "repo": "sqlite/sqlite",
  "patch_hash": "396afe6f6aa90a31303c183e11b2b2d4b7956b35",
  "patch_info": {
    "commit_hash": "396afe6f6aa90a31303c183e11b2b2d4b7956b35",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/396afe6f6aa90a31303c183e11b2b2d4b7956b35",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/select.c",
      "test/join.test"
    ],
    "message": "Continue to back away from the LEFT JOIN optimization of check-in [41c27bc0ff1d3135] by disallowing query flattening if the outer query is DISTINCT.  Without this fix, if an index scan is run on the table within the view on the right-hand side of the LEFT JOIN, stale result registers might be accessed yielding incorrect results, and/or an OP_IfNullRow opcode might be invoked on the un-opened table, resulting in a NULL-pointer dereference.  This problem was found by the Yongheng and Rui fuzzer.\n\nFossilOrigin-Name: 862974312edf00e9d1068115d1a39b7235b7db68b6d86b81d38a12f025a4748e",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/select.c||src/select.c",
      "test/join.test||test/join.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 289158aa24b066c453d2bce4bc2dead1c56fb0b23c3f7c4810b34b13627cef34",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/select.c||src/select.c": [
      "File: src/select.c -> src/select.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3797:   if( (pSubitem->fg.jointype & JT_OUTER)!=0 ){",
      "3798:     isLeftJoin = 1;",
      "3801:       return 0;",
      "3802:     }",
      "3803:   }",
      "",
      "[Removed Lines]",
      "3799:     if( pSubSrc->nSrc>1 || isAgg || IsVirtual(pSubSrc->a[0].pTab) ){",
      "",
      "[Added Lines]",
      "3804:     ){",
      "",
      "---------------"
    ],
    "test/join.test||test/join.test": [
      "File: test/join.test -> test/join.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "975:   SELECT 24, * FROM t1 LEFT JOIN t0 ON +aa ISNULL;",
      "976: } {13 1 {} 14 1 {} 23 1 {} 24 1 {}}",
      "978: finish_test",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "978: # 2019-12-18 problem with a LEFT JOIN where the RHS is a view.",
      "979: # Detected by Yongheng and Rui.",
      "980: # Follows from the optimization attempt of check-in 41c27bc0ff1d3135",
      "981: # on 2017-04-18",
      "982: #",
      "983: reset_db",
      "984: do_execsql_test join-22.10 {",
      "985:   CREATE TABLE t0(a, b);",
      "986:   CREATE INDEX t0a ON t0(a);",
      "987:   INSERT INTO t0 VALUES(10,10),(10,11),(10,12);",
      "988:   SELECT DISTINCT c FROM t0 LEFT JOIN (SELECT a+1 AS c FROM t0) ORDER BY c ;",
      "989: } {11}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4c8056079ffdafae82b7f42fe4917af2f583cf51",
      "candidate_info": {
        "commit_hash": "4c8056079ffdafae82b7f42fe4917af2f583cf51",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/4c8056079ffdafae82b7f42fe4917af2f583cf51",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/vdbemem.c"
        ],
        "message": "Remove a harmless unused variable.\n\nFossilOrigin-Name: 28091a48aa6994f8d7c142b5851bcd6b4e9a93a7bbef6c927a6182d24f3245b4",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/vdbemem.c||src/vdbemem.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 8e100e6c35c30e0d7e4014b9435f81f9f61ddab2386dfe9a4218d8190a6da3be",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/vdbemem.c||src/vdbemem.c": [
          "File: src/vdbemem.c -> src/vdbemem.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "460: #ifndef SQLITE_OMIT_WINDOWFUNC",
          "461: int sqlite3VdbeMemAggValue(Mem *pAccum, Mem *pOut, FuncDef *pFunc){",
          "462:   sqlite3_context ctx;",
          "464:   assert( pFunc!=0 );",
          "465:   assert( pFunc->xValue!=0 );",
          "466:   assert( (pAccum->flags & MEM_Null)!=0 || pFunc==pAccum->u.pDef );",
          "467:   assert( pAccum->db==0 || sqlite3_mutex_held(pAccum->db->mutex) );",
          "468:   memset(&ctx, 0, sizeof(ctx));",
          "472:   sqlite3VdbeMemSetNull(pOut);",
          "473:   ctx.pOut = pOut;",
          "474:   ctx.pMem = pAccum;",
          "",
          "[Removed Lines]",
          "463:   Mem t;",
          "469:   memset(&t, 0, sizeof(t));",
          "470:   t.flags = MEM_Null;",
          "471:   t.db = pAccum->db;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bf9ff256fe17526a995ac3e470aa120c3c173414",
      "candidate_info": {
        "commit_hash": "bf9ff256fe17526a995ac3e470aa120c3c173414",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/bf9ff256fe17526a995ac3e470aa120c3c173414",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/build.c",
          "src/sqliteInt.h",
          "test/without_rowid1.test"
        ],
        "message": "Disable index seek optimizations on REINDEX when the order of primary keys in the index differs from the main table. Fix for ticket [bba7b69f9849b5bf11b4].\n\nFossilOrigin-Name: f7aadfab3bb8eb8eb2cd62dc8a6823538387b3329f1efc23ef75482488109478",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/build.c||src/build.c",
          "src/sqliteInt.h||src/sqliteInt.h",
          "test/without_rowid1.test||test/without_rowid1.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: f158c048be1dc7c80d38787a20495caa55b86416967efd57f4888548d42b4819",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/build.c||src/build.c": [
          "File: src/build.c -> src/build.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1928:         testcase( hasColumn(pIdx->aiColumn, pIdx->nKeyCol, pPk->aiColumn[i]) );",
          "1929:         pIdx->aiColumn[j] = pPk->aiColumn[i];",
          "1930:         pIdx->azColl[j] = pPk->azColl[i];",
          "1931:         j++;",
          "1932:       }",
          "1933:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1931:         if( pPk->aSortOrder[i] ){",
          "1933:           pIdx->bAscKeyBug = 1;",
          "1934:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3049:     addr2 = sqlite3VdbeCurrentAddr(v);",
          "3050:   }",
          "3051:   sqlite3VdbeAddOp3(v, OP_SorterData, iSorter, regRecord, iIdx);",
          "3053:   sqlite3VdbeAddOp2(v, OP_IdxInsert, iIdx, regRecord);",
          "3054:   sqlite3VdbeChangeP5(v, OPFLAG_USESEEKRESULT);",
          "3055:   sqlite3ReleaseTempReg(pParse, regRecord);",
          "",
          "[Removed Lines]",
          "3052:   sqlite3VdbeAddOp1(v, OP_SeekEnd, iIdx);",
          "",
          "[Added Lines]",
          "3056:   if( !pIndex->bAscKeyBug ){",
          "3064:     sqlite3VdbeAddOp1(v, OP_SeekEnd, iIdx);",
          "3065:   }",
          "",
          "---------------"
        ],
        "src/sqliteInt.h||src/sqliteInt.h": [
          "File: src/sqliteInt.h -> src/sqliteInt.h"
        ],
        "test/without_rowid1.test||test/without_rowid1.test": [
          "File: test/without_rowid1.test -> test/without_rowid1.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "399:   PRAGMA integrity_check;",
          "400:   SELECT a FROM t11 ORDER BY a COLLATE binary;",
          "401: } {ok A a}",
          "403: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "403: # 2019-05-13 ticket https://www.sqlite.org/src/info/bba7b69f9849b5b",
          "404: do_execsql_test 12.1 {",
          "405:   DROP TABLE IF EXISTS t0;",
          "406:   CREATE TABLE t0 (c0 INTEGER PRIMARY KEY DESC, c1 UNIQUE DEFAULT NULL) WITHOUT ROWID;",
          "407:   INSERT INTO t0(c0) VALUES (1), (2), (3), (4), (5);",
          "408:   REINDEX;",
          "409:   PRAGMA integrity_check;",
          "410: } {ok}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dd6cc9b52abf6c4ae15a57a9f3d6e3c1e848f589",
      "candidate_info": {
        "commit_hash": "dd6cc9b52abf6c4ae15a57a9f3d6e3c1e848f589",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/dd6cc9b52abf6c4ae15a57a9f3d6e3c1e848f589",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/build.c",
          "src/expr.c",
          "src/insert.c",
          "src/sqliteInt.h",
          "src/update.c"
        ],
        "message": "Work toward getting generated columns to work with triggers.  Still more work to do in this area.\n\nFossilOrigin-Name: 932a37275d7e932f8237d32c8fc6087ed8cd342fe01ef2f7a43c7237ab84c9ac",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/build.c||src/build.c",
          "src/expr.c||src/expr.c",
          "src/insert.c||src/insert.c",
          "src/sqliteInt.h||src/sqliteInt.h",
          "src/update.c||src/update.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: fb9c9bb284d441bd7aa34c87b6fd8ce57d036c17623d82354154fc6286bdd134",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/build.c||src/build.c": [
          "File: src/build.c -> src/build.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "934:   for(i=0, n=0; i<iCol; i++){",
          "935:     if( (pTab->aCol[i].colFlags & COLFLAG_VIRTUAL)==0 ) n++;",
          "936:   }",
          "938: }",
          "939: #endif",
          "",
          "[Removed Lines]",
          "937:   return n;",
          "",
          "[Added Lines]",
          "959:   if( pTab->aCol[i].colFlags & COLFLAG_VIRTUAL ){",
          "961:     return pTab->nNVCol + i - n;",
          "962:   }else{",
          "964:     return n;",
          "965:   }",
          "",
          "---------------"
        ],
        "src/expr.c||src/expr.c": [
          "File: src/expr.c -> src/expr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3604:               return 0;",
          "3605:             }",
          "3606:             pCol->colFlags |= COLFLAG_BUSY;",
          "3614:             }",
          "3615:             pCol->colFlags &= ~(COLFLAG_BUSY|COLFLAG_NOTAVAIL);",
          "3617:           }else",
          "3619:           if( pCol->affinity==SQLITE_AFF_REAL ){",
          "",
          "[Removed Lines]",
          "3607:             if( pCol->colFlags & COLFLAG_VIRTUAL ){",
          "3608:               target = sqlite3ExprCodeTarget(pParse, pCol->pDflt, target);",
          "3609:             }else{",
          "3610:               target = iSrc;",
          "3611:               if( pCol->colFlags & COLFLAG_NOTAVAIL ){",
          "3612:                 sqlite3ExprCode(pParse, pCol->pDflt, iSrc);",
          "3613:               }",
          "3616:             return target;",
          "",
          "[Added Lines]",
          "3607:             if( pCol->colFlags & COLFLAG_NOTAVAIL ){",
          "3608:               sqlite3ExprCode(pParse, pCol->pDflt, iSrc);",
          "3611:             return iSrc;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4090:       Table *pTab = pExpr->y.pTab;",
          "4093:       assert( pExpr->iTable==0 || pExpr->iTable==1 );",
          "4096:       assert( p1>=0 && p1<(pTab->nCol*2+2) );",
          "4098:       sqlite3VdbeAddOp2(v, OP_Param, p1, target);",
          "4099:       VdbeComment((v, \"r[%d]=%s.%s\", target,",
          "4100:         (pExpr->iTable ? \"new\" : \"old\"),",
          "4102:       ));",
          "4104: #ifndef SQLITE_OMIT_FLOATING_POINT",
          "",
          "[Removed Lines]",
          "4091:       int p1 = pExpr->iTable * (pTab->nCol+1) + 1 + pExpr->iColumn;",
          "4094:       assert( pExpr->iColumn>=-1 && pExpr->iColumn<pTab->nCol );",
          "4095:       assert( pTab->iPKey<0 || pExpr->iColumn!=pTab->iPKey );",
          "4101:         (pExpr->iColumn<0 ? \"rowid\" : pExpr->y.pTab->aCol[pExpr->iColumn].zName)",
          "",
          "[Added Lines]",
          "4086:       int iCol = pExpr->iColumn;",
          "4087:       int p1 = pExpr->iTable * (pTab->nCol+1) + 1",
          "4088:                      + (iCol>=0 ? sqlite3TableColumnToStorage(pTab, iCol) : -1);",
          "4091:       assert( iCol>=-1 && iCol<pTab->nCol );",
          "4092:       assert( pTab->iPKey<0 || iCol!=pTab->iPKey );",
          "4098:         (pExpr->iColumn<0 ? \"rowid\" : pExpr->y.pTab->aCol[iCol].zName)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "4113:         sqlite3VdbeAddOp1(v, OP_RealAffinity, target);",
          "4114:       }",
          "4115: #endif",
          "",
          "[Removed Lines]",
          "4110:       if( pExpr->iColumn>=0",
          "4111:        && pTab->aCol[pExpr->iColumn].affinity==SQLITE_AFF_REAL",
          "4112:       ){",
          "",
          "[Added Lines]",
          "4107:       if( iCol>=0 && pTab->aCol[iCol].affinity==SQLITE_AFF_REAL ){",
          "",
          "---------------"
        ],
        "src/insert.c||src/insert.c": [
          "File: src/insert.c -> src/insert.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "216: ){",
          "217:   int i;",
          "222:   for(i=0; i<pTab->nCol; i++){",
          "224:       pTab->aCol[i].colFlags |= COLFLAG_NOTAVAIL;",
          "225:     }",
          "226:   }",
          "",
          "[Removed Lines]",
          "212: void sqlite3ComputeStoredColumns(",
          "223:     if( pTab->aCol[i].colFlags & COLFLAG_STORED ){",
          "",
          "[Added Lines]",
          "212: void sqlite3ComputeGeneratedColumns(",
          "218:   int nv;",
          "224:     if( pTab->aCol[i].colFlags & COLFLAG_GENERATED ){",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "232:   pParse->iSelfTab = -iRegStore;",
          "234:     u32 colFlags = pTab->aCol[i].colFlags;",
          "241:       colFlags &= ~COLFLAG_NOTAVAIL;",
          "242:     }",
          "243:   }",
          "244:   pParse->iSelfTab = 0;",
          "245: }",
          "",
          "[Removed Lines]",
          "233:   for(i=0; i<pTab->nCol; i++, iRegStore++){",
          "235:     if( (colFlags & COLFLAG_VIRTUAL)!=0 ){",
          "237:       iRegStore--;",
          "238:     }else if( (colFlags & COLFLAG_NOTAVAIL)!=0 ){",
          "240:       sqlite3ExprCode(pParse, pTab->aCol[i].pDflt, iRegStore);",
          "",
          "[Added Lines]",
          "234:   for(i=nv=0; i<pTab->nCol; i++){",
          "236:     if( (colFlags & COLFLAG_NOTAVAIL)!=0 ){",
          "237:       assert( colFlags & COLFLAG_GENERATED );",
          "238:       if( colFlags & COLFLAG_VIRTUAL ){",
          "240:         assert( pTab->nNVCol+nv == sqlite3TableColumnToStorage(pTab,i) );",
          "241:         sqlite3ExprCode(pParse, pTab->aCol[i].pDflt,",
          "242:                         iRegStore+pTab->nNVCol+nv);",
          "243:       }else{",
          "245:         assert( i-nv == sqlite3TableColumnToStorage(pTab,i) );",
          "246:         sqlite3ExprCode(pParse, pTab->aCol[i].pDflt, iRegStore+i-nv);",
          "247:       }",
          "250:     if( (colFlags & COLFLAG_VIRTUAL)!=0 ) nv++;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1055:       int k;",
          "1056:       u32 colFlags;",
          "1057:       assert( i>=nHidden );",
          "1059:       if( i==pTab->iPKey ){",
          "",
          "[Removed Lines]",
          "1058:       assert( iRegStore==sqlite3TableColumnToStorage(pTab,i)+regRowid+1 );",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1108:     }",
          "1110: #ifndef SQLITE_OMIT_GENERATED_COLUMNS",
          "1115:     }",
          "1116: #endif",
          "",
          "[Removed Lines]",
          "1113:     if( pTab->tabFlags & TF_HasStored ){",
          "1114:       sqlite3ComputeStoredColumns(pParse, regRowid+1, pTab);",
          "",
          "[Added Lines]",
          "1120:     if( pTab->tabFlags & (TF_HasStored|TF_HasVirtual) ){",
          "1121:       sqlite3ComputeGeneratedColumns(pParse, regRowid+1, pTab);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1454:     assert( onError==OE_Rollback || onError==OE_Abort || onError==OE_Fail",
          "1455:         || onError==OE_Ignore || onError==OE_Replace );",
          "1456:     addr1 = 0;",
          "1470:     switch( onError ){",
          "1471:       case OE_Replace: {",
          "1472:         assert( onError==OE_Replace );",
          "",
          "[Removed Lines]",
          "1457:     if( (pTab->tabFlags & TF_HasVirtual)==0 ){",
          "1458:       iReg = regNewData+1+i;",
          "1459:     }else if( pTab->aCol[i].colFlags & COLFLAG_VIRTUAL ){",
          "1460:       iReg = ++pParse->nMem;",
          "1461:       assert( pParse->iSelfTab==0 );",
          "1462:       pParse->iSelfTab = -regNewData;",
          "1463:       sqlite3ExprCode(pParse, pTab->aCol[i].pDflt, iReg);",
          "1464:       pParse->iSelfTab = 0;",
          "1465:       if( onError==OE_Replace ) onError = OE_Abort;",
          "1466:     }else{",
          "1467:       testcase( i!=sqlite3TableColumnToStorage(pTab, i) );",
          "1468:       iReg = sqlite3TableColumnToStorage(pTab, i) + regNewData + 1;",
          "1469:     }",
          "",
          "[Added Lines]",
          "1464:     testcase( i!=sqlite3TableColumnToStorage(pTab, i) );",
          "1465:     testcase( pTab->aCol[i].colFlags & COLFLAG_VIRTUAL );",
          "1466:     testcase( pTab->aCol[i].colFlags & COLFLAG_STORED );",
          "1467:     testcase( pTab->aCol[i].colFlags & COLFLAG_GENERATED );",
          "1468:     iReg = sqlite3TableColumnToStorage(pTab, i) + regNewData + 1;",
          "",
          "---------------"
        ],
        "src/sqliteInt.h||src/sqliteInt.h": [
          "File: src/sqliteInt.h -> src/sqliteInt.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "4044: #endif",
          "4045: void sqlite3Insert(Parse*, SrcList*, Select*, IdList*, int, Upsert*);",
          "4046: #ifndef SQLITE_OMIT_GENERATED_COLUMNS",
          "4048: #endif",
          "4049: void *sqlite3ArrayAllocate(sqlite3*,void*,int,int*,int*);",
          "4050: IdList *sqlite3IdListAppend(Parse*, IdList*, Token*);",
          "",
          "[Removed Lines]",
          "4047:   void sqlite3ComputeStoredColumns(Parse*, int, Table*);",
          "",
          "[Added Lines]",
          "4047:   void sqlite3ComputeGeneratedColumns(Parse*, int, Table*);",
          "",
          "---------------"
        ],
        "src/update.c||src/update.c": [
          "File: src/update.c -> src/update.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "693:     }",
          "694:   }",
          "695: #ifndef SQLITE_OMIT_GENERATED_COLUMNS",
          "698:   }",
          "699: #endif",
          "",
          "[Removed Lines]",
          "696:   if( pTab->tabFlags & TF_HasStored ){",
          "697:     sqlite3ComputeStoredColumns(pParse, regNew, pTab);",
          "",
          "[Added Lines]",
          "696:   if( pTab->tabFlags & (TF_HasStored|TF_HasVirtual) ){",
          "697:     sqlite3ComputeGeneratedColumns(pParse, regNew, pTab);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "737:       }",
          "738:     }",
          "739: #ifndef SQLITE_OMIT_GENERATED_COLUMNS",
          "742:     }",
          "743: #endif",
          "744:   }",
          "",
          "[Removed Lines]",
          "740:     if( pTab->tabFlags & TF_HasStored ){",
          "741:       sqlite3ComputeStoredColumns(pParse, regNew, pTab);",
          "",
          "[Added Lines]",
          "740:     if( pTab->tabFlags & (TF_HasStored|TF_HasVirtual) ){",
          "741:       sqlite3ComputeGeneratedColumns(pParse, regNew, pTab);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5c0666d9e32ff96b6b7aee15071be8ef57e4fd37",
      "candidate_info": {
        "commit_hash": "5c0666d9e32ff96b6b7aee15071be8ef57e4fd37",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/5c0666d9e32ff96b6b7aee15071be8ef57e4fd37",
        "files": [
          "ext/fts3/fts3.c",
          "manifest",
          "manifest.uuid",
          "test/fuzzdata8.db"
        ],
        "message": "In FTS3/4, the poslist end marker must be larger than any other possible poslist value, even on a corrupt poslist.\n\nFossilOrigin-Name: 752679aea5a6bbde24cbf39e2fa018f7dd1c226d463ca4bd74125303b2255170",
        "before_after_code_files": [
          "ext/fts3/fts3.c||ext/fts3/fts3.c",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/fts3/fts3.c||ext/fts3/fts3.c": [
          "File: ext/fts3/fts3.c -> ext/fts3/fts3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "308:   SQLITE_EXTENSION_INIT1",
          "309: #endif",
          "311: static int fts3EvalNext(Fts3Cursor *pCsr);",
          "312: static int fts3EvalStart(Fts3Cursor *pCsr);",
          "313: static int fts3TermSegReaderCursor(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "318: #ifndef SQLITE_AMALGAMATION",
          "319: # define LARGEST_INT64  (0xffffffff|(((sqlite3_int64)0x7fffffff)<<32))",
          "320: # define SMALLEST_INT64 (((sqlite3_int64)-1) - LARGEST_INT64)",
          "321: #endif",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2086: }",
          "",
          "[Removed Lines]",
          "2092: #define POSITION_LIST_END 0x7fffffff",
          "",
          "[Added Lines]",
          "2105: #define POSITION_LIST_END LARGEST_INT64",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2165:       fts3GetVarint32(&p1[1], &iCol1);",
          "2166:       if( iCol1==0 ) return FTS_CORRUPT_VTAB;",
          "2167:     }",
          "2169:     else iCol1 = 0;",
          "2171:     if( *p2==POS_COLUMN ){",
          "2172:       fts3GetVarint32(&p2[1], &iCol2);",
          "2173:       if( iCol2==0 ) return FTS_CORRUPT_VTAB;",
          "2174:     }",
          "2176:     else iCol2 = 0;",
          "2178:     if( iCol1==iCol2 ){",
          "",
          "[Removed Lines]",
          "2168:     else if( *p1==POS_END ) iCol1 = POSITION_LIST_END;",
          "2175:     else if( *p2==POS_END ) iCol2 = POSITION_LIST_END;",
          "",
          "[Added Lines]",
          "2181:     else if( *p1==POS_END ) iCol1 = 0x7fffffff;",
          "2188:     else if( *p2==POS_END ) iCol2 = 0x7fffffff;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3182:   return rc;",
          "3183: }",
          "",
          "[Removed Lines]",
          "3192: #ifndef SQLITE_AMALGAMATION",
          "3193: # define LARGEST_INT64  (0xffffffff|(((sqlite3_int64)0x7fffffff)<<32))",
          "3194: # define SMALLEST_INT64 (((sqlite3_int64)-1) - LARGEST_INT64)",
          "3195: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 326cdc16f4db23c1d17596e4ef8d9d7abc672d48665950029ba53fd40c1b2d99",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1735f91df4db4d012154af319245392555c01911",
      "candidate_info": {
        "commit_hash": "1735f91df4db4d012154af319245392555c01911",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/1735f91df4db4d012154af319245392555c01911",
        "files": [
          "ext/misc/fileio.c",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Improved detection and reporting of errors in the readfile() extension SQL function.\n\nFossilOrigin-Name: d2f0b5a483869d39f5c5814c9d6df3d3b8a46d582b4dcf0cf11e23b707c4213e",
        "before_after_code_files": [
          "ext/misc/fileio.c||ext/misc/fileio.c",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/misc/fileio.c||ext/misc/fileio.c": [
          "File: ext/misc/fileio.c -> ext/misc/fileio.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "126: static void readFileContents(sqlite3_context *ctx, const char *zName){",
          "127:   FILE *in;",
          "129:   void *pBuf;",
          "131:   in = fopen(zName, \"rb\");",
          "133:   fseek(in, 0, SEEK_END);",
          "134:   nIn = ftell(in);",
          "135:   rewind(in);",
          "136:   pBuf = sqlite3_malloc( nIn );",
          "138:     sqlite3_result_blob(ctx, pBuf, nIn, sqlite3_free);",
          "139:   }else{",
          "140:     sqlite3_free(pBuf);",
          "141:   }",
          "142:   fclose(in);",
          "",
          "[Removed Lines]",
          "128:   long nIn;",
          "132:   if( in==0 ) return;",
          "137:   if( pBuf && 1==fread(pBuf, nIn, 1, in) ){",
          "",
          "[Added Lines]",
          "135:   sqlite3_int64 nIn;",
          "137:   sqlite3 *db;",
          "138:   int mxBlob;",
          "141:   if( in==0 ){",
          "143:     return;",
          "144:   }",
          "148:   db = sqlite3_context_db_handle(ctx);",
          "149:   mxBlob = sqlite3_limit(db, SQLITE_LIMIT_LENGTH, -1);",
          "150:   if( nIn>mxBlob ){",
          "151:     sqlite3_result_error_code(ctx, SQLITE_TOOBIG);",
          "152:     fclose(in);",
          "153:     return;",
          "154:   }",
          "156:   if( pBuf==0 ){",
          "157:     sqlite3_result_error_nomem(ctx);",
          "158:     fclose(in);",
          "159:     return;",
          "160:   }",
          "161:   if( 1==fread(pBuf, nIn, 1, in) ){",
          "164:     sqlite3_result_error_code(ctx, SQLITE_IOERR);",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 2a47387ba6aa3c294607b7641aa1c4cf70a7b27a861e1098c2f79a38e5b7036a",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}