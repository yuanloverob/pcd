{
  "cve_id": "CVE-2017-6952",
  "cve_desc": "Integer overflow in the cs_winkernel_malloc function in winkernel_mm.c in Capstone 3.0.4 and earlier allows attackers to cause a denial of service (heap-based buffer overflow in a kernel driver) or possibly have unspecified other impact via a large value.",
  "repo": "aquynh/capstone",
  "patch_hash": "6fe86eef621b9849f51a5e1e5d73258a93440403",
  "patch_info": {
    "commit_hash": "6fe86eef621b9849f51a5e1e5d73258a93440403",
    "repo": "aquynh/capstone",
    "commit_url": "https://github.com/aquynh/capstone/commit/6fe86eef621b9849f51a5e1e5d73258a93440403",
    "files": [
      "windows/winkernel_mm.c"
    ],
    "message": "provide a validity check to prevent against Integer overflow conditions (#870)\n\n* provide a validity check to prevent against Integer overflow conditions\n\n* fix some style issues.",
    "before_after_code_files": [
      "windows/winkernel_mm.c||windows/winkernel_mm.c"
    ]
  },
  "patch_diff": {
    "windows/winkernel_mm.c||windows/winkernel_mm.c": [
      "File: windows/winkernel_mm.c -> windows/winkernel_mm.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "4: #include \"winkernel_mm.h\"",
      "5: #include <ntddk.h>",
      "8: static const ULONG CS_WINKERNEL_POOL_TAG = 'kwsC';",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6: #include <Ntintsafe.h>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "35: #pragma prefast(suppress : 30030)  // Allocating executable POOL_TYPE memory",
      "38:  if (!block) {",
      "39:   return NULL;",
      "40:  }",
      "",
      "[Removed Lines]",
      "36:  CS_WINKERNEL_MEMBLOCK *block = (CS_WINKERNEL_MEMBLOCK *)ExAllocatePoolWithTag(",
      "37:    NonPagedPool, size + sizeof(CS_WINKERNEL_MEMBLOCK), CS_WINKERNEL_POOL_TAG);",
      "",
      "[Added Lines]",
      "37:  size_t number_of_bytes = 0;",
      "38:  CS_WINKERNEL_MEMBLOCK *block = NULL;",
      "42:  if (!NT_SUCCESS(RtlSizeTAdd(size, sizeof(CS_WINKERNEL_MEMBLOCK), &number_of_bytes))) {",
      "43:   return NULL;",
      "44:  }",
      "45:  block = (CS_WINKERNEL_MEMBLOCK *)ExAllocatePoolWithTag(",
      "46:    NonPagedPool, number_of_bytes, CS_WINKERNEL_POOL_TAG);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "78cbed4cc765b7d1259eb947aed3063e26ddb146",
      "candidate_info": {
        "commit_hash": "78cbed4cc765b7d1259eb947aed3063e26ddb146",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/78cbed4cc765b7d1259eb947aed3063e26ddb146",
        "files": [
          "COMPILE_MSVC.TXT",
          "HACK.TXT",
          "contrib/cs_driver/cs_driver/cs_driver.c",
          "docs/README",
          "include/x86.h",
          "tests/test_winkernel.cpp",
          "windows/winkernel_mm.c",
          "windows/winkernel_mm.h"
        ],
        "message": "fix typo, style\n\nSigned-off-by: Satoshi Tanda <tanda.sat@gmail.com>",
        "before_after_code_files": [
          "contrib/cs_driver/cs_driver/cs_driver.c||contrics_driver/cs_driver/cs_driver.c",
          "include/x86.h||include/x86.h",
          "tests/test_winkernel.cpp||tests/test_winkernel.cpp",
          "windows/winkernel_mm.c||windows/winkernel_mm.c",
          "windows/winkernel_mm.h||windows/winkernel_mm.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [
            "windows/winkernel_mm.c||windows/winkernel_mm.c"
          ],
          "candidate": [
            "windows/winkernel_mm.c||windows/winkernel_mm.c"
          ]
        }
      },
      "candidate_diff": {
        "contrib/cs_driver/cs_driver/cs_driver.c||contrics_driver/cs_driver/cs_driver.c": [
          "File: contrib/cs_driver/cs_driver/cs_driver.c -> contrics_driver/cs_driver/cs_driver.c"
        ],
        "include/x86.h||include/x86.h": [
          "File: include/x86.h -> include/x86.h"
        ],
        "tests/test_winkernel.cpp||tests/test_winkernel.cpp": [
          "File: tests/test_winkernel.cpp -> tests/test_winkernel.cpp"
        ],
        "windows/winkernel_mm.c||windows/winkernel_mm.c": [
          "File: windows/winkernel_mm.c -> windows/winkernel_mm.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "77:  return new_ptr;",
          "78: }",
          "83: #pragma warning(push)",
          "87: int CAPSTONE_API cs_winkernel_vsnprintf(char *buffer, size_t count, const char *format, va_list argptr)",
          "88: {",
          "89:  int result = _vsnprintf(buffer, count, format, argptr);",
          "94:  if (result == -1 || (size_t)result == count) {",
          "95:   buffer[count - 1] = '\\0';",
          "96:  }",
          "98:  if (result == -1) {",
          "",
          "[Removed Lines]",
          "84: #pragma warning(disable : 28719)  // Banned API Usage : _vsnprintf is a Banned",
          "",
          "[Added Lines]",
          "87: #pragma warning(disable : 28719)",
          "",
          "---------------"
        ],
        "windows/winkernel_mm.h||windows/winkernel_mm.h": [
          "File: windows/winkernel_mm.h -> windows/winkernel_mm.h"
        ]
      }
    },
    {
      "candidate_hash": "b39a10c5bc084ac02455184fef226366232c76bd",
      "candidate_info": {
        "commit_hash": "b39a10c5bc084ac02455184fef226366232c76bd",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/b39a10c5bc084ac02455184fef226366232c76bd",
        "files": [
          "msvc/capstone.sln",
          "msvc/capstone_static_winkernel/capstone_static_winkernel.vcxproj",
          "msvc/test_winkernel/test_winkernel.vcxproj"
        ],
        "message": "add winkernel and its test projects",
        "before_after_code_files": [
          "msvc/capstone.sln||msvc/capstone.sln",
          "msvc/capstone_static_winkernel/capstone_static_winkernel.vcxproj||msvc/capstone_static_winkernel/capstone_static_winkernel.vcxproj",
          "msvc/test_winkernel/test_winkernel.vcxproj||msvc/test_winkernel/test_winkernel.vcxproj"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "msvc/capstone.sln||msvc/capstone.sln": [
          "File: msvc/capstone.sln -> msvc/capstone.sln",
          "--- Hunk 1 ---",
          "[Context before]",
          "65: EndProject",
          "66: Project(\"{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}\") = \"capstone_dll\", \"capstone_dll\\capstone_dll.vcxproj\", \"{2171C0E8-4915-49B9-AC23-A484FA08C126}\"",
          "67: EndProject",
          "68: Global",
          "69:  GlobalSection(SolutionConfigurationPlatforms) = preSolution",
          "70:   Debug|Win32 = Debug|Win32",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "68: Project(\"{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}\") = \"capstone_static_winkernel\", \"capstone_static_winkernel\\capstone_static_winkernel.vcxproj\", \"{FE197816-EF84-4E8D-B29D-E0A6BA2B144B}\"",
          "69: EndProject",
          "70: Project(\"{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}\") = \"test_winkernel\", \"test_winkernel\\test_winkernel.vcxproj\", \"{C6E4974C-2CAF-499A-802A-FB906F86B4C8}\"",
          "71:  ProjectSection(ProjectDependencies) = postProject",
          "72:   {FE197816-EF84-4E8D-B29D-E0A6BA2B144B} = {FE197816-EF84-4E8D-B29D-E0A6BA2B144B}",
          "73:  EndProjectSection",
          "74: EndProject",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "185:   {48EB18D5-7060-4C54-B8B1-BFF077329604}.Release|Win32.Build.0 = Release|Win32",
          "186:   {48EB18D5-7060-4C54-B8B1-BFF077329604}.Release|x64.ActiveCfg = Release|x64",
          "187:   {48EB18D5-7060-4C54-B8B1-BFF077329604}.Release|x64.Build.0 = Release|x64",
          "188:  EndGlobalSection",
          "189:  GlobalSection(SolutionProperties) = preSolution",
          "190:   HideSolutionNode = FALSE",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "195:   {FE197816-EF84-4E8D-B29D-E0A6BA2B144B}.Debug|Win32.ActiveCfg = Debug|Win32",
          "196:   {FE197816-EF84-4E8D-B29D-E0A6BA2B144B}.Debug|Win32.Build.0 = Debug|Win32",
          "197:   {FE197816-EF84-4E8D-B29D-E0A6BA2B144B}.Debug|x64.ActiveCfg = Debug|x64",
          "198:   {FE197816-EF84-4E8D-B29D-E0A6BA2B144B}.Debug|x64.Build.0 = Debug|x64",
          "199:   {FE197816-EF84-4E8D-B29D-E0A6BA2B144B}.Release|Win32.ActiveCfg = Release|Win32",
          "200:   {FE197816-EF84-4E8D-B29D-E0A6BA2B144B}.Release|Win32.Build.0 = Release|Win32",
          "201:   {FE197816-EF84-4E8D-B29D-E0A6BA2B144B}.Release|x64.ActiveCfg = Release|x64",
          "202:   {FE197816-EF84-4E8D-B29D-E0A6BA2B144B}.Release|x64.Build.0 = Release|x64",
          "203:   {C6E4974C-2CAF-499A-802A-FB906F86B4C8}.Debug|Win32.ActiveCfg = Debug|Win32",
          "204:   {C6E4974C-2CAF-499A-802A-FB906F86B4C8}.Debug|Win32.Build.0 = Debug|Win32",
          "205:   {C6E4974C-2CAF-499A-802A-FB906F86B4C8}.Debug|x64.ActiveCfg = Debug|x64",
          "206:   {C6E4974C-2CAF-499A-802A-FB906F86B4C8}.Debug|x64.Build.0 = Debug|x64",
          "207:   {C6E4974C-2CAF-499A-802A-FB906F86B4C8}.Release|Win32.ActiveCfg = Release|Win32",
          "208:   {C6E4974C-2CAF-499A-802A-FB906F86B4C8}.Release|Win32.Build.0 = Release|Win32",
          "209:   {C6E4974C-2CAF-499A-802A-FB906F86B4C8}.Release|x64.ActiveCfg = Release|x64",
          "210:   {C6E4974C-2CAF-499A-802A-FB906F86B4C8}.Release|x64.Build.0 = Release|x64",
          "",
          "---------------"
        ],
        "msvc/capstone_static_winkernel/capstone_static_winkernel.vcxproj||msvc/capstone_static_winkernel/capstone_static_winkernel.vcxproj": [
          "File: msvc/capstone_static_winkernel/capstone_static_winkernel.vcxproj -> msvc/capstone_static_winkernel/capstone_static_winkernel.vcxproj",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: \ufeff<?xml version=\"1.0\" encoding=\"utf-8\"?>",
          "2: <Project DefaultTargets=\"Build\" ToolsVersion=\"4.0\" xmlns=\"http://schemas.microsoft.com/developer/msbuild/2003\">",
          "3:   <ItemGroup Label=\"ProjectConfigurations\">",
          "4:     <ProjectConfiguration Include=\"Debug|Win32\">",
          "5:       <Configuration>Debug</Configuration>",
          "6:       <Platform>Win32</Platform>",
          "7:     </ProjectConfiguration>",
          "8:     <ProjectConfiguration Include=\"Debug|x64\">",
          "9:       <Configuration>Debug</Configuration>",
          "10:       <Platform>x64</Platform>",
          "11:     </ProjectConfiguration>",
          "12:     <ProjectConfiguration Include=\"Release|Win32\">",
          "13:       <Configuration>Release</Configuration>",
          "14:       <Platform>Win32</Platform>",
          "15:     </ProjectConfiguration>",
          "16:     <ProjectConfiguration Include=\"Release|x64\">",
          "17:       <Configuration>Release</Configuration>",
          "18:       <Platform>x64</Platform>",
          "19:     </ProjectConfiguration>",
          "20:   </ItemGroup>",
          "21:   <ItemGroup>",
          "22:     <ClCompile Include=\"..\\..\\arch\\AArch64\\AArch64BaseInfo.c\" />",
          "23:     <ClCompile Include=\"..\\..\\arch\\AArch64\\AArch64Disassembler.c\" />",
          "24:     <ClCompile Include=\"..\\..\\arch\\AArch64\\AArch64InstPrinter.c\" />",
          "25:     <ClCompile Include=\"..\\..\\arch\\AArch64\\AArch64Mapping.c\" />",
          "26:     <ClCompile Include=\"..\\..\\arch\\AArch64\\AArch64Module.c\" />",
          "27:     <ClCompile Include=\"..\\..\\arch\\ARM\\ARMDisassembler.c\" />",
          "28:     <ClCompile Include=\"..\\..\\arch\\ARM\\ARMInstPrinter.c\" />",
          "29:     <ClCompile Include=\"..\\..\\arch\\ARM\\ARMMapping.c\" />",
          "30:     <ClCompile Include=\"..\\..\\arch\\ARM\\ARMModule.c\" />",
          "31:     <ClCompile Include=\"..\\..\\arch\\Mips\\MipsDisassembler.c\" />",
          "32:     <ClCompile Include=\"..\\..\\arch\\Mips\\MipsInstPrinter.c\" />",
          "33:     <ClCompile Include=\"..\\..\\arch\\Mips\\MipsMapping.c\" />",
          "34:     <ClCompile Include=\"..\\..\\arch\\Mips\\MipsModule.c\" />",
          "35:     <ClCompile Include=\"..\\..\\arch\\PowerPC\\PPCDisassembler.c\" />",
          "36:     <ClCompile Include=\"..\\..\\arch\\PowerPC\\PPCInstPrinter.c\" />",
          "37:     <ClCompile Include=\"..\\..\\arch\\PowerPC\\PPCMapping.c\" />",
          "38:     <ClCompile Include=\"..\\..\\arch\\PowerPC\\PPCModule.c\" />",
          "39:     <ClCompile Include=\"..\\..\\arch\\Sparc\\SparcDisassembler.c\" />",
          "40:     <ClCompile Include=\"..\\..\\arch\\Sparc\\SparcInstPrinter.c\" />",
          "41:     <ClCompile Include=\"..\\..\\arch\\Sparc\\SparcMapping.c\" />",
          "42:     <ClCompile Include=\"..\\..\\arch\\Sparc\\SparcModule.c\" />",
          "43:     <ClCompile Include=\"..\\..\\arch\\SystemZ\\SystemZDisassembler.c\" />",
          "44:     <ClCompile Include=\"..\\..\\arch\\SystemZ\\SystemZInstPrinter.c\" />",
          "45:     <ClCompile Include=\"..\\..\\arch\\SystemZ\\SystemZMapping.c\" />",
          "46:     <ClCompile Include=\"..\\..\\arch\\SystemZ\\SystemZMCTargetDesc.c\" />",
          "47:     <ClCompile Include=\"..\\..\\arch\\SystemZ\\SystemZModule.c\" />",
          "48:     <ClCompile Include=\"..\\..\\arch\\X86\\X86ATTInstPrinter.c\" />",
          "49:     <ClCompile Include=\"..\\..\\arch\\X86\\X86Disassembler.c\" />",
          "50:     <ClCompile Include=\"..\\..\\arch\\X86\\X86DisassemblerDecoder.c\" />",
          "51:     <ClCompile Include=\"..\\..\\arch\\X86\\X86IntelInstPrinter.c\" />",
          "52:     <ClCompile Include=\"..\\..\\arch\\X86\\X86Mapping.c\" />",
          "53:     <ClCompile Include=\"..\\..\\arch\\X86\\X86Module.c\" />",
          "54:     <ClCompile Include=\"..\\..\\arch\\XCore\\XCoreInstPrinter.c\" />",
          "55:     <ClCompile Include=\"..\\..\\arch\\XCore\\XCoreDisassembler.c\" />",
          "56:     <ClCompile Include=\"..\\..\\arch\\XCore\\XCoreMapping.c\" />",
          "57:     <ClCompile Include=\"..\\..\\arch\\XCore\\XCoreModule.c\" />",
          "58:     <ClCompile Include=\"..\\..\\cs.c\" />",
          "59:     <ClCompile Include=\"..\\..\\MCInst.c\" />",
          "60:     <ClCompile Include=\"..\\..\\MCInstrDesc.c\" />",
          "61:     <ClCompile Include=\"..\\..\\MCRegisterInfo.c\" />",
          "62:     <ClCompile Include=\"..\\..\\SStream.c\" />",
          "63:     <ClCompile Include=\"..\\..\\utils.c\" />",
          "64:     <ClCompile Include=\"..\\..\\windows\\winkernel_mm.c\" />",
          "65:   </ItemGroup>",
          "66:   <PropertyGroup Label=\"Globals\">",
          "67:     <ProjectGuid>{FE197816-EF84-4E8D-B29D-E0A6BA2B144B}</ProjectGuid>",
          "68:     <TemplateGuid>{1bc93793-694f-48fe-9372-81e2b05556fd}</TemplateGuid>",
          "69:     <TargetFrameworkVersion>v4.5</TargetFrameworkVersion>",
          "70:     <MinimumVisualStudioVersion>11.0</MinimumVisualStudioVersion>",
          "71:     <Configuration>Win8.1 Debug</Configuration>",
          "72:     <Platform Condition=\"'$(Platform)' == ''\">Win32</Platform>",
          "73:     <RootNamespace>capstone_static_winkernel</RootNamespace>",
          "74:     <ProjectName>capstone_static_winkernel</ProjectName>",
          "75:   </PropertyGroup>",
          "76:   <Import Project=\"$(VCTargetsPath)\\Microsoft.Cpp.Default.props\" />",
          "77:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|Win32'\" Label=\"Configuration\">",
          "78:     <TargetVersion>Windows7</TargetVersion>",
          "79:     <UseDebugLibraries>true</UseDebugLibraries>",
          "80:     <PlatformToolset>WindowsKernelModeDriver8.1</PlatformToolset>",
          "81:     <ConfigurationType>StaticLibrary</ConfigurationType>",
          "82:     <DriverType>KMDF</DriverType>",
          "83:   </PropertyGroup>",
          "84:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|Win32'\" Label=\"Configuration\">",
          "85:     <TargetVersion>Windows7</TargetVersion>",
          "86:     <UseDebugLibraries>false</UseDebugLibraries>",
          "87:     <PlatformToolset>WindowsKernelModeDriver8.1</PlatformToolset>",
          "88:     <ConfigurationType>StaticLibrary</ConfigurationType>",
          "89:     <DriverType>KMDF</DriverType>",
          "90:   </PropertyGroup>",
          "91:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|x64'\" Label=\"Configuration\">",
          "92:     <TargetVersion>Windows7</TargetVersion>",
          "93:     <UseDebugLibraries>true</UseDebugLibraries>",
          "94:     <PlatformToolset>WindowsKernelModeDriver8.1</PlatformToolset>",
          "95:     <ConfigurationType>StaticLibrary</ConfigurationType>",
          "96:     <DriverType>KMDF</DriverType>",
          "97:   </PropertyGroup>",
          "98:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|x64'\" Label=\"Configuration\">",
          "99:     <TargetVersion>Windows7</TargetVersion>",
          "100:     <UseDebugLibraries>false</UseDebugLibraries>",
          "101:     <PlatformToolset>WindowsKernelModeDriver8.1</PlatformToolset>",
          "102:     <ConfigurationType>StaticLibrary</ConfigurationType>",
          "103:     <DriverType>KMDF</DriverType>",
          "104:   </PropertyGroup>",
          "105:   <Import Project=\"$(VCTargetsPath)\\Microsoft.Cpp.props\" />",
          "106:   <ImportGroup Label=\"ExtensionSettings\">",
          "107:   </ImportGroup>",
          "108:   <ImportGroup Label=\"PropertySheets\">",
          "109:     <Import Project=\"$(UserRootDir)\\Microsoft.Cpp.$(Platform).user.props\" Condition=\"exists('$(UserRootDir)\\Microsoft.Cpp.$(Platform).user.props')\" Label=\"LocalAppDataPlatform\" />",
          "110:   </ImportGroup>",
          "111:   <PropertyGroup Label=\"UserMacros\" />",
          "112:   <PropertyGroup />",
          "113:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|Win32'\">",
          "114:     <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>",
          "115:   </PropertyGroup>",
          "116:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|Win32'\">",
          "117:     <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>",
          "118:   </PropertyGroup>",
          "119:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|x64'\">",
          "120:     <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>",
          "121:   </PropertyGroup>",
          "122:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|x64'\">",
          "123:     <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>",
          "124:   </PropertyGroup>",
          "125:   <ItemDefinitionGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|Win32'\">",
          "126:     <ClCompile>",
          "127:       <WppScanConfigurationData Condition=\"'%(ClCompile. ScanConfigurationData)'  == ''\">trace.h</WppScanConfigurationData>",
          "128:       <WppKernelMode>true</WppKernelMode>",
          "129:       <AdditionalIncludeDirectories>..\\..\\include;..\\headers;$(IntDir);%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>",
          "130:       <PreprocessorDefinitions>CAPSTONE_X86_ATT_DISABLE_NO;CAPSTONE_DIET_NO;CAPSTONE_X86_REDUCE_NO;CAPSTONE_HAS_ARM;CAPSTONE_HAS_ARM64;CAPSTONE_HAS_MIPS;CAPSTONE_HAS_POWERPC;CAPSTONE_HAS_SPARC;CAPSTONE_HAS_SYSZ;CAPSTONE_HAS_X86;CAPSTONE_HAS_XCORE;CAPSTONE_USE_SYS_DYN_MEM;%(PreprocessorDefinitions)</PreprocessorDefinitions>",
          "131:       <TreatWarningAsError>false</TreatWarningAsError>",
          "132:     </ClCompile>",
          "133:   </ItemDefinitionGroup>",
          "134:   <ItemDefinitionGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|Win32'\">",
          "135:     <ClCompile>",
          "136:       <WppScanConfigurationData Condition=\"'%(ClCompile. ScanConfigurationData)'  == ''\">trace.h</WppScanConfigurationData>",
          "137:       <WppKernelMode>true</WppKernelMode>",
          "138:       <AdditionalIncludeDirectories>..\\..\\include;..\\headers;$(IntDir);%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>",
          "139:       <PreprocessorDefinitions>CAPSTONE_X86_ATT_DISABLE_NO;CAPSTONE_DIET_NO;CAPSTONE_X86_REDUCE_NO;CAPSTONE_HAS_ARM;CAPSTONE_HAS_ARM64;CAPSTONE_HAS_MIPS;CAPSTONE_HAS_POWERPC;CAPSTONE_HAS_SPARC;CAPSTONE_HAS_SYSZ;CAPSTONE_HAS_X86;CAPSTONE_HAS_XCORE;CAPSTONE_USE_SYS_DYN_MEM;%(PreprocessorDefinitions)</PreprocessorDefinitions>",
          "140:       <TreatWarningAsError>false</TreatWarningAsError>",
          "141:     </ClCompile>",
          "142:   </ItemDefinitionGroup>",
          "143:   <ItemDefinitionGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|x64'\">",
          "144:     <ClCompile>",
          "145:       <WppScanConfigurationData Condition=\"'%(ClCompile. ScanConfigurationData)'  == ''\">trace.h</WppScanConfigurationData>",
          "146:       <WppKernelMode>true</WppKernelMode>",
          "147:       <AdditionalIncludeDirectories>..\\..\\include;..\\headers;$(IntDir);%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>",
          "148:       <PreprocessorDefinitions>CAPSTONE_X86_ATT_DISABLE_NO;CAPSTONE_DIET_NO;CAPSTONE_X86_REDUCE_NO;CAPSTONE_HAS_ARM;CAPSTONE_HAS_ARM64;CAPSTONE_HAS_MIPS;CAPSTONE_HAS_POWERPC;CAPSTONE_HAS_SPARC;CAPSTONE_HAS_SYSZ;CAPSTONE_HAS_X86;CAPSTONE_HAS_XCORE;CAPSTONE_USE_SYS_DYN_MEM;%(PreprocessorDefinitions)</PreprocessorDefinitions>",
          "149:       <TreatWarningAsError>false</TreatWarningAsError>",
          "150:     </ClCompile>",
          "151:   </ItemDefinitionGroup>",
          "152:   <ItemDefinitionGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|x64'\">",
          "153:     <ClCompile>",
          "154:       <WppScanConfigurationData Condition=\"'%(ClCompile. ScanConfigurationData)'  == ''\">trace.h</WppScanConfigurationData>",
          "155:       <WppKernelMode>true</WppKernelMode>",
          "156:       <AdditionalIncludeDirectories>..\\..\\include;..\\headers;$(IntDir);%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>",
          "157:       <PreprocessorDefinitions>CAPSTONE_X86_ATT_DISABLE_NO;CAPSTONE_DIET_NO;CAPSTONE_X86_REDUCE_NO;CAPSTONE_HAS_ARM;CAPSTONE_HAS_ARM64;CAPSTONE_HAS_MIPS;CAPSTONE_HAS_POWERPC;CAPSTONE_HAS_SPARC;CAPSTONE_HAS_SYSZ;CAPSTONE_HAS_X86;CAPSTONE_HAS_XCORE;CAPSTONE_USE_SYS_DYN_MEM;%(PreprocessorDefinitions)</PreprocessorDefinitions>",
          "158:       <TreatWarningAsError>false</TreatWarningAsError>",
          "159:     </ClCompile>",
          "160:   </ItemDefinitionGroup>",
          "161:   <ItemGroup>",
          "162:     <FilesToPackage Include=\"$(TargetPath)\" />",
          "163:     <FilesToPackage Include=\"@(Inf->'%(CopyOutput)')\" Condition=\"'@(Inf)'!=''\" />",
          "164:   </ItemGroup>",
          "165:   <Import Project=\"$(VCTargetsPath)\\Microsoft.Cpp.targets\" />",
          "166:   <ImportGroup Label=\"ExtensionTargets\">",
          "167:   </ImportGroup>",
          "168: </Project>",
          "",
          "---------------"
        ],
        "msvc/test_winkernel/test_winkernel.vcxproj||msvc/test_winkernel/test_winkernel.vcxproj": [
          "File: msvc/test_winkernel/test_winkernel.vcxproj -> msvc/test_winkernel/test_winkernel.vcxproj",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: \ufeff<?xml version=\"1.0\" encoding=\"utf-8\"?>",
          "2: <Project DefaultTargets=\"Build\" ToolsVersion=\"4.0\" xmlns=\"http://schemas.microsoft.com/developer/msbuild/2003\">",
          "3:   <ItemGroup Label=\"ProjectConfigurations\">",
          "4:     <ProjectConfiguration Include=\"Debug|Win32\">",
          "5:       <Configuration>Debug</Configuration>",
          "6:       <Platform>Win32</Platform>",
          "7:     </ProjectConfiguration>",
          "8:     <ProjectConfiguration Include=\"Debug|x64\">",
          "9:       <Configuration>Debug</Configuration>",
          "10:       <Platform>x64</Platform>",
          "11:     </ProjectConfiguration>",
          "12:     <ProjectConfiguration Include=\"Release|Win32\">",
          "13:       <Configuration>Release</Configuration>",
          "14:       <Platform>Win32</Platform>",
          "15:     </ProjectConfiguration>",
          "16:     <ProjectConfiguration Include=\"Release|x64\">",
          "17:       <Configuration>Release</Configuration>",
          "18:       <Platform>x64</Platform>",
          "19:     </ProjectConfiguration>",
          "20:   </ItemGroup>",
          "21:   <PropertyGroup Label=\"Globals\">",
          "22:     <ProjectGuid>{C6E4974C-2CAF-499A-802A-FB906F86B4C8}</ProjectGuid>",
          "23:     <TemplateGuid>{1bc93793-694f-48fe-9372-81e2b05556fd}</TemplateGuid>",
          "24:     <TargetFrameworkVersion>v4.5</TargetFrameworkVersion>",
          "25:     <MinimumVisualStudioVersion>11.0</MinimumVisualStudioVersion>",
          "26:     <Configuration>Win8.1 Debug</Configuration>",
          "27:     <Platform Condition=\"'$(Platform)' == ''\">Win32</Platform>",
          "28:     <RootNamespace>test_winkernel</RootNamespace>",
          "29:     <ProjectName>test_winkernel</ProjectName>",
          "30:   </PropertyGroup>",
          "31:   <Import Project=\"$(VCTargetsPath)\\Microsoft.Cpp.Default.props\" />",
          "32:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|Win32'\" Label=\"Configuration\">",
          "33:     <TargetVersion>Windows7</TargetVersion>",
          "34:     <UseDebugLibraries>true</UseDebugLibraries>",
          "35:     <PlatformToolset>WindowsKernelModeDriver8.1</PlatformToolset>",
          "36:     <ConfigurationType>Driver</ConfigurationType>",
          "37:     <DriverType>KMDF</DriverType>",
          "38:   </PropertyGroup>",
          "39:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|Win32'\" Label=\"Configuration\">",
          "40:     <TargetVersion>Windows7</TargetVersion>",
          "41:     <UseDebugLibraries>false</UseDebugLibraries>",
          "42:     <PlatformToolset>WindowsKernelModeDriver8.1</PlatformToolset>",
          "43:     <ConfigurationType>Driver</ConfigurationType>",
          "44:     <DriverType>KMDF</DriverType>",
          "45:   </PropertyGroup>",
          "46:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|x64'\" Label=\"Configuration\">",
          "47:     <TargetVersion>Windows7</TargetVersion>",
          "48:     <UseDebugLibraries>true</UseDebugLibraries>",
          "49:     <PlatformToolset>WindowsKernelModeDriver8.1</PlatformToolset>",
          "50:     <ConfigurationType>Driver</ConfigurationType>",
          "51:     <DriverType>KMDF</DriverType>",
          "52:   </PropertyGroup>",
          "53:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|x64'\" Label=\"Configuration\">",
          "54:     <TargetVersion>Windows7</TargetVersion>",
          "55:     <UseDebugLibraries>false</UseDebugLibraries>",
          "56:     <PlatformToolset>WindowsKernelModeDriver8.1</PlatformToolset>",
          "57:     <ConfigurationType>Driver</ConfigurationType>",
          "58:     <DriverType>KMDF</DriverType>",
          "59:   </PropertyGroup>",
          "60:   <Import Project=\"$(VCTargetsPath)\\Microsoft.Cpp.props\" />",
          "61:   <ImportGroup Label=\"ExtensionSettings\">",
          "62:   </ImportGroup>",
          "63:   <ImportGroup Label=\"PropertySheets\">",
          "64:     <Import Project=\"$(UserRootDir)\\Microsoft.Cpp.$(Platform).user.props\" Condition=\"exists('$(UserRootDir)\\Microsoft.Cpp.$(Platform).user.props')\" Label=\"LocalAppDataPlatform\" />",
          "65:   </ImportGroup>",
          "66:   <PropertyGroup Label=\"UserMacros\" />",
          "67:   <PropertyGroup />",
          "68:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|Win32'\">",
          "69:     <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>",
          "70:   </PropertyGroup>",
          "71:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|Win32'\">",
          "72:     <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>",
          "73:   </PropertyGroup>",
          "74:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|x64'\">",
          "75:     <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>",
          "76:   </PropertyGroup>",
          "77:   <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|x64'\">",
          "78:     <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>",
          "79:   </PropertyGroup>",
          "80:   <ItemDefinitionGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|Win32'\">",
          "81:     <ClCompile>",
          "82:       <WppScanConfigurationData Condition=\"'%(ClCompile. ScanConfigurationData)'  == ''\">trace.h</WppScanConfigurationData>",
          "83:       <WppKernelMode>true</WppKernelMode>",
          "84:       <AdditionalIncludeDirectories>..\\..\\include;..\\headers;$(IntDir);%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>",
          "85:     </ClCompile>",
          "86:     <Link>",
          "87:       <AdditionalDependencies>capstone_static_winkernel.lib;ntstrsafe.lib;%(AdditionalDependencies)</AdditionalDependencies>",
          "88:       <AdditionalLibraryDirectories>..\\Debug</AdditionalLibraryDirectories>",
          "89:     </Link>",
          "90:   </ItemDefinitionGroup>",
          "91:   <ItemDefinitionGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|Win32'\">",
          "92:     <ClCompile>",
          "93:       <WppScanConfigurationData Condition=\"'%(ClCompile. ScanConfigurationData)'  == ''\">trace.h</WppScanConfigurationData>",
          "94:       <WppKernelMode>true</WppKernelMode>",
          "95:       <AdditionalIncludeDirectories>..\\..\\include;..\\headers;$(IntDir);%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>",
          "96:     </ClCompile>",
          "97:     <Link>",
          "98:       <AdditionalDependencies>capstone_static_winkernel.lib;ntstrsafe.lib;%(AdditionalDependencies)</AdditionalDependencies>",
          "99:       <AdditionalLibraryDirectories>..\\Release</AdditionalLibraryDirectories>",
          "100:     </Link>",
          "101:   </ItemDefinitionGroup>",
          "102:   <ItemDefinitionGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|x64'\">",
          "103:     <ClCompile>",
          "104:       <WppScanConfigurationData Condition=\"'%(ClCompile. ScanConfigurationData)'  == ''\">trace.h</WppScanConfigurationData>",
          "105:       <WppKernelMode>true</WppKernelMode>",
          "106:       <AdditionalIncludeDirectories>..\\..\\include;..\\headers;$(IntDir);%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>",
          "107:     </ClCompile>",
          "108:     <Link>",
          "109:       <AdditionalDependencies>capstone_static_winkernel.lib;ntstrsafe.lib;%(AdditionalDependencies)</AdditionalDependencies>",
          "110:       <AdditionalLibraryDirectories>..\\x64\\Debug</AdditionalLibraryDirectories>",
          "111:     </Link>",
          "112:   </ItemDefinitionGroup>",
          "113:   <ItemDefinitionGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|x64'\">",
          "114:     <ClCompile>",
          "115:       <WppScanConfigurationData Condition=\"'%(ClCompile. ScanConfigurationData)'  == ''\">trace.h</WppScanConfigurationData>",
          "116:       <WppKernelMode>true</WppKernelMode>",
          "117:       <AdditionalIncludeDirectories>..\\..\\include;..\\headers;$(IntDir);%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>",
          "118:     </ClCompile>",
          "119:     <Link>",
          "120:       <AdditionalDependencies>capstone_static_winkernel.lib;ntstrsafe.lib;%(AdditionalDependencies)</AdditionalDependencies>",
          "121:       <AdditionalLibraryDirectories>..\\x64\\Release</AdditionalLibraryDirectories>",
          "122:     </Link>",
          "123:   </ItemDefinitionGroup>",
          "124:   <ItemGroup>",
          "125:     <FilesToPackage Include=\"$(TargetPath)\" />",
          "126:     <FilesToPackage Include=\"@(Inf->'%(CopyOutput)')\" Condition=\"'@(Inf)'!=''\" />",
          "127:   </ItemGroup>",
          "128:   <ItemGroup>",
          "129:     <ClCompile Include=\"..\\..\\tests\\test_winkernel.cpp\" />",
          "130:   </ItemGroup>",
          "131:   <Import Project=\"$(VCTargetsPath)\\Microsoft.Cpp.targets\" />",
          "132:   <ImportGroup Label=\"ExtensionTargets\">",
          "133:   </ImportGroup>",
          "134: </Project>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cc8cc60ce04c92c0d4c0fa28a4f424a5f3ce089b",
      "candidate_info": {
        "commit_hash": "cc8cc60ce04c92c0d4c0fa28a4f424a5f3ce089b",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/cc8cc60ce04c92c0d4c0fa28a4f424a5f3ce089b",
        "files": [
          "tests/test_basic.c"
        ],
        "message": "cleanup",
        "before_after_code_files": [
          "tests/test_basic.c||tests/test_basic.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tests/test_basic.c||tests/test_basic.c": [
          "File: tests/test_basic.c -> tests/test_basic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "334: {",
          "335:  test();",
          "357:  return 0;",
          "358: }",
          "",
          "[Removed Lines]",
          "337: #if 0",
          "338: #define offsetof(st, m) __builtin_offsetof(st, m)",
          "340:  cs_insn insn;",
          "341:  printf(\"size: %lu\\n\", sizeof(insn));",
          "342:  printf(\"@id: %lu\\n\", offsetof(cs_insn, id));",
          "343:  printf(\"@address: %lu\\n\", offsetof(cs_insn, address));",
          "344:  printf(\"@size: %lu\\n\", offsetof(cs_insn, size));",
          "345:  printf(\"@bytes: %lu\\n\", offsetof(cs_insn, bytes));",
          "346:  printf(\"@mnemonic: %lu\\n\", offsetof(cs_insn, mnemonic));",
          "347:  printf(\"@op_str: %lu\\n\", offsetof(cs_insn, op_str));",
          "348:  printf(\"@regs_read: %lu\\n\", offsetof(cs_insn, regs_read));",
          "349:  printf(\"@regs_read_count: %lu\\n\", offsetof(cs_insn, regs_read_count));",
          "350:  printf(\"@regs_write: %lu\\n\", offsetof(cs_insn, regs_write));",
          "351:  printf(\"@regs_write_count: %lu\\n\", offsetof(cs_insn, regs_write_count));",
          "352:  printf(\"@groups: %lu\\n\", offsetof(cs_insn, groups));",
          "353:  printf(\"@groups_count: %lu\\n\", offsetof(cs_insn, groups_count));",
          "354:  printf(\"@arch: %lu\\n\", offsetof(cs_insn, x86));",
          "355: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e18496fe5dd7c7f0bc5ad01bd7257ff96a072c5d",
      "candidate_info": {
        "commit_hash": "e18496fe5dd7c7f0bc5ad01bd7257ff96a072c5d",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/e18496fe5dd7c7f0bc5ad01bd7257ff96a072c5d",
        "files": [
          "cstool/cstool.c"
        ],
        "message": "cstool: cleanup",
        "before_after_code_files": [
          "cstool/cstool.c||cstool/cstool.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "cstool/cstool.c||cstool/cstool.c": [
          "File: cstool/cstool.c -> cstool/cstool.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "74: static void usage(char *prog)",
          "75: {",
          "76:  printf(\"Cstool v%s for Capstone Disassembler Engine (core v%u.%u)\\n\\n\", VERSION, CS_API_MAJOR, CS_API_MINOR);",
          "78:  printf(\"\\nThe following <arch+mode> options are supported:\\n\");",
          "80:  if (cs_support(CS_ARCH_X86)) {",
          "",
          "[Removed Lines]",
          "77:  printf(\"Syntax: %s [-d:print all detail information] <arch+mode> <assembly-hexstring> [start-address-in-hex-format]\\n\", prog);",
          "",
          "[Added Lines]",
          "77:  printf(\"Syntax: %s [-d] <arch+mode> <assembly-hexstring> [start-address-in-hex-format]\\n\", prog);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "45f81ff5b7a5c85310665fc941e1692335096602",
      "candidate_info": {
        "commit_hash": "45f81ff5b7a5c85310665fc941e1692335096602",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/45f81ff5b7a5c85310665fc941e1692335096602",
        "files": [
          "arch/X86/X86Mapping.c"
        ],
        "message": "x86: RET read/write stack register. this fixes issue #790",
        "before_after_code_files": [
          "arch/X86/X86Mapping.c||arch/X86/X86Mapping.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "arch/X86/X86Mapping.c||arch/X86/X86Mapping.c": [
          "File: arch/X86/X86Mapping.c -> arch/X86/X86Mapping.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2616:        break;",
          "2617:      }",
          "2618:      break;",
          "2619:    }",
          "2621:    memcpy(insn->detail->groups, insns[i].groups, sizeof(insns[i].groups));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2620:     case X86_INS_RET:",
          "2621:      switch(h->mode) {",
          "2622:       case CS_MODE_16:",
          "2623:        insn->detail->regs_write[0] = X86_REG_SP;",
          "2624:        insn->detail->regs_read[0] = X86_REG_SP;",
          "2625:        break;",
          "2626:       case CS_MODE_32:",
          "2627:        insn->detail->regs_write[0] = X86_REG_ESP;",
          "2628:        insn->detail->regs_read[0] = X86_REG_ESP;",
          "2629:        break;",
          "2630:       default: // 64-bit",
          "2631:        insn->detail->regs_write[0] = X86_REG_RSP;",
          "2632:        insn->detail->regs_read[0] = X86_REG_RSP;",
          "2633:        break;",
          "2634:      }",
          "2635:      insn->detail->regs_write_count = 1;",
          "2636:      insn->detail->regs_read_count = 1;",
          "2637:      break;",
          "",
          "---------------"
        ]
      }
    }
  ]
}