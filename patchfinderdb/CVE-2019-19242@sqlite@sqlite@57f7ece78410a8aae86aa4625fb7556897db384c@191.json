{
  "cve_id": "CVE-2019-19242",
  "cve_desc": "SQLite 3.30.1 mishandles pExpr->y.pTab, as demonstrated by the TK_COLUMN case in sqlite3ExprCodeTarget in expr.c.",
  "repo": "sqlite/sqlite",
  "patch_hash": "57f7ece78410a8aae86aa4625fb7556897db384c",
  "patch_info": {
    "commit_hash": "57f7ece78410a8aae86aa4625fb7556897db384c",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/57f7ece78410a8aae86aa4625fb7556897db384c",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/expr.c",
      "src/wherecode.c",
      "test/gencol1.test"
    ],
    "message": "Fix a problem that comes up when using generated columns that evaluate to a constant in an index and then making use of that index in a join.\n\nFossilOrigin-Name: 8b12e95fec7ce6e0de82a04ca3dfcf1a8e62e233b7382aa28a8a9be6e862b1af",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/expr.c||src/expr.c",
      "src/wherecode.c||src/wherecode.c",
      "test/gencol1.test||test/gencol1.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 2d53a30cc23e53033af8e8666457654db5dcc453ed6cd176ce1d0bff4f528159",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/expr.c||src/expr.c": [
      "File: src/expr.c -> src/expr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3607:         int iReg = sqlite3ExprCodeTarget(pParse, pExpr->pLeft,target);",
      "3609:         if( aff>SQLITE_AFF_BLOB ){",
      "3610:           static const char zAff[] = \"B\\000C\\000D\\000E\";",
      "3611:           assert( SQLITE_AFF_BLOB=='A' );",
      "",
      "[Removed Lines]",
      "3608:         int aff = sqlite3TableColumnAffinity(pExpr->y.pTab, pExpr->iColumn);",
      "",
      "[Added Lines]",
      "3608:         int aff;",
      "3609:         if( pExpr->y.pTab ){",
      "3610:           aff = sqlite3TableColumnAffinity(pExpr->y.pTab, pExpr->iColumn);",
      "3611:         }else{",
      "3612:           aff = pExpr->affExpr;",
      "3613:         }",
      "",
      "---------------"
    ],
    "src/wherecode.c||src/wherecode.c": [
      "File: src/wherecode.c -> src/wherecode.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1141:   if( pExpr->op==TK_COLUMN ){",
      "1142:     IdxExprTrans *pX = p->u.pIdxTrans;",
      "1143:     if( pExpr->iTable==pX->iTabCur && pExpr->iColumn==pX->iTabCol ){",
      "1144:       pExpr->iTable = pX->iIdxCur;",
      "1145:       pExpr->iColumn = pX->iIdxCol;",
      "1146:       pExpr->y.pTab = 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1144:       assert( pExpr->y.pTab!=0 );",
      "1145:       pExpr->affExpr = sqlite3TableColumnAffinity(pExpr->y.pTab,pExpr->iColumn);",
      "",
      "---------------"
    ],
    "test/gencol1.test||test/gencol1.test": [
      "File: test/gencol1.test -> test/gencol1.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "243:   UPDATE t0 SET c0 = NULL;",
      "244: } {1 {generated column loop on \"c2\"}}",
      "247: finish_test",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "246: # 2019-11-21 Problems in the new generated column logic",
      "247: # reported by Yongheng Chen and Rui Zhong",
      "248: do_execsql_test gencol1-9.10 {",
      "249:   DROP TABLE IF EXISTS t1;",
      "250:   DROP TABLE IF EXISTS t2;",
      "251:   CREATE TABLE t1(aa , bb AS (17) UNIQUE);",
      "252:   INSERT INTO t1 VALUES(17);",
      "253:   CREATE TABLE t2(cc);",
      "254:   INSERT INTO t2 VALUES(41);",
      "255:   SELECT * FROM t2 JOIN t1 WHERE t1.bb=t1.aa AND t1.bb=17;",
      "256: } {41 17 17}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e2754c1fba842a72fd783363e28193026dbf3bbf",
      "candidate_info": {
        "commit_hash": "e2754c1fba842a72fd783363e28193026dbf3bbf",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/e2754c1fba842a72fd783363e28193026dbf3bbf",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/shell.c.in"
        ],
        "message": "Enforce 80-character line discipline in the CLI.  Minor improvements to the CLI built-in help.\n\nFossilOrigin-Name: 9690013a00d73a8047b25149ded50d20c74b5c62c0725eec50ed8477688e58a0",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/shell.c.in||src/shell.c.in"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: d7434cae3edc321e2f1f8d340a0e656b1613b736f8400fb271a0e80f59401b9e",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/shell.c.in||src/shell.c.in": [
          "File: src/shell.c.in -> src/shell.c.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "1766:   for(pRow = eqp_next_row(p, iEqpId, 0); pRow; pRow = pNext){",
          "1767:     pNext = eqp_next_row(p, iEqpId, pRow);",
          "1768:     z = pRow->zText;",
          "1770:     if( n<(int)sizeof(p->sGraph.zPrefix)-7 ){",
          "1771:       memcpy(&p->sGraph.zPrefix[n], pNext ? \"|  \" : \"   \", 4);",
          "1772:       eqp_render_level(p, pRow->iEqpId);",
          "",
          "[Removed Lines]",
          "1769:     utf8_printf(p->out, \"%s%s%s\\n\", p->sGraph.zPrefix, pNext ? \"|--\" : \"`--\", z);",
          "",
          "[Added Lines]",
          "1769:     utf8_printf(p->out, \"%s%s%s\\n\", p->sGraph.zPrefix,",
          "1770:                 pNext ? \"|--\" : \"`--\", z);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2536:     raw_printf(pArg->out, \"Autoindex Inserts:                   %d\\n\", iCur);",
          "2537:     iCur = sqlite3_stmt_status(pArg->pStmt, SQLITE_STMTSTATUS_VM_STEP, bReset);",
          "2538:     raw_printf(pArg->out, \"Virtual Machine Steps:               %d\\n\", iCur);",
          "2540:     raw_printf(pArg->out, \"Reprepare operations:                %d\\n\", iCur);",
          "2541:     iCur = sqlite3_stmt_status(pArg->pStmt, SQLITE_STMTSTATUS_RUN, bReset);",
          "2542:     raw_printf(pArg->out, \"Number of times run:                 %d\\n\", iCur);",
          "",
          "[Removed Lines]",
          "2539:     iCur = sqlite3_stmt_status(pArg->pStmt, SQLITE_STMTSTATUS_REPREPARE, bReset);",
          "",
          "[Added Lines]",
          "2540:     iCur = sqlite3_stmt_status(pArg->pStmt, SQLITE_STMTSTATUS_REPREPARE,bReset);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3459:   \".archive ...             Manage SQL archives\",",
          "3460:   \"   Each command must have exactly one of the following options:\",",
          "3461:   \"     -c, --create               Create a new archive\",",
          "3464:   \"     -t, --list                 List contents of archive\",",
          "3465:   \"     -x, --extract              Extract files from archive\",",
          "3466:   \"   Optional arguments:\",",
          "3467:   \"     -v, --verbose              Print each filename as it is processed\",",
          "3471:   \"     -n, --dryrun               Show the SQL that would have occurred\",",
          "3472:   \"   Examples:\",",
          "3476:   \"   See also:\",",
          "3477:   \"      http://sqlite.org/cli.html#sqlar_archive_support\",",
          "3478: #endif",
          "",
          "[Removed Lines]",
          "3462:   \"     -u, --update               Add files or update files with changed mtime\",",
          "3463:   \"     -i, --insert               Like -u but always add even if mtime unchanged\",",
          "3468:   \"     -f FILE, --file FILE       Operate on archive FILE (default is current db)\",",
          "3469:   \"     -a FILE, --append FILE     Operate on FILE opened using the apndvfs VFS\",",
          "3470:   \"     -C DIR, --directory DIR    Change to directory DIR to read/extract files\",",
          "3473:   \"     .ar -cf archive.sar foo bar  # Create archive.sar from files foo and bar\",",
          "3474:   \"     .ar -tf archive.sar          # List members of archive.sar\",",
          "3475:   \"     .ar -xvf archive.sar         # Verbosely extract files from archive.sar\",",
          "",
          "[Added Lines]",
          "3463:   \"     -u, --update               Add or update files with changed mtime\",",
          "3464:   \"     -i, --insert               Like -u but always add even if unchanged\",",
          "3469:   \"     -f FILE, --file FILE       Use archive FILE (default is current db)\",",
          "3470:   \"     -a FILE, --append FILE     Open FILE using the apndvfs VFS\",",
          "3471:   \"     -C DIR, --directory DIR    Read/extract files from directory DIR\",",
          "3474:   \"     .ar -cf ARCHIVE foo bar  # Create ARCHIVE from files foo and bar\",",
          "3475:   \"     .ar -tf ARCHIVE          # List members of ARCHIVE\",",
          "3476:   \"     .ar -xvf ARCHIVE         # Verbosely extract files from ARCHIVE\",",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3481: #endif",
          "3482:   \".backup ?DB? FILE        Backup DB (default \\\"main\\\") to FILE\",",
          "3483:   \"       --append            Use the appendvfs\",",
          "3485:   \".bail on|off             Stop after hitting an error.  Default OFF\",",
          "3486:   \".binary on|off           Turn binary output on or off.  Default OFF\",",
          "3487:   \".cd DIRECTORY            Change the working directory to DIRECTORY\",",
          "",
          "[Removed Lines]",
          "3484:   \"       --async             Write to FILE without a journal and without fsync()\",",
          "",
          "[Added Lines]",
          "3485:   \"       --async             Write to FILE without journal and fsync()\",",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3501:   \"   Other Modes:\",",
          "3502: #ifdef SQLITE_DEBUG",
          "3503:   \"      test                  Show raw EXPLAIN QUERY PLAN output\",",
          "3505: #endif",
          "3506:   \"      trigger               Like \\\"full\\\" but also show trigger bytecode\",",
          "3508:   \".exit ?CODE?             Exit this program with return-code CODE\",",
          "3513:   \".filectrl CMD ...        Run various sqlite3_file_control() operations\",",
          "3514:   \"                           Run \\\".filectrl\\\" with no arguments for details\",",
          "3515:   \".fullschema ?--indent?   Show schema and the content of sqlite_stat tables\",",
          "",
          "[Removed Lines]",
          "3504:   \"      trace                 Like \\\"full\\\" but also enable \\\"PRAGMA vdbe_trace\\\"\",",
          "3507:   \".excel                   Display the output of next command in a spreadsheet\",",
          "3509:   \".expert                  EXPERIMENTAL. Suggest indexes for specified queries\",",
          "",
          "[Added Lines]",
          "3505:   \"      trace                 Like \\\"full\\\" but enable \\\"PRAGMA vdbe_trace\\\"\",",
          "3508:   \".excel                   Display the output of next command in spreadsheet\",",
          "3510:   \".expert                  EXPERIMENTAL. Suggest indexes for queries\",",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "3556:   \"        --append        Use appendvfs to append database to the end of FILE\",",
          "3557: #ifdef SQLITE_ENABLE_DESERIALIZE",
          "3558:   \"        --deserialize   Load into memory useing sqlite3_deserialize()\",",
          "3560:   \"        --maxsize N     Maximum size for --hexdb or --deserialized database\",",
          "3561: #endif",
          "3562:   \"        --new           Initialize FILE to an empty database\",",
          "",
          "[Removed Lines]",
          "3559:   \"        --hexdb         Load the output of \\\"dbtotxt\\\" as an in-memory database\",",
          "",
          "[Added Lines]",
          "3560:   \"        --hexdb         Load the output of \\\"dbtotxt\\\" as an in-memory db\",",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "3569:   \"   init                    Initialize the TEMP table that holds bindings\",",
          "3570:   \"   list                    List the current parameter bindings\",",
          "3571:   \"   set PARAMETER VALUE     Given SQL parameter PARAMETER a value of VALUE\",",
          "3573:   \"   unset PARAMETER         Remove PARAMETER from the binding table\",",
          "3574:   \".print STRING...         Print literal STRING\",",
          "3575: #ifndef SQLITE_OMIT_PROGRESS_CALLBACK",
          "",
          "[Removed Lines]",
          "3572:   \"                           PARAMETER should start with '$', ':', '@', or '?'\",",
          "",
          "[Added Lines]",
          "3573:   \"                           PARAMETER should start with one of: $ : @ ?\",",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "3584:   \".read FILE               Read input from FILE\",",
          "3585: #if !defined(SQLITE_OMIT_VIRTUALTABLE) && defined(SQLITE_ENABLE_DBPAGE_VTAB)",
          "3586:   \".recover                 Recover as much data as possible from corrupt db.\",",
          "3587: #endif",
          "3588:   \".restore ?DB? FILE       Restore content of DB (default \\\"main\\\") from FILE\",",
          "3589:   \".save FILE               Write in-memory database into FILE\",",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3588:   \"   --freelist-corrupt       Assume the freelist is corrupt\",",
          "3589:   \"   --recovery-db NAME       Store recovery metadata in database file NAME\",",
          "3590:   \"   --lost-and-found TABLE   Alternative name for the lost-and-found table\",",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "3615:   \"    Options:\",",
          "3616:   \"      --schema              Also hash the sqlite_master table\",",
          "3617:   \"      --sha3-224            Use the sha3-224 algorithm\",",
          "3619:   \"      --sha3-384            Use the sha3-384 algorithm\",",
          "3620:   \"      --sha3-512            Use the sha3-512 algorithm\",",
          "3621:   \"    Any other argument is a LIKE pattern for tables to hash\",",
          "",
          "[Removed Lines]",
          "3618:   \"      --sha3-256            Use the sha3-256 algorithm.  This is the default.\",",
          "",
          "[Added Lines]",
          "3622:   \"      --sha3-256            Use the sha3-256 algorithm (default)\",",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "5721:                 i = n;",
          "5722:               }else{",
          "5723:                 if( iArg>=(nArg-1) ){",
          "5725:                 }",
          "5726:                 zArg = azArg[++iArg];",
          "5727:               }",
          "",
          "[Removed Lines]",
          "5724:                   return arErrorMsg(pAr, \"option requires an argument: %c\",z[i]);",
          "",
          "[Added Lines]",
          "5728:                   return arErrorMsg(pAr, \"option requires an argument: %c\",",
          "5729:                                     z[i]);",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "6604:       zLostAndFound = azArg[i];",
          "6605:     }",
          "6606:     else{",
          "6612:       return 1;",
          "6613:     }",
          "6614:   }",
          "",
          "[Removed Lines]",
          "6607:       raw_printf(stderr, \"unexpected option: %s\\n\", azArg[i]);",
          "6608:       raw_printf(stderr, \"options are:\\n\");",
          "6609:       raw_printf(stderr, \"    --freelist-corrupt\\n\");",
          "6610:       raw_printf(stderr, \"    --recovery-db DATABASE\\n\");",
          "6611:       raw_printf(stderr, \"    --lost-and-found TABLE-NAME\\n\");",
          "",
          "[Added Lines]",
          "6612:       utf8_printf(stderr, \"unexpected option: %s\\n\", azArg[i]);",
          "6613:       showHelp(pState->out, azArg[0]);",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "8467:       if( zName ){",
          "8468:         appendText(&sSelect,",
          "8469:            \" UNION ALL SELECT shell_module_schema(name),\"",
          "8471:       }",
          "8472: #endif",
          "8473:       appendText(&sSelect, \") WHERE \", 0);",
          "",
          "[Removed Lines]",
          "8470:            \" 'table', name, name, name, 9e+99, 'main' FROM pragma_module_list\", 0);",
          "",
          "[Added Lines]",
          "8472:            \" 'table', name, name, name, 9e+99, 'main' FROM pragma_module_list\",",
          "8473:         0);",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "8566:       if( pSession->p==0 ) goto session_not_open;",
          "8567:       out = fopen(azCmd[1], \"wb\");",
          "8568:       if( out==0 ){",
          "8570:       }else{",
          "8571:         int szChng;",
          "8572:         void *pChng;",
          "",
          "[Removed Lines]",
          "8569:         utf8_printf(stderr, \"ERROR: cannot open \\\"%s\\\" for writing\\n\", azCmd[1]);",
          "",
          "[Added Lines]",
          "8572:         utf8_printf(stderr, \"ERROR: cannot open \\\"%s\\\" for writing\\n\",",
          "8573:                     azCmd[1]);",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "8887:         {",
          "8888:           utf8_printf(stderr, \"Unknown option \\\"%s\\\" on \\\"%s\\\"\\n\",",
          "8889:                       azArg[i], azArg[0]);",
          "8892:           rc = 1;",
          "8893:           goto meta_command_exit;",
          "8894:         }",
          "",
          "[Removed Lines]",
          "8890:           raw_printf(stderr, \"Should be one of: --schema\"",
          "8891:                              \" --sha3-224 --sha3-256 --sha3-384 --sha3-512\\n\");",
          "",
          "[Added Lines]",
          "8894:           showHelp(p->out, azArg[0]);",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "9168:     } aCtrl[] = {",
          "9181: #ifdef YYCOVERAGE",
          "9183: #endif",
          "9189:     };",
          "9190:     int testctrl = -1;",
          "9191:     int iCtrl = -1;",
          "",
          "[Removed Lines]",
          "9169:       { \"always\",             SQLITE_TESTCTRL_ALWAYS,        \"BOOLEAN\"            },",
          "9170:       { \"assert\",             SQLITE_TESTCTRL_ASSERT,        \"BOOLEAN\"            },",
          "9173:       { \"byteorder\",          SQLITE_TESTCTRL_BYTEORDER,     \"\"                   },",
          "9174:       { \"extra_schema_checks\",SQLITE_TESTCTRL_EXTRA_SCHEMA_CHECKS,\"BOOLEAN\"       },",
          "9176:       { \"imposter\",           SQLITE_TESTCTRL_IMPOSTER,   \"SCHEMA ON/OFF ROOTPAGE\"},",
          "9177:       { \"internal_functions\", SQLITE_TESTCTRL_INTERNAL_FUNCTIONS, \"BOOLEAN\"       },",
          "9178:       { \"localtime_fault\",    SQLITE_TESTCTRL_LOCALTIME_FAULT,\"BOOLEAN\"           },",
          "9179:       { \"never_corrupt\",      SQLITE_TESTCTRL_NEVER_CORRUPT, \"BOOLEAN\"            },",
          "9180:       { \"optimizations\",      SQLITE_TESTCTRL_OPTIMIZATIONS, \"DISABLE-MASK\"       },",
          "9182:       { \"parser_coverage\",    SQLITE_TESTCTRL_PARSER_COVERAGE, \"\"                 },",
          "9184:       { \"pending_byte\",       SQLITE_TESTCTRL_PENDING_BYTE,  \"OFFSET  \"           },",
          "9185:       { \"prng_restore\",       SQLITE_TESTCTRL_PRNG_RESTORE,  \"\"                   },",
          "9186:       { \"prng_save\",          SQLITE_TESTCTRL_PRNG_SAVE,     \"\"                   },",
          "9187:       { \"prng_seed\",          SQLITE_TESTCTRL_PRNG_SEED,     \"SEED ?db?\"          },",
          "9188:       { \"reserve\",            SQLITE_TESTCTRL_RESERVE,       \"BYTES-OF-RESERVE\"   },",
          "",
          "[Added Lines]",
          "9172:       { \"always\",             SQLITE_TESTCTRL_ALWAYS,        \"BOOLEAN\"        },",
          "9173:       { \"assert\",             SQLITE_TESTCTRL_ASSERT,        \"BOOLEAN\"        },",
          "9176:       { \"byteorder\",          SQLITE_TESTCTRL_BYTEORDER,     \"\"               },",
          "9177:       { \"extra_schema_checks\",SQLITE_TESTCTRL_EXTRA_SCHEMA_CHECKS,\"BOOLEAN\"   },",
          "9179:       { \"imposter\",         SQLITE_TESTCTRL_IMPOSTER, \"SCHEMA ON/OFF ROOTPAGE\"},",
          "9180:       { \"internal_functions\", SQLITE_TESTCTRL_INTERNAL_FUNCTIONS, \"BOOLEAN\"   },",
          "9181:       { \"localtime_fault\",    SQLITE_TESTCTRL_LOCALTIME_FAULT,\"BOOLEAN\"       },",
          "9182:       { \"never_corrupt\",      SQLITE_TESTCTRL_NEVER_CORRUPT, \"BOOLEAN\"        },",
          "9183:       { \"optimizations\",      SQLITE_TESTCTRL_OPTIMIZATIONS, \"DISABLE-MASK\"   },",
          "9185:       { \"parser_coverage\",    SQLITE_TESTCTRL_PARSER_COVERAGE, \"\"             },",
          "9187:       { \"pending_byte\",       SQLITE_TESTCTRL_PENDING_BYTE,  \"OFFSET  \"       },",
          "9188:       { \"prng_restore\",       SQLITE_TESTCTRL_PRNG_RESTORE,  \"\"               },",
          "9189:       { \"prng_save\",          SQLITE_TESTCTRL_PRNG_SAVE,     \"\"               },",
          "9190:       { \"prng_seed\",          SQLITE_TESTCTRL_PRNG_SEED,     \"SEED ?db?\"      },",
          "9191:       { \"reserve\",            SQLITE_TESTCTRL_RESERVE,      \"BYTES-OF-RESERVE\"},",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "9328:       }",
          "9329:     }",
          "9330:     if( isOk==0 && iCtrl>=0 ){",
          "9332:       rc = 1;",
          "9333:     }else if( isOk==1 ){",
          "9334:       raw_printf(p->out, \"%d\\n\", rc2);",
          "",
          "[Removed Lines]",
          "9331:       utf8_printf(p->out, \"Usage: .testctrl %s %s\\n\", zCmd, aCtrl[iCtrl].zUsage);",
          "",
          "[Added Lines]",
          "9334:       utf8_printf(p->out, \"Usage: .testctrl %s %s\\n\", zCmd,aCtrl[iCtrl].zUsage);",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "9445:         rc = 1;",
          "9446:         goto meta_command_exit;",
          "9447:       }",
          "9449:       if( rc ){",
          "9450:         utf8_printf(stderr, \"Authentication failed for user %s\\n\", azArg[2]);",
          "9451:         rc = 1;",
          "",
          "[Removed Lines]",
          "9448:       rc = sqlite3_user_authenticate(p->db, azArg[2], azArg[3], strlen30(azArg[3]));",
          "",
          "[Added Lines]",
          "9451:       rc = sqlite3_user_authenticate(p->db, azArg[2], azArg[3],",
          "9452:                                      strlen30(azArg[3]));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ab0992f022b4e9ee5f0ac79a2fb6b3556e8a9cb2",
      "candidate_info": {
        "commit_hash": "ab0992f022b4e9ee5f0ac79a2fb6b3556e8a9cb2",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/ab0992f022b4e9ee5f0ac79a2fb6b3556e8a9cb2",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/build.c",
          "src/insert.c"
        ],
        "message": "Fix incorrect arguments to testcase() macros.\n\nFossilOrigin-Name: 812467fbf04ce00228a8381a5eee471e4e35cc63184a4538129fcd70b7cec979",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/build.c||src/build.c",
          "src/insert.c||src/insert.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 3de57145a18c62ff9b556c7218d8b276000d0052e4890212fa9335235f22d03c",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/build.c||src/build.c": [
          "File: src/build.c -> src/build.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1407:           pCol->zName);",
          "1408: #ifndef SQLITE_OMIT_GENERATED_COLUMNS",
          "1409:     }else if( pCol->colFlags & COLFLAG_GENERATED ){",
          "1412:       sqlite3ErrorMsg(pParse, \"cannot use DEFAULT on a generated column\");",
          "1413: #endif",
          "1414:     }else{",
          "",
          "[Removed Lines]",
          "1410:       testcase( pCol->colflags & COLFLAG_VIRTUAL );",
          "1411:       testcase( pCol->colflags & COLFLAG_STORED );",
          "",
          "[Added Lines]",
          "1410:       testcase( pCol->colFlags & COLFLAG_VIRTUAL );",
          "1411:       testcase( pCol->colFlags & COLFLAG_STORED );",
          "",
          "---------------"
        ],
        "src/insert.c||src/insert.c": [
          "File: src/insert.c -> src/insert.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "223:   for(i=0; i<pTab->nCol; i++){",
          "224:     if( pTab->aCol[i].colFlags & COLFLAG_GENERATED ){",
          "227:       pTab->aCol[i].colFlags |= COLFLAG_NOTAVAIL;",
          "228:     }",
          "229:   }",
          "",
          "[Removed Lines]",
          "225:       testcase( pTab->aCol[i].colflags & COLFLAG_VIRTUAL );",
          "226:       testcase( pTab->aCol[i].colflags & COLFLAG_STORED );",
          "",
          "[Added Lines]",
          "225:       testcase( pTab->aCol[i].colFlags & COLFLAG_VIRTUAL );",
          "226:       testcase( pTab->aCol[i].colFlags & COLFLAG_STORED );",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2441:     if( (pDestCol->colFlags & COLFLAG_GENERATED)!=0 ){",
          "2442:       if( sqlite3ExprCompare(0, pSrcCol->pDflt, pDestCol->pDflt, -1)!=0 ){",
          "2446:       }",
          "2447:     }",
          "",
          "[Removed Lines]",
          "2443:         testcase( pDestCol->colflags & COLFLAG_VIRTUAL );",
          "2444:         testcase( pDestCol->colflags & COLFLAG_STORED );",
          "",
          "[Added Lines]",
          "2443:         testcase( pDestCol->colFlags & COLFLAG_VIRTUAL );",
          "2444:         testcase( pDestCol->colFlags & COLFLAG_STORED );",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1f169fefca50d458ad95eb8107f843927bae610f",
      "candidate_info": {
        "commit_hash": "1f169fefca50d458ad95eb8107f843927bae610f",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/1f169fefca50d458ad95eb8107f843927bae610f",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/vdbeapi.c"
        ],
        "message": "Fix a missing mutex in the sqlite3_normalized_sql() interface when it is called on a prepared statement that did not previously have a computed normalization of the input SQL.\n\nFossilOrigin-Name: 1a1a59c6c570879c8f318bbc132103c0285088ba233dd8c32e049b86419347b0",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/vdbeapi.c||src/vdbeapi.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 272dc74fd0304d6a28aaa8798d13e2f950c1a24d92d17519e3c32aef86714586",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/vdbeapi.c||src/vdbeapi.c": [
          "File: src/vdbeapi.c -> src/vdbeapi.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1714:   Vdbe *p = (Vdbe *)pStmt;",
          "1715:   if( p==0 ) return 0;",
          "1716:   if( p->zNormSql==0 && p->zSql!=0 ){",
          "1717:     p->zNormSql = sqlite3Normalize(p, p->zSql, sqlite3Strlen30(p->zSql));",
          "1718:   }",
          "1719:   return p->zNormSql;",
          "1720: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1717:     sqlite3_mutex_enter(p->db->mutex);",
          "1719:     sqlite3_mutex_leave(p->db->mutex);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c3017e7b4a1829f3e8bc4f26f5b05b31836120e0",
      "candidate_info": {
        "commit_hash": "c3017e7b4a1829f3e8bc4f26f5b05b31836120e0",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/c3017e7b4a1829f3e8bc4f26f5b05b31836120e0",
        "files": [
          "ext/misc/fossildelta.c",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Update comments on the fossildelta extension.  No changes to code.\n\nFossilOrigin-Name: 9da4fb59b28686630d63a79988b458726332cf06cc0e6e84d7c0a7600f5fcab0",
        "before_after_code_files": [
          "ext/misc/fossildelta.c||ext/misc/fossildelta.c",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/misc/fossildelta.c||ext/misc/fossildelta.c": [
          "File: ext/misc/fossildelta.c -> ext/misc/fossildelta.c"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 8474c1560e0c3a28c6a7ed360202a8e7caae3c8259f60bbfa6d2948ab7876f51",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "db561bcedaa38da1c4ac5097d6cab9e9567b1f1d",
      "candidate_info": {
        "commit_hash": "db561bcedaa38da1c4ac5097d6cab9e9567b1f1d",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/db561bcedaa38da1c4ac5097d6cab9e9567b1f1d",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/btree.c"
        ],
        "message": "Performance optimization in sqlite3BtreeCursor().\n\nFossilOrigin-Name: ea068b099c96b8b9526114732d2a6be186cf381b7329d102778ad25b95510c9e",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/btree.c||src/btree.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 8d964e1c21d4cea699023e02b0616a75c5859dd083c9365cdcbc0676ebbdaae4",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/btree.c||src/btree.c": [
          "File: src/btree.c -> src/btree.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4379:     allocateTempSpace(pBt);",
          "4380:     if( pBt->pTmpSpace==0 ) return SQLITE_NOMEM_BKPT;",
          "4381:   }",
          "4385:   }",
          "",
          "[Removed Lines]",
          "4382:   if( iTable==1 && btreePagecount(pBt)==0 ){",
          "4383:     assert( wrFlag==0 );",
          "4384:     iTable = 0;",
          "",
          "[Added Lines]",
          "4382:   if( iTable<=1 ){",
          "4383:     if( iTable<1 ){",
          "4384:       return SQLITE_CORRUPT_BKPT;",
          "4385:     }else if( btreePagecount(pBt)==0 ){",
          "4386:       assert( wrFlag==0 );",
          "4387:       iTable = 0;",
          "4388:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4406:   pCur->eState = CURSOR_INVALID;",
          "4407:   return SQLITE_OK;",
          "4408: }",
          "4409: int sqlite3BtreeCursor(",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4413: static int btreeCursorWithLock(",
          "4419: ){",
          "4420:   int rc;",
          "4421:   sqlite3BtreeEnter(p);",
          "4422:   rc = btreeCursor(p, iTable, wrFlag, pKeyInfo, pCur);",
          "4423:   sqlite3BtreeLeave(p);",
          "4424:   return rc;",
          "4425: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "4415: ){",
          "4419:   }else{",
          "4423:   }",
          "4425: }",
          "",
          "[Removed Lines]",
          "4416:   int rc;",
          "4417:   if( iTable<1 ){",
          "4418:     rc = SQLITE_CORRUPT_BKPT;",
          "4420:     sqlite3BtreeEnter(p);",
          "4421:     rc = btreeCursor(p, iTable, wrFlag, pKeyInfo, pCur);",
          "4422:     sqlite3BtreeLeave(p);",
          "4424:   return rc;",
          "",
          "[Added Lines]",
          "4433:   if( p->sharable ){",
          "4434:     return btreeCursorWithLock(p, iTable, wrFlag, pKeyInfo, pCur);",
          "4436:     return btreeCursor(p, iTable, wrFlag, pKeyInfo, pCur);",
          "",
          "---------------"
        ]
      }
    }
  ]
}