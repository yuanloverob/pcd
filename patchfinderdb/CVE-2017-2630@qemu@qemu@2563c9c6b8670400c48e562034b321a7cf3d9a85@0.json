{
  "cve_id": "CVE-2017-2630",
  "cve_desc": "A stack buffer overflow flaw was found in the Quick Emulator (QEMU) before 2.9 built with the Network Block Device (NBD) client support. The flaw could occur while processing server's response to a 'NBD_OPT_LIST' request. A malicious NBD server could use this issue to crash a remote NBD client resulting in DoS or potentially execute arbitrary code on client host with privileges of the QEMU process.",
  "repo": "qemu/qemu",
  "patch_hash": "2563c9c6b8670400c48e562034b321a7cf3d9a85",
  "patch_info": {
    "commit_hash": "2563c9c6b8670400c48e562034b321a7cf3d9a85",
    "repo": "qemu/qemu",
    "commit_url": "https://github.com/qemu/qemu/commit/2563c9c6b8670400c48e562034b321a7cf3d9a85",
    "files": [
      "nbd/client.c"
    ],
    "message": "nbd/client: fix drop_sync [CVE-2017-2630]\n\nComparison symbol is misused. It may lead to memory corruption.\nIntroduced in commit 7d3123e.\n\nSigned-off-by: Vladimir Sementsov-Ogievskiy <vsementsov@virtuozzo.com>\nMessage-Id: <20170203154757.36140-6-vsementsov@virtuozzo.com>\n[eblake: add CVE details, update conditional]\nSigned-off-by: Eric Blake <eblake@redhat.com>\nReviewed-by: Marc-Andr\u00c3\u00a9 Lureau <marcandre.lureau@redhat.com>\nMessage-Id: <20170307151627.27212-1-eblake@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
    "before_after_code_files": [
      "nbd/client.c||nbd/client.c"
    ]
  },
  "patch_diff": {
    "nbd/client.c||nbd/client.c": [
      "File: nbd/client.c -> nbd/client.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "94:     char small[1024];",
      "95:     char *buffer;",
      "98:     while (size > 0) {",
      "99:         ssize_t count = read_sync(ioc, buffer, MIN(65536, size));",
      "",
      "[Removed Lines]",
      "97:     buffer = sizeof(small) < size ? small : g_malloc(MIN(65536, size));",
      "",
      "[Added Lines]",
      "97:     buffer = sizeof(small) >= size ? small : g_malloc(MIN(65536, size));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8029d55a9362cbf6e210c9a33f62f5f30136ff50",
      "candidate_info": {
        "commit_hash": "8029d55a9362cbf6e210c9a33f62f5f30136ff50",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/8029d55a9362cbf6e210c9a33f62f5f30136ff50",
        "files": [
          "nbd/client.c"
        ],
        "message": "nbd/client: fix drop_sync [CVE-2017-2630]\n\nComparison symbol is misused. It may lead to memory corruption.\nIntroduced in commit 7d3123e.\n\nSigned-off-by: Vladimir Sementsov-Ogievskiy <vsementsov@virtuozzo.com>\nMessage-Id: <20170203154757.36140-6-vsementsov@virtuozzo.com>\n[eblake: add CVE details, update conditional]\nSigned-off-by: Eric Blake <eblake@redhat.com>\nReviewed-by: Marc-Andr\u00c3\u00a9 Lureau <marcandre.lureau@redhat.com>\nMessage-Id: <20170307151627.27212-1-eblake@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>\n\n(cherry picked from commit 2563c9c6b8670400c48e562034b321a7cf3d9a85)\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "nbd/client.c||nbd/client.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "nbd/client.c||nbd/client.c"
          ],
          "candidate": [
            "nbd/client.c||nbd/client.c"
          ]
        }
      },
      "candidate_diff": {
        "nbd/client.c||nbd/client.c": [
          "File: nbd/client.c -> nbd/client.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "94:     char small[1024];",
          "95:     char *buffer;",
          "98:     while (size > 0) {",
          "99:         ssize_t count = read_sync(ioc, buffer, MIN(65536, size));",
          "",
          "[Removed Lines]",
          "97:     buffer = sizeof(small) < size ? small : g_malloc(MIN(65536, size));",
          "",
          "[Added Lines]",
          "97:     buffer = sizeof(small) >= size ? small : g_malloc(MIN(65536, size));",
          "",
          "---------------"
        ]
      }
    }
  ]
}