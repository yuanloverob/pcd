{
  "cve_id": "CVE-2016-7124",
  "cve_desc": "ext/standard/var_unserializer.c in PHP before 5.6.25 and 7.x before 7.0.10 mishandles certain invalid objects, which allows remote attackers to cause a denial of service or possibly have unspecified other impact via crafted serialized data that leads to a (1) __destruct call or (2) magic method call.",
  "repo": "php/php-src",
  "patch_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
  "patch_info": {
    "commit_hash": "448c9be157f4147e121f1a2a524536c75c9c6059",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/448c9be157f4147e121f1a2a524536c75c9c6059",
    "files": [
      "ext/standard/tests/strings/bug72663.phpt",
      "ext/standard/tests/strings/bug72663_2.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #72663 - destroy broken object when unserializing",
    "before_after_code_files": [
      "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
      "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
      "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
      "3: --FILE--",
      "4: <?php",
      "5: class obj implements Serializable {",
      "6:     var $data;",
      "7:     function serialize() {",
      "8:         return serialize($this->data);",
      "9:     }",
      "10:     function unserialize($data) {",
      "11:         $this->data = unserialize($data);",
      "12:     }",
      "13: }",
      "15: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
      "16: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
      "18: $data = unserialize($exploit);",
      "19: echo $data[1];",
      "20: ?>",
      "21: DONE",
      "22: --EXPECTF--",
      "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
      "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
      "26: DONE",
      "",
      "---------------"
    ],
    "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt": [
      "File: ext/standard/tests/strings/bug72663_2.phpt -> ext/standard/tests/strings/bug72663_2.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
      "3: --FILE--",
      "4: <?php",
      "6: ini_set('session.serialize_handler', 'php_serialize');",
      "7: session_start();",
      "8: $sess = 'O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:1;}';",
      "9: session_decode($sess);",
      "10: var_dump($_SESSION);",
      "11: ?>",
      "12: DONE",
      "13: --EXPECTF--",
      "14: Notice: session_decode(): Unexpected end of serialized data in %sbug72663_2.php on line %d",
      "15: array(0) {",
      "16: }",
      "17: DONE",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "434:  }",
      "436:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
      "437:   return 0;",
      "438:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "438:      zend_hash_clean(Z_OBJPROP_PP(rval));",
      "439:      ZVAL_NULL(*rval);",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "486: {",
      "487:  YYCTYPE yych;",
      "488:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "485: #line 486 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "488: #line 489 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "542:  yych = *(YYMARKER = ++YYCURSOR);",
      "543:  if (yych == ':') goto yy95;",
      "544: yy3:",
      "546:  { return 0; }",
      "548: yy4:",
      "549:  yych = *(YYMARKER = ++YYCURSOR);",
      "550:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "545: #line 851 \"ext/standard/var_unserializer.re\"",
      "547: #line 548 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "548: #line 854 \"ext/standard/var_unserializer.re\"",
      "550: #line 551 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "587:  goto yy3;",
      "588: yy14:",
      "589:  ++YYCURSOR;",
      "591:  {",
      "593:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "595: }",
      "597: yy16:",
      "598:  yych = *++YYCURSOR;",
      "599:  goto yy3;",
      "",
      "[Removed Lines]",
      "590: #line 845 \"ext/standard/var_unserializer.re\"",
      "596: #line 597 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "593: #line 848 \"ext/standard/var_unserializer.re\"",
      "599: #line 600 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "619:  if (yybm[0+yych] & 128) {",
      "620:   goto yy20;",
      "621:  }",
      "623:  yych = *++YYCURSOR;",
      "624:  if (yych != '\"') goto yy18;",
      "625:  ++YYCURSOR;",
      "627:  {",
      "628:  size_t len, len2, len3, maxlen;",
      "629:  long elements;",
      "",
      "[Removed Lines]",
      "622:  if (yych != ':') goto yy18;",
      "626: #line 698 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "625:  if (yych <= '/') goto yy18;",
      "626:  if (yych >= ';') goto yy18;",
      "630: #line 701 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "771:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "772: }",
      "774: yy25:",
      "775:  yych = *++YYCURSOR;",
      "776:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "773: #line 774 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "777: #line 778 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "795:  yych = *++YYCURSOR;",
      "796:  if (yych != '\"') goto yy18;",
      "797:  ++YYCURSOR;",
      "799:  {",
      "800:     if (!var_hash) return 0;",
      "",
      "[Removed Lines]",
      "798: #line 689 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "802: #line 692 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "804:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "805:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "806: }",
      "808: yy32:",
      "809:  yych = *++YYCURSOR;",
      "810:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "807: #line 808 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "811: #line 812 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "825:  yych = *++YYCURSOR;",
      "826:  if (yych != '{') goto yy18;",
      "827:  ++YYCURSOR;",
      "829:  {",
      "830:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "828: #line 668 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "832: #line 671 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "847:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "848: }",
      "850: yy39:",
      "851:  yych = *++YYCURSOR;",
      "852:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "849: #line 850 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "853: #line 854 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "867:  yych = *++YYCURSOR;",
      "868:  if (yych != '\"') goto yy18;",
      "869:  ++YYCURSOR;",
      "871:  {",
      "872:  size_t len, maxlen;",
      "873:  char *str;",
      "",
      "[Removed Lines]",
      "870: #line 633 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "874: #line 636 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "902:  ZVAL_STRINGL(*rval, str, len, 0);",
      "903:  return 1;",
      "904: }",
      "906: yy46:",
      "907:  yych = *++YYCURSOR;",
      "908:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "905: #line 906 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "909: #line 910 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "923:  yych = *++YYCURSOR;",
      "924:  if (yych != '\"') goto yy18;",
      "925:  ++YYCURSOR;",
      "927:  {",
      "928:  size_t len, maxlen;",
      "929:  char *str;",
      "",
      "[Removed Lines]",
      "926: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "930: #line 603 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "956:  ZVAL_STRINGL(*rval, str, len, 1);",
      "957:  return 1;",
      "958: }",
      "960: yy53:",
      "961:  yych = *++YYCURSOR;",
      "962:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "959: #line 960 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "963: #line 964 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "1044:  }",
      "1045: yy63:",
      "1046:  ++YYCURSOR;",
      "1048:  {",
      "1049: #if SIZEOF_LONG == 4",
      "1050: use_double:",
      "",
      "[Removed Lines]",
      "1047: #line 590 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1051: #line 593 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1054:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1055:  return 1;",
      "1056: }",
      "1058: yy65:",
      "1059:  yych = *++YYCURSOR;",
      "1060:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1057: #line 1058 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1113:  yych = *++YYCURSOR;",
      "1114:  if (yych != ';') goto yy18;",
      "1115:  ++YYCURSOR;",
      "1117:  {",
      "1119:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1116: #line 575 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1120: #line 578 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1129:  return 1;",
      "1130: }",
      "1132: yy76:",
      "1133:  yych = *++YYCURSOR;",
      "1134:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1131: #line 1132 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1135: #line 1136 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1155:  if (yych <= '9') goto yy79;",
      "1156:  if (yych != ';') goto yy18;",
      "1157:  ++YYCURSOR;",
      "1159:  {",
      "1160: #if SIZEOF_LONG == 4",
      "1161:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1158: #line 548 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1162: #line 551 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1182:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1183:  return 1;",
      "1184: }",
      "1186: yy83:",
      "1187:  yych = *++YYCURSOR;",
      "1188:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1185: #line 1186 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1189: #line 1190 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1190:  yych = *++YYCURSOR;",
      "1191:  if (yych != ';') goto yy18;",
      "1192:  ++YYCURSOR;",
      "1194:  {",
      "1196:  INIT_PZVAL(*rval);",
      "1197:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1198:  return 1;",
      "1199: }",
      "1201: yy87:",
      "1202:  ++YYCURSOR;",
      "1204:  {",
      "1206:  INIT_PZVAL(*rval);",
      "1207:  ZVAL_NULL(*rval);",
      "1208:  return 1;",
      "1209: }",
      "1211: yy89:",
      "1212:  yych = *++YYCURSOR;",
      "1213:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1193: #line 541 \"ext/standard/var_unserializer.re\"",
      "1200: #line 1201 \"ext/standard/var_unserializer.c\"",
      "1203: #line 534 \"ext/standard/var_unserializer.re\"",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1197: #line 544 \"ext/standard/var_unserializer.re\"",
      "1204: #line 1205 \"ext/standard/var_unserializer.c\"",
      "1207: #line 537 \"ext/standard/var_unserializer.re\"",
      "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1230:  if (yych <= '9') goto yy91;",
      "1231:  if (yych != ';') goto yy18;",
      "1232:  ++YYCURSOR;",
      "1234:  {",
      "1235:  long id;",
      "",
      "[Removed Lines]",
      "1233: #line 511 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1237: #line 514 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1254:  return 1;",
      "1255: }",
      "1257: yy95:",
      "1258:  yych = *++YYCURSOR;",
      "1259:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1256: #line 1257 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1260: #line 1261 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1276:  if (yych <= '9') goto yy97;",
      "1277:  if (yych != ';') goto yy18;",
      "1278:  ++YYCURSOR;",
      "1280:  {",
      "1281:  long id;",
      "",
      "[Removed Lines]",
      "1279: #line 490 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1283: #line 493 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1298:  return 1;",
      "1299: }",
      "1301: }",
      "1305:  return 0;",
      "",
      "[Removed Lines]",
      "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
      "1302: #line 853 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1304: #line 1305 \"ext/standard/var_unserializer.c\"",
      "1306: #line 856 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "438:  }",
      "440:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
      "441:   return 0;",
      "442:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "442:      zend_hash_clean(Z_OBJPROP_PP(rval));",
      "443:      ZVAL_NULL(*rval);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f32e3d54e42923b6b750458771d3862832906094",
      "candidate_info": {
        "commit_hash": "f32e3d54e42923b6b750458771d3862832906094",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/f32e3d54e42923b6b750458771d3862832906094",
        "files": [
          "ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #74101 and bug #74614\n\n(cherry picked from commit d02f953faf4afdd1576acb1380e4cd3c050ac599)",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt": [
          "File: ext/standard/tests/serialize/bug74101.phpt -> ext/standard/tests/serialize/bug74101.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74101: Unserialize Heap Use-After-Free (READ: 1) in zval_get_type",
          "3: --FILE--",
          "4: <?php",
          "5: $s = 'O:9:\"Exception\":799999999999999999999999999997:0i:0;a:0:{}i:2;i:0;i:0;R:2;';",
          "6: var_dump(unserialize($s));",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Notice: unserialize(): Error at offset 48 of 74 bytes in %s on line %d",
          "10: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt": [
          "File: ext/standard/tests/serialize/bug74614.phpt -> ext/standard/tests/serialize/bug74614.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74614: Use-after-free in PHP7's unserialize()",
          "3: --FILE--",
          "4: <?php",
          "6: unserialize('a:3020000000000000000000000000000001:{i:0;a:0:{}i:1;i:2;i:2;i:3;i:3;i:4;i:4;i:5;i:5;i:6;i:6;i:7;i:7;i:8;i:8;R:2;}');",
          "8: ?>",
          "9: --EXPECTF--",
          "10: Notice: unserialize(): Error at offset 38 of 113 bytes in %s on line %d",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "503:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "505:  ht = Z_OBJPROP_P(rval);",
          "506:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "507:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "508:   if (has_wakeup) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "506:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "507:   return 0;",
          "508:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "578:  start = cursor;",
          "582: {",
          "583:  YYCTYPE yych;",
          "584:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "581: #line 582 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "585: #line 586 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "636: yy2:",
          "637:  ++YYCURSOR;",
          "638: yy3:",
          "640:  { return 0; }",
          "642: yy4:",
          "643:  yych = *(YYMARKER = ++YYCURSOR);",
          "644:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "639: #line 959 \"ext/standard/var_unserializer.re\"",
          "641: #line 642 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "643: #line 963 \"ext/standard/var_unserializer.re\"",
          "645: #line 646 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "685:  goto yy3;",
          "686: yy15:",
          "687:  ++YYCURSOR;",
          "689:  {",
          "691:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "693: }",
          "695: yy17:",
          "696:  yych = *++YYCURSOR;",
          "697:  if (yybm[0+yych] & 128) {",
          "",
          "[Removed Lines]",
          "688: #line 953 \"ext/standard/var_unserializer.re\"",
          "694: #line 695 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "692: #line 957 \"ext/standard/var_unserializer.re\"",
          "698: #line 699 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "703:  goto yy3;",
          "704: yy19:",
          "705:  ++YYCURSOR;",
          "707:  {",
          "709:  ZVAL_NULL(rval);",
          "710:  return 1;",
          "711: }",
          "713: yy21:",
          "714:  yych = *++YYCURSOR;",
          "715:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "706: #line 637 \"ext/standard/var_unserializer.re\"",
          "712: #line 713 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "710: #line 641 \"ext/standard/var_unserializer.re\"",
          "716: #line 717 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "959:  goto yy18;",
          "960: yy63:",
          "961:  ++YYCURSOR;",
          "963:  {",
          "964:  zend_long id;",
          "",
          "[Removed Lines]",
          "962: #line 586 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "966: #line 590 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "986:  return 1;",
          "987: }",
          "989: yy65:",
          "990:  yych = *++YYCURSOR;",
          "991:  if (yych == '\"') goto yy84;",
          "",
          "[Removed Lines]",
          "988: #line 989 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "992: #line 993 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "996:  goto yy18;",
          "997: yy67:",
          "998:  ++YYCURSOR;",
          "1000:  {",
          "1002:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1003:  return 1;",
          "1004: }",
          "1006: yy69:",
          "1007:  ++YYCURSOR;",
          "1008:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "",
          "[Removed Lines]",
          "999: #line 643 \"ext/standard/var_unserializer.re\"",
          "1005: #line 1006 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1003: #line 647 \"ext/standard/var_unserializer.re\"",
          "1009: #line 1010 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1022:  }",
          "1023: yy71:",
          "1024:  ++YYCURSOR;",
          "1026:  {",
          "1027: #if SIZEOF_ZEND_LONG == 4",
          "1028: use_double:",
          "",
          "[Removed Lines]",
          "1025: #line 691 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1029: #line 695 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1031:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1032:  return 1;",
          "1033: }",
          "1035: yy73:",
          "1036:  yych = *++YYCURSOR;",
          "1037:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1034: #line 1035 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1038: #line 1039 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1053:  goto yy18;",
          "1054: yy76:",
          "1055:  ++YYCURSOR;",
          "1057:  {",
          "1058: #if SIZEOF_ZEND_LONG == 4",
          "1059:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1056: #line 649 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1060: #line 653 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1079:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1080:  return 1;",
          "1081: }",
          "1083: yy78:",
          "1084:  yych = *++YYCURSOR;",
          "1085:  if (yych == '\"') goto yy92;",
          "1086:  goto yy18;",
          "1087: yy79:",
          "1088:  ++YYCURSOR;",
          "1090:  {",
          "1091:  zend_long id;",
          "",
          "[Removed Lines]",
          "1082: #line 1083 \"ext/standard/var_unserializer.c\"",
          "1089: #line 612 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "1093: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1112:  return 1;",
          "1113: }",
          "1115: yy81:",
          "1116:  yych = *++YYCURSOR;",
          "1117:  if (yych == '\"') goto yy94;",
          "1118:  goto yy18;",
          "1119: yy82:",
          "1120:  ++YYCURSOR;",
          "1122:  {",
          "1123:  size_t len, len2, len3, maxlen;",
          "1124:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1114: #line 1115 \"ext/standard/var_unserializer.c\"",
          "1121: #line 801 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1118: #line 1119 \"ext/standard/var_unserializer.c\"",
          "1125: #line 805 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1271:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1272: }",
          "1274: yy84:",
          "1275:  ++YYCURSOR;",
          "1277:  {",
          "1278:  size_t len, maxlen;",
          "1279:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1273: #line 1274 \"ext/standard/var_unserializer.c\"",
          "1276: #line 732 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "1280: #line 736 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1307:  ZVAL_STR(rval, str);",
          "1308:  return 1;",
          "1309: }",
          "1311: yy86:",
          "1312:  ++YYCURSOR;",
          "1314:  {",
          "1315:  zend_long elements = parse_iv(start + 2);",
          "1318:     if (!var_hash) return 0;",
          "1321:   return 0;",
          "1322:  }",
          "",
          "[Removed Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1313: #line 766 \"ext/standard/var_unserializer.re\"",
          "1320:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "1314: #line 1315 \"ext/standard/var_unserializer.c\"",
          "1317: #line 770 \"ext/standard/var_unserializer.re\"",
          "1324:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1335:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1336: }",
          "1338: yy88:",
          "1339:  yych = *++YYCURSOR;",
          "1340:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1337: #line 1338 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1341: #line 1342 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1359:  goto yy18;",
          "1360: yy92:",
          "1361:  ++YYCURSOR;",
          "1363:  {",
          "1364:  long elements;",
          "1365:     if (!var_hash) return 0;",
          "1367:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "1369:   return 0;",
          "1370:  }",
          "1371:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1372: }",
          "1374: yy94:",
          "1375:  ++YYCURSOR;",
          "1377:  {",
          "1378:  size_t len, maxlen;",
          "1379:  char *str;",
          "",
          "[Removed Lines]",
          "1362: #line 790 \"ext/standard/var_unserializer.re\"",
          "1368:  if (elements < 0) {",
          "1373: #line 1374 \"ext/standard/var_unserializer.c\"",
          "1376: #line 700 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1366: #line 794 \"ext/standard/var_unserializer.re\"",
          "1372:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "1377: #line 1378 \"ext/standard/var_unserializer.c\"",
          "1380: #line 704 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1405:  ZVAL_STRINGL(rval, str, len);",
          "1406:  return 1;",
          "1407: }",
          "1409: yy96:",
          "1410:  yych = *++YYCURSOR;",
          "1411:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1408: #line 1409 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1412: #line 1413 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1413:  goto yy18;",
          "1414: yy97:",
          "1415:  ++YYCURSOR;",
          "1417:  {",
          "",
          "[Removed Lines]",
          "1416: #line 675 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1420: #line 679 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1430:  return 1;",
          "1431: }",
          "1433: }",
          "1437:  return 0;",
          "",
          "[Removed Lines]",
          "1432: #line 1433 \"ext/standard/var_unserializer.c\"",
          "1434: #line 961 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1436: #line 1437 \"ext/standard/var_unserializer.c\"",
          "1438: #line 965 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "507:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "509:  ht = Z_OBJPROP_P(rval);",
          "510:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "511:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "512:   if (has_wakeup) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "510:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "511:   return 0;",
          "512:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "770:     if (!var_hash) return 0;",
          "773:   return 0;",
          "774:  }",
          "",
          "[Removed Lines]",
          "772:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "776:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "792:     if (!var_hash) return 0;",
          "794:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "796:   return 0;",
          "797:  }",
          "798:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "",
          "[Removed Lines]",
          "795:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "799:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8522e2894edd52322148945261433e79a3ec3f88",
      "candidate_info": {
        "commit_hash": "8522e2894edd52322148945261433e79a3ec3f88",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/8522e2894edd52322148945261433e79a3ec3f88",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Make sure lengths and refs are unsigned in unserialize()",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "361:  unsigned char cursor;",
          "362:  size_t result = 0;",
          "368:  while (1) {",
          "369:   cursor = *p;",
          "370:   if (cursor >= '0' && cursor <= '9') {",
          "",
          "[Removed Lines]",
          "364:  if (*p == '+') {",
          "365:   p++;",
          "366:  }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "618:  start = cursor;",
          "622: {",
          "623:  YYCTYPE yych;",
          "624:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "621: #line 622 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "617: #line 618 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "676: yy2:",
          "677:  ++YYCURSOR;",
          "678: yy3:",
          "680:  { return 0; }",
          "682: yy4:",
          "683:  yych = *(YYMARKER = ++YYCURSOR);",
          "684:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "679: #line 1005 \"ext/standard/var_unserializer.re\"",
          "681: #line 682 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "675: #line 1001 \"ext/standard/var_unserializer.re\"",
          "677: #line 678 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "725:  goto yy3;",
          "726: yy15:",
          "727:  ++YYCURSOR;",
          "729:  {",
          "731:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "733: }",
          "735: yy17:",
          "736:  yych = *++YYCURSOR;",
          "737:  if (yybm[0+yych] & 128) {",
          "739:  }",
          "741: yy18:",
          "742:  YYCURSOR = YYMARKER;",
          "743:  goto yy3;",
          "744: yy19:",
          "745:  ++YYCURSOR;",
          "747:  {",
          "749:  ZVAL_NULL(rval);",
          "750:  return 1;",
          "751: }",
          "753: yy21:",
          "754:  yych = *++YYCURSOR;",
          "764: yy22:",
          "765:  yych = *++YYCURSOR;",
          "767:  if (yych <= '/') goto yy18;",
          "769:  goto yy18;",
          "770: yy23:",
          "771:  yych = *++YYCURSOR;",
          "773:  if (yych <= '/') goto yy18;",
          "775:  goto yy18;",
          "776: yy24:",
          "777:  yych = *++YYCURSOR;",
          "778:  if (yych <= '/') goto yy18;",
          "780:  goto yy18;",
          "781: yy25:",
          "782:  yych = *++YYCURSOR;",
          "783:  if (yych <= '/') {",
          "784:   if (yych <= ',') {",
          "786:    goto yy18;",
          "787:   } else {",
          "790:    goto yy18;",
          "791:   }",
          "792:  } else {",
          "793:   if (yych <= 'I') {",
          "795:    if (yych <= 'H') goto yy18;",
          "797:   } else {",
          "799:    goto yy18;",
          "800:   }",
          "801:  }",
          "802: yy26:",
          "803:  yych = *++YYCURSOR;",
          "804:  if (yych <= ',') {",
          "806:   goto yy18;",
          "807:  } else {",
          "809:   if (yych <= '/') goto yy18;",
          "811:   goto yy18;",
          "812:  }",
          "813: yy27:",
          "814:  yych = *++YYCURSOR;",
          "824: yy28:",
          "825:  yych = *++YYCURSOR;",
          "835: yy29:",
          "836:  yych = *++YYCURSOR;",
          "838:  if (yych <= '/') goto yy18;",
          "840:  goto yy18;",
          "841: yy30:",
          "848:  ++YYCURSOR;",
          "849:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "850:  yych = *YYCURSOR;",
          "851:  if (yybm[0+yych] & 128) {",
          "853:  }",
          "854:  if (yych <= '/') goto yy18;",
          "856:  goto yy18;",
          "862:  ++YYCURSOR;",
          "863:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "864:  yych = *YYCURSOR;",
          "865:  if (yych <= '/') goto yy18;",
          "868:  goto yy18;",
          "874:  ++YYCURSOR;",
          "875:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "876:  yych = *YYCURSOR;",
          "877:  if (yych <= '/') goto yy18;",
          "880:  goto yy18;",
          "886:  ++YYCURSOR;",
          "887:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "888:  yych = *YYCURSOR;",
          "889:  if (yych <= '/') goto yy18;",
          "892:  goto yy18;",
          "894:  yych = *++YYCURSOR;",
          "896:  goto yy18;",
          "898:  yych = *++YYCURSOR;",
          "900:  if (yych <= '/') goto yy18;",
          "902:  goto yy18;",
          "904:  yych = *++YYCURSOR;",
          "905:  if (yych <= '/') {",
          "906:   if (yych != '.') goto yy18;",
          "907:  } else {",
          "910:   goto yy18;",
          "911:  }",
          "913:  yych = *++YYCURSOR;",
          "914:  if (yych <= '/') goto yy18;",
          "916:  goto yy18;",
          "918:  ++YYCURSOR;",
          "919:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "920:  yych = *YYCURSOR;",
          "921:  if (yych <= ':') {",
          "922:   if (yych <= '.') {",
          "923:    if (yych <= '-') goto yy18;",
          "925:   } else {",
          "926:    if (yych <= '/') goto yy18;",
          "928:    goto yy18;",
          "929:   }",
          "930:  } else {",
          "931:   if (yych <= 'E') {",
          "933:    if (yych <= 'D') goto yy18;",
          "935:   } else {",
          "937:    goto yy18;",
          "938:   }",
          "939:  }",
          "941:  yych = *++YYCURSOR;",
          "943:  goto yy18;",
          "945:  yych = *++YYCURSOR;",
          "947:  goto yy18;",
          "949:  yych = *++YYCURSOR;",
          "950:  if (yych <= '/') goto yy18;",
          "951:  if (yych >= ':') goto yy18;",
          "953:  ++YYCURSOR;",
          "954:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "955:  yych = *YYCURSOR;",
          "956:  if (yych <= '/') goto yy18;",
          "959:  goto yy18;",
          "965:  ++YYCURSOR;",
          "966:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "967:  yych = *YYCURSOR;",
          "968:  if (yych <= '/') goto yy18;",
          "971:  goto yy18;",
          "977:  ++YYCURSOR;",
          "978:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "979:  yych = *YYCURSOR;",
          "980:  if (yych <= '/') goto yy18;",
          "983:  goto yy18;",
          "989:  ++YYCURSOR;",
          "990:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "991:  yych = *YYCURSOR;",
          "992:  if (yych <= '/') goto yy18;",
          "995:  goto yy18;",
          "997:  yych = *++YYCURSOR;",
          "999:  goto yy18;",
          "1001:  ++YYCURSOR;",
          "1003:  {",
          "1004:  zend_long id;",
          "1007:  if (!var_hash) return 0;",
          "1010:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1011:   return 0;",
          "1012:  }",
          "",
          "[Removed Lines]",
          "728: #line 999 \"ext/standard/var_unserializer.re\"",
          "734: #line 735 \"ext/standard/var_unserializer.c\"",
          "738:   goto yy31;",
          "740:  if (yych == '+') goto yy30;",
          "746: #line 677 \"ext/standard/var_unserializer.re\"",
          "752: #line 753 \"ext/standard/var_unserializer.c\"",
          "755:  if (yych <= ',') {",
          "756:   if (yych == '+') goto yy33;",
          "757:   goto yy18;",
          "758:  } else {",
          "759:   if (yych <= '-') goto yy33;",
          "760:   if (yych <= '/') goto yy18;",
          "761:   if (yych <= '9') goto yy34;",
          "762:   goto yy18;",
          "763:  }",
          "766:  if (yych == '+') goto yy36;",
          "768:  if (yych <= '9') goto yy37;",
          "772:  if (yych == '+') goto yy39;",
          "774:  if (yych <= '9') goto yy40;",
          "779:  if (yych <= '1') goto yy42;",
          "785:    if (yych == '+') goto yy43;",
          "788:    if (yych <= '-') goto yy44;",
          "789:    if (yych <= '.') goto yy45;",
          "794:    if (yych <= '9') goto yy46;",
          "796:    goto yy48;",
          "798:    if (yych == 'N') goto yy49;",
          "805:   if (yych == '+') goto yy50;",
          "808:   if (yych <= '-') goto yy50;",
          "810:   if (yych <= '9') goto yy51;",
          "815:  if (yych <= ',') {",
          "816:   if (yych == '+') goto yy53;",
          "817:   goto yy18;",
          "818:  } else {",
          "819:   if (yych <= '-') goto yy53;",
          "820:   if (yych <= '/') goto yy18;",
          "821:   if (yych <= '9') goto yy54;",
          "822:   goto yy18;",
          "823:  }",
          "826:  if (yych <= ',') {",
          "827:   if (yych == '+') goto yy56;",
          "828:   goto yy18;",
          "829:  } else {",
          "830:   if (yych <= '-') goto yy56;",
          "831:   if (yych <= '/') goto yy18;",
          "832:   if (yych <= '9') goto yy57;",
          "833:   goto yy18;",
          "834:  }",
          "837:  if (yych == '+') goto yy59;",
          "839:  if (yych <= '9') goto yy60;",
          "842:  yych = *++YYCURSOR;",
          "843:  if (yybm[0+yych] & 128) {",
          "844:   goto yy31;",
          "845:  }",
          "846:  goto yy18;",
          "847: yy31:",
          "852:   goto yy31;",
          "855:  if (yych <= ':') goto yy62;",
          "857: yy33:",
          "858:  yych = *++YYCURSOR;",
          "859:  if (yych <= '/') goto yy18;",
          "860:  if (yych >= ':') goto yy18;",
          "861: yy34:",
          "866:  if (yych <= '9') goto yy34;",
          "867:  if (yych == ';') goto yy63;",
          "869: yy36:",
          "870:  yych = *++YYCURSOR;",
          "871:  if (yych <= '/') goto yy18;",
          "872:  if (yych >= ':') goto yy18;",
          "873: yy37:",
          "878:  if (yych <= '9') goto yy37;",
          "879:  if (yych <= ':') goto yy65;",
          "881: yy39:",
          "882:  yych = *++YYCURSOR;",
          "883:  if (yych <= '/') goto yy18;",
          "884:  if (yych >= ':') goto yy18;",
          "885: yy40:",
          "890:  if (yych <= '9') goto yy40;",
          "891:  if (yych <= ':') goto yy66;",
          "893: yy42:",
          "895:  if (yych == ';') goto yy67;",
          "897: yy43:",
          "899:  if (yych == '.') goto yy45;",
          "901:  if (yych <= '9') goto yy46;",
          "903: yy44:",
          "908:   if (yych <= '9') goto yy46;",
          "909:   if (yych == 'I') goto yy48;",
          "912: yy45:",
          "915:  if (yych <= '9') goto yy69;",
          "917: yy46:",
          "924:    goto yy69;",
          "927:    if (yych <= '9') goto yy46;",
          "932:    if (yych <= ';') goto yy71;",
          "934:    goto yy73;",
          "936:    if (yych == 'e') goto yy73;",
          "940: yy48:",
          "942:  if (yych == 'N') goto yy74;",
          "944: yy49:",
          "946:  if (yych == 'A') goto yy75;",
          "948: yy50:",
          "952: yy51:",
          "957:  if (yych <= '9') goto yy51;",
          "958:  if (yych == ';') goto yy76;",
          "960: yy53:",
          "961:  yych = *++YYCURSOR;",
          "962:  if (yych <= '/') goto yy18;",
          "963:  if (yych >= ':') goto yy18;",
          "964: yy54:",
          "969:  if (yych <= '9') goto yy54;",
          "970:  if (yych <= ':') goto yy78;",
          "972: yy56:",
          "973:  yych = *++YYCURSOR;",
          "974:  if (yych <= '/') goto yy18;",
          "975:  if (yych >= ':') goto yy18;",
          "976: yy57:",
          "981:  if (yych <= '9') goto yy57;",
          "982:  if (yych == ';') goto yy79;",
          "984: yy59:",
          "985:  yych = *++YYCURSOR;",
          "986:  if (yych <= '/') goto yy18;",
          "987:  if (yych >= ':') goto yy18;",
          "988: yy60:",
          "993:  if (yych <= '9') goto yy60;",
          "994:  if (yych <= ':') goto yy81;",
          "996: yy62:",
          "998:  if (yych == '\"') goto yy82;",
          "1000: yy63:",
          "1002: #line 626 \"ext/standard/var_unserializer.re\"",
          "1009:  id = parse_iv(start + 2) - 1;",
          "",
          "[Added Lines]",
          "724: #line 995 \"ext/standard/var_unserializer.re\"",
          "730: #line 731 \"ext/standard/var_unserializer.c\"",
          "734:   goto yy30;",
          "741: #line 673 \"ext/standard/var_unserializer.re\"",
          "747: #line 748 \"ext/standard/var_unserializer.c\"",
          "750:  if (yych <= '/') goto yy18;",
          "751:  if (yych <= '9') goto yy32;",
          "752:  goto yy18;",
          "756:  if (yych <= '9') goto yy34;",
          "761:  if (yych <= '9') goto yy36;",
          "766:  if (yych <= '1') goto yy38;",
          "772:    if (yych == '+') goto yy39;",
          "775:    if (yych <= '-') goto yy40;",
          "776:    if (yych <= '.') goto yy41;",
          "781:    if (yych <= '9') goto yy42;",
          "783:    goto yy44;",
          "785:    if (yych == 'N') goto yy45;",
          "792:   if (yych == '+') goto yy46;",
          "795:   if (yych <= '-') goto yy46;",
          "797:   if (yych <= '9') goto yy47;",
          "802:  if (yych <= '/') goto yy18;",
          "803:  if (yych <= '9') goto yy49;",
          "804:  goto yy18;",
          "807:  if (yych <= '/') goto yy18;",
          "808:  if (yych <= '9') goto yy51;",
          "809:  goto yy18;",
          "813:  if (yych <= '9') goto yy53;",
          "820:   goto yy30;",
          "823:  if (yych <= ':') goto yy55;",
          "825: yy32:",
          "830:  if (yych <= '9') goto yy32;",
          "831:  if (yych == ';') goto yy56;",
          "833: yy34:",
          "838:  if (yych <= '9') goto yy34;",
          "839:  if (yych <= ':') goto yy58;",
          "841: yy36:",
          "846:  if (yych <= '9') goto yy36;",
          "847:  if (yych <= ':') goto yy59;",
          "849: yy38:",
          "851:  if (yych == ';') goto yy60;",
          "853: yy39:",
          "855:  if (yych == '.') goto yy41;",
          "857:  if (yych <= '9') goto yy42;",
          "859: yy40:",
          "864:   if (yych <= '9') goto yy42;",
          "865:   if (yych == 'I') goto yy44;",
          "868: yy41:",
          "871:  if (yych <= '9') goto yy62;",
          "873: yy42:",
          "880:    goto yy62;",
          "883:    if (yych <= '9') goto yy42;",
          "888:    if (yych <= ';') goto yy64;",
          "890:    goto yy66;",
          "892:    if (yych == 'e') goto yy66;",
          "896: yy44:",
          "898:  if (yych == 'N') goto yy67;",
          "900: yy45:",
          "902:  if (yych == 'A') goto yy68;",
          "904: yy46:",
          "908: yy47:",
          "913:  if (yych <= '9') goto yy47;",
          "914:  if (yych == ';') goto yy69;",
          "916: yy49:",
          "921:  if (yych <= '9') goto yy49;",
          "922:  if (yych <= ':') goto yy71;",
          "924: yy51:",
          "929:  if (yych <= '9') goto yy51;",
          "930:  if (yych == ';') goto yy72;",
          "932: yy53:",
          "937:  if (yych <= '9') goto yy53;",
          "938:  if (yych <= ':') goto yy74;",
          "940: yy55:",
          "942:  if (yych == '\"') goto yy75;",
          "944: yy56:",
          "946: #line 622 \"ext/standard/var_unserializer.re\"",
          "953:  id = parse_uiv(start + 2) - 1;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1026:  return 1;",
          "1027: }",
          "1030:  yych = *++YYCURSOR;",
          "1032:  goto yy18;",
          "1034:  yych = *++YYCURSOR;",
          "1036:  goto yy18;",
          "1038:  ++YYCURSOR;",
          "1040:  {",
          "1042:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1043:  return 1;",
          "1044: }",
          "1047:  ++YYCURSOR;",
          "1048:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "1049:  yych = *YYCURSOR;",
          "1050:  if (yych <= ';') {",
          "1051:   if (yych <= '/') goto yy18;",
          "1053:   if (yych <= ':') goto yy18;",
          "1054:  } else {",
          "1055:   if (yych <= 'E') {",
          "1056:    if (yych <= 'D') goto yy18;",
          "1058:   } else {",
          "1060:    goto yy18;",
          "1061:   }",
          "1062:  }",
          "1064:  ++YYCURSOR;",
          "1066:  {",
          "1067: #if SIZEOF_ZEND_LONG == 4",
          "1068: use_double:",
          "",
          "[Removed Lines]",
          "1028: #line 1029 \"ext/standard/var_unserializer.c\"",
          "1029: yy65:",
          "1031:  if (yych == '\"') goto yy84;",
          "1033: yy66:",
          "1035:  if (yych == '{') goto yy86;",
          "1037: yy67:",
          "1039: #line 683 \"ext/standard/var_unserializer.re\"",
          "1045: #line 1046 \"ext/standard/var_unserializer.c\"",
          "1046: yy69:",
          "1052:   if (yych <= '9') goto yy69;",
          "1057:    goto yy73;",
          "1059:    if (yych == 'e') goto yy73;",
          "1063: yy71:",
          "1065: #line 731 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "972: #line 973 \"ext/standard/var_unserializer.c\"",
          "973: yy58:",
          "975:  if (yych == '\"') goto yy77;",
          "977: yy59:",
          "979:  if (yych == '{') goto yy79;",
          "981: yy60:",
          "983: #line 679 \"ext/standard/var_unserializer.re\"",
          "989: #line 990 \"ext/standard/var_unserializer.c\"",
          "990: yy62:",
          "996:   if (yych <= '9') goto yy62;",
          "1001:    goto yy66;",
          "1003:    if (yych == 'e') goto yy66;",
          "1007: yy64:",
          "1009: #line 727 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1071:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1072:  return 1;",
          "1073: }",
          "1076:  yych = *++YYCURSOR;",
          "1077:  if (yych <= ',') {",
          "1079:   goto yy18;",
          "1080:  } else {",
          "1082:   if (yych <= '/') goto yy18;",
          "1084:   goto yy18;",
          "1085:  }",
          "1087:  yych = *++YYCURSOR;",
          "1089:  goto yy18;",
          "1091:  yych = *++YYCURSOR;",
          "1093:  goto yy18;",
          "1095:  ++YYCURSOR;",
          "1097:  {",
          "1098: #if SIZEOF_ZEND_LONG == 4",
          "1099:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1074: #line 1075 \"ext/standard/var_unserializer.c\"",
          "1075: yy73:",
          "1078:   if (yych == '+') goto yy88;",
          "1081:   if (yych <= '-') goto yy88;",
          "1083:   if (yych <= '9') goto yy89;",
          "1086: yy74:",
          "1088:  if (yych == 'F') goto yy91;",
          "1090: yy75:",
          "1092:  if (yych == 'N') goto yy91;",
          "1094: yy76:",
          "1096: #line 689 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1018: #line 1019 \"ext/standard/var_unserializer.c\"",
          "1019: yy66:",
          "1022:   if (yych == '+') goto yy81;",
          "1025:   if (yych <= '-') goto yy81;",
          "1027:   if (yych <= '9') goto yy82;",
          "1030: yy67:",
          "1032:  if (yych == 'F') goto yy84;",
          "1034: yy68:",
          "1036:  if (yych == 'N') goto yy84;",
          "1038: yy69:",
          "1040: #line 685 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1119:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1120:  return 1;",
          "1121: }",
          "1124:  yych = *++YYCURSOR;",
          "1126:  goto yy18;",
          "1128:  ++YYCURSOR;",
          "1130:  {",
          "1131:  zend_long id;",
          "1134:  if (!var_hash) return 0;",
          "1137:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1138:   return 0;",
          "1139:  }",
          "",
          "[Removed Lines]",
          "1122: #line 1123 \"ext/standard/var_unserializer.c\"",
          "1123: yy78:",
          "1125:  if (yych == '\"') goto yy92;",
          "1127: yy79:",
          "1129: #line 652 \"ext/standard/var_unserializer.re\"",
          "1136:  id = parse_iv(start + 2) - 1;",
          "",
          "[Added Lines]",
          "1066: #line 1067 \"ext/standard/var_unserializer.c\"",
          "1067: yy71:",
          "1069:  if (yych == '\"') goto yy85;",
          "1071: yy72:",
          "1073: #line 648 \"ext/standard/var_unserializer.re\"",
          "1080:  id = parse_uiv(start + 2) - 1;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1152:  return 1;",
          "1153: }",
          "1156:  yych = *++YYCURSOR;",
          "1158:  goto yy18;",
          "1160:  ++YYCURSOR;",
          "1162:  {",
          "1163:  size_t len, len2, len3, maxlen;",
          "1164:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1154: #line 1155 \"ext/standard/var_unserializer.c\"",
          "1155: yy81:",
          "1157:  if (yych == '\"') goto yy94;",
          "1159: yy82:",
          "1161: #line 847 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1098: #line 1099 \"ext/standard/var_unserializer.c\"",
          "1099: yy74:",
          "1101:  if (yych == '\"') goto yy87;",
          "1103: yy75:",
          "1105: #line 843 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1311:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1312: }",
          "1315:  ++YYCURSOR;",
          "1317:  {",
          "1318:  size_t len, maxlen;",
          "1319:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1313: #line 1314 \"ext/standard/var_unserializer.c\"",
          "1314: yy84:",
          "1316: #line 772 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1257: #line 1258 \"ext/standard/var_unserializer.c\"",
          "1258: yy77:",
          "1260: #line 768 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1347:  ZVAL_STR(rval, str);",
          "1348:  return 1;",
          "1349: }",
          "1352:  ++YYCURSOR;",
          "1354:  {",
          "1355:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "1350: #line 1351 \"ext/standard/var_unserializer.c\"",
          "1351: yy86:",
          "1353: #line 806 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1294: #line 1295 \"ext/standard/var_unserializer.c\"",
          "1295: yy79:",
          "1297: #line 802 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1381:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1382: }",
          "1385:  yych = *++YYCURSOR;",
          "1386:  if (yych <= '/') goto yy18;",
          "1387:  if (yych >= ':') goto yy18;",
          "1389:  ++YYCURSOR;",
          "1390:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1391:  yych = *YYCURSOR;",
          "1392:  if (yych <= '/') goto yy18;",
          "1395:  goto yy18;",
          "1397:  yych = *++YYCURSOR;",
          "1399:  goto yy18;",
          "1401:  ++YYCURSOR;",
          "1403:  {",
          "1404:  long elements;",
          "1405:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "1383: #line 1384 \"ext/standard/var_unserializer.c\"",
          "1384: yy88:",
          "1388: yy89:",
          "1393:  if (yych <= '9') goto yy89;",
          "1394:  if (yych == ';') goto yy71;",
          "1396: yy91:",
          "1398:  if (yych == ';') goto yy96;",
          "1400: yy92:",
          "1402: #line 836 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1327: #line 1328 \"ext/standard/var_unserializer.c\"",
          "1328: yy81:",
          "1332: yy82:",
          "1337:  if (yych <= '9') goto yy82;",
          "1338:  if (yych == ';') goto yy64;",
          "1340: yy84:",
          "1342:  if (yych == ';') goto yy89;",
          "1344: yy85:",
          "1346: #line 832 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1410:  }",
          "1411:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1412: }",
          "1415:  ++YYCURSOR;",
          "1417:  {",
          "1418:  size_t len, maxlen;",
          "1419:  char *str;",
          "",
          "[Removed Lines]",
          "1413: #line 1414 \"ext/standard/var_unserializer.c\"",
          "1414: yy94:",
          "1416: #line 740 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1357: #line 1358 \"ext/standard/var_unserializer.c\"",
          "1358: yy87:",
          "1360: #line 736 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1445:  ZVAL_STRINGL(rval, str, len);",
          "1446:  return 1;",
          "1447: }",
          "1450:  ++YYCURSOR;",
          "1452:  {",
          "",
          "[Removed Lines]",
          "1448: #line 1449 \"ext/standard/var_unserializer.c\"",
          "1449: yy96:",
          "1451: #line 715 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1392: #line 1393 \"ext/standard/var_unserializer.c\"",
          "1393: yy89:",
          "1395: #line 711 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1465:  return 1;",
          "1466: }",
          "1468: }",
          "1472:  return 0;",
          "",
          "[Removed Lines]",
          "1467: #line 1468 \"ext/standard/var_unserializer.c\"",
          "1469: #line 1007 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1411: #line 1412 \"ext/standard/var_unserializer.c\"",
          "1413: #line 1003 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "320: iv = [+-]? [0-9]+;",
          "321: nv = [+-]? ([0-9]* \".\" [0-9]+|[0-9]+ \".\" [0-9]*);",
          "322: nvexp = (iv | nv) [eE] iv;",
          "",
          "[Removed Lines]",
          "319: uiv = [+]? [0-9]+;",
          "",
          "[Added Lines]",
          "319: uiv = [0-9]+;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "365:  unsigned char cursor;",
          "366:  size_t result = 0;",
          "372:  while (1) {",
          "373:   cursor = *p;",
          "374:   if (cursor >= '0' && cursor <= '9') {",
          "",
          "[Removed Lines]",
          "368:  if (*p == '+') {",
          "369:   p++;",
          "370:  }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "627:  zend_long id;",
          "630:  if (!var_hash) return 0;",
          "633:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "634:   return 0;",
          "635:  }",
          "",
          "[Removed Lines]",
          "626: \"R:\" iv \";\"  {",
          "632:  id = parse_iv(start + 2) - 1;",
          "",
          "[Added Lines]",
          "622: \"R:\" uiv \";\"  {",
          "628:  id = parse_uiv(start + 2) - 1;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "649:  return 1;",
          "650: }",
          "653:  zend_long id;",
          "656:  if (!var_hash) return 0;",
          "659:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "660:   return 0;",
          "661:  }",
          "",
          "[Removed Lines]",
          "652: \"r:\" iv \";\"  {",
          "658:  id = parse_iv(start + 2) - 1;",
          "",
          "[Added Lines]",
          "648: \"r:\" uiv \";\"  {",
          "654:  id = parse_uiv(start + 2) - 1;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "833:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "834: }",
          "837:  long elements;",
          "838:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "836: \"o:\" iv \":\" [\"] {",
          "",
          "[Added Lines]",
          "832: \"o:\" uiv \":\" [\"] {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "05c8a0771ddf97ef33fa9bdcfbca29625abb3042",
      "candidate_info": {
        "commit_hash": "05c8a0771ddf97ef33fa9bdcfbca29625abb3042",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/05c8a0771ddf97ef33fa9bdcfbca29625abb3042",
        "files": [
          "ext/standard/tests/strings/bug70436.phpt",
          "ext/standard/tests/strings/bug72663.phpt"
        ],
        "message": "fix tests\n\nThe 70436 test is just a bonus for the hardening in 72633.",
        "before_after_code_files": [
          "ext/standard/tests/strings/bug70436.phpt||ext/standard/tests/strings/bug70436.phpt",
          "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt"
          ],
          "candidate": [
            "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/strings/bug70436.phpt||ext/standard/tests/strings/bug70436.phpt": [
          "File: ext/standard/tests/strings/bug70436.phpt -> ext/standard/tests/strings/bug70436.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "49: Notice: unserialize(): Error at offset 0 of 3 bytes in %sbug70436.php on line %d",
          "51: Notice: unserialize(): Error at offset 17 of 17 bytes in %sbug70436.php on line %d",
          "",
          "[Removed Lines]",
          "52: array(4) {",
          "53:   [0]=>",
          "54:   int(1)",
          "55:   [1]=>",
          "56:   object(obj)#%d (1) {",
          "57:     [\"data\"]=>",
          "58:     bool(false)",
          "59:   }",
          "60:   [2]=>",
          "61:   string(24) \"%s\"",
          "62:   [3]=>",
          "63:   bool(false)",
          "64: }",
          "65: DONE",
          "",
          "[Added Lines]",
          "54: bool(false)",
          "55: DONE",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
          "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
          "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
          "",
          "[Removed Lines]",
          "26: DONE",
          "",
          "[Added Lines]",
          "28: DONE",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c1cfd6a9fe23765191ea2f654790c7b127d4b797",
      "candidate_info": {
        "commit_hash": "c1cfd6a9fe23765191ea2f654790c7b127d4b797",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/c1cfd6a9fe23765191ea2f654790c7b127d4b797",
        "files": [
          "ext/standard/tests/strings/bug72663.phpt",
          "ext/standard/tests/strings/bug72663_2.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix bug #72663 - destroy broken object when unserializing",
        "before_after_code_files": [
          "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
          "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
            "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt",
            "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/strings/bug72663.phpt||ext/standard/tests/strings/bug72663.phpt": [
          "File: ext/standard/tests/strings/bug72663.phpt -> ext/standard/tests/strings/bug72663.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --FILE--",
          "4: <?php",
          "5: class obj implements Serializable {",
          "6:     var $data;",
          "7:     function serialize() {",
          "8:         return serialize($this->data);",
          "9:     }",
          "10:     function unserialize($data) {",
          "11:         $this->data = unserialize($data);",
          "12:     }",
          "13: }",
          "15: $inner = 'a:1:{i:0;O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:4;}';",
          "16: $exploit = 'a:2:{i:0;C:3:\"obj\":'.strlen($inner).':{'.$inner.'}i:1;R:4;}';",
          "18: $data = unserialize($exploit);",
          "19: echo $data[1];",
          "20: ?>",
          "21: DONE",
          "22: --EXPECTF--",
          "23: Notice: unserialize(): Unexpected end of serialized data in %sbug72663.php on line %d",
          "25: Notice: unserialize(): Error at offset 46 of 47 bytes in %sbug72663.php on line %d",
          "26: DONE",
          "",
          "---------------"
        ],
        "ext/standard/tests/strings/bug72663_2.phpt||ext/standard/tests/strings/bug72663_2.phpt": [
          "File: ext/standard/tests/strings/bug72663_2.phpt -> ext/standard/tests/strings/bug72663_2.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72663: Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization",
          "3: --FILE--",
          "4: <?php",
          "6: ini_set('session.serialize_handler', 'php_serialize');",
          "7: session_start();",
          "8: $sess = 'O:9:\"Exception\":2:{s:7:\"'.\"\\0\".'*'.\"\\0\".'file\";R:1;}';",
          "9: session_decode($sess);",
          "10: var_dump($_SESSION);",
          "11: ?>",
          "12: DONE",
          "13: --EXPECTF--",
          "14: Notice: session_decode(): Unexpected end of serialized data in %sbug72663_2.php on line %d",
          "15: array(0) {",
          "16: }",
          "17: DONE",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "434:  }",
          "436:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
          "437:   return 0;",
          "438:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "438:      zend_hash_clean(Z_OBJPROP_PP(rval));",
          "439:      ZVAL_NULL(*rval);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "486: {",
          "487:  YYCTYPE yych;",
          "488:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "485: #line 486 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "488: #line 489 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "542:  yych = *(YYMARKER = ++YYCURSOR);",
          "543:  if (yych == ':') goto yy95;",
          "544: yy3:",
          "546:  { return 0; }",
          "548: yy4:",
          "549:  yych = *(YYMARKER = ++YYCURSOR);",
          "550:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "545: #line 851 \"ext/standard/var_unserializer.re\"",
          "547: #line 548 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "548: #line 854 \"ext/standard/var_unserializer.re\"",
          "550: #line 551 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "587:  goto yy3;",
          "588: yy14:",
          "589:  ++YYCURSOR;",
          "591:  {",
          "593:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "595: }",
          "597: yy16:",
          "598:  yych = *++YYCURSOR;",
          "599:  goto yy3;",
          "",
          "[Removed Lines]",
          "590: #line 845 \"ext/standard/var_unserializer.re\"",
          "596: #line 597 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "593: #line 848 \"ext/standard/var_unserializer.re\"",
          "599: #line 600 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "619:  if (yybm[0+yych] & 128) {",
          "620:   goto yy20;",
          "621:  }",
          "623:  yych = *++YYCURSOR;",
          "624:  if (yych != '\"') goto yy18;",
          "625:  ++YYCURSOR;",
          "627:  {",
          "628:  size_t len, len2, len3, maxlen;",
          "629:  long elements;",
          "",
          "[Removed Lines]",
          "622:  if (yych != ':') goto yy18;",
          "626: #line 698 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "625:  if (yych <= '/') goto yy18;",
          "626:  if (yych >= ';') goto yy18;",
          "630: #line 701 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "771:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "772: }",
          "774: yy25:",
          "775:  yych = *++YYCURSOR;",
          "776:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "773: #line 774 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "777: #line 778 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "795:  yych = *++YYCURSOR;",
          "796:  if (yych != '\"') goto yy18;",
          "797:  ++YYCURSOR;",
          "799:  {",
          "800:     if (!var_hash) return 0;",
          "",
          "[Removed Lines]",
          "798: #line 689 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "802: #line 692 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "804:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "805:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "806: }",
          "808: yy32:",
          "809:  yych = *++YYCURSOR;",
          "810:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "807: #line 808 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "811: #line 812 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "825:  yych = *++YYCURSOR;",
          "826:  if (yych != '{') goto yy18;",
          "827:  ++YYCURSOR;",
          "829:  {",
          "830:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "828: #line 668 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "832: #line 671 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "847:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "848: }",
          "850: yy39:",
          "851:  yych = *++YYCURSOR;",
          "852:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "849: #line 850 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "853: #line 854 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "867:  yych = *++YYCURSOR;",
          "868:  if (yych != '\"') goto yy18;",
          "869:  ++YYCURSOR;",
          "871:  {",
          "872:  size_t len, maxlen;",
          "873:  char *str;",
          "",
          "[Removed Lines]",
          "870: #line 633 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "874: #line 636 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "902:  ZVAL_STRINGL(*rval, str, len, 0);",
          "903:  return 1;",
          "904: }",
          "906: yy46:",
          "907:  yych = *++YYCURSOR;",
          "908:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "905: #line 906 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "909: #line 910 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "923:  yych = *++YYCURSOR;",
          "924:  if (yych != '\"') goto yy18;",
          "925:  ++YYCURSOR;",
          "927:  {",
          "928:  size_t len, maxlen;",
          "929:  char *str;",
          "",
          "[Removed Lines]",
          "926: #line 600 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "930: #line 603 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "956:  ZVAL_STRINGL(*rval, str, len, 1);",
          "957:  return 1;",
          "958: }",
          "960: yy53:",
          "961:  yych = *++YYCURSOR;",
          "962:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "959: #line 960 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "963: #line 964 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1044:  }",
          "1045: yy63:",
          "1046:  ++YYCURSOR;",
          "1048:  {",
          "1049: #if SIZEOF_LONG == 4",
          "1050: use_double:",
          "",
          "[Removed Lines]",
          "1047: #line 590 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1051: #line 593 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1054:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1055:  return 1;",
          "1056: }",
          "1058: yy65:",
          "1059:  yych = *++YYCURSOR;",
          "1060:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1057: #line 1058 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1113:  yych = *++YYCURSOR;",
          "1114:  if (yych != ';') goto yy18;",
          "1115:  ++YYCURSOR;",
          "1117:  {",
          "1119:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1116: #line 575 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1120: #line 578 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1129:  return 1;",
          "1130: }",
          "1132: yy76:",
          "1133:  yych = *++YYCURSOR;",
          "1134:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1131: #line 1132 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1135: #line 1136 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1155:  if (yych <= '9') goto yy79;",
          "1156:  if (yych != ';') goto yy18;",
          "1157:  ++YYCURSOR;",
          "1159:  {",
          "1160: #if SIZEOF_LONG == 4",
          "1161:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1158: #line 548 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1162: #line 551 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1182:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1183:  return 1;",
          "1184: }",
          "1186: yy83:",
          "1187:  yych = *++YYCURSOR;",
          "1188:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1185: #line 1186 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1189: #line 1190 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1190:  yych = *++YYCURSOR;",
          "1191:  if (yych != ';') goto yy18;",
          "1192:  ++YYCURSOR;",
          "1194:  {",
          "1196:  INIT_PZVAL(*rval);",
          "1197:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1198:  return 1;",
          "1199: }",
          "1201: yy87:",
          "1202:  ++YYCURSOR;",
          "1204:  {",
          "1206:  INIT_PZVAL(*rval);",
          "1207:  ZVAL_NULL(*rval);",
          "1208:  return 1;",
          "1209: }",
          "1211: yy89:",
          "1212:  yych = *++YYCURSOR;",
          "1213:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1193: #line 541 \"ext/standard/var_unserializer.re\"",
          "1200: #line 1201 \"ext/standard/var_unserializer.c\"",
          "1203: #line 534 \"ext/standard/var_unserializer.re\"",
          "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1197: #line 544 \"ext/standard/var_unserializer.re\"",
          "1204: #line 1205 \"ext/standard/var_unserializer.c\"",
          "1207: #line 537 \"ext/standard/var_unserializer.re\"",
          "1214: #line 1215 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1230:  if (yych <= '9') goto yy91;",
          "1231:  if (yych != ';') goto yy18;",
          "1232:  ++YYCURSOR;",
          "1234:  {",
          "1235:  long id;",
          "",
          "[Removed Lines]",
          "1233: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1237: #line 514 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1254:  return 1;",
          "1255: }",
          "1257: yy95:",
          "1258:  yych = *++YYCURSOR;",
          "1259:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1256: #line 1257 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1260: #line 1261 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1276:  if (yych <= '9') goto yy97;",
          "1277:  if (yych != ';') goto yy18;",
          "1278:  ++YYCURSOR;",
          "1280:  {",
          "1281:  long id;",
          "",
          "[Removed Lines]",
          "1279: #line 490 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1283: #line 493 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1298:  return 1;",
          "1299: }",
          "1301: }",
          "1305:  return 0;",
          "",
          "[Removed Lines]",
          "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
          "1302: #line 853 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1304: #line 1305 \"ext/standard/var_unserializer.c\"",
          "1306: #line 856 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "438:  }",
          "440:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_OBJPROP_PP(rval), elements, 1)) {",
          "441:   return 0;",
          "442:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "442:      zend_hash_clean(Z_OBJPROP_PP(rval));",
          "443:      ZVAL_NULL(*rval);",
          "",
          "---------------"
        ]
      }
    }
  ]
}