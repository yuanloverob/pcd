{
  "cve_id": "CVE-2017-12427",
  "cve_desc": "The ProcessMSLScript function in coders/msl.c in ImageMagick before 6.9.9-5 and 7.x before 7.0.6-5 allows remote attackers to cause a denial of service (memory leak) via a crafted file, related to the WriteMSLImage function.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "e793eb203e5e0f91f5037aed6585e81b1e27395b",
  "patch_info": {
    "commit_hash": "e793eb203e5e0f91f5037aed6585e81b1e27395b",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/e793eb203e5e0f91f5037aed6585e81b1e27395b",
    "files": [
      "ChangeLog",
      "coders/msl.c"
    ],
    "message": "https://github.com/ImageMagick/ImageMagick/issues/636",
    "before_after_code_files": [
      "coders/msl.c||coders/msl.c"
    ]
  },
  "patch_diff": {
    "coders/msl.c||coders/msl.c": [
      "File: coders/msl.c -> coders/msl.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "7899:     status=xmlParseChunk(msl_info.parser,message,(int) n,MagickFalse);",
      "7900:     if (status != 0)",
      "7901:       break;",
      "7902:     (void) xmlParseChunk(msl_info.parser,\" \",1,MagickFalse);",
      "7903:     if (msl_info.exception->severity >= ErrorException)",
      "7904:       break;",
      "7905:   }",
      "7906:   if (msl_info.exception->severity == UndefinedException)",
      "7907:     (void) xmlParseChunk(msl_info.parser,\" \",1,MagickTrue);",
      "7908:   xmlFreeParserCtxt(msl_info.parser);",
      "7909:   (void) LogMagickEvent(CoderEvent,GetMagickModule(),\"end SAX\");",
      "7910:   msl_info.group_info=(MSLGroupInfo *) RelinquishMagickMemory(",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "7903:     if (msl_info.exception->severity >= ErrorException)",
      "7904:       break;",
      "7912:   (void) LogMagickEvent(CoderEvent,GetMagickModule(),\"end SAX\");",
      "7913:   msl_info.group_info=(MSLGroupInfo *) RelinquishMagickMemory(",
      "7914:     msl_info.group_info);",
      "7915:   if (*image == (Image *) NULL)",
      "7918:   msl_info.image_info=(ImageInfo **) RelinquishMagickMemory(",
      "7919:     msl_info.image_info);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3755d2289b032919c065f6ab11ef570063f7f828",
      "candidate_info": {
        "commit_hash": "3755d2289b032919c065f6ab11ef570063f7f828",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/3755d2289b032919c065f6ab11ef570063f7f828",
        "files": [
          "MagickWand/conjure.c",
          "coders/msl.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/920",
        "before_after_code_files": [
          "MagickWand/conjure.c||MagickWand/conjure.c",
          "coders/msl.c||coders/msl.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/msl.c||coders/msl.c"
          ],
          "candidate": [
            "coders/msl.c||coders/msl.c"
          ]
        }
      },
      "candidate_diff": {
        "MagickWand/conjure.c||MagickWand/conjure.c": [
          "File: MagickWand/conjure.c -> MagickWand/conjure.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "290:     (void) DeleteImageOption(image_info,\"filename\");",
          "291:     status=SetImageOption(image_info,\"filename\",argv[i]);",
          "293:       ThrowConjureException(ImageError,\"UnableToPersistKey\",argv[i]);",
          "294:     (void) FormatLocaleString(filename,MagickPathExtent,\"msl:%s\",argv[i]);",
          "295:     image=ReadImages(image_info,filename,exception);",
          "",
          "[Removed Lines]",
          "292:     if (status == MagickFalse)",
          "",
          "[Added Lines]",
          "292:     if (status == MagickFalse)",
          "",
          "---------------"
        ],
        "coders/msl.c||coders/msl.c": [
          "File: coders/msl.c -> coders/msl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "595: static void MSLPopImage(MSLInfo *msl_info)",
          "596: {",
          "597:   if (msl_info->number_groups != 0)",
          "598:     return;",
          "599:   if (msl_info->image[msl_info->n] != (Image *) NULL)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "597:   if (msl_info->number_groups != 0)",
          "598:     return;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "7904:       break;",
          "7905:   }",
          "7906:   if (msl_info.exception->severity == UndefinedException)",
          "7909:     Free resources.",
          "7911:   xmlFreeParserCtxt(msl_info.parser);",
          "7915:   if (*image == (Image *) NULL)",
          "7918:   msl_info.image_info=(ImageInfo **) RelinquishMagickMemory(",
          "7919:     msl_info.image_info);",
          "7921:   msl_info.draw_info=(DrawInfo **) RelinquishMagickMemory(msl_info.draw_info);",
          "",
          "[Removed Lines]",
          "7907:     (void) xmlParseChunk(msl_info.parser,\" \",1,MagickTrue);",
          "7912:   (void) LogMagickEvent(CoderEvent,GetMagickModule(),\"end SAX\");",
          "7913:   msl_info.group_info=(MSLGroupInfo *) RelinquishMagickMemory(",
          "7914:     msl_info.group_info);",
          "",
          "[Added Lines]",
          "7911:     Free resources.",
          "7913:   xmlFreeParserCtxt(msl_info.parser);",
          "7914:   (void) LogMagickEvent(CoderEvent,GetMagickModule(),\"end SAX\");",
          "7915:   if (*image == (Image *) NULL)",
          "7917:   while (msl_info.n >= 0)",
          "7918:   {",
          "7919:     msl_info.image[msl_info.n]=DestroyImage(msl_info.image[msl_info.n]);",
          "7920:     msl_info.attributes[msl_info.n]=DestroyImage(",
          "7921:       msl_info.attributes[msl_info.n]);",
          "7925:       msl_info.image_info[msl_info.n]);",
          "7926:     msl_info.n--;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "8334: %    o image_info: the image info.",
          "8335: %",
          "8336: %    o image:  The image.",
          "8341: static MagickBooleanType WriteMSLImage(const ImageInfo *image_info,Image *image,",
          "8342:   ExceptionInfo *exception)",
          "",
          "[Removed Lines]",
          "8337: %",
          "8338: %    o exception: return any errors or warnings in this structure.",
          "8339: %",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "8344:   Image",
          "8351:   assert(image_info->signature == MagickCoreSignature);",
          "8352:   assert(image != (Image *) NULL);",
          "",
          "[Removed Lines]",
          "8347:   MagickBooleanType",
          "8348:     status;",
          "8350:   assert(image_info != (const ImageInfo *) NULL);",
          "",
          "[Added Lines]",
          "8352:   Image",
          "",
          "---------------"
        ]
      }
    }
  ]
}