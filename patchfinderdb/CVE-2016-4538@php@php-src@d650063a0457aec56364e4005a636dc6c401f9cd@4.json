{
  "cve_id": "CVE-2016-4538",
  "cve_desc": "The bcpowmod function in ext/bcmath/bcmath.c in PHP before 5.5.35, 5.6.x before 5.6.21, and 7.x before 7.0.6 modifies certain data structures without considering whether they are copies of the _zero_, _one_, or _two_ global variable, which allows remote attackers to cause a denial of service or possibly have unspecified other impact via a crafted call.",
  "repo": "php/php-src",
  "patch_hash": "d650063a0457aec56364e4005a636dc6c401f9cd",
  "patch_info": {
    "commit_hash": "d650063a0457aec56364e4005a636dc6c401f9cd",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/d650063a0457aec56364e4005a636dc6c401f9cd",
    "files": [
      "ext/bcmath/bcmath.c",
      "ext/bcmath/tests/bug72093.phpt",
      "main/php_version.h"
    ],
    "message": "Fix bug #72093: bcpowmod accepts negative scale and corrupts _one_ definition\n\nWe can not modify result since it can be copy of _zero_ or _one_, etc. and\n\"copy\" in bcmath is just bumping the refcount.",
    "before_after_code_files": [
      "ext/bcmath/bcmath.c||ext/bcmath/bcmath.c",
      "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt",
      "main/php_version.h||main/php_version.h"
    ]
  },
  "patch_diff": {
    "ext/bcmath/bcmath.c||ext/bcmath/bcmath.c": [
      "File: ext/bcmath/bcmath.c -> ext/bcmath/bcmath.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "201: }",
      "206: PHP_FUNCTION(bcadd)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "206: static bc_num split_bc_num(bc_num num) {",
      "207:  bc_num newnum;",
      "208:  if (num->n_refs >= 1) {",
      "209:   return num;",
      "210:  }",
      "211:  newnum = _bc_new_num_ex(0, 0, 0);",
      "213:  newnum->n_refs = 1;",
      "214:  num->n_refs--;",
      "215:  return newnum;",
      "216: }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "225:  php_str2num(&first, left TSRMLS_CC);",
      "226:  php_str2num(&second, right TSRMLS_CC);",
      "227:  bc_add (first, second, &result, scale);",
      "229:  if (result->n_scale > scale) {",
      "230:   result->n_scale = scale;",
      "231:  }",
      "233:  Z_STRVAL_P(return_value) = bc_num2str(result);",
      "234:  Z_STRLEN_P(return_value) = strlen(Z_STRVAL_P(return_value));",
      "235:  Z_TYPE_P(return_value) = IS_STRING;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "245:   result = split_bc_num(result);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "266:  bc_sub (first, second, &result, scale);",
      "268:  if (result->n_scale > scale) {",
      "269:   result->n_scale = scale;",
      "270:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "285:   result = split_bc_num(result);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "305:  bc_multiply (first, second, &result, scale TSRMLS_CC);",
      "307:  if (result->n_scale > scale) {",
      "308:   result->n_scale = scale;",
      "309:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "325:   result = split_bc_num(result);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "345:  switch (bc_divide(first, second, &result, scale TSRMLS_CC)) {",
      "347:    if (result->n_scale > scale) {",
      "348:     result->n_scale = scale;",
      "349:    }",
      "350:    Z_STRVAL_P(return_value) = bc_num2str(result);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "366:     result = split_bc_num(result);",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "424:  scale_int = (int) ((int)scale < 0) ? 0 : scale;",
      "426:  if (bc_raisemod(first, second, mod, &result, scale_int TSRMLS_CC) != -1) {",
      "429:   }",
      "430:   Z_STRVAL_P(return_value) = bc_num2str(result);",
      "431:   Z_STRLEN_P(return_value) = strlen(Z_STRVAL_P(return_value));",
      "",
      "[Removed Lines]",
      "427:   if (result->n_scale > scale) {",
      "428:    result->n_scale = scale;",
      "",
      "[Added Lines]",
      "446:   if (result->n_scale > scale_int) {",
      "447:    result = split_bc_num(result);",
      "448:    result->n_scale = scale_int;",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "468:  bc_raise (first, second, &result, scale TSRMLS_CC);",
      "470:  if (result->n_scale > scale) {",
      "471:   result->n_scale = scale;",
      "472:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "491:   result = split_bc_num(result);",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "494:  if (zend_parse_parameters(argc TSRMLS_CC, \"s|l\", &left, &left_len, &scale_param) == FAILURE) {",
      "495:   return;",
      "496:  }",
      "498:  if (argc == 2) {",
      "499:   scale = (int) ((int)scale_param < 0) ? 0 : scale_param;",
      "500:  }",
      "502:  bc_init_num(&result TSRMLS_CC);",
      "503:  php_str2num(&result, left TSRMLS_CC);",
      "505:  if (bc_sqrt (&result, scale TSRMLS_CC) != 0) {",
      "506:   if (result->n_scale > scale) {",
      "507:    result->n_scale = scale;",
      "508:   }",
      "509:   Z_STRVAL_P(return_value) = bc_num2str(result);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "528:    result = split_bc_num(result);",
      "",
      "---------------"
    ],
    "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt": [
      "File: ext/bcmath/tests/bug72093.phpt -> ext/bcmath/tests/bug72093.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug 72093: bcpowmod accepts negative scale and corrupts _one_ definition",
      "3: --SKIPIF--",
      "4: <?php if(!extension_loaded(\"bcmath\")) print \"skip\"; ?>",
      "5: --FILE--",
      "6: <?php",
      "7: var_dump(bcpowmod(1, \"A\", 128, -200));",
      "8: var_dump(bcpowmod(1, 1.2, 1, 1));",
      "9: ?>",
      "10: --EXPECTF--",
      "11: string(1) \"1\"",
      "12: bc math warning: non-zero scale in exponent",
      "13: string(3) \"0.0\"",
      "",
      "---------------"
    ],
    "main/php_version.h||main/php_version.h": [
      "File: main/php_version.h -> main/php_version.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: #define PHP_MAJOR_VERSION 5",
      "4: #define PHP_MINOR_VERSION 5",
      "6: #define PHP_EXTRA_VERSION \"-dev\"",
      "",
      "[Removed Lines]",
      "5: #define PHP_RELEASE_VERSION 35",
      "7: #define PHP_VERSION \"5.5.35-dev\"",
      "8: #define PHP_VERSION_ID 50535",
      "",
      "[Added Lines]",
      "5: #define PHP_RELEASE_VERSION 27",
      "7: #define PHP_VERSION \"5.5.27-dev\"",
      "8: #define PHP_VERSION_ID 50527",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "a6734f70e124fcccb1b488f40cc00a1fa07b5d4a",
      "candidate_info": {
        "commit_hash": "a6734f70e124fcccb1b488f40cc00a1fa07b5d4a",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/a6734f70e124fcccb1b488f40cc00a1fa07b5d4a",
        "files": [
          "configure.in",
          "main/php_version.h"
        ],
        "message": "5.5.32 now",
        "before_after_code_files": [
          "configure.in||configure.in",
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "120: PHP_MAJOR_VERSION=5",
          "121: PHP_MINOR_VERSION=5",
          "123: PHP_EXTRA_VERSION=\"-dev\"",
          "124: PHP_VERSION=\"$PHP_MAJOR_VERSION.$PHP_MINOR_VERSION.$PHP_RELEASE_VERSION$PHP_EXTRA_VERSION\"",
          "125: PHP_VERSION_ID=`expr [$]PHP_MAJOR_VERSION \\* 10000 + [$]PHP_MINOR_VERSION \\* 100 + [$]PHP_RELEASE_VERSION`",
          "",
          "[Removed Lines]",
          "122: PHP_RELEASE_VERSION=31",
          "",
          "[Added Lines]",
          "122: PHP_RELEASE_VERSION=32",
          "",
          "---------------"
        ],
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 5",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "",
          "[Removed Lines]",
          "5: #define PHP_RELEASE_VERSION 31",
          "7: #define PHP_VERSION \"5.5.31-dev\"",
          "8: #define PHP_VERSION_ID 50531",
          "",
          "[Added Lines]",
          "5: #define PHP_RELEASE_VERSION 32",
          "7: #define PHP_VERSION \"5.5.32-dev\"",
          "8: #define PHP_VERSION_ID 50532",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a21a99747829fe9683e76e03ba6e29a772ef82ac",
      "candidate_info": {
        "commit_hash": "a21a99747829fe9683e76e03ba6e29a772ef82ac",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/a21a99747829fe9683e76e03ba6e29a772ef82ac",
        "files": [
          "ext/bcmath/tests/bug72093-win32.phpt",
          "ext/bcmath/tests/bug72093.phpt",
          "ext/exif/tests/bug72094.phpt",
          "ext/gd/tests/bug71912.phpt"
        ],
        "message": "fix/improve tests",
        "before_after_code_files": [
          "ext/bcmath/tests/bug72093-win32.phpt||ext/bcmath/tests/bug72093-win32.phpt",
          "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt",
          "ext/exif/tests/bug72094.phpt||ext/exif/tests/bug72094.phpt",
          "ext/gd/tests/bug71912.phpt||ext/gd/tests/bug71912.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt"
          ],
          "candidate": [
            "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/bcmath/tests/bug72093-win32.phpt||ext/bcmath/tests/bug72093-win32.phpt": [
          "File: ext/bcmath/tests/bug72093-win32.phpt -> ext/bcmath/tests/bug72093-win32.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug 72093: bcpowmod accepts negative scale and corrupts _one_ definition",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if(!extension_loaded(\"bcmath\")) print \"skip\";",
          "6: if (substr(PHP_OS, 0, 3) != 'WIN') {",
          "7:     die('skip valid only for windows');",
          "8: }",
          "9: ?>",
          "10: --FILE--",
          "11: <?php",
          "12: var_dump(bcpowmod(1, \"A\", 128, -200));",
          "13: var_dump(bcpowmod(1, 1.2, 1, 1));",
          "14: ?>",
          "15: --EXPECTF--",
          "16: string(1) \"1\"",
          "17: string(3) \"0.0\"",
          "18: bc math warning: non-zero scale in exponent",
          "",
          "---------------"
        ],
        "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt": [
          "File: ext/bcmath/tests/bug72093.phpt -> ext/bcmath/tests/bug72093.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: --TEST--",
          "2: Bug 72093: bcpowmod accepts negative scale and corrupts _one_ definition",
          "3: --SKIPIF--",
          "5: --FILE--",
          "6: <?php",
          "7: var_dump(bcpowmod(1, \"A\", 128, -200));",
          "",
          "[Removed Lines]",
          "4: <?php if(!extension_loaded(\"bcmath\")) print \"skip\"; ?>",
          "",
          "[Added Lines]",
          "4: <?php",
          "5: if(!extension_loaded(\"bcmath\")) print \"skip\";",
          "6: if (substr(PHP_OS, 0, 3) == 'WIN') {",
          "7:     die('skip Not valid for windows');",
          "8: }",
          "9: ?>",
          "",
          "---------------"
        ],
        "ext/exif/tests/bug72094.phpt||ext/exif/tests/bug72094.phpt": [
          "File: ext/exif/tests/bug72094.phpt -> ext/exif/tests/bug72094.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: ?>",
          "12: DONE",
          "13: --EXPECTF--",
          "",
          "[Removed Lines]",
          "14: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "16: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "18: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "20: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "22: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "24: Warning: exif_read_data(bug72094_1.jpg): Process tag(x8298=Copyright  ): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "26: Warning: exif_read_data(bug72094_1.jpg): Illegal IFD offset in %s/bug72094.php on line %d",
          "28: Warning: exif_read_data(bug72094_1.jpg): File structure corrupted in %s/bug72094.php on line %d",
          "30: Warning: exif_read_data(bug72094_1.jpg): Invalid JPEG file in %s/bug72094.php on line %d",
          "32: Warning: exif_read_data(bug72094_2.jpg): Illegal IFD size in %s/bug72094.php on line %d",
          "34: Warning: exif_read_data(bug72094_2.jpg): File structure corrupted in %s/bug72094.php on line %d",
          "36: Warning: exif_read_data(bug72094_2.jpg): Invalid JPEG file in %s/bug72094.php on line %d",
          "38: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "40: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "42: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "44: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "46: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "48: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s/bug72094.php on line %d",
          "50: Warning: exif_read_data(bug72094_3.jpg): Illegal IFD size in %s/bug72094.php on line %d",
          "52: Warning: exif_read_data(bug72094_3.jpg): File structure corrupted in %s/bug72094.php on line %d",
          "54: Warning: exif_read_data(bug72094_3.jpg): Invalid JPEG file in %s/bug72094.php on line %d",
          "56: Warning: exif_read_data(bug72094_4.jpg): Invalid TIFF start (1) in %s/bug72094.php on line %d",
          "58: Warning: exif_read_data(bug72094_4.jpg): File structure corrupted in %s/bug72094.php on line %d",
          "60: Warning: exif_read_data(bug72094_4.jpg): Invalid JPEG file in %s/bug72094.php on line %d",
          "61: DONE",
          "",
          "[Added Lines]",
          "14: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "16: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "18: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "20: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "22: Warning: exif_read_data(bug72094_1.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "24: Warning: exif_read_data(bug72094_1.jpg): Process tag(x8298=Copyright  ): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "26: Warning: exif_read_data(bug72094_1.jpg): Illegal IFD offset in %s%ebug72094.php on line %d",
          "28: Warning: exif_read_data(bug72094_1.jpg): File structure corrupted in %s%ebug72094.php on line %d",
          "30: Warning: exif_read_data(bug72094_1.jpg): Invalid JPEG file in %s%ebug72094.php on line %d",
          "32: Warning: exif_read_data(bug72094_2.jpg): Illegal IFD size in %s%ebug72094.php on line %d",
          "34: Warning: exif_read_data(bug72094_2.jpg): File structure corrupted in %s%ebug72094.php on line %d",
          "36: Warning: exif_read_data(bug72094_2.jpg): Invalid JPEG file in %s%ebug72094.php on line %d",
          "38: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "40: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "42: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "44: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "46: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "48: Warning: exif_read_data(bug72094_3.jpg): Process tag(x3030=UndefinedTa): Illegal format code 0x3030, suppose BYTE in %s%ebug72094.php on line %d",
          "50: Warning: exif_read_data(bug72094_3.jpg): Illegal IFD size in %s%ebug72094.php on line %d",
          "52: Warning: exif_read_data(bug72094_3.jpg): File structure corrupted in %s%ebug72094.php on line %d",
          "54: Warning: exif_read_data(bug72094_3.jpg): Invalid JPEG file in %s%ebug72094.php on line %d",
          "56: Warning: exif_read_data(bug72094_4.jpg): Invalid TIFF start (1) in %s%ebug72094.php on line %d",
          "58: Warning: exif_read_data(bug72094_4.jpg): File structure corrupted in %s%ebug72094.php on line %d",
          "61: DONE",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug71912.phpt||ext/gd/tests/bug71912.phpt": [
          "File: ext/gd/tests/bug71912.phpt -> ext/gd/tests/bug71912.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: ?>",
          "8: --FILE--",
          "9: <?php",
          "11: ?>",
          "12: OK",
          "13: --EXPECTF--",
          "",
          "[Removed Lines]",
          "10: imagecreatefromgd2(__DIR__.\"/invalid_neg_size.gd2\");",
          "15: Warning: imagecreatefromgd2(): '%s/invalid_neg_size.gd2' is not a valid GD2 file in %s/bug71912.php on line %d",
          "16: OK",
          "",
          "[Added Lines]",
          "10: imagecreatefromgd2(__DIR__ . DIRECTORY_SEPARATOR . \"invalid_neg_size.gd2\");",
          "16: OK",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d5747a70cf612e653b0e56dfa50efb29bbba273d",
      "candidate_info": {
        "commit_hash": "d5747a70cf612e653b0e56dfa50efb29bbba273d",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/d5747a70cf612e653b0e56dfa50efb29bbba273d",
        "files": [
          "NEWS",
          "configure.in",
          "main/php_version.h"
        ],
        "message": "PHP 5.5.37",
        "before_after_code_files": [
          "configure.in||configure.in",
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "120: PHP_MAJOR_VERSION=5",
          "121: PHP_MINOR_VERSION=5",
          "124: PHP_VERSION=\"$PHP_MAJOR_VERSION.$PHP_MINOR_VERSION.$PHP_RELEASE_VERSION$PHP_EXTRA_VERSION\"",
          "125: PHP_VERSION_ID=`expr [$]PHP_MAJOR_VERSION \\* 10000 + [$]PHP_MINOR_VERSION \\* 100 + [$]PHP_RELEASE_VERSION`",
          "",
          "[Removed Lines]",
          "122: PHP_RELEASE_VERSION=38",
          "123: PHP_EXTRA_VERSION=\"-dev\"",
          "",
          "[Added Lines]",
          "122: PHP_RELEASE_VERSION=37",
          "123: PHP_EXTRA_VERSION=\"\"",
          "",
          "---------------"
        ],
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 5",
          "",
          "[Removed Lines]",
          "5: #define PHP_RELEASE_VERSION 38",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "7: #define PHP_VERSION \"5.5.38-dev\"",
          "8: #define PHP_VERSION_ID 50538",
          "",
          "[Added Lines]",
          "5: #define PHP_RELEASE_VERSION 37",
          "6: #define PHP_EXTRA_VERSION \"\"",
          "7: #define PHP_VERSION \"5.5.37\"",
          "8: #define PHP_VERSION_ID 50537",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0c84740450814d0668c3dfba3d3a1c3cd6fabc4b",
      "candidate_info": {
        "commit_hash": "0c84740450814d0668c3dfba3d3a1c3cd6fabc4b",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/0c84740450814d0668c3dfba3d3a1c3cd6fabc4b",
        "files": [
          "NEWS",
          "configure.in",
          "main/php_version.h"
        ],
        "message": "5.5.37 now",
        "before_after_code_files": [
          "configure.in||configure.in",
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "120: PHP_MAJOR_VERSION=5",
          "121: PHP_MINOR_VERSION=5",
          "123: PHP_EXTRA_VERSION=\"-dev\"",
          "124: PHP_VERSION=\"$PHP_MAJOR_VERSION.$PHP_MINOR_VERSION.$PHP_RELEASE_VERSION$PHP_EXTRA_VERSION\"",
          "125: PHP_VERSION_ID=`expr [$]PHP_MAJOR_VERSION \\* 10000 + [$]PHP_MINOR_VERSION \\* 100 + [$]PHP_RELEASE_VERSION`",
          "",
          "[Removed Lines]",
          "122: PHP_RELEASE_VERSION=36",
          "",
          "[Added Lines]",
          "122: PHP_RELEASE_VERSION=37",
          "",
          "---------------"
        ],
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 5",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "",
          "[Removed Lines]",
          "5: #define PHP_RELEASE_VERSION 36",
          "7: #define PHP_VERSION \"5.5.36-dev\"",
          "8: #define PHP_VERSION_ID 50536",
          "",
          "[Added Lines]",
          "5: #define PHP_RELEASE_VERSION 37",
          "7: #define PHP_VERSION \"5.5.37-dev\"",
          "8: #define PHP_VERSION_ID 50537",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ed52bcb3dcb2e7dbc009ef8c6579fb1276ca73c1",
      "candidate_info": {
        "commit_hash": "ed52bcb3dcb2e7dbc009ef8c6579fb1276ca73c1",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/ed52bcb3dcb2e7dbc009ef8c6579fb1276ca73c1",
        "files": [
          "ext/bcmath/bcmath.c",
          "ext/bcmath/tests/bug72093.phpt"
        ],
        "message": "Fix bug #72093: bcpowmod accepts negative scale and corrupts _one_ definition\n\nWe can not modify result since it can be copy of _zero_ or _one_, etc. and\n\"copy\" in bcmath is just bumping the refcount.\n\nConflicts:\n\tmain/php_version.h",
        "before_after_code_files": [
          "ext/bcmath/bcmath.c||ext/bcmath/bcmath.c",
          "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/bcmath/bcmath.c||ext/bcmath/bcmath.c",
            "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt"
          ],
          "candidate": [
            "ext/bcmath/bcmath.c||ext/bcmath/bcmath.c",
            "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/bcmath/bcmath.c||ext/bcmath/bcmath.c": [
          "File: ext/bcmath/bcmath.c -> ext/bcmath/bcmath.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "201: }",
          "206: PHP_FUNCTION(bcadd)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "206: static bc_num split_bc_num(bc_num num) {",
          "207:  bc_num newnum;",
          "208:  if (num->n_refs >= 1) {",
          "209:   return num;",
          "210:  }",
          "211:  newnum = _bc_new_num_ex(0, 0, 0);",
          "213:  newnum->n_refs = 1;",
          "214:  num->n_refs--;",
          "215:  return newnum;",
          "216: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "225:  php_str2num(&first, left TSRMLS_CC);",
          "226:  php_str2num(&second, right TSRMLS_CC);",
          "227:  bc_add (first, second, &result, scale);",
          "229:  if (result->n_scale > scale) {",
          "230:   result->n_scale = scale;",
          "231:  }",
          "233:  Z_STRVAL_P(return_value) = bc_num2str(result);",
          "234:  Z_STRLEN_P(return_value) = strlen(Z_STRVAL_P(return_value));",
          "235:  Z_TYPE_P(return_value) = IS_STRING;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "245:   result = split_bc_num(result);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "266:  bc_sub (first, second, &result, scale);",
          "268:  if (result->n_scale > scale) {",
          "269:   result->n_scale = scale;",
          "270:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "285:   result = split_bc_num(result);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "305:  bc_multiply (first, second, &result, scale TSRMLS_CC);",
          "307:  if (result->n_scale > scale) {",
          "308:   result->n_scale = scale;",
          "309:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "325:   result = split_bc_num(result);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "345:  switch (bc_divide(first, second, &result, scale TSRMLS_CC)) {",
          "347:    if (result->n_scale > scale) {",
          "348:     result->n_scale = scale;",
          "349:    }",
          "350:    Z_STRVAL_P(return_value) = bc_num2str(result);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "366:     result = split_bc_num(result);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "424:  scale_int = (int) ((int)scale < 0) ? 0 : scale;",
          "426:  if (bc_raisemod(first, second, mod, &result, scale_int TSRMLS_CC) != -1) {",
          "429:   }",
          "430:   Z_STRVAL_P(return_value) = bc_num2str(result);",
          "431:   Z_STRLEN_P(return_value) = strlen(Z_STRVAL_P(return_value));",
          "",
          "[Removed Lines]",
          "427:   if (result->n_scale > scale) {",
          "428:    result->n_scale = scale;",
          "",
          "[Added Lines]",
          "446:   if (result->n_scale > scale_int) {",
          "447:    result = split_bc_num(result);",
          "448:    result->n_scale = scale_int;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "468:  bc_raise (first, second, &result, scale TSRMLS_CC);",
          "470:  if (result->n_scale > scale) {",
          "471:   result->n_scale = scale;",
          "472:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "491:   result = split_bc_num(result);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "494:  if (zend_parse_parameters(argc TSRMLS_CC, \"s|l\", &left, &left_len, &scale_param) == FAILURE) {",
          "495:   return;",
          "496:  }",
          "498:  if (argc == 2) {",
          "499:   scale = (int) ((int)scale_param < 0) ? 0 : scale_param;",
          "500:  }",
          "502:  bc_init_num(&result TSRMLS_CC);",
          "503:  php_str2num(&result, left TSRMLS_CC);",
          "505:  if (bc_sqrt (&result, scale TSRMLS_CC) != 0) {",
          "506:   if (result->n_scale > scale) {",
          "507:    result->n_scale = scale;",
          "508:   }",
          "509:   Z_STRVAL_P(return_value) = bc_num2str(result);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "528:    result = split_bc_num(result);",
          "",
          "---------------"
        ],
        "ext/bcmath/tests/bug72093.phpt||ext/bcmath/tests/bug72093.phpt": [
          "File: ext/bcmath/tests/bug72093.phpt -> ext/bcmath/tests/bug72093.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug 72093: bcpowmod accepts negative scale and corrupts _one_ definition",
          "3: --SKIPIF--",
          "4: <?php if(!extension_loaded(\"bcmath\")) print \"skip\"; ?>",
          "5: --FILE--",
          "6: <?php",
          "7: var_dump(bcpowmod(1, \"A\", 128, -200));",
          "8: var_dump(bcpowmod(1, 1.2, 1, 1));",
          "9: ?>",
          "10: --EXPECTF--",
          "11: string(1) \"1\"",
          "12: bc math warning: non-zero scale in exponent",
          "13: string(3) \"0.0\"",
          "",
          "---------------"
        ]
      }
    }
  ]
}