{
  "cve_id": "CVE-2021-29562",
  "cve_desc": "TensorFlow is an end-to-end open source platform for machine learning. An attacker can cause a denial of service by exploiting a `CHECK`-failure coming from the implementation of `tf.raw_ops.IRFFT`. The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "1c56f53be0b722ca657cbc7df461ed676c8642a2",
  "patch_info": {
    "commit_hash": "1c56f53be0b722ca657cbc7df461ed676c8642a2",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/1c56f53be0b722ca657cbc7df461ed676c8642a2",
    "files": [
      "tensorflow/core/kernels/fft_ops.cc"
    ],
    "message": "Fix a check fail in Fast Fourier implementation\n\nPiperOrigin-RevId: 372026629\nChange-Id: Id05c3362aa575271bc3e06b16316c9037085fc11",
    "before_after_code_files": [
      "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc": [
      "File: tensorflow/core/kernels/fft_ops.cc -> tensorflow/core/kernels/fft_ops.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "13: limitations under the License.",
      "16: #define EIGEN_USE_THREADS",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "16: #include \"tensorflow/core/platform/errors.h\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "261:           i == FFTRank ? fft_shape[i - 1] / 2 + 1 : fft_shape[i - 1];",
      "262:       full_fft_shape.AddDim(fft_shape[i - 1]);",
      "263:     }",
      "265:     Tensor temp;",
      "266:     OP_REQUIRES_OK(ctx, ctx->allocate_temp(DataTypeToEnum<ComplexT>::v(),",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "265:     OP_REQUIRES(ctx, full_fft_shape.num_elements() > 0,",
      "266:                 errors::InvalidArgument(\"Obtained a FFT shape of 0 elements: \",",
      "267:                                         full_fft_shape.DebugString()));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d46389df3e8a7fb996789eca6d677c14b18ca97d",
      "candidate_info": {
        "commit_hash": "d46389df3e8a7fb996789eca6d677c14b18ca97d",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/d46389df3e8a7fb996789eca6d677c14b18ca97d",
        "files": [
          "tensorflow/core/kernels/fft_ops.cc"
        ],
        "message": "Fix a check fail in Fast Fourier implementation\n\nPiperOrigin-RevId: 372026629\nChange-Id: Id05c3362aa575271bc3e06b16316c9037085fc11",
        "before_after_code_files": [
          "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc": [
          "File: tensorflow/core/kernels/fft_ops.cc -> tensorflow/core/kernels/fft_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: limitations under the License.",
          "16: #define EIGEN_USE_THREADS",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16: #include \"tensorflow/core/platform/errors.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "261:           i == FFTRank ? fft_shape[i - 1] / 2 + 1 : fft_shape[i - 1];",
          "262:       full_fft_shape.AddDim(fft_shape[i - 1]);",
          "263:     }",
          "265:     Tensor temp;",
          "266:     OP_REQUIRES_OK(ctx, ctx->allocate_temp(DataTypeToEnum<ComplexT>::v(),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "265:     OP_REQUIRES(ctx, full_fft_shape.num_elements() > 0,",
          "266:                 errors::InvalidArgument(\"Obtained a FFT shape of 0 elements: \",",
          "267:                                         full_fft_shape.DebugString()));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "723587ceeb11e65bf62c767336830021574c05bd",
      "candidate_info": {
        "commit_hash": "723587ceeb11e65bf62c767336830021574c05bd",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/723587ceeb11e65bf62c767336830021574c05bd",
        "files": [
          "tensorflow/core/kernels/fft_ops.cc"
        ],
        "message": "Fix a check fail in Fast Fourier implementation\n\nPiperOrigin-RevId: 372026629\nChange-Id: Id05c3362aa575271bc3e06b16316c9037085fc11",
        "before_after_code_files": [
          "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc": [
          "File: tensorflow/core/kernels/fft_ops.cc -> tensorflow/core/kernels/fft_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: limitations under the License.",
          "16: #define EIGEN_USE_THREADS",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16: #include \"tensorflow/core/platform/errors.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "261:           i == FFTRank ? fft_shape[i - 1] / 2 + 1 : fft_shape[i - 1];",
          "262:       full_fft_shape.AddDim(fft_shape[i - 1]);",
          "263:     }",
          "265:     Tensor temp;",
          "266:     OP_REQUIRES_OK(ctx, ctx->allocate_temp(DataTypeToEnum<ComplexT>::v(),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "265:     OP_REQUIRES(ctx, full_fft_shape.num_elements() > 0,",
          "266:                 errors::InvalidArgument(\"Obtained a FFT shape of 0 elements: \",",
          "267:                                         full_fft_shape.DebugString()));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b23fa81f4b3c2cc9afa035ff7cea891c0641b022",
      "candidate_info": {
        "commit_hash": "b23fa81f4b3c2cc9afa035ff7cea891c0641b022",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/b23fa81f4b3c2cc9afa035ff7cea891c0641b022",
        "files": [
          "tensorflow/core/kernels/fft_ops.cc"
        ],
        "message": "Fix a check fail in Fast Fourier implementation\n\nPiperOrigin-RevId: 372026629\nChange-Id: Id05c3362aa575271bc3e06b16316c9037085fc11",
        "before_after_code_files": [
          "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc": [
          "File: tensorflow/core/kernels/fft_ops.cc -> tensorflow/core/kernels/fft_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: limitations under the License.",
          "16: #define EIGEN_USE_THREADS",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16: #include \"tensorflow/core/platform/errors.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "261:           i == FFTRank ? fft_shape[i - 1] / 2 + 1 : fft_shape[i - 1];",
          "262:       full_fft_shape.AddDim(fft_shape[i - 1]);",
          "263:     }",
          "265:     Tensor temp;",
          "266:     OP_REQUIRES_OK(ctx, ctx->allocate_temp(DataTypeToEnum<ComplexT>::v(),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "265:     OP_REQUIRES(ctx, full_fft_shape.num_elements() > 0,",
          "266:                 errors::InvalidArgument(\"Obtained a FFT shape of 0 elements: \",",
          "267:                                         full_fft_shape.DebugString()));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cfe7b69ba67272d54ec3d7b6fbd264a16cef6f00",
      "candidate_info": {
        "commit_hash": "cfe7b69ba67272d54ec3d7b6fbd264a16cef6f00",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/cfe7b69ba67272d54ec3d7b6fbd264a16cef6f00",
        "files": [
          "tensorflow/core/kernels/fft_ops.cc"
        ],
        "message": "Fix a check fail in Fast Fourier implementation\n\nPiperOrigin-RevId: 372026629\nChange-Id: Id05c3362aa575271bc3e06b16316c9037085fc11",
        "before_after_code_files": [
          "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc": [
          "File: tensorflow/core/kernels/fft_ops.cc -> tensorflow/core/kernels/fft_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: limitations under the License.",
          "16: #define EIGEN_USE_THREADS",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16: #include \"tensorflow/core/platform/errors.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "261:           i == FFTRank ? fft_shape[i - 1] / 2 + 1 : fft_shape[i - 1];",
          "262:       full_fft_shape.AddDim(fft_shape[i - 1]);",
          "263:     }",
          "265:     Tensor temp;",
          "266:     OP_REQUIRES_OK(ctx, ctx->allocate_temp(DataTypeToEnum<ComplexT>::v(),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "265:     OP_REQUIRES(ctx, full_fft_shape.num_elements() > 0,",
          "266:                 errors::InvalidArgument(\"Obtained a FFT shape of 0 elements: \",",
          "267:                                         full_fft_shape.DebugString()));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "212110d36e887f3f50089cfe8143ff0e53ec6de5",
      "candidate_info": {
        "commit_hash": "212110d36e887f3f50089cfe8143ff0e53ec6de5",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/212110d36e887f3f50089cfe8143ff0e53ec6de5",
        "files": [
          "tensorflow/core/kernels/fft_ops.cc"
        ],
        "message": "Fix a check fail in Fast Fourier implementation\n\nPiperOrigin-RevId: 372026629\nChange-Id: Id05c3362aa575271bc3e06b16316c9037085fc11",
        "before_after_code_files": [
          "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/fft_ops.cc||tensorflow/core/kernels/fft_ops.cc": [
          "File: tensorflow/core/kernels/fft_ops.cc -> tensorflow/core/kernels/fft_ops.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: limitations under the License.",
          "16: #define EIGEN_USE_THREADS",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16: #include \"tensorflow/core/platform/errors.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "261:           i == FFTRank ? fft_shape[i - 1] / 2 + 1 : fft_shape[i - 1];",
          "262:       full_fft_shape.AddDim(fft_shape[i - 1]);",
          "263:     }",
          "265:     Tensor temp;",
          "266:     OP_REQUIRES_OK(ctx, ctx->allocate_temp(DataTypeToEnum<ComplexT>::v(),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "265:     OP_REQUIRES(ctx, full_fft_shape.num_elements() > 0,",
          "266:                 errors::InvalidArgument(\"Obtained a FFT shape of 0 elements: \",",
          "267:                                         full_fft_shape.DebugString()));",
          "",
          "---------------"
        ]
      }
    }
  ]
}