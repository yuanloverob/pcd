{
  "cve_id": "CVE-2019-19317",
  "cve_desc": "lookupName in resolve.c in SQLite 3.30.1 omits bits from the colUsed bitmask in the case of a generated column, which allows attackers to cause a denial of service or possibly have unspecified other impact.",
  "repo": "sqlite/sqlite",
  "patch_hash": "522ebfa7cee96fb325a22ea3a2464a63485886a8",
  "patch_info": {
    "commit_hash": "522ebfa7cee96fb325a22ea3a2464a63485886a8",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/522ebfa7cee96fb325a22ea3a2464a63485886a8",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/resolve.c",
      "test/gencol1.test"
    ],
    "message": "Whenever a generated column is used, assume that all columns are used.\n\nFossilOrigin-Name: 6601da58032d18ae00b466c0f2077fb2b1ecd84225b56e1787724bea478eedc9",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/resolve.c||src/resolve.c",
      "test/gencol1.test||test/gencol1.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 8b12e95fec7ce6e0de82a04ca3dfcf1a8e62e233b7382aa28a8a9be6e862b1af",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/resolve.c||src/resolve.c": [
      "File: src/resolve.c -> src/resolve.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "561:     if( n>=BMS ){",
      "562:       n = BMS-1;",
      "563:     }",
      "564:     assert( pMatch->iCursor==pExpr->iTable );",
      "565:     pMatch->colUsed |= ((Bitmask)1)<<n;",
      "566:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "573:     assert( pExpr->y.pTab!=0 );",
      "575:     if( pExpr->y.pTab->tabFlags & TF_HasGenerated ){",
      "576:       Column *pCol = pExpr->y.pTab->aCol + pExpr->iColumn;",
      "577:       if( pCol->colFlags & COLFLAG_GENERATED ) n = BMS-1;",
      "578:     }",
      "",
      "---------------"
    ],
    "test/gencol1.test||test/gencol1.test": [
      "File: test/gencol1.test -> test/gencol1.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "246: # 2019-11-21 Problems in the new generated column logic",
      "247: # reported by Yongheng Chen and Rui Zhong",
      "248: do_execsql_test gencol1-9.10 {",
      "251:   CREATE TABLE t1(aa , bb AS (17) UNIQUE);",
      "252:   INSERT INTO t1 VALUES(17);",
      "253:   CREATE TABLE t2(cc);",
      "254:   INSERT INTO t2 VALUES(41);",
      "255:   SELECT * FROM t2 JOIN t1 WHERE t1.bb=t1.aa AND t1.bb=17;",
      "256: } {41 17 17}",
      "259: finish_test",
      "",
      "[Removed Lines]",
      "249:   DROP TABLE IF EXISTS t1;",
      "250:   DROP TABLE IF EXISTS t2;",
      "",
      "[Added Lines]",
      "249:   DROP TABLE t1;",
      "256: do_execsql_test gencol1-9.20 {",
      "257:   CREATE TABLE t3(aa INT PRIMARY KEY, bb UNIQUE AS(aa));",
      "258:   INSERT INTO t3 VALUES(1);",
      "259:   SELECT 100, * FROM t3;",
      "260:   DELETE FROM t3 WHERE (SELECT bb FROM t3);",
      "261:   SELECT 200, * FROM t3;",
      "262: } {100 1 1}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "66373329881e0474de08707dcf07808672f1da02",
      "candidate_info": {
        "commit_hash": "66373329881e0474de08707dcf07808672f1da02",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/66373329881e0474de08707dcf07808672f1da02",
        "files": [
          "ext/fts3/fts3.c",
          "ext/fts3/fts3Int.h",
          "ext/fts5/fts5_main.c",
          "ext/fts5/test/fts5content.test",
          "manifest",
          "manifest.uuid",
          "test/fts4content.test"
        ],
        "message": "Prevent direct and indirect recursive content= options in fts3/4 and fts5.\n\nFossilOrigin-Name: 2eb997327c2c369c10b7835be80112d77cb2a7cfa9fe4d564042984c21d94698",
        "before_after_code_files": [
          "ext/fts3/fts3.c||ext/fts3/fts3.c",
          "ext/fts3/fts3Int.h||ext/fts3/fts3Int.h",
          "ext/fts5/fts5_main.c||ext/fts5/fts5_main.c",
          "ext/fts5/test/fts5content.test||ext/fts5/test/fts5content.test",
          "manifest.uuid||manifest.uuid",
          "test/fts4content.test||test/fts4content.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/fts3/fts3.c||ext/fts3/fts3.c": [
          "File: ext/fts3/fts3.c -> ext/fts3/fts3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1612:   int iIdx;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1614:   if( p->bLock ){",
          "1615:     return SQLITE_ERROR;",
          "1616:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1809:     }else{",
          "1810:       zSql = sqlite3_mprintf(\"SELECT %s WHERE rowid = ?\", p->zReadExprlist);",
          "1811:       if( !zSql ) return SQLITE_NOMEM;",
          "1813:       sqlite3_free(zSql);",
          "1814:     }",
          "1815:     if( rc==SQLITE_OK ) pCsr->bSeekStmt = 1;",
          "",
          "[Removed Lines]",
          "1812:       rc = sqlite3_prepare_v3(p->db, zSql,-1,SQLITE_PREPARE_PERSISTENT,&pCsr->pStmt,0);",
          "",
          "[Added Lines]",
          "1816:       p->bLock++;",
          "1817:       rc = sqlite3_prepare_v3(",
          "1818:           p->db, zSql,-1,SQLITE_PREPARE_PERSISTENT,&pCsr->pStmt,0",
          "1819:       );",
          "1820:       p->bLock--;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1827:   if( pCsr->isRequireSeek ){",
          "1828:     rc = fts3CursorSeekStmt(pCsr);",
          "1829:     if( rc==SQLITE_OK ){",
          "1830:       sqlite3_bind_int64(pCsr->pStmt, 1, pCsr->iPrevId);",
          "1831:       pCsr->isRequireSeek = 0;",
          "1832:       if( SQLITE_ROW==sqlite3_step(pCsr->pStmt) ){",
          "1833:         return SQLITE_OK;",
          "1834:       }else{",
          "1835:         rc = sqlite3_reset(pCsr->pStmt);",
          "1836:         if( rc==SQLITE_OK && ((Fts3Table *)pCsr->base.pVtab)->zContentTbl==0 ){",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1838:       Fts3Table *pTab = (Fts3Table*)pCsr->base.pVtab;",
          "1839:       pTab->bLock++;",
          "1843:         pTab->bLock--;",
          "1846:         pTab->bLock--;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3218:   int rc;",
          "3219:   Fts3Cursor *pCsr = (Fts3Cursor *)pCursor;",
          "3220:   if( pCsr->eSearch==FTS3_DOCID_SEARCH || pCsr->eSearch==FTS3_FULLSCAN_SEARCH ){",
          "3221:     if( SQLITE_ROW!=sqlite3_step(pCsr->pStmt) ){",
          "3222:       pCsr->isEof = 1;",
          "3223:       rc = sqlite3_reset(pCsr->pStmt);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3233:     Fts3Table *pTab = (Fts3Table*)pCursor->pVtab;",
          "3234:     pTab->bLock++;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "3225:       pCsr->iPrevId = sqlite3_column_int64(pCsr->pStmt, 0);",
          "3226:       rc = SQLITE_OK;",
          "3227:     }",
          "3228:   }else{",
          "3229:     rc = fts3EvalNext((Fts3Cursor *)pCursor);",
          "3230:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3242:     pTab->bLock--;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "3285:   UNUSED_PARAMETER(idxStr);",
          "3286:   UNUSED_PARAMETER(nVal);",
          "3288:   eSearch = (idxNum & 0x0000FFFF);",
          "3289:   assert( eSearch>=0 && eSearch<=(FTS3_FULLTEXT_SEARCH+p->nColumn) );",
          "3290:   assert( p->pSegments==0 );",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3303:   if( p->bLock ){",
          "3304:     return SQLITE_ERROR;",
          "3305:   }",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "3356:       );",
          "3357:     }",
          "3358:     if( zSql ){",
          "3360:       sqlite3_free(zSql);",
          "3361:     }else{",
          "3362:       rc = SQLITE_NOMEM;",
          "",
          "[Removed Lines]",
          "3359:       rc = sqlite3_prepare_v3(p->db,zSql,-1,SQLITE_PREPARE_PERSISTENT,&pCsr->pStmt,0);",
          "",
          "[Added Lines]",
          "3378:       p->bLock++;",
          "3379:       rc = sqlite3_prepare_v3(",
          "3380:           p->db,zSql,-1,SQLITE_PREPARE_PERSISTENT,&pCsr->pStmt,0",
          "3381:       );",
          "3382:       p->bLock--;",
          "",
          "---------------"
        ],
        "ext/fts3/fts3Int.h||ext/fts3/fts3Int.h": [
          "File: ext/fts3/fts3Int.h -> ext/fts3/fts3Int.h"
        ],
        "ext/fts5/fts5_main.c||ext/fts5/fts5_main.c": [
          "File: ext/fts5/fts5_main.c -> ext/fts5/fts5_main.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "895:         break;",
          "896:       }",
          "899:         rc = sqlite3_step(pCsr->pStmt);",
          "900:         if( rc!=SQLITE_ROW ){",
          "901:           CsrFlagSet(pCsr, FTS5CSR_EOF);",
          "902:           rc = sqlite3_reset(pCsr->pStmt);",
          "903:         }else{",
          "904:           rc = SQLITE_OK;",
          "905:         }",
          "906:         break;",
          "907:     }",
          "908:   }",
          "",
          "[Removed Lines]",
          "898:       default:",
          "",
          "[Added Lines]",
          "898:       default: {",
          "899:         Fts5Config *pConfig = ((Fts5Table*)pCursor->pVtab)->pConfig;",
          "900:         pConfig->bLock++;",
          "902:         pConfig->bLock--;",
          "906:           if( rc!=SQLITE_OK ){",
          "907:             pCursor->pVtab->zErrMsg = sqlite3_mprintf(",
          "908:                 \"%s\", sqlite3_errmsg(pConfig->db)",
          "909:             );",
          "910:           }",
          "915:       }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1188:   int iIdxStr = 0;",
          "1189:   Fts5Expr *pExpr = 0;",
          "1191:   if( pCsr->ePlan ){",
          "1192:     fts5FreeCursorComponents(pCsr);",
          "1193:     memset(&pCsr->ePlan, 0, sizeof(Fts5Cursor) - ((u8*)&pCsr->ePlan-(u8*)pCsr));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1200:   if( pConfig->bLock ){",
          "1201:     pTab->p.base.zErrMsg = sqlite3_mprintf(",
          "1202:         \"recursively defined fts5 content table\"",
          "1203:     );",
          "1204:     return SQLITE_ERROR;",
          "1205:   }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1408:   }",
          "1410:   if( rc==SQLITE_OK && CsrFlagTest(pCsr, FTS5CSR_REQUIRE_CONTENT) ){",
          "1411:     assert( pCsr->pExpr );",
          "1412:     sqlite3_reset(pCsr->pStmt);",
          "1413:     sqlite3_bind_int64(pCsr->pStmt, 1, fts5CursorRowid(pCsr));",
          "1414:     rc = sqlite3_step(pCsr->pStmt);",
          "1415:     if( rc==SQLITE_ROW ){",
          "1416:       rc = SQLITE_OK;",
          "1417:       CsrFlagClear(pCsr, FTS5CSR_REQUIRE_CONTENT);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1427:     Fts5Table *pTab = (Fts5Table*)(pCsr->base.pVtab);",
          "1431:     pTab->pConfig->bLock++;",
          "1433:     pTab->pConfig->bLock--;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1419:       rc = sqlite3_reset(pCsr->pStmt);",
          "1420:       if( rc==SQLITE_OK ){",
          "1421:         rc = FTS5_CORRUPT;",
          "1422:       }",
          "1423:     }",
          "1424:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1441:       }else{",
          "1442:         pTab->base.zErrMsg = sqlite3_mprintf(",
          "1443:             \"%s\", sqlite3_errmsg(pTab->pConfig->db)",
          "1444:         );",
          "",
          "---------------"
        ],
        "ext/fts5/test/fts5content.test||ext/fts5/test/fts5content.test": [
          "File: ext/fts5/test/fts5content.test -> ext/fts5/test/fts5content.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "257: # Check that an fts5 table cannot be its own content table.",
          "258: #",
          "259: reset_db",
          "261:   CREATE VIRTUAL TABLE t1 USING fts5(a, c=t1 );",
          "262:   INSERT INTO t1( a ) VALUES('abc');",
          "263: }",
          "265:   SELECT * FROM t1;",
          "266: } {1 {recursively defined fts5 content table}}",
          "268:   SELECT * FROM t1('abc');",
          "269: } {1 {recursively defined fts5 content table}}",
          "271: finish_test",
          "",
          "[Removed Lines]",
          "260: do_execsql_test 7.1 {",
          "264: do_catchsql_test 7.2 {",
          "267: do_catchsql_test 7.3 {",
          "",
          "[Added Lines]",
          "260: do_execsql_test 7.1.1 {",
          "264: do_catchsql_test 7.1.2 {",
          "267: do_catchsql_test 7.1.3 {",
          "270: do_catchsql_test 7.1.4 {",
          "271:   SELECT count(*) FROM t1;",
          "272: } {1 {recursively defined fts5 content table}}",
          "273: do_catchsql_test 7.1.5 {",
          "274:   SELECT * FROM t1('abc') ORDER BY rank;",
          "275: } {1 {recursively defined fts5 content table}}",
          "277: reset_db",
          "278: do_execsql_test 7.2.1 {",
          "279:   CREATE VIRTUAL TABLE t1 USING fts5(a, c=t2 );",
          "280:   CREATE VIRTUAL TABLE t2 USING fts5(a, c=t1 );",
          "281:   INSERT INTO t1( a ) VALUES('abc');",
          "282: }",
          "283: do_catchsql_test 7.2.2 {",
          "284:   SELECT * FROM t1;",
          "285: } {1 {recursively defined fts5 content table}}",
          "286: do_catchsql_test 7.2.3 {",
          "287:   SELECT * FROM t1('abc');",
          "288: } {1 {recursively defined fts5 content table}}",
          "289: do_catchsql_test 7.2.4 {",
          "290:   SELECT count(*) FROM t1;",
          "291: } {1 {recursively defined fts5 content table}}",
          "292: do_catchsql_test 7.2.5 {",
          "293:   SELECT * FROM t1('abc') ORDER BY rank;",
          "294: } {1 {recursively defined fts5 content table}}",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 0d1055a5da8274a59f35170b1f9469597ce4c5a4c5e851a1b81d3be2ccd32871",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/fts4content.test||test/fts4content.test": [
          "File: test/fts4content.test -> test/fts4content.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "634:   CREATE VIRTUAL TABLE x1 USING fts4(content=x1);",
          "635: } {1 {vtable constructor called recursively: x1}}",
          "638: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "637: #---------------------------------------------------------------------------",
          "638: # Check that an fts4 table cannot be its own content table.",
          "639: #",
          "640: reset_db",
          "641: breakpoint",
          "642: do_execsql_test 12.1.1 {",
          "643:   CREATE VIRTUAL TABLE t1 USING fts4(a, content=t1 );",
          "644:   INSERT INTO t1(rowid, a) VALUES(1, 'abc');",
          "645: }",
          "646: do_catchsql_test 12.1.2 {",
          "647:   SELECT * FROM t1;",
          "648: } {1 {SQL logic error}}",
          "649: do_catchsql_test 12.1.3 {",
          "650:   SELECT * FROM t1('abc');",
          "651: } {1 {SQL logic error}}",
          "652: do_catchsql_test 12.1.4 {",
          "653:   SELECT count(*) FROM t1;",
          "654: } {1 {SQL logic error}}",
          "656: reset_db",
          "657: do_execsql_test 12.2.1 {",
          "658:   CREATE VIRTUAL TABLE t1 USING fts4(a, content=t2 );",
          "659:   CREATE VIRTUAL TABLE t2 USING fts4(a, content=t1 );",
          "660:   INSERT INTO t1(rowid, a) VALUES(1, 'abc');",
          "661: }",
          "662: do_catchsql_test 12.2.2 {",
          "663:   SELECT * FROM t1;",
          "664: } {1 {SQL logic error}}",
          "665: do_catchsql_test 12.2.3 {",
          "666:   SELECT * FROM t1('abc');",
          "667: } {1 {SQL logic error}}",
          "668: do_catchsql_test 12.2.4 {",
          "669:   SELECT count(*) FROM t1;",
          "670: } {1 {SQL logic error}}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9c9c70920bae0ccd6216ea7fa61f387fdeb0b6ae",
      "candidate_info": {
        "commit_hash": "9c9c70920bae0ccd6216ea7fa61f387fdeb0b6ae",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/9c9c70920bae0ccd6216ea7fa61f387fdeb0b6ae",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/test_vfs.c"
        ],
        "message": "Fix a recently introduced memory leak in the test code in test_vfs.c.\n\nFossilOrigin-Name: 2d53a30cc23e53033af8e8666457654db5dcc453ed6cd176ce1d0bff4f528159",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/test_vfs.c||src/test_vfs.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 2eb997327c2c369c10b7835be80112d77cb2a7cfa9fe4d564042984c21d94698",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/test_vfs.c||src/test_vfs.c": [
          "File: src/test_vfs.c -> src/test_vfs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1392:   if( p->pScript ) Tcl_DecrRefCount(p->pScript);",
          "1393:   sqlite3_vfs_unregister(p->pVfs);",
          "1394:   memset(p->pVfs, 0, sizeof(sqlite3_vfs));",
          "1396:   ckfree((char *)p->pVfs);",
          "1397:   ckfree((char *)p);",
          "1398: }",
          "",
          "[Removed Lines]",
          "1395:   memset(p, 0, sizeof(Testvfs));",
          "",
          "[Added Lines]",
          "1396:   memset(p, 0, sizeof(Testvfs));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "57f7ece78410a8aae86aa4625fb7556897db384c",
      "candidate_info": {
        "commit_hash": "57f7ece78410a8aae86aa4625fb7556897db384c",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/57f7ece78410a8aae86aa4625fb7556897db384c",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/expr.c",
          "src/wherecode.c",
          "test/gencol1.test"
        ],
        "message": "Fix a problem that comes up when using generated columns that evaluate to a constant in an index and then making use of that index in a join.\n\nFossilOrigin-Name: 8b12e95fec7ce6e0de82a04ca3dfcf1a8e62e233b7382aa28a8a9be6e862b1af",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/expr.c||src/expr.c",
          "src/wherecode.c||src/wherecode.c",
          "test/gencol1.test||test/gencol1.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid",
            "test/gencol1.test||test/gencol1.test"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid",
            "test/gencol1.test||test/gencol1.test"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 2d53a30cc23e53033af8e8666457654db5dcc453ed6cd176ce1d0bff4f528159",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/expr.c||src/expr.c": [
          "File: src/expr.c -> src/expr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3607:         int iReg = sqlite3ExprCodeTarget(pParse, pExpr->pLeft,target);",
          "3609:         if( aff>SQLITE_AFF_BLOB ){",
          "3610:           static const char zAff[] = \"B\\000C\\000D\\000E\";",
          "3611:           assert( SQLITE_AFF_BLOB=='A' );",
          "",
          "[Removed Lines]",
          "3608:         int aff = sqlite3TableColumnAffinity(pExpr->y.pTab, pExpr->iColumn);",
          "",
          "[Added Lines]",
          "3608:         int aff;",
          "3609:         if( pExpr->y.pTab ){",
          "3610:           aff = sqlite3TableColumnAffinity(pExpr->y.pTab, pExpr->iColumn);",
          "3611:         }else{",
          "3612:           aff = pExpr->affExpr;",
          "3613:         }",
          "",
          "---------------"
        ],
        "src/wherecode.c||src/wherecode.c": [
          "File: src/wherecode.c -> src/wherecode.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1141:   if( pExpr->op==TK_COLUMN ){",
          "1142:     IdxExprTrans *pX = p->u.pIdxTrans;",
          "1143:     if( pExpr->iTable==pX->iTabCur && pExpr->iColumn==pX->iTabCol ){",
          "1144:       pExpr->iTable = pX->iIdxCur;",
          "1145:       pExpr->iColumn = pX->iIdxCol;",
          "1146:       pExpr->y.pTab = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1144:       assert( pExpr->y.pTab!=0 );",
          "1145:       pExpr->affExpr = sqlite3TableColumnAffinity(pExpr->y.pTab,pExpr->iColumn);",
          "",
          "---------------"
        ],
        "test/gencol1.test||test/gencol1.test": [
          "File: test/gencol1.test -> test/gencol1.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "243:   UPDATE t0 SET c0 = NULL;",
          "244: } {1 {generated column loop on \"c2\"}}",
          "247: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "246: # 2019-11-21 Problems in the new generated column logic",
          "247: # reported by Yongheng Chen and Rui Zhong",
          "248: do_execsql_test gencol1-9.10 {",
          "249:   DROP TABLE IF EXISTS t1;",
          "250:   DROP TABLE IF EXISTS t2;",
          "251:   CREATE TABLE t1(aa , bb AS (17) UNIQUE);",
          "252:   INSERT INTO t1 VALUES(17);",
          "253:   CREATE TABLE t2(cc);",
          "254:   INSERT INTO t2 VALUES(41);",
          "255:   SELECT * FROM t2 JOIN t1 WHERE t1.bb=t1.aa AND t1.bb=17;",
          "256: } {41 17 17}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "83420823af71c148073a042c6a5452fac28c6369",
      "candidate_info": {
        "commit_hash": "83420823af71c148073a042c6a5452fac28c6369",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/83420823af71c148073a042c6a5452fac28c6369",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/test_vfs.c",
          "test/walvfs.test"
        ],
        "message": "Fix a use-after-free problem in the test suite. No changes to production code.\n\nFossilOrigin-Name: 0d1055a5da8274a59f35170b1f9469597ce4c5a4c5e851a1b81d3be2ccd32871",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/test_vfs.c||src/test_vfs.c",
          "test/walvfs.test||test/walvfs.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: a0f6d526baecd061a5e2bec5eb698fb5dfb10122ac79c853d7b3f4a48bc9f49b",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/test_vfs.c||src/test_vfs.c": [
          "File: src/test_vfs.c -> src/test_vfs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1391:   Testvfs *p = (Testvfs *)cd;",
          "1392:   if( p->pScript ) Tcl_DecrRefCount(p->pScript);",
          "1393:   sqlite3_vfs_unregister(p->pVfs);",
          "1394:   ckfree((char *)p->pVfs);",
          "1395:   ckfree((char *)p);",
          "1396: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1394:   memset(p->pVfs, 0, sizeof(sqlite3_vfs));",
          "1395:   memset(p, 0, sizeof(Testvfs));",
          "",
          "---------------"
        ],
        "test/walvfs.test||test/walvfs.test": [
          "File: test/walvfs.test -> test/walvfs.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "387:   PRAGMA wal_checkpoint;",
          "388:   SELECT count(*) FROM t1",
          "389: } {0 5 5 21}",
          "390: tvfs2 delete",
          "392: #-------------------------------------------------------------------------",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "390: db close",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "594b124f216641e7d6df059cca84c45d4f0ab393",
      "candidate_info": {
        "commit_hash": "594b124f216641e7d6df059cca84c45d4f0ab393",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/594b124f216641e7d6df059cca84c45d4f0ab393",
        "files": [
          "ext/misc/sha1.c",
          "manifest",
          "manifest.uuid",
          "src/hwtime.h",
          "tool/dbhash.c"
        ],
        "message": "Changes to extensions and test logic so that the build works with gcc and with -std=iso9899:1999\n\nFossilOrigin-Name: 2575a68c3965e72f2ab211d933012442755afe6a9b7de9e9e50cdd2155fd1ec8",
        "before_after_code_files": [
          "ext/misc/sha1.c||ext/misc/sha1.c",
          "manifest.uuid||manifest.uuid",
          "src/hwtime.h||src/hwtime.h",
          "tool/dbhash.c||tool/dbhash.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/misc/sha1.c||ext/misc/sha1.c": [
          "File: ext/misc/sha1.c -> ext/misc/sha1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "39:   unsigned char buffer[64];",
          "40: };",
          "56: #define SHA_ROT(x,l,r) ((x) << (l) | (x) >> (r))",
          "57: #define rol(x,k) SHA_ROT(x,k,32-(k))",
          "58: #define ror(x,k) SHA_ROT(x,32-(k),k)",
          "62: #define blk0le(i) (block[i] = (ror(block[i],8)&0xFF00FF00) \\",
          "63:     |(rol(block[i],8)&0x00FF00FF))",
          "",
          "[Removed Lines]",
          "43: #if __GNUC__ && (defined(__i386__) || defined(__x86_64__))",
          "49: #define SHA_ROT(op, x, k) \\",
          "50:         ({ unsigned int y; asm(op \" %1,%0\" : \"=r\" (y) : \"I\" (k), \"0\" (x)); y; })",
          "51: #define rol(x,k) SHA_ROT(\"roll\", x, k)",
          "52: #define ror(x,k) SHA_ROT(\"rorl\", x, k)",
          "54: #else",
          "59: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: a48f6e17599d7ec794cfcd60858d6a69cf05caaae9321048b111fedd86a3b5b2",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/hwtime.h||src/hwtime.h": [
          "File: src/hwtime.h -> src/hwtime.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:   #if defined(__GNUC__)",
          "",
          "[Removed Lines]",
          "25: #if (defined(__GNUC__) || defined(_MSC_VER)) && \\",
          "26:       (defined(i386) || defined(__i386__) || defined(_M_IX86))",
          "",
          "[Added Lines]",
          "25: #if !defined(__STRICT_ANSI__) && \\",
          "26:     (defined(__GNUC__) || defined(_MSC_VER)) && \\",
          "27:     (defined(i386) || defined(__i386__) || defined(_M_IX86))",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45:   #endif",
          "49:   __inline__ sqlite_uint64 sqlite3Hwtime(void){",
          "50:       unsigned long val;",
          "",
          "[Removed Lines]",
          "47: #elif (defined(__GNUC__) && defined(__x86_64__))",
          "",
          "[Added Lines]",
          "48: #elif !defined(__STRICT_ANSI__) && (defined(__GNUC__) && defined(__x86_64__))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "52:       return val;",
          "53:   }",
          "57:   __inline__ sqlite_uint64 sqlite3Hwtime(void){",
          "58:       unsigned long long retval;",
          "",
          "[Removed Lines]",
          "55: #elif (defined(__GNUC__) && defined(__ppc__))",
          "",
          "[Added Lines]",
          "56: #elif !defined(__STRICT_ANSI__) && (defined(__GNUC__) && defined(__ppc__))",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "70: #else",
          "81:   sqlite_uint64 sqlite3Hwtime(void){ return ((sqlite_uint64)0); }",
          "",
          "[Removed Lines]",
          "72:   #error Need implementation of sqlite3Hwtime() for your platform.",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "tool/dbhash.c||tool/dbhash.c": [
          "File: tool/dbhash.c -> tool/dbhash.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "78: #define SHA_ROT(x,l,r) ((x) << (l) | (x) >> (r))",
          "79: #define rol(x,k) SHA_ROT(x,k,32-(k))",
          "80: #define ror(x,k) SHA_ROT(x,32-(k),k)",
          "84: #define blk0le(i) (block[i] = (ror(block[i],8)&0xFF00FF00) \\",
          "85:     |(rol(block[i],8)&0x00FF00FF))",
          "",
          "[Removed Lines]",
          "65: #if __GNUC__ && (defined(__i386__) || defined(__x86_64__))",
          "71: #define SHA_ROT(op, x, k) \\",
          "72:         ({ unsigned int y; asm(op \" %1,%0\" : \"=r\" (y) : \"I\" (k), \"0\" (x)); y; })",
          "73: #define rol(x,k) SHA_ROT(\"roll\", x, k)",
          "74: #define ror(x,k) SHA_ROT(\"rorl\", x, k)",
          "76: #else",
          "81: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}