{
  "cve_id": "CVE-2019-13305",
  "cve_desc": "ImageMagick 7.0.8-50 Q16 has a stack-based buffer overflow at coders/pnm.c in WritePNMImage because of a misplaced strncpy and an off-by-one error.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "29efd648f38b73a64d73f14cd2019d869a585888",
  "patch_info": {
    "commit_hash": "29efd648f38b73a64d73f14cd2019d869a585888",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/29efd648f38b73a64d73f14cd2019d869a585888",
    "files": [
      "coders/pnm.c"
    ],
    "message": "https://github.com/ImageMagick/ImageMagick/issues/1613",
    "before_after_code_files": [
      "coders/pnm.c||coders/pnm.c"
    ]
  },
  "patch_diff": {
    "coders/pnm.c||coders/pnm.c": [
      "File: coders/pnm.c -> coders/pnm.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1824:             if (image->depth <= 8)",
      "1825:               count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,\"%u \",",
      "1826:                 ScaleQuantumToChar(index));",
      "1830:                   \"%u \",ScaleQuantumToShort(index));",
      "1831:               else",
      "1832:                 count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,",
      "1833:                   \"%u \",ScaleQuantumToLong(index));",
      "1834:             extent=(size_t) count;",
      "1835:             (void) strncpy((char *) q,buffer,extent);",
      "1836:             q+=extent;",
      "1837:             if ((q-pixels+extent+2) >= sizeof(pixels))",
      "",
      "[Removed Lines]",
      "1827:             else",
      "1828:               if (image->depth <= 16)",
      "1829:                 count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,",
      "",
      "[Added Lines]",
      "1827:             else",
      "1833:                   \"%u \",ScaleQuantumToLong(index));",
      "1834:             extent=(size_t) count;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1899:               if (image->depth <= 16)",
      "1900:                 count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,",
      "1901:                   \"%u %u %u \",ScaleQuantumToShort(GetPixelRed(image,p)),",
      "1904:               else",
      "1905:                 count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,",
      "1906:                   \"%u %u %u \",ScaleQuantumToLong(GetPixelRed(image,p)),",
      "1907:                   ScaleQuantumToLong(GetPixelGreen(image,p)),",
      "1908:                   ScaleQuantumToLong(GetPixelBlue(image,p)));",
      "1909:             extent=(size_t) count;",
      "1910:             (void) strncpy((char *) q,buffer,extent);",
      "1911:             q+=extent;",
      "1912:             if ((q-pixels+extent+2) >= sizeof(pixels))",
      "",
      "[Removed Lines]",
      "1902:                   ScaleQuantumToShort(GetPixelGreen(image,p)),",
      "1903:                   ScaleQuantumToShort(GetPixelBlue(image,p)));",
      "",
      "[Added Lines]",
      "1908:                   ScaleQuantumToLong(GetPixelBlue(image,p)));",
      "1909:             extent=(size_t) count;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e92040ea6ee2a844ebfd2344174076795a4787bd",
      "candidate_info": {
        "commit_hash": "e92040ea6ee2a844ebfd2344174076795a4787bd",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/e92040ea6ee2a844ebfd2344174076795a4787bd",
        "files": [
          "coders/pnm.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/1612",
        "before_after_code_files": [
          "coders/pnm.c||coders/pnm.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/pnm.c||coders/pnm.c"
          ],
          "candidate": [
            "coders/pnm.c||coders/pnm.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/pnm.c||coders/pnm.c": [
          "File: coders/pnm.c -> coders/pnm.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1826:                 ScaleQuantumToChar(index));",
          "1827:             else",
          "1828:               if (image->depth <= 16)",
          "1830:                   \"%u \",ScaleQuantumToShort(index));",
          "1831:               else",
          "1832:                 count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,",
          "",
          "[Removed Lines]",
          "1829:                 count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,",
          "",
          "[Added Lines]",
          "1829:                 count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1901:                   \"%u %u %u \",ScaleQuantumToShort(GetPixelRed(image,p)),",
          "1902:                   ScaleQuantumToShort(GetPixelGreen(image,p)),",
          "1903:                   ScaleQuantumToShort(GetPixelBlue(image,p)));",
          "1905:                 count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,",
          "1906:                   \"%u %u %u \",ScaleQuantumToLong(GetPixelRed(image,p)),",
          "1907:                   ScaleQuantumToLong(GetPixelGreen(image,p)),",
          "",
          "[Removed Lines]",
          "1904:               else",
          "",
          "[Added Lines]",
          "1904:               else",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "057d6405db7bec9e3c1694042b0db1022604e495",
      "candidate_info": {
        "commit_hash": "057d6405db7bec9e3c1694042b0db1022604e495",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/057d6405db7bec9e3c1694042b0db1022604e495",
        "files": [
          "MagickCore/xml-tree.c",
          "coders/pnm.c"
        ],
        "message": "...",
        "before_after_code_files": [
          "MagickCore/xml-tree.c||MagickCore/xml-tree.c",
          "coders/pnm.c||coders/pnm.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/pnm.c||coders/pnm.c"
          ],
          "candidate": [
            "coders/pnm.c||coders/pnm.c"
          ]
        }
      },
      "candidate_diff": {
        "MagickCore/xml-tree.c||MagickCore/xml-tree.c": [
          "File: MagickCore/xml-tree.c -> MagickCore/xml-tree.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1511:                       }",
          "1512:                     else",
          "1513:                       {",
          "1517:                         extent_xml=(char *) AcquireQuantumMemory(extent+1,",
          "",
          "[Removed Lines]",
          "1514:                         char",
          "",
          "[Added Lines]",
          "1514:                         char",
          "",
          "---------------"
        ],
        "coders/pnm.c||coders/pnm.c": [
          "File: coders/pnm.c -> coders/pnm.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1826:                   \"%u \",ScaleQuantumToShort(index));",
          "1827:               else",
          "1828:                 count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,",
          "1830:             extent=(size_t) count;",
          "1831:             if ((q-pixels+extent+1) >= sizeof(pixels))",
          "1832:               {",
          "",
          "[Removed Lines]",
          "1829:                   \"%u \",ScaleQuantumToLong(index));",
          "",
          "[Added Lines]",
          "1829:                   \"%u \",ScaleQuantumToLong(index));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1901:                 count=(ssize_t) FormatLocaleString(buffer,MagickPathExtent,",
          "1902:                   \"%u %u %u \",ScaleQuantumToLong(GetPixelRed(image,p)),",
          "1903:                   ScaleQuantumToLong(GetPixelGreen(image,p)),",
          "1905:             extent=(size_t) count;",
          "1906:             if ((q-pixels+extent+2) >= sizeof(pixels))",
          "1907:               {",
          "",
          "[Removed Lines]",
          "1904:                   ScaleQuantumToLong(GetPixelBlue(image,p)));",
          "",
          "[Added Lines]",
          "1904:                   ScaleQuantumToLong(GetPixelBlue(image,p)));",
          "",
          "---------------"
        ]
      }
    }
  ]
}