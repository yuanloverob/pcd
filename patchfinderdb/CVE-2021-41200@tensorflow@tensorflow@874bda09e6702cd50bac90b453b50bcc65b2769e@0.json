{
  "cve_id": "CVE-2021-41200",
  "cve_desc": "TensorFlow is an open source platform for machine learning. In affected versions if `tf.summary.create_file_writer` is called with non-scalar arguments code crashes due to a `CHECK`-fail. The fix will be included in TensorFlow 2.7.0. We will also cherrypick this commit on TensorFlow 2.6.1, TensorFlow 2.5.2, and TensorFlow 2.4.4, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "874bda09e6702cd50bac90b453b50bcc65b2769e",
  "patch_info": {
    "commit_hash": "874bda09e6702cd50bac90b453b50bcc65b2769e",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/874bda09e6702cd50bac90b453b50bcc65b2769e",
    "files": [
      "tensorflow/core/kernels/summary_kernels.cc",
      "tensorflow/python/summary/writer/writer_test.py"
    ],
    "message": "Merge pull request #51715 from yongtang:46909-tf.summary.create_file_writer\n\nPiperOrigin-RevId: 394109960\nChange-Id: I444e59a7f90acd6487832d74b677093403c8a083",
    "before_after_code_files": [
      "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
      "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
    ]
  },
  "patch_diff": {
    "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc": [
      "File: tensorflow/core/kernels/summary_kernels.cc -> tensorflow/core/kernels/summary_kernels.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "38:   void Compute(OpKernelContext* ctx) override {",
      "39:     const Tensor* tmp;",
      "40:     OP_REQUIRES_OK(ctx, ctx->input(\"logdir\", &tmp));",
      "41:     const string logdir = tmp->scalar<tstring>()();",
      "42:     OP_REQUIRES_OK(ctx, ctx->input(\"max_queue\", &tmp));",
      "43:     const int32_t max_queue = tmp->scalar<int32>()();",
      "44:     OP_REQUIRES_OK(ctx, ctx->input(\"flush_millis\", &tmp));",
      "45:     const int32_t flush_millis = tmp->scalar<int32>()();",
      "46:     OP_REQUIRES_OK(ctx, ctx->input(\"filename_suffix\", &tmp));",
      "47:     const string filename_suffix = tmp->scalar<tstring>()();",
      "49:     core::RefCountPtr<SummaryWriterInterface> s;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "41:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
      "42:                 errors::InvalidArgument(\"logdir must be a scalar\"));",
      "45:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
      "46:                 errors::InvalidArgument(\"max_queue must be a scalar\"));",
      "49:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
      "50:                 errors::InvalidArgument(\"flush_millis must be a scalar\"));",
      "53:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
      "54:                 errors::InvalidArgument(\"filename_suffix must be a scalar\"));",
      "",
      "---------------"
    ],
    "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py": [
      "File: tensorflow/python/summary/writer/writer_test.py -> tensorflow/python/summary/writer/writer_test.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "34: from tensorflow.python.client import session",
      "35: from tensorflow.python.framework import constant_op",
      "36: from tensorflow.python.framework import dtypes",
      "37: from tensorflow.python.framework import meta_graph",
      "38: from tensorflow.python.framework import ops",
      "39: from tensorflow.python.framework import test_util",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "37: from tensorflow.python.framework import errors_impl",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "685:     # No more files",
      "686:     self.assertRaises(StopIteration, lambda: next(event_paths))",
      "689: class FileWriterCacheTest(test.TestCase):",
      "690:   \"\"\"FileWriterCache tests.\"\"\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "689:   def testSummaryFileWritersInvalidInput(self):",
      "690:     # Test case for GitHub issue 46909",
      "691:     logdir = self.get_temp_dir()",
      "692:     with session.Session() as sess:",
      "693:       with self.assertRaises(errors_impl.InvalidArgumentError):",
      "694:         writer = summary_ops_v2.create_file_writer(",
      "695:             logdir=logdir, flush_millis=[1, 2])",
      "696:         sess.run(writer.init())",
      "697:         sess.run(writer.flush())",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "de260208f61c96abe0ddaefa2e47d24a6344ec5d",
      "candidate_info": {
        "commit_hash": "de260208f61c96abe0ddaefa2e47d24a6344ec5d",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/de260208f61c96abe0ddaefa2e47d24a6344ec5d",
        "files": [
          "tensorflow/core/kernels/summary_kernels.cc",
          "tensorflow/python/summary/writer/writer_test.py"
        ],
        "message": "Fix crash with tf.summary.create_file_writer when non-scalar values are passed\n\nThis PR tries to fix the issue raised in 46909 where\ntf.summary.create_file_writer crashes when non-scalar values are passed.\n\nThis PR fixes 46909.\n\nSigned-off-by: Yong Tang <yong.tang.github@outlook.com>",
        "before_after_code_files": [
          "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
          "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/tensorflow/tensorflow/pull/51715"
        ],
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
            "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
          ],
          "candidate": [
            "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
            "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc": [
          "File: tensorflow/core/kernels/summary_kernels.cc -> tensorflow/core/kernels/summary_kernels.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:   void Compute(OpKernelContext* ctx) override {",
          "39:     const Tensor* tmp;",
          "40:     OP_REQUIRES_OK(ctx, ctx->input(\"logdir\", &tmp));",
          "41:     const string logdir = tmp->scalar<tstring>()();",
          "42:     OP_REQUIRES_OK(ctx, ctx->input(\"max_queue\", &tmp));",
          "43:     const int32_t max_queue = tmp->scalar<int32>()();",
          "44:     OP_REQUIRES_OK(ctx, ctx->input(\"flush_millis\", &tmp));",
          "45:     const int32_t flush_millis = tmp->scalar<int32>()();",
          "46:     OP_REQUIRES_OK(ctx, ctx->input(\"filename_suffix\", &tmp));",
          "47:     const string filename_suffix = tmp->scalar<tstring>()();",
          "49:     core::RefCountPtr<SummaryWriterInterface> s;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "42:                 errors::InvalidArgument(\"logdir must be a scalar\"));",
          "45:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "46:                 errors::InvalidArgument(\"max_queue must be a scalar\"));",
          "49:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "50:                 errors::InvalidArgument(\"flush_millis must be a scalar\"));",
          "53:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "54:                 errors::InvalidArgument(\"filename_suffix must be a scalar\"));",
          "",
          "---------------"
        ],
        "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py": [
          "File: tensorflow/python/summary/writer/writer_test.py -> tensorflow/python/summary/writer/writer_test.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "34: from tensorflow.python.client import session",
          "35: from tensorflow.python.framework import constant_op",
          "36: from tensorflow.python.framework import dtypes",
          "37: from tensorflow.python.framework import meta_graph",
          "38: from tensorflow.python.framework import ops",
          "39: from tensorflow.python.framework import test_util",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "37: from tensorflow.python.framework import errors_impl",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "685:     # No more files",
          "686:     self.assertRaises(StopIteration, lambda: next(event_paths))",
          "689: class FileWriterCacheTest(test.TestCase):",
          "690:   \"\"\"FileWriterCache tests.\"\"\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "689:   def testSummaryFileWritersInvalidInput(self):",
          "690:     # Test case for GitHub issue 46909",
          "691:     logdir = self.get_temp_dir()",
          "692:     with session.Session() as sess:",
          "693:       with self.assertRaises(errors_impl.InvalidArgumentError):",
          "694:         writer = summary_ops_v2.create_file_writer(",
          "695:             logdir=logdir, flush_millis=[1, 2])",
          "696:         sess.run(writer.init())",
          "697:         sess.run(writer.flush())",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "116d2c9dff5e744b1be370074b88cfaedd321808",
      "candidate_info": {
        "commit_hash": "116d2c9dff5e744b1be370074b88cfaedd321808",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/116d2c9dff5e744b1be370074b88cfaedd321808",
        "files": [
          "tensorflow/core/kernels/summary_kernels.cc",
          "tensorflow/python/summary/writer/writer_test.py"
        ],
        "message": "Merge pull request #51715 from yongtang:46909-tf.summary.create_file_writer\n\nPiperOrigin-RevId: 394109960\nChange-Id: I444e59a7f90acd6487832d74b677093403c8a083",
        "before_after_code_files": [
          "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
          "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
            "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
          ],
          "candidate": [
            "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
            "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc": [
          "File: tensorflow/core/kernels/summary_kernels.cc -> tensorflow/core/kernels/summary_kernels.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:   void Compute(OpKernelContext* ctx) override {",
          "39:     const Tensor* tmp;",
          "40:     OP_REQUIRES_OK(ctx, ctx->input(\"logdir\", &tmp));",
          "41:     const string logdir = tmp->scalar<tstring>()();",
          "42:     OP_REQUIRES_OK(ctx, ctx->input(\"max_queue\", &tmp));",
          "44:     OP_REQUIRES_OK(ctx, ctx->input(\"flush_millis\", &tmp));",
          "46:     OP_REQUIRES_OK(ctx, ctx->input(\"filename_suffix\", &tmp));",
          "47:     const string filename_suffix = tmp->scalar<tstring>()();",
          "49:     core::RefCountPtr<SummaryWriterInterface> s;",
          "",
          "[Removed Lines]",
          "43:     const int32 max_queue = tmp->scalar<int32>()();",
          "45:     const int32 flush_millis = tmp->scalar<int32>()();",
          "",
          "[Added Lines]",
          "41:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "42:                 errors::InvalidArgument(\"logdir must be a scalar\"));",
          "45:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "46:                 errors::InvalidArgument(\"max_queue must be a scalar\"));",
          "47:     const int32_t max_queue = tmp->scalar<int32>()();",
          "49:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "50:                 errors::InvalidArgument(\"flush_millis must be a scalar\"));",
          "51:     const int32_t flush_millis = tmp->scalar<int32>()();",
          "53:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "54:                 errors::InvalidArgument(\"filename_suffix must be a scalar\"));",
          "",
          "---------------"
        ],
        "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py": [
          "File: tensorflow/python/summary/writer/writer_test.py -> tensorflow/python/summary/writer/writer_test.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "34: from tensorflow.python.client import session",
          "35: from tensorflow.python.framework import constant_op",
          "36: from tensorflow.python.framework import dtypes",
          "37: from tensorflow.python.framework import meta_graph",
          "38: from tensorflow.python.framework import ops",
          "39: from tensorflow.python.framework import test_util",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "37: from tensorflow.python.framework import errors_impl",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "685:     # No more files",
          "686:     self.assertRaises(StopIteration, lambda: next(event_paths))",
          "689: class FileWriterCacheTest(test.TestCase):",
          "690:   \"\"\"FileWriterCache tests.\"\"\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "689:   def testSummaryFileWritersInvalidInput(self):",
          "690:     # Test case for GitHub issue 46909",
          "691:     logdir = self.get_temp_dir()",
          "692:     with session.Session() as sess:",
          "693:       with self.assertRaises(errors_impl.InvalidArgumentError):",
          "694:         writer = summary_ops_v2.create_file_writer(",
          "695:             logdir=logdir, flush_millis=[1, 2])",
          "696:         sess.run(writer.init())",
          "697:         sess.run(writer.flush())",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "981ea48b86c59c7da416e9e2c8a9381c33452328",
      "candidate_info": {
        "commit_hash": "981ea48b86c59c7da416e9e2c8a9381c33452328",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/981ea48b86c59c7da416e9e2c8a9381c33452328",
        "files": [
          "tensorflow/core/kernels/summary_kernels.cc",
          "tensorflow/python/summary/writer/writer_test.py"
        ],
        "message": "Merge pull request #51715 from yongtang:46909-tf.summary.create_file_writer\n\nPiperOrigin-RevId: 394109960\nChange-Id: I444e59a7f90acd6487832d74b677093403c8a083",
        "before_after_code_files": [
          "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
          "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
            "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
          ],
          "candidate": [
            "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
            "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc": [
          "File: tensorflow/core/kernels/summary_kernels.cc -> tensorflow/core/kernels/summary_kernels.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:   void Compute(OpKernelContext* ctx) override {",
          "39:     const Tensor* tmp;",
          "40:     OP_REQUIRES_OK(ctx, ctx->input(\"logdir\", &tmp));",
          "41:     const string logdir = tmp->scalar<tstring>()();",
          "42:     OP_REQUIRES_OK(ctx, ctx->input(\"max_queue\", &tmp));",
          "44:     OP_REQUIRES_OK(ctx, ctx->input(\"flush_millis\", &tmp));",
          "46:     OP_REQUIRES_OK(ctx, ctx->input(\"filename_suffix\", &tmp));",
          "47:     const string filename_suffix = tmp->scalar<tstring>()();",
          "49:     core::RefCountPtr<SummaryWriterInterface> s;",
          "",
          "[Removed Lines]",
          "43:     const int32 max_queue = tmp->scalar<int32>()();",
          "45:     const int32 flush_millis = tmp->scalar<int32>()();",
          "",
          "[Added Lines]",
          "41:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "42:                 errors::InvalidArgument(\"logdir must be a scalar\"));",
          "45:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "46:                 errors::InvalidArgument(\"max_queue must be a scalar\"));",
          "47:     const int32_t max_queue = tmp->scalar<int32>()();",
          "49:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "50:                 errors::InvalidArgument(\"flush_millis must be a scalar\"));",
          "51:     const int32_t flush_millis = tmp->scalar<int32>()();",
          "53:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "54:                 errors::InvalidArgument(\"filename_suffix must be a scalar\"));",
          "",
          "---------------"
        ],
        "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py": [
          "File: tensorflow/python/summary/writer/writer_test.py -> tensorflow/python/summary/writer/writer_test.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "34: from tensorflow.python.client import session",
          "35: from tensorflow.python.framework import constant_op",
          "36: from tensorflow.python.framework import dtypes",
          "37: from tensorflow.python.framework import meta_graph",
          "38: from tensorflow.python.framework import ops",
          "39: from tensorflow.python.framework import test_util",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "37: from tensorflow.python.framework import errors_impl",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "685:     # No more files",
          "686:     self.assertRaises(StopIteration, lambda: next(event_paths))",
          "689: class FileWriterCacheTest(test.TestCase):",
          "690:   \"\"\"FileWriterCache tests.\"\"\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "689:   def testSummaryFileWritersInvalidInput(self):",
          "690:     # Test case for GitHub issue 46909",
          "691:     logdir = self.get_temp_dir()",
          "692:     with session.Session() as sess:",
          "693:       with self.assertRaises(errors_impl.InvalidArgumentError):",
          "694:         writer = summary_ops_v2.create_file_writer(",
          "695:             logdir=logdir, flush_millis=[1, 2])",
          "696:         sess.run(writer.init())",
          "697:         sess.run(writer.flush())",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7bbf1dfa672f62ea7062d65f72b4577629dffb8e",
      "candidate_info": {
        "commit_hash": "7bbf1dfa672f62ea7062d65f72b4577629dffb8e",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/7bbf1dfa672f62ea7062d65f72b4577629dffb8e",
        "files": [
          "tensorflow/core/kernels/summary_kernels.cc",
          "tensorflow/python/summary/writer/writer_test.py"
        ],
        "message": "Merge pull request #51715 from yongtang:46909-tf.summary.create_file_writer\n\nPiperOrigin-RevId: 394109960\nChange-Id: I444e59a7f90acd6487832d74b677093403c8a083",
        "before_after_code_files": [
          "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
          "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
            "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
          ],
          "candidate": [
            "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc",
            "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/summary_kernels.cc||tensorflow/core/kernels/summary_kernels.cc": [
          "File: tensorflow/core/kernels/summary_kernels.cc -> tensorflow/core/kernels/summary_kernels.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:   void Compute(OpKernelContext* ctx) override {",
          "39:     const Tensor* tmp;",
          "40:     OP_REQUIRES_OK(ctx, ctx->input(\"logdir\", &tmp));",
          "41:     const string logdir = tmp->scalar<tstring>()();",
          "42:     OP_REQUIRES_OK(ctx, ctx->input(\"max_queue\", &tmp));",
          "44:     OP_REQUIRES_OK(ctx, ctx->input(\"flush_millis\", &tmp));",
          "46:     OP_REQUIRES_OK(ctx, ctx->input(\"filename_suffix\", &tmp));",
          "47:     const string filename_suffix = tmp->scalar<tstring>()();",
          "49:     core::RefCountPtr<SummaryWriterInterface> s;",
          "",
          "[Removed Lines]",
          "43:     const int32 max_queue = tmp->scalar<int32>()();",
          "45:     const int32 flush_millis = tmp->scalar<int32>()();",
          "",
          "[Added Lines]",
          "41:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "42:                 errors::InvalidArgument(\"logdir must be a scalar\"));",
          "46:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "47:                 errors::InvalidArgument(\"max_queue must be a scalar\"));",
          "48:     const int32_t max_queue = tmp->scalar<int32>()();",
          "50:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "51:                 errors::InvalidArgument(\"flush_millis must be a scalar\"));",
          "52:     const int32_t flush_millis = tmp->scalar<int32>()();",
          "55:     OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(tmp->shape()),",
          "56:                 errors::InvalidArgument(\"filename_suffix must be a scalar\"));",
          "",
          "---------------"
        ],
        "tensorflow/python/summary/writer/writer_test.py||tensorflow/python/summary/writer/writer_test.py": [
          "File: tensorflow/python/summary/writer/writer_test.py -> tensorflow/python/summary/writer/writer_test.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "34: from tensorflow.python.client import session",
          "35: from tensorflow.python.framework import constant_op",
          "36: from tensorflow.python.framework import dtypes",
          "37: from tensorflow.python.framework import meta_graph",
          "38: from tensorflow.python.framework import ops",
          "39: from tensorflow.python.framework import test_util",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "37: from tensorflow.python.framework import errors_impl",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "685:     # No more files",
          "686:     self.assertRaises(StopIteration, lambda: next(event_paths))",
          "689: class FileWriterCacheTest(test.TestCase):",
          "690:   \"\"\"FileWriterCache tests.\"\"\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "689:   def testSummaryFileWritersInvalidInput(self):",
          "690:     # Test case for GitHub issue 46909",
          "691:     logdir = self.get_temp_dir()",
          "692:     with session.Session() as sess:",
          "693:       with self.assertRaises(errors_impl.InvalidArgumentError):",
          "694:         writer = summary_ops_v2.create_file_writer(",
          "695:             logdir=logdir, flush_millis=[1, 2])",
          "696:         sess.run(writer.init())",
          "697:         sess.run(writer.flush())",
          "",
          "---------------"
        ]
      }
    }
  ]
}