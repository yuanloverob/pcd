{
  "cve_id": "CVE-2018-0732",
  "cve_desc": "During key agreement in a TLS handshake using a DH(E) based ciphersuite a malicious server can send a very large prime value to the client. This will cause the client to spend an unreasonably long period of time generating a key for this prime resulting in a hang until the client has finished. This could be exploited in a Denial Of Service attack. Fixed in OpenSSL 1.1.0i-dev (Affected 1.1.0-1.1.0h). Fixed in OpenSSL 1.0.2p-dev (Affected 1.0.2-1.0.2o).",
  "repo": "openssl/openssl",
  "patch_hash": "91f7361f47b082ae61ffe1a7b17bb2adf213c7fe",
  "patch_info": {
    "commit_hash": "91f7361f47b082ae61ffe1a7b17bb2adf213c7fe",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/91f7361f47b082ae61ffe1a7b17bb2adf213c7fe",
    "files": [
      "crypto/dh/dh_key.c"
    ],
    "message": "Reject excessively large primes in DH key generation.\n\nCVE-2018-0732\n\nSigned-off-by: Guido Vranken <guidovranken@gmail.com>\n\nReviewed-by: Matthias St. Pierre <Matthias.St.Pierre@ncp-e.com>\nReviewed-by: Viktor Dukhovni <viktor@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/6457)",
    "before_after_code_files": [
      "crypto/dh/dh_key.c||crypto/dh/dh_key.c"
    ]
  },
  "patch_diff": {
    "crypto/dh/dh_key.c||crypto/dh/dh_key.c": [
      "File: crypto/dh/dh_key.c -> crypto/dh/dh_key.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "78:     int ok = 0;",
      "79:     int generate_new_key = 0;",
      "80:     unsigned l;",
      "82:     BN_MONT_CTX *mont = NULL;",
      "83:     BIGNUM *pub_key = NULL, *priv_key = NULL;",
      "85:     ctx = BN_CTX_new();",
      "86:     if (ctx == NULL)",
      "87:         goto err;",
      "",
      "[Removed Lines]",
      "81:     BN_CTX *ctx;",
      "",
      "[Added Lines]",
      "81:     BN_CTX *ctx = NULL;",
      "85:     if (BN_num_bits(dh->p) > OPENSSL_DH_MAX_MODULUS_BITS) {",
      "86:         DHerr(DH_F_GENERATE_KEY, DH_R_MODULUS_TOO_LARGE);",
      "87:         return 0;",
      "88:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3984ef0b72831da8b3ece4745cac4f8575b19098",
      "candidate_info": {
        "commit_hash": "3984ef0b72831da8b3ece4745cac4f8575b19098",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/3984ef0b72831da8b3ece4745cac4f8575b19098",
        "files": [
          "crypto/dh/dh_key.c"
        ],
        "message": "Reject excessively large primes in DH key generation.\n\nCVE-2018-0732\n\nSigned-off-by: Guido Vranken <guidovranken@gmail.com>\n\n(cherry picked from commit 91f7361f47b082ae61ffe1a7b17bb2adf213c7fe)\n\nReviewed-by: Tim Hudson <tjh@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/6457)",
        "before_after_code_files": [
          "crypto/dh/dh_key.c||crypto/dh/dh_key.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crypto/dh/dh_key.c||crypto/dh/dh_key.c"
          ],
          "candidate": [
            "crypto/dh/dh_key.c||crypto/dh/dh_key.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/dh/dh_key.c||crypto/dh/dh_key.c": [
          "File: crypto/dh/dh_key.c -> crypto/dh/dh_key.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "130:     int ok = 0;",
          "131:     int generate_new_key = 0;",
          "132:     unsigned l;",
          "134:     BN_MONT_CTX *mont = NULL;",
          "135:     BIGNUM *pub_key = NULL, *priv_key = NULL;",
          "137:     ctx = BN_CTX_new();",
          "138:     if (ctx == NULL)",
          "139:         goto err;",
          "",
          "[Removed Lines]",
          "133:     BN_CTX *ctx;",
          "",
          "[Added Lines]",
          "133:     BN_CTX *ctx = NULL;",
          "137:     if (BN_num_bits(dh->p) > OPENSSL_DH_MAX_MODULUS_BITS) {",
          "138:         DHerr(DH_F_GENERATE_KEY, DH_R_MODULUS_TOO_LARGE);",
          "139:         return 0;",
          "140:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ea7abeeabf92b7aca160bdd0208636d4da69f4f4",
      "candidate_info": {
        "commit_hash": "ea7abeeabf92b7aca160bdd0208636d4da69f4f4",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/ea7abeeabf92b7aca160bdd0208636d4da69f4f4",
        "files": [
          "crypto/dh/dh_key.c"
        ],
        "message": "Reject excessively large primes in DH key generation.\n\nCVE-2018-0732\n\nSigned-off-by: Guido Vranken <guidovranken@gmail.com>\n\n(cherry picked from commit 91f7361f47b082ae61ffe1a7b17bb2adf213c7fe)\n\nReviewed-by: Tim Hudson <tjh@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/6457)",
        "before_after_code_files": [
          "crypto/dh/dh_key.c||crypto/dh/dh_key.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crypto/dh/dh_key.c||crypto/dh/dh_key.c"
          ],
          "candidate": [
            "crypto/dh/dh_key.c||crypto/dh/dh_key.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/dh/dh_key.c||crypto/dh/dh_key.c": [
          "File: crypto/dh/dh_key.c -> crypto/dh/dh_key.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "78:     int ok = 0;",
          "79:     int generate_new_key = 0;",
          "80:     unsigned l;",
          "82:     BN_MONT_CTX *mont = NULL;",
          "83:     BIGNUM *pub_key = NULL, *priv_key = NULL;",
          "85:     ctx = BN_CTX_new();",
          "86:     if (ctx == NULL)",
          "87:         goto err;",
          "",
          "[Removed Lines]",
          "81:     BN_CTX *ctx;",
          "",
          "[Added Lines]",
          "81:     BN_CTX *ctx = NULL;",
          "85:     if (BN_num_bits(dh->p) > OPENSSL_DH_MAX_MODULUS_BITS) {",
          "86:         DHerr(DH_F_GENERATE_KEY, DH_R_MODULUS_TOO_LARGE);",
          "87:         return 0;",
          "88:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}