{
  "cve_id": "CVE-2016-10507",
  "cve_desc": "Integer overflow vulnerability in the bmp24toimage function in convertbmp.c in OpenJPEG before 2.2.0 allows remote attackers to cause a denial of service (heap-based buffer over-read and application crash) via a crafted bmp file.",
  "repo": "uclouvain/openjpeg",
  "patch_hash": "da940424816e11d624362ce080bc026adffa26e8",
  "patch_info": {
    "commit_hash": "da940424816e11d624362ce080bc026adffa26e8",
    "repo": "uclouvain/openjpeg",
    "commit_url": "https://github.com/uclouvain/openjpeg/commit/da940424816e11d624362ce080bc026adffa26e8",
    "files": [
      "src/bin/jp2/convertbmp.c",
      ".travis.yml",
      "CMakeLists.txt",
      "src/bin/jp2/CMakeLists.txt",
      "src/bin/jp2/opj_decompress.c",
      "src/lib/openjp2/CMakeLists.txt",
      "src/lib/openjp2/dwt.c",
      "src/lib/openjp2/dwt.h",
      "src/lib/openjp2/j2k.c",
      "src/lib/openjp2/j2k.h",
      "src/lib/openjp2/jp2.c",
      "src/lib/openjp2/jp2.h",
      "src/lib/openjp2/mqc.c",
      "src/lib/openjp2/mqc.h",
      "src/lib/openjp2/mqc_inl.h",
      "src/lib/openjp2/openjpeg.c",
      "src/lib/openjp2/openjpeg.h",
      "src/lib/openjp2/opj_codec.h",
      "src/lib/openjp2/opj_includes.h",
      "src/lib/openjp2/pi.c",
      "src/lib/openjp2/t1.c",
      "src/lib/openjp2/t1.h",
      "src/lib/openjp2/t1_generate_luts.c",
      "src/lib/openjp2/t1_luts.h",
      "src/lib/openjp2/tcd.c",
      "src/lib/openjp2/tcd.h",
      "src/lib/openjp2/thread.c",
      "src/lib/openjp2/thread.h",
      "src/lib/openjp2/tls_keys.h",
      "tools/abi-tracker/openjpeg.json"
    ],
    "message": "Merge pull request #834 from trylab/issue833\n\nFix issue 833.",
    "before_after_code_files": [
      "src/bin/jp2/convertbmp.c||src/bin/jp2/convertbmp.c"
    ]
  },
  "patch_diff": {
    "src/bin/jp2/convertbmp.c||src/bin/jp2/convertbmp.c": [
      "File: src/bin/jp2/convertbmp.c -> src/bin/jp2/convertbmp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "675:   }",
      "676:  }",
      "680:   stride = ((Info_h.biWidth * 8U + 31U) / 32U) * 4U;",
      "681:  }",
      "682:  pData = (OPJ_UINT8 *) calloc(1, stride * Info_h.biHeight * sizeof(OPJ_UINT8));",
      "683:  if (pData == NULL) {",
      "684:   fclose(IN);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "678:  if (Info_h.biWidth == 0 || Info_h.biHeight == 0) {",
      "679:   fclose(IN);",
      "680:   return NULL;",
      "681:  }",
      "683:  if (Info_h.biBitCount > (((OPJ_UINT32)-1) - 31) / Info_h.biWidth) {",
      "684:   fclose(IN);",
      "685:   return NULL;",
      "686:  }",
      "689:   if (8 > (((OPJ_UINT32)-1) - 31) / Info_h.biWidth) {",
      "690:    fclose(IN);",
      "691:    return NULL;",
      "692:   }",
      "696:  if (stride > ((OPJ_UINT32)-1) / sizeof(OPJ_UINT8) / Info_h.biHeight) {",
      "697:   fclose(IN);",
      "698:   return NULL;",
      "699:  }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "893143c8e13e491d0e884eb757580ec9575bbc8f",
      "candidate_info": {
        "commit_hash": "893143c8e13e491d0e884eb757580ec9575bbc8f",
        "repo": "uclouvain/openjpeg",
        "commit_url": "https://github.com/uclouvain/openjpeg/commit/893143c8e13e491d0e884eb757580ec9575bbc8f",
        "files": [
          "src/bin/jp2/convertbmp.c"
        ],
        "message": "Fix issue 833.\n\nAdd some overflow check operations.",
        "before_after_code_files": [
          "src/bin/jp2/convertbmp.c||src/bin/jp2/convertbmp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/uclouvain/openjpeg/pull/834"
        ],
        "olp_code_files": {
          "patch": [
            "src/bin/jp2/convertbmp.c||src/bin/jp2/convertbmp.c"
          ],
          "candidate": [
            "src/bin/jp2/convertbmp.c||src/bin/jp2/convertbmp.c"
          ]
        }
      },
      "candidate_diff": {
        "src/bin/jp2/convertbmp.c||src/bin/jp2/convertbmp.c": [
          "File: src/bin/jp2/convertbmp.c -> src/bin/jp2/convertbmp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "675:   }",
          "676:  }",
          "680:   stride = ((Info_h.biWidth * 8U + 31U) / 32U) * 4U;",
          "681:  }",
          "682:  pData = (OPJ_UINT8 *) calloc(1, stride * Info_h.biHeight * sizeof(OPJ_UINT8));",
          "683:  if (pData == NULL) {",
          "684:   fclose(IN);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "678:  if (Info_h.biWidth == 0 || Info_h.biHeight == 0) {",
          "679:   fclose(IN);",
          "680:   return NULL;",
          "681:  }",
          "683:  if (Info_h.biBitCount > (((OPJ_UINT32)-1) - 31) / Info_h.biWidth) {",
          "684:   fclose(IN);",
          "685:   return NULL;",
          "686:  }",
          "689:   if (8 > (((OPJ_UINT32)-1) - 31) / Info_h.biWidth) {",
          "690:    fclose(IN);",
          "691:    return NULL;",
          "692:   }",
          "696:  if (stride > ((OPJ_UINT32)-1) / sizeof(OPJ_UINT8) / Info_h.biHeight) {",
          "697:   fclose(IN);",
          "698:   return NULL;",
          "699:  }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "04a00aab654cee283879d6f93d7d868b9645a0f0",
      "candidate_info": {
        "commit_hash": "04a00aab654cee283879d6f93d7d868b9645a0f0",
        "repo": "uclouvain/openjpeg",
        "commit_url": "https://github.com/uclouvain/openjpeg/commit/04a00aab654cee283879d6f93d7d868b9645a0f0",
        "files": [
          "src/bin/jp2/convertbmp.c"
        ],
        "message": "Merge pull request #834 from trylab/issue833\n\nFix issue 833.",
        "before_after_code_files": [
          "src/bin/jp2/convertbmp.c||src/bin/jp2/convertbmp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/bin/jp2/convertbmp.c||src/bin/jp2/convertbmp.c"
          ],
          "candidate": [
            "src/bin/jp2/convertbmp.c||src/bin/jp2/convertbmp.c"
          ]
        }
      },
      "candidate_diff": {
        "src/bin/jp2/convertbmp.c||src/bin/jp2/convertbmp.c": [
          "File: src/bin/jp2/convertbmp.c -> src/bin/jp2/convertbmp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "675:   }",
          "676:  }",
          "680:   stride = ((Info_h.biWidth * 8U + 31U) / 32U) * 4U;",
          "681:  }",
          "682:  pData = (OPJ_UINT8 *) calloc(1, stride * Info_h.biHeight * sizeof(OPJ_UINT8));",
          "683:  if (pData == NULL) {",
          "684:   fclose(IN);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "678:  if (Info_h.biWidth == 0 || Info_h.biHeight == 0) {",
          "679:   fclose(IN);",
          "680:   return NULL;",
          "681:  }",
          "683:  if (Info_h.biBitCount > (((OPJ_UINT32)-1) - 31) / Info_h.biWidth) {",
          "684:   fclose(IN);",
          "685:   return NULL;",
          "686:  }",
          "689:   if (8 > (((OPJ_UINT32)-1) - 31) / Info_h.biWidth) {",
          "690:    fclose(IN);",
          "691:    return NULL;",
          "692:   }",
          "696:  if (stride > ((OPJ_UINT32)-1) / sizeof(OPJ_UINT8) / Info_h.biHeight) {",
          "697:   fclose(IN);",
          "698:   return NULL;",
          "699:  }",
          "",
          "---------------"
        ]
      }
    }
  ]
}