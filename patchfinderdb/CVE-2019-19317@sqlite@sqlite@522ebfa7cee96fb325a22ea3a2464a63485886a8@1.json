{
  "cve_id": "CVE-2019-19317",
  "cve_desc": "lookupName in resolve.c in SQLite 3.30.1 omits bits from the colUsed bitmask in the case of a generated column, which allows attackers to cause a denial of service or possibly have unspecified other impact.",
  "repo": "sqlite/sqlite",
  "patch_hash": "522ebfa7cee96fb325a22ea3a2464a63485886a8",
  "patch_info": {
    "commit_hash": "522ebfa7cee96fb325a22ea3a2464a63485886a8",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/522ebfa7cee96fb325a22ea3a2464a63485886a8",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/resolve.c",
      "test/gencol1.test"
    ],
    "message": "Whenever a generated column is used, assume that all columns are used.\n\nFossilOrigin-Name: 6601da58032d18ae00b466c0f2077fb2b1ecd84225b56e1787724bea478eedc9",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/resolve.c||src/resolve.c",
      "test/gencol1.test||test/gencol1.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 8b12e95fec7ce6e0de82a04ca3dfcf1a8e62e233b7382aa28a8a9be6e862b1af",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/resolve.c||src/resolve.c": [
      "File: src/resolve.c -> src/resolve.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "561:     if( n>=BMS ){",
      "562:       n = BMS-1;",
      "563:     }",
      "564:     assert( pMatch->iCursor==pExpr->iTable );",
      "565:     pMatch->colUsed |= ((Bitmask)1)<<n;",
      "566:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "573:     assert( pExpr->y.pTab!=0 );",
      "575:     if( pExpr->y.pTab->tabFlags & TF_HasGenerated ){",
      "576:       Column *pCol = pExpr->y.pTab->aCol + pExpr->iColumn;",
      "577:       if( pCol->colFlags & COLFLAG_GENERATED ) n = BMS-1;",
      "578:     }",
      "",
      "---------------"
    ],
    "test/gencol1.test||test/gencol1.test": [
      "File: test/gencol1.test -> test/gencol1.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "246: # 2019-11-21 Problems in the new generated column logic",
      "247: # reported by Yongheng Chen and Rui Zhong",
      "248: do_execsql_test gencol1-9.10 {",
      "251:   CREATE TABLE t1(aa , bb AS (17) UNIQUE);",
      "252:   INSERT INTO t1 VALUES(17);",
      "253:   CREATE TABLE t2(cc);",
      "254:   INSERT INTO t2 VALUES(41);",
      "255:   SELECT * FROM t2 JOIN t1 WHERE t1.bb=t1.aa AND t1.bb=17;",
      "256: } {41 17 17}",
      "259: finish_test",
      "",
      "[Removed Lines]",
      "249:   DROP TABLE IF EXISTS t1;",
      "250:   DROP TABLE IF EXISTS t2;",
      "",
      "[Added Lines]",
      "249:   DROP TABLE t1;",
      "256: do_execsql_test gencol1-9.20 {",
      "257:   CREATE TABLE t3(aa INT PRIMARY KEY, bb UNIQUE AS(aa));",
      "258:   INSERT INTO t3 VALUES(1);",
      "259:   SELECT 100, * FROM t3;",
      "260:   DELETE FROM t3 WHERE (SELECT bb FROM t3);",
      "261:   SELECT 200, * FROM t3;",
      "262: } {100 1 1}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "70d1a1a3ed64d7bd82fd90268e4c9cf208ca1be0",
      "candidate_info": {
        "commit_hash": "70d1a1a3ed64d7bd82fd90268e4c9cf208ca1be0",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/70d1a1a3ed64d7bd82fd90268e4c9cf208ca1be0",
        "files": [
          "ext/fts3/fts3.c",
          "ext/fts3/fts3_write.c",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Further improve detection of corrupt records in fts3.\n\nFossilOrigin-Name: a0f6d526baecd061a5e2bec5eb698fb5dfb10122ac79c853d7b3f4a48bc9f49b",
        "before_after_code_files": [
          "ext/fts3/fts3.c||ext/fts3/fts3.c",
          "ext/fts3/fts3_write.c||ext/fts3/fts3_write.c",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/fts3/fts3.c||ext/fts3/fts3.c": [
          "File: ext/fts3/fts3.c -> ext/fts3/fts3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2025:     if( rc==SQLITE_OK ){",
          "2026:       int iNewHeight = 0;",
          "2027:       fts3GetVarint32(zBlob, &iNewHeight);",
          "2029:         rc = FTS_CORRUPT_VTAB;",
          "2030:       }else{",
          "2031:         rc = fts3SelectLeaf(p, zTerm, nTerm, zBlob, nBlob, piLeaf, piLeaf2);",
          "",
          "[Removed Lines]",
          "2028:       if( iNewHeight<=iHeight ){",
          "",
          "[Added Lines]",
          "2028:       if( iNewHeight>=iHeight ){",
          "",
          "---------------"
        ],
        "ext/fts3/fts3_write.c||ext/fts3/fts3_write.c": [
          "File: ext/fts3/fts3_write.c -> ext/fts3/fts3_write.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1379:   pNext += fts3GetVarint32(pNext, &nSuffix);",
          "1380:   if( nSuffix<=0",
          "1381:    || (&pReader->aNode[pReader->nNode] - pNext)<nSuffix",
          "1383:   ){",
          "1384:     return FTS_CORRUPT_VTAB;",
          "1385:   }",
          "",
          "[Removed Lines]",
          "1382:    || nPrefix>pReader->nTermAlloc",
          "",
          "[Added Lines]",
          "1382:    || nPrefix>pReader->nTerm",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 2575a68c3965e72f2ab211d933012442755afe6a9b7de9e9e50cdd2155fd1ec8",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}