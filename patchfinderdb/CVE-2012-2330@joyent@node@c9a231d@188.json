{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8bd80f49117d6a772584a8d93dface0fb31ad931",
      "candidate_info": {
        "commit_hash": "8bd80f49117d6a772584a8d93dface0fb31ad931",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/8bd80f49117d6a772584a8d93dface0fb31ad931",
        "files": [
          "test/simple/test-sys.js"
        ],
        "message": "fix test-sys for hash randomization\n\nbroken in 4a899c92742583ca9e0bb7d16e09a66b08c9d033",
        "before_after_code_files": [
          "test/simple/test-sys.js||test/simple/test-sys.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/simple/test-sys.js||test/simple/test-sys.js": [
          "File: test/simple/test-sys.js -> test/simple/test-sys.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "60:     common.inspect(Object.create({},",
          "61:     {visible: {value: 1, enumerable: true}, hidden: {value: 2}}))",
          "62: );",
          "74: assert.equal('{ name: \\'Tim\\' }',",
          "75:     common.inspect(Object.create(null,",
          "76:                                  {name: {value: 'Tim', enumerable: true},",
          "",
          "[Removed Lines]",
          "63: assert.equal('{ [hidden]: 2, visible: 1 }',",
          "64:     common.inspect(Object.create({},",
          "65:     {visible: {value: 1, enumerable: true}, hidden: {value: 2}}), true)",
          "66: );",
          "69: assert.equal('{ [hidden]: \\'secret\\', name: \\'Tim\\' }',",
          "70:     common.inspect(Object.create(null,",
          "71:                                  {name: {value: 'Tim', enumerable: true},",
          "72:                                    hidden: {value: 'secret'}}), true)",
          "73: );",
          "",
          "[Added Lines]",
          "68: var out = common.inspect(Object.create({},",
          "69:     {visible: {value: 1, enumerable: true}, hidden: {value: 2}}), true);",
          "70: if (out !== '{ [hidden]: 2, visible: 1 }' &&",
          "71:     out !== '{ visible: 1, [hidden]: 2 }') {",
          "72:   assert.ok(false);",
          "73: }",
          "77: var out = common.inspect(Object.create(null,",
          "78:     { name: {value: 'Tim', enumerable: true},",
          "79:       hidden: {value: 'secret'}}), true);",
          "80: if (out !== \"{ [hidden]: 'secret', name: 'Tim' }\" &&",
          "81:     out !== \"{ name: 'Tim', [hidden]: 'secret' }\") {",
          "82:   assert(false);",
          "83: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "acea4c4123b346495de79498f5b4200d6fd1bf1d",
      "candidate_info": {
        "commit_hash": "acea4c4123b346495de79498f5b4200d6fd1bf1d",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/acea4c4123b346495de79498f5b4200d6fd1bf1d",
        "files": [
          "src/cares_wrap.cc",
          "src/tcp_wrap.cc",
          "src/udp_wrap.cc"
        ],
        "message": "dns: use uv_inet_ntop/uv_inet_pton instead of c-ares equivalents",
        "before_after_code_files": [
          "src/cares_wrap.cc||src/cares_wrap.cc",
          "src/tcp_wrap.cc||src/tcp_wrap.cc",
          "src/udp_wrap.cc||src/udp_wrap.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/cares_wrap.cc||src/cares_wrap.cc": [
          "File: src/cares_wrap.cc -> src/cares_wrap.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "37: # include <arpa/nameser.h>",
          "38: #endif",
          "56: namespace node {",
          "",
          "[Removed Lines]",
          "41: #if defined(__MINGW32__) || defined(_MSC_VER)",
          "42:   extern \"C\" {",
          "43: #   include <inet_net_pton.h>",
          "44: #   include <inet_ntop.h>",
          "45:   }",
          "46: # define uv_inet_pton ares_inet_pton",
          "47: # define uv_inet_ntop ares_inet_ntop",
          "49: #else // __POSIX__",
          "50: # include <arpa/inet.h>",
          "51: # define uv_inet_pton inet_pton",
          "52: # define uv_inet_ntop inet_ntop",
          "53: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "627:     int length, family;",
          "628:     char address_buffer[sizeof(struct in6_addr)];",
          "631:       length = sizeof(struct in_addr);",
          "632:       family = AF_INET;",
          "634:       length = sizeof(struct in6_addr);",
          "635:       family = AF_INET6;",
          "636:     } else {",
          "",
          "[Removed Lines]",
          "630:     if (uv_inet_pton(AF_INET, name, &address_buffer) == 1) {",
          "633:     } else if (uv_inet_pton(AF_INET6, name, &address_buffer) == 1) {",
          "",
          "[Added Lines]",
          "615:     if (uv_inet_pton(AF_INET, name, &address_buffer).code == UV_OK) {",
          "618:     } else if (uv_inet_pton(AF_INET6, name, &address_buffer).code == UV_OK) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "772:       if (address->ai_family == AF_INET) {",
          "774:         addr = (char*) &((struct sockaddr_in*) address->ai_addr)->sin_addr;",
          "780:         results->Set(n, s);",
          "781:         n++;",
          "782:       }",
          "",
          "[Removed Lines]",
          "775:         const char* c = uv_inet_ntop(address->ai_family, addr, ip,",
          "776:             INET6_ADDRSTRLEN);",
          "779:         Local<String> s = String::New(c);",
          "",
          "[Added Lines]",
          "760:         uv_err_t err = uv_inet_ntop(address->ai_family,",
          "761:                                     addr,",
          "762:                                     ip,",
          "763:                                     INET6_ADDRSTRLEN);",
          "764:         if (err.code != UV_OK)",
          "765:           continue;",
          "768:         Local<String> s = String::New(ip);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "794:       if (address->ai_family == AF_INET6) {",
          "796:         addr = (char*) &((struct sockaddr_in6*) address->ai_addr)->sin6_addr;",
          "802:         results->Set(n, s);",
          "803:         n++;",
          "804:       }",
          "",
          "[Removed Lines]",
          "797:         const char* c = uv_inet_ntop(address->ai_family, addr, ip,",
          "798:             INET6_ADDRSTRLEN);",
          "801:         Local<String> s = String::New(c);",
          "",
          "[Added Lines]",
          "786:         uv_err_t err = uv_inet_ntop(address->ai_family,",
          "787:                                     addr,",
          "788:                                     ip,",
          "789:                                     INET6_ADDRSTRLEN);",
          "790:         if (err.code != UV_OK)",
          "791:           continue;",
          "794:         Local<String> s = String::New(ip);",
          "",
          "---------------"
        ],
        "src/tcp_wrap.cc||src/tcp_wrap.cc": [
          "File: src/tcp_wrap.cc -> src/tcp_wrap.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #include <stdlib.h>",
          "46: namespace node {",
          "",
          "[Removed Lines]",
          "32: #if defined(__MINGW32__) || defined(_MSC_VER)",
          "33:   extern \"C\" {",
          "34: #   include <inet_net_pton.h>",
          "35: #   include <inet_ntop.h>",
          "36:   }",
          "37: # define uv_inet_pton ares_inet_pton",
          "38: # define uv_inet_ntop ares_inet_ntop",
          "40: #else // __POSIX__",
          "41: # include <arpa/inet.h>",
          "42: # define uv_inet_pton inet_pton",
          "43: # define uv_inet_ntop inet_ntop",
          "44: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/udp_wrap.cc||src/udp_wrap.cc": [
          "File: src/udp_wrap.cc -> src/udp_wrap.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "31: #define SLAB_SIZE (1024 * 1024)",
          "49: using namespace v8;",
          "",
          "[Removed Lines]",
          "35: #if defined(__MINGW32__) || defined(_MSC_VER)",
          "36:   extern \"C\" {",
          "37: #   include <inet_net_pton.h>",
          "38: #   include <inet_ntop.h>",
          "39:   }",
          "40: # define uv_inet_pton ares_inet_pton",
          "41: # define uv_inet_ntop ares_inet_ntop",
          "43: #else // __POSIX__",
          "44: # include <arpa/inet.h>",
          "45: # define uv_inet_pton inet_pton",
          "46: # define uv_inet_ntop inet_ntop",
          "47: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "01432403afc81b727083034dcb5126e4350e9c45",
      "candidate_info": {
        "commit_hash": "01432403afc81b727083034dcb5126e4350e9c45",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/01432403afc81b727083034dcb5126e4350e9c45",
        "files": [
          "tools/msvs/msi/product.wxs",
          "tools/msvs/nodejsvars.bat"
        ],
        "message": "windows/msi: add node.js prompt to startmenu",
        "before_after_code_files": [
          "tools/msvs/msi/product.wxs||tools/msvs/msi/product.wxs",
          "tools/msvs/nodejsvars.bat||tools/msvs/nodejsvars.bat"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/msvs/msi/product.wxs||tools/msvs/msi/product.wxs": [
          "File: tools/msvs/msi/product.wxs -> tools/msvs/msi/product.wxs",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:             <File Id=\"filenodepdb\" KeyPath=\"yes\" Source=\"$(var.sourcedir)\\node.pdb\" />",
          "65:           </Component>",
          "66:           <?endif?>",
          "67:         </Directory>",
          "68:       </Directory>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67:           <Component Id=\"nodejsvars\" Guid=\"*\">",
          "68:             <File Id=\"filenodejsvars\" KeyPath=\"yes\" Source=\"$(var.repoDir)\\tools\\msvs\\nodejsvars.bat\" />",
          "69:           </Component>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "85:         <Shortcut Id=\"ApplicationStartMenuShortcut\" Name=\"Node.js\"",
          "86:                   Description=\"$(var.ProductDescription)\" Target=\"[APPLICATIONROOTDIRECTORY]node.exe\"",
          "87:                   WorkingDirectory=\"APPLICATIONROOTDIRECTORY\"/>",
          "88:         <util:InternetShortcut Id=\"OnlineWebsiteShortcut\"",
          "89:                   Name=\"Node.js website\"",
          "90:                   Target=\"http://nodejs.org\"/>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "91:         <Shortcut Id=\"NodePromptStartMenuShortcut\" Name=\"Node.js ($(var.Platform)) Command Prompt\"",
          "92:                   Description=\"Node.js Command Prompt\" Target=\"[%ComSpec]\"",
          "93:                   Arguments='/k \"[APPLICATIONROOTDIRECTORY]nodejsvars.bat\" $(var.Platform)'",
          "94:                   Show=\"normal\"",
          "95:                   WorkingDirectory=\"APPLICATIONROOTDIRECTORY\"/>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "113:       <ComponentRef Id=\"nodepdb\"/>",
          "114:       <?endif?>",
          "115:       <ComponentRef Id=\"ApplicationShortcut\" />",
          "116:     </ComponentGroup>",
          "118:     <Feature Id=\"nodejs\" Title=\"node.js engine\" Level=\"1\" Description=\"$(var.ProductDescription)\">",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "124:       <ComponentRef Id=\"nodejsvars\" />",
          "",
          "---------------"
        ],
        "tools/msvs/nodejsvars.bat||tools/msvs/nodejsvars.bat": [
          "File: tools/msvs/nodejsvars.bat -> tools/msvs/nodejsvars.bat",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: @echo off",
          "2: @rem Process arguments.",
          "3: set target_arch=x86",
          "5: :next-arg",
          "6: if \"%1\"==\"\" goto args-done",
          "7: if /i \"%1\"==\"x86\"           set target_arch=x86&goto arg-ok",
          "8: if /i \"%1\"==\"x64\"           set target_arch=x64&goto arg-ok",
          "10: echo Warning: ignoring invalid command line option `%1`.",
          "12: :arg-ok",
          "13: shift",
          "14: goto next-arg",
          "15: :args-done",
          "17: @rem Ensure this Node.js is first in the PATH",
          "18: echo Your environment has been set up for using Node.js (%target_arch%) and NPM",
          "19: set PATH=%~dp0;%PATH%",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bea2e15864fb41c161dd47a0184ae07e83b7ce76",
      "candidate_info": {
        "commit_hash": "bea2e15864fb41c161dd47a0184ae07e83b7ce76",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/bea2e15864fb41c161dd47a0184ae07e83b7ce76",
        "files": [
          "tools/js2c.py"
        ],
        "message": "js2c: fix to support files other than ones ending with 2 char extensions\n\nPreviously this was basically hard-coded for *.js files, but now we\nneed to include the 'config.gypi' file in there as well.",
        "before_after_code_files": [
          "tools/js2c.py||tools/js2c.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/js2c.py||tools/js2c.py": [
          "File: tools/js2c.py -> tools/js2c.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "288:     lines = ExpandMacros(lines, macros)",
          "289:     lines = CompressScript(lines, do_jsmin)",
          "290:     data = ToCArray(s, lines)",
          "292:     if delay: id = id[:-6]",
          "293:     if delay:",
          "294:       delay_ids.append((id, len(lines)))",
          "",
          "[Removed Lines]",
          "291:     id = (os.path.split(str(s))[1])[:-3]",
          "",
          "[Added Lines]",
          "291:     id = os.path.basename(str(s)).split('.')[0]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "92c0c6953a03a0860e8ea1b9c1a18fbd7a4fc3c9",
      "candidate_info": {
        "commit_hash": "92c0c6953a03a0860e8ea1b9c1a18fbd7a4fc3c9",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/92c0c6953a03a0860e8ea1b9c1a18fbd7a4fc3c9",
        "files": [
          "common.gypi"
        ],
        "message": "build: define _DARWIN_USE_64_BIT_INODE=1 on OS X\n\nFixes a segmentation fault on some OS X systems due to sizeof(struct stat)\nmismatches.\n\nFixes #2061.",
        "before_after_code_files": [
          "common.gypi||common.gypi"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "common.gypi||common.gypi": [
          "File: common.gypi -> common.gypi",
          "--- Hunk 1 ---",
          "[Context before]",
          "152:         ],",
          "153:       }],",
          "154:       ['OS==\"mac\"', {",
          "155:         'xcode_settings': {",
          "156:           'ALWAYS_SEARCH_USER_PATHS': 'NO',",
          "157:           'GCC_CW_ASM_SYNTAX': 'NO',                # No -fasm-blocks",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "155:         'defines': ['_DARWIN_USE_64_BIT_INODE=1'],",
          "",
          "---------------"
        ]
      }
    }
  ]
}