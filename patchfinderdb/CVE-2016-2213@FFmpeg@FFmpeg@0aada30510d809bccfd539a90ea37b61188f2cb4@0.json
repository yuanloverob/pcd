{
  "cve_id": "CVE-2016-2213",
  "cve_desc": "The jpeg2000_decode_tile function in libavcodec/jpeg2000dec.c in FFmpeg before 2.8.6 allows remote attackers to cause a denial of service (out-of-bounds array read access) via crafted JPEG 2000 data.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "0aada30510d809bccfd539a90ea37b61188f2cb4",
  "patch_info": {
    "commit_hash": "0aada30510d809bccfd539a90ea37b61188f2cb4",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/0aada30510d809bccfd539a90ea37b61188f2cb4",
    "files": [
      "libavcodec/jpeg2000dec.c"
    ],
    "message": "avcodec/jpeg2000dec: More completely check cdef\n\nFixes out of array read\nFixes: j2k-poc.bin\n\nFound-by: Lucas Leong <wmliang.tw@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
    "before_after_code_files": [
      "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
    ]
  },
  "patch_diff": {
    "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
      "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1766:     if (tile->codsty[0].mct)",
      "1767:         mct_decode(s, tile);",
      "1774:     }",
      "1776:     if (s->precision <= 8) {",
      "",
      "[Removed Lines]",
      "1769:     if (s->cdef[0] < 0) {",
      "1770:         for (x = 0; x < s->ncomponents; x++)",
      "1771:             s->cdef[x] = x + 1;",
      "1772:         if ((s->ncomponents & 1) == 0)",
      "1773:             s->cdef[s->ncomponents-1] = 0;",
      "",
      "[Added Lines]",
      "1769:     for (x = 0; x < s->ncomponents; x++) {",
      "1770:         if (s->cdef[x] < 0) {",
      "1771:             for (x = 0; x < s->ncomponents; x++) {",
      "1772:                 s->cdef[x] = x + 1;",
      "1773:             }",
      "1774:             if ((s->ncomponents & 1) == 0)",
      "1775:                 s->cdef[s->ncomponents-1] = 0;",
      "1776:             break;",
      "1777:         }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "684e189eb3a57347904c3c97451e5bb3a27ecafb",
      "candidate_info": {
        "commit_hash": "684e189eb3a57347904c3c97451e5bb3a27ecafb",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/684e189eb3a57347904c3c97451e5bb3a27ecafb",
        "files": [
          "libavcodec/jpeg2000dec.c"
        ],
        "message": "avcodec/jpeg2000dec: More completely check cdef\n\nFixes out of array access\nFixes: j2k-poc.bin\n\nFound-by: Lucas Leong <wmliang.tw@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 0aada30510d809bccfd539a90ea37b61188f2cb4)\n\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ],
          "candidate": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
          "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1245:     if (tile->codsty[0].mct)",
          "1246:         mct_decode(s, tile);",
          "1253:     }",
          "1255:     if (s->precision <= 8) {",
          "",
          "[Removed Lines]",
          "1248:     if (s->cdef[0] < 0) {",
          "1249:         for (x = 0; x < s->ncomponents; x++)",
          "1250:             s->cdef[x] = x + 1;",
          "1251:         if ((s->ncomponents & 1) == 0)",
          "1252:             s->cdef[s->ncomponents-1] = 0;",
          "",
          "[Added Lines]",
          "1248:     for (x = 0; x < s->ncomponents; x++) {",
          "1249:         if (s->cdef[x] < 0) {",
          "1250:             for (x = 0; x < s->ncomponents; x++) {",
          "1251:                 s->cdef[x] = x + 1;",
          "1252:             }",
          "1253:             if ((s->ncomponents & 1) == 0)",
          "1254:                 s->cdef[s->ncomponents-1] = 0;",
          "1255:             break;",
          "1256:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "69e191f854f75815f17099a9a5f911dc30075c70",
      "candidate_info": {
        "commit_hash": "69e191f854f75815f17099a9a5f911dc30075c70",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/69e191f854f75815f17099a9a5f911dc30075c70",
        "files": [
          "libavcodec/jpeg2000dec.c"
        ],
        "message": "avcodec/jpeg2000dec: More completely check cdef\n\nFixes out of array access\nFixes: j2k-poc.bin\n\nFound-by: Lucas Leong <wmliang.tw@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 0aada30510d809bccfd539a90ea37b61188f2cb4)\n\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ],
          "candidate": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
          "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1245:     if (tile->codsty[0].mct)",
          "1246:         mct_decode(s, tile);",
          "1253:     }",
          "1255:     if (s->precision <= 8) {",
          "",
          "[Removed Lines]",
          "1248:     if (s->cdef[0] < 0) {",
          "1249:         for (x = 0; x < s->ncomponents; x++)",
          "1250:             s->cdef[x] = x + 1;",
          "1251:         if ((s->ncomponents & 1) == 0)",
          "1252:             s->cdef[s->ncomponents-1] = 0;",
          "",
          "[Added Lines]",
          "1248:     for (x = 0; x < s->ncomponents; x++) {",
          "1249:         if (s->cdef[x] < 0) {",
          "1250:             for (x = 0; x < s->ncomponents; x++) {",
          "1251:                 s->cdef[x] = x + 1;",
          "1252:             }",
          "1253:             if ((s->ncomponents & 1) == 0)",
          "1254:                 s->cdef[s->ncomponents-1] = 0;",
          "1255:             break;",
          "1256:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b15ae71305b29b497e7b56c7ae5f2982fb5e91ed",
      "candidate_info": {
        "commit_hash": "b15ae71305b29b497e7b56c7ae5f2982fb5e91ed",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/b15ae71305b29b497e7b56c7ae5f2982fb5e91ed",
        "files": [
          "libavcodec/jpeg2000dec.c"
        ],
        "message": "avcodec/jpeg2000dec: More completely check cdef\n\nFixes out of array access\nFixes: j2k-poc.bin\n\nFound-by: Lucas Leong <wmliang.tw@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 0aada30510d809bccfd539a90ea37b61188f2cb4)\n\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ],
          "candidate": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
          "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1695:     if (tile->codsty[0].mct)",
          "1696:         mct_decode(s, tile);",
          "1703:     }",
          "1705:     if (s->precision <= 8) {",
          "",
          "[Removed Lines]",
          "1698:     if (s->cdef[0] < 0) {",
          "1699:         for (x = 0; x < s->ncomponents; x++)",
          "1700:             s->cdef[x] = x + 1;",
          "1701:         if ((s->ncomponents & 1) == 0)",
          "1702:             s->cdef[s->ncomponents-1] = 0;",
          "",
          "[Added Lines]",
          "1698:     for (x = 0; x < s->ncomponents; x++) {",
          "1699:         if (s->cdef[x] < 0) {",
          "1700:             for (x = 0; x < s->ncomponents; x++) {",
          "1701:                 s->cdef[x] = x + 1;",
          "1702:             }",
          "1703:             if ((s->ncomponents & 1) == 0)",
          "1704:                 s->cdef[s->ncomponents-1] = 0;",
          "1705:             break;",
          "1706:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a944744f197a747251ace1bb7eb58eee0341ca10",
      "candidate_info": {
        "commit_hash": "a944744f197a747251ace1bb7eb58eee0341ca10",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/a944744f197a747251ace1bb7eb58eee0341ca10",
        "files": [
          "libavcodec/jpeg2000dec.c"
        ],
        "message": "avcodec/jpeg2000dec: More completely check cdef\n\nFixes out of array access\nFixes: j2k-poc.bin\n\nFound-by: Lucas Leong <wmliang.tw@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 0aada30510d809bccfd539a90ea37b61188f2cb4)\n\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ],
          "candidate": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
          "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1292:     if (tile->codsty[0].mct)",
          "1293:         mct_decode(s, tile);",
          "1300:     }",
          "1302:     if (s->precision <= 8) {",
          "",
          "[Removed Lines]",
          "1295:     if (s->cdef[0] < 0) {",
          "1296:         for (x = 0; x < s->ncomponents; x++)",
          "1297:             s->cdef[x] = x + 1;",
          "1298:         if ((s->ncomponents & 1) == 0)",
          "1299:             s->cdef[s->ncomponents-1] = 0;",
          "",
          "[Added Lines]",
          "1295:     for (x = 0; x < s->ncomponents; x++) {",
          "1296:         if (s->cdef[x] < 0) {",
          "1297:             for (x = 0; x < s->ncomponents; x++) {",
          "1298:                 s->cdef[x] = x + 1;",
          "1299:             }",
          "1300:             if ((s->ncomponents & 1) == 0)",
          "1301:                 s->cdef[s->ncomponents-1] = 0;",
          "1302:             break;",
          "1303:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "12f256a729a8d9f1f1ae37dc14fb4437b935b133",
      "candidate_info": {
        "commit_hash": "12f256a729a8d9f1f1ae37dc14fb4437b935b133",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/12f256a729a8d9f1f1ae37dc14fb4437b935b133",
        "files": [
          "libavcodec/jpeg2000dec.c"
        ],
        "message": "avcodec/jpeg2000dec: More completely check cdef\n\nFixes out of array access\nFixes: j2k-poc.bin\n\nFound-by: Lucas Leong <wmliang.tw@gmail.com>\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 0aada30510d809bccfd539a90ea37b61188f2cb4)\n\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ],
          "candidate": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
          "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1286:     if (tile->codsty[0].mct)",
          "1287:         mct_decode(s, tile);",
          "1294:     }",
          "1296:     if (s->precision <= 8) {",
          "",
          "[Removed Lines]",
          "1289:     if (s->cdef[0] < 0) {",
          "1290:         for (x = 0; x < s->ncomponents; x++)",
          "1291:             s->cdef[x] = x + 1;",
          "1292:         if ((s->ncomponents & 1) == 0)",
          "1293:             s->cdef[s->ncomponents-1] = 0;",
          "",
          "[Added Lines]",
          "1289:     for (x = 0; x < s->ncomponents; x++) {",
          "1290:         if (s->cdef[x] < 0) {",
          "1291:             for (x = 0; x < s->ncomponents; x++) {",
          "1292:                 s->cdef[x] = x + 1;",
          "1293:             }",
          "1294:             if ((s->ncomponents & 1) == 0)",
          "1295:                 s->cdef[s->ncomponents-1] = 0;",
          "1296:             break;",
          "1297:         }",
          "",
          "---------------"
        ]
      }
    }
  ]
}