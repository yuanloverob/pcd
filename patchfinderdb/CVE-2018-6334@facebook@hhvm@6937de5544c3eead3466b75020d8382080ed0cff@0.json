{
  "cve_id": "CVE-2018-6334",
  "cve_desc": "Multipart-file uploads call variables to be improperly registered in the global scope. In cases where variables are not declared explicitly before being used this can lead to unexpected behavior. This affects all supported versions of HHVM prior to the patch (3.25.1, 3.24.5, and 3.21.9 and below).",
  "repo": "facebook/hhvm",
  "patch_hash": "6937de5544c3eead3466b75020d8382080ed0cff",
  "patch_info": {
    "commit_hash": "6937de5544c3eead3466b75020d8382080ed0cff",
    "repo": "facebook/hhvm",
    "commit_url": "https://github.com/facebook/hhvm/commit/6937de5544c3eead3466b75020d8382080ed0cff",
    "files": [
      "hphp/runtime/server/upload.cpp"
    ],
    "message": "[security][CVE-2018-6334] kill globals for file uploads in hhvm\n\nCode should look at _GET, _POST, _FILES, etc. directly to avoid security concerns.\n\nThis included both `$GLOBALS` and `register_globals`-like behavior.\n\nCVE-2018-6334",
    "before_after_code_files": [
      "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp"
    ]
  },
  "patch_diff": {
    "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp": [
      "File: hphp/runtime/server/upload.cpp -> hphp/runtime/server/upload.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "18: #include \"hphp/runtime/server/upload.h\"",
      "19: #include \"hphp/runtime/base/program-functions.h\"",
      "21: #include \"hphp/runtime/base/request-local.h\"",
      "22: #include \"hphp/runtime/base/zend-printf.h\"",
      "24: #include \"hphp/runtime/ext/apc/ext_apc.h\"",
      "25: #include \"hphp/util/logger.h\"",
      "27: #include \"hphp/util/text-util.h\"",
      "29: #include <folly/FileUtil.h>",
      "31: using std::set;",
      "",
      "[Removed Lines]",
      "20: #include \"hphp/runtime/base/runtime-option.h\"",
      "23: #include \"hphp/runtime/base/php-globals.h\"",
      "26: #include \"hphp/runtime/base/string-util.h\"",
      "28: #include \"hphp/runtime/base/request-event-handler.h\"",
      "",
      "[Added Lines]",
      "21: #include \"hphp/runtime/base/request-event-handler.h\"",
      "23: #include \"hphp/runtime/base/runtime-option.h\"",
      "24: #include \"hphp/runtime/base/string-util.h\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "714:   std::string array_index, abuf;",
      "715:   char *lbuf=nullptr;",
      "716:   int total_bytes=0, cancel_upload=0, is_arr_upload=0, array_len=0;",
      "718:   std::set<std::string> &uploaded_files = s_rfc1867_data->rfc1867UploadedFiles;",
      "719:   multipart_buffer *mbuff;",
      "720:   int fd=-1;",
      "",
      "[Removed Lines]",
      "717:   int max_file_size=0, skip_upload=0, anonindex=0, is_anonymous;",
      "",
      "[Added Lines]",
      "719:   int max_file_size=0, skip_upload=0, anonindex=0;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "855:       }",
      "857:       if (!param) {",
      "859:         param = (char*)malloc(MAX_SIZE_ANONNAME);",
      "860:         snprintf(param, MAX_SIZE_ANONNAME, \"%u\", anonindex++);",
      "863:       }",
      "",
      "[Removed Lines]",
      "858:         is_anonymous = 1;",
      "861:       } else {",
      "862:         is_anonymous = 0;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1067:         s = tmp;",
      "1068:       }",
      "1082:       if (is_arr_upload) {",
      "1083:         snprintf(lbuf, llen, \"%s[name][%s]\",",
      "",
      "[Removed Lines]",
      "1070:       Array globals = php_globals_as_array();",
      "1071:       if (!is_anonymous) {",
      "1072:         if (s) {",
      "1073:           String val(s+1, strlen(s+1), CopyString);",
      "1074:           safe_php_register_variable(lbuf, val, globals, 0);",
      "1075:         } else {",
      "1076:           String val(filename, strlen(filename), CopyString);",
      "1077:           safe_php_register_variable(lbuf, val, globals, 0);",
      "1078:         }",
      "1079:       }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1107:         }",
      "1108:       }",
      "1123:       if (is_arr_upload) {",
      "1124:         snprintf(lbuf, llen, \"%s[type][%s]\",",
      "",
      "[Removed Lines]",
      "1111:       if (is_arr_upload) {",
      "1112:         snprintf(lbuf, llen, \"%s_type[%s]\",",
      "1113:                  abuf.c_str(), array_index.c_str());",
      "1114:       } else {",
      "1115:         snprintf(lbuf, llen, \"%s_type\", param);",
      "1116:       }",
      "1117:       if (!is_anonymous) {",
      "1118:         String val(cd, strlen(cd), CopyString);",
      "1119:         safe_php_register_variable(lbuf, val, globals, 0);",
      "1120:       }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "1141:       Variant tempFileName(temp_filename);",
      "1149:       if (is_arr_upload) {",
      "1150:         snprintf(lbuf, llen, \"%s[tmp_name][%s]\",",
      "",
      "[Removed Lines]",
      "1144:       if (!is_anonymous) {",
      "1145:         safe_php_register_variable(param, tempFileName, globals, 1);",
      "1146:       }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "1174:       }",
      "1175:       safe_php_register_variable(lbuf, error_type, files, 0);",
      "1189:       if (is_arr_upload) {",
      "1190:         snprintf(lbuf, llen, \"%s[size][%s]\",",
      "",
      "[Removed Lines]",
      "1178:       if (is_arr_upload) {",
      "1179:         snprintf(lbuf, llen, \"%s_size[%s]\",",
      "1180:                  abuf.c_str(), array_index.c_str());",
      "1181:       } else {",
      "1182:         snprintf(lbuf, llen, \"%s_size\", param);",
      "1183:       }",
      "1184:       if (!is_anonymous) {",
      "1185:         safe_php_register_variable(lbuf, file_size, globals, 0);",
      "1186:       }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "a0d91043362167531f5bb185d849d85587dc7458",
      "candidate_info": {
        "commit_hash": "a0d91043362167531f5bb185d849d85587dc7458",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/a0d91043362167531f5bb185d849d85587dc7458",
        "files": [
          "hphp/runtime/server/upload.cpp"
        ],
        "message": "[security][CVE-2018-6334] kill globals for file uploads in hhvm\n\nCode should look at _GET, _POST, _FILES, etc. directly to avoid security concerns.\n\nThis included both `$GLOBALS` and `register_globals`-like behavior.\n\nCVE-2018-6334",
        "before_after_code_files": [
          "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp"
          ],
          "candidate": [
            "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp"
          ]
        }
      },
      "candidate_diff": {
        "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp": [
          "File: hphp/runtime/server/upload.cpp -> hphp/runtime/server/upload.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: #include \"hphp/runtime/server/upload.h\"",
          "19: #include \"hphp/runtime/base/program-functions.h\"",
          "21: #include \"hphp/runtime/base/request-local.h\"",
          "22: #include \"hphp/runtime/base/zend-printf.h\"",
          "24: #include \"hphp/runtime/ext/apc/ext_apc.h\"",
          "25: #include \"hphp/util/logger.h\"",
          "27: #include \"hphp/util/text-util.h\"",
          "29: #include <folly/FileUtil.h>",
          "31: using std::set;",
          "",
          "[Removed Lines]",
          "20: #include \"hphp/runtime/base/runtime-option.h\"",
          "23: #include \"hphp/runtime/base/php-globals.h\"",
          "26: #include \"hphp/runtime/base/string-util.h\"",
          "28: #include \"hphp/runtime/base/request-event-handler.h\"",
          "",
          "[Added Lines]",
          "21: #include \"hphp/runtime/base/request-event-handler.h\"",
          "23: #include \"hphp/runtime/base/runtime-option.h\"",
          "24: #include \"hphp/runtime/base/string-util.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "714:   std::string array_index, abuf;",
          "715:   char *lbuf=nullptr;",
          "716:   int total_bytes=0, cancel_upload=0, is_arr_upload=0, array_len=0;",
          "718:   std::set<std::string> &uploaded_files = s_rfc1867_data->rfc1867UploadedFiles;",
          "719:   multipart_buffer *mbuff;",
          "720:   int fd=-1;",
          "",
          "[Removed Lines]",
          "717:   int max_file_size=0, skip_upload=0, anonindex=0, is_anonymous;",
          "",
          "[Added Lines]",
          "719:   int max_file_size=0, skip_upload=0, anonindex=0;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "855:       }",
          "857:       if (!param) {",
          "859:         param = (char*)malloc(MAX_SIZE_ANONNAME);",
          "860:         snprintf(param, MAX_SIZE_ANONNAME, \"%u\", anonindex++);",
          "863:       }",
          "",
          "[Removed Lines]",
          "858:         is_anonymous = 1;",
          "861:       } else {",
          "862:         is_anonymous = 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1067:         s = tmp;",
          "1068:       }",
          "1082:       if (is_arr_upload) {",
          "1083:         snprintf(lbuf, llen, \"%s[name][%s]\",",
          "",
          "[Removed Lines]",
          "1070:       Array globals = php_globals_as_array();",
          "1071:       if (!is_anonymous) {",
          "1072:         if (s) {",
          "1073:           String val(s+1, strlen(s+1), CopyString);",
          "1074:           safe_php_register_variable(lbuf, val, globals, 0);",
          "1075:         } else {",
          "1076:           String val(filename, strlen(filename), CopyString);",
          "1077:           safe_php_register_variable(lbuf, val, globals, 0);",
          "1078:         }",
          "1079:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1107:         }",
          "1108:       }",
          "1123:       if (is_arr_upload) {",
          "1124:         snprintf(lbuf, llen, \"%s[type][%s]\",",
          "",
          "[Removed Lines]",
          "1111:       if (is_arr_upload) {",
          "1112:         snprintf(lbuf, llen, \"%s_type[%s]\",",
          "1113:                  abuf.c_str(), array_index.c_str());",
          "1114:       } else {",
          "1115:         snprintf(lbuf, llen, \"%s_type\", param);",
          "1116:       }",
          "1117:       if (!is_anonymous) {",
          "1118:         String val(cd, strlen(cd), CopyString);",
          "1119:         safe_php_register_variable(lbuf, val, globals, 0);",
          "1120:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1141:       Variant tempFileName(temp_filename);",
          "1149:       if (is_arr_upload) {",
          "1150:         snprintf(lbuf, llen, \"%s[tmp_name][%s]\",",
          "",
          "[Removed Lines]",
          "1144:       if (!is_anonymous) {",
          "1145:         safe_php_register_variable(param, tempFileName, globals, 1);",
          "1146:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1174:       }",
          "1175:       safe_php_register_variable(lbuf, error_type, files, 0);",
          "1189:       if (is_arr_upload) {",
          "1190:         snprintf(lbuf, llen, \"%s[size][%s]\",",
          "",
          "[Removed Lines]",
          "1178:       if (is_arr_upload) {",
          "1179:         snprintf(lbuf, llen, \"%s_size[%s]\",",
          "1180:                  abuf.c_str(), array_index.c_str());",
          "1181:       } else {",
          "1182:         snprintf(lbuf, llen, \"%s_size\", param);",
          "1183:       }",
          "1184:       if (!is_anonymous) {",
          "1185:         safe_php_register_variable(lbuf, file_size, globals, 0);",
          "1186:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e905576725361e98f6e540294b7de5fa0d3cbd63",
      "candidate_info": {
        "commit_hash": "e905576725361e98f6e540294b7de5fa0d3cbd63",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/e905576725361e98f6e540294b7de5fa0d3cbd63",
        "files": [
          "hphp/runtime/server/upload.cpp"
        ],
        "message": "[security][CVE-2018-6334] kill globals for file uploads in hhvm\n\nCode should look at _GET, _POST, _FILES, etc. directly to avoid security concerns.\n\nThis included both `$GLOBALS` and `register_globals`-like behavior.\n\nCVE-2018-6334",
        "before_after_code_files": [
          "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp"
          ],
          "candidate": [
            "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp"
          ]
        }
      },
      "candidate_diff": {
        "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp": [
          "File: hphp/runtime/server/upload.cpp -> hphp/runtime/server/upload.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: #include \"hphp/runtime/server/upload.h\"",
          "19: #include \"hphp/runtime/base/program-functions.h\"",
          "21: #include \"hphp/runtime/base/request-local.h\"",
          "22: #include \"hphp/runtime/base/zend-printf.h\"",
          "24: #include \"hphp/runtime/ext/apc/ext_apc.h\"",
          "25: #include \"hphp/util/logger.h\"",
          "27: #include \"hphp/util/text-util.h\"",
          "29: #include <folly/FileUtil.h>",
          "31: using std::set;",
          "",
          "[Removed Lines]",
          "20: #include \"hphp/runtime/base/runtime-option.h\"",
          "23: #include \"hphp/runtime/base/php-globals.h\"",
          "26: #include \"hphp/runtime/base/string-util.h\"",
          "28: #include \"hphp/runtime/base/request-event-handler.h\"",
          "",
          "[Added Lines]",
          "21: #include \"hphp/runtime/base/request-event-handler.h\"",
          "23: #include \"hphp/runtime/base/runtime-option.h\"",
          "24: #include \"hphp/runtime/base/string-util.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "714:   std::string array_index, abuf;",
          "715:   char *lbuf=nullptr;",
          "716:   int total_bytes=0, cancel_upload=0, is_arr_upload=0, array_len=0;",
          "718:   std::set<std::string> &uploaded_files = s_rfc1867_data->rfc1867UploadedFiles;",
          "719:   multipart_buffer *mbuff;",
          "720:   int fd=-1;",
          "",
          "[Removed Lines]",
          "717:   int max_file_size=0, skip_upload=0, anonindex=0, is_anonymous;",
          "",
          "[Added Lines]",
          "719:   int max_file_size=0, skip_upload=0, anonindex=0;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "855:       }",
          "857:       if (!param) {",
          "859:         param = (char*)malloc(MAX_SIZE_ANONNAME);",
          "860:         snprintf(param, MAX_SIZE_ANONNAME, \"%u\", anonindex++);",
          "863:       }",
          "",
          "[Removed Lines]",
          "858:         is_anonymous = 1;",
          "861:       } else {",
          "862:         is_anonymous = 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1067:         s = tmp;",
          "1068:       }",
          "1082:       if (is_arr_upload) {",
          "1083:         snprintf(lbuf, llen, \"%s[name][%s]\",",
          "",
          "[Removed Lines]",
          "1070:       Array globals = php_globals_as_array();",
          "1071:       if (!is_anonymous) {",
          "1072:         if (s) {",
          "1073:           String val(s+1, strlen(s+1), CopyString);",
          "1074:           safe_php_register_variable(lbuf, val, globals, 0);",
          "1075:         } else {",
          "1076:           String val(filename, strlen(filename), CopyString);",
          "1077:           safe_php_register_variable(lbuf, val, globals, 0);",
          "1078:         }",
          "1079:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1107:         }",
          "1108:       }",
          "1123:       if (is_arr_upload) {",
          "1124:         snprintf(lbuf, llen, \"%s[type][%s]\",",
          "",
          "[Removed Lines]",
          "1111:       if (is_arr_upload) {",
          "1112:         snprintf(lbuf, llen, \"%s_type[%s]\",",
          "1113:                  abuf.c_str(), array_index.c_str());",
          "1114:       } else {",
          "1115:         snprintf(lbuf, llen, \"%s_type\", param);",
          "1116:       }",
          "1117:       if (!is_anonymous) {",
          "1118:         String val(cd, strlen(cd), CopyString);",
          "1119:         safe_php_register_variable(lbuf, val, globals, 0);",
          "1120:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1141:       Variant tempFileName(temp_filename);",
          "1149:       if (is_arr_upload) {",
          "1150:         snprintf(lbuf, llen, \"%s[tmp_name][%s]\",",
          "",
          "[Removed Lines]",
          "1144:       if (!is_anonymous) {",
          "1145:         safe_php_register_variable(param, tempFileName, globals, 1);",
          "1146:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1174:       }",
          "1175:       safe_php_register_variable(lbuf, error_type, files, 0);",
          "1189:       if (is_arr_upload) {",
          "1190:         snprintf(lbuf, llen, \"%s[size][%s]\",",
          "",
          "[Removed Lines]",
          "1178:       if (is_arr_upload) {",
          "1179:         snprintf(lbuf, llen, \"%s_size[%s]\",",
          "1180:                  abuf.c_str(), array_index.c_str());",
          "1181:       } else {",
          "1182:         snprintf(lbuf, llen, \"%s_size\", param);",
          "1183:       }",
          "1184:       if (!is_anonymous) {",
          "1185:         safe_php_register_variable(lbuf, file_size, globals, 0);",
          "1186:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "53b0d4cee76e53006bd223ab588448f864e80079",
      "candidate_info": {
        "commit_hash": "53b0d4cee76e53006bd223ab588448f864e80079",
        "repo": "facebook/hhvm",
        "commit_url": "https://github.com/facebook/hhvm/commit/53b0d4cee76e53006bd223ab588448f864e80079",
        "files": [
          "hphp/runtime/server/upload.cpp"
        ],
        "message": "kill register_globals for file uploads in hhvm\n\nSummary:\nPHP 5.4 has killed it already. http://php.net/manual/en/security.globals.php\nCode should look at _GET, _POST, _FILES, etc. directly to avoid security concerns.\n\nCVE-2018-6334\n\nReviewed By: fredemmott\n\nDifferential Revision: D7404027\n\nfbshipit-source-id: 974585bc389c3fd8a0f05b95329e2d9217d1919b",
        "before_after_code_files": [
          "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp"
          ],
          "candidate": [
            "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp"
          ]
        }
      },
      "candidate_diff": {
        "hphp/runtime/server/upload.cpp||hphp/runtime/server/upload.cpp": [
          "File: hphp/runtime/server/upload.cpp -> hphp/runtime/server/upload.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: #include \"hphp/runtime/server/upload.h\"",
          "19: #include \"hphp/runtime/base/program-functions.h\"",
          "21: #include \"hphp/runtime/base/request-local.h\"",
          "22: #include \"hphp/runtime/base/zend-printf.h\"",
          "24: #include \"hphp/runtime/ext/apc/ext_apc.h\"",
          "25: #include \"hphp/util/logger.h\"",
          "27: #include \"hphp/util/text-util.h\"",
          "29: #include <folly/FileUtil.h>",
          "31: using std::set;",
          "",
          "[Removed Lines]",
          "20: #include \"hphp/runtime/base/runtime-option.h\"",
          "23: #include \"hphp/runtime/base/php-globals.h\"",
          "26: #include \"hphp/runtime/base/string-util.h\"",
          "28: #include \"hphp/runtime/base/request-event-handler.h\"",
          "",
          "[Added Lines]",
          "21: #include \"hphp/runtime/base/request-event-handler.h\"",
          "23: #include \"hphp/runtime/base/runtime-option.h\"",
          "24: #include \"hphp/runtime/base/string-util.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "714:   std::string array_index, abuf;",
          "715:   char *lbuf=nullptr;",
          "716:   int total_bytes=0, cancel_upload=0, is_arr_upload=0, array_len=0;",
          "718:   std::set<std::string> &uploaded_files = s_rfc1867_data->rfc1867UploadedFiles;",
          "719:   multipart_buffer *mbuff;",
          "720:   int fd=-1;",
          "",
          "[Removed Lines]",
          "717:   int max_file_size=0, skip_upload=0, anonindex=0, is_anonymous;",
          "",
          "[Added Lines]",
          "719:   int max_file_size=0, skip_upload=0, anonindex=0;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "855:       }",
          "857:       if (!param) {",
          "859:         param = (char*)malloc(MAX_SIZE_ANONNAME);",
          "860:         snprintf(param, MAX_SIZE_ANONNAME, \"%u\", anonindex++);",
          "863:       }",
          "",
          "[Removed Lines]",
          "858:         is_anonymous = 1;",
          "861:       } else {",
          "862:         is_anonymous = 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1067:         s = tmp;",
          "1068:       }",
          "1082:       if (is_arr_upload) {",
          "1083:         snprintf(lbuf, llen, \"%s[name][%s]\",",
          "",
          "[Removed Lines]",
          "1070:       Array globals = php_globals_as_array();",
          "1071:       if (!is_anonymous) {",
          "1072:         if (s) {",
          "1073:           String val(s+1, strlen(s+1), CopyString);",
          "1074:           safe_php_register_variable(lbuf, val, globals, 0);",
          "1075:         } else {",
          "1076:           String val(filename, strlen(filename), CopyString);",
          "1077:           safe_php_register_variable(lbuf, val, globals, 0);",
          "1078:         }",
          "1079:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1107:         }",
          "1108:       }",
          "1123:       if (is_arr_upload) {",
          "1124:         snprintf(lbuf, llen, \"%s[type][%s]\",",
          "",
          "[Removed Lines]",
          "1111:       if (is_arr_upload) {",
          "1112:         snprintf(lbuf, llen, \"%s_type[%s]\",",
          "1113:                  abuf.c_str(), array_index.c_str());",
          "1114:       } else {",
          "1115:         snprintf(lbuf, llen, \"%s_type\", param);",
          "1116:       }",
          "1117:       if (!is_anonymous) {",
          "1118:         String val(cd, strlen(cd), CopyString);",
          "1119:         safe_php_register_variable(lbuf, val, globals, 0);",
          "1120:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1141:       Variant tempFileName(temp_filename);",
          "1149:       if (is_arr_upload) {",
          "1150:         snprintf(lbuf, llen, \"%s[tmp_name][%s]\",",
          "",
          "[Removed Lines]",
          "1144:       if (!is_anonymous) {",
          "1145:         safe_php_register_variable(param, tempFileName, globals, 1);",
          "1146:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1174:       }",
          "1175:       safe_php_register_variable(lbuf, error_type, files, 0);",
          "1189:       if (is_arr_upload) {",
          "1190:         snprintf(lbuf, llen, \"%s[size][%s]\",",
          "",
          "[Removed Lines]",
          "1178:       if (is_arr_upload) {",
          "1179:         snprintf(lbuf, llen, \"%s_size[%s]\",",
          "1180:                  abuf.c_str(), array_index.c_str());",
          "1181:       } else {",
          "1182:         snprintf(lbuf, llen, \"%s_size\", param);",
          "1183:       }",
          "1184:       if (!is_anonymous) {",
          "1185:         safe_php_register_variable(lbuf, file_size, globals, 0);",
          "1186:       }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}