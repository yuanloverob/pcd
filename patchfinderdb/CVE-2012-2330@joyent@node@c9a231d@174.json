{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f5c68b280fa45c9a392794364272ddfc711bc7a0",
      "candidate_info": {
        "commit_hash": "f5c68b280fa45c9a392794364272ddfc711bc7a0",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/f5c68b280fa45c9a392794364272ddfc711bc7a0",
        "files": [
          "benchmark/url.js"
        ],
        "message": "bench: add url parser benchmark",
        "before_after_code_files": [
          "benchmark/url.js||benchmark/url.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "benchmark/url.js||benchmark/url.js": [
          "File: benchmark/url.js -> benchmark/url.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: var url = require('url'),",
          "2:     urls = [",
          "3:       'http://nodejs.org/docs/latest/api/url.html#url_url_format_urlobj',",
          "4:       'http://blog.nodejs.org/',",
          "5:       'https://encrypted.google.com/search?q=url&q=site:npmjs.org&hl=en',",
          "6:       'javascript:alert(\"node is awesome\");',",
          "7:       'some.ran/dom/url.thing?oh=yes#whoo'",
          "8:     ],",
          "9:     paths = [",
          "10:       '../foo/bar?baz=boom',",
          "11:       'foo/bar',",
          "12:       'http://nodejs.org',",
          "13:       './foo/bar?baz'",
          "14:     ];",
          "16: urls.forEach(url.parse);",
          "17: urls.forEach(url.format);",
          "18: urls.forEach(function(u){",
          "19:   paths.forEach(function(p){",
          "20:     url.resolve(u, p);",
          "21:   });",
          "22: });",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "840229a8251955d2b791928875f36d35127dcad0",
      "candidate_info": {
        "commit_hash": "840229a8251955d2b791928875f36d35127dcad0",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/840229a8251955d2b791928875f36d35127dcad0",
        "files": [
          "lib/module.js"
        ],
        "message": "Tidy _resolveFilename",
        "before_after_code_files": [
          "lib/module.js||limodule.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/module.js||limodule.js": [
          "File: lib/module.js -> limodule.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "276:     debug('Module._load REQUEST  ' + (request) + ' parent: ' + parent.id);",
          "277:   }",
          "283:   var cachedModule = Module._cache[filename];",
          "284:   if (cachedModule) {",
          "285:     return cachedModule.exports;",
          "286:   }",
          "291:       var replModule = new Module('repl');",
          "292:       replModule._compile(NativeModule.getSource('repl'), 'repl.js');",
          "293:       NativeModule._cache.repl = replModule;",
          "",
          "[Removed Lines]",
          "279:   var resolved = Module._resolveFilename(request, parent);",
          "280:   var id = resolved[0];",
          "281:   var filename = resolved[1];",
          "288:   if (NativeModule.exists(id)) {",
          "290:     if (id == 'repl') {",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "295:     }",
          "297:     debug('load native module ' + request);",
          "299:   }",
          "303:   if (isMain) {",
          "304:     process.mainModule = module;",
          "",
          "[Removed Lines]",
          "298:     return NativeModule.require(id);",
          "301:   var module = new Module(id, parent);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "319: Module._resolveFilename = function(request, parent) {",
          "320:   if (NativeModule.exists(request)) {",
          "322:   }",
          "324:   var resolvedModule = Module._resolveLookupPaths(request, parent);",
          "",
          "[Removed Lines]",
          "321:     return [request, request];",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "333:   if (!filename) {",
          "334:     throw new Error(\"Cannot find module '\" + request + \"'\");",
          "335:   }",
          "338: };",
          "",
          "[Removed Lines]",
          "336:   id = filename;",
          "337:   return [id, filename];",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "374:   }",
          "376:   require.resolve = function(request) {",
          "378:   };",
          "380:   Object.defineProperty(require, 'paths', { get: function() {",
          "",
          "[Removed Lines]",
          "377:     return Module._resolveFilename(request, self)[1];",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "782277f11a753ded831439ed826448c06fc0f356",
      "candidate_info": {
        "commit_hash": "782277f11a753ded831439ed826448c06fc0f356",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/782277f11a753ded831439ed826448c06fc0f356",
        "files": [
          "AUTHORS",
          "ChangeLog",
          "src/node_version.h"
        ],
        "message": "2012.05.28, Version 0.7.9 (unstable)\n\n* Upgrade V8 to 3.11.1\n\n* Upgrade npm to 1.1.23\n\n* uv: rework reference counting scheme (Ben Noordhuis)\n\n* uv: add interface for joining external event loops (Bert Belder)\n\n* repl, readline: Handle Ctrl+Z and SIGCONT better (Nathan Rajlich)\n\n* fs: 64bit offsets for fs calls (Igor Zinkovsky)\n\n* fs: add sync open flags 'rs' and 'rs+' (Kevin Bowman)\n\n* windows: enable creating directory junctions with fs.symlink (Igor Zinkovsky, Bert Belder)\n\n* windows: fix fs.lstat to properly detect symlinks. (Igor Zinkovsky)\n\n* Fix #3270 Escape url.parse delims (isaacs)\n\n* http: make http.get() accept a URL (Adam Malcontenti-Wilson)\n\n* Cleanup vm module memory leakage (Marcel Laverdet)\n\n* Optimize writing strings with Socket.write (Bert Belder)\n\n* add support for CESU-8 and UTF-16LE encodings (koichik)\n\n* path: add path.sep to get the path separator. (Yi, EungJun)\n\n* net, http: add backlog parameter to .listen() (Erik Dubbelboer)\n\n* debugger: support mirroring Date objects (Fedor Indutny)\n\n* addon: add AtExit() function (Ben Noordhuis)\n\n* net: signal localAddress bind failure in connect (Brian Schroeder)\n\n* util: handle non-string return value in .inspect() (Alex Kocharin)",
        "before_after_code_files": [
          "src/node_version.h||src/node_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/node_version.h||src/node_version.h": [
          "File: src/node_version.h -> src/node_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #define NODE_MAJOR_VERSION 0",
          "30: #define NODE_MINOR_VERSION 7",
          "31: #define NODE_PATCH_VERSION 9",
          "34: #ifndef NODE_STRINGIFY",
          "35: #define NODE_STRINGIFY(n) NODE_STRINGIFY_HELPER(n)",
          "",
          "[Removed Lines]",
          "32: #define NODE_VERSION_IS_RELEASE 0",
          "",
          "[Added Lines]",
          "32: #define NODE_VERSION_IS_RELEASE 1",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8b82abb95327bc8a199136e74a7e6c2bf2577f0b",
      "candidate_info": {
        "commit_hash": "8b82abb95327bc8a199136e74a7e6c2bf2577f0b",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/8b82abb95327bc8a199136e74a7e6c2bf2577f0b",
        "files": [
          "Makefile",
          "doc/changelog-foot.html",
          "doc/changelog-head.html",
          "tools/build-changelog.sh"
        ],
        "message": "Fix #3089 Build changelog.html for website",
        "before_after_code_files": [
          "tools/build-changelog.sh||tools/build-changelog.sh"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/build-changelog.sh||tools/build-changelog.sh": [
          "File: tools/build-changelog.sh -> tools/build-changelog.sh",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: #!/bin/bash",
          "2: cat ChangeLog \\",
          "3:   | sed -E 's|([^/ ]+/[^#]+)#([0-9]+)|[\\1#\\2](https://github.com/\\1/issues/\\2)|g' \\",
          "4:   | sed -E 's| #([0-9]+)| [#\\1](https://github.com/joyent/node/issues/\\1)|g' \\",
          "5:   | sed -E 's|([0-9]+\\.[0-9]+\\.[0-9]+),? Version ([0-9]+\\.[0-9]+\\.[0-9]+)|<a id=\"v\\2\"></a>\\",
          "6: # \\1 Version \\2|g' \\",
          "7:   | sed -E 's|(,? ?)([0-9a-g]{6})[0-9a-g]{34}|\\1[\\2](https://github.com/joyent/node/commit/\\2)|g' \\",
          "8:   | ./node tools/doc/node_modules/.bin/marked > out/doc/changelog-body.html",
          "10: cat doc/changelog-head.html \\",
          "11:     out/doc/changelog-body.html \\",
          "12:     doc/changelog-foot.html \\",
          "13:   | sed -E 's|__VERSION__|v'$(python tools/getnodeversion.py)'|g' \\",
          "14:   > out/doc/changelog.html",
          "16: rm out/doc/changelog-body.html",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "baebd30eeec84d73617183be4b5be92557518d6c",
      "candidate_info": {
        "commit_hash": "baebd30eeec84d73617183be4b5be92557518d6c",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/baebd30eeec84d73617183be4b5be92557518d6c",
        "files": [
          "lib/http.js"
        ],
        "message": "http: use `self` insted of `this`",
        "before_after_code_files": [
          "lib/http.js||lihttp.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/http.js||lihttp.js": [
          "File: lib/http.js -> lihttp.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "903:       self.requests[name].shift().onSocket(socket);",
          "904:       if (self.requests[name].length === 0) {",
          "907:       }",
          "908:     } else {",
          "",
          "[Removed Lines]",
          "906:         delete this.requests[name];",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}