{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8bd108a0042a75cca34de4f803f6aa62299d0463",
      "candidate_info": {
        "commit_hash": "8bd108a0042a75cca34de4f803f6aa62299d0463",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/8bd108a0042a75cca34de4f803f6aa62299d0463",
        "files": [
          "include/openssl/bn.h"
        ],
        "message": "Fix parameter name, for common aesthetics and to silence IDE warnings.\n\nCLA: trivial\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Ben Kaduk <kaduk@mit.edu>\n(Merged from https://github.com/openssl/openssl/pull/4494)",
        "before_after_code_files": [
          "include/openssl/bn.h||include/openssl/bn.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "include/openssl/bn.h||include/openssl/bn.h": [
          "File: include/openssl/bn.h -> include/openssl/bn.h"
        ]
      }
    },
    {
      "candidate_hash": "e1e59ecada5092fdb71cb20ec3a944733c96bf01",
      "candidate_info": {
        "commit_hash": "e1e59ecada5092fdb71cb20ec3a944733c96bf01",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/e1e59ecada5092fdb71cb20ec3a944733c96bf01",
        "files": [
          "crypto/bio/bss_dgram.c"
        ],
        "message": "crypto/bio/bss_dgram.c: annotate fallthrough (-Wimplicit-fallthrough)\n\nSigned-off-by: Patrick Steuer <patrick.steuer@de.ibm.com>\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4916)\n\n(cherry picked from commit 147167548bb692dc1b772cf4ee1d0917e45b1aff)",
        "before_after_code_files": [
          "crypto/bio/bss_dgram.c||crypto/bio/bss_dgram.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/bio/bss_dgram.c||crypto/bio/bss_dgram.c": [
          "File: crypto/bio/bss_dgram.c -> crypto/bio/bss_dgram.c"
        ]
      }
    },
    {
      "candidate_hash": "a5d0541b1b07e2be305dadb0d01226ea58ff2994",
      "candidate_info": {
        "commit_hash": "a5d0541b1b07e2be305dadb0d01226ea58ff2994",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/a5d0541b1b07e2be305dadb0d01226ea58ff2994",
        "files": [
          "crypto/evp/pmeth_lib.c"
        ],
        "message": "Don't ignore passed ENGINE.\n\nIf we are passed an ENGINE to use in int_ctx_new e.g. via EVP_PKEY_CTX_new()\nuse it instead of the default.\n\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4503)\n\n(cherry picked from commit c2976edf4b22691d8bebb0e3ca2db18b3d0c71c6)",
        "before_after_code_files": [
          "crypto/evp/pmeth_lib.c||crypto/evp/pmeth_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/evp/pmeth_lib.c||crypto/evp/pmeth_lib.c": [
          "File: crypto/evp/pmeth_lib.c -> crypto/evp/pmeth_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "89:         id = pkey->ameth->pkey_id;",
          "90:     }",
          "91: #ifndef OPENSSL_NO_ENGINE",
          "93:         e = pkey->engine;",
          "95:     if (e) {",
          "",
          "[Removed Lines]",
          "92:     if (pkey && pkey->engine)",
          "",
          "[Added Lines]",
          "92:     if (e == NULL && pkey != NULL)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "97:             EVPerr(EVP_F_INT_CTX_NEW, ERR_R_ENGINE_LIB);",
          "98:             return NULL;",
          "99:         }",
          "101:         e = ENGINE_get_pkey_meth_engine(id);",
          "",
          "[Removed Lines]",
          "100:     } else",
          "",
          "[Added Lines]",
          "100:     } else {",
          "102:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "90507fbb5c880e2903be2321f6054b3cebebda4c",
      "candidate_info": {
        "commit_hash": "90507fbb5c880e2903be2321f6054b3cebebda4c",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/90507fbb5c880e2903be2321f6054b3cebebda4c",
        "files": [
          "test/testlib/OpenSSL/Test/Utils.pm"
        ],
        "message": "Fix OpenSSL::Test::Utils::config to actualy load the config data\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4319)\n\n(cherry picked from commit 607f4d564f9540cda6cf5b127f2414625a11741a)",
        "before_after_code_files": [
          "test/testlib/OpenSSL/Test/Utils.pm||test/testliOpenSSL/Test/Utils.pm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/testlib/OpenSSL/Test/Utils.pm||test/testliOpenSSL/Test/Utils.pm": [
          "File: test/testlib/OpenSSL/Test/Utils.pm -> test/testliOpenSSL/Test/Utils.pm",
          "--- Hunk 1 ---",
          "[Context before]",
          "155: }",
          "157: sub config {",
          "158:     return $config{$_[0]};",
          "159: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9433f9f5d945cd413b3f23f05f6681373f601a4a",
      "candidate_info": {
        "commit_hash": "9433f9f5d945cd413b3f23f05f6681373f601a4a",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/9433f9f5d945cd413b3f23f05f6681373f601a4a",
        "files": [
          "test/recipes/80-test_tsa.t"
        ],
        "message": "test/recipes/80-test_tsa.t: Don't trust 'OPENSSL_CONF'\n\nThere's a case when the environment variable OPENSSL_CONF is\nuseless...  when cross compiling for mingw and your wine environment\nhas an environment variable OPENSSL_CONF.  The latter will override\nanything that's given when starting wine and there make the use of\nthat environment variable useless in our tests.\n\nTherefore, we should not trust it, and use explicit '-config' options\ninstead.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3994)\n\n(cherry picked from commit 83e0d090b196f70a9f25ff505d5813745585ef85)",
        "before_after_code_files": [
          "test/recipes/80-test_tsa.t||test/recipes/80-test_tsa.t"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/recipes/80-test_tsa.t||test/recipes/80-test_tsa.t": [
          "File: test/recipes/80-test_tsa.t -> test/recipes/80-test_tsa.t",
          "--- Hunk 1 ---",
          "[Context before]",
          "24: # All these are modified inside indir further down. They need to exist",
          "25: # here, however, to be available in all subroutines.",
          "26: my $testtsa;",
          "27: my $CAtsa;",
          "30: sub create_tsa_cert {",
          "31:     my $INDEX = shift;",
          "",
          "[Removed Lines]",
          "28: my @RUN = (\"openssl\", \"ts\");",
          "",
          "[Added Lines]",
          "26: my $openssl_conf;",
          "29: my @RUN;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "33:     my $r = 1;",
          "34:     $ENV{TSDNSECT} = \"ts_cert_dn\";",
          "37:                 \"-out\", \"tsa_req${INDEX}.pem\",",
          "38:                 \"-keyout\", \"tsa_key${INDEX}.pem\"])));",
          "39:     note \"using extension $EXT\";",
          "",
          "[Removed Lines]",
          "36:     ok(run(app([\"openssl\", \"req\", \"-new\",",
          "",
          "[Added Lines]",
          "37:     ok(run(app([\"openssl\", \"req\", \"-config\", $openssl_conf, \"-new\",",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "42:                 \"-out\", \"tsa_cert${INDEX}.pem\",",
          "43:                 \"-CA\", \"tsaca.pem\", \"-CAkey\", \"tsacakey.pem\",",
          "44:                 \"-CAcreateserial\",",
          "46: }",
          "48: sub create_time_stamp_response {",
          "",
          "[Removed Lines]",
          "45:                 \"-extfile\", $ENV{OPENSSL_CONF}, \"-extensions\", $EXT])));",
          "",
          "[Added Lines]",
          "46:                 \"-extfile\", $openssl_conf, \"-extensions\", $EXT])));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "83: note \"setting up TSA test directory\";",
          "84: indir \"tsa\" => sub",
          "85: {",
          "90:     $testtsa = srctop_file(\"test\", \"recipes\", \"80-test_tsa.t\");",
          "91:     $CAtsa = srctop_file(\"test\", \"CAtsa.cnf\");",
          "93:  SKIP: {",
          "94:      $ENV{TSDNSECT} = \"ts_ca_dn\";",
          "95:      skip \"failed\", 19",
          "97:                             \"-out\", \"tsaca.pem\", \"-keyout\", \"tsacakey.pem\"])),",
          "98:                    'creating a new CA for the TSA tests');",
          "",
          "[Removed Lines]",
          "86:     $ENV{OPENSSL_CONF} = srctop_file(\"test\", \"CAtsa.cnf\");",
          "87:     # Because that's what ../apps/CA.pl really looks at",
          "88:     $ENV{OPENSSL_CONFIG} = \"-config \".$ENV{OPENSSL_CONF};",
          "89:     $ENV{OPENSSL} = cmdstr(app([\"openssl\"]), display => 1);",
          "96:          unless ok(run(app([\"openssl\", \"req\", \"-new\", \"-x509\", \"-nodes\",",
          "",
          "[Added Lines]",
          "87:     $openssl_conf = srctop_file(\"test\", \"CAtsa.cnf\");",
          "90:     @RUN = (\"openssl\", \"ts\", \"-config\", $openssl_conf);",
          "92:     # ../apps/CA.pl needs these",
          "93:     $ENV{OPENSSL_CONFIG} = \"-config $openssl_conf\";",
          "94:     $ENV{OPENSSL} = cmdstr(app([\"openssl\"]), display => 1);",
          "99:          unless ok(run(app([\"openssl\", \"req\", \"-config\", $openssl_conf,",
          "100:                             \"-new\", \"-x509\", \"-nodes\",",
          "",
          "---------------"
        ]
      }
    }
  ]
}