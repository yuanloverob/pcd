{
  "cve_id": "CVE-2014-3617",
  "cve_desc": "The forum_print_latest_discussions function in mod/forum/lib.php in Moodle through 2.4.11, 2.5.x before 2.5.8, 2.6.x before 2.6.5, and 2.7.x before 2.7.2 allows remote authenticated users to bypass the individual answer-posting requirement without the mod/forum:viewqandawithoutposting capability, and discover an author's username, by leveraging the student role and visiting a Q&A forum.",
  "repo": "moodle/moodle",
  "patch_hash": "8f2e80600bf0fc220b92706907fb3d683602e5c2",
  "patch_info": {
    "commit_hash": "8f2e80600bf0fc220b92706907fb3d683602e5c2",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/8f2e80600bf0fc220b92706907fb3d683602e5c2",
    "files": [
      "mod/forum/lib.php"
    ],
    "message": "MDL-46619 Forum: link to the discussion only if users cannot see posts.",
    "before_after_code_files": [
      "mod/forum/lib.php||mod/forum/lib.php"
    ]
  },
  "patch_diff": {
    "mod/forum/lib.php||mod/forum/lib.php": [
      "File: mod/forum/lib.php -> mod/forum/lib.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "3704:     echo '<td class=\"lastpost\">';",
      "3705:     $usedate = (empty($post->timemodified)) ? $post->modified : $post->timemodified;  // Just in case",
      "3707:     $usermodified = new stdClass();",
      "3708:     $usermodified->id = $post->usermodified;",
      "3709:     $usermodified = username_load_fields_from_object($usermodified, $post, 'um');",
      "3710:     if ($canviewparticipants) {",
      "3711:         echo '<a href=\"'.$CFG->wwwroot.'/user/view.php?id='.$post->usermodified.'&amp;course='.$forum->course.'\">'.",
      "3712:              fullname($usermodified).'</a><br />';",
      "3713:     }",
      "3714:     echo '<a href=\"'.$CFG->wwwroot.'/mod/forum/discuss.php?d='.$post->discussion.$parenturl.'\">'.",
      "3715:           userdate($usedate, $datestring).'</a>';",
      "3716:     echo \"</td>\\n\";",
      "",
      "[Removed Lines]",
      "3706:     $parenturl = (empty($post->lastpostid)) ? '' : '&amp;parent='.$post->lastpostid;",
      "",
      "[Added Lines]",
      "3706:     $parenturl = '';",
      "3715:         $parenturl = (empty($post->lastpostid)) ? '' : '&amp;parent='.$post->lastpostid;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "18450eab271119f630061892a968be9a8864d485",
      "candidate_info": {
        "commit_hash": "18450eab271119f630061892a968be9a8864d485",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/18450eab271119f630061892a968be9a8864d485",
        "files": [
          "mod/forum/lib.php"
        ],
        "message": "MDL-47246 mod_forum: Limit last post restriction to Q and A",
        "before_after_code_files": [
          "mod/forum/lib.php||mod/forum/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "mod/forum/lib.php||mod/forum/lib.php"
          ],
          "candidate": [
            "mod/forum/lib.php||mod/forum/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/forum/lib.php||mod/forum/lib.php": [
          "File: mod/forum/lib.php -> mod/forum/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3770:     $usermodified->id = $post->usermodified;",
          "3771:     $usermodified = username_load_fields_from_object($usermodified, $post, 'um');",
          "3775:         echo '<a href=\"'.$CFG->wwwroot.'/user/view.php?id='.$post->usermodified.'&amp;course='.$forum->course.'\">'.",
          "3776:              fullname($usermodified).'</a><br />';",
          "3777:         $parenturl = (empty($post->lastpostid)) ? '' : '&amp;parent='.$post->lastpostid;",
          "",
          "[Removed Lines]",
          "3774:     if ($canviewparticipants) {",
          "",
          "[Added Lines]",
          "3774:     if ($forum->type !== 'qanda' || $canviewparticipants) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "cbebd40dfba711f473761aa187dc6bca749741de",
      "candidate_info": {
        "commit_hash": "cbebd40dfba711f473761aa187dc6bca749741de",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/cbebd40dfba711f473761aa187dc6bca749741de",
        "files": [
          "mod/forum/lib.php"
        ],
        "message": "MDL-47246 mod_forum: Limit last post restriction to Q and A",
        "before_after_code_files": [
          "mod/forum/lib.php||mod/forum/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "mod/forum/lib.php||mod/forum/lib.php"
          ],
          "candidate": [
            "mod/forum/lib.php||mod/forum/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/forum/lib.php||mod/forum/lib.php": [
          "File: mod/forum/lib.php -> mod/forum/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3770:     $usermodified->id = $post->usermodified;",
          "3771:     $usermodified = username_load_fields_from_object($usermodified, $post, 'um');",
          "3775:         echo '<a href=\"'.$CFG->wwwroot.'/user/view.php?id='.$post->usermodified.'&amp;course='.$forum->course.'\">'.",
          "3776:              fullname($usermodified).'</a><br />';",
          "3777:         $parenturl = (empty($post->lastpostid)) ? '' : '&amp;parent='.$post->lastpostid;",
          "",
          "[Removed Lines]",
          "3774:     if ($canviewparticipants) {",
          "",
          "[Added Lines]",
          "3774:     if ($forum->type !== 'qanda' || $canviewparticipants) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ebbff905629fbd87a6a81cc471964e995fba3eb0",
      "candidate_info": {
        "commit_hash": "ebbff905629fbd87a6a81cc471964e995fba3eb0",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/ebbff905629fbd87a6a81cc471964e995fba3eb0",
        "files": [
          "mod/forum/lib.php"
        ],
        "message": "MDL-46619 Forum: link to the discussion only if users cannot see posts.",
        "before_after_code_files": [
          "mod/forum/lib.php||mod/forum/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/forum/lib.php||mod/forum/lib.php"
          ],
          "candidate": [
            "mod/forum/lib.php||mod/forum/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/forum/lib.php||mod/forum/lib.php": [
          "File: mod/forum/lib.php -> mod/forum/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3878:     echo '<td class=\"lastpost\">';",
          "3879:     $usedate = (empty($post->timemodified)) ? $post->modified : $post->timemodified;  // Just in case",
          "3881:     $usermodified = new stdClass();",
          "3882:     $usermodified->id = $post->usermodified;",
          "3883:     $usermodified = username_load_fields_from_object($usermodified, $post, 'um');",
          "3884:     if ($canviewparticipants) {",
          "3885:         echo '<a href=\"'.$CFG->wwwroot.'/user/view.php?id='.$post->usermodified.'&amp;course='.$forum->course.'\">'.",
          "3886:              fullname($usermodified).'</a><br />';",
          "3887:     }",
          "3888:     echo '<a href=\"'.$CFG->wwwroot.'/mod/forum/discuss.php?d='.$post->discussion.$parenturl.'\">'.",
          "3889:           userdate($usedate, $datestring).'</a>';",
          "3890:     echo \"</td>\\n\";",
          "",
          "[Removed Lines]",
          "3880:     $parenturl = (empty($post->lastpostid)) ? '' : '&amp;parent='.$post->lastpostid;",
          "",
          "[Added Lines]",
          "3880:     $parenturl = '';",
          "3889:         $parenturl = (empty($post->lastpostid)) ? '' : '&amp;parent='.$post->lastpostid;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a80ed84ed37d24e564b0bb7b8d51c4206b1fcd54",
      "candidate_info": {
        "commit_hash": "a80ed84ed37d24e564b0bb7b8d51c4206b1fcd54",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/a80ed84ed37d24e564b0bb7b8d51c4206b1fcd54",
        "files": [
          "mod/forum/lib.php"
        ],
        "message": "MDL-46619 Forum: link to the discussion only if users cannot see posts.\n\nConflicts:\n\tmod/forum/lib.php",
        "before_after_code_files": [
          "mod/forum/lib.php||mod/forum/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/forum/lib.php||mod/forum/lib.php"
          ],
          "candidate": [
            "mod/forum/lib.php||mod/forum/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/forum/lib.php||mod/forum/lib.php": [
          "File: mod/forum/lib.php -> mod/forum/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3793:     echo '<td class=\"lastpost\">';",
          "3794:     $usedate = (empty($post->timemodified)) ? $post->modified : $post->timemodified;  // Just in case",
          "3796:     $usermodified = new stdClass();",
          "3797:     $usermodified->id        = $post->usermodified;",
          "3798:     $usermodified->firstname = $post->umfirstname;",
          "3799:     $usermodified->lastname  = $post->umlastname;",
          "3800:     if ($canviewparticipants) {",
          "3801:         echo '<a href=\"'.$CFG->wwwroot.'/user/view.php?id='.$post->usermodified.'&amp;course='.$forum->course.'\">'.",
          "3802:              fullname($usermodified).'</a><br />';",
          "3803:     }",
          "3804:     echo '<a href=\"'.$CFG->wwwroot.'/mod/forum/discuss.php?d='.$post->discussion.$parenturl.'\">'.",
          "3805:           userdate($usedate, $datestring).'</a>';",
          "3806:     echo \"</td>\\n\";",
          "",
          "[Removed Lines]",
          "3795:     $parenturl = (empty($post->lastpostid)) ? '' : '&amp;parent='.$post->lastpostid;",
          "",
          "[Added Lines]",
          "3795:     $parenturl = '';",
          "3805:         $parenturl = (empty($post->lastpostid)) ? '' : '&amp;parent='.$post->lastpostid;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1f3066f1977cf9ba36bb2583597af8bc53eb7d0f",
      "candidate_info": {
        "commit_hash": "1f3066f1977cf9ba36bb2583597af8bc53eb7d0f",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/1f3066f1977cf9ba36bb2583597af8bc53eb7d0f",
        "files": [
          "mod/forum/lib.php"
        ],
        "message": "MDL-46619 Forum: link to the discussion only if users cannot see posts.",
        "before_after_code_files": [
          "mod/forum/lib.php||mod/forum/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/forum/lib.php||mod/forum/lib.php"
          ],
          "candidate": [
            "mod/forum/lib.php||mod/forum/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/forum/lib.php||mod/forum/lib.php": [
          "File: mod/forum/lib.php -> mod/forum/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "3884:     echo '<td class=\"lastpost\">';",
          "3885:     $usedate = (empty($post->timemodified)) ? $post->modified : $post->timemodified;  // Just in case",
          "3887:     $usermodified = new stdClass();",
          "3888:     $usermodified->id = $post->usermodified;",
          "3889:     $usermodified = username_load_fields_from_object($usermodified, $post, 'um');",
          "3890:     if ($canviewparticipants) {",
          "3891:         echo '<a href=\"'.$CFG->wwwroot.'/user/view.php?id='.$post->usermodified.'&amp;course='.$forum->course.'\">'.",
          "3892:              fullname($usermodified).'</a><br />';",
          "3893:     }",
          "3894:     echo '<a href=\"'.$CFG->wwwroot.'/mod/forum/discuss.php?d='.$post->discussion.$parenturl.'\">'.",
          "3895:           userdate($usedate, $datestring).'</a>';",
          "3896:     echo \"</td>\\n\";",
          "",
          "[Removed Lines]",
          "3886:     $parenturl = (empty($post->lastpostid)) ? '' : '&amp;parent='.$post->lastpostid;",
          "",
          "[Added Lines]",
          "3886:     $parenturl = '';",
          "3895:         $parenturl = (empty($post->lastpostid)) ? '' : '&amp;parent='.$post->lastpostid;",
          "",
          "---------------"
        ]
      }
    }
  ]
}