{
  "cve_id": "CVE-2016-10161",
  "cve_desc": "The object_common1 function in ext/standard/var_unserializer.c in PHP before 5.6.30, 7.0.x before 7.0.15, and 7.1.x before 7.1.1 allows remote attackers to cause a denial of service (buffer over-read and application crash) via crafted serialized data that is mishandled in a finish_nested_data call.",
  "repo": "php/php-src",
  "patch_hash": "16b3003ffc6393e250f069aa28a78dc5a2c064b2",
  "patch_info": {
    "commit_hash": "16b3003ffc6393e250f069aa28a78dc5a2c064b2",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/16b3003ffc6393e250f069aa28a78dc5a2c064b2",
    "files": [
      "ext/standard/tests/serialize/bug73825.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix bug #73825 - Heap out of bounds read on unserialize in finish_nested_data()",
    "before_after_code_files": [
      "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/serialize/bug73825.phpt||ext/standard/tests/serialize/bug73825.phpt": [
      "File: ext/standard/tests/serialize/bug73825.phpt -> ext/standard/tests/serialize/bug73825.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #73825 Heap out of bounds read on unserialize in finish_nested_data()",
      "3: --FILE--",
      "4: <?php",
      "5: $obj = unserialize('O:8:\"00000000\":');",
      "6: var_dump($obj);",
      "7: ?>",
      "8: --EXPECTF--",
      "9: Warning: Bad unserialize data in %sbug73825.php on line %d",
      "11: Notice: unserialize(): Error at offset 13 of 15 bytes in %sbug73825.php on line %d",
      "12: bool(false)",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "405: {",
      "406:  long elements;",
      "408:  elements = parse_iv2((*p) + 2, p);",
      "410:  (*p) += 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "408:  if( *p >= max - 2) {",
      "409:   zend_error(E_WARNING, \"Bad unserialize data\");",
      "410:   return -1;",
      "411:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "417:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
      "419:  }",
      "421:  return elements;",
      "",
      "[Removed Lines]",
      "418:   return 0;",
      "",
      "[Added Lines]",
      "423:   return -1;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "496: {",
      "497:  YYCTYPE yych;",
      "498:  static const unsigned char yybm[] = {",
      "",
      "[Removed Lines]",
      "495: #line 496 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "500: #line 501 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "552:  yych = *(YYMARKER = ++YYCURSOR);",
      "553:  if (yych == ':') goto yy95;",
      "554: yy3:",
      "556:  { return 0; }",
      "558: yy4:",
      "559:  yych = *(YYMARKER = ++YYCURSOR);",
      "560:  if (yych == ':') goto yy89;",
      "",
      "[Removed Lines]",
      "555: #line 861 \"ext/standard/var_unserializer.re\"",
      "557: #line 558 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "560: #line 875 \"ext/standard/var_unserializer.re\"",
      "562: #line 563 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "597:  goto yy3;",
      "598: yy14:",
      "599:  ++YYCURSOR;",
      "601:  {",
      "603:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
      "605: }",
      "607: yy16:",
      "608:  yych = *++YYCURSOR;",
      "609:  goto yy3;",
      "",
      "[Removed Lines]",
      "600: #line 855 \"ext/standard/var_unserializer.re\"",
      "606: #line 607 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "605: #line 869 \"ext/standard/var_unserializer.re\"",
      "611: #line 612 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "634:  yych = *++YYCURSOR;",
      "635:  if (yych != '\"') goto yy18;",
      "636:  ++YYCURSOR;",
      "638:  {",
      "639:  size_t len, len2, len3, maxlen;",
      "640:  long elements;",
      "",
      "[Removed Lines]",
      "637: #line 708 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "642: #line 717 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "775:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "777:  if (incomplete_class) {",
      "778:   php_store_class_name(*rval, class_name, len2);",
      "779:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "782:  if (elements < 0) {",
      "783:     efree(class_name);",
      "784:     return 0;",
      "785:  }",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "782:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "783: }",
      "785: yy25:",
      "786:  yych = *++YYCURSOR;",
      "787:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "784: #line 785 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "794: #line 795 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "806:  yych = *++YYCURSOR;",
      "807:  if (yych != '\"') goto yy18;",
      "808:  ++YYCURSOR;",
      "810:  {",
      "811:     if (!var_hash) return 0;",
      "813:  INIT_PZVAL(*rval);",
      "817: }",
      "819: yy32:",
      "820:  yych = *++YYCURSOR;",
      "821:  if (yych == '+') goto yy33;",
      "",
      "[Removed Lines]",
      "809: #line 699 \"ext/standard/var_unserializer.re\"",
      "815:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "816:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "818: #line 819 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "819: #line 704 \"ext/standard/var_unserializer.re\"",
      "821:  long elements;",
      "826:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "827:  if (elements < 0) {",
      "828:   return 0;",
      "829:  }",
      "830:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "832: #line 833 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 10 ---",
      "[Context before]",
      "836:  yych = *++YYCURSOR;",
      "837:  if (yych != '{') goto yy18;",
      "838:  ++YYCURSOR;",
      "840:  {",
      "841:  long elements = parse_iv(start + 2);",
      "",
      "[Removed Lines]",
      "839: #line 678 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "853: #line 683 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 11 ---",
      "[Context before]",
      "858:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
      "859: }",
      "861: yy39:",
      "862:  yych = *++YYCURSOR;",
      "863:  if (yych == '+') goto yy40;",
      "",
      "[Removed Lines]",
      "860: #line 861 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "874: #line 875 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 12 ---",
      "[Context before]",
      "878:  yych = *++YYCURSOR;",
      "879:  if (yych != '\"') goto yy18;",
      "880:  ++YYCURSOR;",
      "882:  {",
      "883:  size_t len, maxlen;",
      "884:  char *str;",
      "",
      "[Removed Lines]",
      "881: #line 643 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "895: #line 648 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 13 ---",
      "[Context before]",
      "913:  ZVAL_STRINGL(*rval, str, len, 0);",
      "914:  return 1;",
      "915: }",
      "917: yy46:",
      "918:  yych = *++YYCURSOR;",
      "919:  if (yych == '+') goto yy47;",
      "",
      "[Removed Lines]",
      "916: #line 917 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "930: #line 931 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 14 ---",
      "[Context before]",
      "934:  yych = *++YYCURSOR;",
      "935:  if (yych != '\"') goto yy18;",
      "936:  ++YYCURSOR;",
      "938:  {",
      "939:  size_t len, maxlen;",
      "940:  char *str;",
      "",
      "[Removed Lines]",
      "937: #line 610 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "951: #line 615 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 15 ---",
      "[Context before]",
      "967:  ZVAL_STRINGL(*rval, str, len, 1);",
      "968:  return 1;",
      "969: }",
      "971: yy53:",
      "972:  yych = *++YYCURSOR;",
      "973:  if (yych <= '/') {",
      "",
      "[Removed Lines]",
      "970: #line 971 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "984: #line 985 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 16 ---",
      "[Context before]",
      "1055:  }",
      "1056: yy63:",
      "1057:  ++YYCURSOR;",
      "1059:  {",
      "1060: #if SIZEOF_LONG == 4",
      "1061: use_double:",
      "",
      "[Removed Lines]",
      "1058: #line 600 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1072: #line 605 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 17 ---",
      "[Context before]",
      "1065:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
      "1066:  return 1;",
      "1067: }",
      "1069: yy65:",
      "1070:  yych = *++YYCURSOR;",
      "1071:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1068: #line 1069 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1082: #line 1083 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 18 ---",
      "[Context before]",
      "1124:  yych = *++YYCURSOR;",
      "1125:  if (yych != ';') goto yy18;",
      "1126:  ++YYCURSOR;",
      "1128:  {",
      "1130:  INIT_PZVAL(*rval);",
      "",
      "[Removed Lines]",
      "1127: #line 585 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1141: #line 590 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 19 ---",
      "[Context before]",
      "1140:  return 1;",
      "1141: }",
      "1143: yy76:",
      "1144:  yych = *++YYCURSOR;",
      "1145:  if (yych == 'N') goto yy73;",
      "",
      "[Removed Lines]",
      "1142: #line 1143 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1156: #line 1157 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 20 ---",
      "[Context before]",
      "1166:  if (yych <= '9') goto yy79;",
      "1167:  if (yych != ';') goto yy18;",
      "1168:  ++YYCURSOR;",
      "1170:  {",
      "1171: #if SIZEOF_LONG == 4",
      "1172:  int digits = YYCURSOR - start - 3;",
      "",
      "[Removed Lines]",
      "1169: #line 558 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1183: #line 563 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 21 ---",
      "[Context before]",
      "1193:  ZVAL_LONG(*rval, parse_iv(start + 2));",
      "1194:  return 1;",
      "1195: }",
      "1197: yy83:",
      "1198:  yych = *++YYCURSOR;",
      "1199:  if (yych <= '/') goto yy18;",
      "",
      "[Removed Lines]",
      "1196: #line 1197 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1210: #line 1211 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 22 ---",
      "[Context before]",
      "1201:  yych = *++YYCURSOR;",
      "1202:  if (yych != ';') goto yy18;",
      "1203:  ++YYCURSOR;",
      "1205:  {",
      "1207:  INIT_PZVAL(*rval);",
      "1208:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
      "1209:  return 1;",
      "1210: }",
      "1212: yy87:",
      "1213:  ++YYCURSOR;",
      "1215:  {",
      "1217:  INIT_PZVAL(*rval);",
      "1218:  ZVAL_NULL(*rval);",
      "1219:  return 1;",
      "1220: }",
      "1222: yy89:",
      "1223:  yych = *++YYCURSOR;",
      "1224:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1204: #line 551 \"ext/standard/var_unserializer.re\"",
      "1211: #line 1212 \"ext/standard/var_unserializer.c\"",
      "1214: #line 544 \"ext/standard/var_unserializer.re\"",
      "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1218: #line 556 \"ext/standard/var_unserializer.re\"",
      "1225: #line 1226 \"ext/standard/var_unserializer.c\"",
      "1228: #line 549 \"ext/standard/var_unserializer.re\"",
      "1235: #line 1236 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 23 ---",
      "[Context before]",
      "1241:  if (yych <= '9') goto yy91;",
      "1242:  if (yych != ';') goto yy18;",
      "1243:  ++YYCURSOR;",
      "1245:  {",
      "1246:  long id;",
      "",
      "[Removed Lines]",
      "1244: #line 521 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1258: #line 526 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 24 ---",
      "[Context before]",
      "1265:  return 1;",
      "1266: }",
      "1268: yy95:",
      "1269:  yych = *++YYCURSOR;",
      "1270:  if (yych <= ',') {",
      "",
      "[Removed Lines]",
      "1267: #line 1268 \"ext/standard/var_unserializer.c\"",
      "",
      "[Added Lines]",
      "1281: #line 1282 \"ext/standard/var_unserializer.c\"",
      "",
      "---------------",
      "--- Hunk 25 ---",
      "[Context before]",
      "1287:  if (yych <= '9') goto yy97;",
      "1288:  if (yych != ';') goto yy18;",
      "1289:  ++YYCURSOR;",
      "1291:  {",
      "1292:  long id;",
      "",
      "[Removed Lines]",
      "1290: #line 500 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1304: #line 505 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------",
      "--- Hunk 26 ---",
      "[Context before]",
      "1309:  return 1;",
      "1310: }",
      "1312: }",
      "1316:  return 0;",
      "",
      "[Removed Lines]",
      "1311: #line 1312 \"ext/standard/var_unserializer.c\"",
      "1313: #line 863 \"ext/standard/var_unserializer.re\"",
      "",
      "[Added Lines]",
      "1325: #line 1326 \"ext/standard/var_unserializer.c\"",
      "1327: #line 877 \"ext/standard/var_unserializer.re\"",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "409: {",
      "410:  long elements;",
      "412:  elements = parse_iv2((*p) + 2, p);",
      "414:  (*p) += 2;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "412:  if( *p >= max - 2) {",
      "413:   zend_error(E_WARNING, \"Bad unserialize data\");",
      "414:   return -1;",
      "415:  }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "421:   zend_error(E_WARNING, \"Erroneous data format for unserializing '%s'\", ce->name);",
      "423:  }",
      "425:  return elements;",
      "",
      "[Removed Lines]",
      "422:   return 0;",
      "",
      "[Added Lines]",
      "427:   return -1;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "697: }",
      "699: \"o:\" iv \":\" [\"] {",
      "700:     if (!var_hash) return 0;",
      "702:  INIT_PZVAL(*rval);",
      "706: }",
      "708: object \":\" uiv \":\" [\"] {",
      "",
      "[Removed Lines]",
      "704:  return object_common2(UNSERIALIZE_PASSTHRU,",
      "705:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
      "",
      "[Added Lines]",
      "705:  long elements;",
      "710:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
      "711:  if (elements < 0) {",
      "712:   return 0;",
      "713:  }",
      "714:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "845:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
      "847:  if (incomplete_class) {",
      "848:   php_store_class_name(*rval, class_name, len2);",
      "849:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "856:  if (elements < 0) {",
      "857:     efree(class_name);",
      "858:     return 0;",
      "859:  }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "62c448ab8b0f38489af4b9c02061506b65b00c91",
      "candidate_info": {
        "commit_hash": "62c448ab8b0f38489af4b9c02061506b65b00c91",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/62c448ab8b0f38489af4b9c02061506b65b00c91",
        "files": [
          "Zend/zend_hash.c",
          "Zend/zend_hash.h",
          "ext/standard/var.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed serialize/unserialize problems",
        "before_after_code_files": [
          "Zend/zend_hash.c||Zend/zend_hash.c",
          "Zend/zend_hash.h||Zend/zend_hash.h",
          "ext/standard/var.c||ext/standard/var.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "Zend/zend_hash.c||Zend/zend_hash.c": [
          "File: Zend/zend_hash.c -> Zend/zend_hash.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "138:  HANDLE_UNBLOCK_INTERRUPTIONS();",
          "139: }",
          "141: ZEND_API void zend_hash_packed_to_hash(HashTable *ht)",
          "142: {",
          "143:  HANDLE_BLOCK_INTERRUPTIONS();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "141: ZEND_API void zend_hash_real_init(HashTable *ht, int packed)",
          "142: {",
          "143:  IS_CONSISTENT(ht);",
          "145:  CHECK_INIT(ht, packed);",
          "146: }",
          "",
          "---------------"
        ],
        "Zend/zend_hash.h||Zend/zend_hash.h": [
          "File: Zend/zend_hash.h -> Zend/zend_hash.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "66: #define zend_hash_init(ht, nSize, pHashFunction, pDestructor, persistent)      _zend_hash_init((ht), (nSize), (pDestructor), (persistent) ZEND_FILE_LINE_CC)",
          "67: #define zend_hash_init_ex(ht, nSize, pHashFunction, pDestructor, persistent, bApplyProtection)  _zend_hash_init_ex((ht), (nSize), (pDestructor), (persistent), (bApplyProtection) ZEND_FILE_LINE_CC)",
          "70: ZEND_API void zend_hash_to_packed(HashTable *ht);",
          "",
          "[Removed Lines]",
          "69: ZEND_API  void zend_hash_packed_to_hash(HashTable *ht);",
          "",
          "[Added Lines]",
          "69: ZEND_API void zend_hash_real_init(HashTable *ht, int packed);",
          "70: ZEND_API void zend_hash_packed_to_hash(HashTable *ht);",
          "",
          "---------------"
        ],
        "ext/standard/var.c||ext/standard/var.c": [
          "File: ext/standard/var.c -> ext/standard/var.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "736:  ZVAL_UNDEF(&var_already);",
          "739:   php_add_var_hash(var_hash, Z_ISREF_P(struc)? Z_REFVAL_P(struc) : struc, &var_already TSRMLS_CC) == FAILURE) {",
          "740:   if (Z_ISREF_P(struc)) {",
          "741:    smart_str_appendl(buf, \"R:\", 2);",
          "",
          "[Removed Lines]",
          "738:  if (var_hash &&",
          "",
          "[Added Lines]",
          "738:  if (var_hash &&",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "896:      if ((data = zend_hash_get_current_data_ex(myht, &pos)) == NULL",
          "898:       || (Z_TYPE_P(data) == IS_ARRAY && Z_ARRVAL_P(data)->nApplyCount > 1)",
          "899:      ) {",
          "900:       smart_str_appendl(buf, \"N;\", 2);",
          "",
          "[Removed Lines]",
          "897:       || Z_ARR_P(data) == Z_ARR_P(struc)",
          "",
          "[Added Lines]",
          "896:       || (Z_TYPE_P(data) == IS_ARRAY && Z_TYPE_P(struc) == IS_ARRAY && Z_ARR_P(data) == Z_ARR_P(struc))",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #define VAR_ENTRIES_DBG 0",
          "31: typedef struct {",
          "33:  long used_slots;",
          "34:  void *next;",
          "35: } var_entries;",
          "38: {",
          "39:  var_entries *var_hash = (*var_hashx)->last;",
          "40: #if VAR_ENTRIES_DBG",
          "",
          "[Removed Lines]",
          "32:  zval data[VAR_ENTRIES_MAX];",
          "37: static inline zval *var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Added Lines]",
          "32:  zval *data[VAR_ENTRIES_MAX];",
          "37: static inline void var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:   (*var_hashx)->last = var_hash;",
          "56:  }",
          "60: }",
          "62: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "58:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "59:  return &var_hash->data[var_hash->used_slots++];",
          "",
          "[Added Lines]",
          "58:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "80:   (*var_hashx)->last_dtor = var_hash;",
          "81:  }",
          "85: }",
          "87: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "83:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "84:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "82:  Z_ADDREF_P(rval);",
          "83:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "105:   (*var_hashx)->last_dtor = var_hash;",
          "106:  }",
          "110: }",
          "112: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "",
          "[Removed Lines]",
          "108:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "109:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "107:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "150:  while (var_hash) {",
          "151:   for (i = 0; i < var_hash->used_slots; i++) {",
          "153:   }",
          "154:   next = var_hash->next;",
          "155:   efree(var_hash);",
          "",
          "[Removed Lines]",
          "152:    zval_ptr_dtor(&var_hash->data[i]);",
          "",
          "[Added Lines]",
          "150:    zval_ptr_dtor(var_hash->data[i]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "209: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "212: #line 217 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "210: #line 215 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "277:  while (elements-- > 0) {",
          "278:   zval key, *data, d, *old_data;",
          "281:    return 0;",
          "282:   }",
          "",
          "[Removed Lines]",
          "280:   if (!php_var_unserialize_intern(&key, p, max, NULL TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "278:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "279:    zval_dtor(&key);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "286:    return 0;",
          "287:   }",
          "301:   if (!objprops) {",
          "302:    switch (Z_TYPE(key)) {",
          "",
          "[Removed Lines]",
          "289:   if (var_hash && (*p)[0] != 'R') {",
          "290:    data = var_push(var_hash, data);",
          "291:   } else {",
          "292:    data = &d;",
          "293:   }",
          "295:   ZVAL_UNDEF(data);",
          "296:   if (!php_var_unserialize_intern(data, p, max, var_hash TSRMLS_CC)) {",
          "297:    zval_dtor(&key);",
          "298:    return 0;",
          "299:   }",
          "",
          "[Added Lines]",
          "288:   data = NULL;",
          "289:   ZVAL_UNDEF(&d);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "304:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "305:      var_push_dtor(var_hash, old_data);",
          "306:     }",
          "308:     break;",
          "309:    case IS_STRING:",
          "310:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "311:      var_push_dtor(var_hash, old_data);",
          "312:     }",
          "314:     break;",
          "315:    }",
          "316:   } else {",
          "318:    convert_to_string(&key);",
          "320:   }",
          "322:   zval_dtor(&key);",
          "324:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "325:    (*p)--;",
          "326:    return 0;",
          "",
          "[Removed Lines]",
          "307:     zend_hash_index_update(ht, Z_LVAL(key), data);",
          "313:     zend_symtable_update(ht, Z_STR(key), data);",
          "319:    zend_hash_update(ht, Z_STR(key), data);",
          "",
          "[Added Lines]",
          "297:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "303:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "309:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "314:   if (!php_var_unserialize(data, p, max, var_hash TSRMLS_CC)) {",
          "315:    return 0;",
          "316:   }",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "390:   return 0;",
          "391:  }",
          "393:  if (Z_OBJCE_P(rval) != PHP_IC_ENTRY &&",
          "394:   zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1)) {",
          "396:   ZVAL_STRINGL(&fname, \"__wakeup\", sizeof(\"__wakeup\") - 1);",
          "397:   BG(serialize_lock)++;",
          "398:   call_user_function_ex(CG(function_table), rval, &fname, &retval, 0, 0, 1, NULL TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "387:  if (Z_ISREF_P(rval)) {",
          "388:   rval = Z_REFVAL_P(rval);",
          "389:  }",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "413: #endif",
          "415: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "425: {",
          "426:  const unsigned char *cursor, *limit, *marker, *start;",
          "427:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "416: {",
          "417:  if (var_hash && (*p)[0] != 'R') {",
          "418:   var_push(var_hash, rval);",
          "419:  }",
          "421:  return php_var_unserialize_intern(UNSERIALIZE_PASSTHRU);",
          "422: }",
          "424: PHPAPI int php_var_unserialize_intern(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "433:   return 0;",
          "434:  }",
          "436:  start = cursor;",
          "440: {",
          "441:  YYCTYPE yych;",
          "442:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "439: #line 440 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "424:  if (var_hash && (*p)[0] != 'R') {",
          "425:   var_push(var_hash, rval);",
          "426:  }",
          "431: #line 432 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "496:  yych = *(YYMARKER = ++YYCURSOR);",
          "497:  if (yych == ':') goto yy95;",
          "498: yy3:",
          "500:  { return 0; }",
          "502: yy4:",
          "503:  yych = *(YYMARKER = ++YYCURSOR);",
          "504:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "499: #line 777 \"ext/standard/var_unserializer.re\"",
          "501: #line 502 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "491: #line 778 \"ext/standard/var_unserializer.re\"",
          "493: #line 494 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "541:  goto yy3;",
          "542: yy14:",
          "543:  ++YYCURSOR;",
          "545:  {",
          "547:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "549: }",
          "551: yy16:",
          "552:  yych = *++YYCURSOR;",
          "553:  goto yy3;",
          "",
          "[Removed Lines]",
          "544: #line 771 \"ext/standard/var_unserializer.re\"",
          "550: #line 551 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "536: #line 772 \"ext/standard/var_unserializer.re\"",
          "542: #line 543 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "577:  yych = *++YYCURSOR;",
          "578:  if (yych != '\"') goto yy18;",
          "579:  ++YYCURSOR;",
          "581:  {",
          "582:  size_t len, len2, len3, maxlen;",
          "583:  long elements;",
          "",
          "[Removed Lines]",
          "580: #line 632 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "572: #line 633 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "717:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "718: }",
          "720: yy25:",
          "721:  yych = *++YYCURSOR;",
          "722:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "719: #line 720 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "711: #line 712 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "741:  yych = *++YYCURSOR;",
          "742:  if (yych != '\"') goto yy18;",
          "743:  ++YYCURSOR;",
          "745:  {",
          "",
          "[Removed Lines]",
          "744: #line 624 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "736: #line 625 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "749:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "750:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "751: }",
          "753: yy32:",
          "754:  yych = *++YYCURSOR;",
          "755:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "752: #line 753 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "744: #line 745 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "770:  yych = *++YYCURSOR;",
          "771:  if (yych != '{') goto yy18;",
          "772:  ++YYCURSOR;",
          "774:  {",
          "775:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "773: #line 606 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "765: #line 604 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "781:  }",
          "783:  array_init_size(rval, elements);",
          "785:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "786:   return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "778:  zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "789:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "790: }",
          "792: yy39:",
          "793:  yych = *++YYCURSOR;",
          "794:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "791: #line 792 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "786: #line 787 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "809:  yych = *++YYCURSOR;",
          "810:  if (yych != '\"') goto yy18;",
          "811:  ++YYCURSOR;",
          "813:  {",
          "814:  size_t len, maxlen;",
          "815:  char *str;",
          "817:  len = parse_uiv(start + 2);",
          "",
          "[Removed Lines]",
          "812: #line 577 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "807: #line 574 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "834:  YYCURSOR += 2;",
          "838:  ZVAL_STRINGL(rval, str, len);",
          "839:  return 1;",
          "840: }",
          "842: yy46:",
          "843:  yych = *++YYCURSOR;",
          "844:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "841: #line 842 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "834:  efree(str);",
          "837: #line 838 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "859:  yych = *++YYCURSOR;",
          "860:  if (yych != '\"') goto yy18;",
          "861:  ++YYCURSOR;",
          "863:  {",
          "864:  size_t len, maxlen;",
          "865:  char *str;",
          "",
          "[Removed Lines]",
          "862: #line 550 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "858: #line 547 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "886:  ZVAL_STRINGL(rval, str, len);",
          "887:  return 1;",
          "888: }",
          "890: yy53:",
          "891:  yych = *++YYCURSOR;",
          "892:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "889: #line 890 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "885: #line 886 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 26 ---",
          "[Context before]",
          "974:  }",
          "975: yy63:",
          "976:  ++YYCURSOR;",
          "978:  {",
          "979: #if SIZEOF_LONG == 4",
          "980: use_double:",
          "",
          "[Removed Lines]",
          "977: #line 541 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "973: #line 538 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 27 ---",
          "[Context before]",
          "983:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "984:  return 1;",
          "985: }",
          "987: yy65:",
          "988:  yych = *++YYCURSOR;",
          "989:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "986: #line 987 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "982: #line 983 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 28 ---",
          "[Context before]",
          "1042:  yych = *++YYCURSOR;",
          "1043:  if (yych != ';') goto yy18;",
          "1044:  ++YYCURSOR;",
          "1046:  {",
          "",
          "[Removed Lines]",
          "1045: #line 525 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1041: #line 522 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 29 ---",
          "[Context before]",
          "1059:  return 1;",
          "1060: }",
          "1062: yy76:",
          "1063:  yych = *++YYCURSOR;",
          "1064:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1057: #line 1058 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 30 ---",
          "[Context before]",
          "1085:  if (yych <= '9') goto yy79;",
          "1086:  if (yych != ';') goto yy18;",
          "1087:  ++YYCURSOR;",
          "1089:  {",
          "1090: #if SIZEOF_LONG == 4",
          "1091:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1088: #line 499 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1084: #line 496 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 31 ---",
          "[Context before]",
          "1111:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1112:  return 1;",
          "1113: }",
          "1115: yy83:",
          "1116:  yych = *++YYCURSOR;",
          "1117:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1114: #line 1115 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1110: #line 1111 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 32 ---",
          "[Context before]",
          "1119:  yych = *++YYCURSOR;",
          "1120:  if (yych != ';') goto yy18;",
          "1121:  ++YYCURSOR;",
          "1123:  {",
          "1125:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1126:  return 1;",
          "1127: }",
          "1129: yy87:",
          "1130:  ++YYCURSOR;",
          "1132:  {",
          "1134:  ZVAL_NULL(rval);",
          "1135:  return 1;",
          "1136: }",
          "1138: yy89:",
          "1139:  yych = *++YYCURSOR;",
          "1140:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1122: #line 493 \"ext/standard/var_unserializer.re\"",
          "1128: #line 1129 \"ext/standard/var_unserializer.c\"",
          "1131: #line 487 \"ext/standard/var_unserializer.re\"",
          "1137: #line 1138 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1118: #line 490 \"ext/standard/var_unserializer.re\"",
          "1124: #line 1125 \"ext/standard/var_unserializer.c\"",
          "1127: #line 484 \"ext/standard/var_unserializer.re\"",
          "1133: #line 1134 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 33 ---",
          "[Context before]",
          "1157:  if (yych <= '9') goto yy91;",
          "1158:  if (yych != ';') goto yy18;",
          "1159:  ++YYCURSOR;",
          "1161:  {",
          "1162:  long id;",
          "",
          "[Removed Lines]",
          "1160: #line 464 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1156: #line 461 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 34 ---",
          "[Context before]",
          "1170:  }",
          "1175:  if (!ZVAL_IS_UNDEF(rval)) {",
          "1176:   var_push_dtor_no_addref(var_hash, rval);",
          "",
          "[Removed Lines]",
          "1173:  if (rval == rval_ref) return 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 35 ---",
          "[Context before]",
          "1181:  return 1;",
          "1182: }",
          "1184: yy95:",
          "1185:  yych = *++YYCURSOR;",
          "1186:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1183: #line 1184 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1179: #line 1180 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 36 ---",
          "[Context before]",
          "1203:  if (yych <= '9') goto yy97;",
          "1204:  if (yych != ';') goto yy18;",
          "1205:  ++YYCURSOR;",
          "1207:  {",
          "1208:  long id;",
          "",
          "[Removed Lines]",
          "1206: #line 444 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1202: #line 436 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 37 ---",
          "[Context before]",
          "1218:  if (!ZVAL_IS_UNDEF(rval)) {",
          "1219:   zval_ptr_dtor(rval);",
          "1220:  }",
          "1224:  return 1;",
          "1225: }",
          "1227: }",
          "1231:  return 0;",
          "",
          "[Removed Lines]",
          "1221:  ZVAL_COPY(rval, rval_ref);",
          "1226: #line 1227 \"ext/standard/var_unserializer.c\"",
          "1228: #line 779 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1217:  if (Z_ISREF_P(rval_ref)) {",
          "1218:   ZVAL_COPY(rval, rval_ref);",
          "1219:  } else {",
          "1220:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "1221:   ZVAL_COPY(rval, rval_ref);",
          "1222:  }",
          "1227: #line 1228 \"ext/standard/var_unserializer.c\"",
          "1229: #line 780 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #define VAR_ENTRIES_DBG 0",
          "29: typedef struct {",
          "31:  long used_slots;",
          "32:  void *next;",
          "33: } var_entries;",
          "36: {",
          "37:  var_entries *var_hash = (*var_hashx)->last;",
          "38: #if VAR_ENTRIES_DBG",
          "",
          "[Removed Lines]",
          "30:  zval data[VAR_ENTRIES_MAX];",
          "35: static inline zval *var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Added Lines]",
          "30:  zval *data[VAR_ENTRIES_MAX];",
          "35: static inline void var_push(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:   (*var_hashx)->last = var_hash;",
          "54:  }",
          "58: }",
          "60: PHPAPI void var_push_dtor(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "56:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "57:  return &var_hash->data[var_hash->used_slots++];",
          "",
          "[Added Lines]",
          "56:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "78:   (*var_hashx)->last_dtor = var_hash;",
          "79:  }",
          "83: }",
          "85: PHPAPI void var_push_dtor_no_addref(php_unserialize_data_t *var_hashx, zval *rval)",
          "",
          "[Removed Lines]",
          "81:  ZVAL_COPY(&var_hash->data[var_hash->used_slots], rval);",
          "82:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "80:  Z_ADDREF_P(rval);",
          "81:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "103:   (*var_hashx)->last_dtor = var_hash;",
          "104:  }",
          "108: }",
          "110: static int var_access(php_unserialize_data_t *var_hashx, long id, zval **store)",
          "",
          "[Removed Lines]",
          "106:  ZVAL_COPY_VALUE(&var_hash->data[var_hash->used_slots], rval);",
          "107:  var_hash->used_slots++;",
          "",
          "[Added Lines]",
          "105:  var_hash->data[var_hash->used_slots++] = rval;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "148:  while (var_hash) {",
          "149:   for (i = 0; i < var_hash->used_slots; i++) {",
          "151:   }",
          "152:   next = var_hash->next;",
          "153:   efree(var_hash);",
          "",
          "[Removed Lines]",
          "150:    zval_ptr_dtor(&var_hash->data[i]);",
          "",
          "[Added Lines]",
          "148:    zval_ptr_dtor(var_hash->data[i]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "281:  while (elements-- > 0) {",
          "282:   zval key, *data, d, *old_data;",
          "285:    return 0;",
          "286:   }",
          "",
          "[Removed Lines]",
          "284:   if (!php_var_unserialize_intern(&key, p, max, NULL TSRMLS_CC)) {",
          "",
          "[Added Lines]",
          "282:   if (!php_var_unserialize(&key, p, max, NULL TSRMLS_CC)) {",
          "283:    zval_dtor(&key);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "290:    return 0;",
          "291:   }",
          "305:   if (!objprops) {",
          "306:    switch (Z_TYPE(key)) {",
          "",
          "[Removed Lines]",
          "293:   if (var_hash && (*p)[0] != 'R') {",
          "294:    data = var_push(var_hash, data);",
          "295:   } else {",
          "296:    data = &d;",
          "297:   }",
          "299:   ZVAL_UNDEF(data);",
          "300:   if (!php_var_unserialize_intern(data, p, max, var_hash TSRMLS_CC)) {",
          "301:    zval_dtor(&key);",
          "302:    return 0;",
          "303:   }",
          "",
          "[Added Lines]",
          "292:   data = NULL;",
          "293:   ZVAL_UNDEF(&d);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "308:     if ((old_data = zend_hash_index_find(ht, Z_LVAL(key))) != NULL) {",
          "309:      var_push_dtor(var_hash, old_data);",
          "310:     }",
          "312:     break;",
          "313:    case IS_STRING:",
          "314:     if ((old_data = zend_symtable_find(ht, Z_STR(key))) != NULL) {",
          "315:      var_push_dtor(var_hash, old_data);",
          "316:     }",
          "318:     break;",
          "319:    }",
          "320:   } else {",
          "322:    convert_to_string(&key);",
          "324:   }",
          "326:   zval_dtor(&key);",
          "328:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "329:    (*p)--;",
          "330:    return 0;",
          "",
          "[Removed Lines]",
          "311:     zend_hash_index_update(ht, Z_LVAL(key), data);",
          "317:     zend_symtable_update(ht, Z_STR(key), data);",
          "323:    zend_hash_update(ht, Z_STR(key), data);",
          "",
          "[Added Lines]",
          "301:     data = zend_hash_index_update(ht, Z_LVAL(key), &d);",
          "307:     data = zend_symtable_update(ht, Z_STR(key), &d);",
          "313:    data = zend_hash_update(ht, Z_STR(key), &d);",
          "318:   if (!php_var_unserialize(data, p, max, var_hash TSRMLS_CC)) {",
          "319:    return 0;",
          "320:   }",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "394:   return 0;",
          "395:  }",
          "397:  if (Z_OBJCE_P(rval) != PHP_IC_ENTRY &&",
          "398:   zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1)) {",
          "400:   ZVAL_STRINGL(&fname, \"__wakeup\", sizeof(\"__wakeup\") - 1);",
          "401:   BG(serialize_lock)++;",
          "402:   call_user_function_ex(CG(function_table), rval, &fname, &retval, 0, 0, 1, NULL TSRMLS_CC);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "391:  if (Z_ISREF_P(rval)) {",
          "392:   rval = Z_REFVAL_P(rval);",
          "393:  }",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "417: #endif",
          "419: PHPAPI int php_var_unserialize(UNSERIALIZE_PARAMETER)",
          "429: {",
          "430:  const unsigned char *cursor, *limit, *marker, *start;",
          "431:  zval *rval_ref;",
          "",
          "[Removed Lines]",
          "420: {",
          "421:  if (var_hash && (*p)[0] != 'R') {",
          "422:   var_push(var_hash, rval);",
          "423:  }",
          "425:  return php_var_unserialize_intern(UNSERIALIZE_PASSTHRU);",
          "426: }",
          "428: PHPAPI int php_var_unserialize_intern(UNSERIALIZE_PARAMETER)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "437:   return 0;",
          "438:  }",
          "440:  start = cursor;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "428:  if (var_hash && (*p)[0] != 'R') {",
          "429:   var_push(var_hash, rval);",
          "430:  }",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "455:  if (!ZVAL_IS_UNDEF(rval)) {",
          "456:   zval_ptr_dtor(rval);",
          "457:  }",
          "461:  return 1;",
          "",
          "[Removed Lines]",
          "458:  ZVAL_COPY(rval, rval_ref);",
          "",
          "[Added Lines]",
          "450:  if (Z_ISREF_P(rval_ref)) {",
          "451:   ZVAL_COPY(rval, rval_ref);",
          "452:  } else {",
          "453:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "454:   ZVAL_COPY(rval, rval_ref);",
          "455:  }",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "473:  }",
          "478:  if (!ZVAL_IS_UNDEF(rval)) {",
          "479:   var_push_dtor_no_addref(var_hash, rval);",
          "",
          "[Removed Lines]",
          "476:  if (rval == rval_ref) return 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "598:  YYCURSOR += 2;",
          "602:  ZVAL_STRINGL(rval, str, len);",
          "603:  return 1;",
          "604: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "600:  efree(str);",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "613:  }",
          "615:  array_init_size(rval, elements);",
          "617:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "618:   return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "616:  zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d02f953faf4afdd1576acb1380e4cd3c050ac599",
      "candidate_info": {
        "commit_hash": "d02f953faf4afdd1576acb1380e4cd3c050ac599",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/d02f953faf4afdd1576acb1380e4cd3c050ac599",
        "files": [
          "ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fixed bug #74101 and bug #74614",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt",
          "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug74101.phpt||ext/standard/tests/serialize/bug74101.phpt": [
          "File: ext/standard/tests/serialize/bug74101.phpt -> ext/standard/tests/serialize/bug74101.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74101: Unserialize Heap Use-After-Free (READ: 1) in zval_get_type",
          "3: --FILE--",
          "4: <?php",
          "5: $s = 'O:9:\"Exception\":799999999999999999999999999997:0i:0;a:0:{}i:2;i:0;i:0;R:2;';",
          "6: var_dump(unserialize($s));",
          "7: ?>",
          "8: --EXPECTF--",
          "9: Notice: unserialize(): Error at offset 48 of 74 bytes in %s on line %d",
          "10: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug74614.phpt||ext/standard/tests/serialize/bug74614.phpt": [
          "File: ext/standard/tests/serialize/bug74614.phpt -> ext/standard/tests/serialize/bug74614.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74614: Use-after-free in PHP7's unserialize()",
          "3: --FILE--",
          "4: <?php",
          "6: unserialize('a:3020000000000000000000000000000001:{i:0;a:0:{}i:1;i:2;i:2;i:3;i:3;i:4;i:4;i:5;i:5;i:6;i:6;i:7;i:7;i:8;i:8;R:2;}');",
          "8: ?>",
          "9: --EXPECTF--",
          "10: Notice: unserialize(): Error at offset 38 of 113 bytes in %s on line %d",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "503:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "505:  ht = Z_OBJPROP_P(rval);",
          "506:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "507:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "508:   if (has_wakeup) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "506:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "507:   return 0;",
          "508:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "578:  start = cursor;",
          "582: {",
          "583:  YYCTYPE yych;",
          "584:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "581: #line 582 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "585: #line 586 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "636: yy2:",
          "637:  ++YYCURSOR;",
          "638: yy3:",
          "640:  { return 0; }",
          "642: yy4:",
          "643:  yych = *(YYMARKER = ++YYCURSOR);",
          "644:  if (yych == ':') goto yy17;",
          "",
          "[Removed Lines]",
          "639: #line 959 \"ext/standard/var_unserializer.re\"",
          "641: #line 642 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "643: #line 963 \"ext/standard/var_unserializer.re\"",
          "645: #line 646 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "685:  goto yy3;",
          "686: yy15:",
          "687:  ++YYCURSOR;",
          "689:  {",
          "691:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "693: }",
          "695: yy17:",
          "696:  yych = *++YYCURSOR;",
          "697:  if (yybm[0+yych] & 128) {",
          "",
          "[Removed Lines]",
          "688: #line 953 \"ext/standard/var_unserializer.re\"",
          "694: #line 695 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "692: #line 957 \"ext/standard/var_unserializer.re\"",
          "698: #line 699 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "703:  goto yy3;",
          "704: yy19:",
          "705:  ++YYCURSOR;",
          "707:  {",
          "709:  ZVAL_NULL(rval);",
          "710:  return 1;",
          "711: }",
          "713: yy21:",
          "714:  yych = *++YYCURSOR;",
          "715:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "706: #line 637 \"ext/standard/var_unserializer.re\"",
          "712: #line 713 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "710: #line 641 \"ext/standard/var_unserializer.re\"",
          "716: #line 717 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "959:  goto yy18;",
          "960: yy63:",
          "961:  ++YYCURSOR;",
          "963:  {",
          "964:  zend_long id;",
          "",
          "[Removed Lines]",
          "962: #line 586 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "966: #line 590 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "986:  return 1;",
          "987: }",
          "989: yy65:",
          "990:  yych = *++YYCURSOR;",
          "991:  if (yych == '\"') goto yy84;",
          "",
          "[Removed Lines]",
          "988: #line 989 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "992: #line 993 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "996:  goto yy18;",
          "997: yy67:",
          "998:  ++YYCURSOR;",
          "1000:  {",
          "1002:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1003:  return 1;",
          "1004: }",
          "1006: yy69:",
          "1007:  ++YYCURSOR;",
          "1008:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "",
          "[Removed Lines]",
          "999: #line 643 \"ext/standard/var_unserializer.re\"",
          "1005: #line 1006 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1003: #line 647 \"ext/standard/var_unserializer.re\"",
          "1009: #line 1010 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1022:  }",
          "1023: yy71:",
          "1024:  ++YYCURSOR;",
          "1026:  {",
          "1027: #if SIZEOF_ZEND_LONG == 4",
          "1028: use_double:",
          "",
          "[Removed Lines]",
          "1025: #line 691 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1029: #line 695 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1031:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1032:  return 1;",
          "1033: }",
          "1035: yy73:",
          "1036:  yych = *++YYCURSOR;",
          "1037:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1034: #line 1035 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1038: #line 1039 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1053:  goto yy18;",
          "1054: yy76:",
          "1055:  ++YYCURSOR;",
          "1057:  {",
          "1058: #if SIZEOF_ZEND_LONG == 4",
          "1059:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1056: #line 649 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1060: #line 653 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1079:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1080:  return 1;",
          "1081: }",
          "1083: yy78:",
          "1084:  yych = *++YYCURSOR;",
          "1085:  if (yych == '\"') goto yy92;",
          "1086:  goto yy18;",
          "1087: yy79:",
          "1088:  ++YYCURSOR;",
          "1090:  {",
          "1091:  zend_long id;",
          "",
          "[Removed Lines]",
          "1082: #line 1083 \"ext/standard/var_unserializer.c\"",
          "1089: #line 612 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1086: #line 1087 \"ext/standard/var_unserializer.c\"",
          "1093: #line 616 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1112:  return 1;",
          "1113: }",
          "1115: yy81:",
          "1116:  yych = *++YYCURSOR;",
          "1117:  if (yych == '\"') goto yy94;",
          "1118:  goto yy18;",
          "1119: yy82:",
          "1120:  ++YYCURSOR;",
          "1122:  {",
          "1123:  size_t len, len2, len3, maxlen;",
          "1124:  zend_long elements;",
          "",
          "[Removed Lines]",
          "1114: #line 1115 \"ext/standard/var_unserializer.c\"",
          "1121: #line 801 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1118: #line 1119 \"ext/standard/var_unserializer.c\"",
          "1125: #line 805 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1271:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1272: }",
          "1274: yy84:",
          "1275:  ++YYCURSOR;",
          "1277:  {",
          "1278:  size_t len, maxlen;",
          "1279:  zend_string *str;",
          "",
          "[Removed Lines]",
          "1273: #line 1274 \"ext/standard/var_unserializer.c\"",
          "1276: #line 732 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "1280: #line 736 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1307:  ZVAL_STR(rval, str);",
          "1308:  return 1;",
          "1309: }",
          "1311: yy86:",
          "1312:  ++YYCURSOR;",
          "1314:  {",
          "1315:  zend_long elements = parse_iv(start + 2);",
          "1318:     if (!var_hash) return 0;",
          "1321:   return 0;",
          "1322:  }",
          "",
          "[Removed Lines]",
          "1310: #line 1311 \"ext/standard/var_unserializer.c\"",
          "1313: #line 766 \"ext/standard/var_unserializer.re\"",
          "1320:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "1314: #line 1315 \"ext/standard/var_unserializer.c\"",
          "1317: #line 770 \"ext/standard/var_unserializer.re\"",
          "1324:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1335:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1336: }",
          "1338: yy88:",
          "1339:  yych = *++YYCURSOR;",
          "1340:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1337: #line 1338 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1341: #line 1342 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1359:  goto yy18;",
          "1360: yy92:",
          "1361:  ++YYCURSOR;",
          "1363:  {",
          "1364:  long elements;",
          "1365:     if (!var_hash) return 0;",
          "1367:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "1369:   return 0;",
          "1370:  }",
          "1371:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1372: }",
          "1374: yy94:",
          "1375:  ++YYCURSOR;",
          "1377:  {",
          "1378:  size_t len, maxlen;",
          "1379:  char *str;",
          "",
          "[Removed Lines]",
          "1362: #line 790 \"ext/standard/var_unserializer.re\"",
          "1368:  if (elements < 0) {",
          "1373: #line 1374 \"ext/standard/var_unserializer.c\"",
          "1376: #line 700 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1366: #line 794 \"ext/standard/var_unserializer.re\"",
          "1372:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "1377: #line 1378 \"ext/standard/var_unserializer.c\"",
          "1380: #line 704 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1405:  ZVAL_STRINGL(rval, str, len);",
          "1406:  return 1;",
          "1407: }",
          "1409: yy96:",
          "1410:  yych = *++YYCURSOR;",
          "1411:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1408: #line 1409 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1412: #line 1413 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1413:  goto yy18;",
          "1414: yy97:",
          "1415:  ++YYCURSOR;",
          "1417:  {",
          "",
          "[Removed Lines]",
          "1416: #line 675 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1420: #line 679 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1430:  return 1;",
          "1431: }",
          "1433: }",
          "1437:  return 0;",
          "",
          "[Removed Lines]",
          "1432: #line 1433 \"ext/standard/var_unserializer.c\"",
          "1434: #line 961 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1436: #line 1437 \"ext/standard/var_unserializer.c\"",
          "1438: #line 965 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "507:   && zend_hash_str_exists(&Z_OBJCE_P(rval)->function_table, \"__wakeup\", sizeof(\"__wakeup\")-1);",
          "509:  ht = Z_OBJPROP_P(rval);",
          "510:  zend_hash_extend(ht, zend_hash_num_elements(ht) + elements, (ht->u.flags & HASH_FLAG_PACKED));",
          "511:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, ht, elements, 1)) {",
          "512:   if (has_wakeup) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "510:  if (elements >= HT_MAX_SIZE - zend_hash_num_elements(ht)) {",
          "511:   return 0;",
          "512:  }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "770:     if (!var_hash) return 0;",
          "773:   return 0;",
          "774:  }",
          "",
          "[Removed Lines]",
          "772:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "776:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "792:     if (!var_hash) return 0;",
          "794:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "796:   return 0;",
          "797:  }",
          "798:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "",
          "[Removed Lines]",
          "795:  if (elements < 0) {",
          "",
          "[Added Lines]",
          "799:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "73fe4186370d8ca8bd0b8a4a8f995852cb42fa75",
      "candidate_info": {
        "commit_hash": "73fe4186370d8ca8bd0b8a4a8f995852cb42fa75",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/73fe4186370d8ca8bd0b8a4a8f995852cb42fa75",
        "files": [
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Avoid reallocation",
        "before_after_code_files": [
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "187: {",
          "188:  size_t i, j;",
          "190:  unsigned char *end = *(unsigned char **)p+maxlen;",
          "192:  if (end < *p) {",
          "194:   return NULL;",
          "195:  }",
          "198:   if (*p >= end) {",
          "200:    return NULL;",
          "201:   }",
          "202:   if (**p != '\\\\') {",
          "204:   } else {",
          "205:    unsigned char ch = 0;",
          "",
          "[Removed Lines]",
          "186: static char *unserialize_str(const unsigned char **p, size_t *len, size_t maxlen)",
          "189:  char *str = safe_emalloc(*len, 1, 1);",
          "193:   efree(str);",
          "197:  for (i = 0; i < *len; i++) {",
          "199:    efree(str);",
          "203:    str[i] = (char)**p;",
          "",
          "[Added Lines]",
          "186: static zend_string *unserialize_str(const unsigned char **p, size_t len, size_t maxlen)",
          "189:  zend_string *str = STR_ALLOC(len, 0);",
          "193:   STR_FREE(str);",
          "197:  for (i = 0; i < len; i++) {",
          "199:    STR_FREE(str);",
          "203:    str->val[i] = (char)**p;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "213:     } else if (**p >= 'A' && **p <= 'F') {",
          "214:      ch = (ch << 4) + (**p -'A'+10);",
          "215:     } else {",
          "217:      return NULL;",
          "218:     }",
          "219:    }",
          "221:   }",
          "222:   (*p)++;",
          "223:  }",
          "226:  return str;",
          "227: }",
          "",
          "[Removed Lines]",
          "216:      efree(str);",
          "220:    str[i] = (char)ch;",
          "224:  str[i] = 0;",
          "",
          "[Added Lines]",
          "216:      STR_FREE(str);",
          "220:    str->val[i] = (char)ch;",
          "224:  str->val[i] = 0;",
          "225:  str->len = i;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "541:  yych = *(YYMARKER = ++YYCURSOR);",
          "542:  if (yych == ':') goto yy95;",
          "543: yy3:",
          "545:  { return 0; }",
          "546: #line 547 \"ext/standard/var_unserializer.c\"",
          "547: yy4:",
          "",
          "[Removed Lines]",
          "544: #line 829 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "544: #line 826 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "586:  goto yy3;",
          "587: yy14:",
          "588:  ++YYCURSOR;",
          "590:  {",
          "592:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "",
          "[Removed Lines]",
          "589: #line 823 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "589: #line 820 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "622:  yych = *++YYCURSOR;",
          "623:  if (yych != '\"') goto yy18;",
          "624:  ++YYCURSOR;",
          "626:  {",
          "627:  size_t len, len2, len3, maxlen;",
          "628:  long elements;",
          "",
          "[Removed Lines]",
          "625: #line 684 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "625: #line 681 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "786:  yych = *++YYCURSOR;",
          "787:  if (yych != '\"') goto yy18;",
          "788:  ++YYCURSOR;",
          "790:  {",
          "",
          "[Removed Lines]",
          "789: #line 676 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "789: #line 673 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "815:  yych = *++YYCURSOR;",
          "816:  if (yych != '{') goto yy18;",
          "817:  ++YYCURSOR;",
          "819:  {",
          "820:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "818: #line 655 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "818: #line 652 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "857:  yych = *++YYCURSOR;",
          "858:  if (yych != '\"') goto yy18;",
          "859:  ++YYCURSOR;",
          "861:  {",
          "862:  size_t len, maxlen;",
          "866:  len = parse_uiv(start + 2);",
          "867:  maxlen = max - YYCURSOR;",
          "",
          "[Removed Lines]",
          "860: #line 625 \"ext/standard/var_unserializer.re\"",
          "864:  char *str;",
          "",
          "[Added Lines]",
          "860: #line 624 \"ext/standard/var_unserializer.re\"",
          "863:  zend_string *str;",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "870:   return 0;",
          "871:  }",
          "874:   return 0;",
          "875:  }",
          "877:  if (*(YYCURSOR) != '\"') {",
          "880:   return 0;",
          "881:  }",
          "",
          "[Removed Lines]",
          "873:  if ((str = unserialize_str(&YYCURSOR, &len, maxlen)) == NULL) {",
          "878:   efree(str);",
          "",
          "[Added Lines]",
          "872:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "877:   STR_FREE(str);",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "883:  YYCURSOR += 2;",
          "888:  return 1;",
          "889: }",
          "891: yy46:",
          "892:  yych = *++YYCURSOR;",
          "893:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "886:  ZVAL_STRINGL(rval, str, len);",
          "887:  efree(str);",
          "890: #line 891 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "885:  ZVAL_STR(rval, str);",
          "888: #line 889 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "908:  yych = *++YYCURSOR;",
          "909:  if (yych != '\"') goto yy18;",
          "910:  ++YYCURSOR;",
          "912:  {",
          "913:  size_t len, maxlen;",
          "914:  char *str;",
          "",
          "[Removed Lines]",
          "911: #line 598 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "909: #line 597 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "935:  ZVAL_STRINGL(rval, str, len);",
          "936:  return 1;",
          "937: }",
          "939: yy53:",
          "940:  yych = *++YYCURSOR;",
          "941:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "938: #line 939 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "936: #line 937 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1023:  }",
          "1024: yy63:",
          "1025:  ++YYCURSOR;",
          "1027:  {",
          "1028: #if SIZEOF_LONG == 4",
          "1029: use_double:",
          "",
          "[Removed Lines]",
          "1026: #line 589 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1024: #line 588 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "1032:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1033:  return 1;",
          "1034: }",
          "1036: yy65:",
          "1037:  yych = *++YYCURSOR;",
          "1038:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1035: #line 1036 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1033: #line 1034 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1091:  yych = *++YYCURSOR;",
          "1092:  if (yych != ';') goto yy18;",
          "1093:  ++YYCURSOR;",
          "1095:  {",
          "",
          "[Removed Lines]",
          "1094: #line 573 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1092: #line 572 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1108:  return 1;",
          "1109: }",
          "1111: yy76:",
          "1112:  yych = *++YYCURSOR;",
          "1113:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1110: #line 1111 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1108: #line 1109 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1134:  if (yych <= '9') goto yy79;",
          "1135:  if (yych != ';') goto yy18;",
          "1136:  ++YYCURSOR;",
          "1138:  {",
          "1139: #if SIZEOF_LONG == 4",
          "1140:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1137: #line 547 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1135: #line 546 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1160:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1161:  return 1;",
          "1162: }",
          "1164: yy83:",
          "1165:  yych = *++YYCURSOR;",
          "1166:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1163: #line 1164 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1161: #line 1162 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1168:  yych = *++YYCURSOR;",
          "1169:  if (yych != ';') goto yy18;",
          "1170:  ++YYCURSOR;",
          "1172:  {",
          "1174:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1175:  return 1;",
          "1176: }",
          "1178: yy87:",
          "1179:  ++YYCURSOR;",
          "1181:  {",
          "1183:  ZVAL_NULL(rval);",
          "1184:  return 1;",
          "1185: }",
          "1187: yy89:",
          "1188:  yych = *++YYCURSOR;",
          "1189:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1171: #line 541 \"ext/standard/var_unserializer.re\"",
          "1177: #line 1178 \"ext/standard/var_unserializer.c\"",
          "1180: #line 535 \"ext/standard/var_unserializer.re\"",
          "1186: #line 1187 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1169: #line 540 \"ext/standard/var_unserializer.re\"",
          "1175: #line 1176 \"ext/standard/var_unserializer.c\"",
          "1178: #line 534 \"ext/standard/var_unserializer.re\"",
          "1184: #line 1185 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1206:  if (yych <= '9') goto yy91;",
          "1207:  if (yych != ';') goto yy18;",
          "1208:  ++YYCURSOR;",
          "1210:  {",
          "1211:  long id;",
          "",
          "[Removed Lines]",
          "1209: #line 512 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1207: #line 511 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1230:  return 1;",
          "1231: }",
          "1233: yy95:",
          "1234:  yych = *++YYCURSOR;",
          "1235:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1232: #line 1233 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1230: #line 1231 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1271:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "1272:   ZVAL_COPY(rval, rval_ref);",
          "1273:  }",
          "1276:  return 1;",
          "1277: }",
          "1279: }",
          "1283:  return 0;",
          "",
          "[Removed Lines]",
          "1278: #line 1279 \"ext/standard/var_unserializer.c\"",
          "1280: #line 831 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1275: #line 1276 \"ext/standard/var_unserializer.c\"",
          "1277: #line 828 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "185: {",
          "186:  size_t i, j;",
          "188:  unsigned char *end = *(unsigned char **)p+maxlen;",
          "190:  if (end < *p) {",
          "192:   return NULL;",
          "193:  }",
          "196:   if (*p >= end) {",
          "198:    return NULL;",
          "199:   }",
          "200:   if (**p != '\\\\') {",
          "202:   } else {",
          "203:    unsigned char ch = 0;",
          "",
          "[Removed Lines]",
          "184: static char *unserialize_str(const unsigned char **p, size_t *len, size_t maxlen)",
          "187:  char *str = safe_emalloc(*len, 1, 1);",
          "191:   efree(str);",
          "195:  for (i = 0; i < *len; i++) {",
          "197:    efree(str);",
          "201:    str[i] = (char)**p;",
          "",
          "[Added Lines]",
          "184: static zend_string *unserialize_str(const unsigned char **p, size_t len, size_t maxlen)",
          "187:  zend_string *str = STR_ALLOC(len, 0);",
          "191:   STR_FREE(str);",
          "195:  for (i = 0; i < len; i++) {",
          "197:    STR_FREE(str);",
          "201:    str->val[i] = (char)**p;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "211:     } else if (**p >= 'A' && **p <= 'F') {",
          "212:      ch = (ch << 4) + (**p -'A'+10);",
          "213:     } else {",
          "215:      return NULL;",
          "216:     }",
          "217:    }",
          "219:   }",
          "220:   (*p)++;",
          "221:  }",
          "224:  return str;",
          "225: }",
          "",
          "[Removed Lines]",
          "214:      efree(str);",
          "218:    str[i] = (char)ch;",
          "222:  str[i] = 0;",
          "",
          "[Added Lines]",
          "214:      STR_FREE(str);",
          "218:    str->val[i] = (char)ch;",
          "222:  str->val[i] = 0;",
          "223:  str->len = i;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "625: \"S:\" uiv \":\" [\"]  {",
          "626:  size_t len, maxlen;",
          "630:  len = parse_uiv(start + 2);",
          "631:  maxlen = max - YYCURSOR;",
          "",
          "[Removed Lines]",
          "628:  char *str;",
          "",
          "[Added Lines]",
          "626:  zend_string *str;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "634:   return 0;",
          "635:  }",
          "638:   return 0;",
          "639:  }",
          "641:  if (*(YYCURSOR) != '\"') {",
          "644:   return 0;",
          "645:  }",
          "",
          "[Removed Lines]",
          "637:  if ((str = unserialize_str(&YYCURSOR, &len, maxlen)) == NULL) {",
          "642:   efree(str);",
          "",
          "[Added Lines]",
          "635:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "640:   STR_FREE(str);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "647:  YYCURSOR += 2;",
          "652:  return 1;",
          "653: }",
          "",
          "[Removed Lines]",
          "650:  ZVAL_STRINGL(rval, str, len);",
          "651:  efree(str);",
          "",
          "[Added Lines]",
          "648:  ZVAL_STR(rval, str);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a871badf2a7a28dc3d69b7e165bcf8a83feac706",
      "candidate_info": {
        "commit_hash": "a871badf2a7a28dc3d69b7e165bcf8a83feac706",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/a871badf2a7a28dc3d69b7e165bcf8a83feac706",
        "files": [
          "NEWS",
          "ext/standard/tests/serialize/bug74103.phpt",
          "ext/standard/tests/serialize/bug75054.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Merge branch 'PHP-7.1' into PHP-7.2",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt",
          "ext/standard/tests/serialize/bug75054.phpt||ext/standard/tests/serialize/bug75054.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug74103.phpt||ext/standard/tests/serialize/bug74103.phpt": [
          "File: ext/standard/tests/serialize/bug74103.phpt -> ext/standard/tests/serialize/bug74103.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #74103: heap-use-after-free when unserializing invalid array size",
          "3: --FILE--",
          "4: <?php",
          "5: var_dump(unserialize('a:7:{i:0;i:04;s:1:\"a\";i:2;i:00009617006;i:4;s:1:\"a\";i:4;s:1:\"a\";R:5;s:1:\"7\";R:3;s:1:\"a\";R:5;;s:18;}}'));",
          "6: ?>",
          "7: --EXPECTF--",
          "8: Notice: unserialize(): Error at offset 68 of 100 bytes in %s on line %d",
          "9: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/tests/serialize/bug75054.phpt||ext/standard/tests/serialize/bug75054.phpt": [
          "File: ext/standard/tests/serialize/bug75054.phpt -> ext/standard/tests/serialize/bug75054.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #75054: A Denial of Service Vulnerability was found when performing deserialization",
          "3: --FILE--",
          "4: <?php",
          "5: $poc = 'a:9:{i:0;s:4:\"0000\";i:0;s:4:\"0000\";i:0;R:2;s:4:\"5003\";R:2;s:4:\"0000\";R:2;s:4:\"0000\";R:2;s:4:\"';",
          "6: $poc .= \"\\x06\";",
          "7: $poc .= '000\";R:2;s:4:\"0000\";d:0;s:4:\"0000\";a:9:{s:4:\"0000\";';",
          "8: var_dump(unserialize($poc));",
          "9: ?>",
          "10: --EXPECTF--",
          "11: Notice: unserialize(): Error at offset 43 of 145 bytes in %s on line %d",
          "12: bool(false)",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "491:    return 0;",
          "492:   }",
          "504:   zval_ptr_dtor(&key);",
          "506:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "",
          "[Removed Lines]",
          "494:   if (UNEXPECTED(Z_ISUNDEF_P(data))) {",
          "495:    if (Z_TYPE(key) == IS_LONG) {",
          "496:     zend_hash_index_del(ht, Z_LVAL(key));",
          "497:    } else {",
          "498:     zend_hash_del_ind(ht, Z_STR(key));",
          "499:    }",
          "500:   } else {",
          "501:    var_push_dtor(var_hash, data);",
          "502:   }",
          "",
          "[Added Lines]",
          "494:   var_push_dtor(var_hash, data);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "661:  start = cursor;",
          "665: {",
          "666:  YYCTYPE yych;",
          "667:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "664: #line 665 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "655: #line 656 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "698:     0,   0,   0,   0,   0,   0,   0,   0,",
          "699:     0,   0,   0,   0,   0,   0,   0,   0,",
          "700:  };",
          "702:  if ((YYLIMIT - YYCURSOR) < 7) YYFILL(7);",
          "703:  yych = *YYCURSOR;",
          "704:  switch (yych) {",
          "705:  case 'C':",
          "707:  case 'N': goto yy5;",
          "714:  case 'o': goto yy12;",
          "719:  }",
          "720: yy2:",
          "723: yy3:",
          "725:  { return 0; }",
          "727: yy4:",
          "728:  yych = *(YYMARKER = ++YYCURSOR);",
          "730:  goto yy3;",
          "731: yy5:",
          "732:  yych = *++YYCURSOR;",
          "734:  goto yy3;",
          "735: yy6:",
          "736:  yych = *(YYMARKER = ++YYCURSOR);",
          "738:  goto yy3;",
          "739: yy7:",
          "740:  yych = *(YYMARKER = ++YYCURSOR);",
          "742:  goto yy3;",
          "743: yy8:",
          "744:  yych = *(YYMARKER = ++YYCURSOR);",
          "746:  goto yy3;",
          "747: yy9:",
          "748:  yych = *(YYMARKER = ++YYCURSOR);",
          "750:  goto yy3;",
          "751: yy10:",
          "752:  yych = *(YYMARKER = ++YYCURSOR);",
          "754:  goto yy3;",
          "755: yy11:",
          "756:  yych = *(YYMARKER = ++YYCURSOR);",
          "758:  goto yy3;",
          "759: yy12:",
          "760:  yych = *(YYMARKER = ++YYCURSOR);",
          "762:  goto yy3;",
          "763: yy13:",
          "764:  yych = *(YYMARKER = ++YYCURSOR);",
          "766:  goto yy3;",
          "767: yy14:",
          "768:  ++YYCURSOR;",
          "770:  {",
          "772:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "774: }",
          "779: yy17:",
          "780:  yych = *++YYCURSOR;",
          "781:  if (yybm[0+yych] & 128) {",
          "783:  }",
          "784: yy18:",
          "785:  YYCURSOR = YYMARKER;",
          "786:  goto yy3;",
          "787: yy19:",
          "788:  ++YYCURSOR;",
          "789:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "790:  yych = *YYCURSOR;",
          "791:  if (yybm[0+yych] & 128) {",
          "793:  }",
          "794:  if (yych <= '/') goto yy18;",
          "796:  yych = *++YYCURSOR;",
          "798:  ++YYCURSOR;",
          "800:  {",
          "817:  }",
          "823:   return 0;",
          "824:  }",
          "833:  }",
          "837:  }",
          "841:  {",
          "844:  }",
          "848:  do {",
          "849:   if(!unserialize_allowed_class(class_name, var_hash)) {",
          "",
          "[Removed Lines]",
          "706:  case 'O': goto yy13;",
          "708:  case 'R': goto yy2;",
          "709:  case 'S': goto yy10;",
          "710:  case 'a': goto yy11;",
          "711:  case 'b': goto yy6;",
          "712:  case 'd': goto yy8;",
          "713:  case 'i': goto yy7;",
          "715:  case 'r': goto yy4;",
          "716:  case 's': goto yy9;",
          "717:  case '}': goto yy14;",
          "718:  default: goto yy16;",
          "721:  yych = *(YYMARKER = ++YYCURSOR);",
          "722:  if (yych == ':') goto yy88;",
          "724: #line 1054 \"ext/standard/var_unserializer.re\"",
          "726: #line 727 \"ext/standard/var_unserializer.c\"",
          "729:  if (yych == ':') goto yy83;",
          "733:  if (yych == ';') goto yy81;",
          "737:  if (yych == ':') goto yy77;",
          "741:  if (yych == ':') goto yy71;",
          "745:  if (yych == ':') goto yy48;",
          "749:  if (yych == ':') goto yy42;",
          "753:  if (yych == ':') goto yy36;",
          "757:  if (yych == ':') goto yy30;",
          "761:  if (yych == ':') goto yy24;",
          "765:  if (yych == ':') goto yy17;",
          "769: #line 1048 \"ext/standard/var_unserializer.re\"",
          "775: #line 776 \"ext/standard/var_unserializer.c\"",
          "776: yy16:",
          "777:  yych = *++YYCURSOR;",
          "778:  goto yy3;",
          "782:   goto yy19;",
          "792:   goto yy19;",
          "795:  if (yych >= ';') goto yy18;",
          "797:  if (yych != '\"') goto yy18;",
          "799: #line 896 \"ext/standard/var_unserializer.re\"",
          "801:  size_t len, len2, len3, maxlen;",
          "802:  zend_long elements;",
          "803:  char *str;",
          "804:  zend_string *class_name;",
          "805:  zend_class_entry *ce;",
          "806:  int incomplete_class = 0;",
          "808:  int custom_object = 0;",
          "810:  zval user_func;",
          "811:  zval retval;",
          "812:  zval args[1];",
          "814:     if (!var_hash) return 0;",
          "815:  if (*start == 'C') {",
          "816:   custom_object = 1;",
          "819:  len2 = len = parse_uiv(start + 2);",
          "820:  maxlen = max - YYCURSOR;",
          "821:  if (maxlen < len || len == 0) {",
          "826:  str = (char*)YYCURSOR;",
          "828:  YYCURSOR += len;",
          "830:  if (*(YYCURSOR) != '\"') {",
          "832:   return 0;",
          "834:  if (*(YYCURSOR+1) != ':') {",
          "836:   return 0;",
          "839:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "840:  if (len3 != len)",
          "843:   return 0;",
          "846:  class_name = zend_string_init(str, len, 0);",
          "",
          "[Added Lines]",
          "696:  case 'O': goto yy4;",
          "698:  case 'R': goto yy6;",
          "699:  case 'S': goto yy7;",
          "700:  case 'a': goto yy8;",
          "701:  case 'b': goto yy9;",
          "702:  case 'd': goto yy10;",
          "703:  case 'i': goto yy11;",
          "705:  case 'r': goto yy13;",
          "706:  case 's': goto yy14;",
          "707:  case '}': goto yy15;",
          "708:  default: goto yy2;",
          "711:  ++YYCURSOR;",
          "713: #line 1043 \"ext/standard/var_unserializer.re\"",
          "715: #line 716 \"ext/standard/var_unserializer.c\"",
          "718:  if (yych == ':') goto yy17;",
          "722:  if (yych == ';') goto yy19;",
          "726:  if (yych == ':') goto yy21;",
          "730:  if (yych == ':') goto yy22;",
          "734:  if (yych == ':') goto yy23;",
          "738:  if (yych == ':') goto yy24;",
          "742:  if (yych == ':') goto yy25;",
          "746:  if (yych == ':') goto yy26;",
          "750:  if (yych == ':') goto yy27;",
          "754:  if (yych == ':') goto yy28;",
          "757:  yych = *(YYMARKER = ++YYCURSOR);",
          "758:  if (yych == ':') goto yy29;",
          "759:  goto yy3;",
          "760: yy15:",
          "762: #line 1037 \"ext/standard/var_unserializer.re\"",
          "768: #line 769 \"ext/standard/var_unserializer.c\"",
          "772:   goto yy30;",
          "779: #line 709 \"ext/standard/var_unserializer.re\"",
          "780:  {",
          "782:  ZVAL_NULL(rval);",
          "783:  return 1;",
          "784: }",
          "785: #line 786 \"ext/standard/var_unserializer.c\"",
          "786: yy21:",
          "787:  yych = *++YYCURSOR;",
          "788:  if (yych <= '/') goto yy18;",
          "789:  if (yych <= '9') goto yy32;",
          "790:  goto yy18;",
          "791: yy22:",
          "792:  yych = *++YYCURSOR;",
          "793:  if (yych <= '/') goto yy18;",
          "794:  if (yych <= '9') goto yy34;",
          "795:  goto yy18;",
          "796: yy23:",
          "797:  yych = *++YYCURSOR;",
          "798:  if (yych <= '/') goto yy18;",
          "799:  if (yych <= '9') goto yy36;",
          "800:  goto yy18;",
          "801: yy24:",
          "802:  yych = *++YYCURSOR;",
          "803:  if (yych <= '/') goto yy18;",
          "804:  if (yych <= '1') goto yy38;",
          "805:  goto yy18;",
          "806: yy25:",
          "807:  yych = *++YYCURSOR;",
          "808:  if (yych <= '/') {",
          "809:   if (yych <= ',') {",
          "810:    if (yych == '+') goto yy39;",
          "811:    goto yy18;",
          "812:   } else {",
          "813:    if (yych <= '-') goto yy40;",
          "814:    if (yych <= '.') goto yy41;",
          "815:    goto yy18;",
          "816:   }",
          "817:  } else {",
          "818:   if (yych <= 'I') {",
          "819:    if (yych <= '9') goto yy42;",
          "820:    if (yych <= 'H') goto yy18;",
          "821:    goto yy44;",
          "822:   } else {",
          "823:    if (yych == 'N') goto yy45;",
          "824:    goto yy18;",
          "825:   }",
          "826:  }",
          "827: yy26:",
          "828:  yych = *++YYCURSOR;",
          "829:  if (yych <= ',') {",
          "830:   if (yych == '+') goto yy46;",
          "831:   goto yy18;",
          "832:  } else {",
          "833:   if (yych <= '-') goto yy46;",
          "834:   if (yych <= '/') goto yy18;",
          "835:   if (yych <= '9') goto yy47;",
          "836:   goto yy18;",
          "837:  }",
          "838: yy27:",
          "839:  yych = *++YYCURSOR;",
          "840:  if (yych <= '/') goto yy18;",
          "841:  if (yych <= '9') goto yy49;",
          "842:  goto yy18;",
          "843: yy28:",
          "844:  yych = *++YYCURSOR;",
          "845:  if (yych <= '/') goto yy18;",
          "846:  if (yych <= '9') goto yy51;",
          "847:  goto yy18;",
          "848: yy29:",
          "849:  yych = *++YYCURSOR;",
          "850:  if (yych <= '/') goto yy18;",
          "851:  if (yych <= '9') goto yy53;",
          "852:  goto yy18;",
          "853: yy30:",
          "854:  ++YYCURSOR;",
          "858:   goto yy30;",
          "859:  }",
          "860:  if (yych <= '/') goto yy18;",
          "861:  if (yych <= ':') goto yy55;",
          "862:  goto yy18;",
          "863: yy32:",
          "864:  ++YYCURSOR;",
          "865:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "866:  yych = *YYCURSOR;",
          "867:  if (yych <= '/') goto yy18;",
          "868:  if (yych <= '9') goto yy32;",
          "869:  if (yych == ';') goto yy56;",
          "870:  goto yy18;",
          "871: yy34:",
          "872:  ++YYCURSOR;",
          "873:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "874:  yych = *YYCURSOR;",
          "875:  if (yych <= '/') goto yy18;",
          "876:  if (yych <= '9') goto yy34;",
          "877:  if (yych <= ':') goto yy58;",
          "878:  goto yy18;",
          "879: yy36:",
          "880:  ++YYCURSOR;",
          "881:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "882:  yych = *YYCURSOR;",
          "883:  if (yych <= '/') goto yy18;",
          "884:  if (yych <= '9') goto yy36;",
          "885:  if (yych <= ':') goto yy59;",
          "886:  goto yy18;",
          "887: yy38:",
          "888:  yych = *++YYCURSOR;",
          "889:  if (yych == ';') goto yy60;",
          "890:  goto yy18;",
          "891: yy39:",
          "892:  yych = *++YYCURSOR;",
          "893:  if (yych == '.') goto yy41;",
          "894:  if (yych <= '/') goto yy18;",
          "895:  if (yych <= '9') goto yy42;",
          "896:  goto yy18;",
          "897: yy40:",
          "898:  yych = *++YYCURSOR;",
          "899:  if (yych <= '/') {",
          "900:   if (yych != '.') goto yy18;",
          "901:  } else {",
          "902:   if (yych <= '9') goto yy42;",
          "903:   if (yych == 'I') goto yy44;",
          "904:   goto yy18;",
          "906: yy41:",
          "907:  yych = *++YYCURSOR;",
          "908:  if (yych <= '/') goto yy18;",
          "909:  if (yych <= '9') goto yy62;",
          "910:  goto yy18;",
          "911: yy42:",
          "912:  ++YYCURSOR;",
          "913:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "914:  yych = *YYCURSOR;",
          "915:  if (yych <= ':') {",
          "916:   if (yych <= '.') {",
          "917:    if (yych <= '-') goto yy18;",
          "918:    goto yy62;",
          "919:   } else {",
          "920:    if (yych <= '/') goto yy18;",
          "921:    if (yych <= '9') goto yy42;",
          "922:    goto yy18;",
          "923:   }",
          "924:  } else {",
          "925:   if (yych <= 'E') {",
          "926:    if (yych <= ';') goto yy64;",
          "927:    if (yych <= 'D') goto yy18;",
          "928:    goto yy66;",
          "929:   } else {",
          "930:    if (yych == 'e') goto yy66;",
          "931:    goto yy18;",
          "932:   }",
          "933:  }",
          "934: yy44:",
          "935:  yych = *++YYCURSOR;",
          "936:  if (yych == 'N') goto yy67;",
          "937:  goto yy18;",
          "938: yy45:",
          "939:  yych = *++YYCURSOR;",
          "940:  if (yych == 'A') goto yy68;",
          "941:  goto yy18;",
          "942: yy46:",
          "943:  yych = *++YYCURSOR;",
          "944:  if (yych <= '/') goto yy18;",
          "945:  if (yych >= ':') goto yy18;",
          "946: yy47:",
          "947:  ++YYCURSOR;",
          "948:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "949:  yych = *YYCURSOR;",
          "950:  if (yych <= '/') goto yy18;",
          "951:  if (yych <= '9') goto yy47;",
          "952:  if (yych == ';') goto yy69;",
          "953:  goto yy18;",
          "954: yy49:",
          "955:  ++YYCURSOR;",
          "956:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "957:  yych = *YYCURSOR;",
          "958:  if (yych <= '/') goto yy18;",
          "959:  if (yych <= '9') goto yy49;",
          "960:  if (yych <= ':') goto yy71;",
          "961:  goto yy18;",
          "962: yy51:",
          "963:  ++YYCURSOR;",
          "964:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "965:  yych = *YYCURSOR;",
          "966:  if (yych <= '/') goto yy18;",
          "967:  if (yych <= '9') goto yy51;",
          "968:  if (yych == ';') goto yy72;",
          "969:  goto yy18;",
          "970: yy53:",
          "971:  ++YYCURSOR;",
          "972:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "973:  yych = *YYCURSOR;",
          "975:  if (yych <= '9') goto yy53;",
          "976:  if (yych <= ':') goto yy74;",
          "977:  goto yy18;",
          "978: yy55:",
          "980:  if (yych == '\"') goto yy75;",
          "981:  goto yy18;",
          "982: yy56:",
          "984: #line 660 \"ext/standard/var_unserializer.re\"",
          "986:  zend_long id;",
          "989:  if (!var_hash) return 0;",
          "991:  id = parse_uiv(start + 2) - 1;",
          "992:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "993:   return 0;",
          "996:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1000:  if (Z_ISREF_P(rval_ref)) {",
          "1001:   ZVAL_COPY(rval, rval_ref);",
          "1002:  } else {",
          "1003:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "1004:   ZVAL_COPY(rval, rval_ref);",
          "1005:  }",
          "1007:  return 1;",
          "1008: }",
          "1009: #line 1010 \"ext/standard/var_unserializer.c\"",
          "1010: yy58:",
          "1011:  yych = *++YYCURSOR;",
          "1012:  if (yych == '\"') goto yy77;",
          "1013:  goto yy18;",
          "1014: yy59:",
          "1015:  yych = *++YYCURSOR;",
          "1016:  if (yych == '{') goto yy79;",
          "1017:  goto yy18;",
          "1018: yy60:",
          "1019:  ++YYCURSOR;",
          "1020: #line 715 \"ext/standard/var_unserializer.re\"",
          "1021:  {",
          "1023:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1024:  return 1;",
          "1025: }",
          "1026: #line 1027 \"ext/standard/var_unserializer.c\"",
          "1027: yy62:",
          "1028:  ++YYCURSOR;",
          "1029:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "1030:  yych = *YYCURSOR;",
          "1031:  if (yych <= ';') {",
          "1032:   if (yych <= '/') goto yy18;",
          "1033:   if (yych <= '9') goto yy62;",
          "1034:   if (yych <= ':') goto yy18;",
          "1035:  } else {",
          "1036:   if (yych <= 'E') {",
          "1037:    if (yych <= 'D') goto yy18;",
          "1038:    goto yy66;",
          "1039:   } else {",
          "1040:    if (yych == 'e') goto yy66;",
          "1041:    goto yy18;",
          "1042:   }",
          "1044: yy64:",
          "1045:  ++YYCURSOR;",
          "1046: #line 763 \"ext/standard/var_unserializer.re\"",
          "1047:  {",
          "1048: #if SIZEOF_ZEND_LONG == 4",
          "1049: use_double:",
          "1050: #endif",
          "1052:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1053:  return 1;",
          "1054: }",
          "1055: #line 1056 \"ext/standard/var_unserializer.c\"",
          "1056: yy66:",
          "1057:  yych = *++YYCURSOR;",
          "1058:  if (yych <= ',') {",
          "1059:   if (yych == '+') goto yy81;",
          "1060:   goto yy18;",
          "1061:  } else {",
          "1062:   if (yych <= '-') goto yy81;",
          "1063:   if (yych <= '/') goto yy18;",
          "1064:   if (yych <= '9') goto yy82;",
          "1065:   goto yy18;",
          "1067: yy67:",
          "1068:  yych = *++YYCURSOR;",
          "1069:  if (yych == 'F') goto yy84;",
          "1070:  goto yy18;",
          "1071: yy68:",
          "1072:  yych = *++YYCURSOR;",
          "1073:  if (yych == 'N') goto yy84;",
          "1074:  goto yy18;",
          "1075: yy69:",
          "1076:  ++YYCURSOR;",
          "1077: #line 721 \"ext/standard/var_unserializer.re\"",
          "1079: #if SIZEOF_ZEND_LONG == 4",
          "1080:  int digits = YYCURSOR - start - 3;",
          "1082:  if (start[2] == '-' || start[2] == '+') {",
          "1083:   digits--;",
          "1087:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1088:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1089:    int cmp = strncmp((char*)YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1091:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1092:     goto use_double;",
          "1093:    }",
          "1094:   } else {",
          "1095:    goto use_double;",
          "1096:   }",
          "1097:  }",
          "1098: #endif",
          "1100:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1101:  return 1;",
          "1102: }",
          "1103: #line 1104 \"ext/standard/var_unserializer.c\"",
          "1104: yy71:",
          "1105:  yych = *++YYCURSOR;",
          "1106:  if (yych == '\"') goto yy85;",
          "1107:  goto yy18;",
          "1108: yy72:",
          "1109:  ++YYCURSOR;",
          "1110: #line 685 \"ext/standard/var_unserializer.re\"",
          "1111:  {",
          "1112:  zend_long id;",
          "1115:  if (!var_hash) return 0;",
          "1117:  id = parse_uiv(start + 2) - 1;",
          "1118:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1119:   return 0;",
          "1120:  }",
          "1122:  if (rval_ref == rval) {",
          "1123:   return 0;",
          "1124:  }",
          "1126:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1127:   return 0;",
          "1128:  }",
          "1130:  ZVAL_COPY(rval, rval_ref);",
          "1132:  return 1;",
          "1133: }",
          "1134: #line 1135 \"ext/standard/var_unserializer.c\"",
          "1135: yy74:",
          "1136:  yych = *++YYCURSOR;",
          "1137:  if (yych == '\"') goto yy87;",
          "1138:  goto yy18;",
          "1139: yy75:",
          "1140:  ++YYCURSOR;",
          "1141: #line 885 \"ext/standard/var_unserializer.re\"",
          "1142:  {",
          "1143:  size_t len, len2, len3, maxlen;",
          "1144:  zend_long elements;",
          "1145:  char *str;",
          "1146:  zend_string *class_name;",
          "1147:  zend_class_entry *ce;",
          "1148:  int incomplete_class = 0;",
          "1150:  int custom_object = 0;",
          "1152:  zval user_func;",
          "1153:  zval retval;",
          "1154:  zval args[1];",
          "1156:     if (!var_hash) return 0;",
          "1157:  if (*start == 'C') {",
          "1158:   custom_object = 1;",
          "1159:  }",
          "1161:  len2 = len = parse_uiv(start + 2);",
          "1162:  maxlen = max - YYCURSOR;",
          "1163:  if (maxlen < len || len == 0) {",
          "1165:   return 0;",
          "1166:  }",
          "1168:  str = (char*)YYCURSOR;",
          "1170:  YYCURSOR += len;",
          "1172:  if (*(YYCURSOR) != '\"') {",
          "1174:   return 0;",
          "1175:  }",
          "1176:  if (*(YYCURSOR+1) != ':') {",
          "1178:   return 0;",
          "1179:  }",
          "1181:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "1182:  if (len3 != len)",
          "1183:  {",
          "1185:   return 0;",
          "1186:  }",
          "1188:  class_name = zend_string_init(str, len, 0);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "949:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "950: }",
          "965:  ++YYCURSOR;",
          "967:  {",
          "973:   return 0;",
          "974:  }",
          "976: }",
          "991:  ++YYCURSOR;",
          "993:  {",
          "994:  zend_long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "951: #line 952 \"ext/standard/var_unserializer.c\"",
          "952: yy24:",
          "953:  yych = *++YYCURSOR;",
          "954:  if (yych <= '/') goto yy18;",
          "955:  if (yych >= ':') goto yy18;",
          "956: yy25:",
          "957:  ++YYCURSOR;",
          "958:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "959:  yych = *YYCURSOR;",
          "960:  if (yych <= '/') goto yy18;",
          "961:  if (yych <= '9') goto yy25;",
          "962:  if (yych >= ';') goto yy18;",
          "963:  yych = *++YYCURSOR;",
          "964:  if (yych != '\"') goto yy18;",
          "966: #line 885 \"ext/standard/var_unserializer.re\"",
          "968:  zend_long elements;",
          "969:     if (!var_hash) return 0;",
          "971:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "972:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "975:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "977: #line 978 \"ext/standard/var_unserializer.c\"",
          "978: yy30:",
          "979:  yych = *++YYCURSOR;",
          "980:  if (yych <= '/') goto yy18;",
          "981:  if (yych >= ':') goto yy18;",
          "982: yy31:",
          "983:  ++YYCURSOR;",
          "984:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "985:  yych = *YYCURSOR;",
          "986:  if (yych <= '/') goto yy18;",
          "987:  if (yych <= '9') goto yy31;",
          "988:  if (yych >= ';') goto yy18;",
          "989:  yych = *++YYCURSOR;",
          "990:  if (yych != '{') goto yy18;",
          "992: #line 855 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1293: #line 1294 \"ext/standard/var_unserializer.c\"",
          "1294: yy77:",
          "1296: #line 810 \"ext/standard/var_unserializer.re\"",
          "1298:  size_t len, maxlen;",
          "1299:  zend_string *str;",
          "1301:  len = parse_uiv(start + 2);",
          "1302:  maxlen = max - YYCURSOR;",
          "1303:  if (maxlen < len) {",
          "1308:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "1309:   return 0;",
          "1310:  }",
          "1312:  if (*(YYCURSOR) != '\"') {",
          "1313:   zend_string_free(str);",
          "1315:   return 0;",
          "1316:  }",
          "1318:  if (*(YYCURSOR + 1) != ';') {",
          "1319:   efree(str);",
          "1321:   return 0;",
          "1322:  }",
          "1324:  YYCURSOR += 2;",
          "1327:  ZVAL_STR(rval, str);",
          "1328:  return 1;",
          "1330: #line 1331 \"ext/standard/var_unserializer.c\"",
          "1331: yy79:",
          "1333: #line 844 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1020:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1021: }",
          "1024:  yych = *++YYCURSOR;",
          "1025:  if (yych <= '/') goto yy18;",
          "1026:  if (yych >= ':') goto yy18;",
          "1028:  ++YYCURSOR;",
          "1030:  yych = *YYCURSOR;",
          "1031:  if (yych <= '/') goto yy18;",
          "1034:  yych = *++YYCURSOR;",
          "1036:  ++YYCURSOR;",
          "1038:  {",
          "1062:   return 0;",
          "1063:  }",
          "1070: }",
          "1077:  ++YYCURSOR;",
          "1087:  {",
          "1088:  size_t len, maxlen;",
          "1089:  char *str;",
          "",
          "[Removed Lines]",
          "1022: #line 1023 \"ext/standard/var_unserializer.c\"",
          "1023: yy36:",
          "1027: yy37:",
          "1029:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "1032:  if (yych <= '9') goto yy37;",
          "1033:  if (yych >= ';') goto yy18;",
          "1035:  if (yych != '\"') goto yy18;",
          "1037: #line 821 \"ext/standard/var_unserializer.re\"",
          "1039:  size_t len, maxlen;",
          "1040:  zend_string *str;",
          "1042:  len = parse_uiv(start + 2);",
          "1043:  maxlen = max - YYCURSOR;",
          "1044:  if (maxlen < len) {",
          "1046:   return 0;",
          "1047:  }",
          "1049:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "1050:   return 0;",
          "1051:  }",
          "1053:  if (*(YYCURSOR) != '\"') {",
          "1054:   zend_string_free(str);",
          "1056:   return 0;",
          "1057:  }",
          "1059:  if (*(YYCURSOR + 1) != ';') {",
          "1060:   efree(str);",
          "1065:  YYCURSOR += 2;",
          "1068:  ZVAL_STR(rval, str);",
          "1069:  return 1;",
          "1071: #line 1072 \"ext/standard/var_unserializer.c\"",
          "1072: yy42:",
          "1073:  yych = *++YYCURSOR;",
          "1074:  if (yych <= '/') goto yy18;",
          "1075:  if (yych >= ':') goto yy18;",
          "1076: yy43:",
          "1078:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "1079:  yych = *YYCURSOR;",
          "1080:  if (yych <= '/') goto yy18;",
          "1081:  if (yych <= '9') goto yy43;",
          "1082:  if (yych >= ';') goto yy18;",
          "1083:  yych = *++YYCURSOR;",
          "1084:  if (yych != '\"') goto yy18;",
          "1085:  ++YYCURSOR;",
          "1086: #line 783 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1363: #line 1364 \"ext/standard/var_unserializer.c\"",
          "1364: yy81:",
          "1368: yy82:",
          "1370:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1373:  if (yych <= '9') goto yy82;",
          "1374:  if (yych == ';') goto yy64;",
          "1375:  goto yy18;",
          "1376: yy84:",
          "1378:  if (yych == ';') goto yy89;",
          "1379:  goto yy18;",
          "1380: yy85:",
          "1382: #line 874 \"ext/standard/var_unserializer.re\"",
          "1384:  zend_long elements;",
          "1385:     if (!var_hash) return 0;",
          "1387:  elements = object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR);",
          "1388:  if (elements < 0 || elements >= HT_MAX_SIZE) {",
          "1391:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1393: #line 1394 \"ext/standard/var_unserializer.c\"",
          "1394: yy87:",
          "1396: #line 772 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1121:  }",
          "1122:  return 1;",
          "1123: }",
          "1268:  ++YYCURSOR;",
          "1270:  {",
          "",
          "[Removed Lines]",
          "1124: #line 1125 \"ext/standard/var_unserializer.c\"",
          "1125: yy48:",
          "1126:  yych = *++YYCURSOR;",
          "1127:  if (yych <= '/') {",
          "1128:   if (yych <= ',') {",
          "1129:    if (yych == '+') goto yy52;",
          "1130:    goto yy18;",
          "1131:   } else {",
          "1132:    if (yych <= '-') goto yy50;",
          "1133:    if (yych <= '.') goto yy55;",
          "1134:    goto yy18;",
          "1135:   }",
          "1136:  } else {",
          "1137:   if (yych <= 'I') {",
          "1138:    if (yych <= '9') goto yy53;",
          "1139:    if (yych <= 'H') goto yy18;",
          "1140:    goto yy51;",
          "1141:   } else {",
          "1142:    if (yych != 'N') goto yy18;",
          "1143:   }",
          "1144:  }",
          "1145:  yych = *++YYCURSOR;",
          "1146:  if (yych == 'A') goto yy70;",
          "1147:  goto yy18;",
          "1148: yy50:",
          "1149:  yych = *++YYCURSOR;",
          "1150:  if (yych <= '/') {",
          "1151:   if (yych == '.') goto yy55;",
          "1152:   goto yy18;",
          "1153:  } else {",
          "1154:   if (yych <= '9') goto yy53;",
          "1155:   if (yych != 'I') goto yy18;",
          "1156:  }",
          "1157: yy51:",
          "1158:  yych = *++YYCURSOR;",
          "1159:  if (yych == 'N') goto yy66;",
          "1160:  goto yy18;",
          "1161: yy52:",
          "1162:  yych = *++YYCURSOR;",
          "1163:  if (yych == '.') goto yy55;",
          "1164:  if (yych <= '/') goto yy18;",
          "1165:  if (yych >= ':') goto yy18;",
          "1166: yy53:",
          "1167:  ++YYCURSOR;",
          "1168:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "1169:  yych = *YYCURSOR;",
          "1170:  if (yych <= ':') {",
          "1171:   if (yych <= '.') {",
          "1172:    if (yych <= '-') goto yy18;",
          "1173:    goto yy64;",
          "1174:   } else {",
          "1175:    if (yych <= '/') goto yy18;",
          "1176:    if (yych <= '9') goto yy53;",
          "1177:    goto yy18;",
          "1178:   }",
          "1179:  } else {",
          "1180:   if (yych <= 'E') {",
          "1181:    if (yych <= ';') goto yy58;",
          "1182:    if (yych <= 'D') goto yy18;",
          "1183:    goto yy60;",
          "1184:   } else {",
          "1185:    if (yych == 'e') goto yy60;",
          "1186:    goto yy18;",
          "1187:   }",
          "1188:  }",
          "1189: yy55:",
          "1190:  yych = *++YYCURSOR;",
          "1191:  if (yych <= '/') goto yy18;",
          "1192:  if (yych >= ':') goto yy18;",
          "1193: yy56:",
          "1194:  ++YYCURSOR;",
          "1195:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "1196:  yych = *YYCURSOR;",
          "1197:  if (yych <= ';') {",
          "1198:   if (yych <= '/') goto yy18;",
          "1199:   if (yych <= '9') goto yy56;",
          "1200:   if (yych <= ':') goto yy18;",
          "1201:  } else {",
          "1202:   if (yych <= 'E') {",
          "1203:    if (yych <= 'D') goto yy18;",
          "1204:    goto yy60;",
          "1205:   } else {",
          "1206:    if (yych == 'e') goto yy60;",
          "1207:    goto yy18;",
          "1208:   }",
          "1209:  }",
          "1210: yy58:",
          "1211:  ++YYCURSOR;",
          "1212: #line 774 \"ext/standard/var_unserializer.re\"",
          "1213:  {",
          "1214: #if SIZEOF_ZEND_LONG == 4",
          "1215: use_double:",
          "1216: #endif",
          "1218:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1219:  return 1;",
          "1220: }",
          "1221: #line 1222 \"ext/standard/var_unserializer.c\"",
          "1222: yy60:",
          "1223:  yych = *++YYCURSOR;",
          "1224:  if (yych <= ',') {",
          "1225:   if (yych != '+') goto yy18;",
          "1226:  } else {",
          "1227:   if (yych <= '-') goto yy61;",
          "1228:   if (yych <= '/') goto yy18;",
          "1229:   if (yych <= '9') goto yy62;",
          "1230:   goto yy18;",
          "1231:  }",
          "1232: yy61:",
          "1233:  yych = *++YYCURSOR;",
          "1234:  if (yych <= '/') goto yy18;",
          "1235:  if (yych >= ':') goto yy18;",
          "1236: yy62:",
          "1237:  ++YYCURSOR;",
          "1238:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1239:  yych = *YYCURSOR;",
          "1240:  if (yych <= '/') goto yy18;",
          "1241:  if (yych <= '9') goto yy62;",
          "1242:  if (yych == ';') goto yy58;",
          "1243:  goto yy18;",
          "1244: yy64:",
          "1245:  ++YYCURSOR;",
          "1246:  if ((YYLIMIT - YYCURSOR) < 3) YYFILL(3);",
          "1247:  yych = *YYCURSOR;",
          "1248:  if (yych <= ';') {",
          "1249:   if (yych <= '/') goto yy18;",
          "1250:   if (yych <= '9') goto yy64;",
          "1251:   if (yych <= ':') goto yy18;",
          "1252:   goto yy58;",
          "1253:  } else {",
          "1254:   if (yych <= 'E') {",
          "1255:    if (yych <= 'D') goto yy18;",
          "1256:    goto yy60;",
          "1257:   } else {",
          "1258:    if (yych == 'e') goto yy60;",
          "1259:    goto yy18;",
          "1260:   }",
          "1261:  }",
          "1262: yy66:",
          "1263:  yych = *++YYCURSOR;",
          "1264:  if (yych != 'F') goto yy18;",
          "1265: yy67:",
          "1266:  yych = *++YYCURSOR;",
          "1267:  if (yych != ';') goto yy18;",
          "1269: #line 758 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1434: #line 1435 \"ext/standard/var_unserializer.c\"",
          "1435: yy89:",
          "1437: #line 747 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1283:  return 1;",
          "1284: }",
          "1439: }",
          "1443:  return 0;",
          "",
          "[Removed Lines]",
          "1285: #line 1286 \"ext/standard/var_unserializer.c\"",
          "1286: yy70:",
          "1287:  yych = *++YYCURSOR;",
          "1288:  if (yych == 'N') goto yy67;",
          "1289:  goto yy18;",
          "1290: yy71:",
          "1291:  yych = *++YYCURSOR;",
          "1292:  if (yych <= ',') {",
          "1293:   if (yych != '+') goto yy18;",
          "1294:  } else {",
          "1295:   if (yych <= '-') goto yy72;",
          "1296:   if (yych <= '/') goto yy18;",
          "1297:   if (yych <= '9') goto yy73;",
          "1298:   goto yy18;",
          "1299:  }",
          "1300: yy72:",
          "1301:  yych = *++YYCURSOR;",
          "1302:  if (yych <= '/') goto yy18;",
          "1303:  if (yych >= ':') goto yy18;",
          "1304: yy73:",
          "1305:  ++YYCURSOR;",
          "1306:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1307:  yych = *YYCURSOR;",
          "1308:  if (yych <= '/') goto yy18;",
          "1309:  if (yych <= '9') goto yy73;",
          "1310:  if (yych != ';') goto yy18;",
          "1311:  ++YYCURSOR;",
          "1312: #line 732 \"ext/standard/var_unserializer.re\"",
          "1313:  {",
          "1314: #if SIZEOF_ZEND_LONG == 4",
          "1315:  int digits = YYCURSOR - start - 3;",
          "1317:  if (start[2] == '-' || start[2] == '+') {",
          "1318:   digits--;",
          "1319:  }",
          "1322:  if (digits >= MAX_LENGTH_OF_LONG - 1) {",
          "1323:   if (digits == MAX_LENGTH_OF_LONG - 1) {",
          "1324:    int cmp = strncmp((char*)YYCURSOR - MAX_LENGTH_OF_LONG, long_min_digits, MAX_LENGTH_OF_LONG - 1);",
          "1326:    if (!(cmp < 0 || (cmp == 0 && start[2] == '-'))) {",
          "1327:     goto use_double;",
          "1328:    }",
          "1329:   } else {",
          "1330:    goto use_double;",
          "1331:   }",
          "1332:  }",
          "1333: #endif",
          "1335:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1336:  return 1;",
          "1337: }",
          "1338: #line 1339 \"ext/standard/var_unserializer.c\"",
          "1339: yy77:",
          "1340:  yych = *++YYCURSOR;",
          "1341:  if (yych <= '/') goto yy18;",
          "1342:  if (yych >= '2') goto yy18;",
          "1343:  yych = *++YYCURSOR;",
          "1344:  if (yych != ';') goto yy18;",
          "1345:  ++YYCURSOR;",
          "1346: #line 726 \"ext/standard/var_unserializer.re\"",
          "1347:  {",
          "1349:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1350:  return 1;",
          "1351: }",
          "1352: #line 1353 \"ext/standard/var_unserializer.c\"",
          "1353: yy81:",
          "1354:  ++YYCURSOR;",
          "1355: #line 720 \"ext/standard/var_unserializer.re\"",
          "1356:  {",
          "1358:  ZVAL_NULL(rval);",
          "1359:  return 1;",
          "1360: }",
          "1361: #line 1362 \"ext/standard/var_unserializer.c\"",
          "1362: yy83:",
          "1363:  yych = *++YYCURSOR;",
          "1364:  if (yych <= '/') goto yy18;",
          "1365:  if (yych >= ':') goto yy18;",
          "1366: yy84:",
          "1367:  ++YYCURSOR;",
          "1368:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1369:  yych = *YYCURSOR;",
          "1370:  if (yych <= '/') goto yy18;",
          "1371:  if (yych <= '9') goto yy84;",
          "1372:  if (yych != ';') goto yy18;",
          "1373:  ++YYCURSOR;",
          "1374: #line 695 \"ext/standard/var_unserializer.re\"",
          "1375:  {",
          "1376:  zend_long id;",
          "1379:  if (!var_hash) return 0;",
          "1381:  id = parse_uiv(start + 2) - 1;",
          "1382:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1383:   return 0;",
          "1384:  }",
          "1386:  if (rval_ref == rval) {",
          "1387:   return 0;",
          "1388:  }",
          "1390:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1391:   ZVAL_UNDEF(rval);",
          "1392:   return 1;",
          "1393:  }",
          "1395:  ZVAL_COPY(rval, rval_ref);",
          "1397:  return 1;",
          "1398: }",
          "1399: #line 1400 \"ext/standard/var_unserializer.c\"",
          "1400: yy88:",
          "1401:  yych = *++YYCURSOR;",
          "1402:  if (yych <= '/') goto yy18;",
          "1403:  if (yych >= ':') goto yy18;",
          "1404: yy89:",
          "1405:  ++YYCURSOR;",
          "1406:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1407:  yych = *YYCURSOR;",
          "1408:  if (yych <= '/') goto yy18;",
          "1409:  if (yych <= '9') goto yy89;",
          "1410:  if (yych != ';') goto yy18;",
          "1411:  ++YYCURSOR;",
          "1412: #line 669 \"ext/standard/var_unserializer.re\"",
          "1413:  {",
          "1414:  zend_long id;",
          "1417:  if (!var_hash) return 0;",
          "1419:  id = parse_uiv(start + 2) - 1;",
          "1420:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1421:   return 0;",
          "1422:  }",
          "1424:  zval_ptr_dtor(rval);",
          "1425:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1426:   ZVAL_UNDEF(rval);",
          "1427:   return 1;",
          "1428:  }",
          "1429:  if (Z_ISREF_P(rval_ref)) {",
          "1430:   ZVAL_COPY(rval, rval_ref);",
          "1431:  } else {",
          "1432:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "1433:   ZVAL_COPY(rval, rval_ref);",
          "1434:  }",
          "1436:  return 1;",
          "1437: }",
          "1438: #line 1439 \"ext/standard/var_unserializer.c\"",
          "1440: #line 1056 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1453: #line 1454 \"ext/standard/var_unserializer.c\"",
          "1455: #line 1045 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "495:    return 0;",
          "496:   }",
          "508:   zval_ptr_dtor(&key);",
          "510:   if (elements && *(*p-1) != ';' && *(*p-1) != '}') {",
          "",
          "[Removed Lines]",
          "498:   if (UNEXPECTED(Z_ISUNDEF_P(data))) {",
          "499:    if (Z_TYPE(key) == IS_LONG) {",
          "500:     zend_hash_index_del(ht, Z_LVAL(key));",
          "501:    } else {",
          "502:     zend_hash_del_ind(ht, Z_STR(key));",
          "503:    }",
          "504:   } else {",
          "505:    var_push_dtor(var_hash, data);",
          "506:   }",
          "",
          "[Added Lines]",
          "498:   var_push_dtor(var_hash, data);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "677:   return 0;",
          "678:  }",
          "681:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "684:  }",
          "685:  if (Z_ISREF_P(rval_ref)) {",
          "686:   ZVAL_COPY(rval, rval_ref);",
          "687:  } else {",
          "",
          "[Removed Lines]",
          "680:  zval_ptr_dtor(rval);",
          "682:   ZVAL_UNDEF(rval);",
          "683:   return 1;",
          "",
          "[Added Lines]",
          "672:   return 0;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "708:  }",
          "710:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "713:  }",
          "715:  ZVAL_COPY(rval, rval_ref);",
          "",
          "[Removed Lines]",
          "711:   ZVAL_UNDEF(rval);",
          "712:   return 1;",
          "",
          "[Added Lines]",
          "701:   return 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "09f7bb2082067baab56fe0f04a6531beef253d95",
      "candidate_info": {
        "commit_hash": "09f7bb2082067baab56fe0f04a6531beef253d95",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/09f7bb2082067baab56fe0f04a6531beef253d95",
        "files": [
          "ext/standard/php_var.h",
          "ext/standard/var.c",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Followup for bug #72785\n\nFix incorrect handling of nesting ... need to reset to the old\nvalue afterwards.",
        "before_after_code_files": [
          "ext/standard/php_var.h||ext/standard/php_var.h",
          "ext/standard/var.c||ext/standard/var.c",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/php_var.h||ext/standard/php_var.h": [
          "File: ext/standard/php_var.h -> ext/standard/php_var.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "50: PHPAPI void php_var_serialize_destroy(php_serialize_data_t d);",
          "51: PHPAPI php_unserialize_data_t php_var_unserialize_init(void);",
          "52: PHPAPI void php_var_unserialize_destroy(php_unserialize_data_t d);",
          "53: PHPAPI void php_var_unserialize_set_allowed_classes(php_unserialize_data_t d, HashTable *classes);",
          "55: #define PHP_VAR_SERIALIZE_INIT(d) \\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "53: PHPAPI HashTable *php_var_unserialize_get_allowed_classes(php_unserialize_data_t d);",
          "",
          "---------------"
        ],
        "ext/standard/var.c||ext/standard/var.c": [
          "File: ext/standard/var.c -> ext/standard/var.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1065:  const unsigned char *p;",
          "1066:  php_unserialize_data_t var_hash;",
          "1067:  zval *options = NULL, *classes = NULL;",
          "1070:  if (zend_parse_parameters(ZEND_NUM_ARGS(), \"s|a\", &buf, &buf_len, &options) == FAILURE) {",
          "1071:   RETURN_FALSE;",
          "",
          "[Removed Lines]",
          "1068:  HashTable *class_hash = NULL;",
          "",
          "[Added Lines]",
          "1068:  HashTable *class_hash = NULL, *prev_class_hash;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1078:  p = (const unsigned char*) buf;",
          "1079:  PHP_VAR_UNSERIALIZE_INIT(var_hash);",
          "1081:   classes = zend_hash_str_find(Z_ARRVAL_P(options), \"allowed_classes\", sizeof(\"allowed_classes\")-1);",
          "1082:   if (classes && Z_TYPE_P(classes) != IS_ARRAY && Z_TYPE_P(classes) != IS_TRUE && Z_TYPE_P(classes) != IS_FALSE) {",
          "1083:    php_error_docref(NULL, E_WARNING, \"allowed_classes option should be array or boolean\");",
          "",
          "[Removed Lines]",
          "1080:  if(options != NULL) {",
          "",
          "[Added Lines]",
          "1081:  prev_class_hash = php_var_unserialize_get_allowed_classes(var_hash);",
          "1082:  if (options != NULL) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1104:  }",
          "1106:  if (!php_var_unserialize(return_value, &p, p + buf_len, &var_hash)) {",
          "1112:   zval_ptr_dtor(return_value);",
          "1113:   if (!EG(exception)) {",
          "1114:    php_error_docref(NULL, E_NOTICE, \"Error at offset \" ZEND_LONG_FMT \" of %zd bytes\",",
          "1115:     (zend_long)((char*)p - buf), buf_len);",
          "1116:   }",
          "1126:  }",
          "1129:  if (class_hash) {",
          "1130:   zend_hash_destroy(class_hash);",
          "1131:   FREE_HASHTABLE(class_hash);",
          "1132:  }",
          "1133: }",
          "",
          "[Removed Lines]",
          "1107:   PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "1108:   if (class_hash) {",
          "1109:    zend_hash_destroy(class_hash);",
          "1110:    FREE_HASHTABLE(class_hash);",
          "1111:   }",
          "1117:   RETURN_FALSE;",
          "1118:  }",
          "1121:  var_push_dtor(&var_hash, return_value);",
          "1124:  if (Z_ISREF_P(return_value)) {",
          "1125:   zend_unwrap_reference(return_value);",
          "1128:  PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "",
          "[Added Lines]",
          "1114:   RETVAL_FALSE;",
          "1115:  } else {",
          "1118:   var_push_dtor(&var_hash, return_value);",
          "1121:   if (Z_ISREF_P(return_value)) {",
          "1122:    zend_unwrap_reference(return_value);",
          "1123:   }",
          "1132:  php_var_unserialize_set_allowed_classes(var_hash, prev_class_hash);",
          "1133:  PHP_VAR_UNSERIALIZE_DESTROY(var_hash);",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "59:  }",
          "60: }",
          "62: PHPAPI void php_var_unserialize_set_allowed_classes(php_unserialize_data_t d, HashTable *classes) {",
          "63:  d->allowed_classes = classes;",
          "64: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "62: PHPAPI HashTable *php_var_unserialize_get_allowed_classes(php_unserialize_data_t d) {",
          "63:  return d->allowed_classes;",
          "64: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "280: #define YYMARKER marker",
          "",
          "[Removed Lines]",
          "283: #line 288 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "286: #line 291 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "586:  start = cursor;",
          "590: {",
          "591:  YYCTYPE yych;",
          "592:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "589: #line 590 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "592: #line 593 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "623:     0,   0,   0,   0,   0,   0,   0,   0,",
          "624:     0,   0,   0,   0,   0,   0,   0,   0,",
          "625:  };",
          "627:  if ((YYLIMIT - YYCURSOR) < 7) YYFILL(7);",
          "628:  yych = *YYCURSOR;",
          "629:  switch (yych) {",
          "630:  case 'C':",
          "632:  case 'N': goto yy5;",
          "639:  case 'o': goto yy12;",
          "644:  }",
          "645: yy2:",
          "648: yy3:",
          "650:  { return 0; }",
          "652: yy4:",
          "653:  yych = *(YYMARKER = ++YYCURSOR);",
          "655:  goto yy3;",
          "656: yy5:",
          "657:  yych = *++YYCURSOR;",
          "659:  goto yy3;",
          "660: yy6:",
          "661:  yych = *(YYMARKER = ++YYCURSOR);",
          "663:  goto yy3;",
          "664: yy7:",
          "665:  yych = *(YYMARKER = ++YYCURSOR);",
          "667:  goto yy3;",
          "668: yy8:",
          "669:  yych = *(YYMARKER = ++YYCURSOR);",
          "671:  goto yy3;",
          "672: yy9:",
          "673:  yych = *(YYMARKER = ++YYCURSOR);",
          "675:  goto yy3;",
          "676: yy10:",
          "677:  yych = *(YYMARKER = ++YYCURSOR);",
          "679:  goto yy3;",
          "680: yy11:",
          "681:  yych = *(YYMARKER = ++YYCURSOR);",
          "683:  goto yy3;",
          "684: yy12:",
          "685:  yych = *(YYMARKER = ++YYCURSOR);",
          "687:  goto yy3;",
          "688: yy13:",
          "689:  yych = *(YYMARKER = ++YYCURSOR);",
          "691:  goto yy3;",
          "692: yy14:",
          "693:  ++YYCURSOR;",
          "695:  {",
          "697:  php_error_docref(NULL, E_NOTICE, \"Unexpected end of serialized data\");",
          "699: }",
          "704: yy17:",
          "705:  yych = *++YYCURSOR;",
          "706:  if (yybm[0+yych] & 128) {",
          "708:  }",
          "710: yy18:",
          "711:  YYCURSOR = YYMARKER;",
          "712:  goto yy3;",
          "713: yy19:",
          "714:  yych = *++YYCURSOR;",
          "717:  }",
          "718:  goto yy18;",
          "726:  if (yych <= '/') goto yy18;",
          "728:  yych = *++YYCURSOR;",
          "846:   }",
          "862:   }",
          "865:  }",
          "871:  }",
          "878:  yych = *++YYCURSOR;",
          "879:  if (yych <= ',') {",
          "881:  } else {",
          "883:   if (yych <= '/') goto yy18;",
          "885:   goto yy18;",
          "886:  }",
          "888:  yych = *++YYCURSOR;",
          "889:  if (yych <= '/') goto yy18;",
          "892:  ++YYCURSOR;",
          "893:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "894:  yych = *YYCURSOR;",
          "895:  if (yych <= '/') goto yy18;",
          "898:  yych = *++YYCURSOR;",
          "900:  ++YYCURSOR;",
          "912:  if (yych <= '/') goto yy18;",
          "913:  if (yych <= '9') goto yy34;",
          "914:  goto yy18;",
          "916:  yych = *++YYCURSOR;",
          "917:  if (yych <= '/') goto yy18;",
          "918:  if (yych >= ':') goto yy18;",
          "920:  ++YYCURSOR;",
          "921:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "922:  yych = *YYCURSOR;",
          "923:  if (yych <= '/') goto yy18;",
          "926:  yych = *++YYCURSOR;",
          "965:  ++YYCURSOR;",
          "966:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "967:  yych = *YYCURSOR;",
          "968:  if (yych <= '/') goto yy18;",
          "1010:  yych = *++YYCURSOR;",
          "1014:  goto yy18;",
          "1016:  yych = *++YYCURSOR;",
          "1017:  if (yych <= '/') goto yy18;",
          "1084:  goto yy18;",
          "1086:  yych = *++YYCURSOR;",
          "1087:  if (yych <= '/') {",
          "1090:  } else {",
          "1093:  }",
          "1099:  yych = *++YYCURSOR;",
          "1101:  if (yych <= '/') goto yy18;",
          "1104:  ++YYCURSOR;",
          "1105:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1106:  yych = *YYCURSOR;",
          "1107:  if (yych <= ':') {",
          "1108:   if (yych <= '.') {",
          "1109:    if (yych <= '-') goto yy18;",
          "1111:   } else {",
          "1112:    if (yych <= '/') goto yy18;",
          "1114:    goto yy18;",
          "1115:   }",
          "1116:  } else {",
          "1117:   if (yych <= 'E') {",
          "1119:    if (yych <= 'D') goto yy18;",
          "1121:   } else {",
          "1123:    goto yy18;",
          "1124:   }",
          "1125:  }",
          "1127:  yych = *++YYCURSOR;",
          "1128:  if (yych <= '/') goto yy18;",
          "1129:  if (yych >= ':') goto yy18;",
          "1131:  ++YYCURSOR;",
          "1133:  yych = *YYCURSOR;",
          "1147: yy63:",
          "1148:  ++YYCURSOR;",
          "1150:  {",
          "1156:  return 1;",
          "1157: }",
          "1159: yy65:",
          "1160:  yych = *++YYCURSOR;",
          "1169: yy66:",
          "1170:  yych = *++YYCURSOR;",
          "1179: yy67:",
          "1180:  ++YYCURSOR;",
          "1187: yy69:",
          "1193:  ++YYCURSOR;",
          "1194:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1195:  yych = *YYCURSOR;",
          "1196:  if (yych <= ';') {",
          "1197:   if (yych <= '/') goto yy18;",
          "1199:   if (yych <= ':') goto yy18;",
          "1201:  } else {",
          "1202:   if (yych <= 'E') {",
          "1203:    if (yych <= 'D') goto yy18;",
          "1205:   } else {",
          "1207:    goto yy18;",
          "1208:   }",
          "1209:  }",
          "1216:  ++YYCURSOR;",
          "1218:  {",
          "1231:  return 1;",
          "1232: }",
          "1239:  yych = *++YYCURSOR;",
          "1240:  if (yych <= ',') {",
          "1242:  } else {",
          "1244:   if (yych <= '/') goto yy18;",
          "1246:   goto yy18;",
          "1247:  }",
          "1249:  yych = *++YYCURSOR;",
          "1259:  ++YYCURSOR;",
          "1261:  {",
          "1262: #if SIZEOF_ZEND_LONG == 4",
          "1263:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "631:  case 'O': goto yy13;",
          "633:  case 'R': goto yy2;",
          "634:  case 'S': goto yy10;",
          "635:  case 'a': goto yy11;",
          "636:  case 'b': goto yy6;",
          "637:  case 'd': goto yy8;",
          "638:  case 'i': goto yy7;",
          "640:  case 'r': goto yy4;",
          "641:  case 's': goto yy9;",
          "642:  case '}': goto yy14;",
          "643:  default: goto yy16;",
          "646:  yych = *(YYMARKER = ++YYCURSOR);",
          "647:  if (yych == ':') goto yy95;",
          "649: #line 956 \"ext/standard/var_unserializer.re\"",
          "651: #line 652 \"ext/standard/var_unserializer.c\"",
          "654:  if (yych == ':') goto yy89;",
          "658:  if (yych == ';') goto yy87;",
          "662:  if (yych == ':') goto yy83;",
          "666:  if (yych == ':') goto yy77;",
          "670:  if (yych == ':') goto yy53;",
          "674:  if (yych == ':') goto yy46;",
          "678:  if (yych == ':') goto yy39;",
          "682:  if (yych == ':') goto yy32;",
          "686:  if (yych == ':') goto yy25;",
          "690:  if (yych == ':') goto yy17;",
          "694: #line 950 \"ext/standard/var_unserializer.re\"",
          "700: #line 701 \"ext/standard/var_unserializer.c\"",
          "701: yy16:",
          "702:  yych = *++YYCURSOR;",
          "703:  goto yy3;",
          "707:   goto yy20;",
          "709:  if (yych == '+') goto yy19;",
          "715:  if (yybm[0+yych] & 128) {",
          "716:   goto yy20;",
          "719: yy20:",
          "720:  ++YYCURSOR;",
          "721:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "722:  yych = *YYCURSOR;",
          "723:  if (yybm[0+yych] & 128) {",
          "724:   goto yy20;",
          "725:  }",
          "727:  if (yych >= ';') goto yy18;",
          "729:  if (yych != '\"') goto yy18;",
          "730:  ++YYCURSOR;",
          "731: #line 805 \"ext/standard/var_unserializer.re\"",
          "732:  {",
          "733:  size_t len, len2, len3, maxlen;",
          "734:  zend_long elements;",
          "735:  char *str;",
          "736:  zend_string *class_name;",
          "737:  zend_class_entry *ce;",
          "738:  int incomplete_class = 0;",
          "740:  int custom_object = 0;",
          "742:  zval user_func;",
          "743:  zval retval;",
          "744:  zval args[1];",
          "746:     if (!var_hash) return 0;",
          "747:  if (*start == 'C') {",
          "748:   custom_object = 1;",
          "749:  }",
          "751:  len2 = len = parse_uiv(start + 2);",
          "752:  maxlen = max - YYCURSOR;",
          "753:  if (maxlen < len || len == 0) {",
          "755:   return 0;",
          "756:  }",
          "758:  str = (char*)YYCURSOR;",
          "760:  YYCURSOR += len;",
          "762:  if (*(YYCURSOR) != '\"') {",
          "764:   return 0;",
          "765:  }",
          "766:  if (*(YYCURSOR+1) != ':') {",
          "768:   return 0;",
          "769:  }",
          "771:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "772:  if (len3 != len)",
          "773:  {",
          "775:   return 0;",
          "776:  }",
          "778:  class_name = zend_string_init(str, len, 0);",
          "780:  do {",
          "781:   if(!unserialize_allowed_class(class_name, var_hash)) {",
          "782:    incomplete_class = 1;",
          "783:    ce = PHP_IC_ENTRY;",
          "784:    break;",
          "785:   }",
          "788:   BG(serialize_lock)++;",
          "789:   ce = zend_lookup_class(class_name);",
          "790:   if (ce) {",
          "791:    BG(serialize_lock)--;",
          "792:    if (EG(exception)) {",
          "793:     zend_string_release(class_name);",
          "794:     return 0;",
          "795:    }",
          "796:    break;",
          "797:   }",
          "798:   BG(serialize_lock)--;",
          "800:   if (EG(exception)) {",
          "801:    zend_string_release(class_name);",
          "802:    return 0;",
          "803:   }",
          "806:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "807:    incomplete_class = 1;",
          "808:    ce = PHP_IC_ENTRY;",
          "809:    break;",
          "810:   }",
          "813:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
          "815:   ZVAL_STR_COPY(&args[0], class_name);",
          "816:   BG(serialize_lock)++;",
          "817:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
          "818:    BG(serialize_lock)--;",
          "819:    if (EG(exception)) {",
          "820:     zend_string_release(class_name);",
          "821:     zval_ptr_dtor(&user_func);",
          "822:     zval_ptr_dtor(&args[0]);",
          "823:     return 0;",
          "824:    }",
          "825:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
          "826:    incomplete_class = 1;",
          "827:    ce = PHP_IC_ENTRY;",
          "828:    zval_ptr_dtor(&user_func);",
          "829:    zval_ptr_dtor(&args[0]);",
          "830:    break;",
          "831:   }",
          "832:   BG(serialize_lock)--;",
          "833:   zval_ptr_dtor(&retval);",
          "834:   if (EG(exception)) {",
          "835:    zend_string_release(class_name);",
          "836:    zval_ptr_dtor(&user_func);",
          "837:    zval_ptr_dtor(&args[0]);",
          "838:    return 0;",
          "839:   }",
          "842:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "843:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "844:    incomplete_class = 1;",
          "845:    ce = PHP_IC_ENTRY;",
          "848:   zval_ptr_dtor(&user_func);",
          "849:   zval_ptr_dtor(&args[0]);",
          "850:   break;",
          "851:  } while (1);",
          "855:  if (custom_object) {",
          "856:   int ret;",
          "858:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "860:   if (ret && incomplete_class) {",
          "861:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "863:   zend_string_release(class_name);",
          "864:   return ret;",
          "867:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "869:  if (incomplete_class) {",
          "870:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "872:  zend_string_release(class_name);",
          "874:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "875: }",
          "876: #line 877 \"ext/standard/var_unserializer.c\"",
          "877: yy25:",
          "880:   if (yych != '+') goto yy18;",
          "882:   if (yych <= '-') goto yy26;",
          "884:   if (yych <= '9') goto yy27;",
          "887: yy26:",
          "890:  if (yych >= ':') goto yy18;",
          "891: yy27:",
          "896:  if (yych <= '9') goto yy27;",
          "897:  if (yych >= ';') goto yy18;",
          "899:  if (yych != '\"') goto yy18;",
          "901: #line 798 \"ext/standard/var_unserializer.re\"",
          "902:  {",
          "903:     if (!var_hash) return 0;",
          "905:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "906:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "907: }",
          "908: #line 909 \"ext/standard/var_unserializer.c\"",
          "909: yy32:",
          "910:  yych = *++YYCURSOR;",
          "911:  if (yych == '+') goto yy33;",
          "915: yy33:",
          "919: yy34:",
          "924:  if (yych <= '9') goto yy34;",
          "925:  if (yych >= ';') goto yy18;",
          "927:  if (yych != '{') goto yy18;",
          "928:  ++YYCURSOR;",
          "929: #line 774 \"ext/standard/var_unserializer.re\"",
          "930:  {",
          "931:  zend_long elements = parse_iv(start + 2);",
          "934:     if (!var_hash) return 0;",
          "936:  if (elements < 0) {",
          "937:   return 0;",
          "938:  }",
          "940:  array_init_size(rval, elements);",
          "941:  if (elements) {",
          "944:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "945:  }",
          "947:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "948:   return 0;",
          "949:  }",
          "951:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "952: }",
          "953: #line 954 \"ext/standard/var_unserializer.c\"",
          "954: yy39:",
          "955:  yych = *++YYCURSOR;",
          "956:  if (yych == '+') goto yy40;",
          "957:  if (yych <= '/') goto yy18;",
          "958:  if (yych <= '9') goto yy41;",
          "959:  goto yy18;",
          "960: yy40:",
          "961:  yych = *++YYCURSOR;",
          "962:  if (yych <= '/') goto yy18;",
          "963:  if (yych >= ':') goto yy18;",
          "964: yy41:",
          "969:  if (yych <= '9') goto yy41;",
          "970:  if (yych >= ';') goto yy18;",
          "971:  yych = *++YYCURSOR;",
          "972:  if (yych != '\"') goto yy18;",
          "973:  ++YYCURSOR;",
          "974: #line 740 \"ext/standard/var_unserializer.re\"",
          "975:  {",
          "976:  size_t len, maxlen;",
          "977:  zend_string *str;",
          "979:  len = parse_uiv(start + 2);",
          "980:  maxlen = max - YYCURSOR;",
          "981:  if (maxlen < len) {",
          "983:   return 0;",
          "984:  }",
          "986:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "987:   return 0;",
          "988:  }",
          "990:  if (*(YYCURSOR) != '\"') {",
          "991:   zend_string_free(str);",
          "993:   return 0;",
          "994:  }",
          "996:  if (*(YYCURSOR + 1) != ';') {",
          "997:   efree(str);",
          "999:   return 0;",
          "1000:  }",
          "1002:  YYCURSOR += 2;",
          "1005:  ZVAL_STR(rval, str);",
          "1006:  return 1;",
          "1007: }",
          "1008: #line 1009 \"ext/standard/var_unserializer.c\"",
          "1009: yy46:",
          "1011:  if (yych == '+') goto yy47;",
          "1012:  if (yych <= '/') goto yy18;",
          "1013:  if (yych <= '9') goto yy48;",
          "1015: yy47:",
          "1018:  if (yych >= ':') goto yy18;",
          "1019: yy48:",
          "1020:  ++YYCURSOR;",
          "1021:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "1022:  yych = *YYCURSOR;",
          "1023:  if (yych <= '/') goto yy18;",
          "1024:  if (yych <= '9') goto yy48;",
          "1025:  if (yych >= ';') goto yy18;",
          "1026:  yych = *++YYCURSOR;",
          "1027:  if (yych != '\"') goto yy18;",
          "1028:  ++YYCURSOR;",
          "1029: #line 708 \"ext/standard/var_unserializer.re\"",
          "1030:  {",
          "1031:  size_t len, maxlen;",
          "1032:  char *str;",
          "1034:  len = parse_uiv(start + 2);",
          "1035:  maxlen = max - YYCURSOR;",
          "1036:  if (maxlen < len) {",
          "1038:   return 0;",
          "1039:  }",
          "1041:  str = (char*)YYCURSOR;",
          "1043:  YYCURSOR += len;",
          "1045:  if (*(YYCURSOR) != '\"') {",
          "1047:   return 0;",
          "1048:  }",
          "1050:  if (*(YYCURSOR + 1) != ';') {",
          "1052:   return 0;",
          "1053:  }",
          "1055:  YYCURSOR += 2;",
          "1058:  ZVAL_STRINGL(rval, str, len);",
          "1059:  return 1;",
          "1060: }",
          "1061: #line 1062 \"ext/standard/var_unserializer.c\"",
          "1062: yy53:",
          "1063:  yych = *++YYCURSOR;",
          "1064:  if (yych <= '/') {",
          "1065:   if (yych <= ',') {",
          "1066:    if (yych == '+') goto yy57;",
          "1067:    goto yy18;",
          "1068:   } else {",
          "1069:    if (yych <= '-') goto yy55;",
          "1070:    if (yych <= '.') goto yy60;",
          "1071:    goto yy18;",
          "1072:   }",
          "1073:  } else {",
          "1074:   if (yych <= 'I') {",
          "1075:    if (yych <= '9') goto yy58;",
          "1076:    if (yych <= 'H') goto yy18;",
          "1077:    goto yy56;",
          "1078:   } else {",
          "1079:    if (yych != 'N') goto yy18;",
          "1080:   }",
          "1081:  }",
          "1082:  yych = *++YYCURSOR;",
          "1083:  if (yych == 'A') goto yy76;",
          "1085: yy55:",
          "1088:   if (yych == '.') goto yy60;",
          "1089:   goto yy18;",
          "1091:   if (yych <= '9') goto yy58;",
          "1092:   if (yych != 'I') goto yy18;",
          "1094: yy56:",
          "1095:  yych = *++YYCURSOR;",
          "1096:  if (yych == 'N') goto yy72;",
          "1097:  goto yy18;",
          "1098: yy57:",
          "1100:  if (yych == '.') goto yy60;",
          "1102:  if (yych >= ':') goto yy18;",
          "1103: yy58:",
          "1110:    goto yy70;",
          "1113:    if (yych <= '9') goto yy58;",
          "1118:    if (yych <= ';') goto yy63;",
          "1120:    goto yy65;",
          "1122:    if (yych == 'e') goto yy65;",
          "1126: yy60:",
          "1130: yy61:",
          "1132:  if ((YYLIMIT - YYCURSOR) < 4) YYFILL(4);",
          "1134:  if (yych <= ';') {",
          "1135:   if (yych <= '/') goto yy18;",
          "1136:   if (yych <= '9') goto yy61;",
          "1137:   if (yych <= ':') goto yy18;",
          "1138:  } else {",
          "1139:   if (yych <= 'E') {",
          "1140:    if (yych <= 'D') goto yy18;",
          "1141:    goto yy65;",
          "1142:   } else {",
          "1143:    if (yych == 'e') goto yy65;",
          "1144:    goto yy18;",
          "1145:   }",
          "1146:  }",
          "1149: #line 699 \"ext/standard/var_unserializer.re\"",
          "1151: #if SIZEOF_ZEND_LONG == 4",
          "1152: use_double:",
          "1153: #endif",
          "1155:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1158: #line 1159 \"ext/standard/var_unserializer.c\"",
          "1161:  if (yych <= ',') {",
          "1162:   if (yych != '+') goto yy18;",
          "1163:  } else {",
          "1164:   if (yych <= '-') goto yy66;",
          "1165:   if (yych <= '/') goto yy18;",
          "1166:   if (yych <= '9') goto yy67;",
          "1167:   goto yy18;",
          "1168:  }",
          "1171:  if (yych <= ',') {",
          "1172:   if (yych == '+') goto yy69;",
          "1173:   goto yy18;",
          "1174:  } else {",
          "1175:   if (yych <= '-') goto yy69;",
          "1176:   if (yych <= '/') goto yy18;",
          "1177:   if (yych >= ':') goto yy18;",
          "1178:  }",
          "1181:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1182:  yych = *YYCURSOR;",
          "1183:  if (yych <= '/') goto yy18;",
          "1184:  if (yych <= '9') goto yy67;",
          "1185:  if (yych == ';') goto yy63;",
          "1186:  goto yy18;",
          "1188:  yych = *++YYCURSOR;",
          "1189:  if (yych <= '/') goto yy18;",
          "1190:  if (yych <= '9') goto yy67;",
          "1191:  goto yy18;",
          "1192: yy70:",
          "1198:   if (yych <= '9') goto yy70;",
          "1200:   goto yy63;",
          "1204:    goto yy65;",
          "1206:    if (yych == 'e') goto yy65;",
          "1210: yy72:",
          "1211:  yych = *++YYCURSOR;",
          "1212:  if (yych != 'F') goto yy18;",
          "1213: yy73:",
          "1214:  yych = *++YYCURSOR;",
          "1215:  if (yych != ';') goto yy18;",
          "1217: #line 683 \"ext/standard/var_unserializer.re\"",
          "1221:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
          "1222:   ZVAL_DOUBLE(rval, php_get_nan());",
          "1223:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
          "1224:   ZVAL_DOUBLE(rval, php_get_inf());",
          "1225:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
          "1226:   ZVAL_DOUBLE(rval, -php_get_inf());",
          "1227:  } else {",
          "1228:   ZVAL_NULL(rval);",
          "1229:  }",
          "1233: #line 1234 \"ext/standard/var_unserializer.c\"",
          "1234: yy76:",
          "1235:  yych = *++YYCURSOR;",
          "1236:  if (yych == 'N') goto yy73;",
          "1237:  goto yy18;",
          "1238: yy77:",
          "1241:   if (yych != '+') goto yy18;",
          "1243:   if (yych <= '-') goto yy78;",
          "1245:   if (yych <= '9') goto yy79;",
          "1248: yy78:",
          "1250:  if (yych <= '/') goto yy18;",
          "1251:  if (yych >= ':') goto yy18;",
          "1252: yy79:",
          "1253:  ++YYCURSOR;",
          "1254:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1255:  yych = *YYCURSOR;",
          "1256:  if (yych <= '/') goto yy18;",
          "1257:  if (yych <= '9') goto yy79;",
          "1258:  if (yych != ';') goto yy18;",
          "1260: #line 657 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "633:  case 'O': goto yy4;",
          "635:  case 'R': goto yy6;",
          "636:  case 'S': goto yy7;",
          "637:  case 'a': goto yy8;",
          "638:  case 'b': goto yy9;",
          "639:  case 'd': goto yy10;",
          "640:  case 'i': goto yy11;",
          "642:  case 'r': goto yy13;",
          "643:  case 's': goto yy14;",
          "644:  case '}': goto yy15;",
          "645:  default: goto yy2;",
          "648:  ++YYCURSOR;",
          "650: #line 959 \"ext/standard/var_unserializer.re\"",
          "652: #line 653 \"ext/standard/var_unserializer.c\"",
          "655:  if (yych == ':') goto yy17;",
          "659:  if (yych == ';') goto yy19;",
          "663:  if (yych == ':') goto yy21;",
          "667:  if (yych == ':') goto yy22;",
          "671:  if (yych == ':') goto yy23;",
          "675:  if (yych == ':') goto yy24;",
          "679:  if (yych == ':') goto yy25;",
          "683:  if (yych == ':') goto yy26;",
          "687:  if (yych == ':') goto yy27;",
          "691:  if (yych == ':') goto yy28;",
          "694:  yych = *(YYMARKER = ++YYCURSOR);",
          "695:  if (yych == ':') goto yy29;",
          "696:  goto yy3;",
          "697: yy15:",
          "699: #line 953 \"ext/standard/var_unserializer.re\"",
          "705: #line 706 \"ext/standard/var_unserializer.c\"",
          "709:   goto yy31;",
          "711:  if (yych == '+') goto yy30;",
          "716:  ++YYCURSOR;",
          "717: #line 648 \"ext/standard/var_unserializer.re\"",
          "718:  {",
          "720:  ZVAL_NULL(rval);",
          "721:  return 1;",
          "722: }",
          "723: #line 724 \"ext/standard/var_unserializer.c\"",
          "724: yy21:",
          "726:  if (yych <= ',') {",
          "727:   if (yych == '+') goto yy33;",
          "728:   goto yy18;",
          "729:  } else {",
          "730:   if (yych <= '-') goto yy33;",
          "731:   if (yych <= '/') goto yy18;",
          "732:   if (yych <= '9') goto yy34;",
          "733:   goto yy18;",
          "735: yy22:",
          "736:  yych = *++YYCURSOR;",
          "737:  if (yych == '+') goto yy36;",
          "738:  if (yych <= '/') goto yy18;",
          "739:  if (yych <= '9') goto yy37;",
          "741: yy23:",
          "742:  yych = *++YYCURSOR;",
          "743:  if (yych == '+') goto yy39;",
          "745:  if (yych <= '9') goto yy40;",
          "746:  goto yy18;",
          "747: yy24:",
          "749:  if (yych <= '/') goto yy18;",
          "750:  if (yych <= '1') goto yy42;",
          "751:  goto yy18;",
          "752: yy25:",
          "753:  yych = *++YYCURSOR;",
          "754:  if (yych <= '/') {",
          "755:   if (yych <= ',') {",
          "756:    if (yych == '+') goto yy43;",
          "757:    goto yy18;",
          "758:   } else {",
          "759:    if (yych <= '-') goto yy44;",
          "760:    if (yych <= '.') goto yy45;",
          "761:    goto yy18;",
          "763:  } else {",
          "764:   if (yych <= 'I') {",
          "765:    if (yych <= '9') goto yy46;",
          "766:    if (yych <= 'H') goto yy18;",
          "767:    goto yy48;",
          "768:   } else {",
          "769:    if (yych == 'N') goto yy49;",
          "770:    goto yy18;",
          "773: yy26:",
          "774:  yych = *++YYCURSOR;",
          "775:  if (yych <= ',') {",
          "776:   if (yych == '+') goto yy50;",
          "777:   goto yy18;",
          "778:  } else {",
          "779:   if (yych <= '-') goto yy50;",
          "780:   if (yych <= '/') goto yy18;",
          "781:   if (yych <= '9') goto yy51;",
          "782:   goto yy18;",
          "784: yy27:",
          "787:   if (yych == '+') goto yy53;",
          "788:   goto yy18;",
          "790:   if (yych <= '-') goto yy53;",
          "792:   if (yych <= '9') goto yy54;",
          "795: yy28:",
          "796:  yych = *++YYCURSOR;",
          "797:  if (yych <= ',') {",
          "798:   if (yych == '+') goto yy56;",
          "799:   goto yy18;",
          "800:  } else {",
          "801:   if (yych <= '-') goto yy56;",
          "802:   if (yych <= '/') goto yy18;",
          "803:   if (yych <= '9') goto yy57;",
          "804:   goto yy18;",
          "805:  }",
          "806: yy29:",
          "808:  if (yych == '+') goto yy59;",
          "810:  if (yych <= '9') goto yy60;",
          "811:  goto yy18;",
          "812: yy30:",
          "813:  yych = *++YYCURSOR;",
          "814:  if (yybm[0+yych] & 128) {",
          "815:   goto yy31;",
          "816:  }",
          "817:  goto yy18;",
          "818: yy31:",
          "822:  if (yybm[0+yych] & 128) {",
          "823:   goto yy31;",
          "824:  }",
          "826:  if (yych <= ':') goto yy62;",
          "827:  goto yy18;",
          "828: yy33:",
          "830:  if (yych <= '/') goto yy18;",
          "831:  if (yych >= ':') goto yy18;",
          "832: yy34:",
          "834:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "835:  yych = *YYCURSOR;",
          "838:  if (yych == ';') goto yy63;",
          "840: yy36:",
          "844: yy37:",
          "849:  if (yych <= '9') goto yy37;",
          "850:  if (yych <= ':') goto yy65;",
          "851:  goto yy18;",
          "852: yy39:",
          "854:  if (yych <= '/') goto yy18;",
          "855:  if (yych >= ':') goto yy18;",
          "856: yy40:",
          "861:  if (yych <= '9') goto yy40;",
          "862:  if (yych <= ':') goto yy66;",
          "863:  goto yy18;",
          "864: yy42:",
          "866:  if (yych == ';') goto yy67;",
          "868: yy43:",
          "870:  if (yych == '.') goto yy45;",
          "872:  if (yych <= '9') goto yy46;",
          "874: yy44:",
          "877:   if (yych != '.') goto yy18;",
          "879:   if (yych <= '9') goto yy46;",
          "880:   if (yych == 'I') goto yy48;",
          "881:   goto yy18;",
          "883: yy45:",
          "886:  if (yych <= '9') goto yy69;",
          "887:  goto yy18;",
          "888: yy46:",
          "895:    goto yy69;",
          "898:    if (yych <= '9') goto yy46;",
          "903:    if (yych <= ';') goto yy71;",
          "905:    goto yy73;",
          "907:    if (yych == 'e') goto yy73;",
          "911: yy48:",
          "912:  yych = *++YYCURSOR;",
          "913:  if (yych == 'N') goto yy74;",
          "914:  goto yy18;",
          "915: yy49:",
          "916:  yych = *++YYCURSOR;",
          "917:  if (yych == 'A') goto yy75;",
          "918:  goto yy18;",
          "919: yy50:",
          "923: yy51:",
          "925:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "927:  if (yych <= '/') goto yy18;",
          "928:  if (yych <= '9') goto yy51;",
          "929:  if (yych == ';') goto yy76;",
          "930:  goto yy18;",
          "931: yy53:",
          "932:  yych = *++YYCURSOR;",
          "933:  if (yych <= '/') goto yy18;",
          "934:  if (yych >= ':') goto yy18;",
          "935: yy54:",
          "936:  ++YYCURSOR;",
          "937:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "938:  yych = *YYCURSOR;",
          "939:  if (yych <= '/') goto yy18;",
          "940:  if (yych <= '9') goto yy54;",
          "941:  if (yych <= ':') goto yy78;",
          "942:  goto yy18;",
          "943: yy56:",
          "944:  yych = *++YYCURSOR;",
          "945:  if (yych <= '/') goto yy18;",
          "946:  if (yych >= ':') goto yy18;",
          "947: yy57:",
          "948:  ++YYCURSOR;",
          "949:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "950:  yych = *YYCURSOR;",
          "951:  if (yych <= '/') goto yy18;",
          "952:  if (yych <= '9') goto yy57;",
          "953:  if (yych == ';') goto yy79;",
          "954:  goto yy18;",
          "955: yy59:",
          "956:  yych = *++YYCURSOR;",
          "957:  if (yych <= '/') goto yy18;",
          "958:  if (yych >= ':') goto yy18;",
          "959: yy60:",
          "960:  ++YYCURSOR;",
          "961:  if ((YYLIMIT - YYCURSOR) < 2) YYFILL(2);",
          "962:  yych = *YYCURSOR;",
          "963:  if (yych <= '/') goto yy18;",
          "964:  if (yych <= '9') goto yy60;",
          "965:  if (yych <= ':') goto yy81;",
          "966:  goto yy18;",
          "967: yy62:",
          "968:  yych = *++YYCURSOR;",
          "969:  if (yych == '\"') goto yy82;",
          "970:  goto yy18;",
          "973: #line 597 \"ext/standard/var_unserializer.re\"",
          "975:  zend_long id;",
          "978:  if (!var_hash) return 0;",
          "980:  id = parse_iv(start + 2) - 1;",
          "981:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "982:   return 0;",
          "983:  }",
          "985:  zval_ptr_dtor(rval);",
          "986:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "987:   ZVAL_UNDEF(rval);",
          "988:   return 1;",
          "989:  }",
          "990:  if (Z_ISREF_P(rval_ref)) {",
          "991:   ZVAL_COPY(rval, rval_ref);",
          "992:  } else {",
          "993:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "994:   ZVAL_COPY(rval, rval_ref);",
          "995:  }",
          "999: #line 1000 \"ext/standard/var_unserializer.c\"",
          "1002:  if (yych == '\"') goto yy84;",
          "1003:  goto yy18;",
          "1006:  if (yych == '{') goto yy86;",
          "1007:  goto yy18;",
          "1010: #line 654 \"ext/standard/var_unserializer.re\"",
          "1011:  {",
          "1013:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1014:  return 1;",
          "1015: }",
          "1016: #line 1017 \"ext/standard/var_unserializer.c\"",
          "1023:   if (yych <= '9') goto yy69;",
          "1028:    goto yy73;",
          "1030:    if (yych == 'e') goto yy73;",
          "1034: yy71:",
          "1036: #line 702 \"ext/standard/var_unserializer.re\"",
          "1038: #if SIZEOF_ZEND_LONG == 4",
          "1039: use_double:",
          "1040: #endif",
          "1042:  ZVAL_DOUBLE(rval, zend_strtod((const char *)start + 2, NULL));",
          "1045: #line 1046 \"ext/standard/var_unserializer.c\"",
          "1046: yy73:",
          "1049:   if (yych == '+') goto yy88;",
          "1050:   goto yy18;",
          "1052:   if (yych <= '-') goto yy88;",
          "1054:   if (yych <= '9') goto yy89;",
          "1057: yy74:",
          "1059:  if (yych == 'F') goto yy91;",
          "1060:  goto yy18;",
          "1061: yy75:",
          "1062:  yych = *++YYCURSOR;",
          "1063:  if (yych == 'N') goto yy91;",
          "1064:  goto yy18;",
          "1065: yy76:",
          "1067: #line 660 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1283:  ZVAL_LONG(rval, parse_iv(start + 2));",
          "1284:  return 1;",
          "1285: }",
          "1291:  yych = *++YYCURSOR;",
          "1331:  ++YYCURSOR;",
          "1333:  {",
          "1334:  zend_long id;",
          "",
          "[Removed Lines]",
          "1286: #line 1287 \"ext/standard/var_unserializer.c\"",
          "1287: yy83:",
          "1288:  yych = *++YYCURSOR;",
          "1289:  if (yych <= '/') goto yy18;",
          "1290:  if (yych >= '2') goto yy18;",
          "1292:  if (yych != ';') goto yy18;",
          "1293:  ++YYCURSOR;",
          "1294: #line 651 \"ext/standard/var_unserializer.re\"",
          "1295:  {",
          "1297:  ZVAL_BOOL(rval, parse_iv(start + 2));",
          "1298:  return 1;",
          "1299: }",
          "1300: #line 1301 \"ext/standard/var_unserializer.c\"",
          "1301: yy87:",
          "1302:  ++YYCURSOR;",
          "1303: #line 645 \"ext/standard/var_unserializer.re\"",
          "1304:  {",
          "1306:  ZVAL_NULL(rval);",
          "1307:  return 1;",
          "1308: }",
          "1309: #line 1310 \"ext/standard/var_unserializer.c\"",
          "1310: yy89:",
          "1311:  yych = *++YYCURSOR;",
          "1312:  if (yych <= ',') {",
          "1313:   if (yych != '+') goto yy18;",
          "1314:  } else {",
          "1315:   if (yych <= '-') goto yy90;",
          "1316:   if (yych <= '/') goto yy18;",
          "1317:   if (yych <= '9') goto yy91;",
          "1318:   goto yy18;",
          "1319:  }",
          "1320: yy90:",
          "1321:  yych = *++YYCURSOR;",
          "1322:  if (yych <= '/') goto yy18;",
          "1323:  if (yych >= ':') goto yy18;",
          "1324: yy91:",
          "1325:  ++YYCURSOR;",
          "1326:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1327:  yych = *YYCURSOR;",
          "1328:  if (yych <= '/') goto yy18;",
          "1329:  if (yych <= '9') goto yy91;",
          "1330:  if (yych != ';') goto yy18;",
          "1332: #line 620 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1093: #line 1094 \"ext/standard/var_unserializer.c\"",
          "1094: yy78:",
          "1096:  if (yych == '\"') goto yy92;",
          "1097:  goto yy18;",
          "1098: yy79:",
          "1100: #line 623 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1355:  return 1;",
          "1356: }",
          "1359:  yych = *++YYCURSOR;",
          "1360:  if (yych <= ',') {",
          "1362:  } else {",
          "1363:   if (yych <= '-') goto yy96;",
          "1364:   if (yych <= '/') goto yy18;",
          "1367:  }",
          "1373:  ++YYCURSOR;",
          "1374:  if (YYLIMIT <= YYCURSOR) YYFILL(1);",
          "1375:  yych = *YYCURSOR;",
          "1376:  if (yych <= '/') goto yy18;",
          "1379:  ++YYCURSOR;",
          "1381:  {",
          "1389:   return 0;",
          "1390:  }",
          "1396:  }",
          "1399:  } else {",
          "1402:  }",
          "1404:  return 1;",
          "1405: }",
          "1407: }",
          "1411:  return 0;",
          "",
          "[Removed Lines]",
          "1357: #line 1358 \"ext/standard/var_unserializer.c\"",
          "1358: yy95:",
          "1361:   if (yych != '+') goto yy18;",
          "1365:   if (yych <= '9') goto yy97;",
          "1366:   goto yy18;",
          "1368: yy96:",
          "1369:  yych = *++YYCURSOR;",
          "1370:  if (yych <= '/') goto yy18;",
          "1371:  if (yych >= ':') goto yy18;",
          "1372: yy97:",
          "1377:  if (yych <= '9') goto yy97;",
          "1378:  if (yych != ';') goto yy18;",
          "1380: #line 594 \"ext/standard/var_unserializer.re\"",
          "1382:  zend_long id;",
          "1385:  if (!var_hash) return 0;",
          "1387:  id = parse_iv(start + 2) - 1;",
          "1388:  if (id == -1 || (rval_ref = var_access(var_hash, id)) == NULL) {",
          "1392:  zval_ptr_dtor(rval);",
          "1393:  if (Z_ISUNDEF_P(rval_ref) || (Z_ISREF_P(rval_ref) && Z_ISUNDEF_P(Z_REFVAL_P(rval_ref)))) {",
          "1394:   ZVAL_UNDEF(rval);",
          "1395:   return 1;",
          "1397:  if (Z_ISREF_P(rval_ref)) {",
          "1398:   ZVAL_COPY(rval, rval_ref);",
          "1400:   ZVAL_NEW_REF(rval_ref, rval_ref);",
          "1401:   ZVAL_COPY(rval, rval_ref);",
          "1406: #line 1407 \"ext/standard/var_unserializer.c\"",
          "1408: #line 958 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1125: #line 1126 \"ext/standard/var_unserializer.c\"",
          "1126: yy81:",
          "1127:  yych = *++YYCURSOR;",
          "1128:  if (yych == '\"') goto yy94;",
          "1129:  goto yy18;",
          "1130: yy82:",
          "1131:  ++YYCURSOR;",
          "1132: #line 808 \"ext/standard/var_unserializer.re\"",
          "1133:  {",
          "1134:  size_t len, len2, len3, maxlen;",
          "1135:  zend_long elements;",
          "1136:  char *str;",
          "1137:  zend_string *class_name;",
          "1138:  zend_class_entry *ce;",
          "1139:  int incomplete_class = 0;",
          "1141:  int custom_object = 0;",
          "1143:  zval user_func;",
          "1144:  zval retval;",
          "1145:  zval args[1];",
          "1147:     if (!var_hash) return 0;",
          "1148:  if (*start == 'C') {",
          "1149:   custom_object = 1;",
          "1150:  }",
          "1152:  len2 = len = parse_uiv(start + 2);",
          "1153:  maxlen = max - YYCURSOR;",
          "1154:  if (maxlen < len || len == 0) {",
          "1156:   return 0;",
          "1157:  }",
          "1159:  str = (char*)YYCURSOR;",
          "1161:  YYCURSOR += len;",
          "1163:  if (*(YYCURSOR) != '\"') {",
          "1165:   return 0;",
          "1166:  }",
          "1167:  if (*(YYCURSOR+1) != ':') {",
          "1169:   return 0;",
          "1170:  }",
          "1172:  len3 = strspn(str, \"0123456789_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\\177\\200\\201\\202\\203\\204\\205\\206\\207\\210\\211\\212\\213\\214\\215\\216\\217\\220\\221\\222\\223\\224\\225\\226\\227\\230\\231\\232\\233\\234\\235\\236\\237\\240\\241\\242\\243\\244\\245\\246\\247\\250\\251\\252\\253\\254\\255\\256\\257\\260\\261\\262\\263\\264\\265\\266\\267\\270\\271\\272\\273\\274\\275\\276\\277\\300\\301\\302\\303\\304\\305\\306\\307\\310\\311\\312\\313\\314\\315\\316\\317\\320\\321\\322\\323\\324\\325\\326\\327\\330\\331\\332\\333\\334\\335\\336\\337\\340\\341\\342\\343\\344\\345\\346\\347\\350\\351\\352\\353\\354\\355\\356\\357\\360\\361\\362\\363\\364\\365\\366\\367\\370\\371\\372\\373\\374\\375\\376\\377\\\\\");",
          "1173:  if (len3 != len)",
          "1174:  {",
          "1176:   return 0;",
          "1177:  }",
          "1179:  class_name = zend_string_init(str, len, 0);",
          "1181:  do {",
          "1182:   if(!unserialize_allowed_class(class_name, var_hash)) {",
          "1183:    incomplete_class = 1;",
          "1184:    ce = PHP_IC_ENTRY;",
          "1185:    break;",
          "1186:   }",
          "1189:   BG(serialize_lock)++;",
          "1190:   ce = zend_lookup_class(class_name);",
          "1191:   if (ce) {",
          "1192:    BG(serialize_lock)--;",
          "1193:    if (EG(exception)) {",
          "1194:     zend_string_release(class_name);",
          "1195:     return 0;",
          "1196:    }",
          "1197:    break;",
          "1198:   }",
          "1199:   BG(serialize_lock)--;",
          "1201:   if (EG(exception)) {",
          "1202:    zend_string_release(class_name);",
          "1203:    return 0;",
          "1204:   }",
          "1207:   if ((PG(unserialize_callback_func) == NULL) || (PG(unserialize_callback_func)[0] == '\\0')) {",
          "1208:    incomplete_class = 1;",
          "1209:    ce = PHP_IC_ENTRY;",
          "1210:    break;",
          "1211:   }",
          "1214:   ZVAL_STRING(&user_func, PG(unserialize_callback_func));",
          "1216:   ZVAL_STR_COPY(&args[0], class_name);",
          "1217:   BG(serialize_lock)++;",
          "1218:   if (call_user_function_ex(CG(function_table), NULL, &user_func, &retval, 1, args, 0, NULL) != SUCCESS) {",
          "1219:    BG(serialize_lock)--;",
          "1220:    if (EG(exception)) {",
          "1221:     zend_string_release(class_name);",
          "1222:     zval_ptr_dtor(&user_func);",
          "1223:     zval_ptr_dtor(&args[0]);",
          "1224:     return 0;",
          "1225:    }",
          "1226:    php_error_docref(NULL, E_WARNING, \"defined (%s) but not found\", Z_STRVAL(user_func));",
          "1227:    incomplete_class = 1;",
          "1228:    ce = PHP_IC_ENTRY;",
          "1229:    zval_ptr_dtor(&user_func);",
          "1230:    zval_ptr_dtor(&args[0]);",
          "1231:    break;",
          "1232:   }",
          "1233:   BG(serialize_lock)--;",
          "1234:   zval_ptr_dtor(&retval);",
          "1235:   if (EG(exception)) {",
          "1236:    zend_string_release(class_name);",
          "1237:    zval_ptr_dtor(&user_func);",
          "1238:    zval_ptr_dtor(&args[0]);",
          "1239:    return 0;",
          "1240:   }",
          "1243:   if ((ce = zend_lookup_class(class_name)) == NULL) {",
          "1244:    php_error_docref(NULL, E_WARNING, \"Function %s() hasn't defined the class it was called for\", Z_STRVAL(user_func));",
          "1245:    incomplete_class = 1;",
          "1246:    ce = PHP_IC_ENTRY;",
          "1247:   }",
          "1249:   zval_ptr_dtor(&user_func);",
          "1250:   zval_ptr_dtor(&args[0]);",
          "1251:   break;",
          "1252:  } while (1);",
          "1256:  if (custom_object) {",
          "1257:   int ret;",
          "1259:   ret = object_custom(UNSERIALIZE_PASSTHRU, ce);",
          "1261:   if (ret && incomplete_class) {",
          "1262:    php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "1263:   }",
          "1264:   zend_string_release(class_name);",
          "1265:   return ret;",
          "1266:  }",
          "1268:  elements = object_common1(UNSERIALIZE_PASSTHRU, ce);",
          "1270:  if (incomplete_class) {",
          "1271:   php_store_class_name(rval, ZSTR_VAL(class_name), len2);",
          "1272:  }",
          "1273:  zend_string_release(class_name);",
          "1275:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "1276: }",
          "1277: #line 1278 \"ext/standard/var_unserializer.c\"",
          "1278: yy84:",
          "1279:  ++YYCURSOR;",
          "1280: #line 743 \"ext/standard/var_unserializer.re\"",
          "1281:  {",
          "1282:  size_t len, maxlen;",
          "1283:  zend_string *str;",
          "1285:  len = parse_uiv(start + 2);",
          "1286:  maxlen = max - YYCURSOR;",
          "1287:  if (maxlen < len) {",
          "1289:   return 0;",
          "1290:  }",
          "1292:  if ((str = unserialize_str(&YYCURSOR, len, maxlen)) == NULL) {",
          "1293:   return 0;",
          "1294:  }",
          "1296:  if (*(YYCURSOR) != '\"') {",
          "1297:   zend_string_free(str);",
          "1299:   return 0;",
          "1300:  }",
          "1302:  if (*(YYCURSOR + 1) != ';') {",
          "1303:   efree(str);",
          "1305:   return 0;",
          "1306:  }",
          "1308:  YYCURSOR += 2;",
          "1311:  ZVAL_STR(rval, str);",
          "1312:  return 1;",
          "1313: }",
          "1314: #line 1315 \"ext/standard/var_unserializer.c\"",
          "1315: yy86:",
          "1316:  ++YYCURSOR;",
          "1317: #line 777 \"ext/standard/var_unserializer.re\"",
          "1318:  {",
          "1319:  zend_long elements = parse_iv(start + 2);",
          "1322:     if (!var_hash) return 0;",
          "1324:  if (elements < 0) {",
          "1325:   return 0;",
          "1326:  }",
          "1328:  array_init_size(rval, elements);",
          "1329:  if (elements) {",
          "1332:   zend_hash_real_init(Z_ARRVAL_P(rval), 0);",
          "1333:  }",
          "1335:  if (!process_nested_data(UNSERIALIZE_PASSTHRU, Z_ARRVAL_P(rval), elements, 0)) {",
          "1336:   return 0;",
          "1337:  }",
          "1339:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "1340: }",
          "1341: #line 1342 \"ext/standard/var_unserializer.c\"",
          "1342: yy88:",
          "1345:   if (yych == '+') goto yy96;",
          "1346:   goto yy18;",
          "1350:   if (yych >= ':') goto yy18;",
          "1352: yy89:",
          "1357:  if (yych <= '9') goto yy89;",
          "1358:  if (yych == ';') goto yy71;",
          "1359:  goto yy18;",
          "1360: yy91:",
          "1361:  yych = *++YYCURSOR;",
          "1362:  if (yych == ';') goto yy97;",
          "1363:  goto yy18;",
          "1364: yy92:",
          "1366: #line 801 \"ext/standard/var_unserializer.re\"",
          "1368:     if (!var_hash) return 0;",
          "1370:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "1371:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "1372: }",
          "1373: #line 1374 \"ext/standard/var_unserializer.c\"",
          "1374: yy94:",
          "1375:  ++YYCURSOR;",
          "1376: #line 711 \"ext/standard/var_unserializer.re\"",
          "1377:  {",
          "1378:  size_t len, maxlen;",
          "1379:  char *str;",
          "1381:  len = parse_uiv(start + 2);",
          "1382:  maxlen = max - YYCURSOR;",
          "1383:  if (maxlen < len) {",
          "1388:  str = (char*)YYCURSOR;",
          "1390:  YYCURSOR += len;",
          "1392:  if (*(YYCURSOR) != '\"') {",
          "1394:   return 0;",
          "1397:  if (*(YYCURSOR + 1) != ';') {",
          "1399:   return 0;",
          "1400:  }",
          "1402:  YYCURSOR += 2;",
          "1405:  ZVAL_STRINGL(rval, str, len);",
          "1406:  return 1;",
          "1407: }",
          "1408: #line 1409 \"ext/standard/var_unserializer.c\"",
          "1409: yy96:",
          "1410:  yych = *++YYCURSOR;",
          "1411:  if (yych <= '/') goto yy18;",
          "1412:  if (yych <= '9') goto yy89;",
          "1413:  goto yy18;",
          "1414: yy97:",
          "1415:  ++YYCURSOR;",
          "1416: #line 686 \"ext/standard/var_unserializer.re\"",
          "1417:  {",
          "1420:  if (!strncmp((char*)start + 2, \"NAN\", 3)) {",
          "1421:   ZVAL_DOUBLE(rval, php_get_nan());",
          "1422:  } else if (!strncmp((char*)start + 2, \"INF\", 3)) {",
          "1423:   ZVAL_DOUBLE(rval, php_get_inf());",
          "1424:  } else if (!strncmp((char*)start + 2, \"-INF\", 4)) {",
          "1425:   ZVAL_DOUBLE(rval, -php_get_inf());",
          "1427:   ZVAL_NULL(rval);",
          "1432: #line 1433 \"ext/standard/var_unserializer.c\"",
          "1434: #line 961 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "57:  }",
          "58: }",
          "60: PHPAPI void php_var_unserialize_set_allowed_classes(php_unserialize_data_t d, HashTable *classes) {",
          "61:  d->allowed_classes = classes;",
          "62: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: PHPAPI HashTable *php_var_unserialize_get_allowed_classes(php_unserialize_data_t d) {",
          "61:  return d->allowed_classes;",
          "62: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}