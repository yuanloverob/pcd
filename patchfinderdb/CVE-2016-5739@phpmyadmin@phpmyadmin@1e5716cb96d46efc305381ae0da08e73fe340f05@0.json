{
  "cve_id": "CVE-2016-5739",
  "cve_desc": "The Transformation implementation in phpMyAdmin 4.0.x before 4.0.10.16, 4.4.x before 4.4.15.7, and 4.6.x before 4.6.3 does not use the no-referrer Content Security Policy (CSP) protection mechanism, which makes it easier for remote attackers to conduct CSRF attacks by reading an authentication token in a Referer header, related to libraries/Header.php.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "1e5716cb96d46efc305381ae0da08e73fe340f05",
  "patch_info": {
    "commit_hash": "1e5716cb96d46efc305381ae0da08e73fe340f05",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/1e5716cb96d46efc305381ae0da08e73fe340f05",
    "files": [
      "libraries/Header.php"
    ],
    "message": "Add referrer CSP and <meta> tag\n\nThis avoids leaking Referer header in modern browsers.\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
    "before_after_code_files": [
      "libraries/Header.php||libraries/Header.php"
    ]
  },
  "patch_diff": {
    "libraries/Header.php||libraries/Header.php": [
      "File: libraries/Header.php -> libraries/Header.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "550:             . $captcha_url",
      "551:             . $GLOBALS['cfg']['CSPAllow']",
      "552:             . \";\"",
      "553:             . \"img-src 'self' data: \"",
      "554:             . $GLOBALS['cfg']['CSPAllow']",
      "555:             . $map_tile_urls",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "553:             . \"referrer no-referrer;\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "561:             . $captcha_url",
      "562:             . $GLOBALS['cfg']['CSPAllow'] . ';'",
      "563:             . \"options inline-script eval-script;\"",
      "564:             . \"img-src 'self' data: \"",
      "565:             . $GLOBALS['cfg']['CSPAllow']",
      "566:             . $map_tile_urls",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "565:             . \"referrer no-referrer;\"",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "575:             . $captcha_url",
      "576:             . $GLOBALS['cfg']['CSPAllow']",
      "577:             . \" 'unsafe-inline' 'unsafe-eval';\"",
      "578:             . \"style-src 'self' 'unsafe-inline' \"",
      "579:             . $captcha_url",
      "580:             . ';'",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "580:             . \"referrer no-referrer;\"",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "636:     private function _getMetaTags()",
      "637:     {",
      "638:         $retval  = '<meta charset=\"utf-8\" />';",
      "639:         $retval .= '<meta name=\"robots\" content=\"noindex,nofollow\" />';",
      "640:         $retval .= '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\">';",
      "641:         if (! $GLOBALS['cfg']['AllowThirdPartyFraming']) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "642:         $retval .= '<meta name=\"referrer\" content=\"none\" />';",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2f4950828ec241e8cbdcf13090c2582a6fa620cb",
      "candidate_info": {
        "commit_hash": "2f4950828ec241e8cbdcf13090c2582a6fa620cb",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/2f4950828ec241e8cbdcf13090c2582a6fa620cb",
        "files": [
          "libraries/Header.php"
        ],
        "message": "Update referrer <meta> to match current standards\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "libraries/Header.php||libraries/Header.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "libraries/Header.php||libraries/Header.php"
          ],
          "candidate": [
            "libraries/Header.php||libraries/Header.php"
          ]
        }
      },
      "candidate_diff": {
        "libraries/Header.php||libraries/Header.php": [
          "File: libraries/Header.php -> libraries/Header.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "639:     private function _getMetaTags()",
          "640:     {",
          "641:         $retval  = '<meta charset=\"utf-8\" />';",
          "643:         $retval .= '<meta name=\"robots\" content=\"noindex,nofollow\" />';",
          "644:         $retval .= '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\">';",
          "645:         if (! $GLOBALS['cfg']['AllowThirdPartyFraming']) {",
          "",
          "[Removed Lines]",
          "642:         $retval .= '<meta name=\"referrer\" content=\"none\" />';",
          "",
          "[Added Lines]",
          "642:         $retval .= '<meta name=\"referrer\" content=\"no-referrer\" />';",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "32875196f971dc41f98a265808f1f8b4bd3ee5da",
      "candidate_info": {
        "commit_hash": "32875196f971dc41f98a265808f1f8b4bd3ee5da",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/32875196f971dc41f98a265808f1f8b4bd3ee5da",
        "files": [
          "libraries/Header.class.php"
        ],
        "message": "Add referrer CSP and <meta> tag\n\nThis avoids leaking Referer header in modern browsers.\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "libraries/Header.class.php||libraries/Header.class.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "libraries/Header.class.php||libraries/Header.class.php": [
          "File: libraries/Header.class.php -> libraries/Header.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "469:                 \"X-Content-Security-Policy: default-src 'self' \"",
          "470:                 . $GLOBALS['cfg']['CSPAllow'] . ';'",
          "471:                 . \"options inline-script eval-script;\"",
          "472:                 . \"img-src 'self' data: \"",
          "473:                 . $GLOBALS['cfg']['CSPAllow']",
          "474:                 . ($https ? \"\" : $mapTilesUrls)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "472:                 . \"referrer no-referrer;\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "494:                     . $GLOBALS['cfg']['CSPAllow']",
          "495:                     . \" 'unsafe-inline' 'unsafe-eval';\"",
          "496:                     . \"style-src 'self' 'unsafe-inline';\"",
          "497:                     . \"img-src 'self' data: \"",
          "498:                     . $GLOBALS['cfg']['CSPAllow']",
          "499:                     . ($https ? \"\" : $mapTilesUrls)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "498:                     . \"referrer no-referrer;\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "533:     private function _getMetaTags()",
          "534:     {",
          "535:         $retval  = '<meta charset=\"utf-8\" />';",
          "536:         $retval .= '<meta name=\"robots\" content=\"noindex,nofollow\" />';",
          "537:         $retval .= '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\">';",
          "538:         if (! $GLOBALS['cfg']['AllowThirdPartyFraming']) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "538:         $retval .= '<meta name=\"referrer\" content=\"none\" />';",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "22ad8b6b789091660fc7bdbb636e652b65dd3768",
      "candidate_info": {
        "commit_hash": "22ad8b6b789091660fc7bdbb636e652b65dd3768",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/22ad8b6b789091660fc7bdbb636e652b65dd3768",
        "files": [
          "libraries/Header.class.php"
        ],
        "message": "Add referrer CSP and <meta> tag\n\nThis avoids leaking Referer header in modern browsers.\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "libraries/Header.class.php||libraries/Header.class.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "libraries/Header.class.php||libraries/Header.class.php": [
          "File: libraries/Header.class.php -> libraries/Header.class.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "536:             . $captcha_url",
          "537:             . $GLOBALS['cfg']['CSPAllow']",
          "538:             . \";\"",
          "539:             . \"img-src 'self' data: \"",
          "540:             . $GLOBALS['cfg']['CSPAllow']",
          "541:             . $map_tile_urls",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "539:             . \"referrer no-referrer;\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "547:             . $captcha_url",
          "548:             . $GLOBALS['cfg']['CSPAllow'] . ';'",
          "549:             . \"options inline-script eval-script;\"",
          "550:             . \"img-src 'self' data: \"",
          "551:             . $GLOBALS['cfg']['CSPAllow']",
          "552:             . $map_tile_urls",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "551:             . \"referrer no-referrer;\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "561:             . $captcha_url",
          "562:             . $GLOBALS['cfg']['CSPAllow']",
          "563:             . \" 'unsafe-inline' 'unsafe-eval';\"",
          "564:             . \"style-src 'self' 'unsafe-inline' \"",
          "565:             . $captcha_url",
          "566:             . ';'",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "566:             . \"referrer no-referrer;\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "606:     private function _getMetaTags()",
          "607:     {",
          "608:         $retval  = '<meta charset=\"utf-8\" />';",
          "609:         $retval .= '<meta name=\"robots\" content=\"noindex,nofollow\" />';",
          "610:         $retval .= '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\">';",
          "611:         if (! $GLOBALS['cfg']['AllowThirdPartyFraming']) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "612:         $retval .= '<meta name=\"referrer\" content=\"none\" />';",
          "",
          "---------------"
        ]
      }
    }
  ]
}