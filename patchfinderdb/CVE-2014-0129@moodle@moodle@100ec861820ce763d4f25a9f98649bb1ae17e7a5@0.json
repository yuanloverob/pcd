{
  "cve_id": "CVE-2014-0129",
  "cve_desc": "badges/mybadges.php in Moodle 2.5.x before 2.5.5 and 2.6.x before 2.6.2 does not properly track the user to whom a badge was issued, which allows remote authenticated users to modify the visibility of an arbitrary badge via unspecified vectors.",
  "repo": "moodle/moodle",
  "patch_hash": "100ec861820ce763d4f25a9f98649bb1ae17e7a5",
  "patch_info": {
    "commit_hash": "100ec861820ce763d4f25a9f98649bb1ae17e7a5",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/100ec861820ce763d4f25a9f98649bb1ae17e7a5",
    "files": [
      "badges/mybadges.php"
    ],
    "message": "MDL-44140 badges: Prevent non-owners to change visibility of issued badges\n\nSigned-off-by: Yuliya Bozhko <yuliya.bozhko@totaralms.com>",
    "before_after_code_files": [
      "badges/mybadges.php||badges/mybadges.php"
    ]
  },
  "patch_diff": {
    "badges/mybadges.php||badges/mybadges.php": [
      "File: badges/mybadges.php -> badges/mybadges.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "64: if ($hide) {",
      "65:     require_sesskey();",
      "67: } else if ($show) {",
      "68:     require_sesskey();",
      "70: } else if ($download && $hash) {",
      "71:     require_sesskey();",
      "72:     $badge = new badge($download);",
      "",
      "[Removed Lines]",
      "66:     $DB->set_field('badge_issued', 'visible', 0, array('id' => $hide));",
      "69:     $DB->set_field('badge_issued', 'visible', 1, array('id' => $show));",
      "",
      "[Added Lines]",
      "66:     $DB->set_field('badge_issued', 'visible', 0, array('id' => $hide, 'userid' => $USER->id));",
      "69:     $DB->set_field('badge_issued', 'visible', 1, array('id' => $show, 'userid' => $USER->id));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "28c8ac2c4a8d831f0efd653fa499a5d2384e6e88",
      "candidate_info": {
        "commit_hash": "28c8ac2c4a8d831f0efd653fa499a5d2384e6e88",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/28c8ac2c4a8d831f0efd653fa499a5d2384e6e88",
        "files": [
          "badges/mybadges.php"
        ],
        "message": "MDL-44140 badges: Prevent non-owners to change visibility of issued badges\n\nSigned-off-by: Yuliya Bozhko <yuliya.bozhko@totaralms.com>",
        "before_after_code_files": [
          "badges/mybadges.php||badges/mybadges.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "badges/mybadges.php||badges/mybadges.php"
          ],
          "candidate": [
            "badges/mybadges.php||badges/mybadges.php"
          ]
        }
      },
      "candidate_diff": {
        "badges/mybadges.php||badges/mybadges.php": [
          "File: badges/mybadges.php -> badges/mybadges.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "64: if ($hide) {",
          "65:     require_sesskey();",
          "67: } else if ($show) {",
          "68:     require_sesskey();",
          "70: } else if ($download && $hash) {",
          "71:     require_sesskey();",
          "72:     $badge = new badge($download);",
          "",
          "[Removed Lines]",
          "66:     $DB->set_field('badge_issued', 'visible', 0, array('id' => $hide));",
          "69:     $DB->set_field('badge_issued', 'visible', 1, array('id' => $show));",
          "",
          "[Added Lines]",
          "66:     $DB->set_field('badge_issued', 'visible', 0, array('id' => $hide, 'userid' => $USER->id));",
          "69:     $DB->set_field('badge_issued', 'visible', 1, array('id' => $show, 'userid' => $USER->id));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c5d7d20f40a71e23d951c7272675a19fef170fbe",
      "candidate_info": {
        "commit_hash": "c5d7d20f40a71e23d951c7272675a19fef170fbe",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/c5d7d20f40a71e23d951c7272675a19fef170fbe",
        "files": [
          "badges/mybadges.php"
        ],
        "message": "MDL-44140 badges: Prevent non-owners to change visibility of issued badges\n\nSigned-off-by: Yuliya Bozhko <yuliya.bozhko@totaralms.com>",
        "before_after_code_files": [
          "badges/mybadges.php||badges/mybadges.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "badges/mybadges.php||badges/mybadges.php"
          ],
          "candidate": [
            "badges/mybadges.php||badges/mybadges.php"
          ]
        }
      },
      "candidate_diff": {
        "badges/mybadges.php||badges/mybadges.php": [
          "File: badges/mybadges.php -> badges/mybadges.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "64: if ($hide) {",
          "65:     require_sesskey();",
          "67: } else if ($show) {",
          "68:     require_sesskey();",
          "70: } else if ($download && $hash) {",
          "71:     require_sesskey();",
          "72:     $badge = new badge($download);",
          "",
          "[Removed Lines]",
          "66:     $DB->set_field('badge_issued', 'visible', 0, array('id' => $hide));",
          "69:     $DB->set_field('badge_issued', 'visible', 1, array('id' => $show));",
          "",
          "[Added Lines]",
          "66:     $DB->set_field('badge_issued', 'visible', 0, array('id' => $hide, 'userid' => $USER->id));",
          "69:     $DB->set_field('badge_issued', 'visible', 1, array('id' => $show, 'userid' => $USER->id));",
          "",
          "---------------"
        ]
      }
    }
  ]
}