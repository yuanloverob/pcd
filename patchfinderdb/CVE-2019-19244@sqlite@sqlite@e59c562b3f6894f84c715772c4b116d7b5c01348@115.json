{
  "cve_id": "CVE-2019-19244",
  "cve_desc": "sqlite3Select in select.c in SQLite 3.30.1 allows a crash if a sub-select uses both DISTINCT and window functions, and also has certain ORDER BY usage.",
  "repo": "sqlite/sqlite",
  "patch_hash": "e59c562b3f6894f84c715772c4b116d7b5c01348",
  "patch_info": {
    "commit_hash": "e59c562b3f6894f84c715772c4b116d7b5c01348",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/e59c562b3f6894f84c715772c4b116d7b5c01348",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/select.c",
      "test/window1.test"
    ],
    "message": "Fix a crash that could occur if a sub-select that uses both DISTINCT and window functions also used an ORDER BY that is the same as its select list.\n\nFossilOrigin-Name: bcdd66c1691955c697f3d756c2b035acfe98f6aad72e90b0021bab6e9023b3ba",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/select.c||src/select.c",
      "test/window1.test||test/window1.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 6a64fb6a2da6c98f1e87b55ad5689967e1db4eae2e08345471d95e28cd567e0f",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/select.c||src/select.c": [
      "File: src/select.c -> src/select.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "6065:   if( (p->selFlags & (SF_Distinct|SF_Aggregate))==SF_Distinct",
      "6066:    && sqlite3ExprListCompare(sSort.pOrderBy, pEList, -1)==0",
      "6067:   ){",
      "6068:     p->selFlags &= ~SF_Distinct;",
      "6069:     pGroupBy = p->pGroupBy = sqlite3ExprListDup(db, pEList, 0);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6067:    && p->pWin==0",
      "",
      "---------------"
    ],
    "test/window1.test||test/window1.test": [
      "File: test/window1.test -> test/window1.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "1243:   ALTER TABLE a0 RENAME TO S;",
      "1244: } {1 {error in view a: 1st ORDER BY term does not match any column in the result set}}",
      "1246: finish_test",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1246: reset_db",
      "1247: do_execsql_test 33.1 {",
      "1248:   CREATE TABLE t1(aa, bb);",
      "1249:   INSERT INTO t1 VALUES(1, 2);",
      "1250:   INSERT INTO t1 VALUES(5, 6);",
      "1251:   CREATE TABLE t2(x);",
      "1252:   INSERT INTO t2 VALUES(1);",
      "1253: }",
      "1254: do_execsql_test 33.2 {",
      "1255:   SELECT (SELECT DISTINCT sum(aa) OVER() FROM t1 ORDER BY 1), x FROM t2",
      "1256:   ORDER BY 1;",
      "1257: } {6 1}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1d4b16405b1463dea57d3f704ecb38f6e3038501",
      "candidate_info": {
        "commit_hash": "1d4b16405b1463dea57d3f704ecb38f6e3038501",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/1d4b16405b1463dea57d3f704ecb38f6e3038501",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/build.c",
          "src/vdbe.c",
          "src/vdbeaux.c",
          "test/vtabdrop.test"
        ],
        "message": "Fix a problem causing the sqlite_master entry corresponding to a virtual table to be removed by a DROP TABLE even if the call to the vtabs xDestroy() method failed.\n\nFossilOrigin-Name: 0140f6dbfbea93eadcd7f727d84064a0c0d1f0806dbe3e5ef1017da603157e3b",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/build.c||src/build.c",
          "src/vdbe.c||src/vdbe.c",
          "src/vdbeaux.c||src/vdbeaux.c",
          "test/vtabdrop.test||test/vtabdrop.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: c3a3a11194586bef80a9d7ca54caae8af30d4e7b464b8bb3d257ba2d2ec4791f",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/build.c||src/build.c": [
          "File: src/build.c -> src/build.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2639:   if( IsVirtual(pTab) ){",
          "2640:     sqlite3VdbeAddOp4(v, OP_VDestroy, iDb, 0, 0, pTab->zName, 0);",
          "2641:   }",
          "2642:   sqlite3VdbeAddOp4(v, OP_DropTable, iDb, 0, 0, pTab->zName, 0);",
          "2643:   sqlite3ChangeCookie(pParse, iDb);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2641:     sqlite3MayAbort(pParse);",
          "",
          "---------------"
        ],
        "src/vdbe.c||src/vdbe.c": [
          "File: src/vdbe.c -> src/vdbe.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "6849:   db->nVDestroy++;",
          "6850:   rc = sqlite3VtabCallDestroy(db, pOp->p1, pOp->p4.z);",
          "6851:   db->nVDestroy--;",
          "6852:   if( rc ) goto abort_due_to_error;",
          "6853:   break;",
          "6854: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6852:   assert( p->errorAction==OE_Abort && p->usesStmtJournal );",
          "",
          "---------------"
        ],
        "src/vdbeaux.c||src/vdbeaux.c": [
          "File: src/vdbeaux.c -> src/vdbeaux.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "603:   while( (pOp = opIterNext(&sIter))!=0 ){",
          "604:     int opcode = pOp->opcode;",
          "605:     if( opcode==OP_Destroy || opcode==OP_VUpdate || opcode==OP_VRename",
          "606:      || ((opcode==OP_Halt || opcode==OP_HaltIfNull)",
          "607:       && ((pOp->p1&0xff)==SQLITE_CONSTRAINT && pOp->p2==OE_Abort))",
          "608:     ){",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "606:      || opcode==OP_VDestroy",
          "",
          "---------------"
        ],
        "test/vtabdrop.test||test/vtabdrop.test": [
          "File: test/vtabdrop.test -> test/vtabdrop.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # 2018 December 28",
          "2: #",
          "3: #    May you do good and not evil.",
          "4: #    May you find forgiveness for yourself and forgive others.",
          "5: #    May you share freely, never taking more than you give.",
          "6: #",
          "7: #***********************************************************************",
          "8: #",
          "9: # The tests in this file test edge cases surrounding DROP TABLE on",
          "10: # virtual tables.",
          "11: #",
          "13: set testdir [file dirname $argv0]",
          "14: source $testdir/tester.tcl",
          "16: ifcapable !vtab { finish_test ; return }",
          "17: source $testdir/fts3_common.tcl",
          "18: source $testdir/malloc_common.tcl",
          "20: set testprefix vtabdrop",
          "22: #-------------------------------------------------------------------------",
          "23: # Test that if a DROP TABLE is executed against an rtree table, but the",
          "24: # xDestroy() call fails, the rtree table is not dropped, the sqlite_master",
          "25: # table is not modified and the internal schema remains intact.",
          "26: #",
          "27: ifcapable rtree {",
          "28:   do_execsql_test 1.0 {",
          "29:     CREATE VIRTUAL TABLE rt USING rtree(id, x1, x2);",
          "30:     CREATE TABLE t1(x, y);",
          "31:     INSERT INTO t1 VALUES(1, 2);",
          "32:   }",
          "34:   do_test 1.1 {",
          "35:     execsql {",
          "36:       BEGIN;",
          "37:         INSERT INTO t1 VALUES(3, 4);",
          "38:     }",
          "39:     db eval { SELECT * FROM t1 } {",
          "40:       catchsql { DROP TABLE rt }",
          "41:     }",
          "42:     execsql COMMIT",
          "43:   } {}",
          "45:   do_execsql_test 1.2 {",
          "46:     SELECT name FROM sqlite_master ORDER BY 1;",
          "47:     SELECT * FROM t1;",
          "48:     SELECT * FROM rt;",
          "49:   } {rt rt_node rt_parent rt_rowid t1 1 2 3 4}",
          "51:   db close",
          "52:   sqlite3 db test.db",
          "54:   do_execsql_test 1.3 {",
          "55:     SELECT name FROM sqlite_master ORDER BY 1;",
          "56:   } {rt rt_node rt_parent rt_rowid t1}",
          "57: }",
          "59: #-------------------------------------------------------------------------",
          "60: # Same as tests 1.*, except with fts5 instead of rtree.",
          "61: #",
          "62: ifcapable fts5 {",
          "63:   reset_db",
          "64:   do_execsql_test 2.0 {",
          "65:     CREATE VIRTUAL TABLE ft USING fts5(x);",
          "66:     CREATE TABLE t1(x, y);",
          "67:     INSERT INTO t1 VALUES(1, 2);",
          "68:   }",
          "70:   do_test 2.1 {",
          "71:     execsql {",
          "72:       BEGIN;",
          "73:         INSERT INTO t1 VALUES(3, 4);",
          "74:     }",
          "75:     db eval { SELECT * FROM t1 } {",
          "76:       catchsql { DROP TABLE ft }",
          "77:     }",
          "78:     execsql COMMIT",
          "79:   } {}",
          "81:   do_execsql_test 2.2 {",
          "82:     SELECT name FROM sqlite_master ORDER BY 1;",
          "83:   } {ft ft_config ft_content ft_data ft_docsize ft_idx t1}",
          "85:   db close",
          "86:   sqlite3 db test.db",
          "88:   do_execsql_test 2.3 {",
          "89:     SELECT name FROM sqlite_master ORDER BY 1;",
          "90:   } {ft ft_config ft_content ft_data ft_docsize ft_idx t1}",
          "91: }",
          "93: #-------------------------------------------------------------------------",
          "94: # Same as tests 1.*, except with fts3 instead of rtree.",
          "95: #",
          "96: ifcapable fts3 {",
          "97:   reset_db",
          "98:   do_execsql_test 2.0 {",
          "99:     CREATE VIRTUAL TABLE ft USING fts3(x);",
          "100:     CREATE TABLE t1(x, y);",
          "101:     INSERT INTO t1 VALUES(1, 2);",
          "102:   }",
          "104:   do_test 2.1 {",
          "105:     execsql {",
          "106:       BEGIN;",
          "107:         INSERT INTO t1 VALUES(3, 4);",
          "108:     }",
          "109:     db eval { SELECT * FROM t1 } {",
          "110:       catchsql { DROP TABLE ft }",
          "111:     }",
          "112:     execsql COMMIT",
          "113:   } {}",
          "115:   do_execsql_test 2.2 {",
          "116:     SELECT name FROM sqlite_master ORDER BY 1;",
          "117:   } {ft ft_content ft_segdir ft_segments sqlite_autoindex_ft_segdir_1 t1}",
          "119:   db close",
          "120:   sqlite3 db test.db",
          "122:   do_execsql_test 2.3 {",
          "123:     SELECT name FROM sqlite_master ORDER BY 1;",
          "124:   } {ft ft_content ft_segdir ft_segments sqlite_autoindex_ft_segdir_1 t1}",
          "125: }",
          "127: finish_test",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "48cd0f28c5a192a903cf717e0789f3402571333e",
      "candidate_info": {
        "commit_hash": "48cd0f28c5a192a903cf717e0789f3402571333e",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/48cd0f28c5a192a903cf717e0789f3402571333e",
        "files": [
          "manifest",
          "manifest.uuid",
          "test/tkt-80ba201079.test"
        ],
        "message": "Remove debugging pragmas accidently left in by a prior change.\n\nFossilOrigin-Name: 26275fc7e89eb2542a65d01fd271cef016a4a1815bc3845c599cf2f4fbf7513d",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "test/tkt-80ba201079.test||test/tkt-80ba201079.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: ccc4f7424bc8f37c168333091dd9e3d6f80ccff9e2b06f182df65be59a7e3349",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/tkt-80ba201079.test||test/tkt-80ba201079.test": [
          "File: test/tkt-80ba201079.test -> test/tkt-80ba201079.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "110: } {300 object_change 2048}",
          "111: do_test tkt-80ba2-201 {",
          "112:   db eval {",
          "115:     CREATE INDEX timeline_entry_id_idx on timeline(entry_id);",
          "116:     SELECT entry_type,",
          "117:            entry_types.name,",
          "",
          "[Removed Lines]",
          "113: PRAGMA vdbe_debug=on;",
          "114: PRAGMA vdbe_addoptrace=on;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0e14e987069924a90bb20a466cc0c3314dbda822",
      "candidate_info": {
        "commit_hash": "0e14e987069924a90bb20a466cc0c3314dbda822",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/0e14e987069924a90bb20a466cc0c3314dbda822",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/alter.c",
          "test/altertab2.test"
        ],
        "message": "Fix a fairly obscure problem allowing an \"ALTER TABLE RENAME col TO ...\" statement to modify the schema in such a way as to break a reference within a trigger program.\n\nFossilOrigin-Name: 64bec9e6214c6932fab5a3fb8c569ae14cd2d603bd0f8b26104815c3bb9d396a",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/alter.c||src/alter.c",
          "test/altertab2.test||test/altertab2.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 05df5f7aeaf2132810452e8871132d1e66650a841991cb2a9ce32f2d03e20bf4",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/alter.c||src/alter.c": [
          "File: src/alter.c -> src/alter.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1081:   Trigger *pNew = pParse->pNewTrigger;",
          "1082:   TriggerStep *pStep;",
          "1083:   NameContext sNC;",
          "1085:   int rc = SQLITE_OK;",
          "1087:   memset(&sNC, 0, sizeof(sNC));",
          "",
          "[Removed Lines]",
          "1084:   SrcList sSrc;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1112:       if( pTarget==0 ){",
          "1113:         rc = SQLITE_ERROR;",
          "1114:       }else if( SQLITE_OK==(rc = sqlite3ViewGetColumnNames(pParse, pTarget)) ){",
          "1115:         memset(&sSrc, 0, sizeof(sSrc));",
          "1116:         sSrc.nSrc = 1;",
          "1117:         sSrc.a[0].zName = pStep->zTarget;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1114:         SrcList sSrc;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1143:           }",
          "1144:           sNC.ncFlags = 0;",
          "1145:         }",
          "1146:       }",
          "1147:     }",
          "1148:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1146:         sNC.pSrcList = 0;",
          "",
          "---------------"
        ],
        "test/altertab2.test||test/altertab2.test": [
          "File: test/altertab2.test -> test/altertab2.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "305:   END}",
          "306: }",
          "309: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "308: #-------------------------------------------------------------------------",
          "309: reset_db",
          "310: do_execsql_test 8.0 {",
          "311:   CREATE TABLE t1(a, b, c);",
          "312:   CREATE TABLE t2(a, b, c);",
          "313:   CREATE TABLE t3(d, e, f);",
          "314:   CREATE VIEW v1 AS SELECT * FROM t1;",
          "315:   CREATE TRIGGER tr AFTER INSERT ON t3 BEGIN",
          "316:     UPDATE t2 SET a = new.d;",
          "317:     SELECT a, b, c FROM v1;",
          "318:   END;",
          "319: }",
          "321: do_execsql_test 8.1 {",
          "322:   INSERT INTO t3 VALUES(1, 2, 3);",
          "323: }",
          "325: # The following ALTER TABLE fails as if column \"t1.a\" is renamed the \"a\"",
          "326: # in the \"SELECT a, b, c FROM v1\" within the trigger can no longer be",
          "327: # resolved. But at one point there was a bug allowing the ALTER TABLE",
          "328: # succeed. Which meant the subsequent INSERT statement would fail.",
          "329: do_catchsql_test 8.2 {",
          "330:   ALTER TABLE t1 RENAME a TO aaa;",
          "331: } {1 {error in trigger tr after rename: no such column: a}}",
          "332: do_execsql_test 8.3 {",
          "333:   INSERT INTO t3 VALUES(4, 5, 6);",
          "334: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5a9c6bcc158633596ea7c7d9778c4e7671fd183b",
      "candidate_info": {
        "commit_hash": "5a9c6bcc158633596ea7c7d9778c4e7671fd183b",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/5a9c6bcc158633596ea7c7d9778c4e7671fd183b",
        "files": [
          "Makefile.in",
          "main.mk",
          "manifest",
          "manifest.uuid",
          "tool/index_usage.c"
        ],
        "message": "Enhancements to the index_usage utility program.\n\nFossilOrigin-Name: 19c739b4a8a43d894e37a99fa34838f3e3fa1fe0d019aefbc33f1d38d76af1a4",
        "before_after_code_files": [
          "Makefile.in||Makefile.in",
          "main.mk||main.mk",
          "manifest.uuid||manifest.uuid",
          "tool/index_usage.c||tool/index_usage.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "Makefile.in||Makefile.in": [
          "File: Makefile.in -> Makefile.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "1335:  $(LTLINK) -o $@ $(TOP)/tool/showshm.c",
          "1337: index_usage$(TEXE): $(TOP)/tool/index_usage.c sqlite3.lo",
          "1340: changeset$(TEXE): $(TOP)/ext/session/changeset.c sqlite3.lo",
          "1341:  $(LTLINK) -o $@ $(TOP)/ext/session/changeset.c sqlite3.lo $(TLIBS)",
          "",
          "[Removed Lines]",
          "1338:  $(LTLINK) -o $@ $(TOP)/tool/index_usage.c sqlite3.lo $(TLIBS)",
          "",
          "[Added Lines]",
          "1338:  $(LTLINK) $(SHELL_OPT) -o $@ $(TOP)/tool/index_usage.c sqlite3.lo $(TLIBS)",
          "",
          "---------------"
        ],
        "main.mk||main.mk": [
          "File: main.mk -> main.mk",
          "--- Hunk 1 ---",
          "[Context before]",
          "1021:  $(TCC) -o showshm$(EXE) $(TOP)/tool/showshm.c",
          "1023: index_usage$(EXE): $(TOP)/tool/index_usage.c sqlite3.o",
          "1025:   $(TOP)/tool/index_usage.c sqlite3.o $(THREADLIB)",
          "1027: changeset$(EXE): $(TOP)/ext/session/changeset.c sqlite3.o",
          "",
          "[Removed Lines]",
          "1024:  $(TCC) -DSQLITE_THREADSAFE=0 -DSQLITE_OMIT_DEPRECATED -o index_usage$(EXE) \\",
          "",
          "[Added Lines]",
          "1024:  $(TCC) -DSQLITE_THREADSAFE=0 -DSQLITE_OMIT_DEPRECATED $(SHELL_OPTS) -o index_usage$(EXE) \\",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 760d14374d40bcd9ce3a89771c18dc236c9728553c4747c9b7452ee7b24f4140",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "tool/index_usage.c||tool/index_usage.c": [
          "File: tool/index_usage.c -> tool/index_usage.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "90:            argv[2], sqlite3_errmsg(db));",
          "91:     goto errorOut;",
          "92:   }",
          "94:                           -1, &pStmt, 0);",
          "95:   if( rc ){",
          "96:     printf(\"Cannot read the SQLLOG table in the LOG database \\\"%s\\\" - %s\\n\",",
          "",
          "[Removed Lines]",
          "93:   rc = sqlite3_prepare_v2(db, \"SELECT sql, rowid FROM log.sqllog\",",
          "",
          "[Added Lines]",
          "93:   rc = sqlite3_prepare_v2(db,",
          "94:      \"SELECT sql, rowid FROM log.sqllog\"",
          "95:      \" WHERE upper(substr(sql,1,5)) NOT IN ('BEGIN','COMMI','ROLLB','PRAGM')\",",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "298680d15a694b4c4b5fb7f7bd5d06cb3f08016e",
      "candidate_info": {
        "commit_hash": "298680d15a694b4c4b5fb7f7bd5d06cb3f08016e",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/298680d15a694b4c4b5fb7f7bd5d06cb3f08016e",
        "files": [
          "ext/fts5/fts5_index.c",
          "ext/fts5/test/fts5corrupt3.test",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Fix a potential buffer overrun in fts5 caused by corrupt database records.\n\nFossilOrigin-Name: 156d612800a7282fe0ebb20feb31d3fd577f4ab60fab8c00940c87143997aefb",
        "before_after_code_files": [
          "ext/fts5/fts5_index.c||ext/fts5/fts5_index.c",
          "ext/fts5/test/fts5corrupt3.test||ext/fts5/test/fts5corrupt3.test",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/fts5/fts5_index.c||ext/fts5/fts5_index.c": [
          "File: ext/fts5/fts5_index.c -> ext/fts5/fts5_index.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4997:         Fts5PoslistWriter writer;",
          "4998:         memset(&writer, 0, sizeof(writer));",
          "5000:         fts5MergeAppendDocid(&out, iLastRowid, i2.iRowid);",
          "5001:         fts5BufferZero(&tmp);",
          "5003:         if( p->rc ) break;",
          "5005:         sqlite3Fts5PoslistNext64(a1, i1.nPoslist, &iOff1, &iPos1);",
          "",
          "[Removed Lines]",
          "5002:         sqlite3Fts5BufferSize(&p->rc, &tmp, i1.nPoslist + i2.nPoslist);",
          "",
          "[Added Lines]",
          "5005:         sqlite3Fts5BufferSize(&p->rc, &tmp, i1.nPoslist + i2.nPoslist + 10 + 10);",
          "",
          "---------------"
        ],
        "ext/fts5/test/fts5corrupt3.test||ext/fts5/test/fts5corrupt3.test": [
          "File: ext/fts5/test/fts5corrupt3.test -> ext/fts5/test/fts5corrupt3.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "9367:   SELECT * FROM t1 WHERE b MATCH 'thead*thead*theSt*';",
          "9368: } {/*malformed database schema*/}",
          "9370: sqlite3_fts5_may_be_corrupt 0",
          "9371: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9370: #---------------------------------------------------------------------------",
          "9371: do_test 64.0 {",
          "9372:   sqlite3 db {}",
          "9373:   db deserialize [decode_hexdb {",
          "9374: .open --hexdb",
          "9375: | size 28672 pagesize 4096 filename crash-4470f0b94422f7.db",
          "9376: | page 1 offset 0",
          "9377: |      0: 53 51 4c 69 74 65 20 66 6f 72 6d 61 74 20 33 00   SQLite format 3.",
          "9378: |     16: 10 00 01 01 00 40 20 20 00 00 00 00 00 00 00 06   .....@  ........",
          "9379: |     32: 00 00 00 00 00 00 00 00 00 00 00 06 00 00 00 04   ................",
          "9380: |     96: 00 00 00 00 0d 00 00 00 06 0d e2 00 0f c4 0f 6a   ...............j",
          "9381: |    112: 0e fc 0e 9d 0e 3d 0d e2 00 00 00 00 00 01 00 00   .....=..........",
          "9382: |   3552: 00 00 59 06 06 17 21 21 01 7f 74 61 62 6c 65 74   ..Y...!!..tablet",
          "9383: |   3568: 74 74 5f 63 6f 6e 66 69 67 74 74 74 5f 63 6f 6e   tt_configttt_con",
          "9384: |   3584: 66 69 67 06 43 52 45 41 54 45 20 54 41 42 4c 45   fig.CREATE TABLE",
          "9385: |   3600: 20 27 74 74 74 5f 63 6f 6e 66 69 67 27 28 6b 20    'ttt_config'(k",
          "9386: |   3616: 50 52 49 4d 41 52 59 20 4b 45 59 2c 20 76 29 20   PRIMARY KEY, v)",
          "9387: |   3632: 57 49 54 48 4f 55 54 20 52 4f 57 49 44 5e 05 07   WITHOUT ROWID^..",
          "9388: |   3648: 17 23 23 01 81 03 74 61 62 6c 65 74 74 74 5f 64   .##...tablettt_d",
          "9389: |   3664: 6f 63 73 69 7a 65 74 74 74 5f 64 6f 63 73 69 7a   ocsizettt_docsiz",
          "9390: |   3680: 65 05 43 52 45 41 54 45 20 54 41 42 4c 45 20 27   e.CREATE TABLE '",
          "9391: |   3696: 74 74 74 5f 64 6f 63 73 69 7a 65 27 28 69 64 20   ttt_docsize'(id",
          "9392: |   3712: 49 4e 54 45 47 45 52 20 50 52 49 4d 41 52 59 20   INTEGER PRIMARY",
          "9393: |   3728: 4b 45 59 2c 20 73 7a 20 42 4c 4f 42 29 5d 04 07   KEY, sz BLOB)]..",
          "9394: |   3744: 17 23 23 01 81 01 74 61 62 6c 65 74 74 74 5f 63   .##...tablettt_c",
          "9395: |   3760: 6f 6e 74 65 6e 74 74 74 74 5f 63 6f 6e 74 65 6e   ontentttt_conten",
          "9396: |   3776: 74 04 43 52 45 41 54 45 20 54 41 42 4c 45 20 27   t.CREATE TABLE '",
          "9397: |   3792: 74 74 74 5f 63 6f 6e 74 65 6e 74 27 28 69 64 20   ttt_content'(id",
          "9398: |   3808: 49 4e 54 45 47 45 52 20 50 52 49 4d 41 52 59 20   INTEGER PRIMARY",
          "9399: |   3824: 4b 45 59 2c 20 63 30 2c 20 63 31 29 6c 03 07 17   KEY, c0, c1)l...",
          "9400: |   3840: 1b 1b 01 81 2f 74 61 62 6c 65 74 74 74 5f 69 64   ..../tablettt_id",
          "9401: |   3856: 78 74 74 74 5f 69 64 78 03 43 52 45 41 54 45 20   xttt_idx.CREATE",
          "9402: |   3872: 54 41 42 4c 45 20 27 74 74 74 5f 69 64 78 27 28   TABLE 'ttt_idx'(",
          "9403: |   3888: 73 65 67 69 64 2c 20 74 65 72 6d 2c 20 70 67 6e   segid, term, pgn",
          "9404: |   3904: 6f 2c 20 50 52 49 4d 41 52 59 20 4b 45 59 28 73   o, PRIMARY KEY(s",
          "9405: |   3920: 65 67 69 64 2c 20 74 65 72 6d 29 29 20 57 49 54   egid, term)) WIT",
          "9406: |   3936: 48 4f 55 54 20 52 4f 57 49 44 58 02 07 17 1d 1d   HOUT ROWIDX.....",
          "9407: |   3952: 01 81 03 74 61 62 6c 65 74 74 74 5f 64 61 74 61   ...tablettt_data",
          "9408: |   3968: 74 74 74 5f 64 61 74 61 02 43 52 45 41 54 45 20   ttt_data.CREATE",
          "9409: |   3984: 54 41 42 4c 45 20 27 74 74 74 5f 64 61 74 61 27   TABLE 'ttt_data'",
          "9410: |   4000: 28 69 64 20 49 4e 54 45 47 45 52 20 50 52 49 4d   (id INTEGER PRIM",
          "9411: |   4016: 41 52 59 20 4b 45 59 2c 20 62 6c 6f 63 6b 20 42   ARY KEY, block B",
          "9412: |   4032: 4c 4f 42 29 3a 01 06 17 13 13 08 5f 74 61 62 6c   LOB):......_tabl",
          "9413: |   4048: 65 74 74 74 74 74 74 43 52 45 41 54 45 20 56 49   ettttttCREATE VI",
          "9414: |   4064: 52 54 55 41 4c 20 54 41 42 4c 45 20 74 74 74 20   RTUAL TABLE ttt",
          "9415: |   4080: 55 53 49 4e 47 20 66 74 73 35 28 61 2c 20 62 29   USING fts5(a, b)",
          "9416: | page 2 offset 4096",
          "9417: |      0: 0d 0f 44 00 05 0e 81 00 0f 1a 0e 81 0f af 0f 58   ..D............X",
          "9418: |     16: 0e 98 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................",
          "9419: |   3712: 00 15 0a 03 00 30 00 00 00 00 01 03 03 00 03 01   .....0..........",
          "9420: |   3728: 01 01 02 01 01 03 01 01 81 24 8c 80 80 80 80 01   .........$......",
          "9421: |   3744: 04 00 82 4c 00 00 00 9b 02 30 65 03 1a 02 05 05   ...L.....0e.....",
          "9422: |   3760: 07 05 01 01 04 03 03 08 03 03 01 2e 02 05 05 07   ................",
          "9423: |   3776: 05 07 05 07 05 01 01 04 03 03 08 03 03 08 03 03   ................",
          "9424: |   3792: 07 f3 03 02 01 65 03 1e 03 05 05 04 05 05 01 00   .....e..........",
          "9425: |   3808: 03 06 04 04 06 04 03 01 36 03 05 05 04 06 05 04   ........6.......",
          "9426: |   3824: 06 05 04 05 05 01 01 03 06 04 04 06 04 04 06 04   ................",
          "9427: |   3840: 04 06 04 03 03 01 65 03 14 04 05 06 f5 05 01 01   ......e.........",
          "9428: |   3856: 02 08 09 01 20 04 05 07 05 07 05 07 05 05 01 00   .... ...........",
          "9429: |   3872: 02 08 0a 0a 0a 04 01 65 03 02 0a 01 06 0a 0a 0a   .......e........",
          "9430: |   3888: 05 01 65 03 06 01 01 0a 01 0a 01 01 0a 0a 0a 04   ..e.............",
          "9431: |   3904: 2b 31 21 0b 0f ef 00 14 2a 00 00 00 00 01 02 02   +1!.....*.......",
          "9432: |   3920: 00 02 01 01 01 02 01 01 50 88 80 80 80 80 01 04   ........P.......",
          "9433: |   3936: 00 81 24 00 00 00 47 02 30 65 02 1a 02 05 05 07   ..$...G.0e......",
          "9434: |   3952: 05 01 01 04 03 03 08 03 03 02 01 65 02 1e 03 05   ...........e....",
          "9435: |   3968: 05 04 05 05 01 01 03 06 04 04 06 04 03 03 01 65   ...............e",
          "9436: |   3984: 02 14 04 05 07 05 05 01 01 02 08 0a 04 01 65 02   ..............e.",
          "9437: |   4000: 02 0a 05 01 65 02 06 01 01 0a 04 12 14 0f 06 31   ....e..........1",
          "9438: |   4016: 84 80 80 80 80 01 03 00 68 00 00 00 2b 02 30 65   ........h...+.0e",
          "9439: |   4032: 01 10 02 05 05 01 01 04 03 03 02 01 65 01 12 03   ............e...",
          "9440: |   4048: 05 05 01 01 03 06 04 03 03 01 65 01 0e 04 05 05   ..........e.....",
          "9441: |   4064: 01 01 02 08 04 0d 0e 06 01 03 00 12 04 4c 4c 00   .............LL.",
          "9442: |   4080: 00 00 11 24 00 00 00 00 01 01 01 00 01 01 01 01   ...$............",
          "9443: | page 3 offset 8192",
          "9444: |      0: 0a 00 00 00 03 0f ec 00 0f 00 00 00 00 00 00 00   ................",
          "9445: |   4064: 00 00 00 00 00 00 00 00 00 00 00 00 06 04 01 0c   ................",
          "9446: |   4080: 01 03 02 06 04 01 0c 01 02 02 05 04 09 0c 01 02   ................",
          "9447: | page 4 offset 12288",
          "9448: |      0: 0d 00 00 00 04 0e 1a 00 0f c7 0f 5b 0e ef 0e 1a   ...........[....",
          "9449: |   3600: 00 00 00 00 00 00 00 00 00 00 81 52 04 06 00 81   ...........R....",
          "9450: |   3616: 5d 81 55 65 20 65 65 20 65 65 65 20 65 20 65 65   ].Ue ee eee e ee",
          "9451: |   3632: 20 65 65 65 20 65 20 65 65 20 65 65 65 66 20 65    eee e ee eeef e",
          "9452: |   3648: 65 20 65 65 65 20 65 20 65 65 20 65 65 65 20 65   e eee e ee eee e",
          "9453: |   3664: 20 65 65 20 65 65 65 65 20 65 65 20 65 65 65 20    ee eeee ee eee",
          "9454: |   3680: 65 20 65 65 20 65 65 65 20 65 20 65 65 20 65 65   e ee eee e ee ee",
          "9455: |   3696: 65 65 20 65 65 20 65 65 65 20 65 20 65 65 20 65   ee ee eee e ee e",
          "9456: |   3712: 65 65 20 65 20 65 65 20 65 65 65 65 65 65 20 65   ee e ee eeeeee e",
          "9457: |   3728: 65 20 65 20 65 20 65 20 65 65 20 65 65 65 20 65   e e e e ee eee e",
          "9458: |   3744: 65 20 65 65 65 65 65 20 65 65 20 65 20 65 1f 65   e eeeee ee e e.e",
          "9459: |   3760: 20 65 65 20 65 65 65 20 65 65 20 65 65 65 65 65    ee eee ee eeeee",
          "9460: |   3776: 20 65 65 20 65 20 65 20 65 20 65 65 20 65 65 65    ee e e e ee eee",
          "9461: |   3792: 20 65 65 20 65 65 65 65 65 20 65 65 20 65 20 65    ee eeeee ee e e",
          "9462: |   3808: 20 65 20 65 65 20 65 65 65 20 65 65 20 65 65 6a    e ee eee ee eej",
          "9463: |   3824: 03 03 ff 75 71 65 20 65 65 1f 65 65 65 20 65 20   ...uqe ee.eee e",
          "9464: |   3840: 65 65 20 65 65 65 20 65 20 65 65 20 65 65 65 65   ee eee e ee eeee",
          "9465: |   3856: 20 65 65 20 65 65 65 20 65 20 65 65 20 65 65 65    ee eee e ee eee",
          "9466: |   3872: 20 65 20 65 65 20 65 65 65 65 65 65 20 65 65 20    e ee eeeeee ee",
          "9467: |   3888: 65 20 65 20 65 20 65 65 20 65 65 65 20 65 65 20   e e e ee eee ee",
          "9468: |   3904: 65 65 65 65 65 20 65 65 20 65 20 65 20 65 20 65   eeeee ee e e e e",
          "9469: |   3920: 65 20 65 65 65 20 65 65 20 65 65 6a 02 04 00 75   e eee ee eej...u",
          "9470: |   3936: 40 65 20 65 65 20 65 65 65 20 65 20 65 65 20 65   @e ee eee e ee e",
          "9471: |   3952: 65 65 20 65 20 65 65 20 65 65 65 65 20 65 65 20   ee e ee eeee ee",
          "9472: |   3968: 65 65 65 20 65 20 65 65 20 65 65 65 20 65 20 65   eee e ee eee e e",
          "9473: |   3984: 65 20 65 65 65 65 65 65 20 65 65 20 65 20 65 20   e eeeeee ee e e",
          "9474: |   4000: 65 20 65 65 20 65 65 65 20 65 65 20 65 65 65 65   e ee eee ee eeee",
          "9475: |   4016: 65 20 65 65 20 65 20 65 20 65 20 65 65 20 65 65   e ee e e e ee ee",
          "9476: |   4032: 65 20 65 65 20 65 65 37 01 04 00 41 3f 65 20 65   e ee ee7...A?e e",
          "9477: |   4048: 65 20 65 65 65 20 65 20 65 65 20 65 65 65 20 65   e eee e ee eee e",
          "9478: |   4064: 20 65 65 20 65 65 65 65 65 65 20 65 65 20 65 20    ee eeeeee ee e",
          "9479: |   4080: 65 20 65 20 65 65 20 65 65 65 20 65 65 20 65 65   e e ee eee ee ee",
          "9480: | page 5 offset 16384",
          "9481: |      0: 0d 00 00 00 04 0f e4 00 0f f9 0f f2 0f eb 0f e4   ................",
          "9482: |   4064: 00 00 00 00 05 04 03 00 10 21 21 05 03 03 00 10   .........!!.....",
          "9483: |   4080: 11 11 05 02 03 00 10 11 11 05 01 03 00 10 09 09   ................",
          "9484: | page 6 offset 20480",
          "9485: |      0: 0a 00 00 00 01 0f f4 00 0f f4 00 00 00 00 00 00   ................",
          "9486: |   4080: 00 00 00 00 0b 03 1b 01 76 65 72 73 69 6f 6e 04   ........version.",
          "9487: | end crash-4470f0b94422f7.db",
          "9488: }]} {}",
          "9490: do_catchsql_test 64.1 {",
          "9491:   SELECT * FROM ttt('e*');",
          "9492: } {1 {database disk image is malformed}}",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: e32490128684cfeeb8213baecc78a7942b8fb63d00e375edd965bf236faeed18",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}