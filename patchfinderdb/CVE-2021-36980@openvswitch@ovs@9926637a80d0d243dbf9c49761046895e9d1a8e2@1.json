{
  "cve_id": "CVE-2021-36980",
  "cve_desc": "Open vSwitch (aka openvswitch) 2.11.0 through 2.15.0 has a use-after-free in decode_NXAST_RAW_ENCAP (called from ofpact_decode and ofpacts_decode) during the decoding of a RAW_ENCAP action.",
  "repo": "openvswitch/ovs",
  "patch_hash": "9926637a80d0d243dbf9c49761046895e9d1a8e2",
  "patch_info": {
    "commit_hash": "9926637a80d0d243dbf9c49761046895e9d1a8e2",
    "repo": "openvswitch/ovs",
    "commit_url": "https://github.com/openvswitch/ovs/commit/9926637a80d0d243dbf9c49761046895e9d1a8e2",
    "files": [
      "lib/ofp-actions.c",
      "tests/automake.mk",
      "tests/fuzz-regression-list.at",
      "tests/fuzz-regression/ofp_print_fuzzer-6540965472632832"
    ],
    "message": "ofp-actions: Fix use-after-free while decoding RAW_ENCAP.\n\nWhile decoding RAW_ENCAP action, decode_ed_prop() might re-allocate\nofpbuf if there is no enough space left.  However, function\n'decode_NXAST_RAW_ENCAP' continues to use old pointer to 'encap'\nstructure leading to write-after-free and incorrect decoding.\n\n  ==3549105==ERROR: AddressSanitizer: heap-use-after-free on address\n  0x60600000011a at pc 0x0000005f6cc6 bp 0x7ffc3a2d4410 sp 0x7ffc3a2d4408\n  WRITE of size 2 at 0x60600000011a thread T0\n    #0 0x5f6cc5 in decode_NXAST_RAW_ENCAP lib/ofp-actions.c:4461:20\n    #1 0x5f0551 in ofpact_decode ./lib/ofp-actions.inc2:4777:16\n    #2 0x5ed17c in ofpacts_decode lib/ofp-actions.c:7752:21\n    #3 0x5eba9a in ofpacts_pull_openflow_actions__ lib/ofp-actions.c:7791:13\n    #4 0x5eb9fc in ofpacts_pull_openflow_actions lib/ofp-actions.c:7835:12\n    #5 0x64bb8b in ofputil_decode_packet_out lib/ofp-packet.c:1113:17\n    #6 0x65b6f4 in ofp_print_packet_out lib/ofp-print.c:148:13\n    #7 0x659e3f in ofp_to_string__ lib/ofp-print.c:1029:16\n    #8 0x659b24 in ofp_to_string lib/ofp-print.c:1244:21\n    #9 0x65a28c in ofp_print lib/ofp-print.c:1288:28\n    #10 0x540d11 in ofctl_ofp_parse utilities/ovs-ofctl.c:2814:9\n    #11 0x564228 in ovs_cmdl_run_command__ lib/command-line.c:247:17\n    #12 0x56408a in ovs_cmdl_run_command lib/command-line.c:278:5\n    #13 0x5391ae in main utilities/ovs-ofctl.c:179:9\n    #14 0x7f6911ce9081 in __libc_start_main (/lib64/libc.so.6+0x27081)\n    #15 0x461fed in _start (utilities/ovs-ofctl+0x461fed)\n\nFix that by getting a new pointer before using.\n\nCredit to OSS-Fuzz.\n\nFuzzer regression test will fail only with AddressSanitizer enabled.\n\nReported-at: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=27851\nFixes: f839892a206a (\"OF support and translation of generic encap and decap\")\nAcked-by: William Tu <u9012063@gmail.com>\nSigned-off-by: Ilya Maximets <i.maximets@ovn.org>",
    "before_after_code_files": [
      "lib/ofp-actions.c||lib/ofp-actions.c",
      "tests/automake.mk||tests/automake.mk",
      "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
    ]
  },
  "patch_diff": {
    "lib/ofp-actions.c||lib/ofp-actions.c": [
      "File: lib/ofp-actions.c -> lib/ofp-actions.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "4346:     ds_put_format(fp->s, \"%s)%s\", colors.paren, colors.end);",
      "4347: }",
      "4350: static enum ofperr",
      "4351: check_FIN_TIMEOUT(const struct ofpact_fin_timeout *a OVS_UNUSED,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "4373: static enum ofperr",
      "4374: decode_NXAST_RAW_ENCAP(const struct nx_action_encap *nae,",
      "4375:                        enum ofp_version ofp_version OVS_UNUSED,",
      "4376:                        struct ofpbuf *out)",
      "4377: {",
      "4378:     struct ofpact_encap *encap;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4377: {",
      "",
      "---------------"
    ],
    "tests/automake.mk||tests/automake.mk": [
      "File: tests/automake.mk -> tests/automake.mk",
      "--- Hunk 1 ---",
      "[Context before]",
      "139:  tests/fuzz-regression/ofp_print_fuzzer-5722747668791296 \\",
      "140:  tests/fuzz-regression/ofp_print_fuzzer-6285128790704128 \\",
      "141:  tests/fuzz-regression/ofp_print_fuzzer-6470117922701312 \\",
      "143: $(srcdir)/tests/fuzz-regression-list.at: tests/automake.mk",
      "144:  $(AM_V_GEN)for name in $(FUZZ_REGRESSION_TESTS); do \\",
      "145:             basename=`echo $$name | sed 's,^.*/,,'`; \\",
      "",
      "[Removed Lines]",
      "142:  tests/fuzz-regression/ofp_print_fuzzer-6502620041576448",
      "",
      "[Added Lines]",
      "142:  tests/fuzz-regression/ofp_print_fuzzer-6502620041576448 \\",
      "143:  tests/fuzz-regression/ofp_print_fuzzer-6540965472632832",
      "",
      "---------------"
    ],
    "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at": [
      "File: tests/fuzz-regression-list.at -> tests/fuzz-regression-list.at",
      "--- Hunk 1 ---",
      "[Context before]",
      "21: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6285128790704128])",
      "22: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6470117922701312])",
      "23: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6502620041576448])",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "24: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6540965472632832])",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6d67310f4d2524b466b98f05ebccc1add1e8cf35",
      "candidate_info": {
        "commit_hash": "6d67310f4d2524b466b98f05ebccc1add1e8cf35",
        "repo": "openvswitch/ovs",
        "commit_url": "https://github.com/openvswitch/ovs/commit/6d67310f4d2524b466b98f05ebccc1add1e8cf35",
        "files": [
          "lib/ofp-actions.c",
          "tests/automake.mk",
          "tests/fuzz-regression-list.at",
          "tests/fuzz-regression/ofp_print_fuzzer-6540965472632832"
        ],
        "message": "ofp-actions: Fix use-after-free while decoding RAW_ENCAP.\n\nWhile decoding RAW_ENCAP action, decode_ed_prop() might re-allocate\nofpbuf if there is no enough space left.  However, function\n'decode_NXAST_RAW_ENCAP' continues to use old pointer to 'encap'\nstructure leading to write-after-free and incorrect decoding.\n\n  ==3549105==ERROR: AddressSanitizer: heap-use-after-free on address\n  0x60600000011a at pc 0x0000005f6cc6 bp 0x7ffc3a2d4410 sp 0x7ffc3a2d4408\n  WRITE of size 2 at 0x60600000011a thread T0\n    #0 0x5f6cc5 in decode_NXAST_RAW_ENCAP lib/ofp-actions.c:4461:20\n    #1 0x5f0551 in ofpact_decode ./lib/ofp-actions.inc2:4777:16\n    #2 0x5ed17c in ofpacts_decode lib/ofp-actions.c:7752:21\n    #3 0x5eba9a in ofpacts_pull_openflow_actions__ lib/ofp-actions.c:7791:13\n    #4 0x5eb9fc in ofpacts_pull_openflow_actions lib/ofp-actions.c:7835:12\n    #5 0x64bb8b in ofputil_decode_packet_out lib/ofp-packet.c:1113:17\n    #6 0x65b6f4 in ofp_print_packet_out lib/ofp-print.c:148:13\n    #7 0x659e3f in ofp_to_string__ lib/ofp-print.c:1029:16\n    #8 0x659b24 in ofp_to_string lib/ofp-print.c:1244:21\n    #9 0x65a28c in ofp_print lib/ofp-print.c:1288:28\n    #10 0x540d11 in ofctl_ofp_parse utilities/ovs-ofctl.c:2814:9\n    #11 0x564228 in ovs_cmdl_run_command__ lib/command-line.c:247:17\n    #12 0x56408a in ovs_cmdl_run_command lib/command-line.c:278:5\n    #13 0x5391ae in main utilities/ovs-ofctl.c:179:9\n    #14 0x7f6911ce9081 in __libc_start_main (/lib64/libc.so.6+0x27081)\n    #15 0x461fed in _start (utilities/ovs-ofctl+0x461fed)\n\nFix that by getting a new pointer before using.\n\nCredit to OSS-Fuzz.\n\nFuzzer regression test will fail only with AddressSanitizer enabled.\n\nReported-at: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=27851\nFixes: f839892a206a (\"OF support and translation of generic encap and decap\")\nAcked-by: William Tu <u9012063@gmail.com>\nSigned-off-by: Ilya Maximets <i.maximets@ovn.org>",
        "before_after_code_files": [
          "lib/ofp-actions.c||lib/ofp-actions.c",
          "tests/automake.mk||tests/automake.mk",
          "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/ofp-actions.c||lib/ofp-actions.c",
            "tests/automake.mk||tests/automake.mk",
            "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
          ],
          "candidate": [
            "lib/ofp-actions.c||lib/ofp-actions.c",
            "tests/automake.mk||tests/automake.mk",
            "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
          ]
        }
      },
      "candidate_diff": {
        "lib/ofp-actions.c||lib/ofp-actions.c": [
          "File: lib/ofp-actions.c -> lib/ofp-actions.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4346:     ds_put_format(fp->s, \"%s)%s\", colors.paren, colors.end);",
          "4347: }",
          "4350: static enum ofperr",
          "4351: check_FIN_TIMEOUT(const struct ofpact_fin_timeout *a OVS_UNUSED,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4373: static enum ofperr",
          "4374: decode_NXAST_RAW_ENCAP(const struct nx_action_encap *nae,",
          "4375:                        enum ofp_version ofp_version OVS_UNUSED,",
          "4376:                        struct ofpbuf *out)",
          "4377: {",
          "4378:     struct ofpact_encap *encap;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4377: {",
          "",
          "---------------"
        ],
        "tests/automake.mk||tests/automake.mk": [
          "File: tests/automake.mk -> tests/automake.mk",
          "--- Hunk 1 ---",
          "[Context before]",
          "132:  tests/fuzz-regression/ofp_print_fuzzer-5722747668791296 \\",
          "133:  tests/fuzz-regression/ofp_print_fuzzer-6285128790704128 \\",
          "134:  tests/fuzz-regression/ofp_print_fuzzer-6470117922701312 \\",
          "136: $(srcdir)/tests/fuzz-regression-list.at: tests/automake.mk",
          "137:  $(AM_V_GEN)for name in $(FUZZ_REGRESSION_TESTS); do \\",
          "138:             basename=`echo $$name | sed 's,^.*/,,'`; \\",
          "",
          "[Removed Lines]",
          "135:  tests/fuzz-regression/ofp_print_fuzzer-6502620041576448",
          "",
          "[Added Lines]",
          "135:  tests/fuzz-regression/ofp_print_fuzzer-6502620041576448 \\",
          "136:  tests/fuzz-regression/ofp_print_fuzzer-6540965472632832",
          "",
          "---------------"
        ],
        "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at": [
          "File: tests/fuzz-regression-list.at -> tests/fuzz-regression-list.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6285128790704128])",
          "22: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6470117922701312])",
          "23: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6502620041576448])",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6540965472632832])",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8ce8dc34b5f73b30ce0c1869af9947013c3c6575",
      "candidate_info": {
        "commit_hash": "8ce8dc34b5f73b30ce0c1869af9947013c3c6575",
        "repo": "openvswitch/ovs",
        "commit_url": "https://github.com/openvswitch/ovs/commit/8ce8dc34b5f73b30ce0c1869af9947013c3c6575",
        "files": [
          "lib/ofp-actions.c",
          "tests/automake.mk",
          "tests/fuzz-regression-list.at",
          "tests/fuzz-regression/ofp_print_fuzzer-6540965472632832"
        ],
        "message": "ofp-actions: Fix use-after-free while decoding RAW_ENCAP.\n\nWhile decoding RAW_ENCAP action, decode_ed_prop() might re-allocate\nofpbuf if there is no enough space left.  However, function\n'decode_NXAST_RAW_ENCAP' continues to use old pointer to 'encap'\nstructure leading to write-after-free and incorrect decoding.\n\n  ==3549105==ERROR: AddressSanitizer: heap-use-after-free on address\n  0x60600000011a at pc 0x0000005f6cc6 bp 0x7ffc3a2d4410 sp 0x7ffc3a2d4408\n  WRITE of size 2 at 0x60600000011a thread T0\n    #0 0x5f6cc5 in decode_NXAST_RAW_ENCAP lib/ofp-actions.c:4461:20\n    #1 0x5f0551 in ofpact_decode ./lib/ofp-actions.inc2:4777:16\n    #2 0x5ed17c in ofpacts_decode lib/ofp-actions.c:7752:21\n    #3 0x5eba9a in ofpacts_pull_openflow_actions__ lib/ofp-actions.c:7791:13\n    #4 0x5eb9fc in ofpacts_pull_openflow_actions lib/ofp-actions.c:7835:12\n    #5 0x64bb8b in ofputil_decode_packet_out lib/ofp-packet.c:1113:17\n    #6 0x65b6f4 in ofp_print_packet_out lib/ofp-print.c:148:13\n    #7 0x659e3f in ofp_to_string__ lib/ofp-print.c:1029:16\n    #8 0x659b24 in ofp_to_string lib/ofp-print.c:1244:21\n    #9 0x65a28c in ofp_print lib/ofp-print.c:1288:28\n    #10 0x540d11 in ofctl_ofp_parse utilities/ovs-ofctl.c:2814:9\n    #11 0x564228 in ovs_cmdl_run_command__ lib/command-line.c:247:17\n    #12 0x56408a in ovs_cmdl_run_command lib/command-line.c:278:5\n    #13 0x5391ae in main utilities/ovs-ofctl.c:179:9\n    #14 0x7f6911ce9081 in __libc_start_main (/lib64/libc.so.6+0x27081)\n    #15 0x461fed in _start (utilities/ovs-ofctl+0x461fed)\n\nFix that by getting a new pointer before using.\n\nCredit to OSS-Fuzz.\n\nFuzzer regression test will fail only with AddressSanitizer enabled.\n\nReported-at: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=27851\nFixes: f839892a206a (\"OF support and translation of generic encap and decap\")\nAcked-by: William Tu <u9012063@gmail.com>\nSigned-off-by: Ilya Maximets <i.maximets@ovn.org>",
        "before_after_code_files": [
          "lib/ofp-actions.c||lib/ofp-actions.c",
          "tests/automake.mk||tests/automake.mk",
          "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/ofp-actions.c||lib/ofp-actions.c",
            "tests/automake.mk||tests/automake.mk",
            "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
          ],
          "candidate": [
            "lib/ofp-actions.c||lib/ofp-actions.c",
            "tests/automake.mk||tests/automake.mk",
            "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
          ]
        }
      },
      "candidate_diff": {
        "lib/ofp-actions.c||lib/ofp-actions.c": [
          "File: lib/ofp-actions.c -> lib/ofp-actions.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4431:     ds_chomp(fp->s, ',');",
          "4432:     ds_put_format(fp->s, \"%s)%s\", colors.paren, colors.end);",
          "4433: }",
          "4436: static enum ofperr",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4459: static enum ofperr",
          "4460: decode_NXAST_RAW_ENCAP(const struct nx_action_encap *nae,",
          "4461:                        enum ofp_version ofp_version OVS_UNUSED,",
          "4462:                        struct ofpbuf *out)",
          "4463: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4462:                        struct ofpbuf *out)",
          "",
          "---------------"
        ],
        "tests/automake.mk||tests/automake.mk": [
          "File: tests/automake.mk -> tests/automake.mk",
          "--- Hunk 1 ---",
          "[Context before]",
          "134:  tests/fuzz-regression/ofp_print_fuzzer-5722747668791296 \\",
          "135:  tests/fuzz-regression/ofp_print_fuzzer-6285128790704128 \\",
          "136:  tests/fuzz-regression/ofp_print_fuzzer-6470117922701312 \\",
          "138: $(srcdir)/tests/fuzz-regression-list.at: tests/automake.mk",
          "139:  $(AM_V_GEN)for name in $(FUZZ_REGRESSION_TESTS); do \\",
          "140:             basename=`echo $$name | sed 's,^.*/,,'`; \\",
          "",
          "[Removed Lines]",
          "137:  tests/fuzz-regression/ofp_print_fuzzer-6502620041576448",
          "",
          "[Added Lines]",
          "137:  tests/fuzz-regression/ofp_print_fuzzer-6502620041576448 \\",
          "138:  tests/fuzz-regression/ofp_print_fuzzer-6540965472632832",
          "",
          "---------------"
        ],
        "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at": [
          "File: tests/fuzz-regression-list.at -> tests/fuzz-regression-list.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6285128790704128])",
          "22: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6470117922701312])",
          "23: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6502620041576448])",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6540965472632832])",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "77cccc74deede443e8b9102299efc869a52b65b2",
      "candidate_info": {
        "commit_hash": "77cccc74deede443e8b9102299efc869a52b65b2",
        "repo": "openvswitch/ovs",
        "commit_url": "https://github.com/openvswitch/ovs/commit/77cccc74deede443e8b9102299efc869a52b65b2",
        "files": [
          "lib/ofp-actions.c",
          "tests/automake.mk",
          "tests/fuzz-regression-list.at",
          "tests/fuzz-regression/ofp_print_fuzzer-6540965472632832"
        ],
        "message": "ofp-actions: Fix use-after-free while decoding RAW_ENCAP.\n\nWhile decoding RAW_ENCAP action, decode_ed_prop() might re-allocate\nofpbuf if there is no enough space left.  However, function\n'decode_NXAST_RAW_ENCAP' continues to use old pointer to 'encap'\nstructure leading to write-after-free and incorrect decoding.\n\n  ==3549105==ERROR: AddressSanitizer: heap-use-after-free on address\n  0x60600000011a at pc 0x0000005f6cc6 bp 0x7ffc3a2d4410 sp 0x7ffc3a2d4408\n  WRITE of size 2 at 0x60600000011a thread T0\n    #0 0x5f6cc5 in decode_NXAST_RAW_ENCAP lib/ofp-actions.c:4461:20\n    #1 0x5f0551 in ofpact_decode ./lib/ofp-actions.inc2:4777:16\n    #2 0x5ed17c in ofpacts_decode lib/ofp-actions.c:7752:21\n    #3 0x5eba9a in ofpacts_pull_openflow_actions__ lib/ofp-actions.c:7791:13\n    #4 0x5eb9fc in ofpacts_pull_openflow_actions lib/ofp-actions.c:7835:12\n    #5 0x64bb8b in ofputil_decode_packet_out lib/ofp-packet.c:1113:17\n    #6 0x65b6f4 in ofp_print_packet_out lib/ofp-print.c:148:13\n    #7 0x659e3f in ofp_to_string__ lib/ofp-print.c:1029:16\n    #8 0x659b24 in ofp_to_string lib/ofp-print.c:1244:21\n    #9 0x65a28c in ofp_print lib/ofp-print.c:1288:28\n    #10 0x540d11 in ofctl_ofp_parse utilities/ovs-ofctl.c:2814:9\n    #11 0x564228 in ovs_cmdl_run_command__ lib/command-line.c:247:17\n    #12 0x56408a in ovs_cmdl_run_command lib/command-line.c:278:5\n    #13 0x5391ae in main utilities/ovs-ofctl.c:179:9\n    #14 0x7f6911ce9081 in __libc_start_main (/lib64/libc.so.6+0x27081)\n    #15 0x461fed in _start (utilities/ovs-ofctl+0x461fed)\n\nFix that by getting a new pointer before using.\n\nCredit to OSS-Fuzz.\n\nFuzzer regression test will fail only with AddressSanitizer enabled.\n\nReported-at: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=27851\nFixes: f839892a206a (\"OF support and translation of generic encap and decap\")\nAcked-by: William Tu <u9012063@gmail.com>\nSigned-off-by: Ilya Maximets <i.maximets@ovn.org>",
        "before_after_code_files": [
          "lib/ofp-actions.c||lib/ofp-actions.c",
          "tests/automake.mk||tests/automake.mk",
          "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/ofp-actions.c||lib/ofp-actions.c",
            "tests/automake.mk||tests/automake.mk",
            "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
          ],
          "candidate": [
            "lib/ofp-actions.c||lib/ofp-actions.c",
            "tests/automake.mk||tests/automake.mk",
            "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
          ]
        }
      },
      "candidate_diff": {
        "lib/ofp-actions.c||lib/ofp-actions.c": [
          "File: lib/ofp-actions.c -> lib/ofp-actions.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4431:     ds_chomp(fp->s, ',');",
          "4432:     ds_put_format(fp->s, \"%s)%s\", colors.paren, colors.end);",
          "4433: }",
          "4436: static enum ofperr",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4459: static enum ofperr",
          "4460: decode_NXAST_RAW_ENCAP(const struct nx_action_encap *nae,",
          "4461:                        enum ofp_version ofp_version OVS_UNUSED,",
          "4462:                        struct ofpbuf *out)",
          "4463: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4462:                        struct ofpbuf *out)",
          "",
          "---------------"
        ],
        "tests/automake.mk||tests/automake.mk": [
          "File: tests/automake.mk -> tests/automake.mk",
          "--- Hunk 1 ---",
          "[Context before]",
          "134:  tests/fuzz-regression/ofp_print_fuzzer-5722747668791296 \\",
          "135:  tests/fuzz-regression/ofp_print_fuzzer-6285128790704128 \\",
          "136:  tests/fuzz-regression/ofp_print_fuzzer-6470117922701312 \\",
          "138: $(srcdir)/tests/fuzz-regression-list.at: tests/automake.mk",
          "139:  $(AM_V_GEN)for name in $(FUZZ_REGRESSION_TESTS); do \\",
          "140:             basename=`echo $$name | sed 's,^.*/,,'`; \\",
          "",
          "[Removed Lines]",
          "137:  tests/fuzz-regression/ofp_print_fuzzer-6502620041576448",
          "",
          "[Added Lines]",
          "137:  tests/fuzz-regression/ofp_print_fuzzer-6502620041576448 \\",
          "138:  tests/fuzz-regression/ofp_print_fuzzer-6540965472632832",
          "",
          "---------------"
        ],
        "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at": [
          "File: tests/fuzz-regression-list.at -> tests/fuzz-regression-list.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6285128790704128])",
          "22: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6470117922701312])",
          "23: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6502620041576448])",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6540965472632832])",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "38744b1bcb022c611712527f039722115300f58f",
      "candidate_info": {
        "commit_hash": "38744b1bcb022c611712527f039722115300f58f",
        "repo": "openvswitch/ovs",
        "commit_url": "https://github.com/openvswitch/ovs/commit/38744b1bcb022c611712527f039722115300f58f",
        "files": [
          "lib/ofp-actions.c",
          "tests/automake.mk",
          "tests/fuzz-regression-list.at",
          "tests/fuzz-regression/ofp_print_fuzzer-6540965472632832"
        ],
        "message": "ofp-actions: Fix use-after-free while decoding RAW_ENCAP.\n\nWhile decoding RAW_ENCAP action, decode_ed_prop() might re-allocate\nofpbuf if there is no enough space left.  However, function\n'decode_NXAST_RAW_ENCAP' continues to use old pointer to 'encap'\nstructure leading to write-after-free and incorrect decoding.\n\n  ==3549105==ERROR: AddressSanitizer: heap-use-after-free on address\n  0x60600000011a at pc 0x0000005f6cc6 bp 0x7ffc3a2d4410 sp 0x7ffc3a2d4408\n  WRITE of size 2 at 0x60600000011a thread T0\n    #0 0x5f6cc5 in decode_NXAST_RAW_ENCAP lib/ofp-actions.c:4461:20\n    #1 0x5f0551 in ofpact_decode ./lib/ofp-actions.inc2:4777:16\n    #2 0x5ed17c in ofpacts_decode lib/ofp-actions.c:7752:21\n    #3 0x5eba9a in ofpacts_pull_openflow_actions__ lib/ofp-actions.c:7791:13\n    #4 0x5eb9fc in ofpacts_pull_openflow_actions lib/ofp-actions.c:7835:12\n    #5 0x64bb8b in ofputil_decode_packet_out lib/ofp-packet.c:1113:17\n    #6 0x65b6f4 in ofp_print_packet_out lib/ofp-print.c:148:13\n    #7 0x659e3f in ofp_to_string__ lib/ofp-print.c:1029:16\n    #8 0x659b24 in ofp_to_string lib/ofp-print.c:1244:21\n    #9 0x65a28c in ofp_print lib/ofp-print.c:1288:28\n    #10 0x540d11 in ofctl_ofp_parse utilities/ovs-ofctl.c:2814:9\n    #11 0x564228 in ovs_cmdl_run_command__ lib/command-line.c:247:17\n    #12 0x56408a in ovs_cmdl_run_command lib/command-line.c:278:5\n    #13 0x5391ae in main utilities/ovs-ofctl.c:179:9\n    #14 0x7f6911ce9081 in __libc_start_main (/lib64/libc.so.6+0x27081)\n    #15 0x461fed in _start (utilities/ovs-ofctl+0x461fed)\n\nFix that by getting a new pointer before using.\n\nCredit to OSS-Fuzz.\n\nFuzzer regression test will fail only with AddressSanitizer enabled.\n\nReported-at: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=27851\nFixes: f839892a206a (\"OF support and translation of generic encap and decap\")\nAcked-by: William Tu <u9012063@gmail.com>\nSigned-off-by: Ilya Maximets <i.maximets@ovn.org>",
        "before_after_code_files": [
          "lib/ofp-actions.c||lib/ofp-actions.c",
          "tests/automake.mk||tests/automake.mk",
          "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/ofp-actions.c||lib/ofp-actions.c",
            "tests/automake.mk||tests/automake.mk",
            "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
          ],
          "candidate": [
            "lib/ofp-actions.c||lib/ofp-actions.c",
            "tests/automake.mk||tests/automake.mk",
            "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at"
          ]
        }
      },
      "candidate_diff": {
        "lib/ofp-actions.c||lib/ofp-actions.c": [
          "File: lib/ofp-actions.c -> lib/ofp-actions.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4431:     ds_chomp(fp->s, ',');",
          "4432:     ds_put_format(fp->s, \"%s)%s\", colors.paren, colors.end);",
          "4433: }",
          "4436: static enum ofperr",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4459: static enum ofperr",
          "4460: decode_NXAST_RAW_ENCAP(const struct nx_action_encap *nae,",
          "4461:                        enum ofp_version ofp_version OVS_UNUSED,",
          "4462:                        struct ofpbuf *out)",
          "4463: {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4462:                        struct ofpbuf *out)",
          "",
          "---------------"
        ],
        "tests/automake.mk||tests/automake.mk": [
          "File: tests/automake.mk -> tests/automake.mk",
          "--- Hunk 1 ---",
          "[Context before]",
          "134:  tests/fuzz-regression/ofp_print_fuzzer-5722747668791296 \\",
          "135:  tests/fuzz-regression/ofp_print_fuzzer-6285128790704128 \\",
          "136:  tests/fuzz-regression/ofp_print_fuzzer-6470117922701312 \\",
          "138: $(srcdir)/tests/fuzz-regression-list.at: tests/automake.mk",
          "139:  $(AM_V_GEN)for name in $(FUZZ_REGRESSION_TESTS); do \\",
          "140:             basename=`echo $$name | sed 's,^.*/,,'`; \\",
          "",
          "[Removed Lines]",
          "137:  tests/fuzz-regression/ofp_print_fuzzer-6502620041576448",
          "",
          "[Added Lines]",
          "137:  tests/fuzz-regression/ofp_print_fuzzer-6502620041576448 \\",
          "138:  tests/fuzz-regression/ofp_print_fuzzer-6540965472632832",
          "",
          "---------------"
        ],
        "tests/fuzz-regression-list.at||tests/fuzz-regression-list.at": [
          "File: tests/fuzz-regression-list.at -> tests/fuzz-regression-list.at",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6285128790704128])",
          "22: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6470117922701312])",
          "23: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6502620041576448])",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "24: TEST_FUZZ_REGRESSION([ofp_print_fuzzer-6540965472632832])",
          "",
          "---------------"
        ]
      }
    }
  ]
}