{
  "cve_id": "CVE-2012-2330",
  "cve_desc": "The Update method in src/node_http_parser.cc in Node.js before 0.6.17 and 0.7 before 0.7.8 does not properly check the length of a string, which allows remote attackers to obtain sensitive information (request header contents) and possibly spoof HTTP headers via a zero length string.",
  "repo": "joyent/node",
  "patch_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
  "patch_info": {
    "commit_hash": "c9a231db0e59658be419d926b1dfa17b939ba158",
    "repo": "joyent/node",
    "commit_url": "https://github.com/joyent/node/commit/c9a231d",
    "files": [
      "src/node_http_parser.cc"
    ],
    "message": "typo in node_http_parser",
    "before_after_code_files": [
      "src/node_http_parser.cc||src/node_http_parser.cc"
    ]
  },
  "patch_diff": {
    "src/node_http_parser.cc||src/node_http_parser.cc": [
      "File: src/node_http_parser.cc -> src/node_http_parser.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "191:   void Update(const char* str, size_t size) {",
      "192:     if (str_ == NULL)",
      "193:       str_ = str;",
      "197:       char* s = new char[size_ + size];",
      "",
      "[Removed Lines]",
      "194:     else if (on_heap_ || str_ + size != str) {",
      "",
      "[Added Lines]",
      "194:     else if (on_heap_ || str_ + size_ != str) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "71527e3a55b4a0ce895e62f74d5407317336d64b",
      "candidate_info": {
        "commit_hash": "71527e3a55b4a0ce895e62f74d5407317336d64b",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/71527e3a55b4a0ce895e62f74d5407317336d64b",
        "files": [
          "deps/v8/SConstruct",
          "deps/v8/tools/gyp/v8.gyp"
        ],
        "message": "Patches floating on v8",
        "before_after_code_files": [
          "deps/v8/tools/gyp/v8.gyp||deps/v8/tools/gyp/v8.gyp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "deps/v8/tools/gyp/v8.gyp||deps/v8/tools/gyp/v8.gyp": [
          "File: deps/v8/tools/gyp/v8.gyp -> deps/v8/tools/gyp/v8.gyp",
          "--- Hunk 1 ---",
          "[Context before]",
          "641:                 ],",
          "642:               }",
          "643:             ],",
          "644:             ['OS==\"mac\"', {",
          "645:               'sources': [",
          "646:                 '../../src/platform-macos.cc',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "644:             ['OS==\"solaris\"', {",
          "645:                 'sources': [",
          "646:                   '../../src/platform-solaris.cc',",
          "647:                   '../../src/platform-posix.cc'",
          "648:                 ],",
          "649:               }",
          "650:             ],",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8a98c2f1d81cabb6594dc388789d60d2f3f67c09",
      "candidate_info": {
        "commit_hash": "8a98c2f1d81cabb6594dc388789d60d2f3f67c09",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/8a98c2f1d81cabb6594dc388789d60d2f3f67c09",
        "files": [
          "doc/api/http.markdown",
          "doc/api/querystring.markdown",
          "lib/http.js",
          "lib/querystring.js",
          "test/simple/test-querystring.js"
        ],
        "message": "http, querystring: added limits to prevent DoS",
        "before_after_code_files": [
          "lib/http.js||lihttp.js",
          "lib/querystring.js||liquerystring.js",
          "test/simple/test-querystring.js||test/simple/test-querystring.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "lib/http.js||lihttp.js": [
          "File: lib/http.js -> lihttp.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "43:   parser._headers = [];",
          "44:   parser._url = '';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "78:     parser.incoming.httpVersion = info.versionMajor + '.' + info.versionMinor;",
          "79:     parser.incoming.url = url;",
          "82:       var k = headers[i];",
          "83:       var v = headers[i + 1];",
          "84:       parser.incoming._addHeaderLine(k.toLowerCase(), v);",
          "",
          "[Removed Lines]",
          "81:     for (var i = 0, n = headers.length; i < n; i += 2) {",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1158:     parser.incoming = null;",
          "1159:     req.parser = parser;",
          "1161:     socket._httpMessage = req;",
          "1163:     httpSocketSetup(socket);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1444:   parser.socket = socket;",
          "1445:   parser.incoming = null;",
          "1447:   socket.addListener('error', function(e) {",
          "1448:     self.emit('clientError', e);",
          "1449:   });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "lib/querystring.js||liquerystring.js": [
          "File: lib/querystring.js -> liquerystring.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "160: };",
          "164:   sep = sep || '&';",
          "165:   eq = eq || '=';",
          "168:   if (typeof qs !== 'string' || qs.length === 0) {",
          "169:     return obj;",
          "170:   }",
          "173:     var x = kvp.split(eq);",
          "174:     var k = QueryString.unescape(x[0], true);",
          "175:     var v = QueryString.unescape(x.slice(1).join(eq), true);",
          "",
          "[Removed Lines]",
          "163: QueryString.parse = QueryString.decode = function(qs, sep, eq) {",
          "166:   var obj = {};",
          "172:   qs.split(sep).forEach(function(kvp) {",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/simple/test-querystring.js||test/simple/test-querystring.js": [
          "File: test/simple/test-querystring.js -> test/simple/test-querystring.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "183: assert.deepEqual({}, qs.parse());",
          "187: var b = qs.unescapeBuffer('%d3%f2Ug%1f6v%24%5e%98%cb' +",
          "188:                           '%0d%ac%a2%2f%9d%eb%d8%a2%e6');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "187: assert.equal(",
          "188:   Object.keys(qs.parse('a=1&b=1&c=1', null, null, { maxKeys: 1 })).length,",
          "189:   1",
          "190: );",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9f7f86b534f8556290eb8cad915984ff4ca54996",
      "candidate_info": {
        "commit_hash": "9f7f86b534f8556290eb8cad915984ff4ca54996",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/9f7f86b534f8556290eb8cad915984ff4ca54996",
        "files": [
          "ChangeLog",
          "doc/about/index.html",
          "doc/community/index.html",
          "doc/index.html",
          "doc/logos/index.html",
          "doc/template.html",
          "src/node_version.h"
        ],
        "message": "2012.03.15 Version 0.6.13 (stable)\n\n* Windows: Many libuv test fixes (Bert Belder)\n\n* Windows: avoid uv_guess_handle crash in when fd < 0 (Bert Belder)\n\n* Map EBUSY and ENOTEMPTY errors (Bert Belder)\n\n* Windows: include syscall in fs errors (Bert Belder)\n\n* Fix fs.watch ENOSYS on Linux kernel version mismatch (Ben Noordhuis)\n\n* Update npm to 1.1.9\n  - upgrade node-gyp to 0.3.5 (Nathan Rajlich)\n  - Fix isaacs/npm#2249 Add cache-max and cache-min configs\n  - Properly redirect across https/http registry requests\n  - log config usage if undefined key in set function (Kris Windham)\n  - Add support for os/cpu fields in package.json (Adam Blackburn)\n  - Automatically node-gyp packages containing a binding.gyp\n  - Fix failures unpacking in UNC shares\n  - Never create un-listable directories\n  - Handle cases where an optionalDependency fails to build",
        "before_after_code_files": [
          "src/node_version.h||src/node_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/node_version.h||src/node_version.h": [
          "File: src/node_version.h -> src/node_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: #define NODE_MAJOR_VERSION 0",
          "30: #define NODE_MINOR_VERSION 6",
          "31: #define NODE_PATCH_VERSION 13",
          "34: #ifndef NODE_STRINGIFY",
          "35: #define NODE_STRINGIFY(n) NODE_STRINGIFY_HELPER(n)",
          "",
          "[Removed Lines]",
          "32: #define NODE_VERSION_IS_RELEASE 0",
          "",
          "[Added Lines]",
          "32: #define NODE_VERSION_IS_RELEASE 1",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "399731e3a05140214713a7ba9a22a9f36faea87b",
      "candidate_info": {
        "commit_hash": "399731e3a05140214713a7ba9a22a9f36faea87b",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/399731e3a05140214713a7ba9a22a9f36faea87b",
        "files": [
          "tools/msvs/msi/product.wxs"
        ],
        "message": "windows msi: add npm dir to user PATH only\n\nThe NPM folder is personal to the user. It shouldn't be added to the\nsystem-wide path.",
        "before_after_code_files": [
          "tools/msvs/msi/product.wxs||tools/msvs/msi/product.wxs"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "tools/msvs/msi/product.wxs||tools/msvs/msi/product.wxs": [
          "File: tools/msvs/msi/product.wxs -> tools/msvs/msi/product.wxs",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:                          Action=\"set\"",
          "53:                          Name=\"PATH\"",
          "54:                          Part=\"last\"",
          "56:                          Value=\"[AppDataFolder]npm\\\" />",
          "57:             <Environment Id=\"node_env\"",
          "58:                          Action=\"set\"",
          "",
          "[Removed Lines]",
          "55:                          System=\"yes\"",
          "",
          "[Added Lines]",
          "55:                          System=\"no\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9037decb28e324b78a310d2557dc12c177cbaee1",
      "candidate_info": {
        "commit_hash": "9037decb28e324b78a310d2557dc12c177cbaee1",
        "repo": "joyent/node",
        "commit_url": "https://github.com/joyent/node/commit/9037decb28e324b78a310d2557dc12c177cbaee1",
        "files": [
          "test/simple/test-dgram-broadcast-multi-process.js"
        ],
        "message": "test: remove erroneous dropMembership() call\n\nThe socket is not part of any multicast group. Bug wasn't visible until 6999fb3.",
        "before_after_code_files": [
          "test/simple/test-dgram-broadcast-multi-process.js||test/simple/test-dgram-broadcast-multi-process.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/roamm/node/pull/1",
          "https://github.com/kingzone/node/pull/1",
          "https://github.com/OpenFPGAduino/node/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/simple/test-dgram-broadcast-multi-process.js||test/simple/test-dgram-broadcast-multi-process.js": [
          "File: test/simple/test-dgram-broadcast-multi-process.js -> test/simple/test-dgram-broadcast-multi-process.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "140:     process.send({ message : buf.toString() });",
          "142:     if (receivedMessages.length == messages.length) {",
          "146:         listenSocket.close();",
          "147:       });",
          "148:     }",
          "",
          "[Removed Lines]",
          "143:       listenSocket.dropMembership(LOCAL_BROADCAST_HOST);",
          "144:       process.nextTick(function() { // TODO should be changed to below.",
          "",
          "[Added Lines]",
          "143:       process.nextTick(function() {",
          "",
          "---------------"
        ]
      }
    }
  ]
}