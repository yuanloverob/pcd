{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "af51a74ade8bbab5ed49a3560dcb70d89896dc29",
      "candidate_info": {
        "commit_hash": "af51a74ade8bbab5ed49a3560dcb70d89896dc29",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/af51a74ade8bbab5ed49a3560dcb70d89896dc29",
        "files": [
          "doc/ssl/SSL_CTX_set_min_proto_version.pod",
          "include/openssl/ssl.h",
          "ssl/ssl_lib.c"
        ],
        "message": "Provide getters for min/max proto version\n\nOpenSSL 1.1.0 made SSL_CTX and SSL structs opaque and introduced a new\nAPI to set the minimum and maximum protocol version for SSL_CTX with\nTLS_method(). Add getters to introspect the configured versions:\n\n  int SSL_CTX_get_min_proto_version(SSL_CTX *ctx);\n  int SSL_CTX_get_max_proto_version(SSL_CTX *ctx);\n  int SSL_get_min_proto_version(SSL *ssl);\n  int SSL_get_max_proto_version(SSL *ssl);\n\nNOTE: The getters do not resolv the version in case when the minimum or\nmaxium version are configured as '0' (meaning auto-select lowest and\nhighst version number).\n\nSigned-off-by: Christian Heimes <christian@python.org>\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Ben Kaduk <kaduk@mit.edu>\n\n(cherry picked from commit 3edabd3ccb7aac89af5a63cfb2378e33a8be05d7)\n\nUpdated for new manual page location and TLS 1.3.\n\n(Merged from https://github.com/openssl/openssl/pull/4376)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_lib.c||ssl/ssl_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1158: # define SSL_CTRL_GET_TLSEXT_STATUS_REQ_TYPE     127",
          "1159: # define SSL_CTRL_GET_TLSEXT_STATUS_REQ_CB       128",
          "1160: # define SSL_CTRL_GET_TLSEXT_STATUS_REQ_CB_ARG   129",
          "1161: # define SSL_CERT_SET_FIRST                      1",
          "1162: # define SSL_CERT_SET_NEXT                       2",
          "1163: # define SSL_CERT_SET_SERVER                     3",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1161: # define SSL_CTRL_GET_MIN_PROTO_VERSION          130",
          "1162: # define SSL_CTRL_GET_MAX_PROTO_VERSION          131",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1289:         SSL_CTX_ctrl(ctx, SSL_CTRL_SET_MIN_PROTO_VERSION, version, NULL)",
          "1290: #define SSL_CTX_set_max_proto_version(ctx, version) \\",
          "1291:         SSL_CTX_ctrl(ctx, SSL_CTRL_SET_MAX_PROTO_VERSION, version, NULL)",
          "1292: #define SSL_set_min_proto_version(s, version) \\",
          "1293:         SSL_ctrl(s, SSL_CTRL_SET_MIN_PROTO_VERSION, version, NULL)",
          "1294: #define SSL_set_max_proto_version(s, version) \\",
          "1295:         SSL_ctrl(s, SSL_CTRL_SET_MAX_PROTO_VERSION, version, NULL)",
          "1297: #if OPENSSL_API_COMPAT < 0x10100000L",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1294: #define SSL_CTX_get_min_proto_version(ctx) \\",
          "1295:         SSL_CTX_ctrl(ctx, SSL_CTRL_GET_MIN_PROTO_VERSION, NULL, NULL)",
          "1296: #define SSL_CTX_get_max_proto_version(ctx) \\",
          "1297:         SSL_CTX_ctrl(ctx, SSL_CTRL_GET_MAX_PROTO_VERSION, NULL, NULL)",
          "1302: #define SSL_get_min_proto_version(s) \\",
          "1303:         SSL_ctrl(s, SSL_CTRL_GET_MIN_PROTO_VERSION, NULL, NULL)",
          "1304: #define SSL_get_max_proto_version(s) \\",
          "1305:         SSL_ctrl(s, SSL_CTRL_GET_MAX_PROTO_VERSION, NULL, NULL)",
          "",
          "---------------"
        ],
        "ssl/ssl_lib.c||ssl/ssl_lib.c": [
          "File: ssl/ssl_lib.c -> ssl/ssl_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1841:         return ssl_check_allowed_versions(larg, s->max_proto_version)",
          "1842:                && ssl_set_version_bound(s->ctx->method->version, (int)larg,",
          "1843:                                         &s->min_proto_version);",
          "1844:     case SSL_CTRL_SET_MAX_PROTO_VERSION:",
          "1845:         return ssl_check_allowed_versions(s->min_proto_version, larg)",
          "1846:                && ssl_set_version_bound(s->ctx->method->version, (int)larg,",
          "1847:                                         &s->max_proto_version);",
          "1848:     default:",
          "1849:         return (s->method->ssl_ctrl(s, cmd, larg, parg));",
          "1850:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1844:     case SSL_CTRL_GET_MIN_PROTO_VERSION:",
          "1845:         return s->min_proto_version;",
          "1850:     case SSL_CTRL_GET_MAX_PROTO_VERSION:",
          "1851:         return s->max_proto_version;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1973:         return ssl_check_allowed_versions(larg, ctx->max_proto_version)",
          "1974:                && ssl_set_version_bound(ctx->method->version, (int)larg,",
          "1975:                                         &ctx->min_proto_version);",
          "1976:     case SSL_CTRL_SET_MAX_PROTO_VERSION:",
          "1977:         return ssl_check_allowed_versions(ctx->min_proto_version, larg)",
          "1978:                && ssl_set_version_bound(ctx->method->version, (int)larg,",
          "1979:                                         &ctx->max_proto_version);",
          "1980:     default:",
          "1981:         return (ctx->method->ssl_ctx_ctrl(ctx, cmd, larg, parg));",
          "1982:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1980:     case SSL_CTRL_GET_MIN_PROTO_VERSION:",
          "1981:         return ctx->min_proto_version;",
          "1986:     case SSL_CTRL_GET_MAX_PROTO_VERSION:",
          "1987:         return ctx->max_proto_version;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6650db730960e5c5429e70db1b998c90228f44a1",
      "candidate_info": {
        "commit_hash": "6650db730960e5c5429e70db1b998c90228f44a1",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/6650db730960e5c5429e70db1b998c90228f44a1",
        "files": [
          "apps/openssl.c"
        ],
        "message": "When apps_startup() fails, exit with a failure code and a message\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3816)\n\n(cherry picked from commit f2da4a4917eae1bf66290e1bd8ccd3db69d3fe63)",
        "before_after_code_files": [
          "apps/openssl.c||apps/openssl.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/openssl.c||apps/openssl.c": [
          "File: apps/openssl.c -> apps/openssl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "154: #endif",
          "155:     }",
          "158:         goto end;",
          "160:     prog = prog_init();",
          "161:     pname = opt_progname(argv[0]);",
          "",
          "[Removed Lines]",
          "157:     if (!apps_startup())",
          "",
          "[Added Lines]",
          "157:     if (!apps_startup()) {",
          "158:         BIO_printf(bio_err,",
          "159:                    \"FATAL: Startup failure (dev note: apps_startup() failed)\\n\");",
          "160:         ERR_print_errors(bio_err);",
          "161:         ret = 1;",
          "163:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "beaf83f5a36f3dd361d3f8eb4ceee1a16f1782d8",
      "candidate_info": {
        "commit_hash": "beaf83f5a36f3dd361d3f8eb4ceee1a16f1782d8",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/beaf83f5a36f3dd361d3f8eb4ceee1a16f1782d8",
        "files": [
          "crypto/rc4/build.info"
        ],
        "message": "rc4/build.info: fix HP-UX rc4-ia64 rule.\n\nHP-UX make doesn't recognize $< in explict target rules, only in\ninference ones such as .c.o.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4694)",
        "before_after_code_files": [
          "crypto/rc4/build.info||crypto/rc4/build.info"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/rc4/build.info||crypto/rc4/build.info": [
          "File: crypto/rc4/build.info -> crypto/rc4/build.info",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: BEGINRAW[Makefile]",
          "21: {- $builddir -}/rc4-ia64.s: {- $sourcedir -}/asm/rc4-ia64.pl",
          "22:  @(trap \"rm $@.*\" INT 0; \\",
          "24:    case `awk '/^#define RC4_INT/{print$$NF}' $(BLDDIR)/include/openssl/opensslconf.h` in \\",
          "25:    int) set -x; $(CC) $(CFLAGS) $(LIB_CFLAGS) -DSZ=4 -E $@.S > $@.i && mv -f $@.i $@;; \\",
          "26:    char) set -x; $(CC) $(CFLAGS) $(LIB_CFLAGS) -DSZ=1 -E $@.S > $@.i && mv -f $@.i $@;; \\",
          "",
          "[Removed Lines]",
          "23:    $(PERL) $< $(CFLAGS) $(LIB_CFLAGS) $@.S; \\",
          "",
          "[Added Lines]",
          "23:    $(PERL) {- $sourcedir -}/asm/rc4-ia64.pl $(CFLAGS) $(LIB_CFLAGS) $@.S; \\",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "293991d558148c4c7dae0172e145f15c79e4119e",
      "candidate_info": {
        "commit_hash": "293991d558148c4c7dae0172e145f15c79e4119e",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/293991d558148c4c7dae0172e145f15c79e4119e",
        "files": [
          "crypto/x509/by_file.c"
        ],
        "message": "Remove needless type casting.\n\nCLA: trivial\n\nReviewed-by: Kurt Roeckx <kurt@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3627)\n\n(cherry picked from commit a020f54c25985fc83e809daa15a3920731d39612)",
        "before_after_code_files": [
          "crypto/x509/by_file.c||crypto/x509/by_file.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/x509/by_file.c||crypto/x509/by_file.c": [
          "File: crypto/x509/by_file.c -> crypto/x509/by_file.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "42:                         long argl, char **ret)",
          "43: {",
          "44:     int ok = 0;",
          "47:     switch (cmd) {",
          "48:     case X509_L_FILE_LOAD:",
          "49:         if (argl == X509_FILETYPE_DEFAULT) {",
          "51:             if (file)",
          "52:                 ok = (X509_load_cert_crl_file(ctx, file,",
          "53:                                               X509_FILETYPE_PEM) != 0);",
          "",
          "[Removed Lines]",
          "45:     char *file;",
          "50:             file = (char *)getenv(X509_get_default_cert_file_env());",
          "",
          "[Added Lines]",
          "45:     const char *file;",
          "50:             file = getenv(X509_get_default_cert_file_env());",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0c5f0fd49d784cad923f1dd9b3237f72d51b267d",
      "candidate_info": {
        "commit_hash": "0c5f0fd49d784cad923f1dd9b3237f72d51b267d",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/0c5f0fd49d784cad923f1dd9b3237f72d51b267d",
        "files": [
          "Configurations/descrip.mms.tmpl"
        ],
        "message": "VMS: When running a sub-MMS, make sure to give it the main MMS' qualifiers\n\nReviewed-by: Tim Hudson <tjh@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3880)\n\n(cherry picked from commit 984cf15eb5faac8e328d1ba4a623b1777eb82de1)",
        "before_after_code_files": [
          "Configurations/descrip.mms.tmpl||Configurations/descrip.mms.tmpl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/descrip.mms.tmpl||Configurations/descrip.mms.tmpl": [
          "File: Configurations/descrip.mms.tmpl -> Configurations/descrip.mms.tmpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "89:   sub dependmagic {",
          "90:       my $target = shift;",
          "93:   }",
          "94:   #use Data::Dumper;",
          "95:   #print STDERR \"DEBUG: before:\\n\", Dumper($unified_info{before});",
          "",
          "[Removed Lines]",
          "92:       return \"$target : build_generated\\n\\t\\pipe \\$(MMS) depend && \\$(MMS) _$target\\n_$target\";",
          "",
          "[Added Lines]",
          "92:       return \"$target : build_generated\\n\\t\\pipe \\$(MMS) \\$(MMSQUALIFIERS) depend && \\$(MMS) \\$(MMSQUALIFIERS) _$target\\n_$target\";",
          "",
          "---------------"
        ]
      }
    }
  ]
}