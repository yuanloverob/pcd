{
  "cve_id": "CVE-2017-6952",
  "cve_desc": "Integer overflow in the cs_winkernel_malloc function in winkernel_mm.c in Capstone 3.0.4 and earlier allows attackers to cause a denial of service (heap-based buffer overflow in a kernel driver) or possibly have unspecified other impact via a large value.",
  "repo": "aquynh/capstone",
  "patch_hash": "6fe86eef621b9849f51a5e1e5d73258a93440403",
  "patch_info": {
    "commit_hash": "6fe86eef621b9849f51a5e1e5d73258a93440403",
    "repo": "aquynh/capstone",
    "commit_url": "https://github.com/aquynh/capstone/commit/6fe86eef621b9849f51a5e1e5d73258a93440403",
    "files": [
      "windows/winkernel_mm.c"
    ],
    "message": "provide a validity check to prevent against Integer overflow conditions (#870)\n\n* provide a validity check to prevent against Integer overflow conditions\n\n* fix some style issues.",
    "before_after_code_files": [
      "windows/winkernel_mm.c||windows/winkernel_mm.c"
    ]
  },
  "patch_diff": {
    "windows/winkernel_mm.c||windows/winkernel_mm.c": [
      "File: windows/winkernel_mm.c -> windows/winkernel_mm.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "4: #include \"winkernel_mm.h\"",
      "5: #include <ntddk.h>",
      "8: static const ULONG CS_WINKERNEL_POOL_TAG = 'kwsC';",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6: #include <Ntintsafe.h>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "35: #pragma prefast(suppress : 30030)  // Allocating executable POOL_TYPE memory",
      "38:  if (!block) {",
      "39:   return NULL;",
      "40:  }",
      "",
      "[Removed Lines]",
      "36:  CS_WINKERNEL_MEMBLOCK *block = (CS_WINKERNEL_MEMBLOCK *)ExAllocatePoolWithTag(",
      "37:    NonPagedPool, size + sizeof(CS_WINKERNEL_MEMBLOCK), CS_WINKERNEL_POOL_TAG);",
      "",
      "[Added Lines]",
      "37:  size_t number_of_bytes = 0;",
      "38:  CS_WINKERNEL_MEMBLOCK *block = NULL;",
      "42:  if (!NT_SUCCESS(RtlSizeTAdd(size, sizeof(CS_WINKERNEL_MEMBLOCK), &number_of_bytes))) {",
      "43:   return NULL;",
      "44:  }",
      "45:  block = (CS_WINKERNEL_MEMBLOCK *)ExAllocatePoolWithTag(",
      "46:    NonPagedPool, number_of_bytes, CS_WINKERNEL_POOL_TAG);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "882052a8ae764552b219c743120950d5bc373da2",
      "candidate_info": {
        "commit_hash": "882052a8ae764552b219c743120950d5bc373da2",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/882052a8ae764552b219c743120950d5bc373da2",
        "files": [
          "tests/test_winkernel.cpp",
          "windows/winkernel_mm.c",
          "windows/winkernel_mm.h"
        ],
        "message": "change copyright",
        "before_after_code_files": [
          "tests/test_winkernel.cpp||tests/test_winkernel.cpp",
          "windows/winkernel_mm.c||windows/winkernel_mm.c",
          "windows/winkernel_mm.h||windows/winkernel_mm.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [
            "windows/winkernel_mm.c||windows/winkernel_mm.c"
          ],
          "candidate": [
            "windows/winkernel_mm.c||windows/winkernel_mm.c"
          ]
        }
      },
      "candidate_diff": {
        "tests/test_winkernel.cpp||tests/test_winkernel.cpp": [
          "File: tests/test_winkernel.cpp -> tests/test_winkernel.cpp"
        ],
        "windows/winkernel_mm.c||windows/winkernel_mm.c": [
          "File: windows/winkernel_mm.c -> windows/winkernel_mm.c"
        ],
        "windows/winkernel_mm.h||windows/winkernel_mm.h": [
          "File: windows/winkernel_mm.h -> windows/winkernel_mm.h"
        ]
      }
    },
    {
      "candidate_hash": "4d36deb1b6e19824644cbb50e62fc311b5569400",
      "candidate_info": {
        "commit_hash": "4d36deb1b6e19824644cbb50e62fc311b5569400",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/4d36deb1b6e19824644cbb50e62fc311b5569400",
        "files": [
          "cs.c"
        ],
        "message": "fix #673",
        "before_after_code_files": [
          "cs.c||cs.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "cs.c||cs.c": [
          "File: cs.c -> cs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "237:   ud->errnum = CS_ERR_OK;",
          "238:   ud->arch = arch;",
          "239:   ud->mode = mode;",
          "242:   ud->detail = CS_OPT_OFF;",
          "",
          "[Removed Lines]",
          "240:   ud->big_endian = mode & CS_MODE_BIG_ENDIAN;",
          "",
          "[Added Lines]",
          "240:   ud->big_endian = (mode & CS_MODE_BIG_ENDIAN) != 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ced66e3b773d67172af468bea782f0f85603a42d",
      "candidate_info": {
        "commit_hash": "ced66e3b773d67172af468bea782f0f85603a42d",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/ced66e3b773d67172af468bea782f0f85603a42d",
        "files": [
          "bindings/python/.gitignore",
          "bindings/python/MANIFEST.in",
          "bindings/python/Makefile",
          "bindings/python/capstone/__init__.py",
          "bindings/python/setup.py"
        ],
        "message": "Python: make setup work as expected",
        "before_after_code_files": [
          "bindings/python/MANIFEST.in||bindings/python/MANIFEST.in",
          "bindings/python/capstone/__init__.py||bindings/python/capstone/__init__.py",
          "bindings/python/setup.py||bindings/python/setup.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "bindings/python/MANIFEST.in||bindings/python/MANIFEST.in": [
          "File: bindings/python/MANIFEST.in -> bindings/python/MANIFEST.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: include LICENSE.TXT",
          "4: include README",
          "",
          "[Removed Lines]",
          "1: recursive-include capstone *",
          "2: recursive-include prebuilt *",
          "",
          "[Added Lines]",
          "1: recursive-include src *",
          "",
          "---------------"
        ],
        "bindings/python/capstone/__init__.py||bindings/python/capstone/__init__.py": [
          "File: bindings/python/capstone/__init__.py -> bindings/python/capstone/__init__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "195: CS_SUPPORT_X86_REDUCE = CS_ARCH_ALL+2",
          "199: from os.path import split, join, dirname",
          "200: import distutils.sysconfig",
          "203: import inspect",
          "204: if not hasattr(sys.modules[__name__], '__file__'):",
          "205:     __file__ = inspect.getfile(inspect.currentframe())",
          "208: _all_libs = ['capstone.dll', 'libcapstone.so.3', 'libcapstone.so', 'libcapstone.dylib']",
          "209: _found = False",
          "212:     try:",
          "218:     except OSError:",
          "258:     raise ImportError(\"ERROR: fail to load the dynamic library.\")",
          "",
          "[Removed Lines]",
          "198: import ctypes, ctypes.util, sys",
          "207: _lib_path = split(__file__)[0]",
          "211: for _lib in _all_libs:",
          "213:         _lib_file = join(_lib_path, _lib)",
          "214:         # print \"Trying to load:\", _lib_file",
          "215:         _cs = ctypes.cdll.LoadLibrary(_lib_file)",
          "216:         _found = True",
          "217:         break",
          "219:         pass",
          "220: if _found == False:",
          "221:     # try loading from default paths",
          "222:     for _lib in _all_libs:",
          "223:         try:",
          "224:             _cs = ctypes.cdll.LoadLibrary(_lib)",
          "225:             _found = True",
          "226:             break",
          "227:         except OSError:",
          "228:             pass",
          "230: if _found == False:",
          "231:     # last try: loading from python lib directory",
          "232:     _lib_path = distutils.sysconfig.get_python_lib()",
          "233:     for _lib in _all_libs:",
          "234:         try:",
          "235:             _lib_file = join(_lib_path, 'capstone', _lib)",
          "236:             # print \"Trying to load:\", _lib_file",
          "237:             _cs = ctypes.cdll.LoadLibrary(_lib_file)",
          "238:             _found = True",
          "239:             break",
          "240:         except OSError:",
          "241:             pass",
          "243: # Attempt Darwin specific load (10.11 specific),",
          "244: # since LD_LIBRARY_PATH is not guaranteed to exist",
          "245: if (_found == False) and (system() == 'Darwin'):",
          "246:     _lib_path = '/usr/local/lib/'",
          "247:     for _lib in _all_libs:",
          "248:         try:",
          "249:             _lib_file = join(_lib_path, _lib)",
          "250:             # print \"Trying to load:\", _lib_file",
          "251:             _cs = ctypes.cdll.LoadLibrary(_lib_file)",
          "252:             _found = True",
          "253:             break",
          "254:         except OSError:",
          "255:             pass",
          "257: if _found == False:",
          "",
          "[Added Lines]",
          "198: import ctypes, ctypes.util",
          "201: import pkg_resources",
          "207: if sys.platform == 'darwin':",
          "208:     _lib = \"libcapstone.dylib\"",
          "209: elif sys.platform in ('win32', 'cygwin'):",
          "210:     _lib = \"capstone.dll\"",
          "211: else:",
          "212:     _lib = \"libcapstone.so\"",
          "217: def _load_lib(path):",
          "218:     lib_file = join(path, _lib)",
          "220:         return ctypes.cdll.LoadLibrary(lib_file)",
          "222:         # if we're on linux, try again with .so.3 extension",
          "223:         if lib_file.endswith('.so'):",
          "224:             try:",
          "225:                 return ctypes.cdll.LoadLibrary(lib_file)",
          "226:             except OSError:",
          "227:                 return None",
          "228:         return None",
          "230: _cs = None",
          "232: # Loading attempts, in order",
          "233: # - pkg_resources can get us the path to the local libraries",
          "234: # - we can get the path to the local libraries by parsing our filename",
          "235: # - global load",
          "236: # - python's lib directory",
          "237: # - last-gasp attempt at some hardcoded paths on darwin and linux",
          "239: _path_list = [pkg_resources.resource_filename(__name__, 'lib'),",
          "240:               join(split(__file__)[0], 'lib'),",
          "241:               '',",
          "242:               distutils.sysconfig.get_python_lib(),",
          "243:               \"/usr/local/lib/\" if sys.platform == 'darwin' else '/usr/lib64']",
          "245: for _path in _path_list:",
          "246:     _cs = _load_lib(_path)",
          "247:     if _cs is not None: break",
          "248: else:",
          "",
          "---------------"
        ],
        "bindings/python/setup.py||bindings/python/setup.py": [
          "File: bindings/python/setup.py -> bindings/python/setup.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: #!/usr/bin/env python",
          "2: import glob",
          "3: import os",
          "4: import shutil",
          "5: import stat",
          "6: import sys",
          "8: from distutils import log",
          "12: from setuptools import setup",
          "25: SYSTEM = sys.platform",
          "46: # adapted from commit e504b81 of Nguyen Tan Cong",
          "47: # Reference: https://docs.python.org/2/library/platform.html#cross-platform",
          "50: def copy_sources():",
          "51:     \"\"\"Copy the C sources into the source directory.",
          "",
          "[Removed Lines]",
          "9: from distutils import dir_util",
          "10: from distutils.command.build_clib import build_clib",
          "11: from setuptools.command.sdist import sdist",
          "13: from distutils.sysconfig import get_python_lib",
          "15: # prebuilt libraries for Windows - for sdist",
          "16: PATH_LIB64 = \"prebuilt/win64/capstone.dll\"",
          "17: PATH_LIB32 = \"prebuilt/win32/capstone.dll\"",
          "19: # package name can be 'capstone' or 'capstone-windows'",
          "20: PKG_NAME = 'capstone'",
          "21: if os.path.exists(PATH_LIB64) and os.path.exists(PATH_LIB32):",
          "22:     PKG_NAME = 'capstone-windows'",
          "24: VERSION = '3.0.4'",
          "27: # virtualenv breaks import, but get_python_lib() will work.",
          "28: SITE_PACKAGES = os.path.join(get_python_lib(), \"capstone\")",
          "29: if \"--user\" in sys.argv:",
          "30:     try:",
          "31:         from site import getusersitepackages",
          "32:         SITE_PACKAGES = os.path.join(getusersitepackages(), \"capstone\")",
          "33:     except ImportError:",
          "34:         pass",
          "36: # If building a wheel, the path listed in data_files is interpreted relative to",
          "37: # python's site-packages directory, even if it starts with a slash. So we need",
          "38: # to use only `/capstone` as path in this case.",
          "39: #",
          "40: # Note: using `capstone` does not work, since that for some reason is interpreted",
          "41: # relative to the the python installation prefix, not to the site-packages directory.",
          "42: if \"bdist_wheel\" in sys.argv:",
          "43:     SITE_PACKAGES = \"/capstone\"",
          "48: is_64bits = sys.maxsize > 2**32",
          "",
          "[Added Lines]",
          "8: import platform",
          "12: from distutils.util import get_platform",
          "13: from distutils.command.build import build",
          "14: from distutils.command.sdist import sdist",
          "15: from setuptools.command.bdist_egg import bdist_egg",
          "18: VERSION = '3.0.4'",
          "22: IS_64BITS = sys.maxsize > 2**32",
          "24: # are we building from the repository or from a source distribution?",
          "25: ROOT_DIR = os.path.dirname(os.path.realpath(__file__))",
          "26: LIBS_DIR = os.path.join(ROOT_DIR, 'capstone', 'lib')",
          "27: HEADERS_DIR = os.path.join(ROOT_DIR, 'capstone', 'include')",
          "28: SRC_DIR = os.path.join(ROOT_DIR, 'src')",
          "29: BUILD_DIR = SRC_DIR if os.path.exists(SRC_DIR) else os.path.join(ROOT_DIR, '../..')",
          "31: if SYSTEM == 'darwin':",
          "32:     LIBRARY_FILE = \"libcapstone.dylib\"",
          "33:     STATIC_LIBRARY_FILE = 'libcapstone.a'",
          "34: elif SYSTEM in ('win32', 'cygwin'):",
          "35:     LIBRARY_FILE = \"capstone.dll\"",
          "36:     STATIC_LIBRARY_FILE = None",
          "37: else:",
          "38:     LIBRARY_FILE = \"libcapstone.so\"",
          "39:     STATIC_LIBRARY_FILE = 'libcapstone.a'",
          "41: def clean_bins():",
          "42:     shutil.rmtree(LIBS_DIR, ignore_errors=True)",
          "43:     shutil.rmtree(HEADERS_DIR, ignore_errors=True)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:     src = []",
          "57:     try:",
          "59:     except (IOError, OSError):",
          "60:         pass",
          "77:     for filename in src:",
          "79:         log.info(\"%s -> %s\" % (filename, outpath))",
          "80:         shutil.copy(filename, outpath)",
          "86:     def run(self):",
          "98:         copy_sources()",
          "99:         return sdist.run(self)",
          "105:     def run(self):",
          "173: def dummy_src():",
          "174:     return []",
          "176: setup(",
          "177:     provides=['capstone'],",
          "178:     packages=['capstone'],",
          "180:     version=VERSION,",
          "181:     author='Nguyen Anh Quynh',",
          "182:     author_email='aquynh@gmail.com',",
          "",
          "[Removed Lines]",
          "58:         dir_util.remove_tree(\"src/\")",
          "62:     dir_util.copy_tree(\"../../arch\", \"src/arch/\")",
          "63:     dir_util.copy_tree(\"../../include\", \"src/include/\")",
          "64: #    dir_util.copy_tree(\"../../msvc/headers\", \"src/msvc/headers\")",
          "66:     src.extend(glob.glob(\"../../*.[ch]\"))",
          "67:     src.extend(glob.glob(\"../../*.mk\"))",
          "69:     src.extend(glob.glob(\"../../Makefile\"))",
          "70:     src.extend(glob.glob(\"../../LICENSE*\"))",
          "71:     src.extend(glob.glob(\"../../README\"))",
          "72:     src.extend(glob.glob(\"../../*.TXT\"))",
          "73:     src.extend(glob.glob(\"../../RELEASE_NOTES\"))",
          "74:     src.extend(glob.glob(\"../../make.sh\"))",
          "75:     src.extend(glob.glob(\"../../CMakeLists.txt\"))",
          "78:         outpath = os.path.join(\"./src/\", os.path.basename(filename))",
          "83: class custom_sdist(sdist):",
          "84:     \"\"\"Reshuffle files for distribution.\"\"\"",
          "87:         for filename in (glob.glob(\"capstone/*.dll\")",
          "88:                          + glob.glob(\"capstone/*.so\")",
          "89:                          + glob.glob(\"capstone/*.dylib\")):",
          "90:             try:",
          "91:                 os.unlink(filename)",
          "92:             except Exception:",
          "93:                 pass",
          "95:         # if prebuilt libraries are existent, then do not copy source",
          "96:         if os.path.exists(PATH_LIB64) and os.path.exists(PATH_LIB32):",
          "97:             return sdist.run(self)",
          "102: class custom_build_clib(build_clib):",
          "103:     \"\"\"Customized build_clib command.\"\"\"",
          "106:         log.info('running custom_build_clib')",
          "107:         build_clib.run(self)",
          "109:     def finalize_options(self):",
          "110:         # We want build-clib to default to build-lib as defined by the \"build\"",
          "111:         # command.  This is so the compiled library will be put in the right",
          "112:         # place along side the python code.",
          "113:         self.set_undefined_options('build',",
          "114:                                    ('build_lib', 'build_clib'),",
          "115:                                    ('build_temp', 'build_temp'),",
          "116:                                    ('compiler', 'compiler'),",
          "117:                                    ('debug', 'debug'),",
          "118:                                    ('force', 'force'))",
          "120:         build_clib.finalize_options(self)",
          "122:     def build_libraries(self, libraries):",
          "123:         if SYSTEM in (\"win32\", \"cygwin\"):",
          "124:             # if Windows prebuilt library is available, then include it",
          "125:             if is_64bits and os.path.exists(PATH_LIB64):",
          "126:                 shutil.copy(PATH_LIB64, \"capstone\")",
          "127:                 return",
          "128:             elif os.path.exists(PATH_LIB32):",
          "129:                 shutil.copy(PATH_LIB32, \"capstone\")",
          "130:                 return",
          "132:         # build library from source if src/ is existent",
          "133:         if not os.path.exists('src'):",
          "134:             return",
          "136:         for (lib_name, build_info) in libraries:",
          "137:             log.info(\"building '%s' library\", lib_name)",
          "139:             os.chdir(\"src\")",
          "141:             # platform description refers at https://docs.python.org/2/library/sys.html#sys.platform",
          "142:             if SYSTEM == \"win32\":",
          "143:                 # Windows build: this process requires few things:",
          "144:                 #    - CMake + MSVC installed",
          "145:                 #    - Run this command in an environment setup for MSVC",
          "146:                 os.mkdir(\"build\")",
          "147:                 os.chdir(\"build\")",
          "148:                 # Do not build tests & static library",
          "149:                 os.system('cmake -DCMAKE_BUILD_TYPE=RELEASE -DCAPSTONE_BUILD_TESTS=0 -DCAPSTONE_BUILD_STATIC=0 -G \"NMake Makefiles\" ..')",
          "150:                 os.system(\"nmake\")",
          "151:                 os.chdir(\"..\")",
          "152:                 so = \"src/build/capstone.dll\"",
          "153:             elif SYSTEM == \"cygwin\":",
          "154:                 os.chmod(\"make.sh\", stat.S_IREAD|stat.S_IEXEC)",
          "155:                 if is_64bits:",
          "156:                     os.system(\"CAPSTONE_BUILD_CORE_ONLY=yes ./make.sh cygwin-mingw64\")",
          "157:                 else:",
          "158:                     os.system(\"CAPSTONE_BUILD_CORE_ONLY=yes ./make.sh cygwin-mingw32\")",
          "160:                 so = \"src/capstone.dll\"",
          "161:             else:   # Unix",
          "162:                 os.chmod(\"make.sh\", stat.S_IREAD|stat.S_IEXEC)",
          "163:                 os.system(\"CAPSTONE_BUILD_CORE_ONLY=yes ./make.sh\")",
          "164:                 if SYSTEM == \"darwin\":",
          "165:                     so = \"src/libcapstone.dylib\"",
          "166:                 else:   # Non-OSX",
          "167:                     so = \"src/libcapstone.so\"",
          "169:             os.chdir(\"..\")",
          "170:             shutil.copy(so, \"capstone\")",
          "179:     name=PKG_NAME,",
          "",
          "[Added Lines]",
          "53:         shutil.rmtree(\"src/\")",
          "57:     shutil.copytree(os.path.join(BUILD_DIR, \"arch\"), os.path.join(SRC_DIR, \"arch\"))",
          "58:  shutil.copytree(os.path.join(BUILD_DIR, \"include\"), os.path.join(SRC_DIR, \"include\"))",
          "60:     src.extend(glob.glob(os.path.join(BUILD_DIR, \"*.[ch]\")))",
          "61:     src.extend(glob.glob(os.path.join(BUILD_DIR, \"*.mk\"))",
          "63:     src.extend(glob.glob(os.path.join(BUILD_DIR, \"Makefile\"))",
          "64:     src.extend(glob.glob(os.path.join(BUILD_DIR, \"LICENSE*\"))",
          "65:     src.extend(glob.glob(os.path.join(BUILD_DIR, \"README\"))",
          "66:     src.extend(glob.glob(os.path.join(BUILD_DIR, \"*.TXT\"))",
          "67:     src.extend(glob.glob(os.path.join(BUILD_DIR, \"RELEASE_NOTES\"))",
          "68:     src.extend(glob.glob(os.path.join(BUILD_DIR, \"make.sh\"))",
          "69:     src.extend(glob.glob(os.path.join(BUILD_DIR, \"CMakeLists.txt\"))",
          "72:         outpath = os.path.join(SRC_DIR, os.path.basename(filename))",
          "76: def build_libraries():",
          "77:     \"\"\"",
          "78:     Prepare the capstone directory for a binary distribution or installation.",
          "79:     Builds shared libraries and copies header files.",
          "81:     Will use a src/ dir if one exists in the current directory, otherwise assumes it's in the repo",
          "82:     \"\"\"",
          "83:     cwd = os.getcwd()",
          "84:     clean_bins()",
          "85:     os.mkdir(HEADERS_DIR)",
          "86:     os.mkdir(LIBS_DIR)",
          "88:     # copy public headers",
          "89:     shutil.copytree(os.path.join(BUILD_DIR, 'include'), os.path.join(HEADERS_DIR, 'capstone'))",
          "91:     os.chdir(BUILD_DIR)",
          "93:     # platform description refers at https://docs.python.org/2/library/sys.html#sys.platform",
          "94:     if SYSTEM == \"win32\":",
          "95:         # Windows build: this process requires few things:",
          "96:         #    - CMake + MSVC installed",
          "97:         #    - Run this command in an environment setup for MSVC",
          "98:         if not os.path.exists(\"build\"): os.mkdir(\"build\")",
          "99:         os.chdir(\"build\")",
          "100:         # Do not build tests & static library",
          "101:         os.system('cmake -DCMAKE_BUILD_TYPE=RELEASE -DCAPSTONE_BUILD_TESTS=0 -DCAPSTONE_BUILD_STATIC=0 -G \"NMake Makefiles\" ..')",
          "102:         os.system(\"nmake\")",
          "103:     elif SYSTEM == \"cygwin\":",
          "104:         os.chmod(\"make.sh\", stat.S_IREAD|stat.S_IEXEC)",
          "105:         if is_64bits:",
          "106:             os.system(\"CAPSTONE_BUILD_CORE_ONLY=yes ./make.sh cygwin-mingw64\")",
          "107:         else:",
          "108:             os.system(\"CAPSTONE_BUILD_CORE_ONLY=yes ./make.sh cygwin-mingw32\")",
          "110:         so = \"capstone.dll\"",
          "111:     else:   # Unix",
          "112:         os.system(\"CAPSTONE_BUILD_CORE_ONLY=yes ./make.sh\")",
          "114:     shutil.copy(LIBRARY_FILE, LIBS_DIR)",
          "115:     if STATIC_LIBRARY_FILE: shutil.copy(STATIC_LIBRARY_FILE, LIBS_DIR)",
          "116:     os.chdir(cwd)",
          "119: class custom_sdist(sdist):",
          "121:         clean_bins()",
          "126: class custom_build(build):",
          "128:         log.info('Building C extensions')",
          "129:         build_libraries()",
          "130:         return build.run(self)",
          "133: class custom_bdist_egg(bdist_egg):",
          "134:     def run(self):",
          "135:         self.run_command('build')",
          "136:         return bdist_egg.run(self)",
          "141: cmdclass = {}",
          "142: cmdclass['build'] = custom_build",
          "143: cmdclass['sdist'] = custom_sdist",
          "144: cmdclass['bdist_egg'] = custom_bdist_egg",
          "146: try:",
          "147:     from setuptools.command.develop import develop",
          "148:     class custom_develop(develop):",
          "149:         def run(self):",
          "150:             log.info(\"Building C extensions\")",
          "151:             build_libraries()",
          "152:             return develop.run(self)",
          "154:     cmdclass['develop'] = custom_develop",
          "155: except ImportError:",
          "156:     print \"Proper 'develop' support unavailable.\"",
          "158: if 'bdist_wheel' in sys.argv and '--plat-name' not in sys.argv:",
          "159:     sys.argv.append('--plat-name')",
          "160:     name = get_platform()",
          "161:     if 'linux' in name:",
          "162:         # linux_* platform tags are disallowed because the python ecosystem is fubar",
          "163:         # linux builds should be built in the centos 5 vm for maximum compatibility",
          "164:         # see https://github.com/pypa/manylinux",
          "165:         # see also https://github.com/angr/angr-dev/blob/master/bdist.sh",
          "166:         sys.argv.append('manylinux1_' + platform.machine())",
          "167:     else:",
          "168:         # https://www.python.org/dev/peps/pep-0425/",
          "169:         sys.argv.append(name.replace('.', '_').replace('-', '_'))",
          "174:     name='capstone',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "188:         'Programming Language :: Python :: 3',",
          "189:     ],",
          "190:     requires=['ctypes'],",
          "203:     include_package_data=True,",
          "204:     package_data={",
          "206:     }",
          "207: )",
          "",
          "[Removed Lines]",
          "191:     cmdclass=dict(",
          "192:         build_clib=custom_build_clib,",
          "193:         sdist=custom_sdist,",
          "194:     ),",
          "196:     libraries=[(",
          "197:         'capstone', dict(",
          "198:             package='capstone',",
          "199:             sources=dummy_src()",
          "200:         ),",
          "201:     )],",
          "202:     zip_safe=False,",
          "205:         \"capstone\": [\"*.so\", \"*.dll\", \"*.dylib\"],",
          "",
          "[Added Lines]",
          "186:     cmdclass=cmdclass,",
          "187:     zip_safe=True,",
          "190:         \"capstone\": [\"lib/*\", \"include/capstone/*\"],",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fc0d6fb2ae6293197bcc8491dc3105bf5c54c112",
      "candidate_info": {
        "commit_hash": "fc0d6fb2ae6293197bcc8491dc3105bf5c54c112",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/fc0d6fb2ae6293197bcc8491dc3105bf5c54c112",
        "files": [
          "cstool/cstool.c",
          "cstool/cstool_arm.c",
          "cstool/cstool_arm64.c",
          "cstool/cstool_m68k.c",
          "cstool/cstool_mips.c",
          "cstool/cstool_ppc.c",
          "cstool/cstool_sparc.c",
          "cstool/cstool_systemz.c",
          "cstool/cstool_x86.c"
        ],
        "message": "cstool: print out insn groups",
        "before_after_code_files": [
          "cstool/cstool.c||cstool/cstool.c",
          "cstool/cstool_arm.c||cstool/cstool_arm.c",
          "cstool/cstool_arm64.c||cstool/cstool_arm64.c",
          "cstool/cstool_m68k.c||cstool/cstool_m68k.c",
          "cstool/cstool_mips.c||cstool/cstool_mips.c",
          "cstool/cstool_ppc.c||cstool/cstool_ppc.c",
          "cstool/cstool_sparc.c||cstool/cstool_sparc.c",
          "cstool/cstool_systemz.c||cstool/cstool_systemz.c",
          "cstool/cstool_x86.c||cstool/cstool_x86.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "cstool/cstool.c||cstool/cstool.c": [
          "File: cstool/cstool.c -> cstool/cstool.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "388:         print_insn_detail_m68k(handle, &insn[i]);",
          "389:         break;",
          "390:     }",
          "391:    }",
          "392:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "392:     if (insn[i].detail->groups_count) {",
          "393:      int j;",
          "395:      printf(\"\\tGroups: \");",
          "396:      for(j = 0; j < insn[i].detail->groups_count; j++) {",
          "397:       printf(\"%s \", cs_group_name(handle, insn[i].detail->groups[j]));",
          "398:      }",
          "399:      printf(\"\\n\");",
          "400:     }",
          "402:     printf(\"\\n\");",
          "",
          "---------------"
        ],
        "cstool/cstool_arm.c||cstool/cstool_arm.c": [
          "File: cstool/cstool_arm.c -> cstool/cstool_arm.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "153:    printf(\"\\n\");",
          "154:   }",
          "155:  }",
          "158: }",
          "",
          "[Removed Lines]",
          "157:  printf(\"\\n\");",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "cstool/cstool_arm64.c||cstool/cstool_arm64.c": [
          "File: cstool/cstool_arm64.c -> cstool/cstool_arm64.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "137:    printf(\"\\n\");",
          "138:   }",
          "139:  }",
          "142: }",
          "",
          "[Removed Lines]",
          "141:  printf(\"\\n\");",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "cstool/cstool_m68k.c||cstool/cstool_m68k.c": [
          "File: cstool/cstool_m68k.c -> cstool/cstool_m68k.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "117:     break;",
          "118:   }",
          "119:  }",
          "122: }",
          "",
          "[Removed Lines]",
          "121:  printf(\"\\n\");",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "cstool/cstool_mips.c||cstool/cstool_mips.c": [
          "File: cstool/cstool_mips.c -> cstool/cstool_mips.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "44:   }",
          "46:  }",
          "49: }",
          "",
          "[Removed Lines]",
          "48:  printf(\"\\n\");",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "cstool/cstool_ppc.c||cstool/cstool_ppc.c": [
          "File: cstool/cstool_ppc.c -> cstool/cstool_ppc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "88:  if (ppc->update_cr0)",
          "89:   printf(\"\\tUpdate-CR0: True\\n\");",
          "92: }",
          "",
          "[Removed Lines]",
          "91:  printf(\"\\n\");",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "cstool/cstool_sparc.c||cstool/cstool_sparc.c": [
          "File: cstool/cstool_sparc.c -> cstool/cstool_sparc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:  if (sparc->hint != 0)",
          "53:   printf(\"\\tHint code: %u\\n\", sparc->hint);",
          "56: }",
          "",
          "[Removed Lines]",
          "55:  printf(\"\\n\");",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "cstool/cstool_systemz.c||cstool/cstool_systemz.c": [
          "File: cstool/cstool_systemz.c -> cstool/cstool_systemz.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "54:  if (sysz->cc != 0)",
          "55:   printf(\"\\tCode condition: %u\\n\", sysz->cc);",
          "58: }",
          "",
          "[Removed Lines]",
          "57:  printf(\"\\n\");",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "cstool/cstool_x86.c||cstool/cstool_x86.c": [
          "File: cstool/cstool_x86.c -> cstool/cstool_x86.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "258:    }",
          "259:   printf(\"\\n\");",
          "260:  }",
          "263: }",
          "",
          "[Removed Lines]",
          "262:  printf(\"\\n\");",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "96309544ba1be87137947496e4174d8de7b98e21",
      "candidate_info": {
        "commit_hash": "96309544ba1be87137947496e4174d8de7b98e21",
        "repo": "aquynh/capstone",
        "commit_url": "https://github.com/aquynh/capstone/commit/96309544ba1be87137947496e4174d8de7b98e21",
        "files": [
          "arch/ARM/ARMInstPrinter.c"
        ],
        "message": "arm: add IMM operand for printPostIdxImm8s4Operand(). issue #861",
        "before_after_code_files": [
          "arch/ARM/ARMInstPrinter.c||arch/ARM/ARMInstPrinter.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/NeatNerdPrime/capstone/pull/17"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "arch/ARM/ARMInstPrinter.c||arch/ARM/ARMInstPrinter.c": [
          "File: arch/ARM/ARMInstPrinter.c -> arch/ARM/ARMInstPrinter.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1151: {",
          "1152:  MCOperand *MO = MCInst_getOperand(MI, OpNum);",
          "1153:  unsigned Imm = (unsigned int)MCOperand_getImm(MO);",
          "1155:   SStream_concat(O, \"#%s0x%x\", ((Imm & 256) ? \"\" : \"-\"), ((Imm & 0xff) << 2));",
          "1157:   SStream_concat(O, \"#%s%u\", ((Imm & 256) ? \"\" : \"-\"), ((Imm & 0xff) << 2));",
          "1158: }",
          "1160: static void printAddrMode5Operand(MCInst *MI, unsigned OpNum, SStream *O,",
          "",
          "[Removed Lines]",
          "1154:  if (((Imm & 0xff) << 2) > HEX_THRESHOLD)",
          "1156:  else",
          "",
          "[Added Lines]",
          "1155:  if (((Imm & 0xff) << 2) > HEX_THRESHOLD) {",
          "1157:  } else {",
          "1159:  }",
          "1161:  if (MI->csh->detail) {",
          "1162:   int v = (Imm & 256) ? ((Imm & 0xff) << 2) : -((Imm & 0xff) << 2);",
          "1163:   MI->flat_insn->detail->arm.operands[MI->flat_insn->detail->arm.op_count].type = ARM_OP_IMM;",
          "1164:   MI->flat_insn->detail->arm.operands[MI->flat_insn->detail->arm.op_count].imm = v;",
          "1165:   MI->flat_insn->detail->arm.op_count++;",
          "1166:  }",
          "",
          "---------------"
        ]
      }
    }
  ]
}