{
  "cve_id": "CVE-2019-19645",
  "cve_desc": "alter.c in SQLite through 3.30.1 allows attackers to trigger infinite recursion via certain types of self-referential views in conjunction with ALTER TABLE statements.",
  "repo": "sqlite/sqlite",
  "patch_hash": "38096961c7cd109110ac21d3ed7dad7e0cb0ae06",
  "patch_info": {
    "commit_hash": "38096961c7cd109110ac21d3ed7dad7e0cb0ae06",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/38096961c7cd109110ac21d3ed7dad7e0cb0ae06",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/alter.c",
      "src/build.c",
      "src/sqliteInt.h",
      "test/altertab3.test"
    ],
    "message": "Avoid infinite recursion in the ALTER TABLE code when a view contains an unused CTE that references, directly or indirectly, the view itself.\n\nFossilOrigin-Name: 1d2e53a39b87e364685e21de137655b6eee725e4c6d27fc90865072d7c5892b5",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/alter.c||src/alter.c",
      "src/build.c||src/build.c",
      "src/sqliteInt.h||src/sqliteInt.h",
      "test/altertab3.test||test/altertab3.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: c5d44143599f3fe98492b2b900fa3d77925c7be545096251055ceeab899a41f1",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/alter.c||src/alter.c": [
      "File: src/alter.c -> src/alter.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "760:   Parse *pParse = pWalker->pParse;",
      "761:   int i;",
      "762:   if( pParse->nErr ) return WRC_Abort;",
      "763:   if( ALWAYS(p->pEList) ){",
      "764:     ExprList *pList = p->pEList;",
      "765:     for(i=0; i<pList->nExpr; i++){",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "763:   if( p->selFlags & SF_View ) return WRC_Prune;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "853: static int renameColumnSelectCb(Walker *pWalker, Select *p){",
      "854:   renameWalkWith(pWalker, p);",
      "855:   return WRC_Continue;",
      "856: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "855:   if( p->selFlags & SF_View ) return WRC_Prune;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1316:   if( sParse.pNewTable ){",
      "1317:     Select *pSelect = sParse.pNewTable->pSelect;",
      "1318:     if( pSelect ){",
      "1319:       sParse.rc = SQLITE_OK;",
      "1321:       rc = (db->mallocFailed ? SQLITE_NOMEM : sParse.rc);",
      "1322:       if( rc==SQLITE_OK ){",
      "1323:         sqlite3WalkSelect(&sWalker, pSelect);",
      "",
      "[Removed Lines]",
      "1320:       sqlite3SelectPrep(&sParse, sParse.pNewTable->pSelect, 0);",
      "",
      "[Added Lines]",
      "1321:       pSelect->selFlags &= ~SF_View;",
      "1323:       sqlite3SelectPrep(&sParse, pSelect, 0);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "1434:   int i;",
      "1435:   RenameCtx *p = pWalker->u.pRename;",
      "1436:   SrcList *pSrc = pSelect->pSrc;",
      "1437:   if( pSrc==0 ){",
      "1438:     assert( pWalker->pParse->db->mallocFailed );",
      "1439:     return WRC_Abort;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1440:   if( pSelect->selFlags & SF_View ) return WRC_Prune;",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "1514:         if( pTab->pSelect ){",
      "1515:           if( isLegacy==0 ){",
      "1516:             NameContext sNC;",
      "1517:             memset(&sNC, 0, sizeof(sNC));",
      "1518:             sNC.pParse = &sParse;",
      "1520:             sqlite3SelectPrep(&sParse, pTab->pSelect, &sNC);",
      "1521:             if( sParse.nErr ) rc = sParse.rc;",
      "1522:             sqlite3WalkSelect(&sWalker, pTab->pSelect);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1520:             Select *pSelect = pTab->pSelect;",
      "1525:             assert( pSelect->selFlags & SF_View );",
      "1526:             pSelect->selFlags &= ~SF_View;",
      "",
      "---------------"
    ],
    "src/build.c||src/build.c": [
      "File: src/build.c -> src/build.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2488:   if( IN_RENAME_OBJECT ){",
      "2489:     p->pSelect = pSelect;",
      "2490:     pSelect = 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2488:   pSelect->selFlags |= SF_View;",
      "",
      "---------------"
    ],
    "src/sqliteInt.h||src/sqliteInt.h": [
      "File: src/sqliteInt.h -> src/sqliteInt.h"
    ],
    "test/altertab3.test||test/altertab3.test": [
      "File: test/altertab3.test -> test/altertab3.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "487:   ALTER TABLE a RENAME a TO b;",
      "488: }",
      "491: finish_test",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "490: #------------------------------------------------------------------------",
      "491: #",
      "492: reset_db",
      "493: do_execsql_test 22.1 {",
      "494:   CREATE TABLE t1(a);",
      "495:   CREATE VIEW v2(b) AS SELECT * FROM v2;",
      "496: }",
      "498: do_catchsql_test 22.2 {",
      "499:   ALTER TABLE t1 RENAME TO t4;",
      "500: } {1 {error in view v2: view v2 is circularly defined}}",
      "502: do_execsql_test 22.3 {",
      "503:   DROP VIEW v2;",
      "504:   CREATE VIEW v2(b) AS WITH t3 AS (SELECT b FROM v2) SELECT * FROM t3;",
      "505: }",
      "507: breakpoint",
      "508: do_catchsql_test 22.4 {",
      "509:   ALTER TABLE t1 RENAME TO t4;",
      "510: } {1 {error in view v2: view v2 is circularly defined}}",
      "512: do_execsql_test 22.5 {",
      "513:   DROP VIEW v2;",
      "514:   CREATE VIEW v2(b) AS WITH t3 AS (SELECT b FROM v2) VALUES(1);",
      "515: }",
      "517: do_catchsql_test 22.6 {",
      "518:   ALTER TABLE t1 RENAME TO t4;",
      "519: } {0 {}}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ec123e13014c585d1c408e1583714de438b50aff",
      "candidate_info": {
        "commit_hash": "ec123e13014c585d1c408e1583714de438b50aff",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/ec123e13014c585d1c408e1583714de438b50aff",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/walker.c"
        ],
        "message": "Fix an indentation error and improve the placement of an assert() based on a tweet from Yuri Kotov.\n\nFossilOrigin-Name: e6314e386c6877c669bd32788d3886253b0a187bee2c3889f4eaba219f5e52c7",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/walker.c||src/walker.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: f24e6ca4f23008212ec05cace9202dbeb37ee34530ead91fac2f5e3eac7f6347",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/walker.c||src/walker.c": [
          "File: src/walker.c -> src/walker.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "73:     rc = pWalker->xExprCallback(pWalker, pExpr);",
          "74:     if( rc ) return rc & WRC_Abort;",
          "75:     if( !ExprHasProperty(pExpr,(EP_TokenOnly|EP_Leaf)) ){",
          "76:       if( pExpr->pLeft && walkExpr(pWalker, pExpr->pLeft) ) return WRC_Abort;",
          "78:       if( pExpr->pRight ){",
          "79:         assert( !ExprHasProperty(pExpr, EP_WinFunc) );",
          "80:         pExpr = pExpr->pRight;",
          "",
          "[Removed Lines]",
          "77:        assert( pExpr->x.pList==0 || pExpr->pRight==0 );",
          "",
          "[Added Lines]",
          "76:       assert( pExpr->x.pList==0 || pExpr->pRight==0 );",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f72a97925d6a382a58cef98510c8bc430e91ee25",
      "candidate_info": {
        "commit_hash": "f72a97925d6a382a58cef98510c8bc430e91ee25",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/f72a97925d6a382a58cef98510c8bc430e91ee25",
        "files": [
          "manifest",
          "manifest.uuid",
          "test/fuzzdata8.db"
        ],
        "message": "Add new test cases to test/fuzzdata8.db\n\nFossilOrigin-Name: f908cd40b275a5753d5167ebb25871300381687adcb3a7fcb1f14b57a20ee3d0",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 1e16d3e8fc60d39ca3899759ff15d355fdd7d3e23b325d8d2b0f954e11ce8dce",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "03c5c213289baed1f809d3e58dee1e2abfb72f2b",
      "candidate_info": {
        "commit_hash": "03c5c213289baed1f809d3e58dee1e2abfb72f2b",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/03c5c213289baed1f809d3e58dee1e2abfb72f2b",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/expr.c"
        ],
        "message": "OSSFuzz found a case where an assert() inside sqlite3ExprCompare() can be true.  Test case added to TH3.\n\nFossilOrigin-Name: 23b62fb160d86dc9d9073bcc714601f5b7695f96abd893eafecf4b2e565b87f2",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/expr.c||src/expr.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: d1db8d5894450b24bb0335983503d9bbf6cc48a0ae4b83291283fb2d32b6b25b",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/expr.c||src/expr.c": [
          "File: src/expr.c -> src/expr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4784:      && sqlite3ExprCompare(pParse, pA->pLeft, pB->pLeft, iTab) ) return 2;",
          "4785:     if( sqlite3ExprCompare(pParse, pA->pRight, pB->pRight, iTab) ) return 2;",
          "4786:     if( sqlite3ExprListCompare(pA->x.pList, pB->x.pList, iTab) ) return 2;",
          "4789:       if( pA->iColumn!=pB->iColumn ) return 2;",
          "4790:       if( pA->iTable!=pB->iTable",
          "4791:        && (pA->iTable!=iTab || NEVER(pB->iTable>=0)) ) return 2;",
          "",
          "[Removed Lines]",
          "4787:     assert( (combinedFlags & EP_Reduced)==0 );",
          "4788:     if( pA->op!=TK_STRING && pA->op!=TK_TRUEFALSE ){",
          "",
          "[Added Lines]",
          "4787:     if( pA->op!=TK_STRING",
          "4788:      && pA->op!=TK_TRUEFALSE",
          "4789:      && (combinedFlags & EP_Reduced)==0",
          "4790:     ){",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "66c48907a2abc90a78760f7281acb1f720adc1c7",
      "candidate_info": {
        "commit_hash": "66c48907a2abc90a78760f7281acb1f720adc1c7",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/66c48907a2abc90a78760f7281acb1f720adc1c7",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/main.c",
          "src/pragma.h",
          "src/shell.c.in",
          "src/sqlite.h.in",
          "src/test1.c",
          "test/alter3.test",
          "test/alter4.test",
          "test/conflict3.test",
          "test/corruptC.test",
          "test/corruptE.test",
          "test/descidx1.test",
          "test/descidx2.test",
          "test/descidx3.test",
          "test/distinct2.test",
          "test/filter1.test",
          "test/format4.test",
          "test/indexexpr2.test",
          "test/insert4.test",
          "test/join.test",
          "test/minmax2.test",
          "test/nulls1.test",
          "test/pragma4.test",
          "test/rowvaluevtab.test",
          "test/tkt-18458b1a.test",
          "test/tkt-a7debbe0.test",
          "test/tkt3292.test",
          "test/window9.test",
          "tool/mkpragmatab.tcl"
        ],
        "message": "Remove the legacy_file_format PRAGMA.  In its place, provide the SQLITE_DBCONFIG_LEGACY_FILE_FORMAT option to sqlite3_db_config(). Fix for ticket [6484e6ce678fffab]\n\nFossilOrigin-Name: 4d424f3047b48fc441475137f30a719d2f079390c86fe2617710ddfb05c5e240",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/main.c||src/main.c",
          "src/pragma.h||src/pragma.h",
          "src/shell.c.in||src/shell.c.in",
          "src/sqlite.h.in||src/sqlite.h.in",
          "src/test1.c||src/test1.c",
          "test/alter3.test||test/alter3.test",
          "test/alter4.test||test/alter4.test",
          "test/conflict3.test||test/conflict3.test",
          "test/corruptC.test||test/corruptC.test",
          "test/corruptE.test||test/corruptE.test",
          "test/descidx1.test||test/descidx1.test",
          "test/descidx2.test||test/descidx2.test",
          "test/descidx3.test||test/descidx3.test",
          "test/distinct2.test||test/distinct2.test",
          "test/filter1.test||test/filter1.test",
          "test/format4.test||test/format4.test",
          "test/indexexpr2.test||test/indexexpr2.test",
          "test/insert4.test||test/insert4.test",
          "test/join.test||test/join.test",
          "test/minmax2.test||test/minmax2.test",
          "test/nulls1.test||test/nulls1.test",
          "test/pragma4.test||test/pragma4.test",
          "test/rowvaluevtab.test||test/rowvaluevtab.test",
          "test/tkt-18458b1a.test||test/tkt-18458b1a.test",
          "test/tkt-a7debbe0.test||test/tkt-a7debbe0.test",
          "test/tkt3292.test||test/tkt3292.test",
          "test/window9.test||test/window9.test",
          "tool/mkpragmatab.tcl||tool/mkpragmatab.tcl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 4fba090e678ef184736277c9ec9a9374c8bd4df4d41f51a3dc6818e2efcc103b",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/main.c||src/main.c": [
          "File: src/main.c -> src/main.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "851:         { SQLITE_DBCONFIG_LEGACY_ALTER_TABLE,    SQLITE_LegacyAlter    },",
          "852:         { SQLITE_DBCONFIG_DQS_DDL,               SQLITE_DqsDDL         },",
          "853:         { SQLITE_DBCONFIG_DQS_DML,               SQLITE_DqsDML         },",
          "854:       };",
          "855:       unsigned int i;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "854:         { SQLITE_DBCONFIG_LEGACY_FILE_FORMAT,    SQLITE_LegacyFileFmt  },",
          "",
          "---------------"
        ],
        "src/pragma.h||src/pragma.h": [
          "File: src/pragma.h -> src/pragma.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "404: #endif",
          "405: #if !defined(SQLITE_OMIT_PAGER_PRAGMAS) && SQLITE_ENABLE_LOCKING_STYLE",
          "406:  {/* zName:     */ \"lock_proxy_file\",",
          "",
          "[Removed Lines]",
          "399:  {/* zName:     */ \"legacy_file_format\",",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/shell.c.in||src/shell.c.in": [
          "File: src/shell.c.in -> src/shell.c.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "7171:         { \"legacy_alter_table\", SQLITE_DBCONFIG_LEGACY_ALTER_TABLE    },",
          "7172:         { \"dqs_dml\",            SQLITE_DBCONFIG_DQS_DML               },",
          "7173:         { \"dqs_ddl\",            SQLITE_DBCONFIG_DQS_DDL               },",
          "7174:     };",
          "7175:     int ii, v;",
          "7176:     open_db(p, 0);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7174:         { \"legacy_file_format\", SQLITE_DBCONFIG_LEGACY_FILE_FORMAT    },",
          "",
          "---------------"
        ],
        "src/sqlite.h.in||src/sqlite.h.in": [
          "File: src/sqlite.h.in -> src/sqlite.h.in"
        ],
        "src/test1.c||src/test1.c": [
          "File: src/test1.c -> src/test1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "7682:     { \"LEGACY_ALTER_TABLE\", SQLITE_DBCONFIG_LEGACY_ALTER_TABLE },",
          "7683:     { \"DQS_DML\",            SQLITE_DBCONFIG_DQS_DML },",
          "7684:     { \"DQS_DDL\",            SQLITE_DBCONFIG_DQS_DDL },",
          "7685:   };",
          "7686:   int i;",
          "7688:   const char *zSetting;",
          "7689:   sqlite3 *db;",
          "7693:     return TCL_ERROR;",
          "7694:   }",
          "7695:   if( getDbPointer(interp, Tcl_GetString(objv[1]), &db) ) return TCL_ERROR;",
          "",
          "[Removed Lines]",
          "7687:   int v;",
          "7691:   if( objc!=4 ){",
          "7692:     Tcl_WrongNumArgs(interp, 1, objv, \"DB SETTING VALUE\");",
          "",
          "[Added Lines]",
          "7685:     { \"LEGACY_FILE_FORMAT\", SQLITE_DBCONFIG_LEGACY_FILE_FORMAT },",
          "7688:   int v = 0;",
          "7692:   if( objc!=4 && objc!=3 ){",
          "7693:     Tcl_WrongNumArgs(interp, 1, objv, \"DB SETTING [VALUE]\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "7705:       Tcl_NewStringObj(\"unknown sqlite3_db_config setting\", -1));",
          "7706:     return TCL_ERROR;",
          "7707:   }",
          "7709:   sqlite3_db_config(db, aSetting[i].eVal, v, &v);",
          "7710:   Tcl_SetObjResult(interp, Tcl_NewIntObj(v));",
          "7711:   return TCL_OK;",
          "",
          "[Removed Lines]",
          "7708:   if( Tcl_GetIntFromObj(interp, objv[3], &v) ) return TCL_ERROR;",
          "",
          "[Added Lines]",
          "7709:   if( objc==4 ){",
          "7710:     if( Tcl_GetIntFromObj(interp, objv[3], &v) ) return TCL_ERROR;",
          "7711:   }else{",
          "7712:     v = -1;",
          "7713:   }",
          "",
          "---------------"
        ],
        "test/alter3.test||test/alter3.test": [
          "File: test/alter3.test -> test/alter3.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "54: }",
          "56: do_test alter3-1.1 {",
          "57:   execsql {",
          "59:     CREATE TABLE abc(a, b, c);",
          "60:     SELECT sql FROM sqlite_master;",
          "61:   }",
          "",
          "[Removed Lines]",
          "58:     PRAGMA legacy_file_format=ON;",
          "",
          "[Added Lines]",
          "57:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "198:   db close",
          "199:   forcedelete test.db",
          "200:   set ::DB [sqlite3 db test.db]",
          "201:   execsql {",
          "203:     CREATE TABLE t1(a, b);",
          "204:     INSERT INTO t1 VALUES(1, 100);",
          "205:     INSERT INTO t1 VALUES(2, 300);",
          "",
          "[Removed Lines]",
          "202:     PRAGMA legacy_file_format=ON;",
          "",
          "[Added Lines]",
          "201:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------"
        ],
        "test/alter4.test||test/alter4.test": [
          "File: test/alter4.test -> test/alter4.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "383: do_test alter4-10.1 {",
          "384:   db close",
          "385:   sqlite3 db :memory:",
          "386:   db eval {",
          "388:     CREATE TABLE t1(a,b,c);",
          "389:     CREATE INDEX t1a ON t1(a DESC);",
          "390:     INSERT INTO t1 VALUES(1,2,3);",
          "",
          "[Removed Lines]",
          "387:     PRAGMA legacy_file_format=on;",
          "",
          "[Added Lines]",
          "386:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------"
        ],
        "test/conflict3.test||test/conflict3.test": [
          "File: test/conflict3.test -> test/conflict3.test"
        ],
        "test/corruptC.test||test/corruptC.test": [
          "File: test/corruptC.test -> test/corruptC.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "34: # Construct a compact, dense database for testing.",
          "35: #",
          "36: do_test corruptC-1.1 {",
          "37:   execsql {",
          "38:     PRAGMA auto_vacuum = 0;",
          "40:     BEGIN;",
          "41:     CREATE TABLE t1(x,y);",
          "42:     INSERT INTO t1 VALUES(1,1);",
          "",
          "[Removed Lines]",
          "39:     PRAGMA legacy_file_format=1;",
          "",
          "[Added Lines]",
          "37:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------"
        ],
        "test/corruptE.test||test/corruptE.test": [
          "File: test/corruptE.test -> test/corruptE.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "36: # Construct a compact, dense database for testing.",
          "37: #",
          "38: do_test corruptE-1.1 {",
          "39:   execsql {",
          "40:     PRAGMA auto_vacuum = 0;",
          "42:     BEGIN;",
          "43:     CREATE TABLE t1(x,y);",
          "44:     INSERT INTO t1 VALUES(1,1);",
          "",
          "[Removed Lines]",
          "41:     PRAGMA legacy_file_format=1;",
          "",
          "[Added Lines]",
          "39:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------"
        ],
        "test/descidx1.test||test/descidx1.test": [
          "File: test/descidx1.test -> test/descidx1.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: #",
          "23: do_not_use_codec",
          "27: # This procedure sets the value of the file-format in file 'test.db'",
          "28: # to $newval. Also, the schema cookie is incremented.",
          "",
          "[Removed Lines]",
          "25: db eval {PRAGMA legacy_file_format=OFF}",
          "",
          "[Added Lines]",
          "25: #db eval {PRAGMA legacy_file_format=OFF}",
          "26: sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "299:     db close",
          "300:     forcedelete test.db test.db-journal",
          "301:     sqlite3 db test.db",
          "303:   } {1}",
          "304: } else {",
          "305:   do_test descidx1-6.1 {",
          "306:     db close",
          "307:     forcedelete test.db test.db-journal",
          "308:     sqlite3 db test.db",
          "310:   } {0}",
          "311: }",
          "312: do_test descidx1-6.2 {",
          "315: } {1}",
          "316: do_test descidx1-6.3 {",
          "317:   execsql {",
          "",
          "[Removed Lines]",
          "302:     execsql {PRAGMA legacy_file_format}",
          "309:     execsql {PRAGMA legacy_file_format}",
          "313:   execsql {PRAGMA legacy_file_format=YES}",
          "314:   execsql {PRAGMA legacy_file_format}",
          "",
          "[Added Lines]",
          "303:     sqlite3_db_config db LEGACY_FILE_FORMAT",
          "310:     sqlite3_db_config db LEGACY_FILE_FORMAT",
          "314:   sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "315:   sqlite3_db_config db LEGACY_FILE_FORMAT",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "330:   db close",
          "331:   forcedelete test.db test.db-journal",
          "332:   sqlite3 db test.db",
          "335: } {0}",
          "336: do_test descidx1-6.5 {",
          "337:   execsql {",
          "",
          "[Removed Lines]",
          "333:   execsql {PRAGMA legacy_file_format=NO}",
          "334:   execsql {PRAGMA legacy_file_format}",
          "",
          "[Added Lines]",
          "334:   sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "335:   sqlite3_db_config db LEGACY_FILE_FORMAT",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "351:     get_file_format",
          "352:   } {4}",
          "353:   do_test descidx1-6.7 {",
          "354:     execsql {",
          "356:       VACUUM;",
          "357:     }",
          "358:     get_file_format",
          "",
          "[Removed Lines]",
          "355:       PRAGMA legacy_file_format=ON;",
          "",
          "[Added Lines]",
          "355:     sqlite3_db_config db LEGACY_FILE_FORMAT 1",
          "",
          "---------------"
        ],
        "test/descidx2.test||test/descidx2.test": [
          "File: test/descidx2.test -> test/descidx2.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "23: do_not_use_codec",
          "28: # This procedure sets the value of the file-format in file 'test.db'",
          "29: # to $newval. Also, the schema cookie is incremented.",
          "",
          "[Removed Lines]",
          "26: db eval {PRAGMA legacy_file_format=OFF}",
          "",
          "[Added Lines]",
          "26: #db eval {PRAGMA legacy_file_format=OFF}",
          "27: sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/descidx3.test||test/descidx3.test": [
          "File: test/descidx3.test -> test/descidx3.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "26:   finish_test",
          "27:   return",
          "28: }",
          "31: # This procedure sets the value of the file-format in file 'test.db'",
          "32: # to $newval. Also, the schema cookie is incremented.",
          "",
          "[Removed Lines]",
          "29: db eval {PRAGMA legacy_file_format=OFF}",
          "",
          "[Added Lines]",
          "29: #db eval {PRAGMA legacy_file_format=OFF}",
          "30: sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/distinct2.test||test/distinct2.test": [
          "File: test/distinct2.test -> test/distinct2.test"
        ],
        "test/filter1.test||test/filter1.test": [
          "File: test/filter1.test -> test/filter1.test"
        ],
        "test/format4.test||test/format4.test": [
          "File: test/format4.test -> test/format4.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: set testdir [file dirname $argv0]",
          "18: source $testdir/tester.tcl",
          "22: # The size of the database depends on whether or not autovacuum",
          "23: # is enabled.",
          "",
          "[Removed Lines]",
          "20: db eval {PRAGMA legacy_file_format=OFF}",
          "",
          "[Added Lines]",
          "20: #db eval {PRAGMA legacy_file_format=OFF}",
          "21: sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/indexexpr2.test||test/indexexpr2.test": [
          "File: test/indexexpr2.test -> test/indexexpr2.test"
        ],
        "test/insert4.test||test/insert4.test": [
          "File: test/insert4.test -> test/insert4.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "35: # Create tables used for testing.",
          "36: #",
          "37: execsql {",
          "39:   CREATE TABLE t1(a int, b int, check(b>a));",
          "40:   CREATE TABLE t2(x int, y int);",
          "41:   CREATE VIEW v2 AS SELECT y, x FROM t2;",
          "",
          "[Removed Lines]",
          "38:   PRAGMA legacy_file_format = 0;",
          "",
          "[Added Lines]",
          "37: sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/join.test||test/join.test": [
          "File: test/join.test -> test/join.test"
        ],
        "test/minmax2.test||test/minmax2.test": [
          "File: test/minmax2.test -> test/minmax2.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: source $testdir/tester.tcl",
          "23: do_test minmax2-1.0 {",
          "24:   execsql {",
          "26:     BEGIN;",
          "27:     CREATE TABLE t1(x, y);",
          "28:     INSERT INTO t1 VALUES(1,1);",
          "",
          "[Removed Lines]",
          "25:     PRAGMA legacy_file_format=0;",
          "",
          "[Added Lines]",
          "24:   sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/nulls1.test||test/nulls1.test": [
          "File: test/nulls1.test -> test/nulls1.test"
        ],
        "test/pragma4.test||test/pragma4.test": [
          "File: test/pragma4.test -> test/pragma4.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "44:  14 \"PRAGMA full_column_names = 1\"",
          "45:  15 \"PRAGMA fullfsync = 1\"",
          "46:  16 \"PRAGMA ignore_check_constraints = 1\"",
          "48:  18 \"PRAGMA page_size = 511\"",
          "49:  19 \"PRAGMA page_size = 512\"",
          "50:  20 \"PRAGMA query_only = false\"",
          "",
          "[Removed Lines]",
          "47:  17 \"PRAGMA legacy_file_format = 1\"",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/rowvaluevtab.test||test/rowvaluevtab.test": [
          "File: test/rowvaluevtab.test -> test/rowvaluevtab.test"
        ],
        "test/tkt-18458b1a.test||test/tkt-18458b1a.test": [
          "File: test/tkt-18458b1a.test -> test/tkt-18458b1a.test"
        ],
        "test/tkt-a7debbe0.test||test/tkt-a7debbe0.test": [
          "File: test/tkt-a7debbe0.test -> test/tkt-a7debbe0.test"
        ],
        "test/tkt3292.test||test/tkt3292.test": [
          "File: test/tkt3292.test -> test/tkt3292.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "20: source $testdir/tester.tcl",
          "22: do_test tkt3292-1.1 {",
          "23:   execsql {",
          "25:     CREATE TABLE t1(a INTEGER PRIMARY KEY, b INT);",
          "26:     INSERT INTO t1 VALUES(0, 1);",
          "27:     INSERT INTO t1 VALUES(1, 1);",
          "",
          "[Removed Lines]",
          "24:     PRAGMA legacy_file_format=OFF;",
          "",
          "[Added Lines]",
          "23:   sqlite3_db_config db LEGACY_FILE_FORMAT 0",
          "",
          "---------------"
        ],
        "test/window9.test||test/window9.test": [
          "File: test/window9.test -> test/window9.test"
        ],
        "tool/mkpragmatab.tcl||tool/mkpragmatab.tcl": [
          "File: tool/mkpragmatab.tcl -> tool/mkpragmatab.tcl",
          "--- Hunk 1 ---",
          "[Context before]",
          "41:   ARG:  SQLITE_NullCallback",
          "42:   IF:   !defined(SQLITE_OMIT_FLAG_PRAGMAS)",
          "49:   NAME: fullfsync",
          "50:   TYPE: FLAG",
          "51:   ARG:  SQLITE_FullFSync",
          "",
          "[Removed Lines]",
          "44:   NAME: legacy_file_format",
          "45:   TYPE: FLAG",
          "46:   ARG:  SQLITE_LegacyFileFmt",
          "47:   IF:   !defined(SQLITE_OMIT_FLAG_PRAGMAS)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "122c5142714ea4fe64d6c993adce418869df1aa2",
      "candidate_info": {
        "commit_hash": "122c5142714ea4fe64d6c993adce418869df1aa2",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/122c5142714ea4fe64d6c993adce418869df1aa2",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/vdbe.c"
        ],
        "message": "Fix a minor typo in a comment.\n\nFossilOrigin-Name: cea8a892f76bddc63b921ffc11ea8dce8f8cf649a2c77aa908c7c5c91eed7f4c",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/vdbe.c||src/vdbe.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: e77d48d1dd140967b18106044dd45e2ba6cd77b6aa5afa8bf3f0a9c16a50eec4",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/vdbe.c||src/vdbe.c": [
          "File: src/vdbe.c -> src/vdbe.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2812:   assert( pOp->p2>0 );",
          "2813:   assert( zAffinity[pOp->p2]==0 );",
          "2814:   pIn1 = &aMem[pOp->p1];",
          "2816:     assert( pIn1 <= &p->aMem[(p->nMem+1 - p->nCursor)] );",
          "2817:     assert( memIsValid(pIn1) );",
          "2818:     applyAffinity(pIn1, zAffinity[0], encoding);",
          "",
          "[Removed Lines]",
          "2815:   while( 1 /*edit-by-break*/ ){",
          "",
          "[Added Lines]",
          "2815:   while( 1 /*exit-by-break*/ ){",
          "",
          "---------------"
        ]
      }
    }
  ]
}