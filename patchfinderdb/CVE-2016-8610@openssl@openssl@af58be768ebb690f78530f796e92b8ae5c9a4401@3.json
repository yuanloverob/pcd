{
  "cve_id": "CVE-2016-8610",
  "cve_desc": "A denial of service flaw was found in OpenSSL 0.9.8, 1.0.1, 1.0.2 through 1.0.2h, and 1.1.0 in the way the TLS/SSL protocol defined processing of ALERT packets during a connection handshake. A remote attacker could use this flaw to make a TLS/SSL server consume an excessive amount of CPU and fail to accept connections from other clients.",
  "repo": "openssl/openssl",
  "patch_hash": "af58be768ebb690f78530f796e92b8ae5c9a4401",
  "patch_info": {
    "commit_hash": "af58be768ebb690f78530f796e92b8ae5c9a4401",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/af58be768ebb690f78530f796e92b8ae5c9a4401",
    "files": [
      "include/openssl/ssl.h",
      "ssl/record/rec_layer_d1.c",
      "ssl/record/rec_layer_s3.c",
      "ssl/record/record.h",
      "ssl/record/record_locl.h",
      "ssl/ssl_err.c"
    ],
    "message": "Don't allow too many consecutive warning alerts\n\nCertain warning alerts are ignored if they are received. This can mean that\nno progress will be made if one peer continually sends those warning alerts.\nImplement a count so that we abort the connection if we receive too many.\n\nIssue reported by Shi Lei.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "include/openssl/ssl.h||include/openssl/ssl.h",
      "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c",
      "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
      "ssl/record/record.h||ssl/record/record.h",
      "ssl/record/record_locl.h||ssl/record/record_locl.h",
      "ssl/ssl_err.c||ssl/ssl_err.c"
    ]
  },
  "patch_diff": {
    "include/openssl/ssl.h||include/openssl/ssl.h": [
      "File: include/openssl/ssl.h -> include/openssl/ssl.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "2485: # define SSL_R_TLS_HEARTBEAT_PENDING                      366",
      "2486: # define SSL_R_TLS_ILLEGAL_EXPORTER_LABEL                 367",
      "2487: # define SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST             157",
      "2488: # define SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS             314",
      "2489: # define SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS       239",
      "2490: # define SSL_R_UNABLE_TO_LOAD_SSL3_MD5_ROUTINES           242",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2488: # define SSL_R_TOO_MANY_WARN_ALERTS                       409",
      "",
      "---------------"
    ],
    "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c": [
      "File: ssl/record/rec_layer_d1.c -> ssl/record/rec_layer_d1.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "443:         }",
      "444:     }",
      "448:     if (s->s3->change_cipher_spec /* set when we receive ChangeCipherSpec,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "450:     if (SSL3_RECORD_get_type(rr) != SSL3_RT_ALERT",
      "451:             && SSL3_RECORD_get_length(rr) != 0)",
      "452:         s->rlayer.alert_count = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "723:         if (alert_level == SSL3_AL_WARNING) {",
      "724:             s->s3->warn_alert = alert_descr;",
      "725:             if (alert_descr == SSL_AD_CLOSE_NOTIFY) {",
      "726: #ifndef OPENSSL_NO_SCTP",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "734:             s->rlayer.alert_count++;",
      "735:             if (s->rlayer.alert_count == MAX_WARN_ALERT_COUNT) {",
      "736:                 al = SSL_AD_UNEXPECTED_MESSAGE;",
      "737:                 SSLerr(SSL_F_DTLS1_READ_BYTES, SSL_R_TOO_MANY_WARN_ALERTS);",
      "738:                 goto f_err;",
      "739:             }",
      "",
      "---------------"
    ],
    "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c": [
      "File: ssl/record/rec_layer_s3.c -> ssl/record/rec_layer_s3.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1063:     } while (num_recs == 0);",
      "1064:     rr = &rr[curr_rec];",
      "1068:     if (s->s3->change_cipher_spec /* set when we receive ChangeCipherSpec,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1070:     if (SSL3_RECORD_get_type(rr) != SSL3_RT_ALERT",
      "1071:             && SSL3_RECORD_get_length(rr) != 0)",
      "1072:         s->rlayer.alert_count = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1333:         if (alert_level == SSL3_AL_WARNING) {",
      "1334:             s->s3->warn_alert = alert_descr;",
      "1335:             SSL3_RECORD_set_read(rr);",
      "1336:             if (alert_descr == SSL_AD_CLOSE_NOTIFY) {",
      "1337:                 s->shutdown |= SSL_RECEIVED_SHUTDOWN;",
      "1338:                 return (0);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1345:             s->rlayer.alert_count++;",
      "1346:             if (s->rlayer.alert_count == MAX_WARN_ALERT_COUNT) {",
      "1347:                 al = SSL_AD_UNEXPECTED_MESSAGE;",
      "1348:                 SSLerr(SSL_F_SSL3_READ_BYTES, SSL_R_TOO_MANY_WARN_ALERTS);",
      "1349:                 goto f_err;",
      "1350:             }",
      "",
      "---------------"
    ],
    "ssl/record/record.h||ssl/record/record.h": [
      "File: ssl/record/record.h -> ssl/record/record.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "178:     unsigned char write_sequence[SEQ_NUM_SIZE];",
      "180:     unsigned int is_first_record;",
      "181:     DTLS_RECORD_LAYER *d;",
      "182: } RECORD_LAYER;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "182:     unsigned int alert_count;",
      "",
      "---------------"
    ],
    "ssl/record/record_locl.h||ssl/record/record_locl.h": [
      "File: ssl/record/record_locl.h -> ssl/record/record_locl.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: #define RECORD_LAYER_get_rbuf(rl)               (&(rl)->rbuf)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "17: #define MAX_WARN_ALERT_COUNT    5",
      "",
      "---------------"
    ],
    "ssl/ssl_err.c||ssl/ssl_err.c": [
      "File: ssl/ssl_err.c -> ssl/ssl_err.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "617:      \"tls illegal exporter label\"},",
      "618:     {ERR_REASON(SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST),",
      "619:      \"tls invalid ecpointformat list\"},",
      "620:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS),",
      "621:      \"unable to find ecdh parameters\"},",
      "622:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS),",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "620:     {ERR_REASON(SSL_R_TOO_MANY_WARN_ALERTS), \"too many warn alerts\"},",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "66d4bf6b20d8769a3c2bf1a0c4cb3155365601e7",
      "candidate_info": {
        "commit_hash": "66d4bf6b20d8769a3c2bf1a0c4cb3155365601e7",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/66d4bf6b20d8769a3c2bf1a0c4cb3155365601e7",
        "files": [
          "include/openssl/ssl.h",
          "ssl/ssl_err.c",
          "ssl/statem/statem_clnt.c"
        ],
        "message": "Verify that if we have an HRR then something will change\n\nIt is invalid if we receive an HRR but no change will result in\nClientHello2.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3414)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2680: # define SSL_R_NO_CERTIFICATES_RETURNED                   176",
          "2681: # define SSL_R_NO_CERTIFICATE_ASSIGNED                    177",
          "2682: # define SSL_R_NO_CERTIFICATE_SET                         179",
          "2683: # define SSL_R_NO_CIPHERS_AVAILABLE                       181",
          "2684: # define SSL_R_NO_CIPHERS_SPECIFIED                       183",
          "2685: # define SSL_R_NO_CIPHER_MATCH                            185",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2683: # define SSL_R_NO_CHANGE_FOLLOWING_HRR                    205",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "646:     {ERR_REASON(SSL_R_NO_CERTIFICATES_RETURNED), \"no certificates returned\"},",
          "647:     {ERR_REASON(SSL_R_NO_CERTIFICATE_ASSIGNED), \"no certificate assigned\"},",
          "648:     {ERR_REASON(SSL_R_NO_CERTIFICATE_SET), \"no certificate set\"},",
          "649:     {ERR_REASON(SSL_R_NO_CIPHERS_AVAILABLE), \"no ciphers available\"},",
          "650:     {ERR_REASON(SSL_R_NO_CIPHERS_SPECIFIED), \"no ciphers specified\"},",
          "651:     {ERR_REASON(SSL_R_NO_CIPHER_MATCH), \"no cipher match\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "649:     {ERR_REASON(SSL_R_NO_CHANGE_FOLLOWING_HRR), \"no change following hrr\"},",
          "",
          "---------------"
        ],
        "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
          "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1609:         goto f_err;",
          "1610:     }",
          "1613:         al = SSL_AD_DECODE_ERROR;",
          "1614:         SSLerr(SSL_F_TLS_PROCESS_HELLO_RETRY_REQUEST, SSL_R_BAD_LENGTH);",
          "1615:         goto f_err;",
          "",
          "[Removed Lines]",
          "1612:     if (!PACKET_as_length_prefixed_2(pkt, &extpkt)) {",
          "",
          "[Added Lines]",
          "1612:     if (!PACKET_as_length_prefixed_2(pkt, &extpkt)",
          "1614:             || PACKET_remaining(&extpkt) == 0",
          "1616:             || PACKET_remaining(pkt) != 0) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1622:         goto f_err;",
          "1624:     OPENSSL_free(extensions);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1629:     extensions = NULL;",
          "1631:     if (s->ext.tls13_cookie_len == 0 && s->s3->tmp.pkey != NULL) {",
          "1636:         al = SSL_AD_ILLEGAL_PARAMETER;",
          "1637:         SSLerr(SSL_F_TLS_PROCESS_HELLO_RETRY_REQUEST,",
          "1638:                SSL_R_NO_CHANGE_FOLLOWING_HRR);",
          "1639:         goto f_err;",
          "1640:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e892e3255858b6b8bb79bee9972aa9700a38903b",
      "candidate_info": {
        "commit_hash": "e892e3255858b6b8bb79bee9972aa9700a38903b",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/e892e3255858b6b8bb79bee9972aa9700a38903b",
        "files": [
          "include/openssl/ssl.h",
          "ssl/ssl_err.c",
          "ssl/t1_lib.c"
        ],
        "message": "Reject compressed point format with TLS 1.3\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2739)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/t1_lib.c||ssl/t1_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2508: # define SSL_R_GOT_A_FIN_BEFORE_A_CCS                     154",
          "2509: # define SSL_R_HTTPS_PROXY_REQUEST                        155",
          "2510: # define SSL_R_HTTP_REQUEST                               156",
          "2511: # define SSL_R_ILLEGAL_SUITEB_DIGEST                      380",
          "2512: # define SSL_R_INAPPROPRIATE_FALLBACK                     373",
          "2513: # define SSL_R_INCONSISTENT_COMPRESSION                   340",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2511: # define SSL_R_ILLEGAL_POINT_COMPRESSION                  162",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "570:     {ERR_REASON(SSL_R_GOT_A_FIN_BEFORE_A_CCS), \"got a fin before a ccs\"},",
          "571:     {ERR_REASON(SSL_R_HTTPS_PROXY_REQUEST), \"https proxy request\"},",
          "572:     {ERR_REASON(SSL_R_HTTP_REQUEST), \"http request\"},",
          "573:     {ERR_REASON(SSL_R_ILLEGAL_SUITEB_DIGEST), \"illegal Suite B digest\"},",
          "574:     {ERR_REASON(SSL_R_INAPPROPRIATE_FALLBACK), \"inappropriate fallback\"},",
          "575:     {ERR_REASON(SSL_R_INCONSISTENT_COMPRESSION), \"inconsistent compression\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "573:     {ERR_REASON(SSL_R_ILLEGAL_POINT_COMPRESSION),",
          "574:      \"illegal point compression\"},",
          "",
          "---------------"
        ],
        "ssl/t1_lib.c||ssl/t1_lib.c": [
          "File: ssl/t1_lib.c -> ssl/t1_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "916:         int curve = EC_GROUP_get_curve_name(EC_KEY_get0_group(ec));",
          "918:         if (SSL_IS_TLS13(s)) {",
          "921:             if (lu->curve != NID_undef && curve != lu->curve) {",
          "922:                 SSLerr(SSL_F_TLS12_CHECK_PEER_SIGALG, SSL_R_WRONG_CURVE);",
          "923:                 return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "919:             if (EC_KEY_get_conv_form(ec) != POINT_CONVERSION_UNCOMPRESSED) {",
          "920:                 SSLerr(SSL_F_TLS12_CHECK_PEER_SIGALG,",
          "921:                        SSL_R_ILLEGAL_POINT_COMPRESSION);",
          "922:                 return 0;",
          "923:             }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2237:     if (SSL_IS_TLS13(s)) {",
          "2238:         size_t i;",
          "2239: #ifndef OPENSSL_NO_EC",
          "2241: #endif",
          "",
          "[Removed Lines]",
          "2240:         int curve = -1;",
          "",
          "[Added Lines]",
          "2244:         int curve = -1, skip_ec = 0;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2258:                     EC_KEY *ec = EVP_PKEY_get0_EC_KEY(s->cert->pkeys[idx].privatekey);",
          "2260:                     curve = EC_GROUP_get_curve_name(EC_KEY_get0_group(ec));",
          "2261:                 }",
          "2263:                     continue;",
          "2264: #else",
          "2265:                 continue;",
          "",
          "[Removed Lines]",
          "2262:                 if (lu->curve != NID_undef && curve != lu->curve)",
          "",
          "[Added Lines]",
          "2265:                     if (EC_KEY_get_conv_form(ec)",
          "2266:                         != POINT_CONVERSION_UNCOMPRESSED)",
          "2267:                         skip_ec = 1;",
          "2269:                 if (skip_ec || (lu->curve != NID_undef && curve != lu->curve))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "11c67eeaf4dd0376d84a90590e307d5d2e12f025",
      "candidate_info": {
        "commit_hash": "11c67eeaf4dd0376d84a90590e307d5d2e12f025",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/11c67eeaf4dd0376d84a90590e307d5d2e12f025",
        "files": [
          "include/openssl/ssl.h",
          "include/openssl/ssl3.h",
          "ssl/ssl_err.c",
          "ssl/statem/statem_clnt.c",
          "ssl/statem/statem_lib.c",
          "ssl/statem/statem_locl.h",
          "ssl/statem/statem_srvr.c",
          "ssl/t1_trce.c",
          "util/TLSProxy/HelloRetryRequest.pm"
        ],
        "message": "HelloRetryRequest updates for draft-19\n\nDraft-19 changes the HRR transcript hash so that the initial ClientHello\nis replaced in the transcript with a special synthetic message_hash message\nthat just contains a hash of ClientHello1 as its message body.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2895)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "include/openssl/ssl3.h||include/openssl/ssl3.h",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c",
          "ssl/statem/statem_lib.c||ssl/statem/statem_lib.c",
          "ssl/statem/statem_locl.h||ssl/statem/statem_locl.h",
          "ssl/statem/statem_srvr.c||ssl/statem/statem_srvr.c",
          "ssl/t1_trce.c||ssl/t1_trce.c",
          "util/TLSProxy/HelloRetryRequest.pm||util/TLSProxy/HelloRetryRequest.pm"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2135: # define SSL_F_ADD_KEY_SHARE                              512",
          "2136: # define SSL_F_BYTES_TO_CIPHER_LIST                       519",
          "2137: # define SSL_F_CHECK_SUITEB_CIPHER_LIST                   331",
          "2138: # define SSL_F_CT_MOVE_SCTS                               345",
          "2139: # define SSL_F_CT_STRICT                                  349",
          "2140: # define SSL_F_D2I_SSL_SESSION                            103",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2138: # define SSL_F_CREATE_SYNTHETIC_MESSAGE_HASH              539",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2175: # define SSL_F_OSSL_STATEM_SERVER_READ_TRANSITION         418",
          "2176: # define SSL_F_PROCESS_KEY_SHARE_EXT                      439",
          "2177: # define SSL_F_READ_STATE_MACHINE                         352",
          "2178: # define SSL_F_SSL3_CHANGE_CIPHER_STATE                   129",
          "2179: # define SSL_F_SSL3_CHECK_CERT_AND_ALGORITHM              130",
          "2180: # define SSL_F_SSL3_CTRL                                  213",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2179: # define SSL_F_SET_CLIENT_CIPHERSUITE                     540",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2464: # define SSL_R_AT_LEAST_TLS_1_0_NEEDED_IN_FIPS_MODE       143",
          "2465: # define SSL_R_AT_LEAST_TLS_1_2_NEEDED_IN_SUITEB_MODE     158",
          "2466: # define SSL_R_BAD_CHANGE_CIPHER_SPEC                     103",
          "2467: # define SSL_R_BAD_DATA                                   390",
          "2468: # define SSL_R_BAD_DATA_RETURNED_BY_CALLBACK              106",
          "2469: # define SSL_R_BAD_DECOMPRESSION                          107",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2469: # define SSL_R_BAD_CIPHER                                 186",
          "",
          "---------------"
        ],
        "include/openssl/ssl3.h||include/openssl/ssl3.h": [
          "File: include/openssl/ssl3.h -> include/openssl/ssl3.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "293: # define SSL3_MT_CERTIFICATE_STATUS              22",
          "294: # define SSL3_MT_KEY_UPDATE                      24",
          "295: # ifndef OPENSSL_NO_NEXTPROTONEG",
          "297: # endif",
          "301: # define SSL3_MT_CHANGE_CIPHER_SPEC              0x0101",
          "",
          "[Removed Lines]",
          "296: #  define SSL3_MT_NEXT_PROTO                      67",
          "298: # define DTLS1_MT_HELLO_VERIFY_REQUEST    3",
          "",
          "[Added Lines]",
          "296: #  define SSL3_MT_NEXT_PROTO                     67",
          "298: # define SSL3_MT_MESSAGE_HASH                    254",
          "299: # define DTLS1_MT_HELLO_VERIFY_REQUEST           3",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:     {ERR_FUNC(SSL_F_ADD_KEY_SHARE), \"add_key_share\"},",
          "24:     {ERR_FUNC(SSL_F_BYTES_TO_CIPHER_LIST), \"bytes_to_cipher_list\"},",
          "25:     {ERR_FUNC(SSL_F_CHECK_SUITEB_CIPHER_LIST), \"check_suiteb_cipher_list\"},",
          "26:     {ERR_FUNC(SSL_F_CT_MOVE_SCTS), \"ct_move_scts\"},",
          "27:     {ERR_FUNC(SSL_F_CT_STRICT), \"ct_strict\"},",
          "28:     {ERR_FUNC(SSL_F_D2I_SSL_SESSION), \"d2i_SSL_SESSION\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26:     {ERR_FUNC(SSL_F_CREATE_SYNTHETIC_MESSAGE_HASH),",
          "27:      \"create_synthetic_message_hash\"},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "74:      \"ossl_statem_server_read_transition\"},",
          "75:     {ERR_FUNC(SSL_F_PROCESS_KEY_SHARE_EXT), \"process_key_share_ext\"},",
          "76:     {ERR_FUNC(SSL_F_READ_STATE_MACHINE), \"read_state_machine\"},",
          "77:     {ERR_FUNC(SSL_F_SSL3_CHANGE_CIPHER_STATE), \"ssl3_change_cipher_state\"},",
          "78:     {ERR_FUNC(SSL_F_SSL3_CHECK_CERT_AND_ALGORITHM),",
          "79:      \"ssl3_check_cert_and_algorithm\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "79:     {ERR_FUNC(SSL_F_SET_CLIENT_CIPHERSUITE), \"set_client_ciphersuite\"},",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "481:     {ERR_REASON(SSL_R_AT_LEAST_TLS_1_2_NEEDED_IN_SUITEB_MODE),",
          "482:      \"at least (D)TLS 1.2 needed in Suite B mode\"},",
          "483:     {ERR_REASON(SSL_R_BAD_CHANGE_CIPHER_SPEC), \"bad change cipher spec\"},",
          "484:     {ERR_REASON(SSL_R_BAD_DATA), \"bad data\"},",
          "485:     {ERR_REASON(SSL_R_BAD_DATA_RETURNED_BY_CALLBACK),",
          "486:      \"bad data returned by callback\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "487:     {ERR_REASON(SSL_R_BAD_CIPHER), \"bad cipher\"},",
          "",
          "---------------"
        ],
        "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
          "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1243:     return MSG_PROCESS_ERROR;",
          "1244: }",
          "1247: {",
          "1248:     STACK_OF(SSL_CIPHER) *sk;",
          "1249:     const SSL_CIPHER *c;",
          "1250:     PACKET session_id, extpkt;",
          "1251:     size_t session_id_len;",
          "1252:     const unsigned char *cipherchars;",
          "1254:     unsigned int compression;",
          "1255:     unsigned int sversion;",
          "1256:     unsigned int context;",
          "",
          "[Removed Lines]",
          "1246: MSG_PROCESS_RETURN tls_process_server_hello(SSL *s, PACKET *pkt)",
          "1253:     int i, al = SSL_AD_INTERNAL_ERROR;",
          "",
          "[Added Lines]",
          "1246: static int set_client_ciphersuite(SSL *s, const unsigned char *cipherchars)",
          "1250:     int i;",
          "1252:     c = ssl_get_cipher_by_char(s, cipherchars, 0);",
          "1253:     if (c == NULL) {",
          "1255:         SSLerr(SSL_F_SET_CLIENT_CIPHERSUITE, SSL_R_UNKNOWN_CIPHER_RETURNED);",
          "1256:         return 0;",
          "1257:     }",
          "1262:     if (ssl_cipher_disabled(s, c, SSL_SECOP_CIPHER_CHECK)) {",
          "1263:         SSLerr(SSL_F_SET_CLIENT_CIPHERSUITE, SSL_R_WRONG_CIPHER_RETURNED);",
          "1264:         return 0;",
          "1265:     }",
          "1267:     sk = ssl_get_ciphers_by_id(s);",
          "1268:     i = sk_SSL_CIPHER_find(sk, c);",
          "1269:     if (i < 0) {",
          "1271:         SSLerr(SSL_F_SET_CLIENT_CIPHERSUITE, SSL_R_WRONG_CIPHER_RETURNED);",
          "1272:         return 0;",
          "1273:     }",
          "1275:     if (SSL_IS_TLS13(s) && s->s3->tmp.new_cipher != NULL",
          "1276:             && s->s3->tmp.new_cipher->id != c->id) {",
          "1278:         SSLerr(SSL_F_SET_CLIENT_CIPHERSUITE, SSL_R_WRONG_CIPHER_RETURNED);",
          "1279:         return 0;",
          "1280:     }",
          "1287:     if (s->session->cipher != NULL)",
          "1288:         s->session->cipher_id = s->session->cipher->id;",
          "1289:     if (s->hit && (s->session->cipher_id != c->id)) {",
          "1290:         SSLerr(SSL_F_SET_CLIENT_CIPHERSUITE,",
          "1291:                SSL_R_OLD_SESSION_CIPHER_NOT_RETURNED);",
          "1292:         return 0;",
          "1293:     }",
          "1294:     s->s3->tmp.new_cipher = c;",
          "1296:     return 1;",
          "1297: }",
          "1299: MSG_PROCESS_RETURN tls_process_server_hello(SSL *s, PACKET *pkt)",
          "1300: {",
          "1304:     int al = SSL_AD_INTERNAL_ERROR;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1437:                SSL_R_SSL_SESSION_VERSION_MISMATCH);",
          "1438:         goto f_err;",
          "1439:     }",
          "1452:     s->s3->tmp.min_ver = s->version;",
          "1453:     s->s3->tmp.max_ver = s->version;",
          "1468:         al = SSL_AD_ILLEGAL_PARAMETER;",
          "1470:         goto f_err;",
          "1471:     }",
          "1488: #ifdef OPENSSL_NO_COMP",
          "1489:     if (compression != 0) {",
          "",
          "[Removed Lines]",
          "1441:     c = ssl_get_cipher_by_char(s, cipherchars, 0);",
          "1442:     if (c == NULL) {",
          "1444:         al = SSL_AD_ILLEGAL_PARAMETER;",
          "1445:         SSLerr(SSL_F_TLS_PROCESS_SERVER_HELLO, SSL_R_UNKNOWN_CIPHER_RETURNED);",
          "1446:         goto f_err;",
          "1447:     }",
          "1458:     if (ssl_cipher_disabled(s, c, SSL_SECOP_CIPHER_CHECK)) {",
          "1459:         al = SSL_AD_ILLEGAL_PARAMETER;",
          "1460:         SSLerr(SSL_F_TLS_PROCESS_SERVER_HELLO, SSL_R_WRONG_CIPHER_RETURNED);",
          "1461:         goto f_err;",
          "1462:     }",
          "1464:     sk = ssl_get_ciphers_by_id(s);",
          "1465:     i = sk_SSL_CIPHER_find(sk, c);",
          "1466:     if (i < 0) {",
          "1469:         SSLerr(SSL_F_TLS_PROCESS_SERVER_HELLO, SSL_R_WRONG_CIPHER_RETURNED);",
          "1478:     if (s->session->cipher)",
          "1479:         s->session->cipher_id = s->session->cipher->id;",
          "1480:     if (s->hit && (s->session->cipher_id != c->id)) {",
          "1481:         al = SSL_AD_ILLEGAL_PARAMETER;",
          "1482:         SSLerr(SSL_F_TLS_PROCESS_SERVER_HELLO,",
          "1483:                SSL_R_OLD_SESSION_CIPHER_NOT_RETURNED);",
          "1484:         goto f_err;",
          "1485:     }",
          "1486:     s->s3->tmp.new_cipher = c;",
          "",
          "[Added Lines]",
          "1498:     if (!set_client_ciphersuite(s, cipherchars)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1580: {",
          "1581:     unsigned int sversion;",
          "1582:     int errorcode;",
          "1583:     RAW_EXTENSION *extensions = NULL;",
          "1584:     int al;",
          "1585:     PACKET extpkt;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1598:     const unsigned char *cipherchars;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1600:         goto f_err;",
          "1601:     }",
          "1603:     if (!PACKET_as_length_prefixed_2(pkt, &extpkt)) {",
          "1604:         al = SSL_AD_DECODE_ERROR;",
          "1605:         SSLerr(SSL_F_TLS_PROCESS_HELLO_RETRY_REQUEST, SSL_R_BAD_LENGTH);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1619:     if (!PACKET_get_bytes(pkt, &cipherchars, TLS_CIPHER_LEN)) {",
          "1620:         SSLerr(SSL_F_TLS_PROCESS_HELLO_RETRY_REQUEST, SSL_R_LENGTH_MISMATCH);",
          "1621:         al = SSL_AD_DECODE_ERROR;",
          "1622:         goto f_err;",
          "1623:     }",
          "1625:     if (!set_client_ciphersuite(s, cipherchars)) {",
          "1626:         al = SSL_AD_ILLEGAL_PARAMETER;",
          "1627:         goto f_err;",
          "1628:     }",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1615:     OPENSSL_free(extensions);",
          "1617:     return MSG_PROCESS_FINISHED_READING;",
          "1618:  f_err:",
          "1619:     ssl3_send_alert(s, SSL3_AL_FATAL, al);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1648:     if (!create_synthetic_message_hash(s)) {",
          "1649:         al = SSL_AD_INTERNAL_ERROR;",
          "1650:         goto f_err;",
          "1651:     }",
          "1659:     if (!ssl3_finish_mac(s, (unsigned char *)s->init_buf->data,",
          "1660:                                 s->init_num + SSL3_HM_HEADER_LENGTH)) {",
          "1661:         al = SSL_AD_INTERNAL_ERROR;",
          "1662:         SSLerr(SSL_F_TLS_PROCESS_HELLO_RETRY_REQUEST, ERR_R_INTERNAL_ERROR);",
          "1663:         goto f_err;",
          "1664:     }",
          "",
          "---------------"
        ],
        "ssl/statem/statem_lib.c||ssl/statem/statem_lib.c": [
          "File: ssl/statem/statem_lib.c -> ssl/statem/statem_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1149:             s->msg_callback(0, SSL2_VERSION, 0, s->init_buf->data,",
          "1150:                             (size_t)s->init_num, s, s->msg_callback_arg);",
          "1151:     } else {",
          "1154:             SSLerr(SSL_F_TLS_GET_MESSAGE_BODY, ERR_R_EVP_LIB);",
          "1155:             ssl3_send_alert(s, SSL3_AL_FATAL, SSL_AD_INTERNAL_ERROR);",
          "",
          "[Removed Lines]",
          "1152:         if (!ssl3_finish_mac(s, (unsigned char *)s->init_buf->data,",
          "1153:                              s->init_num + SSL3_HM_HEADER_LENGTH)) {",
          "",
          "[Added Lines]",
          "1156:         if (s->s3->tmp.message_type != SSL3_MT_HELLO_RETRY_REQUEST",
          "1157:                 && !ssl3_finish_mac(s, (unsigned char *)s->init_buf->data,",
          "1158:                                     s->init_num + SSL3_HM_HEADER_LENGTH)) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1870:     return i < num_groups;",
          "1871: }",
          "1872: #endif",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1880: int create_synthetic_message_hash(SSL *s)",
          "1881: {",
          "1882:     unsigned char hashval[EVP_MAX_MD_SIZE];",
          "1883:     size_t hashlen = 0;",
          "1884:     unsigned char msghdr[SSL3_HM_HEADER_LENGTH] = {",
          "1885:         SSL3_MT_MESSAGE_HASH,",
          "1886:         0,",
          "1887:         0,",
          "1888:         0",
          "1889:     };",
          "1892:     if (!ssl3_digest_cached_records(s, 0)",
          "1893:             || !ssl_handshake_hash(s, hashval, sizeof(hashval), &hashlen)) {",
          "1894:         SSLerr(SSL_F_CREATE_SYNTHETIC_MESSAGE_HASH, ERR_R_INTERNAL_ERROR);",
          "1895:         return 0;",
          "1896:     }",
          "1899:     if (!ssl3_init_finished_mac(s))",
          "1900:         return 0;",
          "1903:     msghdr[SSL3_HM_HEADER_LENGTH - 1] = hashlen;",
          "1904:     if (!ssl3_finish_mac(s, msghdr, SSL3_HM_HEADER_LENGTH)",
          "1905:             || !ssl3_finish_mac(s, hashval, hashlen)) {",
          "1906:         SSLerr(SSL_F_CREATE_SYNTHETIC_MESSAGE_HASH, ERR_R_INTERNAL_ERROR);",
          "1907:         return 0;",
          "1908:     }",
          "1910:     return 1;",
          "1911: }",
          "",
          "---------------"
        ],
        "ssl/statem/statem_locl.h||ssl/statem/statem_locl.h": [
          "File: ssl/statem/statem_locl.h -> ssl/statem/statem_locl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "80: int check_in_list(SSL *s, unsigned int group_id, const unsigned char *groups,",
          "81:                   size_t num_groups, int checkallow);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "82: int create_synthetic_message_hash(SSL *s);",
          "",
          "---------------"
        ],
        "ssl/statem/statem_srvr.c||ssl/statem/statem_srvr.c": [
          "File: ssl/statem/statem_srvr.c -> ssl/statem/statem_srvr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1975:                        SSL_R_NO_SHARED_CIPHER);",
          "1976:                 goto f_err;",
          "1977:             }",
          "1978:             s->s3->tmp.new_cipher = cipher;",
          "1979:             if (!tls_choose_sigalg(s, &al))",
          "1980:                 goto f_err;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1978:             if (SSL_IS_TLS13(s) && s->s3->tmp.new_cipher != NULL",
          "1979:                     && s->s3->tmp.new_cipher->id != cipher->id) {",
          "1984:                 al = SSL_AD_ILLEGAL_PARAMETER;",
          "1985:                 SSLerr(SSL_F_TLS_POST_PROCESS_CLIENT_HELLO, SSL_R_BAD_CIPHER);",
          "1986:                 goto f_err;",
          "1987:             }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3662: static int tls_construct_hello_retry_request(SSL *s, WPACKET *pkt)",
          "3663: {",
          "3664:     int al = SSL_AD_INTERNAL_ERROR;",
          "3670:     if (!WPACKET_put_bytes_u16(pkt, TLS1_3_VERSION_DRAFT)",
          "3671:             || !tls_construct_extensions(s, pkt, EXT_TLS1_3_HELLO_RETRY_REQUEST,",
          "3672:                                          NULL, 0, &al)) {",
          "3673:         SSLerr(SSL_F_TLS_CONSTRUCT_HELLO_RETRY_REQUEST, ERR_R_INTERNAL_ERROR);",
          "3676:     }",
          "",
          "[Removed Lines]",
          "3674:         ssl3_send_alert(s, SSL3_AL_FATAL, al);",
          "3675:         return 0;",
          "",
          "[Added Lines]",
          "3675:     size_t len = 0;",
          "3682:             || !s->method->put_cipher_by_char(s->s3->tmp.new_cipher, pkt, &len)",
          "3686:         goto err;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3680:     s->session = NULL;",
          "3681:     s->hit = 0;",
          "3683:     return 1;",
          "3684: }",
          "3686: MSG_PROCESS_RETURN tls_process_end_of_early_data(SSL *s, PACKET *pkt)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3698:     if (!create_synthetic_message_hash(s))",
          "3699:         goto err;",
          "3702:  err:",
          "3703:     ssl3_send_alert(s, SSL3_AL_FATAL, al);",
          "3704:     return 0;",
          "",
          "---------------"
        ],
        "ssl/t1_trce.c||ssl/t1_trce.c": [
          "File: ssl/t1_trce.c -> ssl/t1_trce.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "992:     return 1;",
          "993: }",
          "995: static int ssl_get_keyex(const char **pname, SSL *ssl)",
          "996: {",
          "997:     unsigned long alg_k = ssl->s3->tmp.new_cipher->algorithm_mkey;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "995: static int ssl_print_hello_retry_request(BIO *bio, int indent,",
          "996:                                          const unsigned char *msg,",
          "997:                                          size_t msglen)",
          "998: {",
          "999:     unsigned int cs;",
          "1001:     if (!ssl_print_version(bio, indent, \"server_version\", &msg, &msglen, NULL))",
          "1002:         return 0;",
          "1004:     cs = (msg[0] << 8) | msg[1];",
          "1005:     BIO_indent(bio, indent, 80);",
          "1006:     BIO_printf(bio, \"cipher_suite {0x%02X, 0x%02X} %s\\n\",",
          "1007:                msg[0], msg[1], ssl_trace_str(cs, ssl_ciphers_tbl));",
          "1008:     msg += 2;",
          "1009:     msglen -= 2;",
          "1011:     if (!ssl_print_extensions(bio, indent, 1, SSL3_MT_HELLO_RETRY_REQUEST, &msg,",
          "1012:                               &msglen))",
          "1013:         return 0;",
          "1015:     return 1;",
          "1016: }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1422:         break;",
          "1424:     case SSL3_MT_HELLO_RETRY_REQUEST:",
          "1430:             return 0;",
          "1431:         break;",
          "",
          "[Removed Lines]",
          "1425:         if (!ssl_print_version(bio, indent + 2, \"server_version\", &msg, &msglen,",
          "1426:                                NULL)",
          "1427:                 || !ssl_print_extensions(bio, indent + 2, 1,",
          "1428:                                          SSL3_MT_HELLO_RETRY_REQUEST, &msg,",
          "1429:                                          &msglen))",
          "",
          "[Added Lines]",
          "1448:         if (!ssl_print_hello_retry_request(bio, indent + 2, msg, msglen))",
          "",
          "---------------"
        ],
        "util/TLSProxy/HelloRetryRequest.pm||util/TLSProxy/HelloRetryRequest.pm": [
          "File: util/TLSProxy/HelloRetryRequest.pm -> util/TLSProxy/HelloRetryRequest.pm",
          "--- Hunk 1 ---",
          "[Context before]",
          "47:         $server_version = TLSProxy::Record::VERS_TLS_1_3;",
          "48:     }",
          "50:     my $extensions_len = unpack('n', substr($self->data, $ptr));",
          "51:     if (!defined $extensions_len) {",
          "52:         $extensions_len = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "50:     my $ciphersuite = unpack('n', substr($self->data, $ptr));",
          "51:     $ptr += 2;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "75:     }",
          "77:     $self->server_version($server_version);",
          "78:     $self->extension_data(\\%extensions);",
          "80:     print \"    Extensions Len:\".$extensions_len.\"\\n\";",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "81:     $self->ciphersuite($ciphersuite);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "100:     }",
          "102:     $data = pack('n', $self->server_version);",
          "103:     $data .= pack('n', length($extensions));",
          "104:     $data .= $extensions;",
          "105:     $self->data($data);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "107:     $data .= pack('n', $self->ciphersuite);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "114:     }",
          "115:     return $self->{server_version};",
          "116: }",
          "117: sub extension_data",
          "118: {",
          "119:     my $self = shift;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "122: sub ciphersuite",
          "123: {",
          "124:     my $self = shift;",
          "125:     if (@_) {",
          "126:       $self->{ciphersuite} = shift;",
          "127:     }",
          "128:     return $self->{ciphersuite};",
          "129: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6c62f9e1639a7d1a879f363a99882920104dfedb",
      "candidate_info": {
        "commit_hash": "6c62f9e1639a7d1a879f363a99882920104dfedb",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/6c62f9e1639a7d1a879f363a99882920104dfedb",
        "files": [
          "Configure",
          "apps/openssl.c",
          "apps/s_cb.c",
          "apps/s_client.c",
          "apps/s_server.c",
          "include/openssl/ssl.h",
          "include/openssl/ssl3.h",
          "include/openssl/tls1.h",
          "ssl/s3_lib.c",
          "ssl/ssl_err.c",
          "ssl/t1_trce.c",
          "util/mkdef.pl"
        ],
        "message": "Remove heartbeats completely\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Tim Hudson <tjh@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1669)",
        "before_after_code_files": [
          "apps/openssl.c||apps/openssl.c",
          "apps/s_cb.c||apps/s_cb.c",
          "apps/s_client.c||apps/s_client.c",
          "apps/s_server.c||apps/s_server.c",
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "include/openssl/ssl3.h||include/openssl/ssl3.h",
          "include/openssl/tls1.h||include/openssl/tls1.h",
          "ssl/s3_lib.c||ssl/s3_lib.c",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/t1_trce.c||ssl/t1_trce.c",
          "util/mkdef.pl||util/mkdef.pl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "apps/openssl.c||apps/openssl.c": [
          "File: apps/openssl.c -> apps/openssl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "628: #ifdef OPENSSL_NO_GOST",
          "629:     BIO_puts(bio_out, \"GOST\\n\");",
          "630: #endif",
          "634: #ifdef OPENSSL_NO_IDEA",
          "635:     BIO_puts(bio_out, \"IDEA\\n\");",
          "636: #endif",
          "",
          "[Removed Lines]",
          "631: #ifdef OPENSSL_NO_HEARTBEATS",
          "632:     BIO_puts(bio_out, \"HEARTBEATS\\n\");",
          "633: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "apps/s_cb.c||apps/s_cb.c": [
          "File: apps/s_cb.c -> apps/s_cb.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "555:         case 23:",
          "556:             str_content_type = \"ApplicationData\";",
          "557:             break;",
          "574:         }",
          "575:     }",
          "",
          "[Removed Lines]",
          "558: #ifndef OPENSSL_NO_HEARTBEATS",
          "559:         case 24:",
          "560:             str_details1 = \", Heartbeat\";",
          "562:             if (len > 0) {",
          "563:                 switch (bp[0]) {",
          "564:                 case 1:",
          "565:                     str_details1 = \", HeartbeatRequest\";",
          "566:                     break;",
          "567:                 case 2:",
          "568:                     str_details1 = \", HeartbeatResponse\";",
          "569:                     break;",
          "570:                 }",
          "571:             }",
          "572:             break;",
          "573: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "611:     {\"SRP\", TLSEXT_TYPE_srp},",
          "612:     {\"signature algorithms\", TLSEXT_TYPE_signature_algorithms},",
          "613:     {\"use SRTP\", TLSEXT_TYPE_use_srtp},",
          "615:     {\"session ticket\", TLSEXT_TYPE_session_ticket},",
          "616:     {\"renegotiation info\", TLSEXT_TYPE_renegotiate},",
          "617:     {\"signed certificate timestamps\", TLSEXT_TYPE_signed_certificate_timestamp},",
          "",
          "[Removed Lines]",
          "614:     {\"heartbeat\", TLSEXT_TYPE_heartbeat},",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "apps/s_client.c||apps/s_client.c": [
          "File: apps/s_client.c -> apps/s_client.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2448:                 SSL_renegotiate(con);",
          "2449:                 cbuf_len = 0;",
          "2450:             }",
          "2458:             else {",
          "2459:                 cbuf_len = i;",
          "2460:                 cbuf_off = 0;",
          "",
          "[Removed Lines]",
          "2451: #ifndef OPENSSL_NO_HEARTBEATS",
          "2452:             else if ((!c_ign_eof) && (cbuf[0] == 'B' && cmdletters)) {",
          "2453:                 BIO_printf(bio_err, \"HEARTBEATING\\n\");",
          "2454:                 SSL_heartbeat(con);",
          "2455:                 cbuf_len = 0;",
          "2456:             }",
          "2457: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "apps/s_server.c||apps/s_server.c": [
          "File: apps/s_server.c -> apps/s_server.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2227:                     goto err;",
          "2228:                 }",
          "2237:                 if ((buf[0] == 'r') && ((buf[1] == '\\n') || (buf[1] == '\\r'))) {",
          "2238:                     SSL_renegotiate(con);",
          "2239:                     i = SSL_do_handshake(con);",
          "",
          "[Removed Lines]",
          "2229: #ifndef OPENSSL_NO_HEARTBEATS",
          "2230:                 if ((buf[0] == 'B') && ((buf[1] == '\\n') || (buf[1] == '\\r'))) {",
          "2231:                     BIO_printf(bio_err, \"HEARTBEATING\\n\");",
          "2232:                     SSL_heartbeat(con);",
          "2233:                     i = 0;",
          "2234:                     continue;",
          "2235:                 }",
          "2236: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "509: # define SSL_get_secure_renegotiation_support(ssl) \\",
          "510:         SSL_ctrl((ssl), SSL_CTRL_GET_RI_SUPPORT, 0, NULL)",
          "517: # define SSL_CTX_set_cert_flags(ctx,op) \\",
          "518:         SSL_CTX_ctrl((ctx),SSL_CTRL_CERT_FLAGS,(op),NULL)",
          "519: # define SSL_set_cert_flags(s,op) \\",
          "",
          "[Removed Lines]",
          "512: # ifndef OPENSSL_NO_HEARTBEATS",
          "513: #  define SSL_heartbeat(ssl) \\",
          "514:         SSL_ctrl((ssl),SSL_CTRL_DTLS_EXT_SEND_HEARTBEAT,0,NULL)",
          "515: # endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1095: # define SSL_CTRL_SET_TLS_EXT_SRP_USERNAME               79",
          "1096: # define SSL_CTRL_SET_TLS_EXT_SRP_STRENGTH               80",
          "1097: # define SSL_CTRL_SET_TLS_EXT_SRP_PASSWORD               81",
          "1103: # define DTLS_CTRL_GET_TIMEOUT           73",
          "1104: # define DTLS_CTRL_HANDLE_TIMEOUT        74",
          "1105: # define SSL_CTRL_GET_RI_SUPPORT                 76",
          "",
          "[Removed Lines]",
          "1098: # ifndef OPENSSL_NO_HEARTBEATS",
          "1099: #  define SSL_CTRL_DTLS_EXT_SEND_HEARTBEAT               85",
          "1100: #  define SSL_CTRL_GET_DTLS_EXT_HEARTBEAT_PENDING        86",
          "1101: #  define SSL_CTRL_SET_DTLS_EXT_HEARTBEAT_NO_REQUESTS    87",
          "1102: # endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2085: # define SSL_F_DO_SSL3_WRITE                              104",
          "2086: # define SSL_F_DTLS1_BUFFER_RECORD                        247",
          "2087: # define SSL_F_DTLS1_CHECK_TIMEOUT_NUM                    318",
          "2089: # define SSL_F_DTLS1_PREPROCESS_FRAGMENT                  288",
          "2090: # define SSL_F_DTLS1_PROCESS_BUFFERED_RECORDS             424",
          "2091: # define SSL_F_DTLS1_PROCESS_RECORD                       257",
          "",
          "[Removed Lines]",
          "2088: # define SSL_F_DTLS1_HEARTBEAT                            305",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2510: # define SSL_R_TLSV1_CERTIFICATE_UNOBTAINABLE             1111",
          "2511: # define SSL_R_TLSV1_UNRECOGNIZED_NAME                    1112",
          "2512: # define SSL_R_TLSV1_UNSUPPORTED_EXTENSION                1110",
          "2515: # define SSL_R_TLS_ILLEGAL_EXPORTER_LABEL                 367",
          "2516: # define SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST             157",
          "2517: # define SSL_R_TOO_MANY_WARN_ALERTS                       409",
          "",
          "[Removed Lines]",
          "2513: # define SSL_R_TLS_HEARTBEAT_PEER_DOESNT_ACCEPT           365",
          "2514: # define SSL_R_TLS_HEARTBEAT_PENDING                      366",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "include/openssl/ssl3.h||include/openssl/ssl3.h": [
          "File: include/openssl/ssl3.h -> include/openssl/ssl3.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "204: # define SSL3_RT_ALERT                   21",
          "205: # define SSL3_RT_HANDSHAKE               22",
          "206: # define SSL3_RT_APPLICATION_DATA        23",
          "210: # define TLS1_RT_CRYPTO                  0x1000",
          "",
          "[Removed Lines]",
          "207: # define DTLS1_RT_HEARTBEAT              24",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "include/openssl/tls1.h||include/openssl/tls1.h": [
          "File: include/openssl/tls1.h -> include/openssl/tls1.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "147: # define TLSEXT_TYPE_use_srtp    14",
          "153: # define TLSEXT_TYPE_application_layer_protocol_negotiation 16",
          "",
          "[Removed Lines]",
          "150: # define TLSEXT_TYPE_heartbeat   15",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "325: # define SSL_CTX_set_tlsext_ticket_key_cb(ssl, cb) \\",
          "326: SSL_CTX_callback_ctrl(ssl,SSL_CTRL_SET_TLSEXT_TICKET_KEY_CB,(void (*)(void))cb)",
          "358: # define TLS1_CK_PSK_WITH_RC4_128_SHA                    0x0300008A",
          "359: # define TLS1_CK_PSK_WITH_3DES_EDE_CBC_SHA               0x0300008B",
          "",
          "[Removed Lines]",
          "328: # ifndef OPENSSL_NO_HEARTBEATS",
          "329: #  define SSL_DTLSEXT_HB_ENABLED                   0x01",
          "330: #  define SSL_DTLSEXT_HB_DONT_SEND_REQUESTS        0x02",
          "331: #  define SSL_DTLSEXT_HB_DONT_RECV_REQUESTS        0x04",
          "332: #  define SSL_get_dtlsext_heartbeat_pending(ssl) \\",
          "333:         SSL_ctrl((ssl),SSL_CTRL_GET_DTLS_EXT_HEARTBEAT_PENDING,0,NULL)",
          "334: #  define SSL_set_dtlsext_heartbeat_no_requests(ssl, arg) \\",
          "335:         SSL_ctrl((ssl),SSL_CTRL_SET_DTLS_EXT_HEARTBEAT_NO_REQUESTS,arg,NULL)",
          "337: #  if OPENSSL_API_COMPAT < 0x10100000L",
          "338: #   define SSL_CTRL_TLS_EXT_SEND_HEARTBEAT \\",
          "339:         SSL_CTRL_DTLS_EXT_SEND_HEARTBEAT",
          "340: #   define SSL_CTRL_GET_TLS_EXT_HEARTBEAT_PENDING \\",
          "341:         SSL_CTRL_GET_DTLS_EXT_HEARTBEAT_PENDING",
          "342: #   define SSL_CTRL_SET_TLS_EXT_HEARTBEAT_NO_REQUESTS \\",
          "343:         SSL_CTRL_SET_DTLS_EXT_HEARTBEAT_NO_REQUESTS",
          "344: #   define SSL_TLSEXT_HB_ENABLED \\",
          "345:         SSL_DTLSEXT_HB_ENABLED",
          "346: #   define SSL_TLSEXT_HB_DONT_SEND_REQUESTS \\",
          "347:         SSL_DTLSEXT_HB_DONT_SEND_REQUESTS",
          "348: #   define SSL_TLSEXT_HB_DONT_RECV_REQUESTS \\",
          "349:         SSL_DTLSEXT_HB_DONT_RECV_REQUESTS",
          "350: #   define SSL_get_tlsext_heartbeat_pending(ssl) \\",
          "351:         SSL_get_dtlsext_heartbeat_pending(ssl)",
          "352: #   define SSL_set_tlsext_heartbeat_no_requests(ssl, arg) \\",
          "353:         SSL_set_dtlsext_heartbeat_no_requests(ssl, arg)",
          "354: #  endif",
          "355: # endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ssl/s3_lib.c||ssl/s3_lib.c": [
          "File: ssl/s3_lib.c -> ssl/s3_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3047:         ret = 1;",
          "3048:         break;",
          "3057:     case SSL_CTRL_CHAIN:",
          "3058:         if (larg)",
          "3059:             return ssl_cert_set1_chain(s, NULL, (STACK_OF(X509) *)parg);",
          "",
          "[Removed Lines]",
          "3050: #ifndef OPENSSL_NO_HEARTBEATS",
          "3051:     case SSL_CTRL_DTLS_EXT_SEND_HEARTBEAT:",
          "3052:     case SSL_CTRL_GET_DTLS_EXT_HEARTBEAT_PENDING:",
          "3053:     case SSL_CTRL_SET_DTLS_EXT_HEARTBEAT_NO_REQUESTS:",
          "3054:         break;",
          "3055: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "30:     {ERR_FUNC(SSL_F_DO_SSL3_WRITE), \"do_ssl3_write\"},",
          "31:     {ERR_FUNC(SSL_F_DTLS1_BUFFER_RECORD), \"dtls1_buffer_record\"},",
          "32:     {ERR_FUNC(SSL_F_DTLS1_CHECK_TIMEOUT_NUM), \"dtls1_check_timeout_num\"},",
          "34:     {ERR_FUNC(SSL_F_DTLS1_PREPROCESS_FRAGMENT), \"dtls1_preprocess_fragment\"},",
          "35:     {ERR_FUNC(SSL_F_DTLS1_PROCESS_BUFFERED_RECORDS),",
          "36:      \"dtls1_process_buffered_records\"},",
          "",
          "[Removed Lines]",
          "33:     {ERR_FUNC(SSL_F_DTLS1_HEARTBEAT), \"dtls1_heartbeat\"},",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "620:     {ERR_REASON(SSL_R_TLSV1_UNRECOGNIZED_NAME), \"tlsv1 unrecognized name\"},",
          "621:     {ERR_REASON(SSL_R_TLSV1_UNSUPPORTED_EXTENSION),",
          "622:      \"tlsv1 unsupported extension\"},",
          "627:     {ERR_REASON(SSL_R_TLS_ILLEGAL_EXPORTER_LABEL),",
          "628:      \"tls illegal exporter label\"},",
          "629:     {ERR_REASON(SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST),",
          "",
          "[Removed Lines]",
          "623:     {ERR_REASON(SSL_R_TLS_HEARTBEAT_PEER_DOESNT_ACCEPT),",
          "624:      \"peer does not accept heartbeats\"},",
          "625:     {ERR_REASON(SSL_R_TLS_HEARTBEAT_PENDING),",
          "626:      \"heartbeat request already pending\"},",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ssl/t1_trce.c||ssl/t1_trce.c": [
          "File: ssl/t1_trce.c -> ssl/t1_trce.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "710:         }",
          "711:         break;",
          "716:     case TLSEXT_TYPE_session_ticket:",
          "717:         if (extlen != 0)",
          "718:             ssl_print_hex(bio, indent + 4, \"ticket\", ext, extlen);",
          "",
          "[Removed Lines]",
          "713:     case TLSEXT_TYPE_heartbeat:",
          "714:         return 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "util/mkdef.pl||util/mkdef.pl": [
          "File: util/mkdef.pl -> util/mkdef.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "101:     # RFC3779",
          "102:     \"RFC3779\",",
          "103:     # TLS",
          "105:     # CMS",
          "106:     \"CMS\",",
          "107:                          \"OCSP\",",
          "",
          "[Removed Lines]",
          "104:     \"PSK\", \"SRP\", \"HEARTBEATS\",",
          "",
          "[Added Lines]",
          "104:     \"PSK\", \"SRP\",",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b6fdc12d94d7527c3018492ab838cbcda81ba346",
      "candidate_info": {
        "commit_hash": "b6fdc12d94d7527c3018492ab838cbcda81ba346",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/b6fdc12d94d7527c3018492ab838cbcda81ba346",
        "files": [
          "include/openssl/ssl.h",
          "ssl/ssl_err.c",
          "ssl/statem/extensions.c",
          "ssl/statem/extensions_srvr.c"
        ],
        "message": "Send a missing_extension alert if key_share/supported groups not present\n\nOnly applies if we're not doing psk.\n\nReviewed-by: Tim Hudson <tjh@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3436)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/statem/extensions.c||ssl/statem/extensions.c",
          "ssl/statem/extensions_srvr.c||ssl/statem/extensions_srvr.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2675: # define SSL_R_MISSING_RSA_SIGNING_CERT                   170",
          "2676: # define SSL_R_MISSING_SIGALGS_EXTENSION                  112",
          "2677: # define SSL_R_MISSING_SRP_PARAM                          358",
          "2678: # define SSL_R_MISSING_TMP_DH_KEY                         171",
          "2679: # define SSL_R_MISSING_TMP_ECDH_KEY                       311",
          "2680: # define SSL_R_NOT_ON_RECORD_BOUNDARY                     182",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2678: # define SSL_R_MISSING_SUPPORTED_GROUPS_EXTENSION         209",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "641:     {ERR_REASON(SSL_R_MISSING_SIGALGS_EXTENSION),",
          "642:      \"missing sigalgs extension\"},",
          "643:     {ERR_REASON(SSL_R_MISSING_SRP_PARAM), \"can't find SRP server param\"},",
          "644:     {ERR_REASON(SSL_R_MISSING_TMP_DH_KEY), \"missing tmp dh key\"},",
          "645:     {ERR_REASON(SSL_R_MISSING_TMP_ECDH_KEY), \"missing tmp ecdh key\"},",
          "646:     {ERR_REASON(SSL_R_NOT_ON_RECORD_BOUNDARY), \"not on record boundary\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "644:     {ERR_REASON(SSL_R_MISSING_SUPPORTED_GROUPS_EXTENSION),",
          "645:      \"missing supported groups extension\"},",
          "",
          "---------------"
        ],
        "ssl/statem/extensions.c||ssl/statem/extensions.c": [
          "File: ssl/statem/extensions.c -> ssl/statem/extensions.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1151:         if (!s->hit",
          "1152:                 || (s->ext.psk_kex_mode & TLSEXT_KEX_MODE_FLAG_KE) == 0) {",
          "1155:             SSLerr(SSL_F_FINAL_KEY_SHARE, SSL_R_NO_SUITABLE_KEY_SHARE);",
          "1156:             return 0;",
          "1157:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1154:             if (!sent)",
          "1156:             else",
          "",
          "---------------"
        ],
        "ssl/statem/extensions_srvr.c||ssl/statem/extensions_srvr.c": [
          "File: ssl/statem/extensions_srvr.c -> ssl/statem/extensions_srvr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "524:         return 0;",
          "525:     }",
          "532:     if (!tls1_get_curvelist(s, 1, &clntcurves, &clnt_num_curves)) {",
          "534:         SSLerr(SSL_F_TLS_PARSE_CTOS_KEY_SHARE, ERR_R_INTERNAL_ERROR);",
          "535:         return 0;",
          "536:     }",
          "538:     while (PACKET_remaining(&key_share_list) > 0) {",
          "539:         if (!PACKET_get_net_2(&key_share_list, &group_id)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "533:     if (clnt_num_curves == 0) {",
          "540:         SSLerr(SSL_F_TLS_PARSE_CTOS_KEY_SHARE,",
          "541:                SSL_R_MISSING_SUPPORTED_GROUPS_EXTENSION);",
          "542:         return 0;",
          "543:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}