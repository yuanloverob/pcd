{
  "cve_id": "CVE-2016-2108",
  "cve_desc": "The ASN.1 implementation in OpenSSL before 1.0.1o and 1.0.2 before 1.0.2c allows remote attackers to execute arbitrary code or cause a denial of service (buffer underflow and memory corruption) via an ANY field in crafted serialized data, aka the \"negative zero\" issue.",
  "repo": "openssl/openssl",
  "patch_hash": "a0eed48d37a4b7beea0c966caf09ad46f4a92a44",
  "patch_info": {
    "commit_hash": "a0eed48d37a4b7beea0c966caf09ad46f4a92a44",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/a0eed48d37a4b7beea0c966caf09ad46f4a92a44",
    "files": [
      "crypto/asn1/a_int.c"
    ],
    "message": "Fix encoding bug in i2c_ASN1_INTEGER\n\nFix bug where i2c_ASN1_INTEGER mishandles zero if it is marked as\nnegative.\n\nThanks to Huzaifa Sidhpurwala <huzaifas@redhat.com> and\nHanno B\u00f6ck <hanno@hboeck.de> for reporting this issue.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
    ]
  },
  "patch_diff": {
    "crypto/asn1/a_int.c||crypto/asn1/a_int.c": [
      "File: crypto/asn1/a_int.c -> crypto/asn1/a_int.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "125:     else {",
      "126:         ret = a->length;",
      "127:         i = a->data[0];",
      "128:         if (!neg && (i > 127)) {",
      "129:             pad = 1;",
      "130:             pb = 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "128:         if (ret == 1 && i == 0)",
      "129:             neg = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "163:         p += a->length - 1;",
      "164:         i = a->length;",
      "168:             n--;",
      "169:             i--;",
      "",
      "[Removed Lines]",
      "166:         while (!*n) {",
      "",
      "[Added Lines]",
      "168:         while (!*n && i > 1) {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "418:         ASN1err(ASN1_F_BN_TO_ASN1_INTEGER, ERR_R_NESTED_ASN1_ERROR);",
      "419:         goto err;",
      "420:     }",
      "422:         ret->type = V_ASN1_NEG_INTEGER;",
      "423:     else",
      "424:         ret->type = V_ASN1_INTEGER;",
      "",
      "[Removed Lines]",
      "421:     if (BN_is_negative(bn))",
      "",
      "[Added Lines]",
      "423:     if (BN_is_negative(bn) && !BN_is_zero(bn))",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "32d3b0f52f77ce86d53f38685336668d47c5bdfe",
      "candidate_info": {
        "commit_hash": "32d3b0f52f77ce86d53f38685336668d47c5bdfe",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/32d3b0f52f77ce86d53f38685336668d47c5bdfe",
        "files": [
          "crypto/asn1/a_int.c"
        ],
        "message": "Fix encoding bug in i2c_ASN1_INTEGER\n\nFix bug where i2c_ASN1_INTEGER mishandles zero if it is marked as\nnegative.\n\nThanks to Huzaifa Sidhpurwala <huzaifas@redhat.com> and\nHanno B\u00f6ck <hanno@hboeck.de> for reporting this issue.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit a0eed48d37a4b7beea0c966caf09ad46f4a92a44)",
        "before_after_code_files": [
          "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
          ],
          "candidate": [
            "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/asn1/a_int.c||crypto/asn1/a_int.c": [
          "File: crypto/asn1/a_int.c -> crypto/asn1/a_int.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "124:     else {",
          "125:         ret = a->length;",
          "126:         i = a->data[0];",
          "127:         if (!neg && (i > 127)) {",
          "128:             pad = 1;",
          "129:             pb = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "127:         if (ret == 1 && i == 0)",
          "128:             neg = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "162:         p += a->length - 1;",
          "163:         i = a->length;",
          "167:             n--;",
          "168:             i--;",
          "",
          "[Removed Lines]",
          "165:         while (!*n) {",
          "",
          "[Added Lines]",
          "167:         while (!*n && i > 1) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "419:         ASN1err(ASN1_F_BN_TO_ASN1_INTEGER, ERR_R_NESTED_ASN1_ERROR);",
          "420:         goto err;",
          "421:     }",
          "423:         ret->type = V_ASN1_NEG_INTEGER;",
          "424:     else",
          "425:         ret->type = V_ASN1_INTEGER;",
          "",
          "[Removed Lines]",
          "422:     if (BN_is_negative(bn))",
          "",
          "[Added Lines]",
          "424:     if (BN_is_negative(bn) && !BN_is_zero(bn))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a6202a74f9fd459607adaec9e4c7aa8d103dbd11",
      "candidate_info": {
        "commit_hash": "a6202a74f9fd459607adaec9e4c7aa8d103dbd11",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/a6202a74f9fd459607adaec9e4c7aa8d103dbd11",
        "files": [
          "crypto/asn1/a_int.c"
        ],
        "message": "Fix encoding bug in i2c_ASN1_INTEGER\n\nFix bug where i2c_ASN1_INTEGER mishandles zero if it is marked as\nnegative.\n\nThanks to Huzaifa Sidhpurwala <huzaifas@redhat.com> and\nHanno B\u00f6ck <hanno@hboeck.de> for reporting this issue.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit a0eed48d37a4b7beea0c966caf09ad46f4a92a44)",
        "before_after_code_files": [
          "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
          ],
          "candidate": [
            "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/asn1/a_int.c||crypto/asn1/a_int.c": [
          "File: crypto/asn1/a_int.c -> crypto/asn1/a_int.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "124:     else {",
          "125:         ret = a->length;",
          "126:         i = a->data[0];",
          "127:         if (!neg && (i > 127)) {",
          "128:             pad = 1;",
          "129:             pb = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "127:         if (ret == 1 && i == 0)",
          "128:             neg = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "162:         p += a->length - 1;",
          "163:         i = a->length;",
          "167:             n--;",
          "168:             i--;",
          "",
          "[Removed Lines]",
          "165:         while (!*n) {",
          "",
          "[Added Lines]",
          "167:         while (!*n && i > 1) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "419:         ASN1err(ASN1_F_BN_TO_ASN1_INTEGER, ERR_R_NESTED_ASN1_ERROR);",
          "420:         goto err;",
          "421:     }",
          "423:         ret->type = V_ASN1_NEG_INTEGER;",
          "424:     else",
          "425:         ret->type = V_ASN1_INTEGER;",
          "",
          "[Removed Lines]",
          "422:     if (BN_is_negative(bn))",
          "",
          "[Added Lines]",
          "424:     if (BN_is_negative(bn) && !BN_is_zero(bn))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "303845a3b5ee7b999bf79e2e42c1489c2cc9f371",
      "candidate_info": {
        "commit_hash": "303845a3b5ee7b999bf79e2e42c1489c2cc9f371",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/303845a3b5ee7b999bf79e2e42c1489c2cc9f371",
        "files": [
          "crypto/asn1/a_int.c"
        ],
        "message": "Fix encoding bug in i2c_ASN1_INTEGER\n\nFix bug where i2c_ASN1_INTEGER mishandles zero if it is marked as\nnegative.\n\nThanks to Huzaifa Sidhpurwala <huzaifas@redhat.com> and\nHanno B\u00f6ck <hanno@hboeck.de> for reporting this issue.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit a0eed48d37a4b7beea0c966caf09ad46f4a92a44)",
        "before_after_code_files": [
          "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
          ],
          "candidate": [
            "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/asn1/a_int.c||crypto/asn1/a_int.c": [
          "File: crypto/asn1/a_int.c -> crypto/asn1/a_int.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "124:     else {",
          "125:         ret = a->length;",
          "126:         i = a->data[0];",
          "127:         if (!neg && (i > 127)) {",
          "128:             pad = 1;",
          "129:             pb = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "127:         if (ret == 1 && i == 0)",
          "128:             neg = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "162:         p += a->length - 1;",
          "163:         i = a->length;",
          "167:             n--;",
          "168:             i--;",
          "",
          "[Removed Lines]",
          "165:         while (!*n) {",
          "",
          "[Added Lines]",
          "167:         while (!*n && i > 1) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "419:         ASN1err(ASN1_F_BN_TO_ASN1_INTEGER, ERR_R_NESTED_ASN1_ERROR);",
          "420:         goto err;",
          "421:     }",
          "423:         ret->type = V_ASN1_NEG_INTEGER;",
          "424:     else",
          "425:         ret->type = V_ASN1_INTEGER;",
          "",
          "[Removed Lines]",
          "422:     if (BN_is_negative(bn))",
          "",
          "[Added Lines]",
          "424:     if (BN_is_negative(bn) && !BN_is_zero(bn))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3661bb4e7934668bd99ca777ea8b30eedfafa871",
      "candidate_info": {
        "commit_hash": "3661bb4e7934668bd99ca777ea8b30eedfafa871",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/3661bb4e7934668bd99ca777ea8b30eedfafa871",
        "files": [
          "crypto/asn1/a_int.c"
        ],
        "message": "Fix encoding bug in i2c_ASN1_INTEGER\n\nFix bug where i2c_ASN1_INTEGER mishandles zero if it is marked as\nnegative.\n\nThanks to Huzaifa Sidhpurwala <huzaifas@redhat.com> and\nHanno B\u00f6ck <hanno@hboeck.de> for reporting this issue.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit a0eed48d37a4b7beea0c966caf09ad46f4a92a44)",
        "before_after_code_files": [
          "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
          ],
          "candidate": [
            "crypto/asn1/a_int.c||crypto/asn1/a_int.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/asn1/a_int.c||crypto/asn1/a_int.c": [
          "File: crypto/asn1/a_int.c -> crypto/asn1/a_int.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "124:     else {",
          "125:         ret = a->length;",
          "126:         i = a->data[0];",
          "127:         if (!neg && (i > 127)) {",
          "128:             pad = 1;",
          "129:             pb = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "127:         if (ret == 1 && i == 0)",
          "128:             neg = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "162:         p += a->length - 1;",
          "163:         i = a->length;",
          "167:             n--;",
          "168:             i--;",
          "",
          "[Removed Lines]",
          "165:         while (!*n) {",
          "",
          "[Added Lines]",
          "167:         while (!*n && i > 1) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "419:         ASN1err(ASN1_F_BN_TO_ASN1_INTEGER, ERR_R_NESTED_ASN1_ERROR);",
          "420:         goto err;",
          "421:     }",
          "423:         ret->type = V_ASN1_NEG_INTEGER;",
          "424:     else",
          "425:         ret->type = V_ASN1_INTEGER;",
          "",
          "[Removed Lines]",
          "422:     if (BN_is_negative(bn))",
          "",
          "[Added Lines]",
          "424:     if (BN_is_negative(bn) && !BN_is_zero(bn))",
          "",
          "---------------"
        ]
      }
    }
  ]
}