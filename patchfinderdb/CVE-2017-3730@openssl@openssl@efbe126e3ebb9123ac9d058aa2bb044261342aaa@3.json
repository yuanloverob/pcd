{
  "cve_id": "CVE-2017-3730",
  "cve_desc": "In OpenSSL 1.1.0 before 1.1.0d, if a malicious server supplies bad parameters for a DHE or ECDHE key exchange then this can result in the client attempting to dereference a NULL pointer leading to a client crash. This could be exploited in a Denial of Service attack.",
  "repo": "openssl/openssl",
  "patch_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
  "patch_info": {
    "commit_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "files": [
      "ssl/statem/statem_clnt.c"
    ],
    "message": "Fix missing NULL checks in CKE processing\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c"
    ]
  },
  "patch_diff": {
    "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
      "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2258:         return 0;",
      "2259:     }",
      "2260:     ckey = ssl_generate_pkey(skey);",
      "2261:     dh_clnt = EVP_PKEY_get0_DH(ckey);",
      "2263:     if (dh_clnt == NULL || ssl_derive(s, ckey, skey) == 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2261:     if (ckey == NULL) {",
      "2262:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_DHE, ERR_R_INTERNAL_ERROR);",
      "2263:         return 0;",
      "2264:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2296:     }",
      "2298:     ckey = ssl_generate_pkey(skey);",
      "2300:     if (ssl_derive(s, ckey, skey) == 0) {",
      "2301:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_EVP_LIB);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2304:     if (ckey == NULL) {",
      "2305:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_INTERNAL_ERROR);",
      "2306:         goto err;",
      "2307:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ebae51f4900af1fbc1e024bab44412b74fc46fa7",
      "candidate_info": {
        "commit_hash": "ebae51f4900af1fbc1e024bab44412b74fc46fa7",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/ebae51f4900af1fbc1e024bab44412b74fc46fa7",
        "files": [
          "Configurations/descrip.mms.tmpl",
          "Configurations/unix-Makefile.tmpl",
          "Configurations/windows-makefile.tmpl"
        ],
        "message": "Simplify configudata.pm dependency generation\n\nWhile we're at it, correct the fault in windows-makefile.tmpl\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\n(cherry picked from commit 41240e68d745972d56dd037caf439d9c5032813f)",
        "before_after_code_files": [
          "Configurations/descrip.mms.tmpl||Configurations/descrip.mms.tmpl",
          "Configurations/unix-Makefile.tmpl||Configurations/unix-Makefile.tmpl",
          "Configurations/windows-makefile.tmpl||Configurations/windows-makefile.tmpl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/descrip.mms.tmpl||Configurations/descrip.mms.tmpl": [
          "File: Configurations/descrip.mms.tmpl -> Configurations/descrip.mms.tmpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "509: # Building targets ###################################################",
          "512:         @ WRITE SYS$OUTPUT \"Reconfiguring...\"",
          "513:         perl $(SRCDIR)Configure reconf",
          "514:         @ WRITE SYS$OUTPUT \"*************************************************\"",
          "",
          "[Removed Lines]",
          "511: configdata.pm : $(SRCDIR)Configure $(SRCDIR)config.com {- join(\" \", @{$config{build_file_templates}}) -} {- join(\" \", @{$config{build_infos}}, @{$config{conf_files}}) -}",
          "",
          "[Added Lines]",
          "511: configdata.pm : $(SRCDIR)Configure $(SRCDIR)config.com {- join(\" \", @{$config{build_file_templates}}, @{$config{build_infos}}, @{$config{conf_files}}) -}",
          "",
          "---------------"
        ],
        "Configurations/unix-Makefile.tmpl||Configurations/unix-Makefile.tmpl": [
          "File: Configurations/unix-Makefile.tmpl -> Configurations/unix-Makefile.tmpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "827:      echo 'Version: '$(VERSION); \\",
          "828:      echo 'Requires: libssl libcrypto' ) > openssl.pc",
          "831:  @echo \"Detected changed: $?\"",
          "832:  @echo \"Reconfiguring...\"",
          "833:  $(SRCDIR)/Configure reconf",
          "",
          "[Removed Lines]",
          "830: configdata.pm: $(SRCDIR)/Configure $(SRCDIR)/config {- join(\" \", @{$config{build_file_templates}}) -} {- join(\" \", @{$config{build_infos}}, @{$config{conf_files}}) -}",
          "",
          "[Added Lines]",
          "830: configdata.pm: $(SRCDIR)/Configure $(SRCDIR)/config {- join(\" \", @{$config{build_file_templates}}, @{$config{build_infos}}, @{$config{conf_files}}) -}",
          "",
          "---------------"
        ],
        "Configurations/windows-makefile.tmpl||Configurations/windows-makefile.tmpl": [
          "File: Configurations/windows-makefile.tmpl -> Configurations/windows-makefile.tmpl",
          "--- Hunk 1 ---",
          "[Context before]",
          "323: # Building targets ###################################################",
          "326:  @echo \"Detected changed: $?\"",
          "327:  @echo \"Reconfiguring...\"",
          "328:  \"$(PERL)\" \"$(SRCDIR)\\Configure\" reconf",
          "",
          "[Removed Lines]",
          "325: configdata.pm: \"$(SRCDIR)\\Configure\" \"{- join(\" \", @{$config{build_file_templates}}) -}\" {- join(\" \", map { '\"'.$_.'\"' } @{$config{build_infos}}, @{$config{conf_files}}) -}",
          "",
          "[Added Lines]",
          "325: configdata.pm: \"$(SRCDIR)\\Configure\" {- join(\" \", map { '\"'.$_.'\"' } @{$config{build_file_templates}}, @{$config{build_infos}}, @{$config{conf_files}}) -}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "39ff4d7adde80b87c994649559921b9189b9612f",
      "candidate_info": {
        "commit_hash": "39ff4d7adde80b87c994649559921b9189b9612f",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/39ff4d7adde80b87c994649559921b9189b9612f",
        "files": [
          "crypto/asn1/a_int.c",
          "crypto/asn1/x_long.c",
          "crypto/bio/b_print.c"
        ],
        "message": "Fix VC warnings about unary minus to an unsigned type.\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\nGH: #2230\n(cherry picked from commit 68d4bcfd0651c7ea5d37ca52abc0d2e6e6b3bd20)",
        "before_after_code_files": [
          "crypto/asn1/a_int.c||crypto/asn1/a_int.c",
          "crypto/asn1/x_long.c||crypto/asn1/x_long.c",
          "crypto/bio/b_print.c||crypto/bio/b_print.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/asn1/a_int.c||crypto/asn1/a_int.c": [
          "File: crypto/asn1/a_int.c -> crypto/asn1/a_int.c"
        ],
        "crypto/asn1/x_long.c||crypto/asn1/x_long.c": [
          "File: crypto/asn1/x_long.c -> crypto/asn1/x_long.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "78:     if (ltmp < 0)",
          "80:     else",
          "81:         utmp = ltmp;",
          "82:     clen = BN_num_bits_word(utmp);",
          "",
          "[Removed Lines]",
          "79:         utmp = -(unsigned long)ltmp - 1;",
          "",
          "[Added Lines]",
          "79:         utmp = 0 - (unsigned long)ltmp - 1;",
          "",
          "---------------"
        ],
        "crypto/bio/b_print.c||crypto/bio/b_print.c": [
          "File: crypto/bio/b_print.c -> crypto/bio/b_print.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "451:     if (!(flags & DP_F_UNSIGNED)) {",
          "452:         if (value < 0) {",
          "453:             signvalue = '-';",
          "455:         } else if (flags & DP_F_PLUS)",
          "456:             signvalue = '+';",
          "457:         else if (flags & DP_F_SPACE)",
          "",
          "[Removed Lines]",
          "454:             uvalue = -(unsigned LLONG)value;",
          "",
          "[Added Lines]",
          "454:             uvalue = 0 - (unsigned LLONG)value;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "51d8e5ea866a7d606e4f2aa5e45c2f7df2270ace",
      "candidate_info": {
        "commit_hash": "51d8e5ea866a7d606e4f2aa5e45c2f7df2270ace",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/51d8e5ea866a7d606e4f2aa5e45c2f7df2270ace",
        "files": [
          "Configurations/00-base-templates.conf"
        ],
        "message": "Windows: use default ZLIB1 unless --with-zlib-lib is set\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/1772)\n(cherry picked from commit 475592e2419c5cb3098dfea4c9229d0c09ea7010)",
        "before_after_code_files": [
          "Configurations/00-base-templates.conf||Configurations/00-base-templates.conf"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "Configurations/00-base-templates.conf||Configurations/00-base-templates.conf": [
          "File: Configurations/00-base-templates.conf -> Configurations/00-base-templates.conf",
          "--- Hunk 1 ---",
          "[Context before]",
          "80:             sub {",
          "81:                 unless ($disabled{zlib}) {",
          "82:                     if (defined($disabled{\"zlib-dynamic\"})) {",
          "84:                     }",
          "85:                 }",
          "88:         ld              => \"link\",",
          "89:         lflags          => \"/nologo\",",
          "",
          "[Removed Lines]",
          "83:                         return $withargs{zlib_lib};",
          "86:                 return (); },",
          "",
          "[Added Lines]",
          "83:                         return $withargs{zlib_lib} // \"ZLIB1\";",
          "86:                 return ();",
          "87:             },",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a12778be1782bb63055e7641c814d4fce1775e57",
      "candidate_info": {
        "commit_hash": "a12778be1782bb63055e7641c814d4fce1775e57",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/a12778be1782bb63055e7641c814d4fce1775e57",
        "files": [
          "CHANGES",
          "NEWS",
          "README",
          "include/openssl/opensslv.h"
        ],
        "message": "Prepare for 1.1.0c-dev\n\nReviewed-by: Richard Levitte <levitte@openssl.org>",
        "before_after_code_files": [
          "include/openssl/opensslv.h||include/openssl/opensslv.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "include/openssl/opensslv.h||include/openssl/opensslv.h": [
          "File: include/openssl/opensslv.h -> include/openssl/opensslv.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "43: # ifdef OPENSSL_FIPS",
          "45: # else",
          "47: # endif",
          "",
          "[Removed Lines]",
          "42: # define OPENSSL_VERSION_NUMBER  0x1010002fL",
          "44: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0b-fips  26 Sep 2016\"",
          "46: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0b  26 Sep 2016\"",
          "",
          "[Added Lines]",
          "42: # define OPENSSL_VERSION_NUMBER  0x10100030L",
          "44: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0c-fips-dev  xx XXX xxxx\"",
          "46: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0c-dev  xx XXX xxxx\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "955286c9f38c11b8be719d632fa9267eb13467f8",
      "candidate_info": {
        "commit_hash": "955286c9f38c11b8be719d632fa9267eb13467f8",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/955286c9f38c11b8be719d632fa9267eb13467f8",
        "files": [
          "crypto/async/async_wait.c"
        ],
        "message": "Further improvements to ASYNC_WAIT_CTX_clear_fd\n\nRemove call to cleanup function\nUse only one loop to find previous element\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2581)\n(cherry picked from commit 219aa86cb04e1bfc9c156fab18da2f767502afb2)",
        "before_after_code_files": [
          "crypto/async/async_wait.c||crypto/async/async_wait.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/async/async_wait.c||crypto/async/async_wait.c": [
          "File: crypto/async/async_wait.c -> crypto/async/async_wait.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "139: int ASYNC_WAIT_CTX_clear_fd(ASYNC_WAIT_CTX *ctx, const void *key)",
          "140: {",
          "143:     curr = ctx->fds;",
          "144:     while (curr != NULL) {",
          "147:             curr = curr->next;",
          "148:             continue;",
          "",
          "[Removed Lines]",
          "141:     struct fd_lookup_st *curr;",
          "145:         if (curr->del) {",
          "",
          "[Added Lines]",
          "141:     struct fd_lookup_st *curr, *prev;",
          "144:     prev = NULL;",
          "146:         if (curr->del == 1) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "152:             if (curr->add == 1) {",
          "153:                 if (ctx->fds == curr) {",
          "154:                     ctx->fds = curr->next;",
          "164:                     prev->next = curr->next;",
          "165:                 }",
          "173:                 OPENSSL_free(curr);",
          "174:                 ctx->numadd--;",
          "175:                 return 1;",
          "",
          "[Removed Lines]",
          "155:                 }",
          "156:                 else {",
          "157:                     struct fd_lookup_st *prev = ctx->fds;",
          "158:                     while (prev->next != curr && prev->next != NULL) {",
          "159:                         prev = prev->next;",
          "160:                     }",
          "161:                     if (prev->next == NULL) {",
          "162:                         return 1;",
          "163:                     }",
          "171:                 if (curr->cleanup != NULL)",
          "172:                     curr->cleanup(ctx, curr->key, curr->fd, curr->custom_data);",
          "",
          "[Added Lines]",
          "156:                 } else {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "184:             ctx->numdel++;",
          "185:             return 1;",
          "186:         }",
          "187:         curr = curr->next;",
          "188:     }",
          "189:     return 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "177:         prev = curr;",
          "",
          "---------------"
        ]
      }
    }
  ]
}