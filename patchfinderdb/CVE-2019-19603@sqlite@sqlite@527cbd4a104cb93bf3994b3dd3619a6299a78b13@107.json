{
  "cve_id": "CVE-2019-19603",
  "cve_desc": "SQLite 3.30.1 mishandles certain SELECT statements with a nonexistent VIEW, leading to an application crash.",
  "repo": "sqlite/sqlite",
  "patch_hash": "527cbd4a104cb93bf3994b3dd3619a6299a78b13",
  "patch_info": {
    "commit_hash": "527cbd4a104cb93bf3994b3dd3619a6299a78b13",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/527cbd4a104cb93bf3994b3dd3619a6299a78b13",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/build.c",
      "src/sqliteInt.h",
      "test/altertab.test"
    ],
    "message": "Do not allow CREATE TABLE or CREATE VIEW of an object with a name that looks like a shadow table name.\n\nFossilOrigin-Name: 6aef58b629d89955f85f65191ba2be67b2adfac4f0327fe9a7141cb2705dbc00",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/build.c||src/build.c",
      "src/sqliteInt.h||src/sqliteInt.h",
      "test/altertab.test||test/altertab.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 8ad34d36a141fa8f5d9bd784dfeb892c983897a6dc6b867607cc668508acf944",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/build.c||src/build.c": [
      "File: src/build.c -> src/build.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "856:       }",
      "857:     }",
      "858:   }else{",
      "861:     ){",
      "862:       sqlite3ErrorMsg(pParse, \"object name reserved for internal use: %s\",",
      "863:                       zName);",
      "864:       return SQLITE_ERROR;",
      "865:     }",
      "866:   }",
      "867:   return SQLITE_OK;",
      "868: }",
      "",
      "[Removed Lines]",
      "859:     if( pParse->nested==0",
      "860:      && 0==sqlite3StrNICmp(zName, \"sqlite_\", 7)",
      "",
      "[Added Lines]",
      "859:     if( (pParse->nested==0 && 0==sqlite3StrNICmp(zName, \"sqlite_\", 7))",
      "860:      || (sqlite3ReadOnlyShadowTables(db) && sqlite3ShadowTableName(db, zName))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "2132: static int isShadowTableName(sqlite3 *db, char *zName){",
      "",
      "[Added Lines]",
      "2133: int sqlite3ShadowTableName(sqlite3 *db, const char *zName){",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "2147:   if( pMod->pModule->xShadowName==0 ) return 0;",
      "2148:   return pMod->pModule->xShadowName(zTail+1);",
      "2149: }",
      "",
      "[Removed Lines]",
      "2150: #else",
      "2151: # define isShadowTableName(x,y) 0",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "2190:   p = pParse->pNewTable;",
      "2191:   if( p==0 ) return;",
      "2194:     p->tabFlags |= TF_Shadow;",
      "2195:   }",
      "",
      "[Removed Lines]",
      "2193:   if( pSelect==0 && isShadowTableName(db, p->zName) ){",
      "",
      "[Added Lines]",
      "2192:   if( pSelect==0 && sqlite3ShadowTableName(db, p->zName) ){",
      "",
      "---------------"
    ],
    "src/sqliteInt.h||src/sqliteInt.h": [
      "File: src/sqliteInt.h -> src/sqliteInt.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "4548: #  define sqlite3VtabInSync(db) ((db)->nVTrans>0 && (db)->aVTrans==0)",
      "4549: #endif",
      "4550: int sqlite3ReadOnlyShadowTables(sqlite3 *db);",
      "4551: int sqlite3VtabEponymousTableInit(Parse*,Module*);",
      "4552: void sqlite3VtabEponymousTableClear(sqlite3*,Module*);",
      "4553: void sqlite3VtabMakeWritable(Parse*,Table*);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4551: #ifndef SQLITE_OMIT_VIRTUALTABLE",
      "4552:   int sqlite3ShadowTableName(sqlite3 *db, const char *zName);",
      "4553: #else",
      "4554: # define sqlite3ShadowTableName(A,B) 0",
      "4555: #endif",
      "",
      "---------------"
    ],
    "test/altertab.test||test/altertab.test": [
      "File: test/altertab.test -> test/altertab.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "547:   } {1 {table y1_segments may not be modified}}",
      "549:   do_catchsql_test 16.20 {",
      "554:     DROP TABLE y1_segments;",
      "555:   } {1 {table y1_segments may not be dropped}}",
      "557:   do_execsql_test 16.30 {",
      "558:     ALTER TABLE y1 RENAME TO z1;",
      "559:   }",
      "",
      "[Removed Lines]",
      "550:     ALTER TABLE y1_segments RENAME TO abc;",
      "551:   } {1 {table y1_segments may not be altered}}",
      "553:   do_catchsql_test 16.21 {",
      "",
      "[Added Lines]",
      "553:   do_catchsql_test 16.20 {",
      "554:     ALTER TABLE y1_segments RENAME TO abc;",
      "555:   } {1 {table y1_segments may not be altered}}",
      "556:   sqlite3_db_config db DEFENSIVE 0",
      "557:   do_catchsql_test 16.22 {",
      "558:     ALTER TABLE y1_segments RENAME TO abc;",
      "559:   } {0 {}}",
      "560:   sqlite3_db_config db DEFENSIVE 1",
      "561:   do_catchsql_test 16.23 {",
      "562:     CREATE TABLE y1_segments AS SELECT * FROM abc;",
      "563:   } {1 {object name reserved for internal use: y1_segments}}",
      "564:   do_catchsql_test 16.24 {",
      "565:     CREATE VIEW y1_segments AS SELECT * FROM abc;",
      "566:   } {1 {object name reserved for internal use: y1_segments}}",
      "567:   sqlite3_db_config db DEFENSIVE 0",
      "568:   do_catchsql_test 16.25 {",
      "569:     ALTER TABLE abc RENAME TO y1_segments;",
      "570:   } {0 {}}",
      "571:   sqlite3_db_config db DEFENSIVE 1",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c49d43a787ae451df9e5483f6cef5f41aa95ed84",
      "candidate_info": {
        "commit_hash": "c49d43a787ae451df9e5483f6cef5f41aa95ed84",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/c49d43a787ae451df9e5483f6cef5f41aa95ed84",
        "files": [
          "ext/fts3/fts3_write.c",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Fix the fts3DecodeIntArray() function so that it will not read off the end of the buffer it is handed.  Any unread integers are set to zero.\n\nFossilOrigin-Name: 666cf8f6b39ae1f72e82b45e9cacba23caf61370ca0c695b3b14452accbb1a0d",
        "before_after_code_files": [
          "ext/fts3/fts3_write.c||ext/fts3/fts3_write.c",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/fts3/fts3_write.c||ext/fts3/fts3_write.c": [
          "File: ext/fts3/fts3_write.c -> ext/fts3/fts3_write.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3329: ){",
          "3337:   }",
          "3338: }",
          "",
          "[Removed Lines]",
          "3330:   int i, j;",
          "3331:   UNUSED_PARAMETER(nBuf);",
          "3332:   for(i=j=0; i<N; i++){",
          "3333:     sqlite3_int64 x;",
          "3334:     j += sqlite3Fts3GetVarint(&zBuf[j], &x);",
          "3335:     assert(j<=nBuf);",
          "3336:     a[i] = (u32)(x & 0xffffffff);",
          "",
          "[Added Lines]",
          "3330:   int i = 0;",
          "3331:   if( nBuf && (zBuf[nBuf-1]&0x80)==0 ){",
          "3332:     int j;",
          "3333:     for(i=j=0; i<N && j<nBuf; i++){",
          "3334:       sqlite3_int64 x;",
          "3335:       j += sqlite3Fts3GetVarint(&zBuf[j], &x);",
          "3336:       a[i] = (u32)(x & 0xffffffff);",
          "3337:     }",
          "3339:   while( i<N ) a[i++] = 0;",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 931278b257b12ac14fc8fbc82c6dc88ce4ac4b8e0d668543e68f0289d825daa1",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5978a7a525c58e1402b87ba957d287f650e0f9ab",
      "candidate_info": {
        "commit_hash": "5978a7a525c58e1402b87ba957d287f650e0f9ab",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/5978a7a525c58e1402b87ba957d287f650e0f9ab",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/build.c",
          "src/insert.c",
          "src/select.c",
          "src/sqliteInt.h",
          "src/window.c",
          "test/view.test",
          "test/window9.test"
        ],
        "message": "Ensure that columns of views and sub-queries that are expressions with no affinity are not assigned BLOB affinity. This matches the documentation. Fix for [61c853857f40da49].\n\nFossilOrigin-Name: e15a0977ddfad3d0f4c7654c5665ff10830c25b20ecf6ef500b1ba23fb89e31f",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/build.c||src/build.c",
          "src/insert.c||src/insert.c",
          "src/select.c||src/select.c",
          "src/sqliteInt.h||src/sqliteInt.h",
          "src/window.c||src/window.c",
          "test/view.test||test/view.test",
          "test/window9.test||test/window9.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid",
            "src/build.c||src/build.c",
            "src/sqliteInt.h||src/sqliteInt.h"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid",
            "src/build.c||src/build.c",
            "src/sqliteInt.h||src/sqliteInt.h"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: a29f2a7d07beff64e489e8f824babc6228c4a499fadc0ee701caa60a63baadcd",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/build.c||src/build.c": [
          "File: src/build.c -> src/build.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2160:       addrTop = sqlite3VdbeCurrentAddr(v) + 1;",
          "2161:       sqlite3VdbeAddOp3(v, OP_InitCoroutine, regYield, 0, addrTop);",
          "2162:       if( pParse->nErr ) return;",
          "2164:       if( pSelTab==0 ) return;",
          "2165:       assert( p->aCol==0 );",
          "2166:       p->nCol = pSelTab->nCol;",
          "",
          "[Removed Lines]",
          "2163:       pSelTab = sqlite3ResultSetOfSelect(pParse, pSelect);",
          "",
          "[Added Lines]",
          "2163:       pSelTab = sqlite3ResultSetOfSelect(pParse, pSelect, SQLITE_AFF_BLOB);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2424: #ifndef SQLITE_OMIT_AUTHORIZATION",
          "2425:     xAuth = db->xAuth;",
          "2426:     db->xAuth = 0;",
          "2428:     db->xAuth = xAuth;",
          "2429: #else",
          "2431: #endif",
          "2432:     pParse->nTab = n;",
          "2433:     if( pTable->pCheck ){",
          "",
          "[Removed Lines]",
          "2427:     pSelTab = sqlite3ResultSetOfSelect(pParse, pSel);",
          "2430:     pSelTab = sqlite3ResultSetOfSelect(pParse, pSel);",
          "",
          "[Added Lines]",
          "2427:     pSelTab = sqlite3ResultSetOfSelect(pParse, pSel, 0);",
          "2430:     pSelTab = sqlite3ResultSetOfSelect(pParse, pSel, 0);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2443:        && pParse->nErr==0",
          "2444:        && pTable->nCol==pSel->pEList->nExpr",
          "2445:       ){",
          "2447:       }",
          "2448:     }else if( pSelTab ){",
          "",
          "[Removed Lines]",
          "2446:         sqlite3SelectAddColumnTypeAndCollation(pParse, pTable, pSel);",
          "",
          "[Added Lines]",
          "2446:         sqlite3SelectAddColumnTypeAndCollation(pParse, pTable, pSel, 0);",
          "",
          "---------------"
        ],
        "src/insert.c||src/insert.c": [
          "File: src/insert.c -> src/insert.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "88:     }",
          "89:     for(n=0; n<pIdx->nColumn; n++){",
          "90:       i16 x = pIdx->aiColumn[n];",
          "91:       if( x>=0 ){",
          "93:       }else if( x==XN_ROWID ){",
          "95:       }else{",
          "97:         assert( x==XN_EXPR );",
          "98:         assert( pIdx->aColExpr!=0 );",
          "99:         aff = sqlite3ExprAffinity(pIdx->aColExpr->a[n].pExpr);",
          "102:       }",
          "103:     }",
          "104:     pIdx->zColAff[n] = 0;",
          "105:   }",
          "",
          "[Removed Lines]",
          "92:         pIdx->zColAff[n] = pTab->aCol[x].affinity;",
          "94:         pIdx->zColAff[n] = SQLITE_AFF_INTEGER;",
          "96:         char aff;",
          "100:         if( aff==0 ) aff = SQLITE_AFF_BLOB;",
          "101:         pIdx->zColAff[n] = aff;",
          "",
          "[Added Lines]",
          "91:       char aff;",
          "93:         aff = pTab->aCol[x].affinity;",
          "95:         aff = SQLITE_AFF_INTEGER;",
          "101:       if( aff==0 ) aff = SQLITE_AFF_BLOB;",
          "102:       pIdx->zColAff[n] = aff;",
          "",
          "---------------"
        ],
        "src/select.c||src/select.c": [
          "File: src/select.c -> src/select.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2068:         pCol->colFlags |= COLFLAG_HASTYPE;",
          "2069:       }",
          "2070:     }",
          "2072:     pColl = sqlite3ExprCollSeq(pParse, p);",
          "2073:     if( pColl && pCol->zColl==0 ){",
          "2074:       pCol->zColl = sqlite3DbStrDup(db, pColl->zName);",
          "",
          "[Removed Lines]",
          "2071:     if( pCol->affinity==0 ) pCol->affinity = SQLITE_AFF_BLOB;",
          "",
          "[Added Lines]",
          "2072:     if( pCol->affinity==0 ) pCol->affinity = aff;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2085:   Table *pTab;",
          "2086:   sqlite3 *db = pParse->db;",
          "2087:   u64 savedFlags;",
          "",
          "[Removed Lines]",
          "2084: Table *sqlite3ResultSetOfSelect(Parse *pParse, Select *pSelect){",
          "",
          "[Added Lines]",
          "2085: Table *sqlite3ResultSetOfSelect(Parse *pParse, Select *pSelect, char aff){",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2101:   pTab->zName = 0;",
          "2102:   pTab->nRowLogEst = 200; assert( 200==sqlite3LogEst(1048576) );",
          "2103:   sqlite3ColumnsFromExprList(pParse, pSelect->pEList, &pTab->nCol, &pTab->aCol);",
          "2105:   pTab->iPKey = -1;",
          "2106:   if( db->mallocFailed ){",
          "2107:     sqlite3DeleteTable(db, pTab);",
          "",
          "[Removed Lines]",
          "2104:   sqlite3SelectAddColumnTypeAndCollation(pParse, pTab, pSelect);",
          "",
          "[Added Lines]",
          "2105:   sqlite3SelectAddColumnTypeAndCollation(pParse, pTab, pSelect, aff);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "5195:       Select *pSel = pFrom->pSelect;",
          "5196:       if( pSel ){",
          "5197:         while( pSel->pPrior ) pSel = pSel->pPrior;",
          "5199:       }",
          "5200:     }",
          "5201:   }",
          "",
          "[Removed Lines]",
          "5198:         sqlite3SelectAddColumnTypeAndCollation(pParse, pTab, pSel);",
          "",
          "[Added Lines]",
          "5199:         sqlite3SelectAddColumnTypeAndCollation(pParse, pTab, pSel, 0);",
          "",
          "---------------"
        ],
        "src/sqliteInt.h||src/sqliteInt.h": [
          "File: src/sqliteInt.h -> src/sqliteInt.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3911: void sqlite3CommitInternalChanges(sqlite3*);",
          "3912: void sqlite3DeleteColumnNames(sqlite3*,Table*);",
          "3913: int sqlite3ColumnsFromExprList(Parse*,ExprList*,i16*,Column**);",
          "3916: void sqlite3OpenMasterTable(Parse *, int);",
          "3917: Index *sqlite3PrimaryKeyIndex(Table*);",
          "3918: i16 sqlite3ColumnOfIndex(Index*, i16);",
          "",
          "[Removed Lines]",
          "3914: void sqlite3SelectAddColumnTypeAndCollation(Parse*,Table*,Select*);",
          "3915: Table *sqlite3ResultSetOfSelect(Parse*,Select*);",
          "",
          "[Added Lines]",
          "3914: void sqlite3SelectAddColumnTypeAndCollation(Parse*,Table*,Select*,char);",
          "3915: Table *sqlite3ResultSetOfSelect(Parse*,Select*,char);",
          "",
          "---------------"
        ],
        "src/window.c||src/window.c": [
          "File: src/window.c -> src/window.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "994:       p->pSrc->a[0].pSelect = pSub;",
          "995:       sqlite3SrcListAssignCursors(pParse, p->pSrc);",
          "996:       pSub->selFlags |= SF_Expanded;",
          "998:       if( pTab2==0 ){",
          "999:         rc = SQLITE_NOMEM;",
          "1000:       }else{",
          "",
          "[Removed Lines]",
          "997:       pTab2 = sqlite3ResultSetOfSelect(pParse, pSub);",
          "",
          "[Added Lines]",
          "997:       pTab2 = sqlite3ResultSetOfSelect(pParse, pSub, 0);",
          "",
          "---------------"
        ],
        "test/view.test||test/view.test": [
          "File: test/view.test -> test/view.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "724:   1 1 3 3",
          "725: }",
          "727: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "727: #-------------------------------------------------------------------------",
          "728: reset_db",
          "729: do_execsql_test view-27.0 {",
          "730:   CREATE TABLE t0(c0 TEXT, c1);",
          "731:   INSERT INTO t0(c0, c1) VALUES (-1, 0);",
          "732:   CREATE VIEW v0(c0, c1) AS SELECT t0.c0, AVG(t0.c1) FROM t0;",
          "733: }",
          "735: do_execsql_test view-27.1 {",
          "736:   SELECT c0, typeof(c0), affinity(c0), c1, typeof(c1), affinity(c1) FROM v0;",
          "737: } {",
          "738:   -1   text text",
          "739:    0.0 real none",
          "740: }",
          "742: do_execsql_test view-27.2 { SELECT c0<c1 FROM v0 } 1",
          "743: do_execsql_test view-27.3 { SELECT c1<c0 FROM v0 } 0",
          "744: do_execsql_test view-27.4 {",
          "745:   SELECT 1 FROM v0 WHERE c1<c0",
          "746: } {}",
          "747: do_execsql_test view-27.5 {",
          "748:   SELECT 1 FROM v0 WHERE c0<c1",
          "749: } {1}",
          "751: do_execsql_test view-27.6 {",
          "752:   SELECT c0<c1 FROM (SELECT t0.c0 AS c0, AVG(t0.c1) AS c1 FROM t0)",
          "753: } 1",
          "754: do_execsql_test view-27.7 {",
          "755:   SELECT c1<c0 FROM (SELECT t0.c0 AS c0, AVG(t0.c1) AS c1 FROM t0)",
          "756: } 0",
          "757: do_execsql_test view-27.8 {",
          "758:   SELECT 1 FROM (SELECT t0.c0 AS c0, AVG(t0.c1) AS c1 FROM t0) WHERE c1<c0",
          "759: } {}",
          "760: do_execsql_test view-27.9 {",
          "761:   SELECT 1 FROM (SELECT t0.c0 AS c0, AVG(t0.c1) AS c1 FROM t0) WHERE c0<c1",
          "762: } {1}",
          "",
          "---------------"
        ],
        "test/window9.test||test/window9.test": [
          "File: test/window9.test -> test/window9.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "131:       );",
          "132: } {1 {sub-select returns 3 columns - expected 1}}",
          "135: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "134: #-------------------------------------------------------------------------",
          "135: reset_db",
          "136: do_execsql_test 4.0 {",
          "137:   CREATE TABLE t1(a, b TEXT);",
          "138:   INSERT INTO t1 VALUES('A', 1), ('A', 2), ('2', 1), ('2', 2);",
          "139: }",
          "141: do_execsql_test 4.1.1 {",
          "142:   SELECT b, b=count(*), '1,2'                   FROM t1 GROUP BY b;",
          "143: } {1 0 1,2 2 1 1,2}",
          "144: do_execsql_test 4.1.2 {",
          "145:   SELECT b, b=count(*), group_concat(b) OVER () FROM t1 GROUP BY b;",
          "146: } {1 0 1,2 2 1 1,2}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1735f91df4db4d012154af319245392555c01911",
      "candidate_info": {
        "commit_hash": "1735f91df4db4d012154af319245392555c01911",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/1735f91df4db4d012154af319245392555c01911",
        "files": [
          "ext/misc/fileio.c",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Improved detection and reporting of errors in the readfile() extension SQL function.\n\nFossilOrigin-Name: d2f0b5a483869d39f5c5814c9d6df3d3b8a46d582b4dcf0cf11e23b707c4213e",
        "before_after_code_files": [
          "ext/misc/fileio.c||ext/misc/fileio.c",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/misc/fileio.c||ext/misc/fileio.c": [
          "File: ext/misc/fileio.c -> ext/misc/fileio.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "126: static void readFileContents(sqlite3_context *ctx, const char *zName){",
          "127:   FILE *in;",
          "129:   void *pBuf;",
          "131:   in = fopen(zName, \"rb\");",
          "133:   fseek(in, 0, SEEK_END);",
          "134:   nIn = ftell(in);",
          "135:   rewind(in);",
          "136:   pBuf = sqlite3_malloc( nIn );",
          "138:     sqlite3_result_blob(ctx, pBuf, nIn, sqlite3_free);",
          "139:   }else{",
          "140:     sqlite3_free(pBuf);",
          "141:   }",
          "142:   fclose(in);",
          "",
          "[Removed Lines]",
          "128:   long nIn;",
          "132:   if( in==0 ) return;",
          "137:   if( pBuf && 1==fread(pBuf, nIn, 1, in) ){",
          "",
          "[Added Lines]",
          "135:   sqlite3_int64 nIn;",
          "137:   sqlite3 *db;",
          "138:   int mxBlob;",
          "141:   if( in==0 ){",
          "143:     return;",
          "144:   }",
          "148:   db = sqlite3_context_db_handle(ctx);",
          "149:   mxBlob = sqlite3_limit(db, SQLITE_LIMIT_LENGTH, -1);",
          "150:   if( nIn>mxBlob ){",
          "151:     sqlite3_result_error_code(ctx, SQLITE_TOOBIG);",
          "152:     fclose(in);",
          "153:     return;",
          "154:   }",
          "156:   if( pBuf==0 ){",
          "157:     sqlite3_result_error_nomem(ctx);",
          "158:     fclose(in);",
          "159:     return;",
          "160:   }",
          "161:   if( 1==fread(pBuf, nIn, 1, in) ){",
          "164:     sqlite3_result_error_code(ctx, SQLITE_IOERR);",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 2a47387ba6aa3c294607b7641aa1c4cf70a7b27a861e1098c2f79a38e5b7036a",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4fcb9caa60c3939cd562574f744a8514737ae7fb",
      "candidate_info": {
        "commit_hash": "4fcb9caa60c3939cd562574f744a8514737ae7fb",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/4fcb9caa60c3939cd562574f744a8514737ae7fb",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/where.c",
          "test/nulls1.test"
        ],
        "message": "Do not pass ORDER BY clauses with non-standard NULL handling to virtual table implementations.\n\nFossilOrigin-Name: a9a82ee88d2d12209a674bd19167277aa91a6912e7a8bbf3714f90d559307fee",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/where.c||src/where.c",
          "test/nulls1.test||test/nulls1.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 75d665a494dd7d6e77d5a80af386ee5accc0a53416d5493424dc0fef6c7b01a0",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/where.c||src/where.c": [
          "File: src/where.c -> src/where.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "933:     for(i=0; i<n; i++){",
          "934:       Expr *pExpr = pOrderBy->a[i].pExpr;",
          "935:       if( pExpr->op!=TK_COLUMN || pExpr->iTable!=pSrc->iCursor ) break;",
          "936:     }",
          "937:     if( i==n){",
          "938:       nOrderBy = n;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "936:       if( pOrderBy->a[i].sortFlags & KEYINFO_ORDER_BIGNULL ) break;",
          "",
          "---------------"
        ],
        "test/nulls1.test||test/nulls1.test": [
          "File: test/nulls1.test -> test/nulls1.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "118:   400 300",
          "119: }",
          "121: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "121: #-------------------------------------------------------------------------",
          "122: ifcapable vtab {",
          "123:   register_echo_module db",
          "124:   do_execsql_test 4.0 {",
          "125:     CREATE TABLE tx(a INTEGER PRIMARY KEY, b, c);",
          "126:     CREATE INDEX i1 ON tx(b);",
          "127:     INSERT INTO tx VALUES(1, 1, 1);",
          "128:     INSERT INTO tx VALUES(2, NULL, 2);",
          "129:     INSERT INTO tx VALUES(3, 3, 3);",
          "130:     INSERT INTO tx VALUES(4, NULL, 4);",
          "131:     INSERT INTO tx VALUES(5, 5, 5);",
          "132:     CREATE VIRTUAL TABLE te USING echo(tx);",
          "133:   }",
          "135:   do_execsql_test 4.1 {",
          "136:     SELECT * FROM tx ORDER BY b NULLS FIRST;",
          "137:   } {2 {} 2  4 {} 4  1 1 1  3 3 3  5 5 5}",
          "138:   do_execsql_test 4.2 {",
          "139:     SELECT * FROM te ORDER BY b NULLS FIRST;",
          "140:   } {2 {} 2  4 {} 4  1 1 1  3 3 3  5 5 5}",
          "142:   do_execsql_test 4.3 {",
          "143:     SELECT * FROM tx ORDER BY b NULLS LAST;",
          "144:   } {1 1 1  3 3 3  5 5 5  2 {} 2  4 {} 4}",
          "145:   do_execsql_test 4.4 {",
          "146:     SELECT * FROM te ORDER BY b NULLS LAST;",
          "147:   } {1 1 1  3 3 3  5 5 5  2 {} 2  4 {} 4}",
          "148: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "873b019826a77a1f25f8b2e7a62fac49577a9057",
      "candidate_info": {
        "commit_hash": "873b019826a77a1f25f8b2e7a62fac49577a9057",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/873b019826a77a1f25f8b2e7a62fac49577a9057",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/vdbe.c",
          "test/corruptL.test"
        ],
        "message": "Fix a problem in the new code introduced by [658b84d7] causing corruption and other errors to be ignored.\n\nFossilOrigin-Name: 7ccf2e7d413adb109c61456a5f46e87d38884801dbaab93297a17e3050014b59",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/vdbe.c||src/vdbe.c",
          "test/corruptL.test||test/corruptL.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: ebe4845cd0ffb96b30be3c69eb399d58e93149886bc2fa60a7ebd7b4fbe447a4",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/vdbe.c||src/vdbe.c": [
          "File: src/vdbe.c -> src/vdbe.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4016:           VdbeBranchTaken(1,2); goto jump_to_p2;",
          "4017:           break;",
          "4018:         }else{",
          "4020:           goto seek_not_found;",
          "4021:         }",
          "4022:       }else",
          "",
          "[Removed Lines]",
          "4019:           sqlite3BtreeLast(pC->uc.pCursor, &res);",
          "",
          "[Added Lines]",
          "4019:           rc = sqlite3BtreeLast(pC->uc.pCursor, &res);",
          "4020:           if( rc!=SQLITE_OK ) goto abort_due_to_error;",
          "",
          "---------------"
        ],
        "test/corruptL.test||test/corruptL.test": [
          "File: test/corruptL.test -> test/corruptL.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "866:   ROLLBACK TO one;",
          "867: }",
          "869: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "869: #-------------------------------------------------------------------------",
          "870: reset_db",
          "871: do_test 10.0 {",
          "872:   sqlite3 db {}",
          "873:   db deserialize [decode_hexdb {",
          "874: | size 180224 pagesize 4096 filename crash-41390d95d613b6.db",
          "875: | page 1 offset 0",
          "876: |      0: 53 51 4c 69 74 65 20 66 6f 72 6d 61 74 20 33 00   SQLite format 3.",
          "877: |     16: 10 00 01 01 00 40 20 20 00 00 00 00 00 00 00 00   .....@  ........",
          "878: |     96: 00 00 00 00 0d 00 00 00 04 0e e2 00 0f 96 0f 44   ...............D",
          "879: |    112: 0f 10 0e e2 00 00 00 00 00 00 00 00 00 00 00 00   ................",
          "880: |   3808: 00 00 2c 14 06 17 15 11 01 41 69 6e 64 65 78 74   ..,......Aindext",
          "881: |   3824: 41 78 33 74 31 06 43 52 45 41 54 45 20 49 4e 44   Ax3t1.CREATE IND",
          "882: |   3840: 45 58 20 74 31 78 32 20 4f 4e 20 74 31 28 62 29   EX t1x2 ON t1(b)",
          "883: |   3856: 32 03 06 17 15 11 01 4d 69 6e 64 65 78 74 31 88   2......Mindext1.",
          "884: |   3872: 31 74 31 05 43 52 45 41 54 45 20 49 4e 44 45 58   1t1.CREATE INDEX",
          "885: |   3888: 20 74 31 78 31 20 4f 4e 20 74 31 28 67 2b 68 2c    t1x1 ON t1(g+h,",
          "886: |   3904: 6a 2d 6b 29 50 02 06 17 2b 2b 01 59 74 61 62 6c   j-k)P...++.Ytabl",
          "887: |   3920: 65 73 71 6c 69 74 65 5e 73 65 71 74 65 6e 63 65   esqlite^seqtence",
          "888: |   3936: 73 71 6c 69 74 65 5f 73 65 71 75 65 6e 63 65 04   sqlite_sequence.",
          "889: |   3952: 43 52 45 41 54 45 20 54 41 42 4c 45 20 73 71 6c   CREATE TABLE sql",
          "890: |   3968: 69 74 65 5f 73 65 71 75 65 6e 63 65 28 6e 61 6d   ite_sequence(nam",
          "891: |   3984: 65 2c 73 65 71 29 68 00 07 17 11 11 01 81 3b 74   e,seq)h.......;t",
          "892: |   4000: 61 62 6c 65 74 31 74 31 03 43 52 45 41 54 45 20   ablet1t1.CREATE",
          "893: |   4016: 54 41 42 4c 45 20 74 31 28 61 20 49 4e 54 45 47   TABLE t1(a INTEG",
          "894: |   4032: 45 52 20 50 52 49 4d 41 52 59 20 4b 45 59 20 41   ER PRIMARY KEY A",
          "895: |   4048: 55 54 4f 49 4e 43 52 45 4d 45 4e 54 2c 0a 62 2c   UTOINCREMENT,.b,",
          "896: |   4064: 63 2c 64 2c 65 2c 66 2c 67 2c 68 2c 6a 2c 6b 2c   c,d,e,f,g,h,j,k,",
          "897: |   4080: 6c 2c 6d 2c 6e 2c 6f 2c 70 2c 71 2c 72 2c 73 29   l,m,n,o,p,q,r,s)",
          "898: | page 2 offset 4096",
          "899: |      0: 01 00 00 00 00 01 00 00 10 00 01 00 00 00 00 01   ................",
          "900: |     16: 00 00 00 00 02 00 0f f0 00 15 00 00 00 03 02 00   ................",
          "901: |     32: 00 00 d9 05 00 00 00 03 02 00 00 00 00 05 00 00   ................",
          "902: |     48: 10 03 02 00 00 00 00 05 00 00 00 03 02 00 00 00   ................",
          "903: |     64: 00 05 00 00 00 02 62 00 00 00 00 05 00 00 00 03   ......b.........",
          "904: |     80: 02 00 00 00 00 05 00 00 00 03 02 00 00 00 00 05   ................",
          "905: |     96: 00 00 00 03 02 00 00 00 00 05 00 00 00 03 05 00   ................",
          "906: |    112: 00 00 03 03 01 00 00 23 02 00 00 4f 00 02 00 00   .......#...O....",
          "907: |    128: 10 25 02 00 00 00 00 03 00 00 00 23 02 00 00 00   .%.........#....",
          "908: |    144: 00 03 00 00 00 23 02 00 00 00 00 03 00 00 00 23   .....#.........#",
          "909: |    160: 05 00 08 90 06 05 00 00 00 06 01 ff 00 00 00 03   ................",
          "910: |    176: 00 00 00 06 02 00 00 00 00 02 ff 00 00 00 00 00   ................",
          "911: | page 3 offset 8192",
          "912: |      0: 05 00 00 00 09 0f d0 00 00 00 00 19 0f fb 0f f6   ................",
          "913: |     16: 0f f1 10 ec ec e7 0f e2 0f dc 0f d6 0f 00 00 00   ................",
          "914: |   1072: 00 97 4c 0a 24 00 ae 00 00 00 00 00 00 00 00 00   ..L.$...........",
          "915: |   4048: 00 00 00 16 83 39 ff ff ff 14 81 16 00 00 00 12   .....9..........",
          "916: |   4064: 81 02 00 00 00 10 6e 00 00 00 0e 5a 00 00 00 0c   ......n....Z....",
          "917: |   4080: 46 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   F...............",
          "918: | page 4 offset 12288",
          "919: |   1072: 97 4d 32 14 00 ae 00 00 00 00 00 00 00 00 00 00   .M2.............",
          "920: |   4080: 00 00 00 00 00 00 00 07 01 03 11 02 74 31 00 bd   ............t1..",
          "921: | page 5 offset 16384",
          "922: |      0: fa 0f 7c 00 0a 0f 74 00 0f f9 0f eb 0f dd 0f cf   ..|...t.........",
          "923: |     16: 0f c1 0f b3 0f a4 0e 94 0f 84 0f 74 0f 74 0f 74   ...........t.t.t",
          "924: |     32: 0f 74 0f 64 0f 00 00 00 00 00 00 00 00 00 00 00   .t.d............",
          "925: |   3952: 00 00 00 00 07 05 00 00 00 02 00 be 0f 8c 10 07   ................",
          "926: |   3968: ff ff 00 00 07 05 00 00 00 02 00 aa 0f 9b f0 08   ................",
          "927: |   3984: c8 00 00 00 37 06 00 00 00 01 00 96 0f ac 00 08   ....7...........",
          "928: |   4000: 00 00 00 b3 07 15 00 10 00 02 00 82 0f ba 00 07   ................",
          "929: |   4016: 00 00 00 06 05 00 00 00 01 6e 0f c8 00 07 00 00   .........n......",
          "930: |   4032: 00 06 05 00 00 00 01 5a 03 f6 00 07 00 00 00 06   .......Z........",
          "931: |   4048: 05 00 00 00 01 46 0f e4 00 07 00 00 10 06 05 00   .....F..........",
          "932: |   4064: 00 00 01 32 10 02 00 07 00 00 00 07 05 00 00 00   ...2............",
          "933: |   4080: 01 1d ff ff ff 07 10 00 00 06 05 00 00 00 01 0a   ................",
          "934: | page 6 offset 20480",
          "935: |    624: 00 00 00 00 00 21 97 00 00 00 00 00 00 00 00 00   .....!..........",
          "936: |   1120: 00 00 00 00 00 24 57 3e 00 00 00 00 00 00 00 00   .....$W>........",
          "937: |   1616: 00 00 00 00 1f 97 00 00 00 00 00 00 00 00 00 00   ................",
          "938: |   2112: 00 00 00 1e 97 3d 00 00 00 00 00 00 00 00 00 00   .....=..........",
          "939: |   2608: 00 1d 97 00 00 00 00 00 00 00 00 00 00 00 00 00   ................",
          "940: | page 8 offset 28672",
          "941: |   1184: 00 00 00 00 00 00 00 00 00 97 4d 1e 13 ff ae 7c   ..........M....|",
          "942: |   4080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 90   ................",
          "943: | page 9 offset 32768",
          "944: |    256: 0d 01 c0 00 01 04 30 00 04 30 00 00 00 00 00 00   ......0..0......",
          "945: | page 10 offset 36864",
          "946: |      0: 0d 00 22 00 00 00 00 00 00 00 00 00 00 00 00 00   ................",
          "947: |   4080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 05   ................",
          "948: | page 12 offset 45056",
          "949: |      0: 0d 00 00 00 01 04 30 00 00 00 00 00 00 00 00 00   ......0.........",
          "950: | page 14 offset 53248",
          "951: |      0: 0d 00 00 00 01 04 30 00 04 30 00 00 00 00 00 00   ......0..0......",
          "952: |   1072: 96 4d 5a 14 00 00 00 00 00 00 00 00 00 00 00 00   .MZ.............",
          "953: | page 16 offset 61440",
          "954: |      0: 0d 00 00 00 01 04 30 00 04 30 00 00 00 00 00 00   ......0..0......",
          "955: |   1072: 97 4d 6e 14 00 ae 7b ff ff ff ff 00 00 00 00 00   .Mn.............",
          "956: | page 18 offset 69632",
          "957: |   1056: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 97   ................",
          "958: |   1072: 4d 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   M...............",
          "959: |   4080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0d   ................",
          "960: | page 20 offset 77824",
          "961: |   1056: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 97   ................",
          "962: |   1072: 4d 81 16 14 00 ae 00 00 00 00 00 00 00 00 00 00   M...............",
          "963: |   4080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0f   ................",
          "964: | page 22 offset 86016",
          "965: |      0: 0d 00 00 00 01 04 2f 00 04 2f 01 00 00 00 00 00   ....../../......",
          "966: |   1056: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 97   ................",
          "967: |   1072: 4d 81 2a 14 00 00 00 00 00 00 00 00 00 00 00 00   M.*.............",
          "968: | page 24 offset 94208",
          "969: |   1072: 00 97 4c 0a 14 00 ae 7c 00 00 00 00 00 00 00 00   ..L....|........",
          "970: | page 25 offset 98304",
          "971: |   1056: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 97   ................",
          "972: |   1072: 4d 81 3e 14 00 ae 7c 00 00 18 ff 00 00 00 00 00   M.>...|.........",
          "973: | page 27 offset 106496",
          "974: |      0: 00 00 00 00 00 00 00 12 00 00 00 07 00 00 00 1d   ................",
          "975: |     16: 00 00 00 09 00 00 00 1f 00 00 00 0b 00 00 00 21   ...............!",
          "976: |     32: 00 00 00 0d 00 10 00 25 00 00 00 0f 00 00 00 27   .......%.......'",
          "977: |     48: 00 00 00 11 00 00 00 00 00 00 00 00 00 00 00 00   ................",
          "978: | page 32 offset 126976",
          "979: |   2512: 00 00 00 00 00 00 00 45 21 00 00 00 00 00 00 00   .......E!.......",
          "980: | page 35 offset 139264",
          "981: |      0: 00 0a 08 44 00 05 02 77 00 0e 11 0a 92 00 00 00   ...D...w........",
          "982: |   1120: 00 00 00 00 00 20 97 00 00 00 00 00 00 00 00 00   ..... ..........",
          "983: |   1616: 00 00 00 00 22 00 00 00 00 00 00 00 00 00 00 00   ................",
          "984: |   2608: 00 00 00 97 3d 04 00 00 00 00 00 00 00 00 00 00   ....=...........",
          "985: |   3104: 00 1c 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................",
          "986: |   3600: 00 97 3d 04 ae 7c 00 00 00 00 00 00 00 00 00 00   ..=..|..........",
          "987: |   4080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 1a   ................",
          "988: | page 36 offset 143360",
          "989: |      0: 0a 08 44 00 04 02 00 00 00 00 00 00 00 00 00 00   ..D.............",
          "990: |   1120: 00 00 00 00 00 2a 97 3e 04 00 00 00 00 00 00 00   .....*.>........",
          "991: |   1616: 00 00 00 00 2c 97 3e 00 00 00 00 00 00 00 00 00   ....,.>.........",
          "992: |   2112: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 38   ...............8",
          "993: |   2128: 00 00 05 cd 00 00 00 00 00 00 00 00 00 00 00 00   ................",
          "994: |   3600: 00 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................",
          "995: | page 38 offset 151552",
          "996: |   2464: 00 00 00 00 00 00 00 00 00 6e 00 00 00 00 00 00   .........n......",
          "997: | page 40 offset 159744",
          "998: |   2512: 00 00 00 00 00 00 00 00 82 00 00 00 00 00 00 00   ................",
          "999: | page 42 offset 167936",
          "1000: |   2512: 00 00 00 00 00 00 00 96 00 00 00 00 00 00 00 00   ................",
          "1001: | page 44 offset 176128",
          "1002: |   2512: 00 00 00 00 00 00 00 00 aa 00 00 00 00 00 00 00   ................",
          "1003: | end crash-41390d95d613b6.db",
          "1004: }]} {}",
          "1006: do_catchsql_test 10.1 {",
          "1007:   SELECT * FROM t1 WHERE a<='2019-05-09' ORDER BY a DESC;",
          "1008: } {1 {database disk image is malformed}}",
          "",
          "---------------"
        ]
      }
    }
  ]
}