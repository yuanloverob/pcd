{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f32a0a951dc8ea3a4c8c4a76e5b3a32f03c47e3d",
      "candidate_info": {
        "commit_hash": "f32a0a951dc8ea3a4c8c4a76e5b3a32f03c47e3d",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/f32a0a951dc8ea3a4c8c4a76e5b3a32f03c47e3d",
        "files": [
          "crypto/x509v3/v3_utl.c"
        ],
        "message": "x509v3/v3_utl.c: avoid double-free.\n\nThanks to David Benjamin for spotting this.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4532)\n\n(cherry picked from commit 432f8688bb72e21939845ac7a69359ca718c6676)\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Bernd Edlinger <bernd.edlinger@hotmail.de>\n(Merged from https://github.com/openssl/openssl/pull/4514)",
        "before_after_code_files": [
          "crypto/x509v3/v3_utl.c||crypto/x509v3/v3_utl.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/x509v3/v3_utl.c||crypto/x509v3/v3_utl.c": [
          "File: crypto/x509v3/v3_utl.c -> crypto/x509v3/v3_utl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "55:     return 1;",
          "56:  err:",
          "57:     X509V3err(X509V3_F_X509V3_ADD_VALUE, ERR_R_MALLOC_FAILURE);",
          "59:         sk_CONF_VALUE_free(*extlist);",
          "60:     OPENSSL_free(vtmp);",
          "61:     OPENSSL_free(tname);",
          "62:     OPENSSL_free(tvalue);",
          "",
          "[Removed Lines]",
          "58:     if (sk_allocated)",
          "",
          "[Added Lines]",
          "58:     if (sk_allocated) {",
          "61:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "87fde17f6f5374a5db8f6c6615aa2b85855887db",
      "candidate_info": {
        "commit_hash": "87fde17f6f5374a5db8f6c6615aa2b85855887db",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/87fde17f6f5374a5db8f6c6615aa2b85855887db",
        "files": [
          "crypto/ec/ecp_nistp224.c",
          "crypto/ec/ecp_nistp256.c",
          "crypto/ec/ecp_nistp521.c"
        ],
        "message": "Fix the return type of felem_is_zero_int which should be int. Change argument type of xxxelem_is_zero_int to const void* to avoid the need of type casts.\n\nFixes #4413\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4450)\n\n(cherry picked from commit c55b786a8911cef41f890735ba5fde79e116e055)",
        "before_after_code_files": [
          "crypto/ec/ecp_nistp224.c||crypto/ec/ecp_nistp224.c",
          "crypto/ec/ecp_nistp256.c||crypto/ec/ecp_nistp256.c",
          "crypto/ec/ecp_nistp521.c||crypto/ec/ecp_nistp521.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/ec/ecp_nistp224.c||crypto/ec/ecp_nistp224.c": [
          "File: crypto/ec/ecp_nistp224.c -> crypto/ec/ecp_nistp224.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "700:     return (zero | two224m96p1 | two225m97p2);",
          "701: }",
          "704: {",
          "705:     return (int)(felem_is_zero(in) & ((limb) 1));",
          "706: }",
          "",
          "[Removed Lines]",
          "703: static limb felem_is_zero_int(const felem in)",
          "",
          "[Added Lines]",
          "703: static int felem_is_zero_int(const void *in)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1365:                                              sizeof(felem),",
          "1366:                                              tmp_felems,",
          "1367:                                              (void (*)(void *))felem_one,",
          "1369:                                              felem_is_zero_int,",
          "1370:                                              (void (*)(void *, const void *))",
          "1371:                                              felem_assign,",
          "",
          "[Removed Lines]",
          "1368:                                              (int (*)(const void *))",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "crypto/ec/ecp_nistp256.c||crypto/ec/ecp_nistp256.c": [
          "File: crypto/ec/ecp_nistp256.c -> crypto/ec/ecp_nistp256.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "979:     return result;",
          "980: }",
          "983: {",
          "984:     return (int)(smallfelem_is_zero(small) & ((limb) 1));",
          "985: }",
          "",
          "[Removed Lines]",
          "982: static int smallfelem_is_zero_int(const smallfelem small)",
          "",
          "[Added Lines]",
          "982: static int smallfelem_is_zero_int(const void *small)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1983:                                              sizeof(smallfelem),",
          "1984:                                              tmp_smallfelems,",
          "1985:                                              (void (*)(void *))smallfelem_one,",
          "1987:                                              smallfelem_is_zero_int,",
          "1988:                                              (void (*)(void *, const void *))",
          "1989:                                              smallfelem_assign,",
          "",
          "[Removed Lines]",
          "1986:                                              (int (*)(const void *))",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "crypto/ec/ecp_nistp521.c||crypto/ec/ecp_nistp521.c": [
          "File: crypto/ec/ecp_nistp521.c -> crypto/ec/ecp_nistp521.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "886:     return is_zero;",
          "887: }",
          "890: {",
          "891:     return (int)(felem_is_zero(in) & ((limb) 1));",
          "892: }",
          "",
          "[Removed Lines]",
          "889: static int felem_is_zero_int(const felem in)",
          "",
          "[Added Lines]",
          "889: static int felem_is_zero_int(const void *in)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1805:                                              sizeof(felem),",
          "1806:                                              tmp_felems,",
          "1807:                                              (void (*)(void *))felem_one,",
          "1809:                                              felem_is_zero_int,",
          "1810:                                              (void (*)(void *, const void *))",
          "1811:                                              felem_assign,",
          "",
          "[Removed Lines]",
          "1808:                                              (int (*)(const void *))",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c8ec34109cab8c92685958ddfef0776a4b3b8460",
      "candidate_info": {
        "commit_hash": "c8ec34109cab8c92685958ddfef0776a4b3b8460",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/c8ec34109cab8c92685958ddfef0776a4b3b8460",
        "files": [
          "crypto/err/err.c"
        ],
        "message": "Only release thread-local key if we created it.\n\nThanks to Jan Alexander Steffens for finding the bug and confirming the\nfix.\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3592)\n(cherry picked from commit 73bc53708c386c1ea85941d345721e23dc61c05c)",
        "before_after_code_files": [
          "crypto/err/err.c||crypto/err/err.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/err/err.c||crypto/err/err.c": [
          "File: crypto/err/err.c -> crypto/err/err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "122: #endif",
          "124: static CRYPTO_ONCE err_init = CRYPTO_ONCE_STATIC_INIT;",
          "125: static CRYPTO_THREAD_LOCAL err_thread_local;",
          "127: static CRYPTO_ONCE err_string_init = CRYPTO_ONCE_STATIC_INIT;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "125: static int set_err_thread_local;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "261: void err_cleanup(void)",
          "262: {",
          "264:     CRYPTO_THREAD_lock_free(err_string_lock);",
          "265:     err_string_lock = NULL;",
          "266: }",
          "",
          "[Removed Lines]",
          "263:     CRYPTO_THREAD_cleanup_local(&err_thread_local);",
          "",
          "[Added Lines]",
          "264:     if (set_err_thread_local != 0)",
          "265:         CRYPTO_THREAD_cleanup_local(&err_thread_local);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "640: DEFINE_RUN_ONCE_STATIC(err_do_init)",
          "641: {",
          "642:     return CRYPTO_THREAD_init_local(&err_thread_local, NULL);",
          "643: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "644:     set_err_thread_local = 1;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3833ebea433dbb062fbdb69d300c5528b611a83a",
      "candidate_info": {
        "commit_hash": "3833ebea433dbb062fbdb69d300c5528b611a83a",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/3833ebea433dbb062fbdb69d300c5528b611a83a",
        "files": [
          "crypto/asn1/ameth_lib.c"
        ],
        "message": "Revert \"EVP_PKEY_asn1_add0(): Check that this method isn't already registered\"\n\nThis reverts commit d85722d31ac9ff0dc54c06cdc8d125acf56ca27a.\n\nReviewed-by: Bernd Edlinger <bernd.edlinger@hotmail.de>\n(Merged from https://github.com/openssl/openssl/pull/5137)\n\n(cherry picked from commit 7203c94e98c9fa76b0859c25b723b2bde4a9059b)",
        "before_after_code_files": [
          "crypto/asn1/ameth_lib.c||crypto/asn1/ameth_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/asn1/ameth_lib.c||crypto/asn1/ameth_lib.c": [
          "File: crypto/asn1/ameth_lib.c -> crypto/asn1/ameth_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "177: int EVP_PKEY_asn1_add0(const EVP_PKEY_ASN1_METHOD *ameth)",
          "178: {",
          "184:     if (app_methods == NULL) {",
          "185:         app_methods = sk_EVP_PKEY_ASN1_METHOD_new(ameth_cmp);",
          "186:         if (app_methods == NULL)",
          "",
          "[Removed Lines]",
          "179:     if (pkey_asn1_find(ameth->pkey_id) != NULL) {",
          "180:         EVPerr(EVP_F_EVP_PKEY_ASN1_ADD0,",
          "181:                EVP_R_PKEY_ASN1_METHOD_ALREADY_REGISTERED);",
          "182:         return 0;",
          "183:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "49616d925251a8d38ef2af55d045a778215a7b55",
      "candidate_info": {
        "commit_hash": "49616d925251a8d38ef2af55d045a778215a7b55",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/49616d925251a8d38ef2af55d045a778215a7b55",
        "files": [
          "apps/rsa.c"
        ],
        "message": "Fix rsa -check option\n\noriginal problem: if a private key is invaild, nothing outputted.\n\nthe error filter in apps/rsa.c is not working any more.\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4043)\n\n(cherry picked from commit 03883e7e168b0f5ef52a516eeb86346b767e0298)",
        "before_after_code_files": [
          "apps/rsa.c||apps/rsa.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/rsa.c||apps/rsa.c": [
          "File: apps/rsa.c -> apps/rsa.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "215:     }",
          "217:     if (check) {",
          "220:         if (r == 1)",
          "221:             BIO_printf(out, \"RSA key ok\\n\");",
          "",
          "[Removed Lines]",
          "218:         int r = RSA_check_key(rsa);",
          "",
          "[Added Lines]",
          "218:         int r = RSA_check_key_ex(rsa, NULL);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "225:             while ((err = ERR_peek_error()) != 0 &&",
          "226:                    ERR_GET_LIB(err) == ERR_LIB_RSA &&",
          "228:                    ERR_GET_REASON(err) != ERR_R_MALLOC_FAILURE) {",
          "229:                 BIO_printf(out, \"RSA key error: %s\\n\",",
          "230:                            ERR_reason_error_string(err));",
          "",
          "[Removed Lines]",
          "227:                    ERR_GET_FUNC(err) == RSA_F_RSA_CHECK_KEY &&",
          "",
          "[Added Lines]",
          "227:                    ERR_GET_FUNC(err) == RSA_F_RSA_CHECK_KEY_EX &&",
          "",
          "---------------"
        ]
      }
    }
  ]
}