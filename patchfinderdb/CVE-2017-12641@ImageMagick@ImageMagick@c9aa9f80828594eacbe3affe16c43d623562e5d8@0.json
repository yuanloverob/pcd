{
  "cve_id": "CVE-2017-12641",
  "cve_desc": "ImageMagick 7.0.6-1 has a memory leak vulnerability in ReadOneJNGImage in coders\\png.c.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "c9aa9f80828594eacbe3affe16c43d623562e5d8",
  "patch_info": {
    "commit_hash": "c9aa9f80828594eacbe3affe16c43d623562e5d8",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/c9aa9f80828594eacbe3affe16c43d623562e5d8",
    "files": [
      "coders/png.c"
    ],
    "message": "https://github.com/ImageMagick/ImageMagick/issues/550",
    "before_after_code_files": [
      "coders/png.c||coders/png.c"
    ]
  },
  "patch_diff": {
    "coders/png.c||coders/png.c": [
      "File: coders/png.c -> coders/png.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "4377:     (void) ConcatenateMagickString(type,\"errr\",MagickPathExtent);",
      "4378:     length=ReadBlobMSBLong(image);",
      "4379:     count=(unsigned int) ReadBlob(image,4,(unsigned char *) type);",
      "4381:     if (logging != MagickFalse)",
      "4382:       (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
      "4383:         \"  Reading JNG chunk type %c%c%c%c, length: %.20g\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4381:     if (logging != MagickFalse)",
      "4382:       (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
      "4383:         \"  Reading JNG chunk type %c%c%c%c, length: %.20g\",",
      "4384:         type[0],type[1],type[2],type[3],(double) length);",
      "4386:     if (length > PNG_UINT_31_MAX || count == 0)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e0e544bb173213df00f82a810d66321e1bb4f3c8",
      "candidate_info": {
        "commit_hash": "e0e544bb173213df00f82a810d66321e1bb4f3c8",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/e0e544bb173213df00f82a810d66321e1bb4f3c8",
        "files": [
          "ChangeLog",
          "coders/png.c"
        ],
        "message": "Fixed Issue 602 in coders/png.c",
        "before_after_code_files": [
          "coders/png.c||coders/png.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/png.c||coders/png.c"
          ],
          "candidate": [
            "coders/png.c||coders/png.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/png.c||coders/png.c": [
          "File: coders/png.c -> coders/png.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4238: %",
          "4239: %  A description of each parameter follows:",
          "4240: %",
          "4241: %    o mng_info: Specifies a pointer to a MngInfo structure.",
          "4242: %",
          "4243: %    o image_info: the image info.",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4241: %    o mng_info: Specifies a pointer to a MngInfo structure.",
          "4242: %",
          "4243: %    o image_info: the image info.",
          "4244: %",
          "4245: %    o exception: return any errors or warnings in this structure.",
          "4246: %",
          "4248: void",
          "4249: DestroyJNG(unsigned char *chunk,Image **color_image,",
          "4250:    ImageInfo **color_image_info,",
          "4251:    Image **alpha_image,ImageInfo **alpha_image_info)",
          "4252: {",
          "4253:   if (chunk)",
          "4254:     (void) RelinquishMagickMemory(chunk);",
          "4255:   if (*color_image_info)",
          "4256:   {",
          "4257:     DestroyImageInfo(*color_image_info);",
          "4259:   }",
          "4260:   if (*alpha_image_info)",
          "4261:   {",
          "4262:     DestroyImageInfo(*alpha_image_info);",
          "4264:   }",
          "4265:   if (*color_image)",
          "4266:   {",
          "4267:     DestroyImage(*color_image);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4365:     length=ReadBlobMSBLong(image);",
          "4366:     count=(unsigned int) ReadBlob(image,4,(unsigned char *) type);",
          "4373:     if (length > PNG_UINT_31_MAX || count == 0)",
          "4374:       {",
          "",
          "[Removed Lines]",
          "4368:     if (logging != MagickFalse)",
          "4369:       (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "4370:         \"  Reading JNG chunk type %c%c%c%c, length: %.20g\",",
          "4371:         type[0],type[1],type[2],type[3],(double) length);",
          "",
          "[Added Lines]",
          "4396:     if (logging != MagickFalse)",
          "4397:       (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "4451:                   \"    jng_alpha_interlace_method:  %3d\",",
          "4452:                   jng_alpha_compression_method,",
          "4453:                   jng_alpha_filter_method,",
          "4454:                   jng_alpha_interlace_method);",
          "4455:               }",
          "4456:           }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4480:                   jng_alpha_interlace_method);",
          "4481:               }",
          "4482:           }",
          "4484:         if (length != 0)",
          "4485:           chunk=(unsigned char *) RelinquishMagickMemory(chunk);",
          "4487:         if (jng_width > 65535 || jng_height > 65535 ||",
          "4488:              (long) jng_width > GetMagickResourceLimit(WidthResource) ||",
          "4489:              (long) jng_height > GetMagickResourceLimit(HeightResource))",
          "4490:           {",
          "4491:             (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c945953a9acfd7f0ec935b32daec37e9e2f4e574",
      "candidate_info": {
        "commit_hash": "c945953a9acfd7f0ec935b32daec37e9e2f4e574",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/c945953a9acfd7f0ec935b32daec37e9e2f4e574",
        "files": [
          "coders/png.c"
        ],
        "message": "...",
        "before_after_code_files": [
          "coders/png.c||coders/png.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/png.c||coders/png.c"
          ],
          "candidate": [
            "coders/png.c||coders/png.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/png.c||coders/png.c": [
          "File: coders/png.c -> coders/png.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4503:     if (logging != MagickFalse)",
          "4504:       (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "4506:         type[0],type[1],type[2],type[3],(double) length);",
          "4508:     if (length > PNG_UINT_31_MAX || count == 0)",
          "",
          "[Removed Lines]",
          "4505:         \"  Reading JNG chunk type %c%c%c%c, length: %.20g\",",
          "",
          "[Added Lines]",
          "4505:         \"  Reading JNG chunk type %c%c%c%c, length: %.20g\",",
          "4506:         type[0],type[1],type[2],type[3],(double) length);",
          "4508:     if (length > PNG_UINT_31_MAX || count == 0)",
          "4509:       {",
          "4510:         DestroyJNG(NULL,&color_image,&color_image_info,",
          "4511:           &alpha_image,&alpha_image_info);",
          "4512:         ThrowReaderException(CorruptImageError,\"ImproperImageHeader\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4510:         DestroyJNG(NULL,&color_image,&color_image_info,",
          "4511:           &alpha_image,&alpha_image_info);",
          "4512:         ThrowReaderException(CorruptImageError,\"CorruptImage\");",
          "4520:         if (length > GetBlobSize(image))",
          "4521:           {",
          "4522:             DestroyJNG(NULL,&color_image,&color_image_info,",
          "",
          "[Removed Lines]",
          "4513:       }",
          "4515:     p=NULL;",
          "4516:     chunk=(unsigned char *) NULL;",
          "4518:     if (length != 0)",
          "4519:       {",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7e55f7e80e64e30552ca24913f748f41c2b7005d",
      "candidate_info": {
        "commit_hash": "7e55f7e80e64e30552ca24913f748f41c2b7005d",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/7e55f7e80e64e30552ca24913f748f41c2b7005d",
        "files": [
          "coders/png.c"
        ],
        "message": "...",
        "before_after_code_files": [
          "coders/png.c||coders/png.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/png.c||coders/png.c"
          ],
          "candidate": [
            "coders/png.c||coders/png.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/png.c||coders/png.c": [
          "File: coders/png.c -> coders/png.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4381:     if (logging != MagickFalse)",
          "4382:       (void) LogMagickEvent(CoderEvent,GetMagickModule(),",
          "4384:         type[0],type[1],type[2],type[3],(double) length);",
          "4386:     if (length > PNG_UINT_31_MAX || count == 0)",
          "",
          "[Removed Lines]",
          "4383:         \"  Reading JNG chunk type %c%c%c%c, length: %.20g\",",
          "",
          "[Added Lines]",
          "4383:         \"  Reading JNG chunk type %c%c%c%c, length: %.20g\",",
          "",
          "---------------"
        ]
      }
    }
  ]
}