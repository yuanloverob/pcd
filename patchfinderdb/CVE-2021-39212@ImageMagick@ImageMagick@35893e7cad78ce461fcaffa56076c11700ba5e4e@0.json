{
  "cve_id": "CVE-2021-39212",
  "cve_desc": "ImageMagick is free software delivered as a ready-to-run binary distribution or as source code that you may use, copy, modify, and distribute in both open and proprietary applications. In affected versions and in certain cases, Postscript files could be read and written when specifically excluded by a `module` policy in `policy.xml`. ex. <policy domain=\"module\" rights=\"none\" pattern=\"PS\" />. The issue has been resolved in ImageMagick 7.1.0-7 and in 6.9.12-22. Fortunately, in the wild, few users utilize the `module` policy and instead use the `coder` policy that is also our workaround recommendation: <policy domain=\"coder\" rights=\"none\" pattern=\"{PS,EPI,EPS,EPSF,EPSI}\" />.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "35893e7cad78ce461fcaffa56076c11700ba5e4e",
  "patch_info": {
    "commit_hash": "35893e7cad78ce461fcaffa56076c11700ba5e4e",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/35893e7cad78ce461fcaffa56076c11700ba5e4e",
    "files": [
      "MagickCore/static.c"
    ],
    "message": "Added missing policy checks in RegisterStaticModules.",
    "before_after_code_files": [
      "MagickCore/static.c||MagickCore/static.c"
    ]
  },
  "patch_diff": {
    "MagickCore/static.c||MagickCore/static.c": [
      "File: MagickCore/static.c -> MagickCore/static.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "242:     Assign module name from alias.",
      "244:   assert(module != (const char *) NULL);",
      "245:   (void) CopyMagickString(module_name,module,MagickPathExtent);",
      "246:   p=GetCoderInfo(module,exception);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "294:     extent;",
      "296:   ssize_t",
      "297:     i;",
      "299:   extent=sizeof(MagickModules)/sizeof(MagickModules[0]);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "297:     i;",
      "299:   extent=sizeof(MagickModules)/sizeof(MagickModules[0]);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "01faddbe2711a4156180c4a92837e2f23683cc68",
      "candidate_info": {
        "commit_hash": "01faddbe2711a4156180c4a92837e2f23683cc68",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/01faddbe2711a4156180c4a92837e2f23683cc68",
        "files": [
          "MagickCore/module.c",
          "MagickCore/static.c"
        ],
        "message": "Use the correct rights.",
        "before_after_code_files": [
          "MagickCore/module.c||MagickCore/module.c",
          "MagickCore/static.c||MagickCore/static.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "MagickCore/static.c||MagickCore/static.c"
          ],
          "candidate": [
            "MagickCore/static.c||MagickCore/static.c"
          ]
        }
      },
      "candidate_diff": {
        "MagickCore/module.c||MagickCore/module.c": [
          "File: MagickCore/module.c -> MagickCore/module.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1255:     rights;",
          "1257:   const CoderInfo",
          "1260:   size_t",
          "1261:     signature;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "MagickCore/static.c||MagickCore/static.c": [
          "File: MagickCore/static.c -> MagickCore/static.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "242:     Assign module name from alias.",
          "244:   assert(module != (const char *) NULL);",
          "245:   (void) CopyMagickString(module_name,module,MagickPathExtent);",
          "246:   p=GetCoderInfo(module,exception);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "283: %  RegisterStaticModules() statically registers all the available module",
          "284: %  handlers.",
          "285: %",
          "286: %  The format of the RegisterStaticModules method is:",
          "287: %",
          "288: %      (void) RegisterStaticModules(void)",
          "289: %",
          "291: MagickExport void RegisterStaticModules(void)",
          "292: {",
          "293:   size_t",
          "294:     extent;",
          "296:   ssize_t",
          "299:   extent=sizeof(MagickModules)/sizeof(MagickModules[0]);",
          "300:   for (i=0; i < (ssize_t) extent; i++)",
          "",
          "[Removed Lines]",
          "297:     i;",
          "",
          "[Added Lines]",
          "286: %  The format of the RegisterStaticModules method is:",
          "287: %",
          "288: %      (void) RegisterStaticModules(void)",
          "",
          "---------------"
        ]
      }
    }
  ]
}