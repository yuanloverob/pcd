{
  "cve_id": "CVE-2019-18792",
  "cve_desc": "An issue was discovered in Suricata 5.0.0. It is possible to bypass/evade any tcp based signature by overlapping a TCP segment with a fake FIN packet. The fake FIN packet is injected just before the PUSH ACK packet we want to bypass. The PUSH ACK packet (containing the data) will be ignored by Suricata because it overlaps the FIN packet (the sequence and ack number are identical in the two packets). The client will ignore the fake FIN packet because the ACK flag is not set. Both linux and windows clients are ignoring the injected packet.",
  "repo": "OISF/suricata",
  "patch_hash": "fa692df37a796c3330c81988d15ef1a219afc006",
  "patch_info": {
    "commit_hash": "fa692df37a796c3330c81988d15ef1a219afc006",
    "repo": "OISF/suricata",
    "commit_url": "https://github.com/OISF/suricata/commit/fa692df37a796c3330c81988d15ef1a219afc006",
    "files": [
      "src/stream-tcp.c"
    ],
    "message": "stream: reject broken ACK packets\n\nFix evasion posibility by rejecting packets with a broken ACK field.\nThese packets have a non-0 ACK field, but do not have a ACK flag set.\n\nBug #3324.\n\nReported-by: Nicolas Adba",
    "before_after_code_files": [
      "src/stream-tcp.c||src/stream-tcp.c"
    ]
  },
  "patch_diff": {
    "src/stream-tcp.c||src/stream-tcp.c": [
      "File: src/stream-tcp.c -> src/stream-tcp.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "4804:     if (!(p->tcph->th_flags & TH_ACK) && TCP_GET_ACK(p) != 0) {",
      "4805:         StreamTcpSetEvent(p, STREAM_PKT_BROKEN_ACK);",
      "4806:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4806:         goto error;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "6930:     tcph.th_win = htons(5480);",
      "6931:     tcph.th_seq = htonl(10);",
      "6933:     tcph.th_flags = TH_SYN;",
      "6934:     p->tcph = &tcph;",
      "",
      "[Removed Lines]",
      "6932:     tcph.th_ack = htonl(11);",
      "",
      "[Added Lines]",
      "6933:     tcph.th_ack = 0;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1c63d3905852f746ccde7e2585600b2199cefb4b",
      "candidate_info": {
        "commit_hash": "1c63d3905852f746ccde7e2585600b2199cefb4b",
        "repo": "OISF/suricata",
        "commit_url": "https://github.com/OISF/suricata/commit/1c63d3905852f746ccde7e2585600b2199cefb4b",
        "files": [
          "src/stream-tcp.c"
        ],
        "message": "stream: reject broken ACK packets\n\nFix evasion posibility by rejecting packets with a broken ACK field.\nThese packets have a non-0 ACK field, but do not have a ACK flag set.\n\nBug #3324.\n\nReported-by: Nicolas Adba\n(cherry picked from commit fa692df37a796c3330c81988d15ef1a219afc006)",
        "before_after_code_files": [
          "src/stream-tcp.c||src/stream-tcp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/stream-tcp.c||src/stream-tcp.c"
          ],
          "candidate": [
            "src/stream-tcp.c||src/stream-tcp.c"
          ]
        }
      },
      "candidate_diff": {
        "src/stream-tcp.c||src/stream-tcp.c": [
          "File: src/stream-tcp.c -> src/stream-tcp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4760:     if (!(p->tcph->th_flags & TH_ACK) && TCP_GET_ACK(p) != 0) {",
          "4761:         StreamTcpSetEvent(p, STREAM_PKT_BROKEN_ACK);",
          "4762:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4762:         goto error;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "6884:     tcph.th_win = htons(5480);",
          "6885:     tcph.th_seq = htonl(10);",
          "6887:     tcph.th_flags = TH_SYN;",
          "6888:     p->tcph = &tcph;",
          "",
          "[Removed Lines]",
          "6886:     tcph.th_ack = htonl(11);",
          "",
          "[Added Lines]",
          "6887:     tcph.th_ack = 0;",
          "",
          "---------------"
        ]
      }
    }
  ]
}