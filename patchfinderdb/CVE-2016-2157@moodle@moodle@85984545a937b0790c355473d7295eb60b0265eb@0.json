{
  "cve_id": "CVE-2016-2157",
  "cve_desc": "Cross-site request forgery (CSRF) vulnerability in mod/assign/adminmanageplugins.php in Moodle through 2.6.11, 2.7.x before 2.7.13, 2.8.x before 2.8.11, 2.9.x before 2.9.5, and 3.0.x before 3.0.3 allows remote attackers to hijack the authentication of administrators for requests that manage Assignment plugins.",
  "repo": "moodle/moodle",
  "patch_hash": "85984545a937b0790c355473d7295eb60b0265eb",
  "patch_info": {
    "commit_hash": "85984545a937b0790c355473d7295eb60b0265eb",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/85984545a937b0790c355473d7295eb60b0265eb",
    "files": [
      "mod/assign/adminmanageplugins.php"
    ],
    "message": "MDL-53031 mod_assign: add session check on assignment plugins management",
    "before_after_code_files": [
      "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
    ]
  },
  "patch_diff": {
    "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php": [
      "File: mod/assign/adminmanageplugins.php -> mod/assign/adminmanageplugins.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "25: require_once(dirname(__FILE__) . '/../../config.php');",
      "26: require_once($CFG->dirroot.'/mod/assign/adminlib.php');",
      "31: $PAGE->set_context(context_system::instance());",
      "",
      "[Removed Lines]",
      "29: $pluginmanager = new assign_plugin_manager(required_param('subtype', PARAM_PLUGIN));",
      "34: $pluginmanager->execute(optional_param('action', null, PARAM_PLUGIN),",
      "35:                         optional_param('plugin', null, PARAM_PLUGIN));",
      "",
      "[Added Lines]",
      "28: $subtype = required_param('subtype', PARAM_PLUGIN);",
      "29: $action = optional_param('action', null, PARAM_PLUGIN);",
      "30: $plugin = optional_param('plugin', null, PARAM_PLUGIN);",
      "32: if (!empty($plugin)) {",
      "33:     require_sesskey();",
      "34: }",
      "37: $pluginmanager = new assign_plugin_manager($subtype);",
      "42: $pluginmanager->execute($action, $plugin);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "01b19e761f94a4f3615d5c8f6314309aa83469f3",
      "candidate_info": {
        "commit_hash": "01b19e761f94a4f3615d5c8f6314309aa83469f3",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/01b19e761f94a4f3615d5c8f6314309aa83469f3",
        "files": [
          "mod/assign/adminmanageplugins.php"
        ],
        "message": "MDL-53031 mod_assign: add session check on assignment plugins management",
        "before_after_code_files": [
          "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
          ],
          "candidate": [
            "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php": [
          "File: mod/assign/adminmanageplugins.php -> mod/assign/adminmanageplugins.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: require_once(dirname(__FILE__) . '/../../config.php');",
          "26: require_once($CFG->dirroot.'/mod/assign/adminlib.php');",
          "31: $PAGE->set_context(context_system::instance());",
          "",
          "[Removed Lines]",
          "29: $pluginmanager = new assign_plugin_manager(required_param('subtype', PARAM_PLUGIN));",
          "34: $pluginmanager->execute(optional_param('action', null, PARAM_PLUGIN),",
          "35:                         optional_param('plugin', null, PARAM_PLUGIN));",
          "",
          "[Added Lines]",
          "28: $subtype = required_param('subtype', PARAM_PLUGIN);",
          "29: $action = optional_param('action', null, PARAM_PLUGIN);",
          "30: $plugin = optional_param('plugin', null, PARAM_PLUGIN);",
          "32: if (!empty($plugin)) {",
          "33:     require_sesskey();",
          "34: }",
          "37: $pluginmanager = new assign_plugin_manager($subtype);",
          "42: $pluginmanager->execute($action, $plugin);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1452f1e1d37d816648e3e015296de59509847287",
      "candidate_info": {
        "commit_hash": "1452f1e1d37d816648e3e015296de59509847287",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/1452f1e1d37d816648e3e015296de59509847287",
        "files": [
          "mod/assign/adminmanageplugins.php"
        ],
        "message": "MDL-53031 mod_assign: add session check on assignment plugins management",
        "before_after_code_files": [
          "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
          ],
          "candidate": [
            "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php": [
          "File: mod/assign/adminmanageplugins.php -> mod/assign/adminmanageplugins.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: require_once(dirname(__FILE__) . '/../../config.php');",
          "26: require_once($CFG->dirroot.'/mod/assign/adminlib.php');",
          "31: $PAGE->set_context(context_system::instance());",
          "",
          "[Removed Lines]",
          "29: $pluginmanager = new assign_plugin_manager(required_param('subtype', PARAM_PLUGIN));",
          "34: $pluginmanager->execute(optional_param('action', null, PARAM_PLUGIN),",
          "35:                         optional_param('plugin', null, PARAM_PLUGIN));",
          "",
          "[Added Lines]",
          "28: $subtype = required_param('subtype', PARAM_PLUGIN);",
          "29: $action = optional_param('action', null, PARAM_PLUGIN);",
          "30: $plugin = optional_param('plugin', null, PARAM_PLUGIN);",
          "32: if (!empty($plugin)) {",
          "33:     require_sesskey();",
          "34: }",
          "37: $pluginmanager = new assign_plugin_manager($subtype);",
          "42: $pluginmanager->execute($action, $plugin);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a0cd21cd5cc63961243518a58e9d5d01182dbbb4",
      "candidate_info": {
        "commit_hash": "a0cd21cd5cc63961243518a58e9d5d01182dbbb4",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/a0cd21cd5cc63961243518a58e9d5d01182dbbb4",
        "files": [
          "mod/assign/adminmanageplugins.php"
        ],
        "message": "MDL-53031 mod_assign: add session check on assignment plugins management",
        "before_after_code_files": [
          "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
          ],
          "candidate": [
            "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php": [
          "File: mod/assign/adminmanageplugins.php -> mod/assign/adminmanageplugins.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: require_once(dirname(__FILE__) . '/../../config.php');",
          "26: require_once($CFG->dirroot.'/mod/assign/adminlib.php');",
          "31: $PAGE->set_context(context_system::instance());",
          "",
          "[Removed Lines]",
          "29: $pluginmanager = new assign_plugin_manager(required_param('subtype', PARAM_PLUGIN));",
          "34: $pluginmanager->execute(optional_param('action', null, PARAM_PLUGIN),",
          "35:                         optional_param('plugin', null, PARAM_PLUGIN));",
          "",
          "[Added Lines]",
          "28: $subtype = required_param('subtype', PARAM_PLUGIN);",
          "29: $action = optional_param('action', null, PARAM_PLUGIN);",
          "30: $plugin = optional_param('plugin', null, PARAM_PLUGIN);",
          "32: if (!empty($plugin)) {",
          "33:     require_sesskey();",
          "34: }",
          "37: $pluginmanager = new assign_plugin_manager($subtype);",
          "42: $pluginmanager->execute($action, $plugin);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "55ba3a26d2710ce3c5f13287b0c3538b9a934fa4",
      "candidate_info": {
        "commit_hash": "55ba3a26d2710ce3c5f13287b0c3538b9a934fa4",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/55ba3a26d2710ce3c5f13287b0c3538b9a934fa4",
        "files": [
          "mod/assign/adminmanageplugins.php"
        ],
        "message": "MDL-53031 mod_assign: add session check on assignment plugins management",
        "before_after_code_files": [
          "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
          ],
          "candidate": [
            "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php"
          ]
        }
      },
      "candidate_diff": {
        "mod/assign/adminmanageplugins.php||mod/assign/adminmanageplugins.php": [
          "File: mod/assign/adminmanageplugins.php -> mod/assign/adminmanageplugins.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: require_once(dirname(__FILE__) . '/../../config.php');",
          "26: require_once($CFG->dirroot.'/mod/assign/adminlib.php');",
          "31: $PAGE->set_context(context_system::instance());",
          "",
          "[Removed Lines]",
          "29: $pluginmanager = new assign_plugin_manager(required_param('subtype', PARAM_PLUGIN));",
          "34: $pluginmanager->execute(optional_param('action', null, PARAM_PLUGIN),",
          "35:                         optional_param('plugin', null, PARAM_PLUGIN));",
          "",
          "[Added Lines]",
          "28: $subtype = required_param('subtype', PARAM_PLUGIN);",
          "29: $action = optional_param('action', null, PARAM_PLUGIN);",
          "30: $plugin = optional_param('plugin', null, PARAM_PLUGIN);",
          "32: if (!empty($plugin)) {",
          "33:     require_sesskey();",
          "34: }",
          "37: $pluginmanager = new assign_plugin_manager($subtype);",
          "42: $pluginmanager->execute($action, $plugin);",
          "",
          "---------------"
        ]
      }
    }
  ]
}