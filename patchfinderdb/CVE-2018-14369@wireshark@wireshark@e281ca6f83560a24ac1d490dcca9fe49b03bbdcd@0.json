{
  "cve_id": "CVE-2018-14369",
  "cve_desc": "In Wireshark 2.6.0 to 2.6.1, 2.4.0 to 2.4.7, and 2.2.0 to 2.2.15, the HTTP2 dissector could crash. This was addressed in epan/dissectors/packet-http2.c by verifying that header data was found before proceeding to header decompression.",
  "repo": "wireshark/wireshark",
  "patch_hash": "e281ca6f83560a24ac1d490dcca9fe49b03bbdcd",
  "patch_info": {
    "commit_hash": "e281ca6f83560a24ac1d490dcca9fe49b03bbdcd",
    "repo": "wireshark/wireshark",
    "commit_url": "https://github.com/wireshark/wireshark/commit/e281ca6f83560a24ac1d490dcca9fe49b03bbdcd",
    "files": [
      "epan/dissectors/packet-http2.c"
    ],
    "message": "HTTP2: prevent a segmentation fault if HTTP2 dissector was not called on first pass\n\nWith HTTP2 heuristics to identify the conversation, a packet can be\nskipped on first pass and then decoded as HTTP2 on subsequent ones.\nCheck that header data is available before attempting header\ndecompression.\n\nBug: 14869\nChange-Id: I8ef7669ca33835b509acb38d797e33d6167a1bd1\nReviewed-on: https://code.wireshark.org/review/28257\nPetri-Dish: Pascal Quantin <pascal.quantin@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>",
    "before_after_code_files": [
      "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c"
    ]
  },
  "patch_diff": {
    "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c": [
      "File: epan/dissectors/packet-http2.c -> epan/dissectors/packet-http2.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1699:             wmem_list_append(header_stream_info->stream_header_list, headers);",
      "1700:         }",
      "1703:         headers = (wmem_array_t*)wmem_list_frame_data(header_data->current);",
      "1705:         header_data->current = wmem_list_frame_next(header_data->current);",
      "",
      "[Removed Lines]",
      "1702:     } else {",
      "",
      "[Added Lines]",
      "1702:     } else if (header_data->current) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1707:         if(!header_data->current) {",
      "1708:             header_data->current = wmem_list_head(header_list);",
      "1709:         }",
      "1710:     }",
      "1712:     if(wmem_array_get_count(headers) == 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1710:     } else {",
      "1711:         return;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "9169aef3f15acd9f2a33769d4845fdeef231fd0a",
      "candidate_info": {
        "commit_hash": "9169aef3f15acd9f2a33769d4845fdeef231fd0a",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/9169aef3f15acd9f2a33769d4845fdeef231fd0a",
        "files": [
          "epan/dissectors/packet-http2.c"
        ],
        "message": "HTTP2: prevent a segmentation fault if HTTP2 dissector was not called on first pass\n\nWith HTTP2 heuristics to identify the conversation, a packet can be\nskipped on first pass and then decoded as HTTP2 on subsequent ones.\nCheck that header data is available before attempting header\ndecompression.\n\nBug: 14869\nChange-Id: I8ef7669ca33835b509acb38d797e33d6167a1bd1\nReviewed-on: https://code.wireshark.org/review/28257\nPetri-Dish: Pascal Quantin <pascal.quantin@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>\n(cherry picked from commit e281ca6f83560a24ac1d490dcca9fe49b03bbdcd)\nReviewed-on: https://code.wireshark.org/review/28259",
        "before_after_code_files": [
          "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c"
          ],
          "candidate": [
            "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c": [
          "File: epan/dissectors/packet-http2.c -> epan/dissectors/packet-http2.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1699:             wmem_list_append(header_stream_info->stream_header_list, headers);",
          "1700:         }",
          "1703:         headers = (wmem_array_t*)wmem_list_frame_data(header_data->current);",
          "1705:         header_data->current = wmem_list_frame_next(header_data->current);",
          "",
          "[Removed Lines]",
          "1702:     } else {",
          "",
          "[Added Lines]",
          "1702:     } else if (header_data->current) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1707:         if(!header_data->current) {",
          "1708:             header_data->current = wmem_list_head(header_list);",
          "1709:         }",
          "1710:     }",
          "1712:     if(wmem_array_get_count(headers) == 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1710:     } else {",
          "1711:         return;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "169d271f1f03a5b21d13579995421599a8535def",
      "candidate_info": {
        "commit_hash": "169d271f1f03a5b21d13579995421599a8535def",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/169d271f1f03a5b21d13579995421599a8535def",
        "files": [
          "epan/dissectors/packet-http2.c"
        ],
        "message": "HTTP2: prevent a segmentation fault if HTTP2 dissector was not called on first pass\n\nWith HTTP2 heuristics to identify the conversation, a packet can be\nskipped on first pass and then decoded as HTTP2 on subsequent ones.\nCheck that header data is available before attempting header\ndecompression.\n\nBug: 14869\nChange-Id: I8ef7669ca33835b509acb38d797e33d6167a1bd1\nReviewed-on: https://code.wireshark.org/review/28257\nPetri-Dish: Pascal Quantin <pascal.quantin@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>\n(cherry picked from commit e281ca6f83560a24ac1d490dcca9fe49b03bbdcd)\nConflicts:\n\tepan/dissectors/packet-http2.c\nReviewed-on: https://code.wireshark.org/review/28260",
        "before_after_code_files": [
          "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c"
          ],
          "candidate": [
            "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c": [
          "File: epan/dissectors/packet-http2.c -> epan/dissectors/packet-http2.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "828:             header_data->current = wmem_list_head(header_list);",
          "829:         }",
          "832:         headers = (wmem_array_t*)wmem_list_frame_data(header_data->current);",
          "834:         header_data->current = wmem_list_frame_next(header_data->current);",
          "",
          "[Removed Lines]",
          "831:     } else {",
          "",
          "[Added Lines]",
          "831:     } else if (header_data->current) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "836:         if(!header_data->current) {",
          "837:             header_data->current = wmem_list_head(header_list);",
          "838:         }",
          "839:     }",
          "841:     if(wmem_array_get_count(headers) == 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "839:     } else {",
          "840:         return;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "038cd225bfa54e2a7ade4043118796334920a61e",
      "candidate_info": {
        "commit_hash": "038cd225bfa54e2a7ade4043118796334920a61e",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/038cd225bfa54e2a7ade4043118796334920a61e",
        "files": [
          "epan/dissectors/packet-http2.c"
        ],
        "message": "HTTP2: prevent a segmentation fault if HTTP2 dissector was not called on first pass\n\nWith HTTP2 heuristics to identify the conversation, a packet can be\nskipped on first pass and then decoded as HTTP2 on subsequent ones.\nCheck that header data is available before attempting header\ndecompression.\n\nBug: 14869\nChange-Id: I8ef7669ca33835b509acb38d797e33d6167a1bd1\nReviewed-on: https://code.wireshark.org/review/28257\nPetri-Dish: Pascal Quantin <pascal.quantin@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>\n(cherry picked from commit e281ca6f83560a24ac1d490dcca9fe49b03bbdcd)\nConflicts:\n\tepan/dissectors/packet-http2.c\nReviewed-on: https://code.wireshark.org/review/28260\n(cherry picked from commit 169d271f1f03a5b21d13579995421599a8535def)\nReviewed-on: https://code.wireshark.org/review/28261",
        "before_after_code_files": [
          "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c"
          ],
          "candidate": [
            "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-http2.c||epan/dissectors/packet-http2.c": [
          "File: epan/dissectors/packet-http2.c -> epan/dissectors/packet-http2.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "814:             header_data->current = wmem_list_head(header_list);",
          "815:         }",
          "818:         headers = (wmem_array_t*)wmem_list_frame_data(header_data->current);",
          "820:         header_data->current = wmem_list_frame_next(header_data->current);",
          "",
          "[Removed Lines]",
          "817:     } else {",
          "",
          "[Added Lines]",
          "817:     } else if (header_data->current) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "822:         if(!header_data->current) {",
          "823:             header_data->current = wmem_list_head(header_list);",
          "824:         }",
          "825:     }",
          "827:     if(wmem_array_get_count(headers) == 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "825:     } else {",
          "826:         return;",
          "",
          "---------------"
        ]
      }
    }
  ]
}