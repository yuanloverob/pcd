{
  "cve_id": "CVE-2015-0231",
  "cve_desc": "Use-after-free vulnerability in the process_nested_data function in ext/standard/var_unserializer.re in PHP before 5.4.37, 5.5.x before 5.5.21, and 5.6.x before 5.6.5 allows remote attackers to execute arbitrary code via a crafted unserialize call that leverages improper handling of duplicate numerical keys within the serialized properties of an object.  NOTE: this vulnerability exists because of an incomplete fix for CVE-2014-8142.",
  "repo": "php/php-src",
  "patch_hash": "b585a3aed7880a5fa5c18e2b838fc96f40e075bd",
  "patch_info": {
    "commit_hash": "b585a3aed7880a5fa5c18e2b838fc96f40e075bd",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/b585a3aed7880a5fa5c18e2b838fc96f40e075bd",
    "files": [
      "NEWS",
      "ext/standard/tests/strings/bug68710.phpt",
      "ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re"
    ],
    "message": "Fix for bug #68710 (Use After Free Vulnerability in PHP's unserialize())",
    "before_after_code_files": [
      "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt",
      "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
      "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
    ]
  },
  "patch_diff": {
    "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt": [
      "File: ext/standard/tests/strings/bug68710.phpt -> ext/standard/tests/strings/bug68710.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #68710 Use after free vulnerability in unserialize() (bypassing the",
      "3: CVE-2014-8142 fix)",
      "4: --FILE--",
      "5: <?php",
      "6: for ($i=4; $i<100; $i++) {",
      "7:     $m = new StdClass();",
      "9:     $u = array(1);",
      "11:     $m->aaa = array(1,2,&$u,4,5);",
      "12:     $m->bbb = 1;",
      "13:     $m->ccc = &$u;",
      "14:     $m->ddd = str_repeat(\"A\", $i);",
      "16:     $z = serialize($m);",
      "17:     $z = str_replace(\"aaa\", \"123\", $z);",
      "18:     $z = str_replace(\"bbb\", \"123\", $z);",
      "19:     $y = unserialize($z);",
      "20:     $z = serialize($y);",
      "21: }",
      "22: ?>",
      "23: ===DONE===",
      "24: --EXPECTF--",
      "25: ===DONE===",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
      "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "343:   } else {",
      "345:    convert_to_string(key);",
      "347:     var_push_dtor(var_hash, old_data);",
      "348:    }",
      "349:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
      "",
      "[Removed Lines]",
      "346:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
      "",
      "[Added Lines]",
      "346:    if (zend_hash_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
      "",
      "---------------"
    ],
    "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
      "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
      "--- Hunk 1 ---",
      "[Context before]",
      "347:   } else {",
      "349:    convert_to_string(key);",
      "351:     var_push_dtor(var_hash, old_data);",
      "352:    }",
      "353:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
      "",
      "[Removed Lines]",
      "350:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
      "",
      "[Added Lines]",
      "350:    if (zend_hash_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "630f9c33c23639de85c3fd306b209b538b73b4c9",
      "candidate_info": {
        "commit_hash": "630f9c33c23639de85c3fd306b209b538b73b4c9",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/630f9c33c23639de85c3fd306b209b538b73b4c9",
        "files": [
          "NEWS",
          "ext/standard/tests/serialize/bug68594.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix bug #68594 - Use after free vulnerability in unserialize()",
        "before_after_code_files": [
          "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/serialize/bug68594.phpt||ext/standard/tests/serialize/bug68594.phpt": [
          "File: ext/standard/tests/serialize/bug68594.phpt -> ext/standard/tests/serialize/bug68594.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68545 Use after free vulnerability in unserialize()",
          "3: --FILE--",
          "4: <?php",
          "5: for ($i=4; $i<100; $i++) {",
          "6:  $m = new StdClass();",
          "8:  $u = array(1);",
          "10:  $m->aaa = array(1,2,&$u,4,5);",
          "11:  $m->bbb = 1;",
          "12:  $m->ccc = &$u;",
          "13:  $m->ddd = str_repeat(\"A\", $i);",
          "15:  $z = serialize($m);",
          "16:  $z = str_replace(\"bbb\", \"aaa\", $z);",
          "17:  $y = unserialize($z);",
          "18:  $z = serialize($y);",
          "19: }",
          "20: ?>",
          "21: ===DONE===",
          "22: --EXPECTF--",
          "23: ===DONE===",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "343:   } else {",
          "345:    convert_to_string(key);",
          "346:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "347:      sizeof data, NULL);",
          "348:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "346:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "347:     var_push_dtor(var_hash, old_data);",
          "348:    }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "484: {",
          "485:  YYCTYPE yych;",
          "486:  static const unsigned char yybm[] = {",
          "",
          "[Removed Lines]",
          "483: #line 484 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "486: #line 487 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "540:  yych = *(YYMARKER = ++YYCURSOR);",
          "541:  if (yych == ':') goto yy95;",
          "542: yy3:",
          "544:  { return 0; }",
          "546: yy4:",
          "547:  yych = *(YYMARKER = ++YYCURSOR);",
          "548:  if (yych == ':') goto yy89;",
          "",
          "[Removed Lines]",
          "543: #line 835 \"ext/standard/var_unserializer.re\"",
          "545: #line 546 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "546: #line 838 \"ext/standard/var_unserializer.re\"",
          "548: #line 549 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "585:  goto yy3;",
          "586: yy14:",
          "587:  ++YYCURSOR;",
          "589:  {",
          "591:  php_error_docref(NULL TSRMLS_CC, E_NOTICE, \"Unexpected end of serialized data\");",
          "593: }",
          "595: yy16:",
          "596:  yych = *++YYCURSOR;",
          "597:  goto yy3;",
          "",
          "[Removed Lines]",
          "588: #line 829 \"ext/standard/var_unserializer.re\"",
          "594: #line 595 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "591: #line 832 \"ext/standard/var_unserializer.re\"",
          "597: #line 598 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "617:  if (yybm[0+yych] & 128) {",
          "618:   goto yy20;",
          "619:  }",
          "621:  yych = *++YYCURSOR;",
          "622:  if (yych != '\"') goto yy18;",
          "623:  ++YYCURSOR;",
          "625:  {",
          "626:  size_t len, len2, len3, maxlen;",
          "627:  long elements;",
          "",
          "[Removed Lines]",
          "620:  if (yych != ':') goto yy18;",
          "624: #line 683 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "623:  if (yych <= '/') goto yy18;",
          "624:  if (yych >= ';') goto yy18;",
          "628: #line 686 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "768:  return object_common2(UNSERIALIZE_PASSTHRU, elements);",
          "769: }",
          "771: yy25:",
          "772:  yych = *++YYCURSOR;",
          "773:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "770: #line 771 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "774: #line 775 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "792:  yych = *++YYCURSOR;",
          "793:  if (yych != '\"') goto yy18;",
          "794:  ++YYCURSOR;",
          "796:  {",
          "798:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "795: #line 675 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "799: #line 678 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "800:  return object_common2(UNSERIALIZE_PASSTHRU,",
          "801:    object_common1(UNSERIALIZE_PASSTHRU, ZEND_STANDARD_CLASS_DEF_PTR));",
          "802: }",
          "804: yy32:",
          "805:  yych = *++YYCURSOR;",
          "806:  if (yych == '+') goto yy33;",
          "",
          "[Removed Lines]",
          "803: #line 804 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "807: #line 808 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "821:  yych = *++YYCURSOR;",
          "822:  if (yych != '{') goto yy18;",
          "823:  ++YYCURSOR;",
          "825:  {",
          "826:  long elements = parse_iv(start + 2);",
          "",
          "[Removed Lines]",
          "824: #line 655 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "828: #line 658 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "842:  return finish_nested_data(UNSERIALIZE_PASSTHRU);",
          "843: }",
          "845: yy39:",
          "846:  yych = *++YYCURSOR;",
          "847:  if (yych == '+') goto yy40;",
          "",
          "[Removed Lines]",
          "844: #line 845 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "848: #line 849 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "862:  yych = *++YYCURSOR;",
          "863:  if (yych != '\"') goto yy18;",
          "864:  ++YYCURSOR;",
          "866:  {",
          "867:  size_t len, maxlen;",
          "868:  char *str;",
          "",
          "[Removed Lines]",
          "865: #line 626 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "869: #line 629 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "891:  ZVAL_STRINGL(*rval, str, len, 0);",
          "892:  return 1;",
          "893: }",
          "895: yy46:",
          "896:  yych = *++YYCURSOR;",
          "897:  if (yych == '+') goto yy47;",
          "",
          "[Removed Lines]",
          "894: #line 895 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "898: #line 899 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "912:  yych = *++YYCURSOR;",
          "913:  if (yych != '\"') goto yy18;",
          "914:  ++YYCURSOR;",
          "916:  {",
          "917:  size_t len, maxlen;",
          "918:  char *str;",
          "",
          "[Removed Lines]",
          "915: #line 598 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "919: #line 601 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "940:  ZVAL_STRINGL(*rval, str, len, 1);",
          "941:  return 1;",
          "942: }",
          "944: yy53:",
          "945:  yych = *++YYCURSOR;",
          "946:  if (yych <= '/') {",
          "",
          "[Removed Lines]",
          "943: #line 944 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "947: #line 948 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "1028:  }",
          "1029: yy63:",
          "1030:  ++YYCURSOR;",
          "1032:  {",
          "1033: #if SIZEOF_LONG == 4",
          "1034: use_double:",
          "",
          "[Removed Lines]",
          "1031: #line 588 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1035: #line 591 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "1038:  ZVAL_DOUBLE(*rval, zend_strtod((const char *)start + 2, NULL));",
          "1039:  return 1;",
          "1040: }",
          "1042: yy65:",
          "1043:  yych = *++YYCURSOR;",
          "1044:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1041: #line 1042 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1045: #line 1046 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "1097:  yych = *++YYCURSOR;",
          "1098:  if (yych != ';') goto yy18;",
          "1099:  ++YYCURSOR;",
          "1101:  {",
          "1103:  INIT_PZVAL(*rval);",
          "",
          "[Removed Lines]",
          "1100: #line 573 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1104: #line 576 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "1113:  return 1;",
          "1114: }",
          "1116: yy76:",
          "1117:  yych = *++YYCURSOR;",
          "1118:  if (yych == 'N') goto yy73;",
          "",
          "[Removed Lines]",
          "1115: #line 1116 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1119: #line 1120 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "1139:  if (yych <= '9') goto yy79;",
          "1140:  if (yych != ';') goto yy18;",
          "1141:  ++YYCURSOR;",
          "1143:  {",
          "1144: #if SIZEOF_LONG == 4",
          "1145:  int digits = YYCURSOR - start - 3;",
          "",
          "[Removed Lines]",
          "1142: #line 546 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1146: #line 549 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "1166:  ZVAL_LONG(*rval, parse_iv(start + 2));",
          "1167:  return 1;",
          "1168: }",
          "1170: yy83:",
          "1171:  yych = *++YYCURSOR;",
          "1172:  if (yych <= '/') goto yy18;",
          "",
          "[Removed Lines]",
          "1169: #line 1170 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1173: #line 1174 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "1174:  yych = *++YYCURSOR;",
          "1175:  if (yych != ';') goto yy18;",
          "1176:  ++YYCURSOR;",
          "1178:  {",
          "1180:  INIT_PZVAL(*rval);",
          "1181:  ZVAL_BOOL(*rval, parse_iv(start + 2));",
          "1182:  return 1;",
          "1183: }",
          "1185: yy87:",
          "1186:  ++YYCURSOR;",
          "1188:  {",
          "1190:  INIT_PZVAL(*rval);",
          "1191:  ZVAL_NULL(*rval);",
          "1192:  return 1;",
          "1193: }",
          "1195: yy89:",
          "1196:  yych = *++YYCURSOR;",
          "1197:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1177: #line 539 \"ext/standard/var_unserializer.re\"",
          "1184: #line 1185 \"ext/standard/var_unserializer.c\"",
          "1187: #line 532 \"ext/standard/var_unserializer.re\"",
          "1194: #line 1195 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1181: #line 542 \"ext/standard/var_unserializer.re\"",
          "1188: #line 1189 \"ext/standard/var_unserializer.c\"",
          "1191: #line 535 \"ext/standard/var_unserializer.re\"",
          "1198: #line 1199 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "1214:  if (yych <= '9') goto yy91;",
          "1215:  if (yych != ';') goto yy18;",
          "1216:  ++YYCURSOR;",
          "1218:  {",
          "1219:  long id;",
          "",
          "[Removed Lines]",
          "1217: #line 509 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1221: #line 512 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "1238:  return 1;",
          "1239: }",
          "1241: yy95:",
          "1242:  yych = *++YYCURSOR;",
          "1243:  if (yych <= ',') {",
          "",
          "[Removed Lines]",
          "1240: #line 1241 \"ext/standard/var_unserializer.c\"",
          "",
          "[Added Lines]",
          "1244: #line 1245 \"ext/standard/var_unserializer.c\"",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "1260:  if (yych <= '9') goto yy97;",
          "1261:  if (yych != ';') goto yy18;",
          "1262:  ++YYCURSOR;",
          "1264:  {",
          "1265:  long id;",
          "",
          "[Removed Lines]",
          "1263: #line 488 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1267: #line 491 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "1282:  return 1;",
          "1283: }",
          "1285: }",
          "1289:  return 0;",
          "",
          "[Removed Lines]",
          "1284: #line 1285 \"ext/standard/var_unserializer.c\"",
          "1286: #line 837 \"ext/standard/var_unserializer.re\"",
          "",
          "[Added Lines]",
          "1288: #line 1289 \"ext/standard/var_unserializer.c\"",
          "1290: #line 840 \"ext/standard/var_unserializer.re\"",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "347:   } else {",
          "349:    convert_to_string(key);",
          "350:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "351:      sizeof data, NULL);",
          "352:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "350:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "351:     var_push_dtor(var_hash, old_data);",
          "352:    }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6735df19b8a1c4095e2d6716fcd058582fa05930",
      "candidate_info": {
        "commit_hash": "6735df19b8a1c4095e2d6716fcd058582fa05930",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/6735df19b8a1c4095e2d6716fcd058582fa05930",
        "files": [
          "ext/standard/tests/strings/bug68710.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix for bug #68710 (Use After Free Vulnerability in PHP's unserialize())\n\nConflicts:\n\text/standard/var_unserializer.c",
        "before_after_code_files": [
          "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt": [
          "File: ext/standard/tests/strings/bug68710.phpt -> ext/standard/tests/strings/bug68710.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68710 Use after free vulnerability in unserialize() (bypassing the",
          "3: CVE-2014-8142 fix)",
          "4: --FILE--",
          "5: <?php",
          "6: for ($i=4; $i<100; $i++) {",
          "7:     $m = new StdClass();",
          "9:     $u = array(1);",
          "11:     $m->aaa = array(1,2,&$u,4,5);",
          "12:     $m->bbb = 1;",
          "13:     $m->ccc = &$u;",
          "14:     $m->ddd = str_repeat(\"A\", $i);",
          "16:     $z = serialize($m);",
          "17:     $z = str_replace(\"aaa\", \"123\", $z);",
          "18:     $z = str_replace(\"bbb\", \"123\", $z);",
          "19:     $y = unserialize($z);",
          "20:     $z = serialize($y);",
          "21: }",
          "22: ?>",
          "23: ===DONE===",
          "24: --EXPECTF--",
          "25: ===DONE===",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "343:   } else {",
          "345:    convert_to_string(key);",
          "347:     var_push_dtor(var_hash, old_data);",
          "348:    }",
          "349:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "",
          "[Removed Lines]",
          "346:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "[Added Lines]",
          "346:    if (zend_hash_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "347:   } else {",
          "349:    convert_to_string(key);",
          "351:     var_push_dtor(var_hash, old_data);",
          "352:    }",
          "353:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "",
          "[Removed Lines]",
          "350:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "[Added Lines]",
          "350:    if (zend_hash_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f4f068000ba3b99c0d9910fa11d2ca13d748958b",
      "candidate_info": {
        "commit_hash": "f4f068000ba3b99c0d9910fa11d2ca13d748958b",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/f4f068000ba3b99c0d9910fa11d2ca13d748958b",
        "files": [
          "ext/standard/tests/strings/bug68710.phpt",
          "ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re"
        ],
        "message": "Fix for bug #68710 (Use After Free Vulnerability in PHP's unserialize())\n\nConflicts:\n\text/standard/var_unserializer.c",
        "before_after_code_files": [
          "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt",
          "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
          "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ],
          "candidate": [
            "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt",
            "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c",
            "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re"
          ]
        }
      },
      "candidate_diff": {
        "ext/standard/tests/strings/bug68710.phpt||ext/standard/tests/strings/bug68710.phpt": [
          "File: ext/standard/tests/strings/bug68710.phpt -> ext/standard/tests/strings/bug68710.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #68710 Use after free vulnerability in unserialize() (bypassing the",
          "3: CVE-2014-8142 fix)",
          "4: --FILE--",
          "5: <?php",
          "6: for ($i=4; $i<100; $i++) {",
          "7:     $m = new StdClass();",
          "9:     $u = array(1);",
          "11:     $m->aaa = array(1,2,&$u,4,5);",
          "12:     $m->bbb = 1;",
          "13:     $m->ccc = &$u;",
          "14:     $m->ddd = str_repeat(\"A\", $i);",
          "16:     $z = serialize($m);",
          "17:     $z = str_replace(\"aaa\", \"123\", $z);",
          "18:     $z = str_replace(\"bbb\", \"123\", $z);",
          "19:     $y = unserialize($z);",
          "20:     $z = serialize($y);",
          "21: }",
          "22: ?>",
          "23: ===DONE===",
          "24: --EXPECTF--",
          "25: ===DONE===",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.c||ext/standard/var_unserializer.c": [
          "File: ext/standard/var_unserializer.c -> ext/standard/var_unserializer.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "342:   } else {",
          "344:    convert_to_string(key);",
          "346:     var_push_dtor(var_hash, old_data);",
          "347:    }",
          "348:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "",
          "[Removed Lines]",
          "345:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "[Added Lines]",
          "345:    if (zend_hash_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "---------------"
        ],
        "ext/standard/var_unserializer.re||ext/standard/var_unserializer.re": [
          "File: ext/standard/var_unserializer.re -> ext/standard/var_unserializer.re",
          "--- Hunk 1 ---",
          "[Context before]",
          "346:   } else {",
          "348:    convert_to_string(key);",
          "350:     var_push_dtor(var_hash, old_data);",
          "351:    }",
          "352:    zend_hash_update(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, &data,",
          "",
          "[Removed Lines]",
          "349:    if (zend_symtable_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "[Added Lines]",
          "349:    if (zend_hash_find(ht, Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, (void **)&old_data)==SUCCESS) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}