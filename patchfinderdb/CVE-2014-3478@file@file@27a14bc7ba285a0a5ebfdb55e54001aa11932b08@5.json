{
  "cve_id": "CVE-2014-3478",
  "cve_desc": "Buffer overflow in the mconvert function in softmagic.c in file before 5.19, as used in the Fileinfo component in PHP before 5.4.30 and 5.5.x before 5.5.14, allows remote attackers to cause a denial of service (application crash) via a crafted Pascal string in a FILE_PSTRING conversion.",
  "repo": "file/file",
  "patch_hash": "27a14bc7ba285a0a5ebfdb55e54001aa11932b08",
  "patch_info": {
    "commit_hash": "27a14bc7ba285a0a5ebfdb55e54001aa11932b08",
    "repo": "file/file",
    "commit_url": "https://github.com/file/file/commit/27a14bc7ba285a0a5ebfdb55e54001aa11932b08",
    "files": [
      "src/softmagic.c"
    ],
    "message": "Correctly compute the truncated pascal string size (Francisco Alonso and Jan Kaluza at RedHat)",
    "before_after_code_files": [
      "src/softmagic.c||src/softmagic.c"
    ]
  },
  "patch_diff": {
    "src/softmagic.c||src/softmagic.c": [
      "File: src/softmagic.c -> src/softmagic.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "32: #include \"file.h\"",
      "34: #ifndef lint",
      "38: #include \"magic.h\"",
      "",
      "[Removed Lines]",
      "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.189 2014/05/30 16:47:44 christos Exp $\")",
      "",
      "[Added Lines]",
      "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.190 2014/06/03 19:01:34 christos Exp $\")",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "940:   return 1;",
      "941:  }",
      "942:  case FILE_PSTRING: {",
      "944:   size_t len = file_pstring_get_length(m, ptr1);",
      "947:   while (len--)",
      "",
      "[Removed Lines]",
      "943:   char *ptr1 = p->s, *ptr2 = ptr1 + file_pstring_length_size(m);",
      "945:   if (len >= sizeof(p->s))",
      "946:    len = sizeof(p->s) - 1;",
      "",
      "[Added Lines]",
      "943:   size_t sz = file_pstring_length_size(m);",
      "944:   char *ptr1 = p->s, *ptr2 = ptr1 + sz;",
      "946:   if (len >= sizeof(p->s)) {",
      "953:    len = sizeof(p->s) - sz;",
      "954:   }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3c081560c23f20b2985c285338b52c7aae9fdb0f",
      "candidate_info": {
        "commit_hash": "3c081560c23f20b2985c285338b52c7aae9fdb0f",
        "repo": "file/file",
        "commit_url": "https://github.com/file/file/commit/3c081560c23f20b2985c285338b52c7aae9fdb0f",
        "files": [
          "src/softmagic.c"
        ],
        "message": "prevent infinite recursion.",
        "before_after_code_files": [
          "src/softmagic.c||src/softmagic.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/softmagic.c||src/softmagic.c"
          ],
          "candidate": [
            "src/softmagic.c||src/softmagic.c"
          ]
        }
      },
      "candidate_diff": {
        "src/softmagic.c||src/softmagic.c": [
          "File: src/softmagic.c -> src/softmagic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.171 2014/01/08 22:02:06 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.172 2014/01/08 22:22:54 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1738:   break;",
          "1740:  case FILE_INDIRECT:",
          "1741:   if (OFFSET_OOB(nbytes, offset, 0))",
          "1742:    return 0;",
          "1743:   sbuf = ms->o.buf;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1741:   if (offset == 0)",
          "1742:    return 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c397fb230f70cfa1dc8f3d387f4df8ebec6c1a63",
      "candidate_info": {
        "commit_hash": "c397fb230f70cfa1dc8f3d387f4df8ebec6c1a63",
        "repo": "file/file",
        "commit_url": "https://github.com/file/file/commit/c397fb230f70cfa1dc8f3d387f4df8ebec6c1a63",
        "files": [
          "ChangeLog",
          "src/funcs.c",
          "src/readcdf.c",
          "src/softmagic.c"
        ],
        "message": "Cache old LC_CTYPE locale for restoring it later.\n\nCache old LC_CTYPE locale before setting it to \"C\", so\nwe can use it to restore LC_CTYPE instead of asking\nsetlocale() to scan the environment variables.",
        "before_after_code_files": [
          "src/funcs.c||src/funcs.c",
          "src/readcdf.c||src/readcdf.c",
          "src/softmagic.c||src/softmagic.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/softmagic.c||src/softmagic.c"
          ],
          "candidate": [
            "src/softmagic.c||src/softmagic.c"
          ]
        }
      },
      "candidate_diff": {
        "src/funcs.c||src/funcs.c": [
          "File: src/funcs.c -> src/funcs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: #include \"file.h\"",
          "29: #ifndef lint",
          "33: #include \"magic.h\"",
          "34: #include <stdarg.h>",
          "35: #include <stdlib.h>",
          "36: #include <string.h>",
          "",
          "[Removed Lines]",
          "30: FILE_RCSID(\"@(#)$File: funcs.c,v 1.66 2014/01/07 03:15:09 christos Exp $\")",
          "",
          "[Added Lines]",
          "30: FILE_RCSID(\"@(#)$File: funcs.c,v 1.67 2014/02/12 23:20:53 christos Exp $\")",
          "34: #include <assert.h>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "442: {",
          "443:  regex_t rx;",
          "444:  int rc, rv = -1;",
          "446:  (void)setlocale(LC_CTYPE, \"C\");",
          "447:  rc = regcomp(&rx, pat, REG_EXTENDED);",
          "448:  if (rc) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "446:  char *old_lc_ctype;",
          "448:  old_lc_ctype = setlocale(LC_CTYPE, NULL);",
          "449:  assert(old_lc_ctype != NULL);",
          "450:  old_lc_ctype = strdup(old_lc_ctype);",
          "451:  assert(old_lc_ctype != NULL);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "463:   rv = nm;",
          "464:  }",
          "465: out:",
          "467:  return rv;",
          "468: }",
          "",
          "[Removed Lines]",
          "466:  (void)setlocale(LC_CTYPE, \"\");",
          "",
          "[Added Lines]",
          "472:  (void)setlocale(LC_CTYPE, old_lc_ctype);",
          "473:  free(old_lc_ctype);",
          "",
          "---------------"
        ],
        "src/readcdf.c||src/readcdf.c": [
          "File: src/readcdf.c -> src/readcdf.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "26: #include \"file.h\"",
          "28: #ifndef lint",
          "30: #endif",
          "32: #include <stdlib.h>",
          "33: #include <unistd.h>",
          "34: #include <string.h>",
          "",
          "[Removed Lines]",
          "29: FILE_RCSID(\"@(#)$File: readcdf.c,v 1.36 2013/12/05 17:02:34 christos Exp $\")",
          "",
          "[Added Lines]",
          "29: FILE_RCSID(\"@(#)$File: readcdf.c,v 1.37 2014/01/06 13:41:18 rrt Exp $\")",
          "32: #include <assert.h>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "74: {",
          "75:  size_t i;",
          "76:  const char *rv = NULL;",
          "78:  (void)setlocale(LC_CTYPE, \"C\");",
          "79:  for (i = 0; nv[i].pattern != NULL; i++)",
          "80:   if (strcasestr(vbuf, nv[i].pattern) != NULL) {",
          "81:    rv = nv[i].mime;",
          "82:    break;",
          "83:   }",
          "85:  return rv;",
          "86: }",
          "",
          "[Removed Lines]",
          "84:  (void)setlocale(LC_CTYPE, \"\");",
          "",
          "[Added Lines]",
          "78:  char *old_lc_ctype;",
          "80:  old_lc_ctype = setlocale(LC_CTYPE, NULL);",
          "81:  assert(old_lc_ctype != NULL);",
          "82:  old_lc_ctype = strdup(old_lc_ctype);",
          "83:  assert(old_lc_ctype != NULL);",
          "90:  (void)setlocale(LC_CTYPE, old_lc_ctype);",
          "91:  free(old_lc_ctype);",
          "",
          "---------------"
        ],
        "src/softmagic.c||src/softmagic.c": [
          "File: src/softmagic.c -> src/softmagic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.173 2014/02/11 15:41:25 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.174 2014/02/12 23:20:53 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "42: #else",
          "43: #define F(a, b) (a)",
          "44: #endif",
          "45: #include <string.h>",
          "46: #include <ctype.h>",
          "47: #include <stdlib.h>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "45: #include <assert.h>",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352: {",
          "353:  regex_t rx;",
          "354:  int rc, rv = -1;",
          "356:  if (strchr(m->desc, '%') == NULL)",
          "357:   return 0;",
          "359:  (void)setlocale(LC_CTYPE, \"C\");",
          "360:  rc = regcomp(&rx, \"%[-0-9\\\\.]*s\", REG_EXTENDED|REG_NOSUB);",
          "361:  if (rc) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "356:  char *old_lc_ctype;",
          "361:  old_lc_ctype = setlocale(LC_CTYPE, NULL);",
          "362:  assert(old_lc_ctype != NULL);",
          "363:  old_lc_ctype = strdup(old_lc_ctype);",
          "364:  assert(old_lc_ctype != NULL);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "367:   regfree(&rx);",
          "368:   rv = !rc;",
          "369:  }",
          "371:  return rv;",
          "372: }",
          "",
          "[Removed Lines]",
          "370:  (void)setlocale(LC_CTYPE, \"\");",
          "",
          "[Added Lines]",
          "376:  (void)setlocale(LC_CTYPE, old_lc_ctype);",
          "377:  free(old_lc_ctype);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "447558595a3650db2886cd2f416ad0beba965801",
      "candidate_info": {
        "commit_hash": "447558595a3650db2886cd2f416ad0beba965801",
        "repo": "file/file",
        "commit_url": "https://github.com/file/file/commit/447558595a3650db2886cd2f416ad0beba965801",
        "files": [
          "src/softmagic.c"
        ],
        "message": "PR/313: Aaron Reffett: Check properly for exceeding the offset.",
        "before_after_code_files": [
          "src/softmagic.c||src/softmagic.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/softmagic.c||src/softmagic.c"
          ],
          "candidate": [
            "src/softmagic.c||src/softmagic.c"
          ]
        }
      },
      "candidate_diff": {
        "src/softmagic.c||src/softmagic.c": [
          "File: src/softmagic.c -> src/softmagic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.170 2014/01/06 02:25:32 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.171 2014/01/08 22:02:06 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "71: private void cvt_32(union VALUETYPE *, const struct magic *);",
          "72: private void cvt_64(union VALUETYPE *, const struct magic *);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "74: #define OFFSET_OOB(n, o, i) ((n) < (o) || (i) >= ((n) - (o)))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1223:   }",
          "1224:   switch (in_type = cvt_flip(m->in_type, flip)) {",
          "1225:   case FILE_BYTE:",
          "1227:     return 0;",
          "1228:    if (off) {",
          "1229:     switch (m->in_op & FILE_OPS_MASK) {",
          "",
          "[Removed Lines]",
          "1226:    if (nbytes < offset || nbytes < (offset + 1))",
          "",
          "[Added Lines]",
          "1227:    if (OFFSET_OOB(nbytes, offset, 1))",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1258:     offset = ~offset;",
          "1259:    break;",
          "1260:   case FILE_BESHORT:",
          "1262:     return 0;",
          "1263:    if (off) {",
          "1264:     switch (m->in_op & FILE_OPS_MASK) {",
          "",
          "[Removed Lines]",
          "1261:    if (nbytes < offset || nbytes < (offset + 2))",
          "",
          "[Added Lines]",
          "1262:    if (OFFSET_OOB(nbytes, offset, 2))",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1310:     offset = ~offset;",
          "1311:    break;",
          "1312:   case FILE_LESHORT:",
          "1314:     return 0;",
          "1315:    if (off) {",
          "1316:     switch (m->in_op & FILE_OPS_MASK) {",
          "",
          "[Removed Lines]",
          "1313:    if (nbytes < offset || nbytes < (offset + 2))",
          "",
          "[Added Lines]",
          "1314:    if (OFFSET_OOB(nbytes, offset, 2))",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1362:     offset = ~offset;",
          "1363:    break;",
          "1364:   case FILE_SHORT:",
          "1366:     return 0;",
          "1367:    if (off) {",
          "1368:     switch (m->in_op & FILE_OPS_MASK) {",
          "",
          "[Removed Lines]",
          "1365:    if (nbytes < offset || nbytes < (offset + 2))",
          "",
          "[Added Lines]",
          "1366:    if (OFFSET_OOB(nbytes, offset, 2))",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1399:    break;",
          "1400:   case FILE_BELONG:",
          "1401:   case FILE_BEID3:",
          "1403:     return 0;",
          "1404:    if (off) {",
          "1405:     switch (m->in_op & FILE_OPS_MASK) {",
          "",
          "[Removed Lines]",
          "1402:    if (nbytes < offset || nbytes < (offset + 4))",
          "",
          "[Added Lines]",
          "1403:    if (OFFSET_OOB(nbytes, offset, 4))",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1470:    break;",
          "1471:   case FILE_LELONG:",
          "1472:   case FILE_LEID3:",
          "1474:     return 0;",
          "1475:    if (off) {",
          "1476:     switch (m->in_op & FILE_OPS_MASK) {",
          "",
          "[Removed Lines]",
          "1473:    if (nbytes < offset || nbytes < (offset + 4))",
          "",
          "[Added Lines]",
          "1474:    if (OFFSET_OOB(nbytes, offset, 4))",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1540:     offset = ~offset;",
          "1541:    break;",
          "1542:   case FILE_MELONG:",
          "1544:     return 0;",
          "1545:    if (off) {",
          "1546:     switch (m->in_op & FILE_OPS_MASK) {",
          "",
          "[Removed Lines]",
          "1543:    if (nbytes < offset || nbytes < (offset + 4))",
          "",
          "[Added Lines]",
          "1544:    if (OFFSET_OOB(nbytes, offset, 4))",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "1610:     offset = ~offset;",
          "1611:    break;",
          "1612:   case FILE_LONG:",
          "1614:     return 0;",
          "1615:    if (off) {",
          "1616:     switch (m->in_op & FILE_OPS_MASK) {",
          "",
          "[Removed Lines]",
          "1613:    if (nbytes < offset || nbytes < (offset + 4))",
          "",
          "[Added Lines]",
          "1614:    if (OFFSET_OOB(nbytes, offset, 4))",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "1688:  switch (m->type) {",
          "1689:  case FILE_BYTE:",
          "1691:    return 0;",
          "1692:   break;",
          "1694:  case FILE_SHORT:",
          "1695:  case FILE_BESHORT:",
          "1696:  case FILE_LESHORT:",
          "1698:    return 0;",
          "1699:   break;",
          "",
          "[Removed Lines]",
          "1697:   if (nbytes < (offset + 2))",
          "",
          "[Added Lines]",
          "1691:   if (OFFSET_OOB(nbytes, offset, 1))",
          "1698:   if (OFFSET_OOB(nbytes, offset, 2))",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "1713:  case FILE_FLOAT:",
          "1714:  case FILE_BEFLOAT:",
          "1715:  case FILE_LEFLOAT:",
          "1717:    return 0;",
          "1718:   break;",
          "1720:  case FILE_DOUBLE:",
          "1721:  case FILE_BEDOUBLE:",
          "1722:  case FILE_LEDOUBLE:",
          "1724:    return 0;",
          "1725:   break;",
          "1727:  case FILE_STRING:",
          "1728:  case FILE_PSTRING:",
          "1729:  case FILE_SEARCH:",
          "1731:    return 0;",
          "1732:   break;",
          "1734:  case FILE_REGEX:",
          "1736:    return 0;",
          "1737:   break;",
          "1739:  case FILE_INDIRECT:",
          "1741:    return 0;",
          "1742:   sbuf = ms->o.buf;",
          "1743:   soffset = ms->offset;",
          "",
          "[Removed Lines]",
          "1716:   if (nbytes < (offset + 4))",
          "1723:   if (nbytes < (offset + 8))",
          "1730:   if (nbytes < (offset + m->vallen))",
          "1735:   if (nbytes < offset)",
          "1740:   if (nbytes < offset)",
          "",
          "[Added Lines]",
          "1717:   if (OFFSET_OOB(nbytes, offset, 4))",
          "1724:   if (OFFSET_OOB(nbytes, offset, 8))",
          "1731:   if (OFFSET_OOB(nbytes, offset, m->vallen))",
          "1736:   if (OFFSET_OOB(nbytes, offset, 0))",
          "1741:   if (OFFSET_OOB(nbytes, offset, 0))",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "1761:   return rv;",
          "1763:  case FILE_USE:",
          "1765:    return 0;",
          "1766:   sbuf = m->value.s;",
          "1767:   if (*sbuf == '^') {",
          "",
          "[Removed Lines]",
          "1764:   if (nbytes < offset)",
          "",
          "[Added Lines]",
          "1765:   if (OFFSET_OOB(nbytes, offset, 0))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "83ee9673286e441ceae61a2ae055899902efae1e",
      "candidate_info": {
        "commit_hash": "83ee9673286e441ceae61a2ae055899902efae1e",
        "repo": "file/file",
        "commit_url": "https://github.com/file/file/commit/83ee9673286e441ceae61a2ae055899902efae1e",
        "files": [
          "src/apprentice.c",
          "src/softmagic.c"
        ],
        "message": "Roman I Khimov: Remove useless assignments found by clang static analysis.",
        "before_after_code_files": [
          "src/apprentice.c||src/apprentice.c",
          "src/softmagic.c||src/softmagic.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/softmagic.c||src/softmagic.c"
          ],
          "candidate": [
            "src/softmagic.c||src/softmagic.c"
          ]
        }
      },
      "candidate_diff": {
        "src/apprentice.c||src/apprentice.c": [
          "File: src/apprentice.c -> src/apprentice.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: apprentice.c,v 1.207 2014/05/04 18:57:35 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: apprentice.c,v 1.208 2014/05/06 16:07:23 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "783:   break;",
          "785:  default:",
          "787:   (void)fprintf(stderr, \"Bad type %d\\n\", m->type);",
          "788:   abort();",
          "789:  }",
          "",
          "[Removed Lines]",
          "786:   val = 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/softmagic.c||src/softmagic.c": [
          "File: src/softmagic.c -> src/softmagic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.185 2014/04/30 21:41:02 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.186 2014/05/05 20:53:10 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1835:    break;",
          "1837:   default:",
          "1839:    file_magerror(ms, \"cannot happen with float: invalid relation `%c'\",",
          "1840:        m->reln);",
          "1841:    return -1;",
          "",
          "[Removed Lines]",
          "1838:    matched = 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1869:    break;",
          "1871:   default:",
          "1873:    file_magerror(ms, \"cannot happen with double: invalid relation `%c'\", m->reln);",
          "1874:    return -1;",
          "1875:   }",
          "",
          "[Removed Lines]",
          "1872:    matched = 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2062:   break;",
          "2064:  default:",
          "2066:   file_magerror(ms, \"cannot happen: invalid relation `%c'\",",
          "2067:       m->reln);",
          "2068:   return -1;",
          "",
          "[Removed Lines]",
          "2065:   matched = 0;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "74cafd7de9ec99a14f4480927580e501c8f852c3",
      "candidate_info": {
        "commit_hash": "74cafd7de9ec99a14f4480927580e501c8f852c3",
        "repo": "file/file",
        "commit_url": "https://github.com/file/file/commit/74cafd7de9ec99a14f4480927580e501c8f852c3",
        "files": [
          "src/softmagic.c"
        ],
        "message": "If requested, limit search length.",
        "before_after_code_files": [
          "src/softmagic.c||src/softmagic.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/softmagic.c||src/softmagic.c"
          ],
          "candidate": [
            "src/softmagic.c||src/softmagic.c"
          ]
        }
      },
      "candidate_diff": {
        "src/softmagic.c||src/softmagic.c": [
          "File: src/softmagic.c -> src/softmagic.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: #include \"file.h\"",
          "34: #ifndef lint",
          "38: #include \"magic.h\"",
          "",
          "[Removed Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.187 2014/05/13 16:42:17 christos Exp $\")",
          "",
          "[Added Lines]",
          "35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.188 2014/05/14 23:15:42 christos Exp $\")",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1929:    file_regerror(&rx, rc, ms);",
          "1930:    v = (uint64_t)-1;",
          "1931:   } else {",
          "1932:    regmatch_t pmatch[1];",
          "1933: #ifndef REG_STARTEND",
          "1934: #define REG_STARTEND 0",
          "1938: #else",
          "1939:    pmatch[0].rm_so = 0;",
          "1941: #endif",
          "1942:    rc = file_regexec(&rx, (const char *)ms->search.s,",
          "1943:        1, pmatch, REG_STARTEND);",
          "",
          "[Removed Lines]",
          "1935:    size_t l = ms->search.s_len - 1;",
          "1936:    char c = ms->search.s[l];",
          "1937:    ((char *)(intptr_t)ms->search.s)[l] = '\\0';",
          "1940:    pmatch[0].rm_eo = ms->search.s_len;",
          "",
          "[Added Lines]",
          "1932: #ifndef REG_STARTEND",
          "1933:    char c;",
          "1934: #endif",
          "1936:    size_t slen = ms->search.s_len;",
          "1938:    if (m->str_range > 0)",
          "1939:     slen = MIN(slen, m->str_range);",
          "1942:    if (slen != 0)",
          "1943:     slen--;",
          "1944:    c = ms->search.s[slen];",
          "1945:    ((char *)(intptr_t)ms->search.s)[slen] = '\\0';",
          "1948:    pmatch[0].rm_eo = slen;",
          "",
          "---------------"
        ]
      }
    }
  ]
}