{
  "cve_id": "CVE-2013-4530",
  "cve_desc": "Buffer overflow in hw/ssi/pl022.c in QEMU before 1.7.2 allows remote attackers to cause a denial of service or possibly execute arbitrary code via crafted tx_fifo_head and rx_fifo_head values in a savevm image.",
  "repo": "qemu/qemu",
  "patch_hash": "d8d0a0bc7e194300e53a346d25fe5724fd588387",
  "patch_info": {
    "commit_hash": "d8d0a0bc7e194300e53a346d25fe5724fd588387",
    "repo": "qemu/qemu",
    "commit_url": "https://github.com/qemu/qemu/commit/d8d0a0bc7e194300e53a346d25fe5724fd588387",
    "files": [
      "hw/ssi/pl022.c"
    ],
    "message": "pl022: fix buffer overun on invalid state load\n\nCVE-2013-4530\n\npl022.c did not bounds check tx_fifo_head and\nrx_fifo_head after loading them from file and\nbefore they are used to dereference array.\n\nReported-by: Michael S. Tsirkin <mst@redhat.com\nReported-by: Anthony Liguori <anthony@codemonkey.ws>\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nSigned-off-by: Juan Quintela <quintela@redhat.com>",
    "before_after_code_files": [
      "hw/ssi/pl022.c||hw/ssi/pl022.c"
    ]
  },
  "patch_diff": {
    "hw/ssi/pl022.c||hw/ssi/pl022.c": [
      "File: hw/ssi/pl022.c -> hw/ssi/pl022.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "240:     .endianness = DEVICE_NATIVE_ENDIAN,",
      "241: };",
      "243: static const VMStateDescription vmstate_pl022 = {",
      "244:     .name = \"pl022_ssp\",",
      "245:     .version_id = 1,",
      "246:     .minimum_version_id = 1,",
      "247:     .minimum_version_id_old = 1,",
      "248:     .fields      = (VMStateField[]) {",
      "249:         VMSTATE_UINT32(cr0, PL022State),",
      "250:         VMSTATE_UINT32(cr1, PL022State),",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "243: static int pl022_post_load(void *opaque, int version_id)",
      "244: {",
      "245:     PL022State *s = opaque;",
      "247:     if (s->tx_fifo_head < 0 ||",
      "248:         s->tx_fifo_head >= ARRAY_SIZE(s->tx_fifo) ||",
      "249:         s->rx_fifo_head < 0 ||",
      "250:         s->rx_fifo_head >= ARRAY_SIZE(s->rx_fifo)) {",
      "251:         return -1;",
      "252:     }",
      "253:     return 0;",
      "254: }",
      "261:     .post_load = pl022_post_load,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "f217f379a8ce520cce1e905c33660ca5a7ecad1c",
      "candidate_info": {
        "commit_hash": "f217f379a8ce520cce1e905c33660ca5a7ecad1c",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/f217f379a8ce520cce1e905c33660ca5a7ecad1c",
        "files": [
          "hw/ssi/pl022.c"
        ],
        "message": "pl022: fix buffer overun on invalid state load\n\nCVE-2013-4530\n\npl022.c did not bounds check tx_fifo_head and\nrx_fifo_head after loading them from file and\nbefore they are used to dereference array.\n\nReported-by: Michael S. Tsirkin <mst@redhat.com\nReported-by: Anthony Liguori <anthony@codemonkey.ws>\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nSigned-off-by: Juan Quintela <quintela@redhat.com>\n(cherry picked from commit d8d0a0bc7e194300e53a346d25fe5724fd588387)\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "hw/ssi/pl022.c||hw/ssi/pl022.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "hw/ssi/pl022.c||hw/ssi/pl022.c"
          ],
          "candidate": [
            "hw/ssi/pl022.c||hw/ssi/pl022.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/ssi/pl022.c||hw/ssi/pl022.c": [
          "File: hw/ssi/pl022.c -> hw/ssi/pl022.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "240:     .endianness = DEVICE_NATIVE_ENDIAN,",
          "241: };",
          "243: static const VMStateDescription vmstate_pl022 = {",
          "244:     .name = \"pl022_ssp\",",
          "245:     .version_id = 1,",
          "246:     .minimum_version_id = 1,",
          "247:     .minimum_version_id_old = 1,",
          "248:     .fields      = (VMStateField[]) {",
          "249:         VMSTATE_UINT32(cr0, PL022State),",
          "250:         VMSTATE_UINT32(cr1, PL022State),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "243: static int pl022_post_load(void *opaque, int version_id)",
          "244: {",
          "245:     PL022State *s = opaque;",
          "247:     if (s->tx_fifo_head < 0 ||",
          "248:         s->tx_fifo_head >= ARRAY_SIZE(s->tx_fifo) ||",
          "249:         s->rx_fifo_head < 0 ||",
          "250:         s->rx_fifo_head >= ARRAY_SIZE(s->rx_fifo)) {",
          "251:         return -1;",
          "252:     }",
          "253:     return 0;",
          "254: }",
          "261:     .post_load = pl022_post_load,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7cf5f5d087e3c46a5d60081443bc42b7c6f3ba1e",
      "candidate_info": {
        "commit_hash": "7cf5f5d087e3c46a5d60081443bc42b7c6f3ba1e",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/7cf5f5d087e3c46a5d60081443bc42b7c6f3ba1e",
        "files": [
          "hw/ssi/pl022.c"
        ],
        "message": "pl022: fix buffer overun on invalid state load\n\nCVE-2013-4530\n\npl022.c did not bounds check tx_fifo_head and\nrx_fifo_head after loading them from file and\nbefore they are used to dereference array.\n\nReported-by: Michael S. Tsirkin <mst@redhat.com\nReported-by: Anthony Liguori <anthony@codemonkey.ws>\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nSigned-off-by: Juan Quintela <quintela@redhat.com>\n(cherry picked from commit d8d0a0bc7e194300e53a346d25fe5724fd588387)\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "hw/ssi/pl022.c||hw/ssi/pl022.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "hw/ssi/pl022.c||hw/ssi/pl022.c"
          ],
          "candidate": [
            "hw/ssi/pl022.c||hw/ssi/pl022.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/ssi/pl022.c||hw/ssi/pl022.c": [
          "File: hw/ssi/pl022.c -> hw/ssi/pl022.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "240:     .endianness = DEVICE_NATIVE_ENDIAN,",
          "241: };",
          "243: static const VMStateDescription vmstate_pl022 = {",
          "244:     .name = \"pl022_ssp\",",
          "245:     .version_id = 1,",
          "246:     .minimum_version_id = 1,",
          "247:     .minimum_version_id_old = 1,",
          "248:     .fields      = (VMStateField[]) {",
          "249:         VMSTATE_UINT32(cr0, PL022State),",
          "250:         VMSTATE_UINT32(cr1, PL022State),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "243: static int pl022_post_load(void *opaque, int version_id)",
          "244: {",
          "245:     PL022State *s = opaque;",
          "247:     if (s->tx_fifo_head < 0 ||",
          "248:         s->tx_fifo_head >= ARRAY_SIZE(s->tx_fifo) ||",
          "249:         s->rx_fifo_head < 0 ||",
          "250:         s->rx_fifo_head >= ARRAY_SIZE(s->rx_fifo)) {",
          "251:         return -1;",
          "252:     }",
          "253:     return 0;",
          "254: }",
          "261:     .post_load = pl022_post_load,",
          "",
          "---------------"
        ]
      }
    }
  ]
}