{
  "cve_id": "CVE-2015-2268",
  "cve_desc": "filter/urltolink/filter.php in Moodle through 2.5.9, 2.6.x before 2.6.9, 2.7.x before 2.7.6, and 2.8.x before 2.8.4 allows remote authenticated users to cause a denial of service (CPU consumption or partial outage) via a crafted string that is matched against an improper regular expression.",
  "repo": "moodle/moodle",
  "patch_hash": "07323f50ffc71f8ba1b2914ec8947451e32a61c1",
  "patch_info": {
    "commit_hash": "07323f50ffc71f8ba1b2914ec8947451e32a61c1",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/07323f50ffc71f8ba1b2914ec8947451e32a61c1",
    "files": [
      "filter/urltolink/filter.php",
      "filter/urltolink/tests/filter_test.php"
    ],
    "message": "MDL-38466 filters: Redos protection and unit tests",
    "before_after_code_files": [
      "filter/urltolink/filter.php||filter/urltolink/filter.php",
      "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
    ]
  },
  "patch_diff": {
    "filter/urltolink/filter.php||filter/urltolink/filter.php": [
      "File: filter/urltolink/filter.php -> filter/urltolink/filter.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "145:         }",
      "152:         foreach ($matches as $idx => $chunk) {",
      "155:                 continue;",
      "156:             }",
      "",
      "[Removed Lines]",
      "148:         $matches = preg_split('/(<[^>]*>)/i', $text, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);",
      "149:         $lookingforendstyle = false;",
      "154:             if (strpos($chunk, '<') !== false) {",
      "",
      "[Added Lines]",
      "148:         $matches = preg_split('/(<[^<|>]*>)/i', $text, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);",
      "153:             if (strpos(trim($chunk), '<') === 0) {",
      "",
      "---------------"
    ],
    "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php": [
      "File: filter/urltolink/tests/filter_test.php -> filter/urltolink/tests/filter_test.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "29: require_once($CFG->dirroot . '/filter/urltolink/filter.php'); // Include the code to test",
      "34:     function get_convert_urls_into_links_test_cases() {",
      "",
      "[Removed Lines]",
      "32: class filter_urltolink_testcase extends basic_testcase {",
      "",
      "[Added Lines]",
      "32: class filter_urltolink_filter_testcase extends basic_testcase {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "159:             'URL: ' . $superlong4096 => 'URL: ' . $superlong4096,",
      "161:             'URL: <span style=\"kasd\"> my link to http://google.com </span>' => 'URL: <span style=\"kasd\"> my link to <a href=\"http://google.com\" class=\"_blanktarget\">http://google.com</a> </span>',",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "163:             '<b><i>www.google.com</i></b>' => '<b><i><a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a></i></b>',",
      "164:             '<input type=\"submit\" value=\"Go to http://moodle.org\">' => '<input type=\"submit\" value=\"Go to http://moodle.org\">',",
      "166:             '<p><span style=\"color: rgb(37, 37, 37); font-family: sans-serif; line-height: 22.3999996185303px;\">Lorem ipsum amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut http://google.com aliquip ex ea <a href=\"http://google.com\">commodo consequat</a>. Duis aute irure in reprehenderit in excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing mollit anim id est laborum.</span><br></p>'",
      "167:             =>",
      "168:             '<p><span style=\"color: rgb(37, 37, 37); font-family: sans-serif; line-height: 22.3999996185303px;\">Lorem ipsum amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut <a href=\"http://google.com\" class=\"_blanktarget\">http://google.com</a> aliquip ex ea <a href=\"http://google.com\">commodo consequat</a>. Duis aute irure in reprehenderit in excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia <a href=\"https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing\" class=\"_blanktarget\">https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing</a> <a href=\"https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing\" class=\"_blanktarget\">https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing</a> mollit anim id est laborum.</span><br></p>',",
      "170:             '5 < 10 www.google.com <a href=\"hi.com\">im a link</a>' => '5 < 10 <a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a> <a href=\"hi.com\">im a link</a>',",
      "171:             'h3 (www.styles.com/h3) < h1 (www.styles.com/h1)' => 'h3 (<a href=\"http://www.styles.com/h3\" class=\"_blanktarget\">www.styles.com/h3</a>) < h1 (<a href=\"http://www.styles.com/h1\" class=\"_blanktarget\">www.styles.com/h1</a>)',",
      "172:             '<p>text www.moodle.org&lt;/p> text' => '<p>text <a href=\"http://www.moodle.org\" class=\"_blanktarget\">www.moodle.org</a>&lt;/p> text',",
      "174:             '<link rel=\"search\" type=\"application/opensearchdescription+xml\" href=\"/osd.jsp\" title=\"Peer review - Moodle Tracker\"/>' => '<link rel=\"search\" type=\"application/opensearchdescription+xml\" href=\"/osd.jsp\" title=\"Peer review - Moodle Tracker\"/>',",
      "175:             '<a href=\"https://docs.moodle.org/dev/Main_Page\"></a><span>www.google.com</span><span class=\"placeholder\"></span>' => '<a href=\"https://docs.moodle.org/dev/Main_Page\"></a><span><a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a></span><span class=\"placeholder\"></span>',",
      "176:             'http://nolandforzombies.com <a href=\"zombiesFTW.com\">Zombies FTW</a> http://aliens.org' => '<a href=\"http://nolandforzombies.com\" class=\"_blanktarget\">http://nolandforzombies.com</a> <a href=\"zombiesFTW.com\">Zombies FTW</a> <a href=\"http://aliens.org\" class=\"_blanktarget\">http://aliens.org</a>',",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "a5b8265fc3e52399cff0e59b0112984a66534d94",
      "candidate_info": {
        "commit_hash": "a5b8265fc3e52399cff0e59b0112984a66534d94",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/a5b8265fc3e52399cff0e59b0112984a66534d94",
        "files": [
          "filter/urltolink/filter.php",
          "filter/urltolink/tests/filter_test.php"
        ],
        "message": "MDL-38466 filters: ReDoS protection for text to URL conversion.",
        "before_after_code_files": [
          "filter/urltolink/filter.php||filter/urltolink/filter.php",
          "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "filter/urltolink/filter.php||filter/urltolink/filter.php",
            "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
          ],
          "candidate": [
            "filter/urltolink/filter.php||filter/urltolink/filter.php",
            "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
          ]
        }
      },
      "candidate_diff": {
        "filter/urltolink/filter.php||filter/urltolink/filter.php": [
          "File: filter/urltolink/filter.php -> filter/urltolink/filter.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "138:         $lookbehindend = \"(?<![]),.;])\";",
          "141:                 \"($port?$path$querystring?$fragment?)$lookbehindend\";",
          "142:         if ($unicoderegexp) {",
          "143:             $regex = '#' . $regex . '#ui';",
          "",
          "[Removed Lines]",
          "137:         $lookbehindstart = \"(?<!=[\\\"']|\\burl\\([\\\"' ]|\\burl\\()\";",
          "140:         $regex = \"$lookbehindstart$urlstart((?:$domainsegment\\.)+$domainsegment|$numericip)\" .",
          "",
          "[Added Lines]",
          "139:         $regex = \"$urlstart((?:$domainsegment\\.)+$domainsegment|$numericip)\" .",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "145:             $regex = '#' . preg_replace(array('\\pLl', '\\PL'), 'a-z', $regex) . '#i';",
          "146:         }",
          "150:         if (!empty($ignoretags)) {",
          "151:             $ignoretags = array_reverse($ignoretags); /// Reversed so \"progressive\" str_replace() will solve some nesting problems.",
          "",
          "[Removed Lines]",
          "148:         $text = preg_replace($regex, '<a href=\"http$1://$2$3$4\" class=\"_blanktarget\">$0</a>', $text);",
          "",
          "[Added Lines]",
          "148:         $matches = preg_split('/(<[^>]*>)/i', $text, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);",
          "149:         $lookingforendstyle = false;",
          "152:         foreach ($matches as $idx => $chunk) {",
          "154:             if (strpos($chunk, '<') !== false) {",
          "155:                 continue;",
          "156:             }",
          "159:             if (preg_match('#(background=\")|(action=\")|(style=\"background)|(href=\")|(src=\")|(url [(])#', $chunk)) {",
          "160:                 continue;",
          "161:             }",
          "164:             $text = $chunk;",
          "165:             $words = explode(' ', $text);",
          "167:             foreach ($words as $idx2 => $word) {",
          "169:                 if (strlen($word) < 4096) {",
          "170:                     $words[$idx2] = preg_replace($regex, '<a href=\"http$1://$2$3$4\" class=\"_blanktarget\">$0</a>', $word);",
          "171:                 }",
          "172:             }",
          "173:             $text = implode(' ', $words);",
          "176:             $matches[$idx] = $text;",
          "177:         }",
          "179:         $text = implode('', $matches);",
          "",
          "---------------"
        ],
        "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php": [
          "File: filter/urltolink/tests/filter_test.php -> filter/urltolink/tests/filter_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "32: class filter_urltolink_testcase extends basic_testcase {",
          "34:     function get_convert_urls_into_links_test_cases() {",
          "35:         $texts = array (",
          "37:             'http://moodle.org - URL' => '<a href=\"http://moodle.org\" class=\"_blanktarget\">http://moodle.org</a> - URL',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "36:         $superlong4095 = str_pad('http://www.superlong4095.com?this=something', 4095, 'a');",
          "37:         $superlong4096 = str_pad('http://www.superlong4096.com?this=something', 4096, 'a');",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "130:             '<td background=\"http://moodle.org\">&nbsp;</td>' => '<td background=\"http://moodle.org\">&nbsp;</td>',",
          "131:             '<td background=\"www.moodle.org\">&nbsp;</td>' => '<td background=\"www.moodle.org\">&nbsp;</td>',",
          "132:             '<form name=\"input\" action=\"http://moodle.org/submit.asp\" method=\"get\">'=>'<form name=\"input\" action=\"http://moodle.org/submit.asp\" method=\"get\">',",
          "133:             '<td background=\"https://www.moodle.org\">&nbsp;</td>' => '<td background=\"https://www.moodle.org\">&nbsp;</td>',",
          "135:             '<table style=\"background-image: url(\\'http://moodle.org/pic.jpg\\');\">' => '<table style=\"background-image: url(\\'http://moodle.org/pic.jpg\\');\">',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "137:             '<input type=\"submit\" value=\"Go to http://moodle.org\">' => '<input type=\"submit\" value=\"Go to http://moodle.org\">',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "149:             'URL: http://127.0.0.1/path/to?param=value_with%28parenthesis%29&param2=1' => 'URL: <a href=\"http://127.0.0.1/path/to?param=value_with%28parenthesis%29&param2=1\" class=\"_blanktarget\">http://127.0.0.1/path/to?param=value_with%28parenthesis%29&param2=1</a>',",
          "150:             'URL: www.localhost.com/path/to?param=value_with%28parenthesis%29&param2=1' => 'URL: <a href=\"http://www.localhost.com/path/to?param=value_with%28parenthesis%29&param2=1\" class=\"_blanktarget\">www.localhost.com/path/to?param=value_with%28parenthesis%29&param2=1</a>',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "157:             'URL: ' . $superlong4095 => 'URL: <a href=\"' . $superlong4095 . '\" class=\"_blanktarget\">' . $superlong4095 . '</a>',",
          "159:             'URL: ' . $superlong4096 => 'URL: ' . $superlong4096,",
          "161:             'URL: <span style=\"kasd\"> my link to http://google.com </span>' => 'URL: <span style=\"kasd\"> my link to <a href=\"http://google.com\" class=\"_blanktarget\">http://google.com</a> </span>',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "12ba38e725440eda73301d1dd354583c26d2c65d",
      "candidate_info": {
        "commit_hash": "12ba38e725440eda73301d1dd354583c26d2c65d",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/12ba38e725440eda73301d1dd354583c26d2c65d",
        "files": [
          "filter/urltolink/filter.php",
          "filter/urltolink/tests/filter_test.php"
        ],
        "message": "MDL-38466 filters: Redos protection and unit tests",
        "before_after_code_files": [
          "filter/urltolink/filter.php||filter/urltolink/filter.php",
          "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "filter/urltolink/filter.php||filter/urltolink/filter.php",
            "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
          ],
          "candidate": [
            "filter/urltolink/filter.php||filter/urltolink/filter.php",
            "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
          ]
        }
      },
      "candidate_diff": {
        "filter/urltolink/filter.php||filter/urltolink/filter.php": [
          "File: filter/urltolink/filter.php -> filter/urltolink/filter.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "145:         }",
          "152:         foreach ($matches as $idx => $chunk) {",
          "155:                 continue;",
          "156:             }",
          "",
          "[Removed Lines]",
          "148:         $matches = preg_split('/(<[^>]*>)/i', $text, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);",
          "149:         $lookingforendstyle = false;",
          "154:             if (strpos($chunk, '<') !== false) {",
          "",
          "[Added Lines]",
          "148:         $matches = preg_split('/(<[^<|>]*>)/i', $text, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);",
          "153:             if (strpos(trim($chunk), '<') === 0) {",
          "",
          "---------------"
        ],
        "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php": [
          "File: filter/urltolink/tests/filter_test.php -> filter/urltolink/tests/filter_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: require_once($CFG->dirroot . '/filter/urltolink/filter.php'); // Include the code to test",
          "34:     function get_convert_urls_into_links_test_cases() {",
          "",
          "[Removed Lines]",
          "32: class filter_urltolink_testcase extends basic_testcase {",
          "",
          "[Added Lines]",
          "32: class filter_urltolink_filter_testcase extends basic_testcase {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "159:             'URL: ' . $superlong4096 => 'URL: ' . $superlong4096,",
          "161:             'URL: <span style=\"kasd\"> my link to http://google.com </span>' => 'URL: <span style=\"kasd\"> my link to <a href=\"http://google.com\" class=\"_blanktarget\">http://google.com</a> </span>',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "163:             '<b><i>www.google.com</i></b>' => '<b><i><a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a></i></b>',",
          "164:             '<input type=\"submit\" value=\"Go to http://moodle.org\">' => '<input type=\"submit\" value=\"Go to http://moodle.org\">',",
          "166:             '<p><span style=\"color: rgb(37, 37, 37); font-family: sans-serif; line-height: 22.3999996185303px;\">Lorem ipsum amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut http://google.com aliquip ex ea <a href=\"http://google.com\">commodo consequat</a>. Duis aute irure in reprehenderit in excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing mollit anim id est laborum.</span><br></p>'",
          "167:             =>",
          "168:             '<p><span style=\"color: rgb(37, 37, 37); font-family: sans-serif; line-height: 22.3999996185303px;\">Lorem ipsum amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut <a href=\"http://google.com\" class=\"_blanktarget\">http://google.com</a> aliquip ex ea <a href=\"http://google.com\">commodo consequat</a>. Duis aute irure in reprehenderit in excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia <a href=\"https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing\" class=\"_blanktarget\">https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing</a> <a href=\"https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing\" class=\"_blanktarget\">https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing</a> mollit anim id est laborum.</span><br></p>',",
          "170:             '5 < 10 www.google.com <a href=\"hi.com\">im a link</a>' => '5 < 10 <a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a> <a href=\"hi.com\">im a link</a>',",
          "171:             'h3 (www.styles.com/h3) < h1 (www.styles.com/h1)' => 'h3 (<a href=\"http://www.styles.com/h3\" class=\"_blanktarget\">www.styles.com/h3</a>) < h1 (<a href=\"http://www.styles.com/h1\" class=\"_blanktarget\">www.styles.com/h1</a>)',",
          "172:             '<p>text www.moodle.org&lt;/p> text' => '<p>text <a href=\"http://www.moodle.org\" class=\"_blanktarget\">www.moodle.org</a>&lt;/p> text',",
          "174:             '<link rel=\"search\" type=\"application/opensearchdescription+xml\" href=\"/osd.jsp\" title=\"Peer review - Moodle Tracker\"/>' => '<link rel=\"search\" type=\"application/opensearchdescription+xml\" href=\"/osd.jsp\" title=\"Peer review - Moodle Tracker\"/>',",
          "175:             '<a href=\"https://docs.moodle.org/dev/Main_Page\"></a><span>www.google.com</span><span class=\"placeholder\"></span>' => '<a href=\"https://docs.moodle.org/dev/Main_Page\"></a><span><a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a></span><span class=\"placeholder\"></span>',",
          "176:             'http://nolandforzombies.com <a href=\"zombiesFTW.com\">Zombies FTW</a> http://aliens.org' => '<a href=\"http://nolandforzombies.com\" class=\"_blanktarget\">http://nolandforzombies.com</a> <a href=\"zombiesFTW.com\">Zombies FTW</a> <a href=\"http://aliens.org\" class=\"_blanktarget\">http://aliens.org</a>',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5219605a81b494c5bb6210ade3ea02d16b1c0d06",
      "candidate_info": {
        "commit_hash": "5219605a81b494c5bb6210ade3ea02d16b1c0d06",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/5219605a81b494c5bb6210ade3ea02d16b1c0d06",
        "files": [
          "filter/urltolink/filter.php",
          "filter/urltolink/tests/filter_test.php"
        ],
        "message": "MDL-38466 filters: Redos protection and unit tests",
        "before_after_code_files": [
          "filter/urltolink/filter.php||filter/urltolink/filter.php",
          "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "filter/urltolink/filter.php||filter/urltolink/filter.php",
            "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
          ],
          "candidate": [
            "filter/urltolink/filter.php||filter/urltolink/filter.php",
            "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
          ]
        }
      },
      "candidate_diff": {
        "filter/urltolink/filter.php||filter/urltolink/filter.php": [
          "File: filter/urltolink/filter.php -> filter/urltolink/filter.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "145:         }",
          "152:         foreach ($matches as $idx => $chunk) {",
          "155:                 continue;",
          "156:             }",
          "",
          "[Removed Lines]",
          "148:         $matches = preg_split('/(<[^>]*>)/i', $text, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);",
          "149:         $lookingforendstyle = false;",
          "154:             if (strpos($chunk, '<') !== false) {",
          "",
          "[Added Lines]",
          "148:         $matches = preg_split('/(<[^<|>]*>)/i', $text, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);",
          "153:             if (strpos(trim($chunk), '<') === 0) {",
          "",
          "---------------"
        ],
        "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php": [
          "File: filter/urltolink/tests/filter_test.php -> filter/urltolink/tests/filter_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: require_once($CFG->dirroot . '/filter/urltolink/filter.php'); // Include the code to test",
          "34:     function get_convert_urls_into_links_test_cases() {",
          "",
          "[Removed Lines]",
          "32: class filter_urltolink_testcase extends basic_testcase {",
          "",
          "[Added Lines]",
          "32: class filter_urltolink_filter_testcase extends basic_testcase {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "159:             'URL: ' . $superlong4096 => 'URL: ' . $superlong4096,",
          "161:             'URL: <span style=\"kasd\"> my link to http://google.com </span>' => 'URL: <span style=\"kasd\"> my link to <a href=\"http://google.com\" class=\"_blanktarget\">http://google.com</a> </span>',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "163:             '<b><i>www.google.com</i></b>' => '<b><i><a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a></i></b>',",
          "164:             '<input type=\"submit\" value=\"Go to http://moodle.org\">' => '<input type=\"submit\" value=\"Go to http://moodle.org\">',",
          "166:             '<p><span style=\"color: rgb(37, 37, 37); font-family: sans-serif; line-height: 22.3999996185303px;\">Lorem ipsum amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut http://google.com aliquip ex ea <a href=\"http://google.com\">commodo consequat</a>. Duis aute irure in reprehenderit in excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing mollit anim id est laborum.</span><br></p>'",
          "167:             =>",
          "168:             '<p><span style=\"color: rgb(37, 37, 37); font-family: sans-serif; line-height: 22.3999996185303px;\">Lorem ipsum amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut <a href=\"http://google.com\" class=\"_blanktarget\">http://google.com</a> aliquip ex ea <a href=\"http://google.com\">commodo consequat</a>. Duis aute irure in reprehenderit in excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia <a href=\"https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing\" class=\"_blanktarget\">https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing</a> <a href=\"https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing\" class=\"_blanktarget\">https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing</a> mollit anim id est laborum.</span><br></p>',",
          "170:             '5 < 10 www.google.com <a href=\"hi.com\">im a link</a>' => '5 < 10 <a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a> <a href=\"hi.com\">im a link</a>',",
          "171:             'h3 (www.styles.com/h3) < h1 (www.styles.com/h1)' => 'h3 (<a href=\"http://www.styles.com/h3\" class=\"_blanktarget\">www.styles.com/h3</a>) < h1 (<a href=\"http://www.styles.com/h1\" class=\"_blanktarget\">www.styles.com/h1</a>)',",
          "172:             '<p>text www.moodle.org&lt;/p> text' => '<p>text <a href=\"http://www.moodle.org\" class=\"_blanktarget\">www.moodle.org</a>&lt;/p> text',",
          "174:             '<link rel=\"search\" type=\"application/opensearchdescription+xml\" href=\"/osd.jsp\" title=\"Peer review - Moodle Tracker\"/>' => '<link rel=\"search\" type=\"application/opensearchdescription+xml\" href=\"/osd.jsp\" title=\"Peer review - Moodle Tracker\"/>',",
          "175:             '<a href=\"https://docs.moodle.org/dev/Main_Page\"></a><span>www.google.com</span><span class=\"placeholder\"></span>' => '<a href=\"https://docs.moodle.org/dev/Main_Page\"></a><span><a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a></span><span class=\"placeholder\"></span>',",
          "176:             'http://nolandforzombies.com <a href=\"zombiesFTW.com\">Zombies FTW</a> http://aliens.org' => '<a href=\"http://nolandforzombies.com\" class=\"_blanktarget\">http://nolandforzombies.com</a> <a href=\"zombiesFTW.com\">Zombies FTW</a> <a href=\"http://aliens.org\" class=\"_blanktarget\">http://aliens.org</a>',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "82406581afc4fa6e18051900434004d8563cf5c0",
      "candidate_info": {
        "commit_hash": "82406581afc4fa6e18051900434004d8563cf5c0",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/82406581afc4fa6e18051900434004d8563cf5c0",
        "files": [
          "filter/urltolink/filter.php",
          "filter/urltolink/tests/filter_test.php"
        ],
        "message": "MDL-38466 filters: Redos protection and unit tests",
        "before_after_code_files": [
          "filter/urltolink/filter.php||filter/urltolink/filter.php",
          "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "filter/urltolink/filter.php||filter/urltolink/filter.php",
            "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
          ],
          "candidate": [
            "filter/urltolink/filter.php||filter/urltolink/filter.php",
            "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php"
          ]
        }
      },
      "candidate_diff": {
        "filter/urltolink/filter.php||filter/urltolink/filter.php": [
          "File: filter/urltolink/filter.php -> filter/urltolink/filter.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "145:         }",
          "152:         foreach ($matches as $idx => $chunk) {",
          "155:                 continue;",
          "156:             }",
          "",
          "[Removed Lines]",
          "148:         $matches = preg_split('/(<[^>]*>)/i', $text, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);",
          "149:         $lookingforendstyle = false;",
          "154:             if (strpos($chunk, '<') !== false) {",
          "",
          "[Added Lines]",
          "148:         $matches = preg_split('/(<[^<|>]*>)/i', $text, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);",
          "153:             if (strpos(trim($chunk), '<') === 0) {",
          "",
          "---------------"
        ],
        "filter/urltolink/tests/filter_test.php||filter/urltolink/tests/filter_test.php": [
          "File: filter/urltolink/tests/filter_test.php -> filter/urltolink/tests/filter_test.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "29: require_once($CFG->dirroot . '/filter/urltolink/filter.php'); // Include the code to test",
          "34:     function get_convert_urls_into_links_test_cases() {",
          "",
          "[Removed Lines]",
          "32: class filter_urltolink_testcase extends basic_testcase {",
          "",
          "[Added Lines]",
          "32: class filter_urltolink_filter_testcase extends basic_testcase {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "159:             'URL: ' . $superlong4096 => 'URL: ' . $superlong4096,",
          "161:             'URL: <span style=\"kasd\"> my link to http://google.com </span>' => 'URL: <span style=\"kasd\"> my link to <a href=\"http://google.com\" class=\"_blanktarget\">http://google.com</a> </span>',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "163:             '<b><i>www.google.com</i></b>' => '<b><i><a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a></i></b>',",
          "164:             '<input type=\"submit\" value=\"Go to http://moodle.org\">' => '<input type=\"submit\" value=\"Go to http://moodle.org\">',",
          "166:             '<p><span style=\"color: rgb(37, 37, 37); font-family: sans-serif; line-height: 22.3999996185303px;\">Lorem ipsum amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut http://google.com aliquip ex ea <a href=\"http://google.com\">commodo consequat</a>. Duis aute irure in reprehenderit in excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing mollit anim id est laborum.</span><br></p>'",
          "167:             =>",
          "168:             '<p><span style=\"color: rgb(37, 37, 37); font-family: sans-serif; line-height: 22.3999996185303px;\">Lorem ipsum amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut <a href=\"http://google.com\" class=\"_blanktarget\">http://google.com</a> aliquip ex ea <a href=\"http://google.com\">commodo consequat</a>. Duis aute irure in reprehenderit in excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia <a href=\"https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing\" class=\"_blanktarget\">https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing</a> <a href=\"https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing\" class=\"_blanktarget\">https://docs.google.com/document/d/BrokenLinkPleaseAyacDHc_Ov8aoskoSVQsfmLHP_jYAkRMk/edit?usp=sharing</a> mollit anim id est laborum.</span><br></p>',",
          "170:             '5 < 10 www.google.com <a href=\"hi.com\">im a link</a>' => '5 < 10 <a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a> <a href=\"hi.com\">im a link</a>',",
          "171:             'h3 (www.styles.com/h3) < h1 (www.styles.com/h1)' => 'h3 (<a href=\"http://www.styles.com/h3\" class=\"_blanktarget\">www.styles.com/h3</a>) < h1 (<a href=\"http://www.styles.com/h1\" class=\"_blanktarget\">www.styles.com/h1</a>)',",
          "172:             '<p>text www.moodle.org&lt;/p> text' => '<p>text <a href=\"http://www.moodle.org\" class=\"_blanktarget\">www.moodle.org</a>&lt;/p> text',",
          "174:             '<link rel=\"search\" type=\"application/opensearchdescription+xml\" href=\"/osd.jsp\" title=\"Peer review - Moodle Tracker\"/>' => '<link rel=\"search\" type=\"application/opensearchdescription+xml\" href=\"/osd.jsp\" title=\"Peer review - Moodle Tracker\"/>',",
          "175:             '<a href=\"https://docs.moodle.org/dev/Main_Page\"></a><span>www.google.com</span><span class=\"placeholder\"></span>' => '<a href=\"https://docs.moodle.org/dev/Main_Page\"></a><span><a href=\"http://www.google.com\" class=\"_blanktarget\">www.google.com</a></span><span class=\"placeholder\"></span>',",
          "176:             'http://nolandforzombies.com <a href=\"zombiesFTW.com\">Zombies FTW</a> http://aliens.org' => '<a href=\"http://nolandforzombies.com\" class=\"_blanktarget\">http://nolandforzombies.com</a> <a href=\"zombiesFTW.com\">Zombies FTW</a> <a href=\"http://aliens.org\" class=\"_blanktarget\">http://aliens.org</a>',",
          "",
          "---------------"
        ]
      }
    }
  ]
}