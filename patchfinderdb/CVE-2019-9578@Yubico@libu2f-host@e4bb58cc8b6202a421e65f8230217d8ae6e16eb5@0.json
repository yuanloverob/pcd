{
  "cve_id": "CVE-2019-9578",
  "cve_desc": "In devs.c in Yubico libu2f-host before 1.1.8, the response to init is misparsed, leaking uninitialized stack memory back to the device.",
  "repo": "Yubico/libu2f-host",
  "patch_hash": "e4bb58cc8b6202a421e65f8230217d8ae6e16eb5",
  "patch_info": {
    "commit_hash": "e4bb58cc8b6202a421e65f8230217d8ae6e16eb5",
    "repo": "Yubico/libu2f-host",
    "commit_url": "https://github.com/Yubico/libu2f-host/commit/e4bb58cc8b6202a421e65f8230217d8ae6e16eb5",
    "files": [
      "u2f-host/devs.c"
    ],
    "message": "fix filling out of initresp",
    "before_after_code_files": [
      "u2f-host/devs.c||u2f-host/devs.c"
    ]
  },
  "patch_diff": {
    "u2f-host/devs.c||u2f-host/devs.c": [
      "File: u2f-host/devs.c -> u2f-host/devs.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "302:       (devs, dev->id, U2FHID_INIT, nonce, sizeof (nonce), resp,",
      "303:        &resplen) == U2FH_OK)",
      "304:     {",
      "307:  {",
      "309:  }",
      "316:     }",
      "317:   else",
      "318:     {",
      "",
      "[Removed Lines]",
      "305:       U2FHID_INIT_RESP initresp;",
      "306:       if (resplen > sizeof (initresp))",
      "308:    return U2FH_MEMORY_ERROR;",
      "310:       memcpy (&initresp, resp, resplen);",
      "311:       dev->cid = initresp.cid;",
      "312:       dev->versionInterface = initresp.versionInterface;",
      "313:       dev->versionMajor = initresp.versionMajor;",
      "314:       dev->versionMinor = initresp.versionMinor;",
      "315:       dev->capFlags = initresp.capFlags;",
      "",
      "[Added Lines]",
      "305:       int offs = sizeof (nonce);",
      "307:       if (resplen < 17)",
      "309:    return U2FH_SIZE_ERROR;",
      "313:       if (memcmp (nonce, resp, sizeof (nonce)) != 0)",
      "314:  {",
      "315:    return U2FH_TRANSPORT_ERROR;",
      "316:  }",
      "318:       dev->cid =",
      "319:  resp[offs] << 24 | resp[offs + 1] << 16 | resp[offs +",
      "320:              2] << 8 | resp[offs +",
      "321:               3];",
      "322:       offs += 4;",
      "323:       dev->versionInterface = resp[offs++];",
      "324:       dev->versionMajor = resp[offs++];",
      "325:       dev->versionMinor = resp[offs++];",
      "326:       dev->versionBuild = resp[offs++];",
      "327:       dev->capFlags = resp[offs++];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "1081a0ff3bb2c9e36182894c3997e77d08bc6810",
      "candidate_info": {
        "commit_hash": "1081a0ff3bb2c9e36182894c3997e77d08bc6810",
        "repo": "Yubico/libu2f-host",
        "commit_url": "https://github.com/Yubico/libu2f-host/commit/1081a0ff3bb2c9e36182894c3997e77d08bc6810",
        "files": [
          "u2f-host/devs.c"
        ],
        "message": "lib: endianness of cid was changed with fix for init parsing\n\nthis caused issues on some u2f devices\nfixes #115",
        "before_after_code_files": [
          "u2f-host/devs.c||u2f-host/devs.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "u2f-host/devs.c||u2f-host/devs.c"
          ],
          "candidate": [
            "u2f-host/devs.c||u2f-host/devs.c"
          ]
        }
      },
      "candidate_diff": {
        "u2f-host/devs.c||u2f-host/devs.c": [
          "File: u2f-host/devs.c -> u2f-host/devs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "315:    return U2FH_TRANSPORT_ERROR;",
          "316:  }",
          "322:       offs += 4;",
          "323:       dev->versionInterface = resp[offs++];",
          "324:       dev->versionMajor = resp[offs++];",
          "",
          "[Removed Lines]",
          "318:       dev->cid =",
          "319:  resp[offs] << 24 | resp[offs + 1] << 16 | resp[offs +",
          "320:              2] << 8 | resp[offs +",
          "321:               3];",
          "",
          "[Added Lines]",
          "319:       memcpy((uint8_t*)&dev->cid, resp + offs, sizeof(dev->cid));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e77a109f8cf60d9eafdf005ab5c851d5f576c01e",
      "candidate_info": {
        "commit_hash": "e77a109f8cf60d9eafdf005ab5c851d5f576c01e",
        "repo": "Yubico/libu2f-host",
        "commit_url": "https://github.com/Yubico/libu2f-host/commit/e77a109f8cf60d9eafdf005ab5c851d5f576c01e",
        "files": [
          "u2f-host/devs.c"
        ],
        "message": "lib: make sure that we don't copy in a to large initresp from device\n\nreported by Christian Reitter",
        "before_after_code_files": [
          "u2f-host/devs.c||u2f-host/devs.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "u2f-host/devs.c||u2f-host/devs.c"
          ],
          "candidate": [
            "u2f-host/devs.c||u2f-host/devs.c"
          ]
        }
      },
      "candidate_diff": {
        "u2f-host/devs.c||u2f-host/devs.c": [
          "File: u2f-host/devs.c -> u2f-host/devs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "247:        &resplen) == U2FH_OK)",
          "248:     {",
          "249:       U2FHID_INIT_RESP initresp;",
          "250:       memcpy (&initresp, resp, resplen);",
          "251:       dev->cid = initresp.cid;",
          "252:       dev->versionInterface = initresp.versionInterface;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "250:       if (resplen > sizeof (initresp))",
          "251:  {",
          "252:    return U2FH_MEMORY_ERROR;",
          "253:  }",
          "",
          "---------------"
        ]
      }
    }
  ]
}