{
  "cve_id": "CVE-2019-19926",
  "cve_desc": "multiSelect in select.c in SQLite 3.30.1 mishandles certain errors during parsing, as demonstrated by errors from sqlite3WindowRewrite() calls. NOTE: this vulnerability exists because of an incomplete fix for CVE-2019-19880.",
  "repo": "sqlite/sqlite",
  "patch_hash": "8428b3b437569338a9d1e10c4cd8154acbe33089",
  "patch_info": {
    "commit_hash": "8428b3b437569338a9d1e10c4cd8154acbe33089",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/8428b3b437569338a9d1e10c4cd8154acbe33089",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/select.c"
    ],
    "message": "Continuation of [e2bddcd4c55ba3cb]: Add another spot where it is necessary to abort early due to prior errors in sqlite3WindowRewrite().\n\nFossilOrigin-Name: cba2a2a44cdf138a629109bb0ad088ed4ef67fc66bed3e0373554681a39615d2",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/select.c||src/select.c"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 3d4c0bf8904135fa68c75801bfa738715cacc3b19dc8ad6ef550b11798d4b121",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/select.c||src/select.c": [
      "File: src/select.c -> src/select.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2809:     }",
      "2810:   #endif",
      "2811:   }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2812:   if( pParse->nErr ) goto multi_select_end;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "594b124f216641e7d6df059cca84c45d4f0ab393",
      "candidate_info": {
        "commit_hash": "594b124f216641e7d6df059cca84c45d4f0ab393",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/594b124f216641e7d6df059cca84c45d4f0ab393",
        "files": [
          "ext/misc/sha1.c",
          "manifest",
          "manifest.uuid",
          "src/hwtime.h",
          "tool/dbhash.c"
        ],
        "message": "Changes to extensions and test logic so that the build works with gcc and with -std=iso9899:1999\n\nFossilOrigin-Name: 2575a68c3965e72f2ab211d933012442755afe6a9b7de9e9e50cdd2155fd1ec8",
        "before_after_code_files": [
          "ext/misc/sha1.c||ext/misc/sha1.c",
          "manifest.uuid||manifest.uuid",
          "src/hwtime.h||src/hwtime.h",
          "tool/dbhash.c||tool/dbhash.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/misc/sha1.c||ext/misc/sha1.c": [
          "File: ext/misc/sha1.c -> ext/misc/sha1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "39:   unsigned char buffer[64];",
          "40: };",
          "56: #define SHA_ROT(x,l,r) ((x) << (l) | (x) >> (r))",
          "57: #define rol(x,k) SHA_ROT(x,k,32-(k))",
          "58: #define ror(x,k) SHA_ROT(x,32-(k),k)",
          "62: #define blk0le(i) (block[i] = (ror(block[i],8)&0xFF00FF00) \\",
          "63:     |(rol(block[i],8)&0x00FF00FF))",
          "",
          "[Removed Lines]",
          "43: #if __GNUC__ && (defined(__i386__) || defined(__x86_64__))",
          "49: #define SHA_ROT(op, x, k) \\",
          "50:         ({ unsigned int y; asm(op \" %1,%0\" : \"=r\" (y) : \"I\" (k), \"0\" (x)); y; })",
          "51: #define rol(x,k) SHA_ROT(\"roll\", x, k)",
          "52: #define ror(x,k) SHA_ROT(\"rorl\", x, k)",
          "54: #else",
          "59: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: a48f6e17599d7ec794cfcd60858d6a69cf05caaae9321048b111fedd86a3b5b2",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/hwtime.h||src/hwtime.h": [
          "File: src/hwtime.h -> src/hwtime.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:   #if defined(__GNUC__)",
          "",
          "[Removed Lines]",
          "25: #if (defined(__GNUC__) || defined(_MSC_VER)) && \\",
          "26:       (defined(i386) || defined(__i386__) || defined(_M_IX86))",
          "",
          "[Added Lines]",
          "25: #if !defined(__STRICT_ANSI__) && \\",
          "26:     (defined(__GNUC__) || defined(_MSC_VER)) && \\",
          "27:     (defined(i386) || defined(__i386__) || defined(_M_IX86))",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45:   #endif",
          "49:   __inline__ sqlite_uint64 sqlite3Hwtime(void){",
          "50:       unsigned long val;",
          "",
          "[Removed Lines]",
          "47: #elif (defined(__GNUC__) && defined(__x86_64__))",
          "",
          "[Added Lines]",
          "48: #elif !defined(__STRICT_ANSI__) && (defined(__GNUC__) && defined(__x86_64__))",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "52:       return val;",
          "53:   }",
          "57:   __inline__ sqlite_uint64 sqlite3Hwtime(void){",
          "58:       unsigned long long retval;",
          "",
          "[Removed Lines]",
          "55: #elif (defined(__GNUC__) && defined(__ppc__))",
          "",
          "[Added Lines]",
          "56: #elif !defined(__STRICT_ANSI__) && (defined(__GNUC__) && defined(__ppc__))",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "70: #else",
          "81:   sqlite_uint64 sqlite3Hwtime(void){ return ((sqlite_uint64)0); }",
          "",
          "[Removed Lines]",
          "72:   #error Need implementation of sqlite3Hwtime() for your platform.",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "tool/dbhash.c||tool/dbhash.c": [
          "File: tool/dbhash.c -> tool/dbhash.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "78: #define SHA_ROT(x,l,r) ((x) << (l) | (x) >> (r))",
          "79: #define rol(x,k) SHA_ROT(x,k,32-(k))",
          "80: #define ror(x,k) SHA_ROT(x,32-(k),k)",
          "84: #define blk0le(i) (block[i] = (ror(block[i],8)&0xFF00FF00) \\",
          "85:     |(rol(block[i],8)&0x00FF00FF))",
          "",
          "[Removed Lines]",
          "65: #if __GNUC__ && (defined(__i386__) || defined(__x86_64__))",
          "71: #define SHA_ROT(op, x, k) \\",
          "72:         ({ unsigned int y; asm(op \" %1,%0\" : \"=r\" (y) : \"I\" (k), \"0\" (x)); y; })",
          "73: #define rol(x,k) SHA_ROT(\"roll\", x, k)",
          "74: #define ror(x,k) SHA_ROT(\"rorl\", x, k)",
          "76: #else",
          "81: #endif",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dd668c26b5d7a7526638e39239844e01a1d251e0",
      "candidate_info": {
        "commit_hash": "dd668c26b5d7a7526638e39239844e01a1d251e0",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/dd668c26b5d7a7526638e39239844e01a1d251e0",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/expr.c",
          "test/in.test"
        ],
        "message": "When applying the IN_INDEX_NOOP optimization and the LHS has REAL affinity, also apply REAL affinity to each element of the RHS. Ticket [2841e99d104c6436].\n\nFossilOrigin-Name: 88833a9c2849c959a37a80e0e4d2b211ce3c83a48319724c89b172b060c876b4",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/expr.c||src/expr.c",
          "test/in.test||test/in.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 0c946f0846b2835f8facca806a4d4ecc2b2e97343de245a0d91716d998b2a829",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/expr.c||src/expr.c": [
          "File: src/expr.c -> src/expr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3124:     int r2, regToFree;",
          "3125:     int regCkNull = 0;",
          "3126:     int ii;",
          "3127:     assert( !ExprHasProperty(pExpr, EP_xIsSelect) );",
          "3128:     if( destIfNull!=destIfFalse ){",
          "3129:       regCkNull = sqlite3GetTempReg(pParse);",
          "3130:       sqlite3VdbeAddOp3(v, OP_BitAnd, rLhs, rLhs, regCkNull);",
          "3131:     }",
          "3132:     for(ii=0; ii<pList->nExpr; ii++){",
          "3133:       r2 = sqlite3ExprCodeTemp(pParse, pList->a[ii].pExpr, &regToFree);",
          "3134:       if( regCkNull && sqlite3ExprCanBeNull(pList->a[ii].pExpr) ){",
          "3135:         sqlite3VdbeAddOp3(v, OP_BitAnd, regCkNull, r2, regCkNull);",
          "3136:       }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3133:     bLhsReal = sqlite3ExprAffinity(pExpr->pLeft)==SQLITE_AFF_REAL;",
          "3136:       if( bLhsReal ){",
          "3137:         sqlite3VdbeAddOp4(v, OP_Affinity, r2, 1, 0, \"E\", P4_STATIC);",
          "3138:       }",
          "",
          "---------------"
        ],
        "test/in.test||test/in.test": [
          "File: test/in.test -> test/in.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "759:   SELECT * FROM t0 WHERE '1' IN (t0.c0);",
          "760: } {}",
          "763: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "762: # 2019-09-02 ticket https://www.sqlite.org/src/info/2841e99d104c6436",
          "763: # For the IN_INDEX_NOOP optimization, apply REAL affinity to the LHS",
          "764: # values prior to comparison if the RHS has REAL affinity.",
          "765: #",
          "766: do_execsql_test in-19.1 {",
          "767:   DROP TABLE IF EXISTS t0;",
          "768:   CREATE TABLE t0(c0 REAL UNIQUE);",
          "769:   INSERT INTO t0(c0) VALUES(2.07093491255203046E18);",
          "770:   SELECT 1 FROM t0 WHERE c0 IN ('2070934912552030444');",
          "771: } {1}",
          "772: do_execsql_test in-19.2 {",
          "773:   SELECT c0 IN ('2070934912552030444') FROM t0;",
          "774: } {1}",
          "775: do_execsql_test in-19.3 {",
          "776:   SELECT c0 IN ('2070934912552030444',2,3) FROM t0;",
          "777: } {1}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "922b35801d8bdbb9365cbde7d44e66293f616e13",
      "candidate_info": {
        "commit_hash": "922b35801d8bdbb9365cbde7d44e66293f616e13",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/922b35801d8bdbb9365cbde7d44e66293f616e13",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/test_journal.c"
        ],
        "message": "Update an assert() in test_journal.c to take the new \"VACUUM INTO\" functionality into account.\n\nFossilOrigin-Name: 0e6249cb958a40ead0edf6e75a2c46e8657db3d358c5fe78a9dc0fa5ed7ad929",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/test_journal.c||src/test_journal.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 9d54a63d6e3cd47b483cf0ee868a5e7f638bcb0e3cbdeaecc667f293b87a3e99",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/test_journal.c||src/test_journal.c": [
          "File: src/test_journal.c -> src/test_journal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "564:       assert( pgno>p->nPage || sqlite3BitvecTest(p->pWritable, pgno) );",
          "565:     }",
          "566:   }",
          "",
          "[Removed Lines]",
          "563:       assert( pgno<=p->nPage || p->nSync>0 );",
          "",
          "[Added Lines]",
          "563:       assert( p->nPage==0 || pgno<=p->nPage || p->nSync>0 );",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d4a591dd6beaa33223b153abe092c8e61d6bde0a",
      "candidate_info": {
        "commit_hash": "d4a591dd6beaa33223b153abe092c8e61d6bde0a",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/d4a591dd6beaa33223b153abe092c8e61d6bde0a",
        "files": [
          "ext/misc/fileio.c",
          "manifest",
          "manifest.uuid",
          "src/sqlite.h.in",
          "src/window.c"
        ],
        "message": "Fix harmless compiler warnings.\n\nFossilOrigin-Name: a063f7c426d1ac066bf05cc03288f49b1c92e06a8cb2bc271cce9bd3022a74ea",
        "before_after_code_files": [
          "ext/misc/fileio.c||ext/misc/fileio.c",
          "manifest.uuid||manifest.uuid",
          "src/sqlite.h.in||src/sqlite.h.in",
          "src/window.c||src/window.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/misc/fileio.c||ext/misc/fileio.c": [
          "File: ext/misc/fileio.c -> ext/misc/fileio.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "158:     fclose(in);",
          "159:     return;",
          "160:   }",
          "162:     sqlite3_result_blob64(ctx, pBuf, nIn, sqlite3_free);",
          "163:   }else{",
          "164:     sqlite3_result_error_code(ctx, SQLITE_IOERR);",
          "",
          "[Removed Lines]",
          "161:   if( nIn==fread(pBuf, 1, (size_t)nIn, in) ){",
          "",
          "[Added Lines]",
          "161:   if( nIn==(sqlite3_int64)fread(pBuf, 1, (size_t)nIn, in) ){",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: c6da39115d3e2b0fd3a03c4bcae8ee8b05a6bbd6b11f8c54712fbff6387f610d",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/sqlite.h.in||src/sqlite.h.in": [
          "File: src/sqlite.h.in -> src/sqlite.h.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "189: #ifndef SQLITE_OMIT_COMPILEOPTION_DIAGS",
          "190: int sqlite3_compileoption_used(const char *zOptName);",
          "191: const char *sqlite3_compileoption_get(int N);",
          "192: #endif",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "192: #else",
          "193: # define sqlite3_compileoption_used(X) 0",
          "194: # define sqlite3_compileoption_get(X)  ((void*)0)",
          "",
          "---------------"
        ],
        "src/window.c||src/window.c": [
          "File: src/window.c -> src/window.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "332: ){",
          "333:   struct CallCount *p;",
          "334:   UNUSED_PARAMETER(nArg); assert( nArg==0 );",
          "335:   p = (struct CallCount*)sqlite3_aggregate_context(pCtx, sizeof(*p));",
          "336:   if( p ){",
          "337:     p->nTotal++;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "335:   UNUSED_PARAMETER(apArg);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "344: ){",
          "345:   struct CallCount *p;",
          "346:   UNUSED_PARAMETER(nArg); assert( nArg==0 );",
          "347:   p = (struct CallCount*)sqlite3_aggregate_context(pCtx, sizeof(*p));",
          "348:   p->nStep++;",
          "349: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "348:   UNUSED_PARAMETER(apArg);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "375: ){",
          "376:   struct CallCount *p;",
          "377:   UNUSED_PARAMETER(nArg); assert( nArg==0 );",
          "378:   p = (struct CallCount*)sqlite3_aggregate_context(pCtx, sizeof(*p));",
          "379:   if( p ){",
          "380:     p->nTotal++;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "380:   UNUSED_PARAMETER(apArg);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "387: ){",
          "388:   struct CallCount *p;",
          "389:   UNUSED_PARAMETER(nArg); assert( nArg==0 );",
          "390:   p = (struct CallCount*)sqlite3_aggregate_context(pCtx, sizeof(*p));",
          "391:   p->nStep++;",
          "392: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "393:   UNUSED_PARAMETER(apArg);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "442: ){",
          "443:   struct NtileCtx *p;",
          "444:   assert( nArg==1 ); UNUSED_PARAMETER(nArg);",
          "445:   p = (struct NtileCtx*)sqlite3_aggregate_context(pCtx, sizeof(*p));",
          "446:   p->iRow++;",
          "447: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "449:   UNUSED_PARAMETER(apArg);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "217ca657d82f2324d6c5a97598bf4f77ebbb1fe7",
      "candidate_info": {
        "commit_hash": "217ca657d82f2324d6c5a97598bf4f77ebbb1fe7",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/217ca657d82f2324d6c5a97598bf4f77ebbb1fe7",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/attach.c",
          "src/main.c",
          "src/resolve.c",
          "src/sqlite.h.in",
          "src/sqliteInt.h",
          "src/tclsqlite.c",
          "src/treeview.c",
          "test/func.test",
          "test/tclsqlite.test"
        ],
        "message": "The SQLITE_DIRECTONLY flag, when added to sqlite3_create_function() prevents the function from being used inside a trigger or view.\n\nFossilOrigin-Name: de767376987f7668b0770c4920f1532e341b5a27f797d69c0f5e92b87d036170",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/attach.c||src/attach.c",
          "src/main.c||src/main.c",
          "src/resolve.c||src/resolve.c",
          "src/sqlite.h.in||src/sqlite.h.in",
          "src/sqliteInt.h||src/sqliteInt.h",
          "src/tclsqlite.c||src/tclsqlite.c",
          "src/treeview.c||src/treeview.c",
          "test/func.test||test/func.test",
          "test/tclsqlite.test||test/tclsqlite.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 31e34fa3390196cdc3178bf120224b08df5ec58fa2c77079ede6e9461a430dad",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/attach.c||src/attach.c": [
          "File: src/attach.c -> src/attach.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "561: ){",
          "562:   while( pExpr ){",
          "563:     if( pExpr->op==TK_VARIABLE ){",
          "564:       if( pFix->pParse->db->init.busy ){",
          "565:         pExpr->op = TK_NULL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "563:     ExprSetProperty(pExpr, EP_Indirect);",
          "",
          "---------------"
        ],
        "src/main.c||src/main.c": [
          "File: src/main.c -> src/main.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1718:   }",
          "1720:   assert( SQLITE_FUNC_CONSTANT==SQLITE_DETERMINISTIC );",
          "1722:   enc &= (SQLITE_FUNC_ENCMASK|SQLITE_ANY);",
          "1724: #ifndef SQLITE_OMIT_UTF16",
          "",
          "[Removed Lines]",
          "1721:   extraFlags = enc &  SQLITE_DETERMINISTIC;",
          "",
          "[Added Lines]",
          "1721:   assert( SQLITE_FUNC_DIRECT==SQLITE_DIRECTONLY );",
          "1722:   extraFlags = enc &  (SQLITE_DETERMINISTIC|SQLITE_DIRECTONLY);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1781:   p->u.pDestructor = pDestructor;",
          "1782:   p->funcFlags = (p->funcFlags & SQLITE_FUNC_ENCMASK) | extraFlags;",
          "1783:   testcase( p->funcFlags & SQLITE_DETERMINISTIC );",
          "1784:   p->xSFunc = xSFunc ? xSFunc : xStep;",
          "1785:   p->xFinalize = xFinal;",
          "1786:   p->xValue = xValue;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1785:   testcase( p->funcFlags & SQLITE_DIRECTONLY );",
          "",
          "---------------"
        ],
        "src/resolve.c||src/resolve.c": [
          "File: src/resolve.c -> src/resolve.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "824:           no_such_func = 1;",
          "825:           pDef = 0;",
          "826:         }",
          "827:       }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "826:         }else",
          "827:         if( (pDef->funcFlags & SQLITE_FUNC_DIRECT)!=0",
          "828:          && ExprHasProperty(pExpr, EP_Indirect)",
          "829:          && !IN_RENAME_OBJECT",
          "830:         ){",
          "833:           sqlite3ErrorMsg(pParse, \"%s() prohibited in triggers and views\",",
          "834:                           pDef->zName);",
          "",
          "---------------"
        ],
        "src/sqlite.h.in||src/sqlite.h.in": [
          "File: src/sqlite.h.in -> src/sqlite.h.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "4981: #define SQLITE_DETERMINISTIC    0x800",
          "",
          "[Added Lines]",
          "4991: #define SQLITE_DETERMINISTIC    0x000000800",
          "4992: #define SQLITE_DIRECTONLY       0x000080000",
          "",
          "---------------"
        ],
        "src/sqliteInt.h||src/sqliteInt.h": [
          "File: src/sqliteInt.h -> src/sqliteInt.h"
        ],
        "src/tclsqlite.c||src/tclsqlite.c": [
          "File: src/tclsqlite.c -> src/tclsqlite.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2845:       if( n>1 && strncmp(z, \"-deterministic\",n)==0 ){",
          "2846:         flags |= SQLITE_DETERMINISTIC;",
          "2847:       }else",
          "2848:       if( n>1 && strncmp(z, \"-returntype\", n)==0 ){",
          "2849:         const char *azType[] = {\"integer\", \"real\", \"text\", \"blob\", \"any\", 0};",
          "2850:         assert( SQLITE_INTEGER==1 && SQLITE_FLOAT==2 && SQLITE_TEXT==3 );",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2854:       if( n>1 && strncmp(z, \"-directonly\",n)==0 ){",
          "2855:         flags |= SQLITE_DIRECTONLY;",
          "2856:       }else",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2860:         eType++;",
          "2861:       }else{",
          "2862:         Tcl_AppendResult(interp, \"bad option \\\"\", z,",
          "2864:         );",
          "2865:         return TCL_ERROR;",
          "2866:       }",
          "",
          "[Removed Lines]",
          "2863:             \"\\\": must be -argcount, -deterministic or -returntype\", (char*)0",
          "",
          "[Added Lines]",
          "2872:             \"\\\": must be -argcount, -deterministic, -directonly,\"",
          "2873:             \" or -returntype\", (char*)0",
          "",
          "---------------"
        ],
        "src/treeview.c||src/treeview.c": [
          "File: src/treeview.c -> src/treeview.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "557: #endif",
          "558:       }",
          "559:       if( pExpr->op==TK_AGG_FUNCTION ){",
          "562:       }else{",
          "564:       }",
          "565:       if( pFarg ){",
          "566:         sqlite3TreeViewExprList(pView, pFarg, pWin!=0, 0);",
          "",
          "[Removed Lines]",
          "560:         sqlite3TreeViewLine(pView, \"AGG_FUNCTION%d %Q\",",
          "561:                              pExpr->op2, pExpr->u.zToken);",
          "563:         sqlite3TreeViewLine(pView, \"FUNCTION %Q\", pExpr->u.zToken);",
          "",
          "[Added Lines]",
          "560:         sqlite3TreeViewLine(pView, \"AGG_FUNCTION%d %Q%s\",",
          "561:                              pExpr->op2, pExpr->u.zToken, zFlgs);",
          "563:         sqlite3TreeViewLine(pView, \"FUNCTION %Q%s\", pExpr->u.zToken, zFlgs);",
          "",
          "---------------"
        ],
        "test/func.test||test/func.test": [
          "File: test/func.test -> test/func.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "1419:   SELECT test_frombind(x.a,y.b,x.c,:123,y.e,x.f,$xyz+y.f) FROM t1 x, t1 y;",
          "1420: } {8}",
          "1425: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1422: # 2019-08-15",
          "1423: # Direct-only functions.",
          "1424: #",
          "1425: proc testdirectonly {x} {return [expr {$x*2}]}",
          "1426: do_test func-33.1 {",
          "1427:   db func testdirectonly -directonly testdirectonly",
          "1428:   db eval {SELECT testdirectonly(15)}",
          "1429: } {30}",
          "1430: do_catchsql_test func-33.2 {",
          "1431:   CREATE VIEW v33(y) AS SELECT testdirectonly(15);",
          "1432:   SELECT * FROM v33;",
          "1433: } {1 {testdirectonly() prohibited in triggers and views}}",
          "1434: do_execsql_test func-33.3 {",
          "1435:   SELECT * FROM (SELECT testdirectonly(15)) AS v33;",
          "1436: } {30}",
          "1437: do_execsql_test func-33.4 {",
          "1438:   WITH c(x) AS (SELECT testdirectonly(15))",
          "1439:   SELECT * FROM c;",
          "1440: } {30}",
          "1441: do_catchsql_test func-33.5 {",
          "1442:   WITH c(x) AS (SELECT * FROM v33)",
          "1443:   SELECT * FROM c;",
          "1444: } {1 {testdirectonly() prohibited in triggers and views}}",
          "1445: do_execsql_test func-33.10 {",
          "1446:   CREATE TABLE t33a(a,b);",
          "1447:   CREATE TABLE t33b(x,y);",
          "1448:   CREATE TRIGGER r1 AFTER INSERT ON t33a BEGIN",
          "1449:     INSERT INTO t33b(x,y) VALUES(testdirectonly(new.a),new.b);",
          "1450:   END;",
          "1451: } {}",
          "1452: do_catchsql_test func-33.11 {",
          "1453:   INSERT INTO t33a VALUES(1,2);",
          "1454: } {1 {testdirectonly() prohibited in triggers and views}}",
          "1455: do_execsql_test func-33.20 {",
          "1456:   ALTER TABLE t33a RENAME COLUMN a TO aaa;",
          "1457:   SELECT sql FROM sqlite_master WHERE name='r1';",
          "1458: } {{CREATE TRIGGER r1 AFTER INSERT ON t33a BEGIN",
          "1459:     INSERT INTO t33b(x,y) VALUES(testdirectonly(new.aaa),new.b);",
          "1460:   END}}",
          "",
          "---------------"
        ],
        "test/tclsqlite.test||test/tclsqlite.test": [
          "File: test/tclsqlite.test -> test/tclsqlite.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "790: do_test 17.6.3 {",
          "791:   list [catch { db function xyz -n object ret } msg] $msg",
          "794: # 2019-02-28: The \"bind_fallback\" command.",
          "795: #",
          "",
          "[Removed Lines]",
          "792: } {1 {bad option \"-n\": must be -argcount, -deterministic or -returntype}}",
          "",
          "[Added Lines]",
          "792: } {1 {bad option \"-n\": must be -argcount, -deterministic, -directonly, or -returntype}}",
          "",
          "---------------"
        ]
      }
    }
  ]
}