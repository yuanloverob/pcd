{
  "cve_id": "CVE-2014-0216",
  "cve_desc": "The My Home implementation in the block_html_pluginfile function in blocks/html/lib.php in Moodle through 2.3.11, 2.4.x before 2.4.10, 2.5.x before 2.5.6, and 2.6.x before 2.6.3 does not properly restrict file access, which allows remote attackers to obtain sensitive information by visiting an HTML block.",
  "repo": "moodle/moodle",
  "patch_hash": "b04bf988ef47f8fa65dd08ce936ecb774d5d76bd",
  "patch_info": {
    "commit_hash": "b04bf988ef47f8fa65dd08ce936ecb774d5d76bd",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/b04bf988ef47f8fa65dd08ce936ecb774d5d76bd",
    "files": [
      "blocks/html/lib.php"
    ],
    "message": "MDL-43877 blocks: Files from blocks in my/ were accessible to the world",
    "before_after_code_files": [
      "blocks/html/lib.php||blocks/html/lib.php"
    ]
  },
  "patch_diff": {
    "blocks/html/lib.php||blocks/html/lib.php": [
      "File: blocks/html/lib.php -> blocks/html/lib.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "34: function block_html_pluginfile($course, $birecord_or_cm, $context, $filearea, $args, $forcedownload, array $options=array()) {",
      "37:     if ($context->contextlevel != CONTEXT_BLOCK) {",
      "38:         send_file_not_found();",
      "",
      "[Removed Lines]",
      "35:     global $DB, $CFG;",
      "",
      "[Added Lines]",
      "35:     global $DB, $CFG, $USER;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "52:             if (!$category->visible) {",
      "53:                 require_capability('moodle/category:viewhiddencategories', $parentcontext);",
      "54:             }",
      "55:         }",
      "57:     }",
      "59:     if ($filearea !== 'content') {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "55:         } else if ($parentcontext->contextlevel === CONTEXT_USER && $parentcontext->instanceid != $USER->id) {",
      "57:             send_file_not_found();",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "568514ee7f7e994f61e7a44356fe89d0dd18c157",
      "candidate_info": {
        "commit_hash": "568514ee7f7e994f61e7a44356fe89d0dd18c157",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/568514ee7f7e994f61e7a44356fe89d0dd18c157",
        "files": [
          "blocks/html/lib.php"
        ],
        "message": "MDL-43877 blocks: Files from blocks in my/ were accessible to the world",
        "before_after_code_files": [
          "blocks/html/lib.php||blocks/html/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "blocks/html/lib.php||blocks/html/lib.php"
          ],
          "candidate": [
            "blocks/html/lib.php||blocks/html/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "blocks/html/lib.php||blocks/html/lib.php": [
          "File: blocks/html/lib.php -> blocks/html/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "35: function block_html_pluginfile($course, $birecord_or_cm, $context, $filearea, $args, $forcedownload, array $options=array()) {",
          "38:     if ($context->contextlevel != CONTEXT_BLOCK) {",
          "39:         send_file_not_found();",
          "",
          "[Removed Lines]",
          "36:     global $DB, $CFG;",
          "",
          "[Added Lines]",
          "36:     global $DB, $CFG, $USER;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:             if (!$category->visible) {",
          "54:                 require_capability('moodle/category:viewhiddencategories', $parentcontext);",
          "55:             }",
          "56:         }",
          "58:     }",
          "60:     if ($filearea !== 'content') {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "56:         } else if ($parentcontext->contextlevel === CONTEXT_USER && $parentcontext->instanceid != $USER->id) {",
          "58:             send_file_not_found();",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "40ad22fdd0d9ed569b2ad0ff6ad02814bfa014b8",
      "candidate_info": {
        "commit_hash": "40ad22fdd0d9ed569b2ad0ff6ad02814bfa014b8",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/40ad22fdd0d9ed569b2ad0ff6ad02814bfa014b8",
        "files": [
          "blocks/html/lib.php"
        ],
        "message": "MDL-43877 blocks: Files from blocks in my/ were accessible to the world",
        "before_after_code_files": [
          "blocks/html/lib.php||blocks/html/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "blocks/html/lib.php||blocks/html/lib.php"
          ],
          "candidate": [
            "blocks/html/lib.php||blocks/html/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "blocks/html/lib.php||blocks/html/lib.php": [
          "File: blocks/html/lib.php -> blocks/html/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "35: function block_html_pluginfile($course, $birecord_or_cm, $context, $filearea, $args, $forcedownload, array $options=array()) {",
          "38:     if ($context->contextlevel != CONTEXT_BLOCK) {",
          "39:         send_file_not_found();",
          "",
          "[Removed Lines]",
          "36:     global $DB, $CFG;",
          "",
          "[Added Lines]",
          "36:     global $DB, $CFG, $USER;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:             if (!$category->visible) {",
          "54:                 require_capability('moodle/category:viewhiddencategories', $parentcontext);",
          "55:             }",
          "56:         }",
          "58:     }",
          "60:     if ($filearea !== 'content') {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "56:         } else if ($parentcontext->contextlevel === CONTEXT_USER && $parentcontext->instanceid != $USER->id) {",
          "58:             send_file_not_found();",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7b9acc77efe06f7be7070032b05c3159e0a6d415",
      "candidate_info": {
        "commit_hash": "7b9acc77efe06f7be7070032b05c3159e0a6d415",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/7b9acc77efe06f7be7070032b05c3159e0a6d415",
        "files": [
          "blocks/html/lib.php"
        ],
        "message": "MDL-43877 blocks: Files from blocks in my/ were accessible to the world",
        "before_after_code_files": [
          "blocks/html/lib.php||blocks/html/lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "blocks/html/lib.php||blocks/html/lib.php"
          ],
          "candidate": [
            "blocks/html/lib.php||blocks/html/lib.php"
          ]
        }
      },
      "candidate_diff": {
        "blocks/html/lib.php||blocks/html/lib.php": [
          "File: blocks/html/lib.php -> blocks/html/lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "35: function block_html_pluginfile($course, $birecord_or_cm, $context, $filearea, $args, $forcedownload, array $options=array()) {",
          "38:     if ($context->contextlevel != CONTEXT_BLOCK) {",
          "39:         send_file_not_found();",
          "",
          "[Removed Lines]",
          "36:     global $DB, $CFG;",
          "",
          "[Added Lines]",
          "36:     global $DB, $CFG, $USER;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "53:             if (!$category->visible) {",
          "54:                 require_capability('moodle/category:viewhiddencategories', $parentcontext);",
          "55:             }",
          "56:         }",
          "58:     }",
          "60:     if ($filearea !== 'content') {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "56:         } else if ($parentcontext->contextlevel === CONTEXT_USER && $parentcontext->instanceid != $USER->id) {",
          "58:             send_file_not_found();",
          "",
          "---------------"
        ]
      }
    }
  ]
}