{
  "cve_id": "CVE-2012-6075",
  "cve_desc": "Buffer overflow in the e1000_receive function in the e1000 device driver (hw/e1000.c) in QEMU 1.3.0-rc2 and other versions, when the SBP and LPE flags are disabled, allows remote attackers to cause a denial of service (guest OS crash) and possibly execute arbitrary guest code via a large packet.",
  "repo": "qemu/qemu",
  "patch_hash": "b0d9ffcd0251161c7c92f94804dcf599dfa3edeb",
  "patch_info": {
    "commit_hash": "b0d9ffcd0251161c7c92f94804dcf599dfa3edeb",
    "repo": "qemu/qemu",
    "commit_url": "https://github.com/qemu/qemu/commit/b0d9ffcd0251161c7c92f94804dcf599dfa3edeb",
    "files": [
      "hw/e1000.c"
    ],
    "message": "e1000: Discard packets that are too long if !SBP and !LPE\n\nThe e1000_receive function for the e1000 needs to discard packets longer than\n1522 bytes if the SBP and LPE flags are disabled. The linux driver assumes\nthis behavior and allocates memory based on this assumption.\n\nSigned-off-by: Michael Contreras <michael@inetric.com>\nSigned-off-by: Anthony Liguori <aliguori@us.ibm.com>",
    "before_after_code_files": [
      "hw/e1000.c||hw/e1000.c"
    ]
  },
  "patch_diff": {
    "hw/e1000.c||hw/e1000.c": [
      "File: hw/e1000.c -> hw/e1000.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "59: #define PNPMMIO_SIZE      0x20000",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "63: #define MAXIMUM_ETHERNET_VLAN_SIZE 1522",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "805:         size = sizeof(min_buf);",
      "806:     }",
      "808:     if (!receive_filter(s, buf, size))",
      "809:         return size;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "812:     if (size > MAXIMUM_ETHERNET_VLAN_SIZE",
      "813:         && !(s->mac_reg[RCTL] & E1000_RCTL_LPE)",
      "814:         && !(s->mac_reg[RCTL] & E1000_RCTL_SBP)) {",
      "815:         return size;",
      "816:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e1a0ffb95728304f962ce36b27dcd3a16f04a05d",
      "candidate_info": {
        "commit_hash": "e1a0ffb95728304f962ce36b27dcd3a16f04a05d",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/e1a0ffb95728304f962ce36b27dcd3a16f04a05d",
        "files": [
          "hw/e1000.c"
        ],
        "message": "e1000: Discard packets that are too long if !SBP and !LPE\n\nThe e1000_receive function for the e1000 needs to discard packets longer than\n1522 bytes if the SBP and LPE flags are disabled. The linux driver assumes\nthis behavior and allocates memory based on this assumption.\n\nSigned-off-by: Michael Contreras <michael@inetric.com>\nSigned-off-by: Anthony Liguori <aliguori@us.ibm.com>\n(cherry picked from commit b0d9ffcd0251161c7c92f94804dcf599dfa3edeb)\n\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "hw/e1000.c||hw/e1000.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "hw/e1000.c||hw/e1000.c"
          ],
          "candidate": [
            "hw/e1000.c||hw/e1000.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/e1000.c||hw/e1000.c": [
          "File: hw/e1000.c -> hw/e1000.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "59: #define PNPMMIO_SIZE      0x20000",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "63: #define MAXIMUM_ETHERNET_VLAN_SIZE 1522",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "795:         size = sizeof(min_buf);",
          "796:     }",
          "798:     if (!receive_filter(s, buf, size))",
          "799:         return size;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "802:     if (size > MAXIMUM_ETHERNET_VLAN_SIZE",
          "803:         && !(s->mac_reg[RCTL] & E1000_RCTL_LPE)",
          "804:         && !(s->mac_reg[RCTL] & E1000_RCTL_SBP)) {",
          "805:         return size;",
          "806:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5afd0ecaa6d5f4807a7d87fd39c51a5ecec2caee",
      "candidate_info": {
        "commit_hash": "5afd0ecaa6d5f4807a7d87fd39c51a5ecec2caee",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/5afd0ecaa6d5f4807a7d87fd39c51a5ecec2caee",
        "files": [
          "hw/e1000.c"
        ],
        "message": "e1000: Discard oversized packets based on SBP|LPE\n\nDiscard packets longer than 16384 when !SBP to match the hardware behavior.\n\nSigned-off-by: Michael Contreras <michael@inetric.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n(cherry picked from commit 2c0331f4f7d241995452b99afaf0aab00493334a)\n\nSigned-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>",
        "before_after_code_files": [
          "hw/e1000.c||hw/e1000.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "hw/e1000.c||hw/e1000.c"
          ],
          "candidate": [
            "hw/e1000.c||hw/e1000.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/e1000.c||hw/e1000.c": [
          "File: hw/e1000.c -> hw/e1000.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "63: #define MAXIMUM_ETHERNET_VLAN_SIZE 1522",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "65: #define MAXIMUM_ETHERNET_LPE_SIZE 16384",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "809:     }",
          "814:         && !(s->mac_reg[RCTL] & E1000_RCTL_SBP)) {",
          "815:         return size;",
          "816:     }",
          "",
          "[Removed Lines]",
          "812:     if (size > MAXIMUM_ETHERNET_VLAN_SIZE",
          "813:         && !(s->mac_reg[RCTL] & E1000_RCTL_LPE)",
          "",
          "[Added Lines]",
          "814:     if ((size > MAXIMUM_ETHERNET_LPE_SIZE ||",
          "815:         (size > MAXIMUM_ETHERNET_VLAN_SIZE",
          "816:         && !(s->mac_reg[RCTL] & E1000_RCTL_LPE)))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2c0331f4f7d241995452b99afaf0aab00493334a",
      "candidate_info": {
        "commit_hash": "2c0331f4f7d241995452b99afaf0aab00493334a",
        "repo": "qemu/qemu",
        "commit_url": "https://github.com/qemu/qemu/commit/2c0331f4f7d241995452b99afaf0aab00493334a",
        "files": [
          "hw/e1000.c"
        ],
        "message": "e1000: Discard oversized packets based on SBP|LPE\n\nDiscard packets longer than 16384 when !SBP to match the hardware behavior.\n\nSigned-off-by: Michael Contreras <michael@inetric.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>",
        "before_after_code_files": [
          "hw/e1000.c||hw/e1000.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "hw/e1000.c||hw/e1000.c"
          ],
          "candidate": [
            "hw/e1000.c||hw/e1000.c"
          ]
        }
      },
      "candidate_diff": {
        "hw/e1000.c||hw/e1000.c": [
          "File: hw/e1000.c -> hw/e1000.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "63: #define MAXIMUM_ETHERNET_VLAN_SIZE 1522",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "65: #define MAXIMUM_ETHERNET_LPE_SIZE 16384",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "809:     }",
          "814:         && !(s->mac_reg[RCTL] & E1000_RCTL_SBP)) {",
          "815:         return size;",
          "816:     }",
          "",
          "[Removed Lines]",
          "812:     if (size > MAXIMUM_ETHERNET_VLAN_SIZE",
          "813:         && !(s->mac_reg[RCTL] & E1000_RCTL_LPE)",
          "",
          "[Added Lines]",
          "814:     if ((size > MAXIMUM_ETHERNET_LPE_SIZE ||",
          "815:         (size > MAXIMUM_ETHERNET_VLAN_SIZE",
          "816:         && !(s->mac_reg[RCTL] & E1000_RCTL_LPE)))",
          "",
          "---------------"
        ]
      }
    }
  ]
}