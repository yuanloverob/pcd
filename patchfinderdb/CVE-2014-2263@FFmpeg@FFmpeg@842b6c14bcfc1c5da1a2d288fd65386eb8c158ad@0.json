{
  "cve_id": "CVE-2014-2263",
  "cve_desc": "The mpegts_write_pmt function in the MPEG2 transport stream (aka DVB) muxer (libavformat/mpegtsenc.c) in FFmpeg, possibly 2.1 and earlier, allows remote attackers to have unspecified impact and vectors, which trigger an out-of-bounds write.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "842b6c14bcfc1c5da1a2d288fd65386eb8c158ad",
  "patch_info": {
    "commit_hash": "842b6c14bcfc1c5da1a2d288fd65386eb8c158ad",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/842b6c14bcfc1c5da1a2d288fd65386eb8c158ad",
    "files": [
      "libavformat/mpegtsenc.c"
    ],
    "message": "avformat/mpegtsenc: Check data array size in mpegts_write_pmt()\n\nPrevents out of array writes\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
    ]
  },
  "patch_diff": {
    "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c": [
      "File: libavformat/mpegtsenc.c -> libavformat/mpegtsenc.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "259:                           data, q - data);",
      "260: }",
      "263: {",
      "264:     MpegTSWrite *ts = s->priv_data;",
      "265:     uint8_t data[1012], *q, *desc_length_ptr, *program_info_length_ptr;",
      "",
      "[Removed Lines]",
      "262: static void mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
      "",
      "[Added Lines]",
      "262: static int mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "315:             stream_type = STREAM_TYPE_PRIVATE_DATA;",
      "316:             break;",
      "317:         }",
      "319:         put16(&q, 0xe000 | ts_st->pid);",
      "320:         desc_length_ptr = q;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "319:         if (q - data > sizeof(data) - 32)",
      "320:             return AVERROR(EINVAL);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "346:                 len_ptr = q++;",
      "350:                     next = strchr(p, ',');",
      "351:                     if (strlen(p) != 3 && (!next || next != p + 3))",
      "",
      "[Removed Lines]",
      "349:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4; p = next + 1) {",
      "",
      "[Added Lines]",
      "353:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4 && q - data < sizeof(data) - 4; p = next + 1) {",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "423:                     len_ptr = q++;",
      "",
      "[Removed Lines]",
      "425:                     while (strlen(language) >= 3) {",
      "",
      "[Added Lines]",
      "429:                     while (strlen(language) >= 3 && q - data < sizeof(data) - 6) {",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "476:     }",
      "477:     mpegts_write_section1(&service->pmt, PMT_TID, service->sid, ts->tables_version, 0, 0,",
      "478:                           data, q - data);",
      "479: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "483:     return 0;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "12770701856a05b6b3cd706f708f8e9a4e8a1336",
      "candidate_info": {
        "commit_hash": "12770701856a05b6b3cd706f708f8e9a4e8a1336",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/12770701856a05b6b3cd706f708f8e9a4e8a1336",
        "files": [
          "libavformat/mpegtsenc.c"
        ],
        "message": "avformat/mpegtsenc: Check data array size in mpegts_write_pmt()\n\nPrevents out of array writes\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 842b6c14bcfc1c5da1a2d288fd65386eb8c158ad)\n\nConflicts:\n\n\tlibavformat/mpegtsenc.c\n(cherry picked from commit e87de3f50b765134588d0b048c32ed4b8acc16fb)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
          ],
          "candidate": [
            "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c": [
          "File: libavformat/mpegtsenc.c -> libavformat/mpegtsenc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "240:                           data, q - data);",
          "241: }",
          "244: {",
          "246:     uint8_t data[1012], *q, *desc_length_ptr, *program_info_length_ptr;",
          "",
          "[Removed Lines]",
          "243: static void mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
          "",
          "[Added Lines]",
          "243: static int mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "293:             stream_type = STREAM_TYPE_PRIVATE_DATA;",
          "294:             break;",
          "295:         }",
          "297:         put16(&q, 0xe000 | ts_st->pid);",
          "298:         desc_length_ptr = q;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "297:         if (q - data > sizeof(data) - 32)",
          "298:             return AVERROR(EINVAL);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "324:                 len_ptr = q++;",
          "328:                     next = strchr(p, ',');",
          "329:                     if (strlen(p) != 3 && (!next || next != p + 3))",
          "",
          "[Removed Lines]",
          "327:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4; p = next + 1) {",
          "",
          "[Added Lines]",
          "331:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4 && q - data < sizeof(data) - 4; p = next + 1) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "386:     }",
          "387:     mpegts_write_section1(&service->pmt, PMT_TID, service->sid, 0, 0, 0,",
          "388:                           data, q - data);",
          "389: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "393:     return 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d234e1d333c95d2f883830e8deeac04cd1c15673",
      "candidate_info": {
        "commit_hash": "d234e1d333c95d2f883830e8deeac04cd1c15673",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/d234e1d333c95d2f883830e8deeac04cd1c15673",
        "files": [
          "libavformat/mpegtsenc.c"
        ],
        "message": "avformat/mpegtsenc: Check data array size in mpegts_write_pmt()\n\nPrevents out of array writes\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 842b6c14bcfc1c5da1a2d288fd65386eb8c158ad)\n\nConflicts:\n\n\tlibavformat/mpegtsenc.c\n(cherry picked from commit e87de3f50b765134588d0b048c32ed4b8acc16fb)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
          ],
          "candidate": [
            "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c": [
          "File: libavformat/mpegtsenc.c -> libavformat/mpegtsenc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "232:                           data, q - data);",
          "233: }",
          "236: {",
          "238:     uint8_t data[1012], *q, *desc_length_ptr, *program_info_length_ptr;",
          "",
          "[Removed Lines]",
          "235: static void mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
          "",
          "[Added Lines]",
          "235: static int mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "285:             stream_type = STREAM_TYPE_PRIVATE_DATA;",
          "286:             break;",
          "287:         }",
          "289:         put16(&q, 0xe000 | ts_st->pid);",
          "290:         desc_length_ptr = q;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "289:         if (q - data > sizeof(data) - 32)",
          "290:             return AVERROR(EINVAL);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "308:                 len_ptr = q++;",
          "312:                     next = strchr(p, ',');",
          "313:                     if (strlen(p) != 3 && (!next || next != p + 3))",
          "",
          "[Removed Lines]",
          "311:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4; p = next + 1) {",
          "",
          "[Added Lines]",
          "315:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4 && q - data < sizeof(data) - 4; p = next + 1) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "370:     }",
          "371:     mpegts_write_section1(&service->pmt, PMT_TID, service->sid, 0, 0, 0,",
          "372:                           data, q - data);",
          "373: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "377:     return 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7ad6b66370e59e7eafb17bd5d43c46e3abf51f04",
      "candidate_info": {
        "commit_hash": "7ad6b66370e59e7eafb17bd5d43c46e3abf51f04",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/7ad6b66370e59e7eafb17bd5d43c46e3abf51f04",
        "files": [
          "libavformat/mpegtsenc.c"
        ],
        "message": "avformat/mpegtsenc: Check data array size in mpegts_write_pmt()\n\nPrevents out of array writes\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 842b6c14bcfc1c5da1a2d288fd65386eb8c158ad)\n\nConflicts:\n\n\tlibavformat/mpegtsenc.c\n(cherry picked from commit e87de3f50b765134588d0b048c32ed4b8acc16fb)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
          ],
          "candidate": [
            "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c": [
          "File: libavformat/mpegtsenc.c -> libavformat/mpegtsenc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "255:                           data, q - data);",
          "256: }",
          "259: {",
          "260:     MpegTSWrite *ts = s->priv_data;",
          "261:     uint8_t data[1012], *q, *desc_length_ptr, *program_info_length_ptr;",
          "",
          "[Removed Lines]",
          "258: static void mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
          "",
          "[Added Lines]",
          "258: static int mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "308:             stream_type = STREAM_TYPE_PRIVATE_DATA;",
          "309:             break;",
          "310:         }",
          "312:         put16(&q, 0xe000 | ts_st->pid);",
          "313:         desc_length_ptr = q;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "312:         if (q - data > sizeof(data) - 32)",
          "313:             return AVERROR(EINVAL);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "339:                 len_ptr = q++;",
          "343:                     next = strchr(p, ',');",
          "344:                     if (strlen(p) != 3 && (!next || next != p + 3))",
          "",
          "[Removed Lines]",
          "342:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4; p = next + 1) {",
          "",
          "[Added Lines]",
          "346:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4 && q - data < sizeof(data) - 4; p = next + 1) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "401:     }",
          "402:     mpegts_write_section1(&service->pmt, PMT_TID, service->sid, 0, 0, 0,",
          "403:                           data, q - data);",
          "404: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "408:     return 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "694c3a13c9489c6e05f88486b489dd0746d114fc",
      "candidate_info": {
        "commit_hash": "694c3a13c9489c6e05f88486b489dd0746d114fc",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/694c3a13c9489c6e05f88486b489dd0746d114fc",
        "files": [
          "libavformat/mpegtsenc.c"
        ],
        "message": "avformat/mpegtsenc: Check data array size in mpegts_write_pmt()\n\nPrevents out of array writes\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 842b6c14bcfc1c5da1a2d288fd65386eb8c158ad)\n\nConflicts:\n\n\tlibavformat/mpegtsenc.c\n(cherry picked from commit e87de3f50b765134588d0b048c32ed4b8acc16fb)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
          ],
          "candidate": [
            "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c": [
          "File: libavformat/mpegtsenc.c -> libavformat/mpegtsenc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "255:                           data, q - data);",
          "256: }",
          "259: {",
          "260:     MpegTSWrite *ts = s->priv_data;",
          "261:     uint8_t data[1012], *q, *desc_length_ptr, *program_info_length_ptr;",
          "",
          "[Removed Lines]",
          "258: static void mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
          "",
          "[Added Lines]",
          "258: static int mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "308:             stream_type = STREAM_TYPE_PRIVATE_DATA;",
          "309:             break;",
          "310:         }",
          "312:         put16(&q, 0xe000 | ts_st->pid);",
          "313:         desc_length_ptr = q;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "312:         if (q - data > sizeof(data) - 32)",
          "313:             return AVERROR(EINVAL);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "339:                 len_ptr = q++;",
          "343:                     next = strchr(p, ',');",
          "344:                     if (strlen(p) != 3 && (!next || next != p + 3))",
          "",
          "[Removed Lines]",
          "342:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4; p = next + 1) {",
          "",
          "[Added Lines]",
          "346:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4 && q - data < sizeof(data) - 4; p = next + 1) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "401:     }",
          "402:     mpegts_write_section1(&service->pmt, PMT_TID, service->sid, 0, 0, 0,",
          "403:                           data, q - data);",
          "404: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "408:     return 0;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a57d29a50c7a65cd75d55db78ffb24d326aec38f",
      "candidate_info": {
        "commit_hash": "a57d29a50c7a65cd75d55db78ffb24d326aec38f",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/a57d29a50c7a65cd75d55db78ffb24d326aec38f",
        "files": [
          "libavformat/mpegtsenc.c"
        ],
        "message": "avformat/mpegtsenc: Check data array size in mpegts_write_pmt()\n\nPrevents out of array writes\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 842b6c14bcfc1c5da1a2d288fd65386eb8c158ad)\n\nConflicts:\n\n\tlibavformat/mpegtsenc.c\n(cherry picked from commit e87de3f50b765134588d0b048c32ed4b8acc16fb)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
          ],
          "candidate": [
            "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/mpegtsenc.c||libavformat/mpegtsenc.c": [
          "File: libavformat/mpegtsenc.c -> libavformat/mpegtsenc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "255:                           data, q - data);",
          "256: }",
          "259: {",
          "260:     MpegTSWrite *ts = s->priv_data;",
          "261:     uint8_t data[1012], *q, *desc_length_ptr, *program_info_length_ptr;",
          "",
          "[Removed Lines]",
          "258: static void mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
          "",
          "[Added Lines]",
          "258: static int mpegts_write_pmt(AVFormatContext *s, MpegTSService *service)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "308:             stream_type = STREAM_TYPE_PRIVATE_DATA;",
          "309:             break;",
          "310:         }",
          "312:         put16(&q, 0xe000 | ts_st->pid);",
          "313:         desc_length_ptr = q;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "312:         if (q - data > sizeof(data) - 32)",
          "313:             return AVERROR(EINVAL);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "339:                 len_ptr = q++;",
          "343:                     next = strchr(p, ',');",
          "344:                     if (strlen(p) != 3 && (!next || next != p + 3))",
          "",
          "[Removed Lines]",
          "342:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4; p = next + 1) {",
          "",
          "[Added Lines]",
          "346:                 for (p = lang->value; next && *len_ptr < 255 / 4 * 4 && q - data < sizeof(data) - 4; p = next + 1) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "401:     }",
          "402:     mpegts_write_section1(&service->pmt, PMT_TID, service->sid, 0, 0, 0,",
          "403:                           data, q - data);",
          "404: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "408:     return 0;",
          "",
          "---------------"
        ]
      }
    }
  ]
}