{
  "cve_id": "CVE-2016-2176",
  "cve_desc": "The X509_NAME_oneline function in crypto/x509/x509_obj.c in OpenSSL before 1.0.1t and 1.0.2 before 1.0.2h allows remote attackers to obtain sensitive information from process stack memory or cause a denial of service (buffer over-read) via crafted EBCDIC ASN.1 data.",
  "repo": "openssl/openssl",
  "patch_hash": "ea96ad5a206b7b5f25dad230333e8ff032df3219",
  "patch_info": {
    "commit_hash": "ea96ad5a206b7b5f25dad230333e8ff032df3219",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/ea96ad5a206b7b5f25dad230333e8ff032df3219",
    "files": [
      "crypto/x509/x509_obj.c"
    ],
    "message": "Prevent EBCDIC overread for very long strings\n\nASN1 Strings that are over 1024 bytes can cause an overread in\napplications using the X509_NAME_oneline() function on EBCDIC systems.\nThis could result in arbitrary stack data being returned in the buffer.\n\nIssue reported by Guido Vranken.\n\nCVE-2016-2176\n\nReviewed-by: Andy Polyakov <appro@openssl.org>",
    "before_after_code_files": [
      "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c"
    ]
  },
  "patch_diff": {
    "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c": [
      "File: crypto/x509/x509_obj.c -> crypto/x509/x509_obj.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "130:             type == V_ASN1_PRINTABLESTRING ||",
      "131:             type == V_ASN1_TELETEXSTRING ||",
      "132:             type == V_ASN1_VISIBLESTRING || type == V_ASN1_IA5STRING) {",
      "135:             q = ebcdic_buf;",
      "136:         }",
      "137: #endif",
      "",
      "[Removed Lines]",
      "133:             ascii2ebcdic(ebcdic_buf, q, (num > (int)sizeof(ebcdic_buf))",
      "134:                          ? (int)sizeof(ebcdic_buf) : num);",
      "",
      "[Added Lines]",
      "133:             if (num > (int)sizeof(ebcdic_buf))",
      "134:                 num = sizeof(ebcdic_buf);",
      "135:             ascii2ebcdic(ebcdic_buf, q, num);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "4cd5c3f4eef81c791a5041dc17ec27aa08540e42",
      "candidate_info": {
        "commit_hash": "4cd5c3f4eef81c791a5041dc17ec27aa08540e42",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/4cd5c3f4eef81c791a5041dc17ec27aa08540e42",
        "files": [
          "crypto/x509/x509_obj.c"
        ],
        "message": "Fix a build error with strict-warnings and CHARSET_EBCDIC\n\nReviewed-by: Andy Polyakov <appro@openssl.org>",
        "before_after_code_files": [
          "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c"
          ],
          "candidate": [
            "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c": [
          "File: crypto/x509/x509_obj.c -> crypto/x509/x509_obj.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "76:     int gs_doit[4];",
          "77:     char tmp_buf[80];",
          "78: #ifdef CHARSET_EBCDIC",
          "80: #endif",
          "82:     if (buf == NULL) {",
          "",
          "[Removed Lines]",
          "79:     char ebcdic_buf[1024];",
          "",
          "[Added Lines]",
          "79:     unsigned char ebcdic_buf[1024];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "117:             type == V_ASN1_PRINTABLESTRING ||",
          "118:             type == V_ASN1_TELETEXSTRING ||",
          "119:             type == V_ASN1_VISIBLESTRING || type == V_ASN1_IA5STRING) {",
          "122:             q = ebcdic_buf;",
          "123:         }",
          "124: #endif",
          "",
          "[Removed Lines]",
          "120:             ascii2ebcdic(ebcdic_buf, q, (num > sizeof ebcdic_buf)",
          "121:                          ? sizeof ebcdic_buf : num);",
          "",
          "[Added Lines]",
          "120:             ascii2ebcdic(ebcdic_buf, q, (num > (int)sizeof(ebcdic_buf))",
          "121:                          ? (int)sizeof(ebcdic_buf) : num);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2919516136a4227d9e6d8f2fe66ef976aaf8c561",
      "candidate_info": {
        "commit_hash": "2919516136a4227d9e6d8f2fe66ef976aaf8c561",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/2919516136a4227d9e6d8f2fe66ef976aaf8c561",
        "files": [
          "crypto/x509/x509_obj.c"
        ],
        "message": "Prevent EBCDIC overread for very long strings\n\nASN1 Strings that are over 1024 bytes can cause an overread in\napplications using the X509_NAME_oneline() function on EBCDIC systems.\nThis could result in arbitrary stack data being returned in the buffer.\n\nIssue reported by Guido Vranken.\n\nCVE-2016-2176\n\nReviewed-by: Andy Polyakov <appro@openssl.org>",
        "before_after_code_files": [
          "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c"
          ],
          "candidate": [
            "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c": [
          "File: crypto/x509/x509_obj.c -> crypto/x509/x509_obj.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "130:             type == V_ASN1_PRINTABLESTRING ||",
          "131:             type == V_ASN1_TELETEXSTRING ||",
          "132:             type == V_ASN1_VISIBLESTRING || type == V_ASN1_IA5STRING) {",
          "135:             q = ebcdic_buf;",
          "136:         }",
          "137: #endif",
          "",
          "[Removed Lines]",
          "133:             ascii2ebcdic(ebcdic_buf, q, (num > sizeof ebcdic_buf)",
          "134:                          ? sizeof ebcdic_buf : num);",
          "",
          "[Added Lines]",
          "133:             if (num > (int)sizeof(ebcdic_buf))",
          "134:                 num = sizeof(ebcdic_buf);",
          "135:             ascii2ebcdic(ebcdic_buf, q, num);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9f2ccf1d718ab66c778a623f9aed3cddf17503a2",
      "candidate_info": {
        "commit_hash": "9f2ccf1d718ab66c778a623f9aed3cddf17503a2",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/9f2ccf1d718ab66c778a623f9aed3cddf17503a2",
        "files": [
          "crypto/x509/x509_obj.c"
        ],
        "message": "Prevent EBCDIC overread for very long strings\n\nASN1 Strings that are over 1024 bytes can cause an overread in\napplications using the X509_NAME_oneline() function on EBCDIC systems.\nThis could result in arbitrary stack data being returned in the buffer.\n\nIssue reported by Guido Vranken.\n\nCVE-2016-2176\n\nReviewed-by: Andy Polyakov <appro@openssl.org>",
        "before_after_code_files": [
          "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c"
          ],
          "candidate": [
            "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c"
          ]
        }
      },
      "candidate_diff": {
        "crypto/x509/x509_obj.c||crypto/x509/x509_obj.c": [
          "File: crypto/x509/x509_obj.c -> crypto/x509/x509_obj.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "130:             type == V_ASN1_PRINTABLESTRING ||",
          "131:             type == V_ASN1_TELETEXSTRING ||",
          "132:             type == V_ASN1_VISIBLESTRING || type == V_ASN1_IA5STRING) {",
          "135:             q = ebcdic_buf;",
          "136:         }",
          "137: #endif",
          "",
          "[Removed Lines]",
          "133:             ascii2ebcdic(ebcdic_buf, q, (num > sizeof ebcdic_buf)",
          "134:                          ? sizeof ebcdic_buf : num);",
          "",
          "[Added Lines]",
          "133:             if (num > (int)sizeof(ebcdic_buf))",
          "134:                 num = sizeof(ebcdic_buf);",
          "135:             ascii2ebcdic(ebcdic_buf, q, num);",
          "",
          "---------------"
        ]
      }
    }
  ]
}