{
  "cve_id": "CVE-2017-14057",
  "cve_desc": "In FFmpeg 3.3.3, a DoS in asf_read_marker() due to lack of an EOF (End of File) check might cause huge CPU and memory consumption. When a crafted ASF file, which claims a large \"name_len\" or \"count\" field in the header but does not contain sufficient backing data, is provided, the loops over the name and markers would consume huge CPU and memory resources, since there is no EOF check inside these loops.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "7f9ec5593e04827249e7aeb466da06a98a0d7329",
  "patch_info": {
    "commit_hash": "7f9ec5593e04827249e7aeb466da06a98a0d7329",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/7f9ec5593e04827249e7aeb466da06a98a0d7329",
    "files": [
      "libavformat/asfdec_f.c"
    ],
    "message": "avformat/asfdec: Fix DoS due to lack of eof check\n\nFixes: loop.asf\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
    "before_after_code_files": [
      "libavformat/asfdec_f.c||libavformat/asfdec_f.c"
    ]
  },
  "patch_diff": {
    "libavformat/asfdec_f.c||libavformat/asfdec_f.c": [
      "File: libavformat/asfdec_f.c -> libavformat/asfdec_f.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "749:     count = avio_rl32(pb);    // markers count",
      "750:     avio_rl16(pb);            // reserved 2 bytes",
      "751:     name_len = avio_rl16(pb); // name length",
      "755:     for (i = 0; i < count; i++) {",
      "756:         int64_t pres_time;",
      "757:         int name_len;",
      "759:         avio_rl64(pb);             // offset, 8 bytes",
      "760:         pres_time = avio_rl64(pb); // presentation time",
      "761:         pres_time -= asf->hdr.preroll * 10000;",
      "",
      "[Removed Lines]",
      "752:     for (i = 0; i < name_len; i++)",
      "753:         avio_r8(pb); // skip the name",
      "",
      "[Added Lines]",
      "752:     avio_skip(pb, name_len);",
      "758:         if (avio_feof(pb))",
      "759:             return AVERROR_INVALIDDATA;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6904464301bbfff6e21616d43d657b163359bb3d",
      "candidate_info": {
        "commit_hash": "6904464301bbfff6e21616d43d657b163359bb3d",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/6904464301bbfff6e21616d43d657b163359bb3d",
        "files": [
          "libavformat/asfdec_f.c"
        ],
        "message": "avformat/asfdec: Fix DoS due to lack of eof check\n\nFixes: loop.asf\n\nFound-by: Xiaohei and Wangchu from Alibaba Security Team\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 7f9ec5593e04827249e7aeb466da06a98a0d7329)\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavformat/asfdec_f.c||libavformat/asfdec_f.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavformat/asfdec_f.c||libavformat/asfdec_f.c"
          ],
          "candidate": [
            "libavformat/asfdec_f.c||libavformat/asfdec_f.c"
          ]
        }
      },
      "candidate_diff": {
        "libavformat/asfdec_f.c||libavformat/asfdec_f.c": [
          "File: libavformat/asfdec_f.c -> libavformat/asfdec_f.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "749:     count = avio_rl32(pb);    // markers count",
          "750:     avio_rl16(pb);            // reserved 2 bytes",
          "751:     name_len = avio_rl16(pb); // name length",
          "755:     for (i = 0; i < count; i++) {",
          "756:         int64_t pres_time;",
          "757:         int name_len;",
          "759:         avio_rl64(pb);             // offset, 8 bytes",
          "760:         pres_time = avio_rl64(pb); // presentation time",
          "761:         pres_time -= asf->hdr.preroll * 10000;",
          "",
          "[Removed Lines]",
          "752:     for (i = 0; i < name_len; i++)",
          "753:         avio_r8(pb); // skip the name",
          "",
          "[Added Lines]",
          "752:     avio_skip(pb, name_len);",
          "758:         if (avio_feof(pb))",
          "759:             return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    }
  ]
}