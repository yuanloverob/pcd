{
  "cve_id": "CVE-2022-23579",
  "cve_desc": "Tensorflow is an Open Source Machine Learning Framework. The Grappler optimizer in TensorFlow can be used to cause a denial of service by altering a `SavedModel` such that `SafeToRemoveIdentity` would trigger `CHECK` failures. The fix will be included in TensorFlow 2.8.0. We will also cherrypick this commit on TensorFlow 2.7.1, TensorFlow 2.6.3, and TensorFlow 2.5.3, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "92dba16749fae36c246bec3f9ba474d9ddeb7662",
  "patch_info": {
    "commit_hash": "92dba16749fae36c246bec3f9ba474d9ddeb7662",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/92dba16749fae36c246bec3f9ba474d9ddeb7662",
    "files": [
      "tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
    ],
    "message": "Prevent a null-pointer dereference / `CHECK`-fail in grappler.\n\nPiperOrigin-RevId: 409187354\nChange-Id: I369c249cca32e6c56ec193f0ebbf2f2768fc7d43",
    "before_after_code_files": [
      "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc": [
      "File: tensorflow/core/grappler/optimizers/dependency_optimizer.cc -> tensorflow/core/grappler/optimizers/dependency_optimizer.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "75:   }",
      "77:   const NodeDef* input = node_map_->GetNode(NodeName(node.input(0)));",
      "82:   if (IsVariable(*input) || IsRecv(*input)) {",
      "",
      "[Removed Lines]",
      "78:   CHECK(input != nullptr) << \"node = \" << node.name()",
      "79:                           << \" input = \" << node.input(0);",
      "",
      "[Added Lines]",
      "78:   if (input == nullptr) {",
      "79:     VLOG(1) << \"node = \" << node.name() << \" input = \" << node.input(0);",
      "80:     return false;",
      "81:   }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "2692a25c985f417958ebd1f3f57016dd6654bc87",
      "candidate_info": {
        "commit_hash": "2692a25c985f417958ebd1f3f57016dd6654bc87",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/2692a25c985f417958ebd1f3f57016dd6654bc87",
        "files": [
          "tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
        ],
        "message": "Prevent a null-pointer dereference / `CHECK`-fail in grappler.\n\nPiperOrigin-RevId: 409187354\nChange-Id: I369c249cca32e6c56ec193f0ebbf2f2768fc7d43",
        "before_after_code_files": [
          "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
          ],
          "candidate": [
            "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc": [
          "File: tensorflow/core/grappler/optimizers/dependency_optimizer.cc -> tensorflow/core/grappler/optimizers/dependency_optimizer.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "75:   }",
          "77:   const NodeDef* input = node_map_->GetNode(NodeName(node.input(0)));",
          "82:   if (IsVariable(*input) || IsRecv(*input)) {",
          "",
          "[Removed Lines]",
          "78:   CHECK(input != nullptr) << \"node = \" << node.name()",
          "79:                           << \" input = \" << node.input(0);",
          "",
          "[Added Lines]",
          "78:   if (input == nullptr) {",
          "79:     VLOG(1) << \"node = \" << node.name() << \" input = \" << node.input(0);",
          "80:     return false;",
          "81:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d937317d0afcdff1aeae945d75d8d6f3bb851c75",
      "candidate_info": {
        "commit_hash": "d937317d0afcdff1aeae945d75d8d6f3bb851c75",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/d937317d0afcdff1aeae945d75d8d6f3bb851c75",
        "files": [
          "tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
        ],
        "message": "Prevent a null-pointer dereference / `CHECK`-fail in grappler.\n\nPiperOrigin-RevId: 409187354\nChange-Id: I369c249cca32e6c56ec193f0ebbf2f2768fc7d43",
        "before_after_code_files": [
          "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
          ],
          "candidate": [
            "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc": [
          "File: tensorflow/core/grappler/optimizers/dependency_optimizer.cc -> tensorflow/core/grappler/optimizers/dependency_optimizer.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "75:   }",
          "77:   const NodeDef* input = node_map_->GetNode(NodeName(node.input(0)));",
          "82:   if (IsVariable(*input) || IsRecv(*input)) {",
          "",
          "[Removed Lines]",
          "78:   CHECK(input != nullptr) << \"node = \" << node.name()",
          "79:                           << \" input = \" << node.input(0);",
          "",
          "[Added Lines]",
          "78:   if (input == nullptr) {",
          "79:     VLOG(1) << \"node = \" << node.name() << \" input = \" << node.input(0);",
          "80:     return false;",
          "81:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ad36151cbc1d14f625e37ff0f3be0d4b61e39467",
      "candidate_info": {
        "commit_hash": "ad36151cbc1d14f625e37ff0f3be0d4b61e39467",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/ad36151cbc1d14f625e37ff0f3be0d4b61e39467",
        "files": [
          "tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
        ],
        "message": "Prevent a null-pointer dereference / `CHECK`-fail in grappler.\n\nPiperOrigin-RevId: 409187354\nChange-Id: I369c249cca32e6c56ec193f0ebbf2f2768fc7d43",
        "before_after_code_files": [
          "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
          ],
          "candidate": [
            "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/grappler/optimizers/dependency_optimizer.cc||tensorflow/core/grappler/optimizers/dependency_optimizer.cc": [
          "File: tensorflow/core/grappler/optimizers/dependency_optimizer.cc -> tensorflow/core/grappler/optimizers/dependency_optimizer.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "75:   }",
          "77:   const NodeDef* input = node_map_->GetNode(NodeName(node.input(0)));",
          "82:   if (IsVariable(*input) || IsRecv(*input)) {",
          "",
          "[Removed Lines]",
          "78:   CHECK(input != nullptr) << \"node = \" << node.name()",
          "79:                           << \" input = \" << node.input(0);",
          "",
          "[Added Lines]",
          "78:   if (input == nullptr) {",
          "79:     VLOG(1) << \"node = \" << node.name() << \" input = \" << node.input(0);",
          "80:     return false;",
          "81:   }",
          "",
          "---------------"
        ]
      }
    }
  ]
}