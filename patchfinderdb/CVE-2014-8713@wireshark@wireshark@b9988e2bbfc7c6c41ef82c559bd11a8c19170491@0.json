{
  "cve_id": "CVE-2014-8713",
  "cve_desc": "Stack-based buffer overflow in the build_expert_data function in epan/dissectors/packet-ncp2222.inc in the NCP dissector in Wireshark 1.10.x before 1.10.11 and 1.12.x before 1.12.2 allows remote attackers to cause a denial of service (application crash) via a crafted packet.",
  "repo": "wireshark/wireshark",
  "patch_hash": "b9988e2bbfc7c6c41ef82c559bd11a8c19170491",
  "patch_info": {
    "commit_hash": "b9988e2bbfc7c6c41ef82c559bd11a8c19170491",
    "repo": "wireshark/wireshark",
    "commit_url": "https://github.com/wireshark/wireshark/commit/b9988e2bbfc7c6c41ef82c559bd11a8c19170491",
    "files": [
      "epan/dissectors/packet-ncp2222.inc"
    ],
    "message": "ncp2222: don't overflow buffer constructing string\n\nFixes stack-smashing vuln.\n\nSomehow there was already an XXX in the code about this, but nobody realized at\nthe time it was worth fixing... really?\n\nBug: 10552\nChange-Id: I849068bd6c45146339444f295b72430d3c6e08f2\nReviewed-on: https://code.wireshark.org/review/4653\nReviewed-by: Evan Huus <eapache@gmail.com>",
    "before_after_code_files": [
      "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
    ]
  },
  "patch_diff": {
    "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc": [
      "File: epan/dissectors/packet-ncp2222.inc -> epan/dissectors/packet-ncp2222.inc",
      "--- Hunk 1 ---",
      "[Context before]",
      "2755:             case 18:",
      "2756:             case 19:",
      "2760:                 if (repeat_lookup > 0) {",
      "2761:                     if (strlen(temp_buffer) + strlen(buffer) < 250) {",
      "2762:                         g_strlcat(temp_buffer, buffer, 256);",
      "",
      "[Removed Lines]",
      "2759:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), get_finfo_length(PTREE_FINFO(tree_pointer)), buffer);",
      "",
      "[Added Lines]",
      "2758:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), MIN(get_finfo_length(PTREE_FINFO(tree_pointer)), buffer_size), buffer);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6b8c5dba634cde2fe95fca81668337380f19d641",
      "candidate_info": {
        "commit_hash": "6b8c5dba634cde2fe95fca81668337380f19d641",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/6b8c5dba634cde2fe95fca81668337380f19d641",
        "files": [
          "epan/dissectors/packet-ncp2222.inc"
        ],
        "message": "ncp2222: don't overflow buffer constructing string\n\nFixes stack-smashing vuln.\n\nSomehow there was already an XXX in the code about this, but nobody realized at\nthe time it was worth fixing... really?\n\nBug: 10552\nChange-Id: I849068bd6c45146339444f295b72430d3c6e08f2\nReviewed-on: https://code.wireshark.org/review/4653\nReviewed-by: Evan Huus <eapache@gmail.com>\n(cherry picked from commit b9988e2bbfc7c6c41ef82c559bd11a8c19170491)\nReviewed-on: https://code.wireshark.org/review/4654\nReviewed-on: https://code.wireshark.org/review/5336\nReviewed-by: Michael Mann <mmann78@netscape.net>",
        "before_after_code_files": [
          "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
          ],
          "candidate": [
            "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc": [
          "File: epan/dissectors/packet-ncp2222.inc -> epan/dissectors/packet-ncp2222.inc",
          "--- Hunk 1 ---",
          "[Context before]",
          "2756:             case 18:",
          "2757:             case 19:",
          "2761:                 if (repeat_lookup > 0) {",
          "2762:                     if (strlen(temp_buffer) + strlen(buffer) < 250) {",
          "2763:                         g_strlcat(temp_buffer, buffer, 256);",
          "",
          "[Removed Lines]",
          "2760:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), get_finfo_length(PTREE_FINFO(tree_pointer)), buffer);",
          "",
          "[Added Lines]",
          "2759:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), MIN(get_finfo_length(PTREE_FINFO(tree_pointer)), buffer_size), buffer);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "146cff5a11ae02b1cbae85ca947c8ca0491f541e",
      "candidate_info": {
        "commit_hash": "146cff5a11ae02b1cbae85ca947c8ca0491f541e",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/146cff5a11ae02b1cbae85ca947c8ca0491f541e",
        "files": [
          "epan/dissectors/packet-ncp2222.inc"
        ],
        "message": "ncp2222: don't overflow buffer constructing string\n\nFixes stack-smashing vuln.\n\nSomehow there was already an XXX in the code about this, but nobody realized at\nthe time it was worth fixing... really?\n\nBug: 10552\nChange-Id: I849068bd6c45146339444f295b72430d3c6e08f2\nReviewed-on: https://code.wireshark.org/review/4653\nReviewed-by: Evan Huus <eapache@gmail.com>\n(cherry picked from commit b9988e2bbfc7c6c41ef82c559bd11a8c19170491)\nReviewed-on: https://code.wireshark.org/review/4654\n(cherry picked from commit 6fa8338b381c0018f8dcc8286c554903a5fa4cb8)\nReviewed-on: https://code.wireshark.org/review/4655",
        "before_after_code_files": [
          "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
          ],
          "candidate": [
            "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc": [
          "File: epan/dissectors/packet-ncp2222.inc -> epan/dissectors/packet-ncp2222.inc",
          "--- Hunk 1 ---",
          "[Context before]",
          "2757:             case 18:",
          "2758:             case 19:",
          "2762:                 if (repeat_lookup > 0) {",
          "2763:                     if (strlen(temp_buffer) + strlen(buffer) < 250) {",
          "2764:                         g_strlcat(temp_buffer, buffer, 256);",
          "",
          "[Removed Lines]",
          "2761:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), get_finfo_length(PTREE_FINFO(tree_pointer)), buffer);",
          "",
          "[Added Lines]",
          "2760:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), MIN(get_finfo_length(PTREE_FINFO(tree_pointer)), buffer_size), buffer);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b75179a7c392a134801bf988b1b2d7400d4670b4",
      "candidate_info": {
        "commit_hash": "b75179a7c392a134801bf988b1b2d7400d4670b4",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/b75179a7c392a134801bf988b1b2d7400d4670b4",
        "files": [
          "epan/dissectors/packet-ncp2222.inc"
        ],
        "message": "ncp2222: don't overflow buffer constructing string\n\nFixes stack-smashing vuln.\n\nSomehow there was already an XXX in the code about this, but nobody realized at\nthe time it was worth fixing... really?\n\nBug: 10552\nChange-Id: I849068bd6c45146339444f295b72430d3c6e08f2\nReviewed-on: https://code.wireshark.org/review/4653\nReviewed-by: Evan Huus <eapache@gmail.com>\n(cherry picked from commit b9988e2bbfc7c6c41ef82c559bd11a8c19170491)\nReviewed-on: https://code.wireshark.org/review/4654\nReviewed-on: https://code.wireshark.org/review/5336\nReviewed-by: Michael Mann <mmann78@netscape.net>\n(cherry picked from commit 6b8c5dba634cde2fe95fca81668337380f19d641)\nReviewed-on: https://code.wireshark.org/review/5354\nReviewed-by: Balint Reczey <balint@balintreczey.hu>",
        "before_after_code_files": [
          "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
          ],
          "candidate": [
            "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc": [
          "File: epan/dissectors/packet-ncp2222.inc -> epan/dissectors/packet-ncp2222.inc",
          "--- Hunk 1 ---",
          "[Context before]",
          "2712:             case 18:",
          "2713:             case 19:",
          "2717:                 if (repeat_lookup > 0) {",
          "2718:                     if (strlen(temp_buffer) + strlen(buffer) < 250) {",
          "2719:                         g_strlcat(temp_buffer, buffer, 256);",
          "",
          "[Removed Lines]",
          "2716:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), get_finfo_length(PTREE_FINFO(tree_pointer)), buffer);",
          "",
          "[Added Lines]",
          "2715:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), MIN(get_finfo_length(PTREE_FINFO(tree_pointer)), buffer_size), buffer);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6fa8338b381c0018f8dcc8286c554903a5fa4cb8",
      "candidate_info": {
        "commit_hash": "6fa8338b381c0018f8dcc8286c554903a5fa4cb8",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/6fa8338b381c0018f8dcc8286c554903a5fa4cb8",
        "files": [
          "epan/dissectors/packet-ncp2222.inc"
        ],
        "message": "ncp2222: don't overflow buffer constructing string\n\nFixes stack-smashing vuln.\n\nSomehow there was already an XXX in the code about this, but nobody realized at\nthe time it was worth fixing... really?\n\nBug: 10552\nChange-Id: I849068bd6c45146339444f295b72430d3c6e08f2\nReviewed-on: https://code.wireshark.org/review/4653\nReviewed-by: Evan Huus <eapache@gmail.com>\n(cherry picked from commit b9988e2bbfc7c6c41ef82c559bd11a8c19170491)\nReviewed-on: https://code.wireshark.org/review/4654",
        "before_after_code_files": [
          "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
          ],
          "candidate": [
            "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc": [
          "File: epan/dissectors/packet-ncp2222.inc -> epan/dissectors/packet-ncp2222.inc",
          "--- Hunk 1 ---",
          "[Context before]",
          "2755:             case 18:",
          "2756:             case 19:",
          "2760:                 if (repeat_lookup > 0) {",
          "2761:                     if (strlen(temp_buffer) + strlen(buffer) < 250) {",
          "2762:                         g_strlcat(temp_buffer, buffer, 256);",
          "",
          "[Removed Lines]",
          "2759:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), get_finfo_length(PTREE_FINFO(tree_pointer)), buffer);",
          "",
          "[Added Lines]",
          "2758:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), MIN(get_finfo_length(PTREE_FINFO(tree_pointer)), buffer_size), buffer);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fb27a682a14ca653b36878186e0ddfdc1fea3a4e",
      "candidate_info": {
        "commit_hash": "fb27a682a14ca653b36878186e0ddfdc1fea3a4e",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/fb27a682a14ca653b36878186e0ddfdc1fea3a4e",
        "files": [
          "epan/dissectors/packet-ncp2222.inc"
        ],
        "message": "NCP: cast to guint instead of gulong\n\nChange-Id: Idc8f8f3177703ce5546b8a472034705cb6070707\nReviewed-on: https://code.wireshark.org/review/4666\nReviewed-by: Pascal Quantin <pascal.quantin@gmail.com>",
        "before_after_code_files": [
          "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
          ],
          "candidate": [
            "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc"
          ]
        }
      },
      "candidate_diff": {
        "epan/dissectors/packet-ncp2222.inc||epan/dissectors/packet-ncp2222.inc": [
          "File: epan/dissectors/packet-ncp2222.inc -> epan/dissectors/packet-ncp2222.inc",
          "--- Hunk 1 ---",
          "[Context before]",
          "2755:             case 18:",
          "2756:             case 19:",
          "2759:                 if (repeat_lookup > 0) {",
          "2760:                     if (strlen(temp_buffer) + strlen(buffer) < 250) {",
          "2761:                         g_strlcat(temp_buffer, buffer, 256);",
          "",
          "[Removed Lines]",
          "2758:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), MIN(get_finfo_length(PTREE_FINFO(tree_pointer)), (gulong)buffer_size), buffer);",
          "",
          "[Added Lines]",
          "2758:                 uni_to_string(get_finfo_value_string(PTREE_FINFO(tree_pointer)), MIN(get_finfo_length(PTREE_FINFO(tree_pointer)), (guint) buffer_size), buffer);",
          "",
          "---------------"
        ]
      }
    }
  ]
}