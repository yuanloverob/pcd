{
  "cve_id": "CVE-2016-2158",
  "cve_desc": "lib/ajax/getnavbranch.php in Moodle through 2.6.11, 2.7.x before 2.7.13, 2.8.x before 2.8.11, 2.9.x before 2.9.5, and 3.0.x before 3.0.3, when the forcelogin feature is enabled, allows remote attackers to obtain sensitive category-detail information from the navigation branch by leveraging the guest role for an Ajax request.",
  "repo": "moodle/moodle",
  "patch_hash": "7b9fbb1cf4228b39f81454cdb8370e7853fbe184",
  "patch_info": {
    "commit_hash": "7b9fbb1cf4228b39f81454cdb8370e7853fbe184",
    "repo": "moodle/moodle",
    "commit_url": "https://github.com/moodle/moodle/commit/7b9fbb1cf4228b39f81454cdb8370e7853fbe184",
    "files": [
      "lib/ajax/getnavbranch.php"
    ],
    "message": "MDL-52774 ajax: Require authentication when getting nav branch\n\nWhen getting the navigation branch data through AJAX, require\nlogin if forcelogin is set.",
    "before_after_code_files": [
      "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
    ]
  },
  "patch_diff": {
    "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php": [
      "File: lib/ajax/getnavbranch.php -> lib/ajax/getnavbranch.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "33: require_once($CFG->dirroot.'/course/lib.php');",
      "35: try {",
      "37:     ob_start();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "35: if (!empty($CFG->forcelogin)) {",
      "36:     require_login();",
      "37: }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ea8987644fdbbee291337263598b0c3c7bf27c36",
      "candidate_info": {
        "commit_hash": "ea8987644fdbbee291337263598b0c3c7bf27c36",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/ea8987644fdbbee291337263598b0c3c7bf27c36",
        "files": [
          "lib/ajax/getnavbranch.php"
        ],
        "message": "MDL-52774 ajax: Require authentication when getting nav branch\n\nWhen getting the navigation branch data through AJAX, require\nlogin if forcelogin is set.",
        "before_after_code_files": [
          "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
          ],
          "candidate": [
            "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php": [
          "File: lib/ajax/getnavbranch.php -> lib/ajax/getnavbranch.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: require_once($CFG->dirroot.'/course/lib.php');",
          "35: try {",
          "37:     ob_start();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35: if (!empty($CFG->forcelogin)) {",
          "36:     require_login();",
          "37: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dc8421575f35585a7a4fc1c9710dafd1d0483d4e",
      "candidate_info": {
        "commit_hash": "dc8421575f35585a7a4fc1c9710dafd1d0483d4e",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/dc8421575f35585a7a4fc1c9710dafd1d0483d4e",
        "files": [
          "lib/ajax/getnavbranch.php"
        ],
        "message": "MDL-52774 ajax: Require authentication when getting nav branch\n\nWhen getting the navigation branch data through AJAX, require\nlogin if forcelogin is set.",
        "before_after_code_files": [
          "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
          ],
          "candidate": [
            "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php": [
          "File: lib/ajax/getnavbranch.php -> lib/ajax/getnavbranch.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: require_once($CFG->dirroot.'/course/lib.php');",
          "35: try {",
          "37:     ob_start();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35: if (!empty($CFG->forcelogin)) {",
          "36:     require_login();",
          "37: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0766509ab02353008af62f953f7ebc0f6210411a",
      "candidate_info": {
        "commit_hash": "0766509ab02353008af62f953f7ebc0f6210411a",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/0766509ab02353008af62f953f7ebc0f6210411a",
        "files": [
          "lib/ajax/getnavbranch.php"
        ],
        "message": "MDL-52774 ajax: Require authentication when getting nav branch\n\nWhen getting the navigation branch data through AJAX, require\nlogin if forcelogin is set.",
        "before_after_code_files": [
          "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
          ],
          "candidate": [
            "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php": [
          "File: lib/ajax/getnavbranch.php -> lib/ajax/getnavbranch.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: require_once($CFG->dirroot.'/course/lib.php');",
          "35: try {",
          "37:     ob_start();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35: if (!empty($CFG->forcelogin)) {",
          "36:     require_login();",
          "37: }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3c069c16db62d0e0a64137578e92c22d604dd261",
      "candidate_info": {
        "commit_hash": "3c069c16db62d0e0a64137578e92c22d604dd261",
        "repo": "moodle/moodle",
        "commit_url": "https://github.com/moodle/moodle/commit/3c069c16db62d0e0a64137578e92c22d604dd261",
        "files": [
          "lib/ajax/getnavbranch.php"
        ],
        "message": "MDL-52774 ajax: Require authentication when getting nav branch\n\nWhen getting the navigation branch data through AJAX, require\nlogin if forcelogin is set.",
        "before_after_code_files": [
          "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
          ],
          "candidate": [
            "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php"
          ]
        }
      },
      "candidate_diff": {
        "lib/ajax/getnavbranch.php||lib/ajax/getnavbranch.php": [
          "File: lib/ajax/getnavbranch.php -> lib/ajax/getnavbranch.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: require_once($CFG->dirroot.'/course/lib.php');",
          "35: try {",
          "37:     ob_start();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35: if (!empty($CFG->forcelogin)) {",
          "36:     require_login();",
          "37: }",
          "",
          "---------------"
        ]
      }
    }
  ]
}