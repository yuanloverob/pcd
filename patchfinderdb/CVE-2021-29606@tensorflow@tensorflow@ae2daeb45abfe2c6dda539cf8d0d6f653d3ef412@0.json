{
  "cve_id": "CVE-2021-29606",
  "cve_desc": "TensorFlow is an end-to-end open source platform for machine learning. A specially crafted TFLite model could trigger an OOB read on heap in the TFLite implementation of `Split_V`(https://github.com/tensorflow/tensorflow/blob/c59c37e7b2d563967da813fa50fe20b21f4da683/tensorflow/lite/kernels/split_v.cc#L99). If `axis_value` is not a value between 0 and `NumDimensions(input)`, then the `SizeOfDimension` function(https://github.com/tensorflow/tensorflow/blob/102b211d892f3abc14f845a72047809b39cc65ab/tensorflow/lite/kernels/kernel_util.h#L148-L150) will access data outside the bounds of the tensor shape array. The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "ae2daeb45abfe2c6dda539cf8d0d6f653d3ef412",
  "patch_info": {
    "commit_hash": "ae2daeb45abfe2c6dda539cf8d0d6f653d3ef412",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/ae2daeb45abfe2c6dda539cf8d0d6f653d3ef412",
    "files": [
      "tensorflow/lite/kernels/split_v.cc"
    ],
    "message": "Prevent array OOB read/write\n\nPiperOrigin-RevId: 371026165\nChange-Id: I26ac6372c87246e03c7eb8c94e84c84d86054b36",
    "before_after_code_files": [
      "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc": [
      "File: tensorflow/lite/kernels/split_v.cc -> tensorflow/lite/kernels/split_v.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "96:     }",
      "97:   }",
      "99:   const int input_size = SizeOfDimension(input, axis_value);",
      "101:   if (minus_one_index != -1) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "99:   TF_LITE_ENSURE(context, axis_value >= 0);",
      "100:   TF_LITE_ENSURE(context, axis_value < NumDimensions(input));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "a342f6d6d6aa4355dadc7c4f789f2859aee1fa02",
      "candidate_info": {
        "commit_hash": "a342f6d6d6aa4355dadc7c4f789f2859aee1fa02",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/a342f6d6d6aa4355dadc7c4f789f2859aee1fa02",
        "files": [
          "tensorflow/lite/kernels/split_v.cc"
        ],
        "message": "Prevent array OOB read/write\n\nPiperOrigin-RevId: 371026165\nChange-Id: I26ac6372c87246e03c7eb8c94e84c84d86054b36",
        "before_after_code_files": [
          "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc": [
          "File: tensorflow/lite/kernels/split_v.cc -> tensorflow/lite/kernels/split_v.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "94:     }",
          "95:   }",
          "97:   const int input_size = SizeOfDimension(input, axis_value);",
          "99:   if (minus_one_index != -1) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "97:   TF_LITE_ENSURE(context, axis_value >= 0);",
          "98:   TF_LITE_ENSURE(context, axis_value < NumDimensions(input));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "523e7accc340251be0fda541ee8952ccb56c5747",
      "candidate_info": {
        "commit_hash": "523e7accc340251be0fda541ee8952ccb56c5747",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/523e7accc340251be0fda541ee8952ccb56c5747",
        "files": [
          "tensorflow/lite/kernels/split_v.cc"
        ],
        "message": "Prevent array OOB read/write\n\nPiperOrigin-RevId: 371026165\nChange-Id: I26ac6372c87246e03c7eb8c94e84c84d86054b36",
        "before_after_code_files": [
          "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc": [
          "File: tensorflow/lite/kernels/split_v.cc -> tensorflow/lite/kernels/split_v.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "91:     }",
          "92:   }",
          "94:   const int input_size = SizeOfDimension(input, axis_value);",
          "96:   if (minus_one_index != -1) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "94:   TF_LITE_ENSURE(context, axis_value >= 0);",
          "95:   TF_LITE_ENSURE(context, axis_value < NumDimensions(input));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "83760e0ecfe2e93d1f47f04e1f4b845b698a41b9",
      "candidate_info": {
        "commit_hash": "83760e0ecfe2e93d1f47f04e1f4b845b698a41b9",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/83760e0ecfe2e93d1f47f04e1f4b845b698a41b9",
        "files": [
          "tensorflow/lite/kernels/split_v.cc"
        ],
        "message": "Prevent array OOB read/write\n\nPiperOrigin-RevId: 371026165\nChange-Id: I26ac6372c87246e03c7eb8c94e84c84d86054b36",
        "before_after_code_files": [
          "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc": [
          "File: tensorflow/lite/kernels/split_v.cc -> tensorflow/lite/kernels/split_v.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "96:     }",
          "97:   }",
          "99:   const int input_size = SizeOfDimension(input, axis_value);",
          "101:   if (minus_one_index != -1) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "99:   TF_LITE_ENSURE(context, axis_value >= 0);",
          "100:   TF_LITE_ENSURE(context, axis_value < NumDimensions(input));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6cfbe88ff537c344a14c420d50b9d77e22e9bab5",
      "candidate_info": {
        "commit_hash": "6cfbe88ff537c344a14c420d50b9d77e22e9bab5",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/6cfbe88ff537c344a14c420d50b9d77e22e9bab5",
        "files": [
          "tensorflow/lite/kernels/split_v.cc"
        ],
        "message": "Prevent array OOB read/write\n\nPiperOrigin-RevId: 371026165\nChange-Id: I26ac6372c87246e03c7eb8c94e84c84d86054b36",
        "before_after_code_files": [
          "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc": [
          "File: tensorflow/lite/kernels/split_v.cc -> tensorflow/lite/kernels/split_v.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "96:     }",
          "97:   }",
          "99:   const int input_size = SizeOfDimension(input, axis_value);",
          "101:   if (minus_one_index != -1) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "99:   TF_LITE_ENSURE(context, axis_value >= 0);",
          "100:   TF_LITE_ENSURE(context, axis_value < NumDimensions(input));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ef68faa9189a0b94ea601dcbc0cb46b4c37c73b8",
      "candidate_info": {
        "commit_hash": "ef68faa9189a0b94ea601dcbc0cb46b4c37c73b8",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/ef68faa9189a0b94ea601dcbc0cb46b4c37c73b8",
        "files": [
          "tensorflow/lite/kernels/split_v.cc"
        ],
        "message": "Prevent array OOB read/write\n\nPiperOrigin-RevId: 371026165\nChange-Id: I26ac6372c87246e03c7eb8c94e84c84d86054b36",
        "before_after_code_files": [
          "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/split_v.cc||tensorflow/lite/kernels/split_v.cc": [
          "File: tensorflow/lite/kernels/split_v.cc -> tensorflow/lite/kernels/split_v.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "90:     }",
          "91:   }",
          "93:   const int input_size = SizeOfDimension(input, axis_value);",
          "95:   if (minus_one_index != -1) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "93:   TF_LITE_ENSURE(context, axis_value >= 0);",
          "94:   TF_LITE_ENSURE(context, axis_value < NumDimensions(input));",
          "",
          "---------------"
        ]
      }
    }
  ]
}