{
  "cve_id": "CVE-2017-16931",
  "cve_desc": "parser.c in libxml2 before 2.9.5 mishandles parameter-entity references because the NEXTL macro calls the xmlParserHandlePEReference function in the case of a '%' character in a DTD name.",
  "repo": "GNOME/libxml2",
  "patch_hash": "e26630548e7d138d2c560844c43820b6767251e3",
  "patch_info": {
    "commit_hash": "e26630548e7d138d2c560844c43820b6767251e3",
    "repo": "GNOME/libxml2",
    "commit_url": "https://github.com/GNOME/libxml2/commit/e26630548e7d138d2c560844c43820b6767251e3",
    "files": [
      "Makefile.am",
      "parser.c",
      "result/errors10/781205.xml",
      "result/errors10/781205.xml.err",
      "result/errors10/781361.xml",
      "result/errors10/781361.xml.err",
      "result/valid/766956.xml",
      "result/valid/766956.xml.err",
      "result/valid/766956.xml.err.rdr",
      "runtest.c",
      "test/errors10/781205.xml",
      "test/errors10/781361.xml",
      "test/valid/766956.xml",
      "test/valid/dtds/766956.dtd"
    ],
    "message": "Fix handling of parameter-entity references\n\nThere were two bugs where parameter-entity references could lead to an\nunexpected change of the input buffer in xmlParseNameComplex and\nxmlDictLookup being called with an invalid pointer.\n\nPercent sign in DTD Names\n=========================\n\nThe NEXTL macro used to call xmlParserHandlePEReference. When parsing\n\"complex\" names inside the DTD, this could result in entity expansion\nwhich created a new input buffer. The fix is to simply remove the call\nto xmlParserHandlePEReference from the NEXTL macro. This is safe because\nno users of the macro require expansion of parameter entities.\n\n- xmlParseNameComplex\n- xmlParseNCNameComplex\n- xmlParseNmtoken\n\nThe percent sign is not allowed in names, which are grammatical tokens.\n\n- xmlParseEntityValue\n\nParameter-entity references in entity values are expanded but this\nhappens in a separate step in this function.\n\n- xmlParseSystemLiteral\n\nParameter-entity references are ignored in the system literal.\n\n- xmlParseAttValueComplex\n- xmlParseCharDataComplex\n- xmlParseCommentComplex\n- xmlParsePI\n- xmlParseCDSect\n\nParameter-entity references are ignored outside the DTD.\n\n- xmlLoadEntityContent\n\nThis function is only called from xmlStringLenDecodeEntities and\nentities are replaced in a separate step immediately after the function\ncall.\n\nThis bug could also be triggered with an internal subset and double\nentity expansion.\n\nThis fixes bug 766956 initially reported by Wei Lei and independently by\nChromium's ClusterFuzz, Hanno B\u00f6ck, and Marco Grassi. Thanks to everyone\ninvolved.\n\nxmlParseNameComplex with XML_PARSE_OLD10\n========================================\n\nWhen parsing Names inside an expanded parameter entity with the\nXML_PARSE_OLD10 option, xmlParseNameComplex would call xmlGROW via the\nGROW macro if the input buffer was exhausted. At the end of the\nparameter entity's replacement text, this function would then call\nxmlPopInput which invalidated the input buffer.\n\nThere should be no need to invoke GROW in this situation because the\nbuffer is grown periodically every XML_PARSER_CHUNK_SIZE characters and,\nat least for UTF-8, in xmlCurrentChar. This also matches the code path\nexecuted when XML_PARSE_OLD10 is not set.\n\nThis fixes bugs 781205 (CVE-2017-9049) and 781361 (CVE-2017-9050).\nThanks to Marcel B\u00f6hme and Thuan Pham for the report.\n\nAdditional hardening\n====================\n\nA separate check was added in xmlParseNameComplex to validate the\nbuffer size.",
    "before_after_code_files": [
      "Makefile.am||Makefile.am",
      "parser.c||parser.c",
      "result/errors10/781205.xml.err||result/errors10/781205.xml.err",
      "result/errors10/781361.xml.err||result/errors10/781361.xml.err",
      "result/valid/766956.xml.err||result/valid/766956.xml.err",
      "result/valid/766956.xml.err.rdr||result/valid/766956.xml.err.rdr",
      "runtest.c||runtest.c",
      "test/valid/dtds/766956.dtd||test/valid/dtds/766956.dtd"
    ]
  },
  "patch_diff": {
    "Makefile.am||Makefile.am": [
      "File: Makefile.am -> Makefile.am",
      "--- Hunk 1 ---",
      "[Context before]",
      "427:        if [ -n \"$$log\" ] ; then echo $$name result ; echo \"$$log\" ; fi ; \\",
      "428:        rm result.$$name error.$$name ; \\",
      "429:    fi ; fi ; done)",
      "430:  @echo \"## Error cases stream regression tests\"",
      "431:  -@(for i in $(srcdir)/test/errors/*.xml ; do \\",
      "432:    name=`basename $$i`; \\",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "428:        rm result.$$name error.$$name ; \\",
      "429:    fi ; fi ; done)",
      "430:  @echo \"## Error cases regression tests (old 1.0)\"",
      "431:  -@(for i in $(srcdir)/test/errors10/*.xml ; do \\",
      "432:    name=`basename $$i`; \\",
      "433:    if [ ! -d $$i ] ; then \\",
      "434:    if [ ! -f $(srcdir)/result/errors10/$$name ] ; then \\",
      "435:        echo New test file $$name ; \\",
      "436:        $(CHECKER) $(top_builddir)/xmllint --oldxml10 $$i \\",
      "437:           2> $(srcdir)/result/errors10/$$name.err \\",
      "438:    > $(srcdir)/result/errors10/$$name ; \\",
      "439:        grep \"MORY ALLO\" .memdump  | grep -v \"MEMORY ALLOCATED : 0\"; \\",
      "440:    else \\",
      "441:        log=`$(CHECKER) $(top_builddir)/xmllint --oldxml10 $$i 2> error.$$name > result.$$name ; \\",
      "442:        grep \"MORY ALLO\" .memdump  | grep -v \"MEMORY ALLOCATED : 0\"; \\",
      "443:        diff $(srcdir)/result/errors10/$$name result.$$name ; \\",
      "444:        diff $(srcdir)/result/errors10/$$name.err error.$$name` ; \\",
      "445:        if [ -n \"$$log\" ] ; then echo $$name result ; echo \"$$log\" ; fi ; \\",
      "",
      "---------------"
    ],
    "parser.c||parser.c": [
      "File: parser.c -> parser.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2121:  ctxt->input->line++; ctxt->input->col = 1;   \\",
      "2122:     } else ctxt->input->col++;      \\",
      "2123:     ctxt->input->cur += l;    \\",
      "2125:   } while (0)",
      "2127: #define CUR_CHAR(l) xmlCurrentChar(ctxt, &l)",
      "",
      "[Removed Lines]",
      "2124:     if (*ctxt->input->cur == '%') xmlParserHandlePEReference(ctxt); \\",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3412:      len += l;",
      "3413:      NEXTL(l);",
      "3414:      c = CUR_CHAR(l);",
      "3422:  }",
      "3423:     }",
      "3424:     if ((len > XML_MAX_NAME_LENGTH) &&",
      "",
      "[Removed Lines]",
      "3415:      if (c == 0) {",
      "3416:   count = 0;",
      "3417:   GROW;",
      "3418:                 if (ctxt->instate == XML_PARSER_EOF)",
      "3419:                     return(NULL);",
      "3420:   c = CUR_CHAR(l);",
      "3421:      }",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "3426:         xmlFatalErr(ctxt, XML_ERR_NAME_TOO_LONG, \"Name\");",
      "3427:         return(NULL);",
      "3428:     }",
      "3429:     if ((*ctxt->input->cur == '\\n') && (ctxt->input->cur[-1] == '\\r'))",
      "3430:         return(xmlDictLookup(ctxt->dict, ctxt->input->cur - (len + 1), len));",
      "3431:     return(xmlDictLookup(ctxt->dict, ctxt->input->cur - len, len));",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "3421:     if (ctxt->input->cur - ctxt->input->base < len) {",
      "3427:         xmlFatalErr(ctxt, XML_ERR_INTERNAL_ERROR,",
      "3428:                     \"unexpected change of input buffer\");",
      "3429:         return (NULL);",
      "3430:     }",
      "",
      "---------------"
    ],
    "result/errors10/781205.xml.err||result/errors10/781205.xml.err": [
      "File: result/errors10/781205.xml.err -> result/errors10/781205.xml.err",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
      "3:  %a;",
      "4:     ^",
      "5: Entity: line 1:",
      "6: <:0000",
      "7: ^",
      "8: Entity: line 1: parser error : DOCTYPE improperly terminated",
      "9:  %a;",
      "10:     ^",
      "11: Entity: line 1:",
      "12: <:0000",
      "13: ^",
      "14: namespace error : Failed to parse QName ':0000'",
      "15:  %a;",
      "16:     ^",
      "17: <:0000",
      "18:       ^",
      "19: ./test/errors10/781205.xml:4: parser error : Couldn't find end of Start Tag :0000 line 1",
      "21: ^",
      "",
      "---------------"
    ],
    "result/errors10/781361.xml.err||result/errors10/781361.xml.err": [
      "File: result/errors10/781361.xml.err -> result/errors10/781361.xml.err",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: ./test/errors10/781361.xml:4: parser error : xmlParseElementDecl: 'EMPTY', 'ANY' or '(' expected",
      "3: ^",
      "4: ./test/errors10/781361.xml:4: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
      "7: ^",
      "8: ./test/errors10/781361.xml:4: parser error : DOCTYPE improperly terminated",
      "10: ^",
      "11: ./test/errors10/781361.xml:4: parser error : Start tag expected, '<' not found",
      "13: ^",
      "",
      "---------------"
    ],
    "result/valid/766956.xml.err||result/valid/766956.xml.err": [
      "File: result/valid/766956.xml.err -> result/valid/766956.xml.err",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: test/valid/dtds/766956.dtd:2: parser error : PEReference: expecting ';'",
      "2: %\u00e4%ent;",
      "3:    ^",
      "4: Entity: line 1: parser error : Content error in the external subset",
      "5:  %ent;",
      "6:       ^",
      "7: Entity: line 1:",
      "8: value",
      "9: ^",
      "",
      "---------------"
    ],
    "result/valid/766956.xml.err.rdr||result/valid/766956.xml.err.rdr": [
      "File: result/valid/766956.xml.err.rdr -> result/valid/766956.xml.err.rdr",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: test/valid/dtds/766956.dtd:2: parser error : PEReference: expecting ';'",
      "2: %\u00e4%ent;",
      "3:    ^",
      "4: Entity: line 1: parser error : Content error in the external subset",
      "5:  %ent;",
      "6:       ^",
      "7: Entity: line 1:",
      "8: value",
      "9: ^",
      "10: ./test/valid/766956.xml : failed to parse",
      "",
      "---------------"
    ],
    "runtest.c||runtest.c": [
      "File: runtest.c -> runtest.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "4214:     { \"Error cases regression tests\",",
      "4215:       errParseTest, \"./test/errors/*.xml\", \"result/errors/\", \"\", \".err\",",
      "4216:       0 },",
      "4217: #ifdef LIBXML_READER_ENABLED",
      "4218:     { \"Error cases stream regression tests\",",
      "4219:       streamParseTest, \"./test/errors/*.xml\", \"result/errors/\", NULL, \".str\",",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4217:     { \"Error cases regression tests (old 1.0)\",",
      "4218:       errParseTest, \"./test/errors10/*.xml\", \"result/errors10/\", \"\", \".err\",",
      "4219:       XML_PARSE_OLD10 },",
      "",
      "---------------"
    ],
    "test/valid/dtds/766956.dtd||test/valid/dtds/766956.dtd": [
      "File: test/valid/dtds/766956.dtd -> test/valid/dtds/766956.dtd",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: <!ENTITY % ent \"value\">",
      "2: %\u00e4%ent;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5f440d8cadea9f0d87fd3849366445029d47f528",
      "candidate_info": {
        "commit_hash": "5f440d8cadea9f0d87fd3849366445029d47f528",
        "repo": "GNOME/libxml2",
        "commit_url": "https://github.com/GNOME/libxml2/commit/5f440d8cadea9f0d87fd3849366445029d47f528",
        "files": [
          "parser.c",
          "result/errors/754946.xml.err",
          "result/errors/754946.xml.str",
          "result/errors10/781205.xml.err",
          "result/valid/t8.xml.err",
          "result/valid/t8.xml.err.rdr",
          "result/valid/t8a.xml.err",
          "result/valid/t8a.xml.err.rdr",
          "test/errors/754946.xml"
        ],
        "message": "Rework entity boundary checks\n\nMake sure to finish all entities in the internal subset. Nevertheless,\nreadd a sanity check in xmlParseStartTag2 that was lost in my previous\ncommit. Also add a sanity check in xmlPopInput. Popping an input\nunexpectedly was the source of many recent memory bugs. The check\ndoesn't mitigate such issues but helps with diagnosis.\n\nAlways base entity boundary checks on the input ID, not the input\npointer. The pointer could have been reallocated to the old address.\n\nAlways throw a well-formedness error if a boundary check fails. In a\nfew places, a validity error was thrown.\n\nFix a few error codes and improve indentation.",
        "before_after_code_files": [
          "parser.c||parser.c",
          "result/errors/754946.xml.err||result/errors/754946.xml.err",
          "result/errors/754946.xml.str||result/errors/754946.xml.str",
          "result/errors10/781205.xml.err||result/errors10/781205.xml.err",
          "result/valid/t8.xml.err||result/valid/t8.xml.err",
          "result/valid/t8.xml.err.rdr||result/valid/t8.xml.err.rdr",
          "result/valid/t8a.xml.err||result/valid/t8a.xml.err",
          "result/valid/t8a.xml.err.rdr||result/valid/t8a.xml.err.rdr"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "parser.c||parser.c",
            "result/errors10/781205.xml.err||result/errors10/781205.xml.err"
          ],
          "candidate": [
            "parser.c||parser.c",
            "result/errors10/781205.xml.err||result/errors10/781205.xml.err"
          ]
        }
      },
      "candidate_diff": {
        "parser.c||parser.c": [
          "File: parser.c -> parser.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2215:     if (xmlParserDebugEntities)",
          "2216:  xmlGenericError(xmlGenericErrorContext,",
          "2217:   \"Popping input %d\\n\", ctxt->inputNr);",
          "2218:     xmlFreeInputStream(inputPop(ctxt));",
          "2219:     if ((*ctxt->input->cur == 0) &&",
          "2220:         (xmlParserInputGrow(ctxt->input, INPUT_CHUNK) <= 0))",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2218:     if ((ctxt->inputNr > 1) && (ctxt->inSubset == 0) &&",
          "2219:         (ctxt->instate != XML_PARSER_EOF))",
          "2220:         xmlFatalErr(ctxt, XML_ERR_INTERNAL_ERROR,",
          "2221:                     \"Unfinished entity outside the DTD\");",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "4837:     } else {",
          "4838:  if (inputid != ctxt->input->id) {",
          "4839:      xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "4841:  }",
          "4842:         NEXT;",
          "4843:  if ((ctxt->sax != NULL) && (ctxt->sax->comment != NULL) &&",
          "",
          "[Removed Lines]",
          "4840:   \"Comment doesn't start and stop in the same entity\\n\");",
          "",
          "[Added Lines]",
          "4844:              \"Comment doesn't start and stop in the same\"",
          "4845:                            \" entity\\n\");",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "4985:          if (in[2] == '>') {",
          "4986:       if (ctxt->input->id != inputid) {",
          "4987:    xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "4989:       }",
          "4990:       SKIP(3);",
          "4991:       if ((ctxt->sax != NULL) && (ctxt->sax->comment != NULL) &&",
          "",
          "[Removed Lines]",
          "4988:    \"comment doesn't start and stop in the same entity\\n\");",
          "",
          "[Added Lines]",
          "4993:                   \"comment doesn't start and stop in the\"",
          "4994:                                        \" same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "5153:     int count = 0;",
          "5155:     if ((RAW == '<') && (NXT(1) == '?')) {",
          "5157:  state = ctxt->instate;",
          "5158:         ctxt->instate = XML_PARSER_PI;",
          "",
          "[Removed Lines]",
          "5156:  xmlParserInputPtr input = ctxt->input;",
          "",
          "[Added Lines]",
          "5162:  int inputid = ctxt->input->id;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "5169:         target = xmlParsePITarget(ctxt);",
          "5170:  if (target != NULL) {",
          "5171:      if ((RAW == '?') && (NXT(1) == '>')) {",
          "5173:       xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "5175:   }",
          "5176:   SKIP(2);",
          "",
          "[Removed Lines]",
          "5172:   if (input != ctxt->input) {",
          "5174:      \"PI declaration doesn't start and stop in the same entity\\n\");",
          "",
          "[Added Lines]",
          "5178:   if (inputid != ctxt->input->id) {",
          "5180:                             \"PI declaration doesn't start and stop in\"",
          "5181:                                    \" the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "5253:   xmlFatalErrMsgStr(ctxt, XML_ERR_PI_NOT_FINISHED,",
          "5254:         \"ParsePI: PI %s never end ...\\n\", target);",
          "5255:      } else {",
          "5259:   }",
          "5260:   SKIP(2);",
          "",
          "[Removed Lines]",
          "5256:   if (input != ctxt->input) {",
          "5257:       xmlFatalErrMsg(ctxt, XML_ERR_SPACE_REQUIRED,",
          "5258:      \"PI declaration doesn't start and stop in the same entity\\n\");",
          "",
          "[Added Lines]",
          "5263:   if (inputid != ctxt->input->id) {",
          "5264:       xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "5265:                             \"PI declaration doesn't start and stop in\"",
          "5266:                                    \" the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "5311:     xmlChar *Systemid;",
          "5313:     if (CMP10(CUR_PTR, '<', '!', 'N', 'O', 'T', 'A', 'T', 'I', 'O', 'N')) {",
          "5315:  SHRINK;",
          "5316:  SKIP(10);",
          "5317:  if (!IS_BLANK_CH(CUR)) {",
          "",
          "[Removed Lines]",
          "5314:  xmlParserInputPtr input = ctxt->input;",
          "",
          "[Added Lines]",
          "5322:  int inputid = ctxt->input->id;",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "5345:  SKIP_BLANKS;",
          "5347:  if (RAW == '>') {",
          "5351:      }",
          "5352:      NEXT;",
          "5353:      if ((ctxt->sax != NULL) && (!ctxt->disableSAX) &&",
          "",
          "[Removed Lines]",
          "5348:      if (input != ctxt->input) {",
          "5349:   xmlFatalErrMsg(ctxt, XML_ERR_SPACE_REQUIRED,",
          "5350:  \"Notation declaration doesn't start and stop in the same entity\\n\");",
          "",
          "[Added Lines]",
          "5356:      if (inputid != ctxt->input->id) {",
          "5357:   xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "5358:                         \"Notation declaration doesn't start and stop\"",
          "5359:                                \" in the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "5397:     if (CMP8(CUR_PTR, '<', '!', 'E', 'N', 'T', 'I', 'T', 'Y')) {",
          "5399:  SHRINK;",
          "5400:  SKIP(8);",
          "5401:  skipped = SKIP_BLANKS;",
          "",
          "[Removed Lines]",
          "5398:  xmlParserInputPtr input = ctxt->input;",
          "",
          "[Added Lines]",
          "5407:  int inputid = ctxt->input->id;",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "5594:              \"xmlParseEntityDecl: entity %s not terminated\\n\", name);",
          "5595:      xmlHaltParser(ctxt);",
          "5596:  } else {",
          "5598:   xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "5600:      }",
          "5601:      NEXT;",
          "5602:  }",
          "",
          "[Removed Lines]",
          "5597:      if (input != ctxt->input) {",
          "5599:  \"Entity declaration doesn't start and stop in the same entity\\n\");",
          "",
          "[Added Lines]",
          "5606:      if (inputid != ctxt->input->id) {",
          "5608:                         \"Entity declaration doesn't start and stop in\"",
          "5609:                                \" the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "5964:     xmlEnumerationPtr tree;",
          "5966:     if (CMP9(CUR_PTR, '<', '!', 'A', 'T', 'T', 'L', 'I', 'S', 'T')) {",
          "5969:  SKIP(9);",
          "5970:  if (!IS_BLANK_CH(CUR)) {",
          "",
          "[Removed Lines]",
          "5967:  xmlParserInputPtr input = ctxt->input;",
          "",
          "[Added Lines]",
          "5977:  int inputid = ctxt->input->id;",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "6060:      GROW;",
          "6061:  }",
          "6062:  if (RAW == '>') {",
          "6067:      }",
          "6068:      NEXT;",
          "6069:  }",
          "",
          "[Removed Lines]",
          "6063:      if (input != ctxt->input) {",
          "6064:   xmlValidityError(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6065:     \"Attribute list declaration doesn't start and stop in the same entity\\n\",",
          "6066:                                  NULL, NULL);",
          "",
          "[Added Lines]",
          "6073:      if (inputid != ctxt->input->id) {",
          "6074:   xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6075:                                \"Attribute list declaration doesn't start and\"",
          "6076:                                \" stop in the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "6100:  SKIP_BLANKS;",
          "6101:  SHRINK;",
          "6102:  if (RAW == ')') {",
          "6107:      }",
          "6108:      NEXT;",
          "6109:      ret = xmlNewDocElementContent(ctxt->myDoc, NULL, XML_ELEMENT_CONTENT_PCDATA);",
          "",
          "[Removed Lines]",
          "6103:      if ((ctxt->validate) && (ctxt->input->id != inputchk)) {",
          "6104:   xmlValidityError(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6105: \"Element content declaration doesn't start and stop in the same entity\\n\",",
          "6106:                                  NULL, NULL);",
          "",
          "[Added Lines]",
          "6113:      if (ctxt->input->id != inputchk) {",
          "6114:   xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6115:                                \"Element content declaration doesn't start and\"",
          "6116:                                \" stop in the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "6159:             }",
          "6160:             if (ret != NULL)",
          "6161:                 ret->ocur = XML_ELEMENT_CONTENT_MULT;",
          "6166:      }",
          "6167:      SKIP(2);",
          "6168:  } else {",
          "",
          "[Removed Lines]",
          "6162:      if ((ctxt->validate) && (ctxt->input->id != inputchk)) {",
          "6163:   xmlValidityError(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6164: \"Element content declaration doesn't start and stop in the same entity\\n\",",
          "6165:      NULL, NULL);",
          "",
          "[Added Lines]",
          "6172:      if (ctxt->input->id != inputchk) {",
          "6173:   xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6174:                                \"Element content declaration doesn't start and\"",
          "6175:                                \" stop in the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "6402:  if (last != NULL)",
          "6403:      last->parent = cur;",
          "6404:     }",
          "6409:     }",
          "6410:     NEXT;",
          "6411:     if (RAW == '?') {",
          "",
          "[Removed Lines]",
          "6405:     if ((ctxt->validate) && (ctxt->input->id != inputchk)) {",
          "6406:  xmlValidityError(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6407: \"Element content declaration doesn't start and stop in the same entity\\n\",",
          "6408:     NULL, NULL);",
          "",
          "[Added Lines]",
          "6415:     if (ctxt->input->id != inputchk) {",
          "6416:  xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6417:                        \"Element content declaration doesn't start and stop in\"",
          "6418:                        \" the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "6580:     if (CMP9(CUR_PTR, '<', '!', 'E', 'L', 'E', 'M', 'E', 'N', 'T')) {",
          "6583:  SKIP(9);",
          "6584:  if (!IS_BLANK_CH(CUR)) {",
          "",
          "[Removed Lines]",
          "6581:  xmlParserInputPtr input = ctxt->input;",
          "",
          "[Added Lines]",
          "6591:  int inputid = ctxt->input->id;",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "6644:   xmlFreeDocElementContent(ctxt->myDoc, content);",
          "6645:      }",
          "6646:  } else {",
          "6648:   xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6650:      }",
          "6652:      NEXT;",
          "",
          "[Removed Lines]",
          "6647:      if (input != ctxt->input) {",
          "6649:     \"Element declaration doesn't start and stop in the same entity\\n\");",
          "",
          "[Added Lines]",
          "6657:      if (inputid != ctxt->input->id) {",
          "6659:                                \"Element declaration doesn't start and stop in\"",
          "6660:                                \" the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "6699:      return;",
          "6700:  } else {",
          "6701:      if (ctxt->input->id != id) {",
          "6705:      }",
          "6706:      NEXT;",
          "6707:  }",
          "",
          "[Removed Lines]",
          "6702:   xmlValidityError(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6703:      \"All markup of the conditional section is not in the same entity\\n\",",
          "6704:          NULL, NULL);",
          "",
          "[Added Lines]",
          "6713:   xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6714:                         \"All markup of the conditional section is not\"",
          "6715:                                \" in the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 19 ---",
          "[Context before]",
          "6762:      return;",
          "6763:  } else {",
          "6764:      if (ctxt->input->id != id) {",
          "6768:      }",
          "6769:      NEXT;",
          "6770:  }",
          "",
          "[Removed Lines]",
          "6765:   xmlValidityError(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6766:      \"All markup of the conditional section is not in the same entity\\n\",",
          "6767:          NULL, NULL);",
          "",
          "[Added Lines]",
          "6776:   xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6777:                         \"All markup of the conditional section is not\"",
          "6778:                                \" in the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 20 ---",
          "[Context before]",
          "6826:  xmlFatalErr(ctxt, XML_ERR_CONDSEC_NOT_FINISHED, NULL);",
          "6827:     } else {",
          "6828:  if (ctxt->input->id != id) {",
          "6832:  }",
          "6833:  if ((ctxt-> instate != XML_PARSER_EOF) &&",
          "6834:      ((ctxt->input->cur + 3) <= ctxt->input->end))",
          "",
          "[Removed Lines]",
          "6829:      xmlValidityError(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6830:  \"All markup of the conditional section is not in the same entity\\n\",",
          "6831:      NULL, NULL);",
          "",
          "[Added Lines]",
          "6840:      xmlFatalErrMsg(ctxt, XML_ERR_ENTITY_BOUNDARY,",
          "6841:                     \"All markup of the conditional section is not in\"",
          "6842:                            \" the same entity\\n\");",
          "",
          "---------------",
          "--- Hunk 21 ---",
          "[Context before]",
          "8388:      if ((CUR_PTR == check) && (cons == ctxt->input->consumed)) {",
          "8389:   xmlFatalErr(ctxt, XML_ERR_INTERNAL_ERROR,",
          "8390:       \"xmlParseInternalSubset: error detected in Markup declaration\\n\");",
          "8392:      }",
          "8393:  }",
          "8394:  if (RAW == ']') {",
          "",
          "[Removed Lines]",
          "8385:      while ((RAW == 0) && (ctxt->inputNr > 1))",
          "8386:   xmlPopInput(ctxt);",
          "8391:   break;",
          "",
          "[Added Lines]",
          "8396:             while (ctxt->inputNr > 1) {",
          "8397:                 if (RAW == 0) {",
          "8398:       xmlPopInput(ctxt);",
          "8399:                 } else if (RAW == ']') {",
          "8403:       xmlFatalErr(ctxt, XML_ERR_EXT_SUBSET_NOT_FINISHED, NULL);",
          "8404:                     xmlPopInput(ctxt);",
          "8405:                 } else {",
          "8406:                     break;",
          "8407:                 }",
          "8408:             }",
          "8413:                 if (ctxt->inputNr > 1)",
          "8414:                     xmlPopInput(ctxt);",
          "8415:                 else",
          "8416:       break;",
          "",
          "---------------",
          "--- Hunk 22 ---",
          "[Context before]",
          "9282:     xmlChar *attvalue;",
          "9283:     const xmlChar **atts = ctxt->atts;",
          "9284:     int maxatts = ctxt->maxatts;",
          "9286:     int i, j, nbNs, attval;",
          "9287:     unsigned long cur;",
          "9288:     int nsNr = ctxt->nsNr;",
          "",
          "[Removed Lines]",
          "9285:     int nratts, nbatts, nbdef;",
          "",
          "[Added Lines]",
          "9310:     int nratts, nbatts, nbdef, inputid;",
          "",
          "---------------",
          "--- Hunk 23 ---",
          "[Context before]",
          "9300:     SHRINK;",
          "9301:     cur = ctxt->input->cur - ctxt->input->base;",
          "9302:     nbatts = 0;",
          "9303:     nratts = 0;",
          "9304:     nbdef = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9327:     inputid = ctxt->input->id;",
          "",
          "---------------",
          "--- Hunk 24 ---",
          "[Context before]",
          "9517:         GROW;",
          "9518:     }",
          "9521:     for (i = 0, j = 0; j < nratts; i += 5, j++) {",
          "9522:         if (atts[i+2] != NULL) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9546:     if (ctxt->input->id != inputid) {",
          "9547:         xmlFatalErr(ctxt, XML_ERR_INTERNAL_ERROR,",
          "9548:                     \"Unexpected change of input\\n\");",
          "9549:         localname = NULL;",
          "9550:         goto done;",
          "9551:     }",
          "",
          "---------------",
          "--- Hunk 25 ---",
          "[Context before]",
          "9675:                    nsname, 0, NULL, nbatts / 5, nbdef, atts);",
          "9676:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9711: done:",
          "",
          "---------------"
        ],
        "result/errors/754946.xml.err||result/errors/754946.xml.err": [
          "File: result/errors/754946.xml.err -> result/errors/754946.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: A<lbbbbbbbbbbbbbbbbbbb_",
          "7: ^",
          "",
          "[Removed Lines]",
          "8: Entity: line 1: parser error : DOCTYPE improperly terminated",
          "9:  %SYSTEM;",
          "10:          ^",
          "11: Entity: line 1:",
          "12: A<lbbbbbbbbbbbbbbbbbbb_",
          "13: ^",
          "14: Entity: line 1: parser error : Start tag expected, '<' not found",
          "15:  %SYSTEM;",
          "16:          ^",
          "17: Entity: line 1:",
          "18: A<lbbbbbbbbbbbbbbbbbbb_",
          "19: ^",
          "",
          "[Added Lines]",
          "8: ./test/errors/754946.xml:4: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10:   <![",
          "11:   ^",
          "12: ./test/errors/754946.xml:4: parser error : DOCTYPE improperly terminated",
          "13:   <![",
          "14:   ^",
          "15: ./test/errors/754946.xml:4: parser error : StartTag: invalid element name",
          "16:   <![",
          "17:    ^",
          "18: ./test/errors/754946.xml:4: parser error : Extra content at the end of the document",
          "19:   <![",
          "20:    ^",
          "",
          "---------------"
        ],
        "result/errors/754946.xml.str||result/errors/754946.xml.str": [
          "File: result/errors/754946.xml.str -> result/errors/754946.xml.str",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: ./test/errors/754946.xml:1: parser error : Extra content at the end of the document",
          "4: ./test/errors/754946.xml : failed to parse",
          "",
          "[Removed Lines]",
          "2: <!DOCTYPEA[<!ENTITY %",
          "3:           ^",
          "",
          "[Added Lines]",
          "2: <!DOCTYPE A [",
          "3:             ^",
          "",
          "---------------"
        ],
        "result/errors10/781205.xml.err||result/errors10/781205.xml.err": [
          "File: result/errors10/781205.xml.err -> result/errors10/781205.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: <:0000",
          "7: ^",
          "13: ^",
          "21: ^",
          "",
          "[Removed Lines]",
          "8: Entity: line 1: parser error : DOCTYPE improperly terminated",
          "9:  %a;",
          "10:     ^",
          "11: Entity: line 1:",
          "12: <:0000",
          "14: namespace error : Failed to parse QName ':0000'",
          "15:  %a;",
          "16:     ^",
          "17: <:0000",
          "18:       ^",
          "19: ./test/errors10/781205.xml:4: parser error : Couldn't find end of Start Tag :0000 line 1",
          "",
          "[Added Lines]",
          "8: ./test/errors10/781205.xml:4: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "12: ./test/errors10/781205.xml:4: parser error : DOCTYPE improperly terminated",
          "14: ^",
          "15: ./test/errors10/781205.xml:4: parser error : Start tag expected, '<' not found",
          "",
          "---------------"
        ],
        "result/valid/t8.xml.err||result/valid/t8.xml.err": [
          "File: result/valid/t8.xml.err -> result/valid/t8.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: &lt;!ELEMENT root (middle) >",
          "7: ^",
          "11: Entity: line 1:",
          "13: ^",
          "16:           ^",
          "17: Entity: line 1:",
          "19: ^",
          "",
          "[Removed Lines]",
          "8: Entity: line 1: parser error : DOCTYPE improperly terminated",
          "9:  %defroot;",
          "10:           ^",
          "12: &lt;!ELEMENT root (middle) >",
          "14: Entity: line 1: parser error : Start tag expected, '<' not found",
          "15:  %defroot;",
          "18: &lt;!ELEMENT root (middle) >",
          "",
          "[Added Lines]",
          "8: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10:  %defmiddle;",
          "11:             ^",
          "13: &lt;!ELEMENT middle (test) >",
          "15: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17:  %deftest;",
          "20: &lt;!ELEMENT test (#PCDATA) >",
          "",
          "---------------"
        ],
        "result/valid/t8.xml.err.rdr||result/valid/t8.xml.err.rdr": [
          "File: result/valid/t8.xml.err.rdr -> result/valid/t8.xml.err.rdr",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: &lt;!ELEMENT root (middle) >",
          "7: ^",
          "10:           ^",
          "11: Entity: line 1:",
          "13: ^",
          "14: ./test/valid/t8.xml : failed to parse",
          "",
          "[Removed Lines]",
          "8: Entity: line 1: parser error : DOCTYPE improperly terminated",
          "9:  %defroot;",
          "12: &lt;!ELEMENT root (middle) >",
          "",
          "[Added Lines]",
          "8: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10:  %defmiddle;",
          "11:             ^",
          "12: Entity: line 1:",
          "13: &lt;!ELEMENT middle (test) >",
          "14: ^",
          "15: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17:  %deftest;",
          "20: &lt;!ELEMENT test (#PCDATA) >",
          "",
          "---------------"
        ],
        "result/valid/t8a.xml.err||result/valid/t8a.xml.err": [
          "File: result/valid/t8a.xml.err -> result/valid/t8a.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: &lt;!ELEMENT root (middle) >",
          "7: ^",
          "11: Entity: line 1:",
          "13: ^",
          "16:           ^",
          "17: Entity: line 1:",
          "19: ^",
          "",
          "[Removed Lines]",
          "8: Entity: line 1: parser error : DOCTYPE improperly terminated",
          "9:  %defroot;",
          "10:           ^",
          "12: &lt;!ELEMENT root (middle) >",
          "14: Entity: line 1: parser error : Start tag expected, '<' not found",
          "15:  %defroot;",
          "18: &lt;!ELEMENT root (middle) >",
          "",
          "[Added Lines]",
          "8: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10:  %defmiddle;",
          "11:             ^",
          "13: &lt;!ELEMENT middle (test) >",
          "15: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17:  %deftest;",
          "20: &lt;!ELEMENT test (#PCDATA) >",
          "",
          "---------------"
        ],
        "result/valid/t8a.xml.err.rdr||result/valid/t8a.xml.err.rdr": [
          "File: result/valid/t8a.xml.err.rdr -> result/valid/t8a.xml.err.rdr",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: &lt;!ELEMENT root (middle) >",
          "7: ^",
          "10:           ^",
          "11: Entity: line 1:",
          "13: ^",
          "14: ./test/valid/t8a.xml : failed to parse",
          "",
          "[Removed Lines]",
          "8: Entity: line 1: parser error : DOCTYPE improperly terminated",
          "9:  %defroot;",
          "12: &lt;!ELEMENT root (middle) >",
          "",
          "[Added Lines]",
          "8: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10:  %defmiddle;",
          "11:             ^",
          "12: Entity: line 1:",
          "13: &lt;!ELEMENT middle (test) >",
          "14: ^",
          "15: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17:  %deftest;",
          "20: &lt;!ELEMENT test (#PCDATA) >",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "872fea9485bd715aeccdaef64cda8a4cc05bd9c5",
      "candidate_info": {
        "commit_hash": "872fea9485bd715aeccdaef64cda8a4cc05bd9c5",
        "repo": "GNOME/libxml2",
        "commit_url": "https://github.com/GNOME/libxml2/commit/872fea9485bd715aeccdaef64cda8a4cc05bd9c5",
        "files": [
          "parser.c",
          "result/errors/754946.xml.err",
          "result/errors/759573-2.xml.err",
          "result/errors/759573.xml.err",
          "result/errors10/781205.xml.err",
          "result/valid/766956.xml.err",
          "result/valid/766956.xml.err.rdr",
          "result/valid/t8.xml.err",
          "result/valid/t8.xml.err.rdr",
          "result/valid/t8a.xml.err",
          "result/valid/t8a.xml.err.rdr"
        ],
        "message": "Get rid of \"blanks wrapper\" for parameter entities\n\nNow that replacement of parameter entities goes exclusively through\nxmlSkipBlankChars, we can account for the surrounding space characters\nthere and remove the \"blanks wrapper\" hack.",
        "before_after_code_files": [
          "parser.c||parser.c",
          "result/errors/754946.xml.err||result/errors/754946.xml.err",
          "result/errors/759573-2.xml.err||result/errors/759573-2.xml.err",
          "result/errors/759573.xml.err||result/errors/759573.xml.err",
          "result/errors10/781205.xml.err||result/errors10/781205.xml.err",
          "result/valid/766956.xml.err||result/valid/766956.xml.err",
          "result/valid/766956.xml.err.rdr||result/valid/766956.xml.err.rdr",
          "result/valid/t8.xml.err||result/valid/t8.xml.err",
          "result/valid/t8.xml.err.rdr||result/valid/t8.xml.err.rdr",
          "result/valid/t8a.xml.err||result/valid/t8a.xml.err",
          "result/valid/t8a.xml.err.rdr||result/valid/t8a.xml.err.rdr"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "parser.c||parser.c",
            "result/errors10/781205.xml.err||result/errors10/781205.xml.err",
            "result/valid/766956.xml.err||result/valid/766956.xml.err",
            "result/valid/766956.xml.err.rdr||result/valid/766956.xml.err.rdr"
          ],
          "candidate": [
            "parser.c||parser.c",
            "result/errors10/781205.xml.err||result/errors10/781205.xml.err",
            "result/valid/766956.xml.err||result/valid/766956.xml.err",
            "result/valid/766956.xml.err.rdr||result/valid/766956.xml.err.rdr"
          ]
        }
      },
      "candidate_diff": {
        "parser.c||parser.c": [
          "File: parser.c -> parser.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2169:  while (1) {",
          "2171:   NEXT;",
          "2173:      } else if (CUR == '%') {",
          "",
          "[Removed Lines]",
          "2172:   res++;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2184:             } else {",
          "2185:                 break;",
          "2186:             }",
          "2187:         }",
          "2188:     }",
          "2189:     return(res);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2194:      res++;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2446:     return(0);",
          "2447: }",
          "",
          "[Removed Lines]",
          "2460: static void deallocblankswrapper (xmlChar *str) {xmlFree(str);}",
          "2462: static xmlParserInputPtr",
          "2463: xmlNewBlanksWrapperInputStream(xmlParserCtxtPtr ctxt, xmlEntityPtr entity) {",
          "2464:     xmlParserInputPtr input;",
          "2465:     xmlChar *buffer;",
          "2466:     size_t length;",
          "2467:     if (entity == NULL) {",
          "2468:  xmlFatalErr(ctxt, XML_ERR_INTERNAL_ERROR,",
          "2469:              \"xmlNewBlanksWrapperInputStream entity\\n\");",
          "2470:  return(NULL);",
          "2471:     }",
          "2472:     if (xmlParserDebugEntities)",
          "2473:  xmlGenericError(xmlGenericErrorContext,",
          "2474:   \"new blanks wrapper for entity: %s\\n\", entity->name);",
          "2475:     input = xmlNewInputStream(ctxt);",
          "2476:     if (input == NULL) {",
          "2477:  return(NULL);",
          "2478:     }",
          "2479:     length = xmlStrlen(entity->name) + 5;",
          "2480:     buffer = xmlMallocAtomic(length);",
          "2481:     if (buffer == NULL) {",
          "2482:  xmlErrMemory(ctxt, NULL);",
          "2483:         xmlFree(input);",
          "2484:  return(NULL);",
          "2485:     }",
          "2486:     buffer [0] = ' ';",
          "2487:     buffer [1] = '%';",
          "2488:     buffer [length-3] = ';';",
          "2489:     buffer [length-2] = ' ';",
          "2490:     buffer [length-1] = 0;",
          "2491:     memcpy(buffer + 2, entity->name, length - 5);",
          "2492:     input->free = deallocblankswrapper;",
          "2493:     input->base = buffer;",
          "2494:     input->cur = buffer;",
          "2495:     input->length = length;",
          "2496:     input->end = &buffer[length];",
          "2497:     return(input);",
          "2498: }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "7945:      xmlWarningMsg(ctxt, XML_WAR_UNDECLARED_ENTITY,",
          "7946:     \"Internal: %%%s; is not a parameter entity\\n\",",
          "7947:      name, NULL);",
          "7952:  } else {",
          "7953:             xmlChar start[4];",
          "7954:             xmlCharEncoding enc;",
          "",
          "[Removed Lines]",
          "7948:  } else if (ctxt->input->free != deallocblankswrapper) {",
          "7949:      input = xmlNewBlanksWrapperInputStream(ctxt, entity);",
          "7950:      if (xmlPushInput(ctxt, input) < 0)",
          "7951:   return;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "result/errors/754946.xml.err||result/errors/754946.xml.err": [
          "File: result/errors/754946.xml.err -> result/errors/754946.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: A<lbbbbbbbbbbbbbbbbbbb_",
          "7: ^",
          "",
          "[Removed Lines]",
          "1: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3:  %SYSTEM;",
          "4:          ^",
          "",
          "[Added Lines]",
          "1: ./test/errors/754946.xml:3: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3:   %SYSTEM;",
          "4:           ^",
          "",
          "---------------"
        ],
        "result/errors/759573-2.xml.err||result/errors/759573-2.xml.err": [
          "File: result/errors/759573-2.xml.err -> result/errors/759573-2.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: Entity: line 1: parser error : Space required after '<!ENTITY'",
          "4: Entity: line 1:",
          "5: <!ENTITY<?xDOCTYPEm~?>",
          "6:         ^",
          "7: Entity: line 1: parser error : xmlParseEntityDecl: no name",
          "10: Entity: line 1:",
          "11: <!ENTITY<?xDOCTYPEm~?>",
          "12:         ^",
          "13: Entity: line 1: parser error : ParsePI: PI xDOCTYPEm space expected",
          "16: Entity: line 1:",
          "17: <!ENTITY<?xDOCTYPEm~?>",
          "18:                    ^",
          "22: Entity: line 1:",
          "23: <!ENTITY<?xDOCTYPEm~?>",
          "24:         ^",
          "28: Entity: line 1:",
          "29: <!ENTITY<?xDOCTYPEm~?>",
          "30:         ^",
          "34: Entity: line 1:",
          "35: <!ENTITY<?xDOCTYPEm~?>",
          "36:                    ^",
          "40: Entity: line 3:",
          "41: %zz;<!ELEMENTD(%MENT%MENTD\u0179MENTD%zNMT9KENSMYSYSTEM;MENT9%zz;",
          "42:              ^",
          "46: Entity: line 3:",
          "47: %zz;<!ELEMENTD(%MENT%MENTD\u0179MENTD%zNMT9KENSMYSYSTEM;MENT9%zz;",
          "48:              ^",
          "",
          "[Removed Lines]",
          "2:  %zz;",
          "3:      ^",
          "8:  %zz;",
          "9:      ^",
          "14:  %zz;",
          "15:      ^",
          "19: Entity: line 1: parser error : Space required after '<!ENTITY'",
          "20:  %zz;",
          "21:      ^",
          "25: Entity: line 1: parser error : xmlParseEntityDecl: no name",
          "26:  %zz;",
          "27:      ^",
          "31: Entity: line 1: parser error : ParsePI: PI xDOCTYPEm space expected",
          "32:  %zz;",
          "33:      ^",
          "37: Entity: line 1: parser error : Space required after 'ELEMENT'",
          "38:  %xx;",
          "39:      ^",
          "43: Entity: line 1: parser error : Content error in the external subset",
          "44:  %xx;",
          "45:      ^",
          "",
          "[Added Lines]",
          "2: %zz;",
          "3:     ^",
          "8: %zz;",
          "9:     ^",
          "14: %zz;",
          "15:     ^",
          "19: Entity: line 3: parser error : Space required after '<!ENTITY'",
          "20: %zz;<!ELEMENTD(%MENT%MENTD\u0179MENTD%zNMT9KENSMYSYSTEM;MENT9%zz;",
          "21:     ^",
          "25: Entity: line 3: parser error : xmlParseEntityDecl: no name",
          "26: %zz;<!ELEMENTD(%MENT%MENTD\u0179MENTD%zNMT9KENSMYSYSTEM;MENT9%zz;",
          "27:     ^",
          "31: Entity: line 3: parser error : ParsePI: PI xDOCTYPEm space expected",
          "32: %zz;<!ELEMENTD(%MENT%MENTD\u0179MENTD%zNMT9KENSMYSYSTEM;MENT9%zz;",
          "33:     ^",
          "37: ./test/errors/759573-2.xml:6: parser error : Space required after 'ELEMENT'",
          "38: %xx;\u0003\ufffdggKENSMYNT&#35;MENTD&#372zz;'>",
          "39:     ^",
          "43: ./test/errors/759573-2.xml:6: parser error : Content error in the external subset",
          "44: %xx;\u0003\ufffdggKENSMYNT&#35;MENTD&#372zz;'>",
          "45:     ^",
          "",
          "---------------"
        ],
        "result/errors/759573.xml.err||result/errors/759573.xml.err": [
          "File: result/errors/759573.xml.err -> result/errors/759573.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: ./test/errors/759573.xml:1: parser error : Entity value required",
          "8: LEMENT t (A)><!ENTITY % xx '&#37;<![INCLUDE[000&#37;&#3000;000&#37;z;'><!ENTITYz",
          "9:                                                                                ^",
          "13: Entity: line 1:",
          "14: %<![INCLUDE[000%\u0bb8000%z;",
          "15:  ^",
          "19: Entity: line 1:",
          "20: %<![INCLUDE[000%\u0bb8000%z;",
          "21:             ^",
          "",
          "[Removed Lines]",
          "10: Entity: line 1: parser error : PEReference: no name",
          "11:  %xx;",
          "12:      ^",
          "16: Entity: line 1: parser error : Content error in the external subset",
          "17:  %xx;",
          "18:      ^",
          "",
          "[Added Lines]",
          "10: ./test/errors/759573.xml:1: parser error : PEReference: no name",
          "11: T t (A)><!ENTITY % xx '&#37;<![INCLUDE[000&#37;&#3000;000&#37;z;'><!ENTITYz>%xx;",
          "12:                                                                                ^",
          "16: ./test/errors/759573.xml:1: parser error : Content error in the external subset",
          "17: T t (A)><!ENTITY % xx '&#37;<![INCLUDE[000&#37;&#3000;000&#37;z;'><!ENTITYz>%xx;",
          "18:                                                                                ^",
          "",
          "---------------"
        ],
        "result/errors10/781205.xml.err||result/errors10/781205.xml.err": [
          "File: result/errors10/781205.xml.err -> result/errors10/781205.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: <:0000",
          "7: ^",
          "",
          "[Removed Lines]",
          "1: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3:  %a;",
          "4:     ^",
          "",
          "[Added Lines]",
          "1: ./test/errors10/781205.xml:3: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3:   %a;",
          "4:      ^",
          "",
          "---------------"
        ],
        "result/valid/766956.xml.err||result/valid/766956.xml.err": [
          "File: result/valid/766956.xml.err -> result/valid/766956.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: test/valid/dtds/766956.dtd:2: parser error : PEReference: expecting ';'",
          "2: %\u00e4%ent;",
          "3:    ^",
          "7: Entity: line 1:",
          "8: value",
          "9: ^",
          "",
          "[Removed Lines]",
          "4: Entity: line 1: parser error : Content error in the external subset",
          "5:  %ent;",
          "6:       ^",
          "",
          "[Added Lines]",
          "4: test/valid/dtds/766956.dtd:2: parser error : Content error in the external subset",
          "5: %\u00e4%ent;",
          "6:         ^",
          "",
          "---------------"
        ],
        "result/valid/766956.xml.err.rdr||result/valid/766956.xml.err.rdr": [
          "File: result/valid/766956.xml.err.rdr -> result/valid/766956.xml.err.rdr",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: test/valid/dtds/766956.dtd:2: parser error : PEReference: expecting ';'",
          "2: %\u00e4%ent;",
          "3:    ^",
          "7: Entity: line 1:",
          "8: value",
          "9: ^",
          "",
          "[Removed Lines]",
          "4: Entity: line 1: parser error : Content error in the external subset",
          "5:  %ent;",
          "6:       ^",
          "",
          "[Added Lines]",
          "4: test/valid/dtds/766956.dtd:2: parser error : Content error in the external subset",
          "5: %\u00e4%ent;",
          "6:         ^",
          "",
          "---------------"
        ],
        "result/valid/t8.xml.err||result/valid/t8.xml.err": [
          "File: result/valid/t8.xml.err -> result/valid/t8.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: &lt;!ELEMENT root (middle) >",
          "7: ^",
          "12: Entity: line 1:",
          "13: &lt;!ELEMENT middle (test) >",
          "14: ^",
          "19: Entity: line 1:",
          "20: &lt;!ELEMENT test (#PCDATA) >",
          "21: ^",
          "",
          "[Removed Lines]",
          "1: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3:  %defroot;",
          "4:           ^",
          "8: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10:  %defmiddle;",
          "11:             ^",
          "15: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17:  %deftest;",
          "18:           ^",
          "",
          "[Added Lines]",
          "1: ./test/valid/t8.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3: %defroot; %defmiddle; %deftest;",
          "4:          ^",
          "8: ./test/valid/t8.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10: %defroot; %defmiddle; %deftest;",
          "11:                      ^",
          "15: ./test/valid/t8.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17: %defroot; %defmiddle; %deftest;",
          "18:                                ^",
          "",
          "---------------"
        ],
        "result/valid/t8.xml.err.rdr||result/valid/t8.xml.err.rdr": [
          "File: result/valid/t8.xml.err.rdr -> result/valid/t8.xml.err.rdr",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: &lt;!ELEMENT root (middle) >",
          "7: ^",
          "12: Entity: line 1:",
          "13: &lt;!ELEMENT middle (test) >",
          "14: ^",
          "19: Entity: line 1:",
          "20: &lt;!ELEMENT test (#PCDATA) >",
          "21: ^",
          "",
          "[Removed Lines]",
          "1: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3:  %defroot;",
          "4:           ^",
          "8: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10:  %defmiddle;",
          "11:             ^",
          "15: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17:  %deftest;",
          "18:           ^",
          "",
          "[Added Lines]",
          "1: ./test/valid/t8.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3: %defroot; %defmiddle; %deftest;",
          "4:          ^",
          "8: ./test/valid/t8.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10: %defroot; %defmiddle; %deftest;",
          "11:                      ^",
          "15: ./test/valid/t8.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17: %defroot; %defmiddle; %deftest;",
          "18:                                ^",
          "",
          "---------------"
        ],
        "result/valid/t8a.xml.err||result/valid/t8a.xml.err": [
          "File: result/valid/t8a.xml.err -> result/valid/t8a.xml.err",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: &lt;!ELEMENT root (middle) >",
          "7: ^",
          "12: Entity: line 1:",
          "13: &lt;!ELEMENT middle (test) >",
          "14: ^",
          "19: Entity: line 1:",
          "20: &lt;!ELEMENT test (#PCDATA) >",
          "21: ^",
          "",
          "[Removed Lines]",
          "1: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3:  %defroot;",
          "4:           ^",
          "8: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10:  %defmiddle;",
          "11:             ^",
          "15: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17:  %deftest;",
          "18:           ^",
          "",
          "[Added Lines]",
          "1: ./test/valid/t8a.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3: %defroot;%defmiddle;%deftest;",
          "4:          ^",
          "8: ./test/valid/t8a.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10: %defroot;%defmiddle;%deftest;",
          "11:                     ^",
          "15: ./test/valid/t8a.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17: %defroot;%defmiddle;%deftest;",
          "18:                              ^",
          "",
          "---------------"
        ],
        "result/valid/t8a.xml.err.rdr||result/valid/t8a.xml.err.rdr": [
          "File: result/valid/t8a.xml.err.rdr -> result/valid/t8a.xml.err.rdr",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: Entity: line 1:",
          "6: &lt;!ELEMENT root (middle) >",
          "7: ^",
          "12: Entity: line 1:",
          "13: &lt;!ELEMENT middle (test) >",
          "14: ^",
          "19: Entity: line 1:",
          "20: &lt;!ELEMENT test (#PCDATA) >",
          "21: ^",
          "",
          "[Removed Lines]",
          "1: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3:  %defroot;",
          "4:           ^",
          "8: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10:  %defmiddle;",
          "11:             ^",
          "15: Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17:  %deftest;",
          "18:           ^",
          "",
          "[Added Lines]",
          "1: ./test/valid/t8a.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "3: %defroot;%defmiddle;%deftest;",
          "4:          ^",
          "8: ./test/valid/t8a.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "10: %defroot;%defmiddle;%deftest;",
          "11:                     ^",
          "15: ./test/valid/t8a.xml:6: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration",
          "17: %defroot;%defmiddle;%deftest;",
          "18:                              ^",
          "",
          "---------------"
        ]
      }
    }
  ]
}