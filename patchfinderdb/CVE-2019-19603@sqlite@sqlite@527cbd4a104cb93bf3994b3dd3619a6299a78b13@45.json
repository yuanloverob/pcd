{
  "cve_id": "CVE-2019-19603",
  "cve_desc": "SQLite 3.30.1 mishandles certain SELECT statements with a nonexistent VIEW, leading to an application crash.",
  "repo": "sqlite/sqlite",
  "patch_hash": "527cbd4a104cb93bf3994b3dd3619a6299a78b13",
  "patch_info": {
    "commit_hash": "527cbd4a104cb93bf3994b3dd3619a6299a78b13",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/527cbd4a104cb93bf3994b3dd3619a6299a78b13",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/build.c",
      "src/sqliteInt.h",
      "test/altertab.test"
    ],
    "message": "Do not allow CREATE TABLE or CREATE VIEW of an object with a name that looks like a shadow table name.\n\nFossilOrigin-Name: 6aef58b629d89955f85f65191ba2be67b2adfac4f0327fe9a7141cb2705dbc00",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/build.c||src/build.c",
      "src/sqliteInt.h||src/sqliteInt.h",
      "test/altertab.test||test/altertab.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 8ad34d36a141fa8f5d9bd784dfeb892c983897a6dc6b867607cc668508acf944",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/build.c||src/build.c": [
      "File: src/build.c -> src/build.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "856:       }",
      "857:     }",
      "858:   }else{",
      "861:     ){",
      "862:       sqlite3ErrorMsg(pParse, \"object name reserved for internal use: %s\",",
      "863:                       zName);",
      "864:       return SQLITE_ERROR;",
      "865:     }",
      "866:   }",
      "867:   return SQLITE_OK;",
      "868: }",
      "",
      "[Removed Lines]",
      "859:     if( pParse->nested==0",
      "860:      && 0==sqlite3StrNICmp(zName, \"sqlite_\", 7)",
      "",
      "[Added Lines]",
      "859:     if( (pParse->nested==0 && 0==sqlite3StrNICmp(zName, \"sqlite_\", 7))",
      "860:      || (sqlite3ReadOnlyShadowTables(db) && sqlite3ShadowTableName(db, zName))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "2132: static int isShadowTableName(sqlite3 *db, char *zName){",
      "",
      "[Added Lines]",
      "2133: int sqlite3ShadowTableName(sqlite3 *db, const char *zName){",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "2147:   if( pMod->pModule->xShadowName==0 ) return 0;",
      "2148:   return pMod->pModule->xShadowName(zTail+1);",
      "2149: }",
      "",
      "[Removed Lines]",
      "2150: #else",
      "2151: # define isShadowTableName(x,y) 0",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "2190:   p = pParse->pNewTable;",
      "2191:   if( p==0 ) return;",
      "2194:     p->tabFlags |= TF_Shadow;",
      "2195:   }",
      "",
      "[Removed Lines]",
      "2193:   if( pSelect==0 && isShadowTableName(db, p->zName) ){",
      "",
      "[Added Lines]",
      "2192:   if( pSelect==0 && sqlite3ShadowTableName(db, p->zName) ){",
      "",
      "---------------"
    ],
    "src/sqliteInt.h||src/sqliteInt.h": [
      "File: src/sqliteInt.h -> src/sqliteInt.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "4548: #  define sqlite3VtabInSync(db) ((db)->nVTrans>0 && (db)->aVTrans==0)",
      "4549: #endif",
      "4550: int sqlite3ReadOnlyShadowTables(sqlite3 *db);",
      "4551: int sqlite3VtabEponymousTableInit(Parse*,Module*);",
      "4552: void sqlite3VtabEponymousTableClear(sqlite3*,Module*);",
      "4553: void sqlite3VtabMakeWritable(Parse*,Table*);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "4551: #ifndef SQLITE_OMIT_VIRTUALTABLE",
      "4552:   int sqlite3ShadowTableName(sqlite3 *db, const char *zName);",
      "4553: #else",
      "4554: # define sqlite3ShadowTableName(A,B) 0",
      "4555: #endif",
      "",
      "---------------"
    ],
    "test/altertab.test||test/altertab.test": [
      "File: test/altertab.test -> test/altertab.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "547:   } {1 {table y1_segments may not be modified}}",
      "549:   do_catchsql_test 16.20 {",
      "554:     DROP TABLE y1_segments;",
      "555:   } {1 {table y1_segments may not be dropped}}",
      "557:   do_execsql_test 16.30 {",
      "558:     ALTER TABLE y1 RENAME TO z1;",
      "559:   }",
      "",
      "[Removed Lines]",
      "550:     ALTER TABLE y1_segments RENAME TO abc;",
      "551:   } {1 {table y1_segments may not be altered}}",
      "553:   do_catchsql_test 16.21 {",
      "",
      "[Added Lines]",
      "553:   do_catchsql_test 16.20 {",
      "554:     ALTER TABLE y1_segments RENAME TO abc;",
      "555:   } {1 {table y1_segments may not be altered}}",
      "556:   sqlite3_db_config db DEFENSIVE 0",
      "557:   do_catchsql_test 16.22 {",
      "558:     ALTER TABLE y1_segments RENAME TO abc;",
      "559:   } {0 {}}",
      "560:   sqlite3_db_config db DEFENSIVE 1",
      "561:   do_catchsql_test 16.23 {",
      "562:     CREATE TABLE y1_segments AS SELECT * FROM abc;",
      "563:   } {1 {object name reserved for internal use: y1_segments}}",
      "564:   do_catchsql_test 16.24 {",
      "565:     CREATE VIEW y1_segments AS SELECT * FROM abc;",
      "566:   } {1 {object name reserved for internal use: y1_segments}}",
      "567:   sqlite3_db_config db DEFENSIVE 0",
      "568:   do_catchsql_test 16.25 {",
      "569:     ALTER TABLE abc RENAME TO y1_segments;",
      "570:   } {0 {}}",
      "571:   sqlite3_db_config db DEFENSIVE 1",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8eff0cc3261fdbbb539857795b6516a0f1ba7c48",
      "candidate_info": {
        "commit_hash": "8eff0cc3261fdbbb539857795b6516a0f1ba7c48",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/8eff0cc3261fdbbb539857795b6516a0f1ba7c48",
        "files": [
          "manifest",
          "manifest.uuid",
          "test/window1.test",
          "test/window8.tcl",
          "test/window8.test"
        ],
        "message": "Add tests to ensure that the window functions implementation is not generating code for unnecessary sorts.\n\nFossilOrigin-Name: e195948a6876efe01b5cf2ed67bc9015a781fda39dca668099cb7edc1d331818",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "test/window1.test||test/window1.test",
          "test/window8.tcl||test/window8.tcl",
          "test/window8.test||test/window8.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 4f9b93e6cfa0b3b6ab8a126299c2b2a242f840453dc450e84d3df87576cf6cf8",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/window1.test||test/window1.test": [
          "File: test/window1.test -> test/window1.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "970:   \" $res",
          "971: }",
          "973: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "973: #-------------------------------------------------------------------------",
          "974: reset_db",
          "975: do_execsql_test 23.0 {",
          "976:   CREATE TABLE t5(a, b, c);",
          "977:   CREATE INDEX t5ab ON t5(a, b);",
          "978: }",
          "980: proc do_ordercount_test {tn sql nOrderBy} {",
          "981:   set plan [execsql \"EXPLAIN QUERY PLAN $sql\"]",
          "982:   uplevel [list do_test $tn [list regexp -all ORDER $plan] $nOrderBy]",
          "983: }",
          "985: do_ordercount_test 23.1 {",
          "986:   SELECT",
          "987:     sum(c) OVER (ORDER BY a, b),",
          "988:     sum(c) OVER (PARTITION BY a ORDER BY b)",
          "989:   FROM t5",
          "990: } 0",
          "992: do_ordercount_test 23.2 {",
          "993:   SELECT",
          "994:     sum(c) OVER (ORDER BY b, a),",
          "995:     sum(c) OVER (PARTITION BY b ORDER BY a)",
          "996:   FROM t5",
          "997: } 1",
          "999: do_ordercount_test 23.3 {",
          "1000:   SELECT",
          "1001:     sum(c) OVER (ORDER BY b, a),",
          "1002:     sum(c) OVER (ORDER BY c, b)",
          "1003:   FROM t5",
          "1004: } 2",
          "1006: do_ordercount_test 23.4 {",
          "1007:   SELECT",
          "1008:     sum(c) OVER (ORDER BY b ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW),",
          "1009:     sum(c) OVER (ORDER BY b RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW),",
          "1010:     sum(c) OVER (ORDER BY b GROUPS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)",
          "1011:   FROM t5",
          "1012: } 1",
          "1014: do_ordercount_test 23.5 {",
          "1015:   SELECT",
          "1016:     sum(c) OVER (ORDER BY b+1 ROWS UNBOUNDED PRECEDING),",
          "1017:     sum(c) OVER (ORDER BY b+1 RANGE UNBOUNDED PRECEDING),",
          "1018:     sum(c) OVER (ORDER BY b+1 GROUPS UNBOUNDED PRECEDING)",
          "1019:   FROM t5",
          "1020: } 1",
          "1022: do_ordercount_test 23.6 {",
          "1023:   SELECT",
          "1024:     sum(c) OVER (ORDER BY b+1 ROWS UNBOUNDED PRECEDING),",
          "1025:     sum(c) OVER (ORDER BY b+2 RANGE UNBOUNDED PRECEDING),",
          "1026:     sum(c) OVER (ORDER BY b+3 GROUPS UNBOUNDED PRECEDING)",
          "1027:   FROM t5",
          "1028: } 3",
          "",
          "---------------"
        ],
        "test/window8.tcl||test/window8.tcl": [
          "File: test/window8.tcl -> test/window8.tcl",
          "--- Hunk 1 ---",
          "[Context before]",
          "165:   10 { ORDER BY a DESC RANGE BETWEEN 5.7 PRECEDING AND 5.8 FOLLOWING }",
          "166:   11 { ORDER BY a DESC RANGE BETWEEN UNBOUNDED PRECEDING AND 5.9 PRECEDING }",
          "167:   12 { ORDER BY a DESC RANGE BETWEEN 2.1 FOLLOWING AND UNBOUNDED FOLLOWING }",
          "168: } {",
          "169:   execsql_test 3.$tn \"",
          "170:     SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ($frame)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "168:   13  { ORDER BY a RANGE 5.1 PRECEDING }",
          "",
          "---------------"
        ],
        "test/window8.test||test/window8.test": [
          "File: test/window8.test -> test/window8.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "3494:   SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ( ORDER BY a DESC RANGE BETWEEN 2.1 FOLLOWING AND UNBOUNDED FOLLOWING )",
          "3495: } {30 232   22 112   20 112   15 30   13 30   13 30   10 10   5 {}}",
          "3497: #==========================================================================",
          "3499: do_execsql_test 4.0 {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3497: do_execsql_test 3.13 {",
          "3498:   SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ( ORDER BY a RANGE 5.1 PRECEDING )",
          "3499: } {5 10   10 30   13 72   13 72   15 102   20 70   22 120   30 90}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8f46f34e2d1ef30c7e7afa2c33029c5abcf37ded",
      "candidate_info": {
        "commit_hash": "8f46f34e2d1ef30c7e7afa2c33029c5abcf37ded",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/8f46f34e2d1ef30c7e7afa2c33029c5abcf37ded",
        "files": [
          "ext/misc/percentile.c",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Remove a redundant parameter extraction call from the percentile.c extension.\n\nFossilOrigin-Name: d49c32e6e7cc341b5961d2c7b7c68d1649c6542eeec201660e3f82a55aea9e3b",
        "before_after_code_files": [
          "ext/misc/percentile.c||ext/misc/percentile.c",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/misc/percentile.c||ext/misc/percentile.c": [
          "File: ext/misc/percentile.c -> ext/misc/percentile.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "109:   eType = sqlite3_value_numeric_type(argv[1]);",
          "110:   rPct = sqlite3_value_double(argv[1]);",
          "113:     sqlite3_result_error(pCtx, \"2nd argument to percentile() is not \"",
          "114:                          \"a number between 0.0 and 100.0\", -1);",
          "115:     return;",
          "",
          "[Removed Lines]",
          "111:   if( (eType!=SQLITE_INTEGER && eType!=SQLITE_FLOAT) ||",
          "112:       ((rPct = sqlite3_value_double(argv[1]))<0.0 || rPct>100.0) ){",
          "",
          "[Added Lines]",
          "111:   if( (eType!=SQLITE_INTEGER && eType!=SQLITE_FLOAT)",
          "112:    || rPct<0.0 || rPct>100.0 ){",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: f5732f4caf7a37a6445c61ae0d0ac14cc9deb897376e73aa36a1ead025b92c69",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f8a488bb6b89b1657badfff3e77add3be8fc9333",
      "candidate_info": {
        "commit_hash": "f8a488bb6b89b1657badfff3e77add3be8fc9333",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/f8a488bb6b89b1657badfff3e77add3be8fc9333",
        "files": [
          "ext/fts5/fts5_main.c",
          "ext/fts5/test/fts5vocab2.test",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Fix a problem causing a crash if an fts5vocab table was created to query an fts3/4 FTS index.\n\nFossilOrigin-Name: 9cd64ce453e4435d80117b8610c22a0a4b53cd6e84b39815e70e684f6b0295c8",
        "before_after_code_files": [
          "ext/fts5/fts5_main.c||ext/fts5/fts5_main.c",
          "ext/fts5/test/fts5vocab2.test||ext/fts5/test/fts5vocab2.test",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/fts5/fts5_main.c||ext/fts5/fts5_main.c": [
          "File: ext/fts5/fts5_main.c -> ext/fts5/fts5_main.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2245: ){",
          "2246:   Fts5Cursor *pCsr;",
          "2249:   pCsr = fts5CursorFromCsrid(pGlobal, iCsrId);",
          "2254: }",
          "",
          "[Removed Lines]",
          "2247:   Fts5Table *pTab;",
          "2250:   pTab = (Fts5Table*)pCsr->base.pVtab;",
          "2253:   return pTab->pIndex;",
          "",
          "[Added Lines]",
          "2248:   if( pCsr ){",
          "2249:     Fts5Table *pTab = (Fts5Table*)pCsr->base.pVtab;",
          "2251:     return pTab->pIndex;",
          "2252:   }",
          "2253:   return 0;",
          "",
          "---------------"
        ],
        "ext/fts5/test/fts5vocab2.test||ext/fts5/test/fts5vocab2.test": [
          "File: ext/fts5/test/fts5vocab2.test -> ext/fts5/test/fts5vocab2.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "202:   SELECT * FROM v1;",
          "203: } {}",
          "205: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "205: #-------------------------------------------------------------------------",
          "206: #",
          "207: reset_db",
          "208: do_execsql_test 4.0 {",
          "209:   CREATE VIRTUAL TABLE v1 USING fts5vocab(nosuchtable, col);",
          "210: }",
          "212: do_catchsql_test 4.1 {",
          "213:   SELECT * FROM v1 WHERE term=='nosuchterm';",
          "214: } {1 {no such fts5 table: main.nosuchtable}}",
          "216: do_execsql_test 4.2.1 {",
          "217:   CREATE TABLE nosuchtable(nosuchtable, y, z);",
          "218: }",
          "219: do_catchsql_test 4.2.2 {",
          "220:   SELECT * FROM v1 WHERE term=='nosuchterm';",
          "221: } {1 {no such fts5 table: main.nosuchtable}}",
          "223: ifcapable fts3 {",
          "224:   do_execsql_test 4.3.1 {",
          "225:     DROP TABLE nosuchtable;",
          "226:     CREATE VIRTUAL TABLE nosuchtable USING fts3(a, b);",
          "227:   } {}",
          "228:   do_catchsql_test 4.3.2 {",
          "229:     SELECT * FROM v1 WHERE term=='nosuchterm';",
          "230:   } {1 {no such fts5 table: main.nosuchtable}}",
          "231:   do_catchsql_test 4.3.3 {",
          "232:     INSERT INTO nosuchtable VALUES('id', '*id');",
          "233:     SELECT * FROM v1 WHERE term=='nosuchterm';",
          "234:   } {1 {no such fts5 table: main.nosuchtable}}",
          "235: }",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 65e50706a017751d72d0f9c7f575955194977decd0acf13aaca90c3cb925f20e",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8ea00d744e75af04c9368bb9128b58ba21825e17",
      "candidate_info": {
        "commit_hash": "8ea00d744e75af04c9368bb9128b58ba21825e17",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/8ea00d744e75af04c9368bb9128b58ba21825e17",
        "files": [
          "ext/rbu/rbupartial.test",
          "ext/rbu/sqlite3rbu.c",
          "main.mk",
          "manifest",
          "manifest.uuid",
          "src/btree.c",
          "src/build.c",
          "src/printf.c",
          "src/sqliteInt.h",
          "src/test4.c",
          "src/util.c",
          "src/vdbemem.c",
          "test/sqllimits1.test",
          "tool/omittest.tcl"
        ],
        "message": "Merge trunk changes into this branch.\n\nFossilOrigin-Name: d805fc0cf1c4ef07a7bc947f75828931e3788d0e64730caab3b42ae58009a194",
        "before_after_code_files": [
          "ext/rbu/rbupartial.test||ext/rbu/rbupartial.test",
          "ext/rbu/sqlite3rbu.c||ext/rbu/sqlite3rbu.c",
          "main.mk||main.mk",
          "manifest.uuid||manifest.uuid",
          "src/btree.c||src/btree.c",
          "src/build.c||src/build.c",
          "src/printf.c||src/printf.c",
          "src/sqliteInt.h||src/sqliteInt.h",
          "src/test4.c||src/test4.c",
          "src/util.c||src/util.c",
          "src/vdbemem.c||src/vdbemem.c",
          "test/sqllimits1.test||test/sqllimits1.test",
          "tool/omittest.tcl||tool/omittest.tcl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid",
            "src/build.c||src/build.c",
            "src/sqliteInt.h||src/sqliteInt.h"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid",
            "src/build.c||src/build.c",
            "src/sqliteInt.h||src/sqliteInt.h"
          ]
        }
      },
      "candidate_diff": {
        "ext/rbu/rbupartial.test||ext/rbu/rbupartial.test": [
          "File: ext/rbu/rbupartial.test -> ext/rbu/rbupartial.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # 2019 April 11",
          "2: #",
          "3: # The author disclaims copyright to this source code.  In place of",
          "4: # a legal notice, here is a blessing:",
          "5: #",
          "6: #    May you do good and not evil.",
          "7: #    May you find forgiveness for yourself and forgive others.",
          "8: #    May you share freely, never taking more than you give.",
          "9: #",
          "10: #***********************************************************************",
          "11: #",
          "13: source [file join [file dirname [info script]] rbu_common.tcl]",
          "14: set ::testprefix rbupartial",
          "16: db close",
          "17: sqlite3_shutdown",
          "18: sqlite3_config_uri 1",
          "20: foreach {tn without_rowid a b c d} {",
          "21:   1 \"\"              a b c d",
          "22:   2 \"WITHOUT ROWID\" aaa bbb ccc ddd",
          "23:   3 \"WITHOUT ROWID\" \"\\\"hello\\\"\" {\"one'two\"}  {[c]} ddd",
          "24:   4 \"WITHOUT ROWID\" {`a b`} {\"one'two\"}  {[c c c]} ddd",
          "25:   5 \"\" a b c {\"d\"\"d\"}",
          "26:   6 \"\" {'one''two'} b {\"c\"\"c\"} {\"d\"\"d\"}",
          "27: } {",
          "28:   eval [string map [list \\",
          "29:     %WITHOUT_ROWID% $without_rowid %A% $a %B% $b %C% $c %D% $d",
          "30:   ] {",
          "31:   reset_db",
          "32:   do_execsql_test $tn.1.0 {",
          "33:     CREATE TABLE t1(%A% PRIMARY KEY, %B%, %C%, %D%) %WITHOUT_ROWID% ;",
          "34:     CREATE INDEX i1b  ON t1(%B%);",
          "35:     CREATE INDEX i1b2 ON t1(%B%) WHERE %C%<5;",
          "36:     CREATE INDEX i1b3 ON t1(%B%) WHERE %C%>=5;",
          "38:     CREATE INDEX i1c  ON t1(%C%);",
          "39:     CREATE INDEX i1c2 ON t1(%C%) WHERE %C% IS NULL;",
          "40:     CREATE INDEX i1c3 ON t1(%C%) WHERE %C% IS NOT NULL;",
          "42:     CREATE INDEX i1c4 ON t1(%C%) WHERE %D% < 'd';",
          "43:   }",
          "45:   do_execsql_test $tn.1.1 {",
          "46:     INSERT INTO t1 VALUES(0, NULL, NULL, 'a');",
          "47:     INSERT INTO t1 VALUES(1, 2, 3, 'b');",
          "48:     INSERT INTO t1 VALUES(4, 5, 6, 'c');",
          "49:     INSERT INTO t1 VALUES(7, 8, 9, 'd');",
          "50:   }",
          "52:   forcedelete rbu.db",
          "53:   do_test $tn.1.2 {",
          "54:     sqlite3 rbu rbu.db",
          "55:     rbu eval {",
          "56:       CREATE TABLE data_t1(%A%, %B%, %C%, %D%, rbu_control);",
          "58:       INSERT INTO data_t1 VALUES(10, 11, 12, 'e', 0);",
          "59:       INSERT INTO data_t1 VALUES(13, 14, NULL, 'f', 0);",
          "61:       INSERT INTO data_t1 VALUES(0, NULL, NULL, NULL, 1);",
          "62:       INSERT INTO data_t1 VALUES(4, NULL, NULL, NULL, 1);",
          "64:       INSERT INTO data_t1 VALUES(7, NULL, 4, NULL, '..x.');",
          "65:       INSERT INTO data_t1 VALUES(1, 10, NULL, NULL, '.xx.');",
          "66:     }",
          "67:     rbu close",
          "68:   } {}",
          "70:   do_test $tn.1.3 {",
          "71:     run_rbu test.db rbu.db",
          "72:     execsql { PRAGMA integrity_check }",
          "73:   } {ok}",
          "75:   do_execsql_test $tn.1.4 {",
          "76:     SELECT * FROM t1 ORDER BY %A%;",
          "77:   } {",
          "78:     1 10 {} b   7 8 4 d   10 11 12 e   13 14 {} f",
          "79:   }",
          "81:   set step 0",
          "82:   do_rbu_vacuum_test $tn.1.5 0",
          "83:   }]",
          "84: }",
          "86: finish_test",
          "",
          "---------------"
        ],
        "ext/rbu/sqlite3rbu.c||ext/rbu/sqlite3rbu.c": [
          "File: ext/rbu/sqlite3rbu.c -> ext/rbu/sqlite3rbu.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1250:   pIter->nIndex = 0;",
          "1251:   while( p->rc==SQLITE_OK && SQLITE_ROW==sqlite3_step(pList) ){",
          "1252:     const char *zIdx = (const char*)sqlite3_column_text(pList, 1);",
          "1253:     sqlite3_stmt *pXInfo = 0;",
          "1254:     if( zIdx==0 ) break;",
          "1255:     p->rc = prepareFreeAndCollectError(p->dbMain, &pXInfo, &p->zErrmsg,",
          "1256:         sqlite3_mprintf(\"PRAGMA main.index_xinfo = %Q\", zIdx)",
          "1257:     );",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1258:     int bPartial = sqlite3_column_int(pList, 4);",
          "1261:     if( bPartial ){",
          "1262:       memset(pIter->abIndexed, 0x01, sizeof(u8)*pIter->nTblCol);",
          "1263:     }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1958:   }",
          "1959: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1970: static char *rbuObjIterGetIndexWhere(sqlite3rbu *p, RbuObjIter *pIter){",
          "1971:   sqlite3_stmt *pStmt = 0;",
          "1972:   int rc = p->rc;",
          "1973:   char *zRet = 0;",
          "1975:   if( rc==SQLITE_OK ){",
          "1976:     rc = prepareAndCollectError(p->dbMain, &pStmt, &p->zErrmsg,",
          "1977:         \"SELECT trim(sql) FROM sqlite_master WHERE type='index' AND name=?\"",
          "1978:     );",
          "1979:   }",
          "1980:   if( rc==SQLITE_OK ){",
          "1981:     int rc2;",
          "1982:     rc = sqlite3_bind_text(pStmt, 1, pIter->zIdx, -1, SQLITE_STATIC);",
          "1983:     if( rc==SQLITE_OK && SQLITE_ROW==sqlite3_step(pStmt) ){",
          "1984:       const char *zSql = (const char*)sqlite3_column_text(pStmt, 0);",
          "1985:       if( zSql ){",
          "1987:         int i;",
          "1988:         for(i=0; zSql[i]; i++){",
          "1989:           char c = zSql[i];",
          "1990:           if( c=='(' ){",
          "1991:             nParen++;",
          "1992:           }",
          "1993:           else if( c==')' ){",
          "1994:             nParen--;",
          "1995:             if( nParen==0 ){",
          "1996:               i++;",
          "1997:               break;",
          "1998:             }",
          "1999:           }else if( c=='\"' || c=='\\'' || c=='`' ){",
          "2000:             for(i++; 1; i++){",
          "2001:               if( zSql[i]==c ){",
          "2002:                 if( zSql[i+1]!=c ) break;",
          "2003:                 i++;",
          "2004:               }",
          "2005:             }",
          "2006:           }else if( c=='[' ){",
          "2007:             for(i++; 1; i++){",
          "2008:               if( zSql[i]==']' ) break;",
          "2009:             }",
          "2010:           }",
          "2011:         }",
          "2012:         if( zSql[i] ){",
          "2013:           zRet = rbuStrndup(&zSql[i], &rc);",
          "2014:         }",
          "2015:       }",
          "2016:     }",
          "2018:     rc2 = sqlite3_finalize(pStmt);",
          "2019:     if( rc==SQLITE_OK ) rc = rc2;",
          "2020:   }",
          "2022:   p->rc = rc;",
          "2023:   return zRet;",
          "2024: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1989:       char *zBind = 0;",
          "1990:       int nBind = 0;",
          "1992:       assert( pIter->eType!=RBU_PK_VTAB );",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2055:       char *zPart = 0;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1994:           p, pIter, &zImposterCols, &zImposterPK, &zWhere, &nBind",
          "1995:       );",
          "1996:       zBind = rbuObjIterGetBindlist(p, nBind);",
          "1999:       sqlite3_test_control(SQLITE_TESTCTRL_IMPOSTER, p->dbMain, \"main\", 0, 1);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2063:       zPart = rbuObjIterGetIndexWhere(p, pIter);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "2026:         char *zSql;",
          "2027:         if( rbuIsVacuum(p) ){",
          "2028:           zSql = sqlite3_mprintf(",
          "2030:               zCollist,",
          "2031:               pIter->zDataTbl,",
          "2033:           );",
          "2034:         }else",
          "2036:         if( pIter->eType==RBU_PK_EXTERNAL || pIter->eType==RBU_PK_NONE ){",
          "2037:           zSql = sqlite3_mprintf(",
          "2039:               zCollist, p->zStateDb, pIter->zDataTbl,",
          "2041:           );",
          "2042:         }else{",
          "2043:           zSql = sqlite3_mprintf(",
          "2045:               \"UNION ALL \"",
          "2046:               \"SELECT %s, rbu_control FROM '%q' \"",
          "2048:               \"ORDER BY %s%s\",",
          "2050:               zCollist, pIter->zDataTbl,",
          "2051:               zCollist, zLimit",
          "2052:           );",
          "2053:         }",
          "",
          "[Removed Lines]",
          "2029:               \"SELECT %s, 0 AS rbu_control FROM '%q' ORDER BY %s%s\",",
          "2032:               zCollist, zLimit",
          "2038:               \"SELECT %s, rbu_control FROM %s.'rbu_tmp_%q' ORDER BY %s%s\",",
          "2040:               zCollist, zLimit",
          "2044:               \"SELECT %s, rbu_control FROM %s.'rbu_tmp_%q' \"",
          "2047:               \"WHERE typeof(rbu_control)='integer' AND rbu_control!=1 \"",
          "2049:               zCollist, p->zStateDb, pIter->zDataTbl,",
          "",
          "[Added Lines]",
          "2096:               \"SELECT %s, 0 AS rbu_control FROM '%q' %s ORDER BY %s%s\",",
          "2099:               zPart, zCollist, zLimit",
          "2105:               \"SELECT %s, rbu_control FROM %s.'rbu_tmp_%q' %s ORDER BY %s%s\",",
          "2107:               zPart, zCollist, zLimit",
          "2111:               \"SELECT %s, rbu_control FROM %s.'rbu_tmp_%q' %s \"",
          "2114:               \"%s %s typeof(rbu_control)='integer' AND rbu_control!=1 \"",
          "2116:               zCollist, p->zStateDb, pIter->zDataTbl, zPart,",
          "2118:               zPart,",
          "2119:               (zPart ? \"AND\" : \"WHERE\"),",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "2058:       sqlite3_free(zImposterPK);",
          "2059:       sqlite3_free(zWhere);",
          "2060:       sqlite3_free(zBind);",
          "2061:     }else{",
          "2062:       int bRbuRowid = (pIter->eType==RBU_PK_VTAB)",
          "2063:                     ||(pIter->eType==RBU_PK_NONE)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2130:       sqlite3_free(zPart);",
          "",
          "---------------"
        ],
        "main.mk||main.mk": [
          "File: main.mk -> main.mk",
          "--- Hunk 1 ---",
          "[Context before]",
          "378:   $(TOP)/ext/misc/totype.c \\",
          "379:   $(TOP)/ext/misc/unionvtab.c \\",
          "380:   $(TOP)/ext/misc/wholenumber.c \\",
          "382:   $(TOP)/ext/misc/zipfile.c \\",
          "383:   $(TOP)/ext/fts5/fts5_tcl.c \\",
          "384:   $(TOP)/ext/fts5/fts5_test_mi.c \\",
          "",
          "[Removed Lines]",
          "381:   $(TOP)/ext/misc/vfslog.c \\",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: ec9c4f6d8da25dcc834812c2bb24bda1017833b1c572bdbbf87f0191e1310706",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/btree.c||src/btree.c": [
          "File: src/btree.c -> src/btree.c"
        ],
        "src/build.c||src/build.c": [
          "File: src/build.c -> src/build.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "4398:   StrAccum errMsg;",
          "4399:   Table *pTab = pIdx->pTable;",
          "4402:   if( pIdx->aColExpr ){",
          "4403:     sqlite3_str_appendf(&errMsg, \"index '%q'\", pIdx->zName);",
          "4404:   }else{",
          "",
          "[Removed Lines]",
          "4401:   sqlite3StrAccumInit(&errMsg, pParse->db, 0, 0, 200);",
          "",
          "[Added Lines]",
          "4401:   sqlite3StrAccumInit(&errMsg, pParse->db, 0, 0,",
          "4402:                       pParse->db->aLimit[SQLITE_LIMIT_LENGTH]);",
          "",
          "---------------"
        ],
        "src/printf.c||src/printf.c": [
          "File: src/printf.c -> src/printf.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "137:   assert( eError==SQLITE_NOMEM || eError==SQLITE_TOOBIG );",
          "138:   p->accError = eError;",
          "139:   if( p->mxAlloc ) sqlite3_str_reset(p);",
          "140: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "140:   if( eError==SQLITE_TOOBIG ) sqlite3ErrorToParser(p->db, eError);",
          "",
          "---------------"
        ],
        "src/sqliteInt.h||src/sqliteInt.h": [
          "File: src/sqliteInt.h -> src/sqliteInt.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3835: void sqlite3SetString(char **, sqlite3*, const char*);",
          "3836: void sqlite3ErrorMsg(Parse*, const char*, ...);",
          "3837: void sqlite3Dequote(char*);",
          "3838: void sqlite3DequoteExpr(Expr*);",
          "3839: void sqlite3TokenInit(Token*,char*);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3837: int sqlite3ErrorToParser(sqlite3*,int);",
          "",
          "---------------"
        ],
        "src/test4.c||src/test4.c": [
          "File: src/test4.c -> src/test4.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "68:   Thread *p = (Thread*)pArg;",
          "69:   if( p->db ){",
          "70:     sqlite3_close(p->db);",
          "",
          "[Removed Lines]",
          "67: static void *thread_main(void *pArg){",
          "",
          "[Added Lines]",
          "67: static void *test_thread_main(void *pArg){",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "151:   threadset[i].zFilename = sqlite3_mprintf(\"%s\", argv[2]);",
          "152:   threadset[i].opnum = 1;",
          "153:   threadset[i].completed = 0;",
          "155:   if( rc ){",
          "156:     Tcl_AppendResult(interp, \"failed to create the thread\", 0);",
          "157:     sqlite3_free(threadset[i].zFilename);",
          "",
          "[Removed Lines]",
          "154:   rc = pthread_create(&x, 0, thread_main, &threadset[i]);",
          "",
          "[Added Lines]",
          "154:   rc = pthread_create(&x, 0, test_thread_main, &threadset[i]);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "169:   while( p->opnum>p->completed ) sched_yield();",
          "170: }",
          "",
          "[Removed Lines]",
          "168: static void thread_wait(Thread *p){",
          "",
          "[Added Lines]",
          "168: static void test_thread_wait(Thread *p){",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "193:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "194:     return TCL_ERROR;",
          "195:   }",
          "197:   return TCL_OK;",
          "198: }",
          "205:   p->xOp = 0;",
          "206:   p->opnum++;",
          "208:   sqlite3_free(p->zArg);",
          "209:   p->zArg = 0;",
          "210:   sqlite3_free(p->zFilename);",
          "",
          "[Removed Lines]",
          "196:   thread_wait(&threadset[i]);",
          "203: static void stop_thread(Thread *p){",
          "204:   thread_wait(p);",
          "207:   thread_wait(p);",
          "",
          "[Added Lines]",
          "196:   test_thread_wait(&threadset[i]);",
          "203: static void test_stop_thread(Thread *p){",
          "204:   test_thread_wait(p);",
          "207:   test_thread_wait(p);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "233:   }",
          "234:   if( argv[1][0]=='*' && argv[1][1]==0 ){",
          "235:     for(i=0; i<N_THREAD; i++){",
          "237:     }",
          "238:   }else{",
          "239:     i = parse_thread_id(interp, argv[1]);",
          "",
          "[Removed Lines]",
          "236:       if( threadset[i].busy ) stop_thread(&threadset[i]);",
          "",
          "[Added Lines]",
          "236:       if( threadset[i].busy ) test_stop_thread(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "242:       Tcl_AppendResult(interp, \"no such thread\", 0);",
          "243:       return TCL_ERROR;",
          "244:     }",
          "246:   }",
          "247:   return TCL_OK;",
          "248: }",
          "",
          "[Removed Lines]",
          "245:     stop_thread(&threadset[i]);",
          "",
          "[Added Lines]",
          "245:     test_stop_thread(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "273:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "274:     return TCL_ERROR;",
          "275:   }",
          "277:   sqlite3_snprintf(sizeof(zBuf), zBuf, \"%d\", threadset[i].argc);",
          "278:   Tcl_AppendResult(interp, zBuf, 0);",
          "279:   return TCL_OK;",
          "",
          "[Removed Lines]",
          "276:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "276:   test_thread_wait(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "306:     return TCL_ERROR;",
          "307:   }",
          "308:   if( Tcl_GetInt(interp, argv[2], &n) ) return TCL_ERROR;",
          "310:   if( n<0 || n>=threadset[i].argc ){",
          "311:     Tcl_AppendResult(interp, \"column number out of range\", 0);",
          "312:     return TCL_ERROR;",
          "",
          "[Removed Lines]",
          "309:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "309:   test_thread_wait(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "342:     return TCL_ERROR;",
          "343:   }",
          "344:   if( Tcl_GetInt(interp, argv[2], &n) ) return TCL_ERROR;",
          "346:   if( n<0 || n>=threadset[i].argc ){",
          "347:     Tcl_AppendResult(interp, \"column number out of range\", 0);",
          "348:     return TCL_ERROR;",
          "",
          "[Removed Lines]",
          "345:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "345:   test_thread_wait(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "377:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "378:     return TCL_ERROR;",
          "379:   }",
          "381:   zName = sqlite3ErrName(threadset[i].rc);",
          "382:   Tcl_AppendResult(interp, zName, 0);",
          "383:   return TCL_OK;",
          "",
          "[Removed Lines]",
          "380:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "380:   test_thread_wait(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "408:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "409:     return TCL_ERROR;",
          "410:   }",
          "412:   Tcl_AppendResult(interp, threadset[i].zErr, 0);",
          "413:   return TCL_OK;",
          "414: }",
          "",
          "[Removed Lines]",
          "411:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "411:   test_thread_wait(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 12 ---",
          "[Context before]",
          "452:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "453:     return TCL_ERROR;",
          "454:   }",
          "456:   threadset[i].xOp = do_compile;",
          "457:   sqlite3_free(threadset[i].zArg);",
          "458:   threadset[i].zArg = sqlite3_mprintf(\"%s\", argv[2]);",
          "",
          "[Removed Lines]",
          "455:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "455:   test_thread_wait(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 13 ---",
          "[Context before]",
          "505:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "506:     return TCL_ERROR;",
          "507:   }",
          "509:   threadset[i].xOp = do_step;",
          "510:   threadset[i].opnum++;",
          "511:   return TCL_OK;",
          "",
          "[Removed Lines]",
          "508:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "508:   test_thread_wait(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 14 ---",
          "[Context before]",
          "547:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "548:     return TCL_ERROR;",
          "549:   }",
          "551:   threadset[i].xOp = do_finalize;",
          "552:   sqlite3_free(threadset[i].zArg);",
          "553:   threadset[i].zArg = 0;",
          "",
          "[Removed Lines]",
          "550:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "550:   test_thread_wait(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 15 ---",
          "[Context before]",
          "579:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "580:     return TCL_ERROR;",
          "581:   }",
          "583:   j = parse_thread_id(interp, argv[2]);",
          "584:   if( j<0 ) return TCL_ERROR;",
          "585:   if( !threadset[j].busy ){",
          "586:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "587:     return TCL_ERROR;",
          "588:   }",
          "590:   temp = threadset[i].db;",
          "591:   threadset[i].db = threadset[j].db;",
          "592:   threadset[j].db = temp;",
          "",
          "[Removed Lines]",
          "582:   thread_wait(&threadset[i]);",
          "589:   thread_wait(&threadset[j]);",
          "",
          "[Added Lines]",
          "582:   test_thread_wait(&threadset[i]);",
          "589:   test_thread_wait(&threadset[j]);",
          "",
          "---------------",
          "--- Hunk 16 ---",
          "[Context before]",
          "620:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "621:     return TCL_ERROR;",
          "622:   }",
          "624:   sqlite3TestMakePointerStr(interp, zBuf, threadset[i].db);",
          "625:   threadset[i].db = 0;",
          "626:   Tcl_AppendResult(interp, zBuf, (char*)0);",
          "",
          "[Removed Lines]",
          "623:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "623:   test_thread_wait(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 17 ---",
          "[Context before]",
          "651:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "652:     return TCL_ERROR;",
          "653:   }",
          "655:   assert( !threadset[i].db );",
          "656:   threadset[i].db = (sqlite3*)sqlite3TestTextToPtr(argv[2]);",
          "657:   return TCL_OK;",
          "",
          "[Removed Lines]",
          "654:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "654:   test_thread_wait(&threadset[i]);",
          "",
          "---------------",
          "--- Hunk 18 ---",
          "[Context before]",
          "683:     Tcl_AppendResult(interp, \"no such thread\", 0);",
          "684:     return TCL_ERROR;",
          "685:   }",
          "687:   sqlite3TestMakePointerStr(interp, zBuf, threadset[i].pStmt);",
          "688:   threadset[i].pStmt = 0;",
          "689:   Tcl_AppendResult(interp, zBuf, (char*)0);",
          "",
          "[Removed Lines]",
          "686:   thread_wait(&threadset[i]);",
          "",
          "[Added Lines]",
          "686:   test_thread_wait(&threadset[i]);",
          "",
          "---------------"
        ],
        "src/util.c||src/util.c": [
          "File: src/util.c -> src/util.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "233:   }",
          "234: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "241: int sqlite3ErrorToParser(sqlite3 *db, int errCode){",
          "242:   Parse *pParse;",
          "243:   if( db==0 || (pParse = db->pParse)==0 ) return errCode;",
          "244:   pParse->rc = errCode;",
          "245:   pParse->nErr++;",
          "246:   return errCode;",
          "247: }",
          "",
          "---------------"
        ],
        "src/vdbemem.c||src/vdbemem.c": [
          "File: src/vdbemem.c -> src/vdbemem.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "199:   testcase( bPreserve && pMem->z==0 );",
          "201:   assert( pMem->szMalloc==0",
          "",
          "[Removed Lines]",
          "195:   assert( bPreserve==0",
          "196:        || pMem->flags&(MEM_Blob|MEM_Str)",
          "197:        || MemNullNochng(pMem)",
          "198:   );",
          "",
          "[Added Lines]",
          "195:   assert( bPreserve==0 || pMem->flags&(MEM_Blob|MEM_Str) );",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "310:   nByte = pMem->n + pMem->u.nZero;",
          "311:   if( nByte<=0 ){",
          "312:     nByte = 1;",
          "313:   }",
          "314:   if( sqlite3VdbeMemGrow(pMem, nByte, 1) ){",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "309:     if( (pMem->flags & MEM_Blob)==0 ) return SQLITE_OK;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1065:       nAlloc += (enc==SQLITE_UTF8?1:2);",
          "1066:     }",
          "1067:     if( nByte>iLimit ){",
          "1069:     }",
          "1070:     testcase( nAlloc==0 );",
          "1071:     testcase( nAlloc==31 );",
          "",
          "[Removed Lines]",
          "1068:       return SQLITE_TOOBIG;",
          "",
          "[Added Lines]",
          "1066:       return sqlite3ErrorToParser(pMem->db, SQLITE_TOOBIG);",
          "",
          "---------------"
        ],
        "test/sqllimits1.test||test/sqllimits1.test": [
          "File: test/sqllimits1.test -> test/sqllimits1.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "889: foreach {key value} [array get saved] {",
          "890:   catch {set $key $value}",
          "891: }",
          "892: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "893: #-------------------------------------------------------------------------",
          "894: # At one point the following caused an assert() to fail.",
          "895: #",
          "896: sqlite3_limit db SQLITE_LIMIT_LENGTH 10000",
          "897: set nm [string repeat x 10000]",
          "898: do_catchsql_test sqllimits1-17.1 \"",
          "899:   CREATE TABLE $nm (x PRIMARY KEY)",
          "900: \" {1 {string or blob too big}}",
          "",
          "---------------"
        ],
        "tool/omittest.tcl||tool/omittest.tcl": [
          "File: tool/omittest.tcl -> tool/omittest.tcl",
          "--- Hunk 1 ---",
          "[Context before]",
          "192:     SQLITE_OMIT_BETWEEN_OPTIMIZATION \\",
          "193:     SQLITE_OMIT_BLOB_LITERAL \\",
          "194:     SQLITE_OMIT_BTREECOUNT \\",
          "196:     SQLITE_OMIT_CAST \\",
          "197:     SQLITE_OMIT_CHECK \\",
          "198:     SQLITE_OMIT_COMPILEOPTION_DIAGS \\",
          "199:     SQLITE_OMIT_COMPLETE \\",
          "200:     SQLITE_OMIT_COMPOUND_SELECT \\",
          "201:     SQLITE_OMIT_CTE \\",
          "202:     SQLITE_OMIT_DATETIME_FUNCS \\",
          "203:     SQLITE_OMIT_DECLTYPE \\",
          "204:     SQLITE_OMIT_DEPRECATED \\",
          "205:     SQLITE_OMIT_EXPLAIN \\",
          "206:     SQLITE_OMIT_FLAG_PRAGMAS \\",
          "207:     SQLITE_OMIT_FLOATING_POINT \\",
          "208:     SQLITE_OMIT_FOREIGN_KEY \\",
          "209:     SQLITE_OMIT_GET_TABLE \\",
          "210:     SQLITE_OMIT_INCRBLOB \\",
          "211:     SQLITE_OMIT_INTEGRITY_CHECK \\",
          "212:     SQLITE_OMIT_LIKE_OPTIMIZATION \\",
          "",
          "[Removed Lines]",
          "195:     SQLITE_OMIT_BUILTIN_TEST \\",
          "",
          "[Added Lines]",
          "200:     SQLITE_OMIT_CONFLICT_CLAUSE \\",
          "205:     SQLITE_OMIT_DISKIO \\",
          "211:     SQLITE_OMIT_HEX_INTEGER \\",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "214:     SQLITE_OMIT_LOCALTIME \\",
          "215:     SQLITE_OMIT_LOOKASIDE \\",
          "216:     SQLITE_OMIT_MEMORYDB \\",
          "217:     SQLITE_OMIT_OR_OPTIMIZATION \\",
          "218:     SQLITE_OMIT_PAGER_PRAGMAS \\",
          "219:     SQLITE_OMIT_PRAGMA \\",
          "220:     SQLITE_OMIT_PROGRESS_CALLBACK \\",
          "221:     SQLITE_OMIT_QUICKBALANCE \\",
          "222:     SQLITE_OMIT_REINDEX \\",
          "223:     SQLITE_OMIT_SCHEMA_PRAGMAS \\",
          "224:     SQLITE_OMIT_SCHEMA_VERSION_PRAGMAS \\",
          "225:     SQLITE_OMIT_SHARED_CACHE \\",
          "226:     SQLITE_OMIT_SUBQUERY \\",
          "227:     SQLITE_OMIT_TCL_VARIABLE \\",
          "228:     SQLITE_OMIT_TEMPDB \\",
          "229:     SQLITE_OMIT_TRACE \\",
          "230:     SQLITE_OMIT_TRIGGER \\",
          "231:     SQLITE_OMIT_TRUNCATE_OPTIMIZATION \\",
          "233:     SQLITE_OMIT_UTF16 \\",
          "234:     SQLITE_OMIT_VACUUM \\",
          "235:     SQLITE_OMIT_VIEW \\",
          "236:     SQLITE_OMIT_VIRTUALTABLE \\",
          "237:     SQLITE_OMIT_WAL \\",
          "238:     SQLITE_OMIT_WSD \\",
          "239:     SQLITE_OMIT_XFER_OPT \\",
          "240:   ]",
          "",
          "[Removed Lines]",
          "232:     SQLITE_OMIT_UNIQUE_ENFORCEMENT \\",
          "",
          "[Added Lines]",
          "219:     SQLITE_OMIT_MEMORY_ALLOCATION \\",
          "222:     SQLITE_OMIT_PARSER_TRACE \\",
          "223:     SQLITE_OMIT_POPEN \\",
          "227:     SQLITE_OMIT_RANDOMNESS \\",
          "232:     SQLITE_OMIT_SHUTDOWN_DIRECTORIES \\",
          "236:     SQLITE_OMIT_TEST_CONTROL \\",
          "240:     SQLITE_OMIT_UPSERT \\",
          "246:     SQLITE_OMIT_WINDOWFUNC \\",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "df82afc04efbf269f3d4663cec04147421310f56",
      "candidate_info": {
        "commit_hash": "df82afc04efbf269f3d4663cec04147421310f56",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/df82afc04efbf269f3d4663cec04147421310f56",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/vdbe.c",
          "src/vdbemem.c"
        ],
        "message": "Make sure the OP_Concat opcode always correctly zero-terminates a UTF16 string, even if the input strings are ill-formed.  This is a followup to check-in [3a16ddf91f0c9c516a7] that fixes a case the previous check-in missed. Also add assert()s to prove correct zero termination.\n\nFossilOrigin-Name: d612fb7873cf59dfda18cabe45f674c37aa78a4587de3378b1840c99465a0269",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/vdbe.c||src/vdbe.c",
          "src/vdbemem.c||src/vdbemem.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 05897ca48a40c6771ff83ba8ecc3a5c60dafddf58651c222dd8cf89b9fc7b077",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/vdbe.c||src/vdbe.c": [
          "File: src/vdbe.c -> src/vdbe.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1501:   if( nByte>db->aLimit[SQLITE_LIMIT_LENGTH] ){",
          "1502:     goto too_big;",
          "1503:   }",
          "1505:     goto no_mem;",
          "1506:   }",
          "1507:   MemSetTypeFlag(pOut, MEM_Str);",
          "",
          "[Removed Lines]",
          "1504:   if( sqlite3VdbeMemGrow(pOut, (int)nByte+2, pOut==pIn2) ){",
          "",
          "[Added Lines]",
          "1504:   if( sqlite3VdbeMemGrow(pOut, (int)nByte+3, pOut==pIn2) ){",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1515:   pIn1->flags = flags1;",
          "1516:   pOut->z[nByte]=0;",
          "1517:   pOut->z[nByte+1] = 0;",
          "1518:   pOut->flags |= MEM_Term;",
          "1519:   pOut->n = (int)nByte;",
          "1520:   pOut->enc = encoding;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1518:   pOut->z[nByte+2] = 0;",
          "",
          "---------------"
        ],
        "src/vdbemem.c||src/vdbemem.c": [
          "File: src/vdbemem.c -> src/vdbemem.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "140:   char zBuf[100];",
          "141:   char *z;",
          "142:   int i, j, incr;",
          "143:   if( (p->flags & MEM_Str)==0 ) return 1;",
          "144:   if( (p->flags & (MEM_Int|MEM_Real|MEM_IntReal))==0 ) return 1;",
          "145:   vdbeMemRenderNum(sizeof(zBuf), zBuf, p);",
          "146:   z = p->z;",
          "",
          "[Removed Lines]",
          "139: int sqlite3VdbeMemConsistentDualRep(Mem *p){",
          "",
          "[Added Lines]",
          "142: int sqlite3VdbeMemValidStrRep(Mem *p){",
          "147:   if( p->flags & MEM_Term ){",
          "150:     if( p->z==p->zMalloc && p->szMalloc>0 ){",
          "151:       assert( p->enc==SQLITE_UTF8 || p->szMalloc >= ((p->n+1)&~1)+2 );",
          "152:       assert( p->enc!=SQLITE_UTF8 || p->szMalloc >= p->n+1 );",
          "153:     }",
          "154:     assert( p->z[p->n]==0 );",
          "155:     assert( p->enc==SQLITE_UTF8 || p->z[(p->n+1)&~1]==0 );",
          "156:     assert( p->enc==SQLITE_UTF8 || p->z[((p->n+1)&~1)+1]==0 );",
          "157:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1221:   assert(pVal->enc==(enc & ~SQLITE_UTF16_ALIGNED) || pVal->db==0",
          "1222:               || pVal->db->mallocFailed );",
          "1223:   if( pVal->enc==(enc & ~SQLITE_UTF16_ALIGNED) ){",
          "1225:     return pVal->z;",
          "1226:   }else{",
          "1227:     return 0;",
          "",
          "[Removed Lines]",
          "1224:     assert( sqlite3VdbeMemConsistentDualRep(pVal) );",
          "",
          "[Added Lines]",
          "1238:     assert( sqlite3VdbeMemValidStrRep(pVal) );",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1244:   assert( (enc&3)==(enc&~SQLITE_UTF16_ALIGNED) );",
          "1245:   assert( !sqlite3VdbeMemIsRowSet(pVal) );",
          "1246:   if( (pVal->flags&(MEM_Str|MEM_Term))==(MEM_Str|MEM_Term) && pVal->enc==enc ){",
          "1248:     return pVal->z;",
          "1249:   }",
          "1250:   if( pVal->flags&MEM_Null ){",
          "",
          "[Removed Lines]",
          "1247:     assert( sqlite3VdbeMemConsistentDualRep(pVal) );",
          "",
          "[Added Lines]",
          "1261:     assert( sqlite3VdbeMemValidStrRep(pVal) );",
          "",
          "---------------"
        ]
      }
    }
  ]
}