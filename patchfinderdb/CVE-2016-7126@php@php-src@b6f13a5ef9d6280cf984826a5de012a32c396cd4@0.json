{
  "cve_id": "CVE-2016-7126",
  "cve_desc": "The imagetruecolortopalette function in ext/gd/gd.c in PHP before 5.6.25 and 7.x before 7.0.10 does not properly validate the number of colors, which allows remote attackers to cause a denial of service (select_colors allocation error and out-of-bounds write) or possibly have unspecified other impact via a large value in the third argument.",
  "repo": "php/php-src",
  "patch_hash": "b6f13a5ef9d6280cf984826a5de012a32c396cd4",
  "patch_info": {
    "commit_hash": "b6f13a5ef9d6280cf984826a5de012a32c396cd4",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/b6f13a5ef9d6280cf984826a5de012a32c396cd4",
    "files": [
      "ext/gd/gd.c",
      "ext/gd/tests/bug72697.phpt"
    ],
    "message": "Fix bug#72697 - select_colors write out-of-bounds",
    "before_after_code_files": [
      "ext/gd/gd.c||ext/gd/gd.c",
      "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
    ]
  },
  "patch_diff": {
    "ext/gd/gd.c||ext/gd/gd.c": [
      "File: ext/gd/gd.c -> ext/gd/gd.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "100: #include \"gd_ctx.c\"",
      "104: int overflow2(int a, int b);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1197:  REGISTER_LONG_CONSTANT(\"IMG_CROP_SIDES\", GD_CROP_SIDES, CONST_CS | CONST_PERSISTENT);",
      "1198:  REGISTER_LONG_CONSTANT(\"IMG_CROP_THRESHOLD\", GD_CROP_THRESHOLD, CONST_CS | CONST_PERSISTENT);",
      "1201:  REGISTER_LONG_CONSTANT(\"IMG_BELL\", GD_BELL, CONST_CS | CONST_PERSISTENT);",
      "1202:  REGISTER_LONG_CONSTANT(\"IMG_BESSEL\", GD_BESSEL, CONST_CS | CONST_PERSISTENT);",
      "1203:  REGISTER_LONG_CONSTANT(\"IMG_BILINEAR_FIXED\", GD_BILINEAR_FIXED, CONST_CS | CONST_PERSISTENT);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1652:  ZEND_FETCH_RESOURCE(im, gdImagePtr, &IM, -1, \"Image\", le_gd);",
      "1656:   RETURN_FALSE;",
      "1657:  }",
      "1660:  RETURN_TRUE;",
      "1661: }",
      "",
      "[Removed Lines]",
      "1654:  if (ncolors <= 0) {",
      "1655:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Number of colors has to be greater than zero\");",
      "1658:  gdImageTrueColorToPalette(im, dither, ncolors);",
      "",
      "[Added Lines]",
      "1654:  if (ncolors <= 0 || ncolors > INT_MAX) {",
      "1655:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Number of colors has to be greater than zero and no more than %d\", INT_MAX);",
      "1658:  gdImageTrueColorToPalette(im, dither, (int)ncolors);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "3908:  PHP_GD_CHECK_OPEN_BASEDIR(fontname, \"Invalid font filename\");",
      "3910: #ifdef HAVE_GD_FREETYPE",
      "3911:  if (extended) {",
      "3912:   error = gdImageStringFTEx(im, brect, col, fontname, ptsize, angle, x, y, str, &strex);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "4484:  int x, y;",
      "4485:  float x_ratio, y_ratio;",
      "4486:     long ignore_warning;",
      "4488:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"pplll\", &f_org, &f_org_len, &f_dest, &f_dest_len, &height, &width, &threshold) == FAILURE) {",
      "4489:   return;",
      "4490:  }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "5367:     php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing y position\");",
      "5368:     RETURN_FALSE;",
      "5369:    }",
      "5371:    if (type == GD_AFFINE_TRANSLATE) {",
      "5372:     res = gdAffineTranslate(affine, x, y);",
      "5373:    } else {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt": [
      "File: ext/gd/tests/bug72697.phpt -> ext/gd/tests/bug72697.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #72697: select_colors write out-of-bounds",
      "3: --SKIPIF--",
      "4: <?php",
      "5: if (!function_exists(\"imagecreatetruecolor\")) die(\"skip\");",
      "6: if (PHP_INT_MAX !== 9223372036854775807) die(\"skip for 64-bit long systems only\");",
      "7: ?>",
      "8: --FILE--",
      "9: <?php",
      "11: $img=imagecreatetruecolor(10, 10);",
      "12: imagetruecolortopalette($img, false, PHP_INT_MAX / 8);",
      "13: ?>",
      "14: DONE",
      "15: --EXPECTF--",
      "16: Warning: imagetruecolortopalette(): Number of colors has to be greater than zero and no more than 2147483647 in %sbug72697.php on line %d",
      "17: DONE",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3493ed5b528be73c73a85c75effdfd3a469ac55d",
      "candidate_info": {
        "commit_hash": "3493ed5b528be73c73a85c75effdfd3a469ac55d",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/3493ed5b528be73c73a85c75effdfd3a469ac55d",
        "files": [
          "ext/gd/gd.c",
          "ext/gd/tests/bug72697.phpt"
        ],
        "message": "Fix bug#72697 - select_colors write out-of-bounds\n\n(cherry picked from commit b6f13a5ef9d6280cf984826a5de012a32c396cd4)\n\nConflicts:\n\text/gd/gd.c\n\n(cherry picked from commit 28022c9b1fd937436ab67bb3d61f652c108baf96)",
        "before_after_code_files": [
          "ext/gd/gd.c||ext/gd/gd.c",
          "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/gd.c||ext/gd/gd.c",
            "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
          ],
          "candidate": [
            "ext/gd/gd.c||ext/gd/gd.c",
            "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/gd.c||ext/gd/gd.c": [
          "File: ext/gd/gd.c -> ext/gd/gd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1530:   RETURN_FALSE;",
          "1531:  }",
          "1535:   RETURN_FALSE;",
          "1536:  }",
          "1539:  RETURN_TRUE;",
          "1540: }",
          "",
          "[Removed Lines]",
          "1533:  if (ncolors <= 0) {",
          "1534:   php_error_docref(NULL, E_WARNING, \"Number of colors has to be greater than zero\");",
          "1537:  gdImageTrueColorToPalette(im, dither, ncolors);",
          "",
          "[Added Lines]",
          "1533:  if (ncolors <= 0 || ZEND_LONG_INT_OVFL(ncolors)) {",
          "1534:   php_error_docref(NULL, E_WARNING, \"Number of colors has to be greater than zero and no more than %d\", INT_MAX);",
          "1537:  gdImageTrueColorToPalette(im, dither, (int)ncolors);",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt": [
          "File: ext/gd/tests/bug72697.phpt -> ext/gd/tests/bug72697.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72697: select_colors write out-of-bounds",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!function_exists(\"imagecreatetruecolor\")) die(\"skip\");",
          "6: if (PHP_INT_MAX !== 9223372036854775807) die(\"skip for 64-bit long systems only\");",
          "7: ?>",
          "8: --FILE--",
          "9: <?php",
          "11: $img=imagecreatetruecolor(10, 10);",
          "12: imagetruecolortopalette($img, false, PHP_INT_MAX / 8);",
          "13: ?>",
          "14: DONE",
          "15: --EXPECTF--",
          "16: Warning: imagetruecolortopalette(): Number of colors has to be greater than zero and no more than 2147483647 in %sbug72697.php on line %d",
          "17: DONE",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "28022c9b1fd937436ab67bb3d61f652c108baf96",
      "candidate_info": {
        "commit_hash": "28022c9b1fd937436ab67bb3d61f652c108baf96",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/28022c9b1fd937436ab67bb3d61f652c108baf96",
        "files": [
          "ext/gd/gd.c",
          "ext/gd/tests/bug72697.phpt"
        ],
        "message": "Fix bug#72697 - select_colors write out-of-bounds\n\n(cherry picked from commit b6f13a5ef9d6280cf984826a5de012a32c396cd4)\n\nConflicts:\n\text/gd/gd.c",
        "before_after_code_files": [
          "ext/gd/gd.c||ext/gd/gd.c",
          "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/gd.c||ext/gd/gd.c",
            "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
          ],
          "candidate": [
            "ext/gd/gd.c||ext/gd/gd.c",
            "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/gd.c||ext/gd/gd.c": [
          "File: ext/gd/gd.c -> ext/gd/gd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1537:   RETURN_FALSE;",
          "1538:  }",
          "1542:   RETURN_FALSE;",
          "1543:  }",
          "1546:  RETURN_TRUE;",
          "1547: }",
          "",
          "[Removed Lines]",
          "1540:  if (ncolors <= 0) {",
          "1541:   php_error_docref(NULL, E_WARNING, \"Number of colors has to be greater than zero\");",
          "1544:  gdImageTrueColorToPalette(im, dither, ncolors);",
          "",
          "[Added Lines]",
          "1540:  if (ncolors <= 0 || ZEND_LONG_INT_OVFL(ncolors)) {",
          "1541:   php_error_docref(NULL, E_WARNING, \"Number of colors has to be greater than zero and no more than %d\", INT_MAX);",
          "1544:  gdImageTrueColorToPalette(im, dither, (int)ncolors);",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt": [
          "File: ext/gd/tests/bug72697.phpt -> ext/gd/tests/bug72697.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72697: select_colors write out-of-bounds",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!function_exists(\"imagecreatetruecolor\")) die(\"skip\");",
          "6: if (PHP_INT_MAX !== 9223372036854775807) die(\"skip for 64-bit long systems only\");",
          "7: ?>",
          "8: --FILE--",
          "9: <?php",
          "11: $img=imagecreatetruecolor(10, 10);",
          "12: imagetruecolortopalette($img, false, PHP_INT_MAX / 8);",
          "13: ?>",
          "14: DONE",
          "15: --EXPECTF--",
          "16: Warning: imagetruecolortopalette(): Number of colors has to be greater than zero and no more than 2147483647 in %sbug72697.php on line %d",
          "17: DONE",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b6f13a5ef9d6280cf984826a5de012a32c396cd4",
      "candidate_info": {
        "commit_hash": "b6f13a5ef9d6280cf984826a5de012a32c396cd4",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/b6f13a5ef9d6280cf984826a5de012a32c396cd4",
        "files": [
          "ext/gd/gd.c",
          "ext/gd/tests/bug72697.phpt"
        ],
        "message": "Fix bug#72697 - select_colors write out-of-bounds",
        "before_after_code_files": [
          "ext/gd/gd.c||ext/gd/gd.c",
          "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/gd.c||ext/gd/gd.c",
            "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
          ],
          "candidate": [
            "ext/gd/gd.c||ext/gd/gd.c",
            "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/gd.c||ext/gd/gd.c": [
          "File: ext/gd/gd.c -> ext/gd/gd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "100: #include \"gd_ctx.c\"",
          "104: int overflow2(int a, int b);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1197:  REGISTER_LONG_CONSTANT(\"IMG_CROP_SIDES\", GD_CROP_SIDES, CONST_CS | CONST_PERSISTENT);",
          "1198:  REGISTER_LONG_CONSTANT(\"IMG_CROP_THRESHOLD\", GD_CROP_THRESHOLD, CONST_CS | CONST_PERSISTENT);",
          "1201:  REGISTER_LONG_CONSTANT(\"IMG_BELL\", GD_BELL, CONST_CS | CONST_PERSISTENT);",
          "1202:  REGISTER_LONG_CONSTANT(\"IMG_BESSEL\", GD_BESSEL, CONST_CS | CONST_PERSISTENT);",
          "1203:  REGISTER_LONG_CONSTANT(\"IMG_BILINEAR_FIXED\", GD_BILINEAR_FIXED, CONST_CS | CONST_PERSISTENT);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1652:  ZEND_FETCH_RESOURCE(im, gdImagePtr, &IM, -1, \"Image\", le_gd);",
          "1656:   RETURN_FALSE;",
          "1657:  }",
          "1660:  RETURN_TRUE;",
          "1661: }",
          "",
          "[Removed Lines]",
          "1654:  if (ncolors <= 0) {",
          "1655:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Number of colors has to be greater than zero\");",
          "1658:  gdImageTrueColorToPalette(im, dither, ncolors);",
          "",
          "[Added Lines]",
          "1654:  if (ncolors <= 0 || ncolors > INT_MAX) {",
          "1655:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Number of colors has to be greater than zero and no more than %d\", INT_MAX);",
          "1658:  gdImageTrueColorToPalette(im, dither, (int)ncolors);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "3908:  PHP_GD_CHECK_OPEN_BASEDIR(fontname, \"Invalid font filename\");",
          "3910: #ifdef HAVE_GD_FREETYPE",
          "3911:  if (extended) {",
          "3912:   error = gdImageStringFTEx(im, brect, col, fontname, ptsize, angle, x, y, str, &strex);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "4484:  int x, y;",
          "4485:  float x_ratio, y_ratio;",
          "4486:     long ignore_warning;",
          "4488:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"pplll\", &f_org, &f_org_len, &f_dest, &f_dest_len, &height, &width, &threshold) == FAILURE) {",
          "4489:   return;",
          "4490:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "5367:     php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing y position\");",
          "5368:     RETURN_FALSE;",
          "5369:    }",
          "5371:    if (type == GD_AFFINE_TRANSLATE) {",
          "5372:     res = gdAffineTranslate(affine, x, y);",
          "5373:    } else {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt": [
          "File: ext/gd/tests/bug72697.phpt -> ext/gd/tests/bug72697.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72697: select_colors write out-of-bounds",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!function_exists(\"imagecreatetruecolor\")) die(\"skip\");",
          "6: if (PHP_INT_MAX !== 9223372036854775807) die(\"skip for 64-bit long systems only\");",
          "7: ?>",
          "8: --FILE--",
          "9: <?php",
          "11: $img=imagecreatetruecolor(10, 10);",
          "12: imagetruecolortopalette($img, false, PHP_INT_MAX / 8);",
          "13: ?>",
          "14: DONE",
          "15: --EXPECTF--",
          "16: Warning: imagetruecolortopalette(): Number of colors has to be greater than zero and no more than 2147483647 in %sbug72697.php on line %d",
          "17: DONE",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a3598dd7c9b182debcb54b9322b1dece14c9b533",
      "candidate_info": {
        "commit_hash": "a3598dd7c9b182debcb54b9322b1dece14c9b533",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/a3598dd7c9b182debcb54b9322b1dece14c9b533",
        "files": [
          "ext/gd/gd.c",
          "ext/gd/tests/bug72697.phpt"
        ],
        "message": "Fix bug#72697 - select_colors write out-of-bounds",
        "before_after_code_files": [
          "ext/gd/gd.c||ext/gd/gd.c",
          "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/gd.c||ext/gd/gd.c",
            "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
          ],
          "candidate": [
            "ext/gd/gd.c||ext/gd/gd.c",
            "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/gd.c||ext/gd/gd.c": [
          "File: ext/gd/gd.c -> ext/gd/gd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1659:  ZEND_FETCH_RESOURCE(im, gdImagePtr, &IM, -1, \"Image\", le_gd);",
          "1663:   RETURN_FALSE;",
          "1664:  }",
          "1667:  RETURN_TRUE;",
          "1668: }",
          "",
          "[Removed Lines]",
          "1661:  if (ncolors <= 0) {",
          "1662:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Number of colors has to be greater than zero\");",
          "1665:  gdImageTrueColorToPalette(im, dither, ncolors);",
          "",
          "[Added Lines]",
          "1661:  if (ncolors <= 0 || ncolors > INT_MAX) {",
          "1662:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Number of colors has to be greater than zero and no more than %d\", INT_MAX);",
          "1665:  gdImageTrueColorToPalette(im, dither, (int)ncolors);",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt": [
          "File: ext/gd/tests/bug72697.phpt -> ext/gd/tests/bug72697.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72697: select_colors write out-of-bounds",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!function_exists(\"imagecreatetruecolor\")) die(\"skip\");",
          "6: if (PHP_INT_MAX !== 9223372036854775807) die(\"skip for 64-bit long systems only\");",
          "7: ?>",
          "8: --FILE--",
          "9: <?php",
          "11: $img=imagecreatetruecolor(10, 10);",
          "12: imagetruecolortopalette($img, false, PHP_INT_MAX / 8);",
          "13: ?>",
          "14: DONE",
          "15: --EXPECTF--",
          "16: Warning: imagetruecolortopalette(): Number of colors has to be greater than zero and no more than 2147483647 in %sbug72697.php on line %d",
          "17: DONE",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4d76676101f8814520ea988e42b3bda54eb9e255",
      "candidate_info": {
        "commit_hash": "4d76676101f8814520ea988e42b3bda54eb9e255",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/4d76676101f8814520ea988e42b3bda54eb9e255",
        "files": [
          "ext/gd/gd.c",
          "ext/gd/tests/bug72697.phpt"
        ],
        "message": "Fix bug#72697 - select_colors write out-of-bounds",
        "before_after_code_files": [
          "ext/gd/gd.c||ext/gd/gd.c",
          "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/gd.c||ext/gd/gd.c",
            "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
          ],
          "candidate": [
            "ext/gd/gd.c||ext/gd/gd.c",
            "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/gd.c||ext/gd/gd.c": [
          "File: ext/gd/gd.c -> ext/gd/gd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1659:  ZEND_FETCH_RESOURCE(im, gdImagePtr, &IM, -1, \"Image\", le_gd);",
          "1663:   RETURN_FALSE;",
          "1664:  }",
          "1667:  RETURN_TRUE;",
          "1668: }",
          "",
          "[Removed Lines]",
          "1661:  if (ncolors <= 0) {",
          "1662:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Number of colors has to be greater than zero\");",
          "1665:  gdImageTrueColorToPalette(im, dither, ncolors);",
          "",
          "[Added Lines]",
          "1661:  if (ncolors <= 0 || ncolors > INT_MAX) {",
          "1662:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Number of colors has to be greater than zero and no more than %d\", INT_MAX);",
          "1665:  gdImageTrueColorToPalette(im, dither, (int)ncolors);",
          "",
          "---------------"
        ],
        "ext/gd/tests/bug72697.phpt||ext/gd/tests/bug72697.phpt": [
          "File: ext/gd/tests/bug72697.phpt -> ext/gd/tests/bug72697.phpt",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: --TEST--",
          "2: Bug #72697: select_colors write out-of-bounds",
          "3: --SKIPIF--",
          "4: <?php",
          "5: if (!function_exists(\"imagecreatetruecolor\")) die(\"skip\");",
          "6: if (PHP_INT_MAX !== 9223372036854775807) die(\"skip for 64-bit long systems only\");",
          "7: ?>",
          "8: --FILE--",
          "9: <?php",
          "11: $img=imagecreatetruecolor(10, 10);",
          "12: imagetruecolortopalette($img, false, PHP_INT_MAX / 8);",
          "13: ?>",
          "14: DONE",
          "15: --EXPECTF--",
          "16: Warning: imagetruecolortopalette(): Number of colors has to be greater than zero and no more than 2147483647 in %sbug72697.php on line %d",
          "17: DONE",
          "",
          "---------------"
        ]
      }
    }
  ]
}