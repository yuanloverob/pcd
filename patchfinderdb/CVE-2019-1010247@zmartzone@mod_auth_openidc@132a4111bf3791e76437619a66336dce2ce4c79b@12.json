{
  "cve_id": "CVE-2019-1010247",
  "cve_desc": "ZmartZone IAM mod_auth_openidc 2.3.10.1 and earlier is affected by: Cross Site Scripting (XSS). The impact is: Redirecting the user to a phishing page or interacting with the application on behalf of the user. The component is: File: src/mod_auth_openidc.c, Line: 3109. The fixed version is: 2.3.10.2.",
  "repo": "zmartzone/mod_auth_openidc",
  "patch_hash": "132a4111bf3791e76437619a66336dce2ce4c79b",
  "patch_info": {
    "commit_hash": "132a4111bf3791e76437619a66336dce2ce4c79b",
    "repo": "zmartzone/mod_auth_openidc",
    "commit_url": "https://github.com/zmartzone/mod_auth_openidc/commit/132a4111bf3791e76437619a66336dce2ce4c79b",
    "files": [
      "ChangeLog",
      "configure.ac",
      "src/mod_auth_openidc.c"
    ],
    "message": "release 2.3.10.2: fix XSS vulnerability for poll parameter\n\nin OIDC Session Management RP iframe; CSNC-2019-001; thanks Mischa\nBachmann\n\nSigned-off-by: Hans Zandbelt <hans.zandbelt@zmartzone.eu>",
    "before_after_code_files": [
      "configure.ac||configure.ac",
      "src/mod_auth_openidc.c||src/mod_auth_openidc.c"
    ]
  },
  "patch_diff": {
    "configure.ac||configure.ac": [
      "File: configure.ac -> configure.ac",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: AC_SUBST(NAMEVER, AC_PACKAGE_TARNAME()-AC_PACKAGE_VERSION())",
      "",
      "[Removed Lines]",
      "1: AC_INIT([mod_auth_openidc],[2.3.10.1],[hans.zandbelt@zmartzone.eu])",
      "",
      "[Added Lines]",
      "1: AC_INIT([mod_auth_openidc],[2.3.10.2],[hans.zandbelt@zmartzone.eu])",
      "",
      "---------------"
    ],
    "src/mod_auth_openidc.c||src/mod_auth_openidc.c": [
      "File: src/mod_auth_openidc.c -> src/mod_auth_openidc.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "3106:    \"\\n\"",
      "3107:    \"      function setTimer() {\\n\"",
      "3108:    \"        checkSession();\\n\"",
      "3110:    \"      }\\n\"",
      "3111:    \"\\n\"",
      "3112:    \"      function receiveMessage(e) {\\n\"",
      "",
      "[Removed Lines]",
      "3109:    \"        timerID = setInterval('checkSession()', %s);\\n\"",
      "",
      "[Added Lines]",
      "3109:    \"        timerID = setInterval('checkSession()', %d);\\n\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3150:  char *s_poll_interval = NULL;",
      "3151:  oidc_util_get_request_parameter(r, \"poll\", &s_poll_interval);",
      "3155:  const char *redirect_uri = oidc_get_redirect_uri(r, c);",
      "3156:  java_script = apr_psprintf(r->pool, java_script, origin, client_id,",
      "3158:    redirect_uri);",
      "3160:  return oidc_util_html_send(r, NULL, java_script, \"setTimer\", NULL, DONE);",
      "",
      "[Removed Lines]",
      "3152:  if (s_poll_interval == NULL)",
      "3153:   s_poll_interval = \"3000\";",
      "3157:    session_state, op_iframe_id, s_poll_interval, redirect_uri,",
      "",
      "[Added Lines]",
      "3152:  int poll_interval = s_poll_interval ? strtol(s_poll_interval, NULL, 10) : 0;",
      "3153:  if ((poll_interval <= 0) || (poll_interval > 3600 * 24))",
      "3154:   poll_interval = 3000;",
      "3158:    session_state, op_iframe_id, poll_interval, redirect_uri,",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "43e182d85aa959a29ffb1b1330ee39c59d8c3a8e",
      "candidate_info": {
        "commit_hash": "43e182d85aa959a29ffb1b1330ee39c59d8c3a8e",
        "repo": "zmartzone/mod_auth_openidc",
        "commit_url": "https://github.com/zmartzone/mod_auth_openidc/commit/43e182d85aa959a29ffb1b1330ee39c59d8c3a8e",
        "files": [
          "ChangeLog",
          "configure.ac",
          "src/mod_auth_openidc.c"
        ],
        "message": "return 200 OK for backchannel logout if session not found\n\nbump to 2.4.1rc1\n\nSigned-off-by: Hans Zandbelt <hans.zandbelt@zmartzone.eu>",
        "before_after_code_files": [
          "configure.ac||configure.ac",
          "src/mod_auth_openidc.c||src/mod_auth_openidc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "configure.ac||configure.ac",
            "src/mod_auth_openidc.c||src/mod_auth_openidc.c"
          ],
          "candidate": [
            "configure.ac||configure.ac",
            "src/mod_auth_openidc.c||src/mod_auth_openidc.c"
          ]
        }
      },
      "candidate_diff": {
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: AC_SUBST(NAMEVER, AC_PACKAGE_TARNAME()-AC_PACKAGE_VERSION())",
          "",
          "[Removed Lines]",
          "1: AC_INIT([mod_auth_openidc],[2.4.1rc0],[hans.zandbelt@zmartzone.eu])",
          "",
          "[Added Lines]",
          "1: AC_INIT([mod_auth_openidc],[2.4.1rc1],[hans.zandbelt@zmartzone.eu])",
          "",
          "---------------"
        ],
        "src/mod_auth_openidc.c||src/mod_auth_openidc.c": [
          "File: src/mod_auth_openidc.c -> src/mod_auth_openidc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2993:   oidc_error(r,",
          "2994:     \"could not find session based on sid/sub provided in logout token: %s\",",
          "2995:     sid);",
          "2996:   goto out;",
          "2997:  }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2998:   rc = DONE;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3ed326648d2584c25983bcfa3a7821cf3b40c8f6",
      "candidate_info": {
        "commit_hash": "3ed326648d2584c25983bcfa3a7821cf3b40c8f6",
        "repo": "zmartzone/mod_auth_openidc",
        "commit_url": "https://github.com/zmartzone/mod_auth_openidc/commit/3ed326648d2584c25983bcfa3a7821cf3b40c8f6",
        "files": [
          "ChangeLog",
          "configure.ac",
          "src/config.c",
          "src/mod_auth_openidc.c",
          "src/mod_auth_openidc.h"
        ],
        "message": "remove option to skip scrubbing request headers\n\n- thus avoiding potentionally insecure setups\n- bump to 2.4.0rc3\n\nSigned-off-by: Hans Zandbelt <hans.zandbelt@zmartzone.eu>",
        "before_after_code_files": [
          "configure.ac||configure.ac",
          "src/config.c||src/config.c",
          "src/mod_auth_openidc.c||src/mod_auth_openidc.c",
          "src/mod_auth_openidc.h||src/mod_auth_openidc.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "configure.ac||configure.ac",
            "src/mod_auth_openidc.c||src/mod_auth_openidc.c"
          ],
          "candidate": [
            "configure.ac||configure.ac",
            "src/mod_auth_openidc.c||src/mod_auth_openidc.c"
          ]
        }
      },
      "candidate_diff": {
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: AC_SUBST(NAMEVER, AC_PACKAGE_TARNAME()-AC_PACKAGE_VERSION())",
          "",
          "[Removed Lines]",
          "1: AC_INIT([mod_auth_openidc],[2.4.0rc2],[hans.zandbelt@zmartzone.eu])",
          "",
          "[Added Lines]",
          "1: AC_INIT([mod_auth_openidc],[2.4.0rc3],[hans.zandbelt@zmartzone.eu])",
          "",
          "---------------"
        ],
        "src/config.c||src/config.c": [
          "File: src/config.c -> src/config.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "90: #define OIDC_DEFAULT_COOKIE \"mod_auth_openidc_session\"",
          "92: #define OIDC_DEFAULT_AUTHN_HEADER NULL",
          "96: #define OIDC_DEFAULT_CLIENT_NAME \"OpenID Connect Apache Module (mod_auth_openidc)\"",
          "",
          "[Removed Lines]",
          "94: #define OIDC_DEFAULT_SCRUB_REQUEST_HEADERS 1",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1191:  c->outgoing_proxy = NULL;",
          "1192:  c->crypto_passphrase = NULL;",
          "1195:  c->error_template = NULL;",
          "1197:  c->provider.userinfo_refresh_interval =",
          "",
          "[Removed Lines]",
          "1194:  c->scrub_request_headers = OIDC_DEFAULT_SCRUB_REQUEST_HEADERS;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1619:    add->crypto_passphrase != NULL ?",
          "1620:      add->crypto_passphrase : base->crypto_passphrase;",
          "1626:  c->error_template =",
          "1627:    add->error_template != NULL ?",
          "1628:      add->error_template : base->error_template;",
          "",
          "[Removed Lines]",
          "1622:  c->scrub_request_headers =",
          "1623:    add->scrub_request_headers != OIDC_DEFAULT_SCRUB_REQUEST_HEADERS ?",
          "1624:      add->scrub_request_headers : base->scrub_request_headers;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2768:     (void*)APR_OFFSETOF(oidc_cfg, session_cookie_chunk_size),",
          "2769:     RSRC_CONF,",
          "2770:     \"Chunk size for client-cookie session storage type in bytes. Defaults to 4k. Set 0 to suppress chunking.\"),",
          "2777:   AP_INIT_TAKE1(OIDCCacheType,",
          "2778:     oidc_set_cache_type,",
          "",
          "[Removed Lines]",
          "2771:   AP_INIT_FLAG(OIDCScrubRequestHeaders,",
          "2772:     oidc_set_flag_slot,",
          "2773:     (void *) APR_OFFSETOF(oidc_cfg, scrub_request_headers),",
          "2774:     RSRC_CONF,",
          "2775:     \"Scrub user name and claim headers from the user's request.\"),",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/mod_auth_openidc.c||src/mod_auth_openidc.c": [
          "File: src/mod_auth_openidc.c -> src/mod_auth_openidc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "140:  oidc_cfg *cfg = ap_get_module_config(r->server->module_config,",
          "141:    &auth_openidc_module);",
          "174:  }",
          "175: }",
          "",
          "[Removed Lines]",
          "143:  if (cfg->scrub_request_headers != 0) {",
          "145:   const char *prefix = oidc_cfg_claim_prefix(r);",
          "146:   apr_hash_t *hdrs = apr_hash_make(r->pool);",
          "148:   if (apr_strnatcmp(prefix, \"\") == 0) {",
          "149:    if ((cfg->white_listed_claims != NULL)",
          "150:      && (apr_hash_count(cfg->white_listed_claims) > 0))",
          "151:     hdrs = apr_hash_overlay(r->pool, cfg->white_listed_claims,",
          "152:       hdrs);",
          "153:    else",
          "154:     oidc_warn(r,",
          "155:       \"both \" OIDCClaimPrefix \" and \" OIDCWhiteListedClaims \" are empty: this renders an insecure setup!\");",
          "156:   }",
          "158:   char *authn_hdr = oidc_cfg_dir_authn_header(r);",
          "159:   if (authn_hdr != NULL)",
          "160:    apr_hash_set(hdrs, authn_hdr, APR_HASH_KEY_STRING, authn_hdr);",
          "165:   oidc_scrub_request_headers(r, OIDC_DEFAULT_HEADER_PREFIX, hdrs);",
          "171:   if ((strstr(prefix, OIDC_DEFAULT_HEADER_PREFIX) != prefix)) {",
          "172:    oidc_scrub_request_headers(r, prefix, NULL);",
          "173:   }",
          "",
          "[Added Lines]",
          "143:  const char *prefix = oidc_cfg_claim_prefix(r);",
          "144:  apr_hash_t *hdrs = apr_hash_make(r->pool);",
          "146:  if (apr_strnatcmp(prefix, \"\") == 0) {",
          "147:   if ((cfg->white_listed_claims != NULL)",
          "148:     && (apr_hash_count(cfg->white_listed_claims) > 0))",
          "149:    hdrs = apr_hash_overlay(r->pool, cfg->white_listed_claims,",
          "150:      hdrs);",
          "151:   else",
          "152:    oidc_warn(r,",
          "153:      \"both \" OIDCClaimPrefix \" and \" OIDCWhiteListedClaims \" are empty: this renders an insecure setup!\");",
          "154:  }",
          "156:  char *authn_hdr = oidc_cfg_dir_authn_header(r);",
          "157:  if (authn_hdr != NULL)",
          "158:   apr_hash_set(hdrs, authn_hdr, APR_HASH_KEY_STRING, authn_hdr);",
          "163:  oidc_scrub_request_headers(r, OIDC_DEFAULT_HEADER_PREFIX, hdrs);",
          "169:  if ((strstr(prefix, OIDC_DEFAULT_HEADER_PREFIX) != prefix)) {",
          "170:   oidc_scrub_request_headers(r, prefix, NULL);",
          "",
          "---------------"
        ],
        "src/mod_auth_openidc.h||src/mod_auth_openidc.h": [
          "File: src/mod_auth_openidc.h -> src/mod_auth_openidc.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "382: #endif",
          "383:  int cache_encrypt;",
          "388:  int http_timeout_long;",
          "389:  int http_timeout_short;",
          "390:  int state_timeout;",
          "",
          "[Removed Lines]",
          "386:  int scrub_request_headers;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ad05a24541ab937f47eb574b2de161fceb3060fd",
      "candidate_info": {
        "commit_hash": "ad05a24541ab937f47eb574b2de161fceb3060fd",
        "repo": "zmartzone/mod_auth_openidc",
        "commit_url": "https://github.com/zmartzone/mod_auth_openidc/commit/ad05a24541ab937f47eb574b2de161fceb3060fd",
        "files": [
          "ChangeLog",
          "README.md",
          "auth_openidc.conf",
          "configure.ac",
          "src/config.c"
        ],
        "message": "deprecate the OAuth 2.0 Resource Server functionality\n\nbump to 2.4.0rc0\n\nSigned-off-by: Hans Zandbelt <hans.zandbelt@zmartzone.eu>",
        "before_after_code_files": [
          "auth_openidc.conf||auth_openidc.conf",
          "configure.ac||configure.ac",
          "src/config.c||src/config.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "configure.ac||configure.ac"
          ],
          "candidate": [
            "configure.ac||configure.ac"
          ]
        }
      },
      "candidate_diff": {
        "auth_openidc.conf||auth_openidc.conf": [
          "File: auth_openidc.conf -> auth_openidc.conf",
          "--- Hunk 1 ---",
          "[Context before]",
          "275: ########################################################################################",
          "276: #",
          "277: # OAuth 2.0 Resource Server Settings",
          "278: #",
          "279: # Used when this module functions as a Resource Server against an OAuth 2.0 Authorization",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "277: # WARNING:",
          "278: #",
          "279: # THE OAUTH 2.0 RESOURCE SERVER FUNCTIONALITY IS DEPRECATED NOW AND SUPERSEDED",
          "280: # BY A SEPARATE MODULE, SEE: https://github.com/zmartzone/mod_oauth2",
          "281: #",
          "",
          "---------------"
        ],
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: AC_SUBST(NAMEVER, AC_PACKAGE_TARNAME()-AC_PACKAGE_VERSION())",
          "",
          "[Removed Lines]",
          "1: AC_INIT([mod_auth_openidc],[2.3.11],[hans.zandbelt@zmartzone.eu])",
          "",
          "[Added Lines]",
          "1: AC_INIT([mod_auth_openidc],[2.4.0rc0],[hans.zandbelt@zmartzone.eu])",
          "",
          "---------------"
        ],
        "src/config.c||src/config.c": [
          "File: src/config.c -> src/config.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2006:  apr_uri_t r_uri;",
          "2008:  if (c->oauth.metadata_url != NULL) {",
          "2009:   apr_uri_parse(s->process->pconf, c->oauth.metadata_url, &r_uri);",
          "2010:   if ((r_uri.scheme == NULL)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2008:  oidc_swarn(s, \"The OAuth 2.0 Resource Server functionality is deprecated and superseded by a new module, see: https://github.com/zmartzone/mod_oauth2!\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ce37080c6aea30aabae8b4a9b4eea7808445cc8e",
      "candidate_info": {
        "commit_hash": "ce37080c6aea30aabae8b4a9b4eea7808445cc8e",
        "repo": "zmartzone/mod_auth_openidc",
        "commit_url": "https://github.com/zmartzone/mod_auth_openidc/commit/ce37080c6aea30aabae8b4a9b4eea7808445cc8e",
        "files": [
          "ChangeLog",
          "configure.ac",
          "src/mod_auth_openidc.c"
        ],
        "message": "2.4.0.2 oops\n\nSigned-off-by: Hans Zandbelt <hans.zandbelt@zmartzone.eu>",
        "before_after_code_files": [
          "configure.ac||configure.ac",
          "src/mod_auth_openidc.c||src/mod_auth_openidc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "configure.ac||configure.ac",
            "src/mod_auth_openidc.c||src/mod_auth_openidc.c"
          ],
          "candidate": [
            "configure.ac||configure.ac",
            "src/mod_auth_openidc.c||src/mod_auth_openidc.c"
          ]
        }
      },
      "candidate_diff": {
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: AC_SUBST(NAMEVER, AC_PACKAGE_TARNAME()-AC_PACKAGE_VERSION())",
          "",
          "[Removed Lines]",
          "1: AC_INIT([mod_auth_openidc],[2.4.0.1],[hans.zandbelt@zmartzone.eu])",
          "",
          "[Added Lines]",
          "1: AC_INIT([mod_auth_openidc],[2.4.0.2],[hans.zandbelt@zmartzone.eu])",
          "",
          "---------------"
        ],
        "src/mod_auth_openidc.c||src/mod_auth_openidc.c": [
          "File: src/mod_auth_openidc.c -> src/mod_auth_openidc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3047:       apr_uri_unparse(r->pool, &uri, 0), c_host);",
          "3048:   oidc_error(r, \"%s: %s\", *err_str, *err_desc);",
          "3049:   return FALSE;",
          "3053:     apr_psprintf(r->pool,",
          "",
          "[Removed Lines]",
          "3050:  } else if (strstr(url, \"/\") != url) {",
          "",
          "[Added Lines]",
          "3050:  } else if ((uri.hostname == NULL) && (strstr(url, \"/\") != url)) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9c8887a8d312ef81c288617ffaee7fffbbb76c89",
      "candidate_info": {
        "commit_hash": "9c8887a8d312ef81c288617ffaee7fffbbb76c89",
        "repo": "zmartzone/mod_auth_openidc",
        "commit_url": "https://github.com/zmartzone/mod_auth_openidc/commit/9c8887a8d312ef81c288617ffaee7fffbbb76c89",
        "files": [
          "ChangeLog",
          "configure.ac"
        ],
        "message": "release 2.3.11\n\nSigned-off-by: Hans Zandbelt <hans.zandbelt@zmartzone.eu>",
        "before_after_code_files": [
          "configure.ac||configure.ac"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "configure.ac||configure.ac"
          ],
          "candidate": [
            "configure.ac||configure.ac"
          ]
        }
      },
      "candidate_diff": {
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: AC_SUBST(NAMEVER, AC_PACKAGE_TARNAME()-AC_PACKAGE_VERSION())",
          "",
          "[Removed Lines]",
          "1: AC_INIT([mod_auth_openidc],[2.3.11rc2],[hans.zandbelt@zmartzone.eu])",
          "",
          "[Added Lines]",
          "1: AC_INIT([mod_auth_openidc],[2.3.11],[hans.zandbelt@zmartzone.eu])",
          "",
          "---------------"
        ]
      }
    }
  ]
}