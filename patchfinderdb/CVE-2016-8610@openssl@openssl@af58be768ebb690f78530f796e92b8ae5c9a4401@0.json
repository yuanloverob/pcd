{
  "cve_id": "CVE-2016-8610",
  "cve_desc": "A denial of service flaw was found in OpenSSL 0.9.8, 1.0.1, 1.0.2 through 1.0.2h, and 1.1.0 in the way the TLS/SSL protocol defined processing of ALERT packets during a connection handshake. A remote attacker could use this flaw to make a TLS/SSL server consume an excessive amount of CPU and fail to accept connections from other clients.",
  "repo": "openssl/openssl",
  "patch_hash": "af58be768ebb690f78530f796e92b8ae5c9a4401",
  "patch_info": {
    "commit_hash": "af58be768ebb690f78530f796e92b8ae5c9a4401",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/af58be768ebb690f78530f796e92b8ae5c9a4401",
    "files": [
      "include/openssl/ssl.h",
      "ssl/record/rec_layer_d1.c",
      "ssl/record/rec_layer_s3.c",
      "ssl/record/record.h",
      "ssl/record/record_locl.h",
      "ssl/ssl_err.c"
    ],
    "message": "Don't allow too many consecutive warning alerts\n\nCertain warning alerts are ignored if they are received. This can mean that\nno progress will be made if one peer continually sends those warning alerts.\nImplement a count so that we abort the connection if we receive too many.\n\nIssue reported by Shi Lei.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "include/openssl/ssl.h||include/openssl/ssl.h",
      "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c",
      "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
      "ssl/record/record.h||ssl/record/record.h",
      "ssl/record/record_locl.h||ssl/record/record_locl.h",
      "ssl/ssl_err.c||ssl/ssl_err.c"
    ]
  },
  "patch_diff": {
    "include/openssl/ssl.h||include/openssl/ssl.h": [
      "File: include/openssl/ssl.h -> include/openssl/ssl.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "2485: # define SSL_R_TLS_HEARTBEAT_PENDING                      366",
      "2486: # define SSL_R_TLS_ILLEGAL_EXPORTER_LABEL                 367",
      "2487: # define SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST             157",
      "2488: # define SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS             314",
      "2489: # define SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS       239",
      "2490: # define SSL_R_UNABLE_TO_LOAD_SSL3_MD5_ROUTINES           242",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2488: # define SSL_R_TOO_MANY_WARN_ALERTS                       409",
      "",
      "---------------"
    ],
    "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c": [
      "File: ssl/record/rec_layer_d1.c -> ssl/record/rec_layer_d1.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "443:         }",
      "444:     }",
      "448:     if (s->s3->change_cipher_spec /* set when we receive ChangeCipherSpec,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "450:     if (SSL3_RECORD_get_type(rr) != SSL3_RT_ALERT",
      "451:             && SSL3_RECORD_get_length(rr) != 0)",
      "452:         s->rlayer.alert_count = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "723:         if (alert_level == SSL3_AL_WARNING) {",
      "724:             s->s3->warn_alert = alert_descr;",
      "725:             if (alert_descr == SSL_AD_CLOSE_NOTIFY) {",
      "726: #ifndef OPENSSL_NO_SCTP",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "734:             s->rlayer.alert_count++;",
      "735:             if (s->rlayer.alert_count == MAX_WARN_ALERT_COUNT) {",
      "736:                 al = SSL_AD_UNEXPECTED_MESSAGE;",
      "737:                 SSLerr(SSL_F_DTLS1_READ_BYTES, SSL_R_TOO_MANY_WARN_ALERTS);",
      "738:                 goto f_err;",
      "739:             }",
      "",
      "---------------"
    ],
    "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c": [
      "File: ssl/record/rec_layer_s3.c -> ssl/record/rec_layer_s3.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1063:     } while (num_recs == 0);",
      "1064:     rr = &rr[curr_rec];",
      "1068:     if (s->s3->change_cipher_spec /* set when we receive ChangeCipherSpec,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1070:     if (SSL3_RECORD_get_type(rr) != SSL3_RT_ALERT",
      "1071:             && SSL3_RECORD_get_length(rr) != 0)",
      "1072:         s->rlayer.alert_count = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1333:         if (alert_level == SSL3_AL_WARNING) {",
      "1334:             s->s3->warn_alert = alert_descr;",
      "1335:             SSL3_RECORD_set_read(rr);",
      "1336:             if (alert_descr == SSL_AD_CLOSE_NOTIFY) {",
      "1337:                 s->shutdown |= SSL_RECEIVED_SHUTDOWN;",
      "1338:                 return (0);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1345:             s->rlayer.alert_count++;",
      "1346:             if (s->rlayer.alert_count == MAX_WARN_ALERT_COUNT) {",
      "1347:                 al = SSL_AD_UNEXPECTED_MESSAGE;",
      "1348:                 SSLerr(SSL_F_SSL3_READ_BYTES, SSL_R_TOO_MANY_WARN_ALERTS);",
      "1349:                 goto f_err;",
      "1350:             }",
      "",
      "---------------"
    ],
    "ssl/record/record.h||ssl/record/record.h": [
      "File: ssl/record/record.h -> ssl/record/record.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "178:     unsigned char write_sequence[SEQ_NUM_SIZE];",
      "180:     unsigned int is_first_record;",
      "181:     DTLS_RECORD_LAYER *d;",
      "182: } RECORD_LAYER;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "182:     unsigned int alert_count;",
      "",
      "---------------"
    ],
    "ssl/record/record_locl.h||ssl/record/record_locl.h": [
      "File: ssl/record/record_locl.h -> ssl/record/record_locl.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "19: #define RECORD_LAYER_get_rbuf(rl)               (&(rl)->rbuf)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "17: #define MAX_WARN_ALERT_COUNT    5",
      "",
      "---------------"
    ],
    "ssl/ssl_err.c||ssl/ssl_err.c": [
      "File: ssl/ssl_err.c -> ssl/ssl_err.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "617:      \"tls illegal exporter label\"},",
      "618:     {ERR_REASON(SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST),",
      "619:      \"tls invalid ecpointformat list\"},",
      "620:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS),",
      "621:      \"unable to find ecdh parameters\"},",
      "622:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS),",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "620:     {ERR_REASON(SSL_R_TOO_MANY_WARN_ALERTS), \"too many warn alerts\"},",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6915f39e68f02ad08a635516d46e72bbf0379914",
      "candidate_info": {
        "commit_hash": "6915f39e68f02ad08a635516d46e72bbf0379914",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/6915f39e68f02ad08a635516d46e72bbf0379914",
        "files": [
          "include/openssl/ssl.h",
          "ssl/record/rec_layer_d1.c",
          "ssl/record/rec_layer_s3.c",
          "ssl/record/record.h",
          "ssl/record/record_locl.h",
          "ssl/ssl_err.c"
        ],
        "message": "Don't allow too many consecutive warning alerts\n\nCertain warning alerts are ignored if they are received. This can mean that\nno progress will be made if one peer continually sends those warning alerts.\nImplement a count so that we abort the connection if we receive too many.\n\nIssue reported by Shi Lei.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit af58be768ebb690f78530f796e92b8ae5c9a4401)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c",
          "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
          "ssl/record/record.h||ssl/record/record.h",
          "ssl/record/record_locl.h||ssl/record/record_locl.h",
          "ssl/ssl_err.c||ssl/ssl_err.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c",
            "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
            "ssl/record/record.h||ssl/record/record.h",
            "ssl/record/record_locl.h||ssl/record/record_locl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c",
            "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
            "ssl/record/record.h||ssl/record/record.h",
            "ssl/record/record_locl.h||ssl/record/record_locl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2482: # define SSL_R_TLS_HEARTBEAT_PENDING                      366",
          "2483: # define SSL_R_TLS_ILLEGAL_EXPORTER_LABEL                 367",
          "2484: # define SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST             157",
          "2485: # define SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS             314",
          "2486: # define SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS       239",
          "2487: # define SSL_R_UNABLE_TO_LOAD_SSL3_MD5_ROUTINES           242",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2485: # define SSL_R_TOO_MANY_WARN_ALERTS                       409",
          "",
          "---------------"
        ],
        "ssl/record/rec_layer_d1.c||ssl/record/rec_layer_d1.c": [
          "File: ssl/record/rec_layer_d1.c -> ssl/record/rec_layer_d1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "443:         }",
          "444:     }",
          "448:     if (s->s3->change_cipher_spec /* set when we receive ChangeCipherSpec,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "450:     if (SSL3_RECORD_get_type(rr) != SSL3_RT_ALERT",
          "451:             && SSL3_RECORD_get_length(rr) != 0)",
          "452:         s->rlayer.alert_count = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "723:         if (alert_level == SSL3_AL_WARNING) {",
          "724:             s->s3->warn_alert = alert_descr;",
          "725:             if (alert_descr == SSL_AD_CLOSE_NOTIFY) {",
          "726: #ifndef OPENSSL_NO_SCTP",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "734:             s->rlayer.alert_count++;",
          "735:             if (s->rlayer.alert_count == MAX_WARN_ALERT_COUNT) {",
          "736:                 al = SSL_AD_UNEXPECTED_MESSAGE;",
          "737:                 SSLerr(SSL_F_DTLS1_READ_BYTES, SSL_R_TOO_MANY_WARN_ALERTS);",
          "738:                 goto f_err;",
          "739:             }",
          "",
          "---------------"
        ],
        "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c": [
          "File: ssl/record/rec_layer_s3.c -> ssl/record/rec_layer_s3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1063:     } while (num_recs == 0);",
          "1064:     rr = &rr[curr_rec];",
          "1068:     if (s->s3->change_cipher_spec /* set when we receive ChangeCipherSpec,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1070:     if (SSL3_RECORD_get_type(rr) != SSL3_RT_ALERT",
          "1071:             && SSL3_RECORD_get_length(rr) != 0)",
          "1072:         s->rlayer.alert_count = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1333:         if (alert_level == SSL3_AL_WARNING) {",
          "1334:             s->s3->warn_alert = alert_descr;",
          "1335:             SSL3_RECORD_set_read(rr);",
          "1336:             if (alert_descr == SSL_AD_CLOSE_NOTIFY) {",
          "1337:                 s->shutdown |= SSL_RECEIVED_SHUTDOWN;",
          "1338:                 return (0);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1345:             s->rlayer.alert_count++;",
          "1346:             if (s->rlayer.alert_count == MAX_WARN_ALERT_COUNT) {",
          "1347:                 al = SSL_AD_UNEXPECTED_MESSAGE;",
          "1348:                 SSLerr(SSL_F_SSL3_READ_BYTES, SSL_R_TOO_MANY_WARN_ALERTS);",
          "1349:                 goto f_err;",
          "1350:             }",
          "",
          "---------------"
        ],
        "ssl/record/record.h||ssl/record/record.h": [
          "File: ssl/record/record.h -> ssl/record/record.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "178:     unsigned char write_sequence[SEQ_NUM_SIZE];",
          "180:     unsigned int is_first_record;",
          "181:     DTLS_RECORD_LAYER *d;",
          "182: } RECORD_LAYER;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "182:     unsigned int alert_count;",
          "",
          "---------------"
        ],
        "ssl/record/record_locl.h||ssl/record/record_locl.h": [
          "File: ssl/record/record_locl.h -> ssl/record/record_locl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: #define RECORD_LAYER_get_rbuf(rl)               (&(rl)->rbuf)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "17: #define MAX_WARN_ALERT_COUNT    5",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "614:      \"tls illegal exporter label\"},",
          "615:     {ERR_REASON(SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST),",
          "616:      \"tls invalid ecpointformat list\"},",
          "617:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS),",
          "618:      \"unable to find ecdh parameters\"},",
          "619:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "617:     {ERR_REASON(SSL_R_TOO_MANY_WARN_ALERTS), \"too many warn alerts\"},",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d7c42d71ba407a4b3c26ed58263ae225976bbac3",
      "candidate_info": {
        "commit_hash": "d7c42d71ba407a4b3c26ed58263ae225976bbac3",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/d7c42d71ba407a4b3c26ed58263ae225976bbac3",
        "files": [
          "include/openssl/ssl.h",
          "ssl/ssl_err.c",
          "ssl/t1_lib.c"
        ],
        "message": "Add processing of the key_share received in the ServerHello\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/t1_lib.c||ssl/t1_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2313: # define SSL_R_BAD_ECPOINT                                306",
          "2314: # define SSL_R_BAD_HANDSHAKE_LENGTH                       332",
          "2315: # define SSL_R_BAD_HELLO_REQUEST                          105",
          "2316: # define SSL_R_BAD_LENGTH                                 271",
          "2317: # define SSL_R_BAD_PACKET_LENGTH                          115",
          "2318: # define SSL_R_BAD_PROTOCOL_VERSION_NUMBER                116",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2316: # define SSL_R_BAD_KEY_SHARE                              108",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "342:     {ERR_REASON(SSL_R_BAD_ECPOINT), \"bad ecpoint\"},",
          "343:     {ERR_REASON(SSL_R_BAD_HANDSHAKE_LENGTH), \"bad handshake length\"},",
          "344:     {ERR_REASON(SSL_R_BAD_HELLO_REQUEST), \"bad hello request\"},",
          "345:     {ERR_REASON(SSL_R_BAD_LENGTH), \"bad length\"},",
          "346:     {ERR_REASON(SSL_R_BAD_PACKET_LENGTH), \"bad packet length\"},",
          "347:     {ERR_REASON(SSL_R_BAD_PROTOCOL_VERSION_NUMBER),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "345:     {ERR_REASON(SSL_R_BAD_KEY_SHARE), \"bad key share\"},",
          "",
          "---------------"
        ],
        "ssl/t1_lib.c||ssl/t1_lib.c": [
          "File: ssl/t1_lib.c -> ssl/t1_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2637:             s->s3->flags |= TLS1_FLAGS_RECEIVED_EXTMS;",
          "2638:             if (!s->hit)",
          "2639:                 s->session->flags |= SSL_SESS_FLAG_EXTMS;",
          "2646:             return 0;",
          "2647:     }",
          "",
          "[Removed Lines]",
          "2640:         }",
          "2645:         else if (custom_ext_parse(s, 0, type, data, size, al) <= 0)",
          "",
          "[Added Lines]",
          "2640:         } else if (type == TLSEXT_TYPE_key_share",
          "2641:                 && s->version == TLS1_3_VERSION) {",
          "2642:             unsigned int group_id;",
          "2643:             PACKET encoded_pt;",
          "2644:             EVP_PKEY *ckey = s->s3->tmp.pkey, *skey = NULL;",
          "2647:             if (ckey == NULL) {",
          "2649:                 SSLerr(SSL_F_SSL_SCAN_SERVERHELLO_TLSEXT, ERR_R_INTERNAL_ERROR);",
          "2650:                 return 0;",
          "2651:             }",
          "2653:             if (!PACKET_get_net_2(&spkt, &group_id)) {",
          "2655:                 SSLerr(SSL_F_SSL_SCAN_SERVERHELLO_TLSEXT,",
          "2656:                        SSL_R_LENGTH_MISMATCH);",
          "2657:                 return 0;",
          "2658:             }",
          "2660:             if (group_id != s->s3->group_id) {",
          "2666:                 SSLerr(SSL_F_SSL_SCAN_SERVERHELLO_TLSEXT,",
          "2667:                        SSL_R_BAD_KEY_SHARE);",
          "2668:                 return 0;",
          "2669:             }",
          "2672:             skey = ssl_generate_pkey(ckey);",
          "2674:             if (!PACKET_as_length_prefixed_2(&spkt, &encoded_pt)) {",
          "2676:                 SSLerr(SSL_F_SSL_SCAN_SERVERHELLO_TLSEXT,",
          "2677:                        SSL_R_LENGTH_MISMATCH);",
          "2678:                 return 0;",
          "2679:             }",
          "2681:             if (!EVP_PKEY_set1_tls_encodedpoint(skey, PACKET_data(&encoded_pt),",
          "2682:                                                 PACKET_remaining(&encoded_pt))) {",
          "2684:                 SSLerr(SSL_F_SSL_SCAN_SERVERHELLO_TLSEXT, SSL_R_BAD_ECPOINT);",
          "2685:                 return 0;",
          "2686:             }",
          "2692:             EVP_PKEY_free(skey);",
          "2697:         } else if (custom_ext_parse(s, 0, type, data, size, al) <= 0)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e10dbdbfea000765f336dac3c5e7e41cf7b78c14",
      "candidate_info": {
        "commit_hash": "e10dbdbfea000765f336dac3c5e7e41cf7b78c14",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/e10dbdbfea000765f336dac3c5e7e41cf7b78c14",
        "files": [
          "include/openssl/ssl.h",
          "ssl/ssl_err.c"
        ],
        "message": "make errors\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2339)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_err.c||ssl/ssl_err.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2283: # define SSL_F_TLS_CONSTRUCT_CTOS_KEY_SHARE               470",
          "2284: # define SSL_F_TLS_CONSTRUCT_CTOS_NPN                     471",
          "2285: # define SSL_F_TLS_CONSTRUCT_CTOS_PADDING                 472",
          "2287: # define SSL_F_TLS_CONSTRUCT_CTOS_PSK                     501",
          "2288: # define SSL_F_TLS_CONSTRUCT_CTOS_RENEGOTIATE             473",
          "2289: # define SSL_F_TLS_CONSTRUCT_CTOS_SCT                     474",
          "2290: # define SSL_F_TLS_CONSTRUCT_CTOS_SERVER_NAME             475",
          "",
          "[Removed Lines]",
          "2286: # define SSL_F_TLS_CONSTRUCT_CTOS_PSK_KEX_MODES           509",
          "",
          "[Added Lines]",
          "2287: # define SSL_F_TLS_CONSTRUCT_CTOS_PSK_KEX_MODES           509",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2505: # define SSL_R_NO_SHARED_SIGNATURE_ALGORITHMS             376",
          "2506: # define SSL_R_NO_SRTP_PROFILES                           359",
          "2507: # define SSL_R_NO_SUITABLE_KEY_SHARE                      101",
          "2508: # define SSL_R_NO_VALID_SCTS                              216",
          "2509: # define SSL_R_NO_VERIFY_COOKIE_CALLBACK                  403",
          "2510: # define SSL_R_NULL_SSL_CTX                               195",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2508: # define SSL_R_NO_SUITABLE_SIGNATURE_ALGORITHM            118",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "607:      \"no shared signature algorithms\"},",
          "608:     {ERR_REASON(SSL_R_NO_SRTP_PROFILES), \"no srtp profiles\"},",
          "609:     {ERR_REASON(SSL_R_NO_SUITABLE_KEY_SHARE), \"no suitable key share\"},",
          "610:     {ERR_REASON(SSL_R_NO_VALID_SCTS), \"no valid scts\"},",
          "611:     {ERR_REASON(SSL_R_NO_VERIFY_COOKIE_CALLBACK),",
          "612:      \"no verify cookie callback\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "610:     {ERR_REASON(SSL_R_NO_SUITABLE_SIGNATURE_ALGORITHM),",
          "611:      \"no suitable signature algorithm\"},",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d781d247d1ef9331983f456d616659108c857d0d",
      "candidate_info": {
        "commit_hash": "d781d247d1ef9331983f456d616659108c857d0d",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/d781d247d1ef9331983f456d616659108c857d0d",
        "files": [
          "include/openssl/ssl.h",
          "ssl/record/rec_layer_s3.c",
          "ssl/record/ssl3_record.c",
          "ssl/ssl_err.c",
          "ssl/ssl_lib.c",
          "ssl/ssl_locl.h",
          "ssl/statem/statem.c",
          "ssl/statem/statem_clnt.c",
          "ssl/statem/statem_lib.c",
          "ssl/statem/statem_srvr.c",
          "util/libssl.num"
        ],
        "message": "Provide an SSL_read_early() function for reading early data\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2737)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
          "ssl/record/ssl3_record.c||ssl/record/ssl3_record.c",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/ssl_lib.c||ssl/ssl_lib.c",
          "ssl/ssl_locl.h||ssl/ssl_locl.h",
          "ssl/statem/statem.c||ssl/statem/statem.c",
          "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c",
          "ssl/statem/statem_lib.c||ssl/statem/statem_lib.c",
          "ssl/statem/statem_srvr.c||ssl/statem/statem_srvr.c",
          "util/libssl.num||util/libssl.num"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1611: __owur int SSL_connect(SSL *ssl);",
          "1612: __owur int SSL_read(SSL *ssl, void *buf, int num);",
          "1613: __owur int SSL_read_ex(SSL *ssl, void *buf, size_t num, size_t *readbytes);",
          "1614: __owur int SSL_peek(SSL *ssl, void *buf, int num);",
          "1615: __owur int SSL_peek_ex(SSL *ssl, void *buf, size_t num, size_t *readbytes);",
          "1616: __owur int SSL_write(SSL *ssl, const void *buf, int num);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1615: # define SSL_READ_EARLY_ERROR   0",
          "1616: # define SSL_READ_EARLY_SUCCESS 1",
          "1617: # define SSL_READ_EARLY_FINISH  2",
          "1619: __owur int SSL_read_early(SSL *s, void *buf, size_t num, size_t *readbytes);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2255: # define SSL_F_SSL_PEEK_EX                                432",
          "2256: # define SSL_F_SSL_PEEK_INTERNAL                          522",
          "2257: # define SSL_F_SSL_READ                                   223",
          "2258: # define SSL_F_SSL_READ_EX                                434",
          "2259: # define SSL_F_SSL_READ_INTERNAL                          523",
          "2260: # define SSL_F_SSL_RENEGOTIATE                            516",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2264: # define SSL_F_SSL_READ_EARLY                             529",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "2330: # define SSL_F_TLS_CONSTRUCT_CLIENT_VERIFY                489",
          "2331: # define SSL_F_TLS_CONSTRUCT_CTOS_ALPN                    466",
          "2332: # define SSL_F_TLS_CONSTRUCT_CTOS_CERTIFICATE             355",
          "2334: # define SSL_F_TLS_CONSTRUCT_CTOS_EC_PT_FORMATS           467",
          "2335: # define SSL_F_TLS_CONSTRUCT_CTOS_EMS                     468",
          "2336: # define SSL_F_TLS_CONSTRUCT_CTOS_ETM                     469",
          "",
          "[Removed Lines]",
          "2333: # define SSL_F_TLS_CONSTRUCT_CTOS_EARLY_DATA              521",
          "",
          "[Added Lines]",
          "2340: # define SSL_F_TLS_CONSTRUCT_CTOS_EARLY_DATA              530",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2669: # define SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS       239",
          "2670: # define SSL_R_UNABLE_TO_LOAD_SSL3_MD5_ROUTINES           242",
          "2671: # define SSL_R_UNABLE_TO_LOAD_SSL3_SHA1_ROUTINES          243",
          "2672: # define SSL_R_UNEXPECTED_MESSAGE                         244",
          "2673: # define SSL_R_UNEXPECTED_RECORD                          245",
          "2674: # define SSL_R_UNINITIALIZED                              276",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2679: # define SSL_R_UNEXPECTED_END_OF_EARLY_DATA               178",
          "",
          "---------------"
        ],
        "ssl/record/rec_layer_s3.c||ssl/record/rec_layer_s3.c": [
          "File: ssl/record/rec_layer_s3.c -> ssl/record/rec_layer_s3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1437:                 al = SSL_AD_HANDSHAKE_FAILURE;",
          "1438:                 SSLerr(SSL_F_SSL3_READ_BYTES, SSL_R_NO_RENEGOTIATION);",
          "1439:                 goto f_err;",
          "1440:             }",
          "1441:         } else if (alert_level == SSL3_AL_FATAL) {",
          "1442:             char tmp[16];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1440:             } else if (alert_descr == SSL_AD_END_OF_EARLY_DATA) {",
          "1441:                 if (!ssl_end_of_early_data_seen(s)) {",
          "1442:                     al = SSL_AD_UNEXPECTED_MESSAGE;",
          "1443:                     SSLerr(SSL_F_SSL3_READ_BYTES,",
          "1444:                            SSL_R_UNEXPECTED_END_OF_EARLY_DATA);",
          "1445:                     goto f_err;",
          "1446:                 }",
          "1447:                 return 0;",
          "",
          "---------------"
        ],
        "ssl/record/ssl3_record.c||ssl/record/ssl3_record.c": [
          "File: ssl/record/ssl3_record.c -> ssl/record/ssl3_record.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "507:     }",
          "509:     if (enc_err < 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "510:         if (num_recs == 1 && ossl_statem_skip_early_data(s)) {",
          "515:             thisrr = &rr[0];",
          "516:             thisrr->length = 0;",
          "517:             thisrr->read = 1;",
          "518:             RECORD_LAYER_set_numrpipes(&s->rlayer, 1);",
          "519:             return 1;",
          "520:         }",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "205:     {ERR_FUNC(SSL_F_SSL_PEEK_EX), \"SSL_peek_ex\"},",
          "206:     {ERR_FUNC(SSL_F_SSL_PEEK_INTERNAL), \"ssl_peek_internal\"},",
          "207:     {ERR_FUNC(SSL_F_SSL_READ), \"SSL_read\"},",
          "208:     {ERR_FUNC(SSL_F_SSL_READ_EX), \"SSL_read_ex\"},",
          "209:     {ERR_FUNC(SSL_F_SSL_READ_INTERNAL), \"ssl_read_internal\"},",
          "210:     {ERR_FUNC(SSL_F_SSL_RENEGOTIATE), \"SSL_renegotiate\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "208:     {ERR_FUNC(SSL_F_SSL_READ_EARLY), \"SSL_read_early\"},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "793:      \"unable to load ssl3 md5 routines\"},",
          "794:     {ERR_REASON(SSL_R_UNABLE_TO_LOAD_SSL3_SHA1_ROUTINES),",
          "795:      \"unable to load ssl3 sha1 routines\"},",
          "796:     {ERR_REASON(SSL_R_UNEXPECTED_MESSAGE), \"unexpected message\"},",
          "797:     {ERR_REASON(SSL_R_UNEXPECTED_RECORD), \"unexpected record\"},",
          "798:     {ERR_REASON(SSL_R_UNINITIALIZED), \"uninitialized\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "797:     {ERR_REASON(SSL_R_UNEXPECTED_END_OF_EARLY_DATA),",
          "798:      \"unexpected end of early data\"},",
          "",
          "---------------"
        ],
        "ssl/ssl_lib.c||ssl/ssl_lib.c": [
          "File: ssl/ssl_lib.c -> ssl/ssl_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1594:     return ret;",
          "1595: }",
          "1597: static int ssl_peek_internal(SSL *s, void *buf, size_t num, size_t *readbytes)",
          "1598: {",
          "1599:     if (s->handshake_func == NULL) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1597: int SSL_read_early(SSL *s, void *buf, size_t num, size_t *readbytes)",
          "1598: {",
          "1599:     int ret;",
          "1601:     if (!s->server) {",
          "1602:         SSLerr(SSL_F_SSL_READ_EARLY, ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED);",
          "1603:         return SSL_READ_EARLY_ERROR;",
          "1604:     }",
          "1611:     switch (s->early_data_state) {",
          "1612:     case SSL_EARLY_DATA_NONE:",
          "1613:         if (!SSL_in_before(s)) {",
          "1614:             SSLerr(SSL_F_SSL_READ_EARLY, ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED);",
          "1615:             return SSL_READ_EARLY_ERROR;",
          "1616:         }",
          "1619:     case SSL_EARLY_DATA_ACCEPT_RETRY:",
          "1620:         s->early_data_state = SSL_EARLY_DATA_ACCEPTING;",
          "1621:         ret = SSL_accept(s);",
          "1622:         if (ret <= 0) {",
          "1624:             s->early_data_state = SSL_EARLY_DATA_ACCEPT_RETRY;",
          "1625:             return SSL_READ_EARLY_ERROR;",
          "1626:         }",
          "1629:     case SSL_EARLY_DATA_READ_RETRY:",
          "1630:         if (s->ext.early_data == SSL_EARLY_DATA_ACCEPTED) {",
          "1631:             s->early_data_state = SSL_EARLY_DATA_READING;",
          "1632:             ret = SSL_read_ex(s, buf, num, readbytes);",
          "1638:             if (ret > 0 || (ret <= 0 && s->early_data_state",
          "1639:                                         != SSL_EARLY_DATA_FINISHED_READING)) {",
          "1640:                 s->early_data_state = SSL_EARLY_DATA_READ_RETRY;",
          "1641:                 return ret > 0 ? SSL_READ_EARLY_SUCCESS : SSL_READ_EARLY_ERROR;",
          "1642:             }",
          "1643:         } else {",
          "1644:             s->early_data_state = SSL_EARLY_DATA_FINISHED_READING;",
          "1645:         }",
          "1647:         ossl_statem_set_in_init(s, 1);",
          "1648:         return SSL_READ_EARLY_FINISH;",
          "1650:     default:",
          "1651:         SSLerr(SSL_F_SSL_READ_EARLY, ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED);",
          "1652:         return SSL_READ_EARLY_ERROR;",
          "1653:     }",
          "1654: }",
          "1656: int ssl_end_of_early_data_seen(SSL *s)",
          "1657: {",
          "1658:     if (s->early_data_state == SSL_EARLY_DATA_READING) {",
          "1659:         s->early_data_state = SSL_EARLY_DATA_FINISHED_READING;",
          "1660:         return 1;",
          "1661:     }",
          "1663:     return 0;",
          "1664: }",
          "",
          "---------------"
        ],
        "ssl/ssl_locl.h||ssl/ssl_locl.h": [
          "File: ssl/ssl_locl.h -> ssl/ssl_locl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "618:     SSL_EARLY_DATA_CONNECTING,",
          "619:     SSL_EARLY_DATA_WRITE_RETRY,",
          "620:     SSL_EARLY_DATA_WRITING,",
          "622: } SSL_EARLY_DATA_STATE;",
          "624: #define MAX_COMPRESSIONS_SIZE   255",
          "",
          "[Removed Lines]",
          "621:     SSL_EARLY_DATA_FINISHED_WRITING",
          "",
          "[Added Lines]",
          "621:     SSL_EARLY_DATA_FINISHED_WRITING,",
          "622:     SSL_EARLY_DATA_ACCEPT_RETRY,",
          "623:     SSL_EARLY_DATA_ACCEPTING,",
          "624:     SSL_EARLY_DATA_READ_RETRY,",
          "625:     SSL_EARLY_DATA_READING,",
          "626:     SSL_EARLY_DATA_FINISHED_READING",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1988: # ifndef OPENSSL_UNIT_TEST",
          "1990: __owur int ssl_read_internal(SSL *s, void *buf, size_t num, size_t *readbytes);",
          "1991: __owur int ssl_write_internal(SSL *s, const void *buf, size_t num, size_t *written);",
          "1992: void ssl_clear_cipher_ctx(SSL *s);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1995: int ssl_end_of_early_data_seen(SSL *s);",
          "",
          "---------------"
        ],
        "ssl/statem/statem.c||ssl/statem/statem.c": [
          "File: ssl/statem/statem.c -> ssl/statem/statem.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "326:             }",
          "328:         if ((SSL_IS_FIRST_HANDSHAKE(s)",
          "330:                 || s->renegotiate) {",
          "331:             if (!tls_setup_handshake(s)) {",
          "332:                 ossl_statem_set_error(s);",
          "",
          "[Removed Lines]",
          "329:                     && s->early_data_state != SSL_EARLY_DATA_FINISHED_WRITING)",
          "",
          "[Added Lines]",
          "329:                     && s->early_data_state != SSL_EARLY_DATA_FINISHED_WRITING",
          "330:                     && s->early_data_state != SSL_EARLY_DATA_FINISHED_READING)",
          "",
          "---------------"
        ],
        "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
          "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1229:     SSL_COMP *comp;",
          "1230: #endif",
          "1238:     if (!PACKET_get_net_2(pkt, &sversion)) {",
          "1239:         al = SSL_AD_DECODE_ERROR;",
          "1240:         SSLerr(SSL_F_TLS_PROCESS_SERVER_HELLO, SSL_R_LENGTH_MISMATCH);",
          "",
          "[Removed Lines]",
          "1236:     s->statem.cleanuphand = 1;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "ssl/statem/statem_lib.c||ssl/statem/statem_lib.c": [
          "File: ssl/statem/statem_lib.c -> ssl/statem/statem_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "654:     int al = SSL_AD_INTERNAL_ERROR;",
          "655:     size_t md_len;",
          "658:     if (!SSL_IS_TLS13(s) && !s->s3->change_cipher_spec) {",
          "659:         al = SSL_AD_UNEXPECTED_MESSAGE;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "659:     s->statem.cleanuphand = 1;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "944:             s->d1->next_handshake_write_seq = 0;",
          "945:             dtls1_clear_received_buffer(s);",
          "946:         }",
          "947:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "951:         s->early_data_state = SSL_EARLY_DATA_NONE;",
          "",
          "---------------"
        ],
        "ssl/statem/statem_srvr.c||ssl/statem/statem_srvr.c": [
          "File: ssl/statem/statem_srvr.c -> ssl/statem/statem_srvr.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "406:         return WRITE_TRAN_ERROR;",
          "408:     case TLS_ST_OK:",
          "409:         if (s->key_update != SSL_KEY_UPDATE_NONE) {",
          "410:             st->hand_state = TLS_ST_SW_KEY_UPDATE;",
          "411:             return WRITE_TRAN_CONTINUE;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "409:         if (s->early_data_state == SSL_EARLY_DATA_FINISHED_READING) {",
          "410:             st->hand_state = TLS_ST_SW_FINISHED;",
          "411:             return WRITE_TRAN_FINISHED;",
          "412:         }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "450:         return WRITE_TRAN_CONTINUE;",
          "452:     case TLS_ST_SW_FINISHED:",
          "453:         return WRITE_TRAN_FINISHED;",
          "455:     case TLS_ST_SR_FINISHED:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "457:         if (s->early_data_state == SSL_EARLY_DATA_ACCEPTING) {",
          "458:             st->hand_state = TLS_ST_OK;",
          "459:             ossl_statem_set_in_init(s, 0);",
          "460:             return WRITE_TRAN_CONTINUE;",
          "461:         }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1234:         s->new_session = 1;",
          "1235:     }",
          "",
          "[Removed Lines]",
          "1238:     s->statem.cleanuphand = 1;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "util/libssl.num||util/libssl.num": [
          "File: util/libssl.num -> util/libssl.num",
          "--- Hunk 1 ---",
          "[Context before]",
          "430: SSL_CTX_get_max_early_data              431 1_1_1 EXIST::FUNCTION:",
          "431: SSL_write_early                         432 1_1_1 EXIST::FUNCTION:",
          "432: SSL_write_early_finish                  433 1_1_1 EXIST::FUNCTION:",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "433: SSL_read_early                          434 1_1_1 EXIST::FUNCTION:",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "82f992cbe0db628879aae4bf3ddd95cfcb1098a5",
      "candidate_info": {
        "commit_hash": "82f992cbe0db628879aae4bf3ddd95cfcb1098a5",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/82f992cbe0db628879aae4bf3ddd95cfcb1098a5",
        "files": [
          "include/openssl/ssl.h",
          "ssl/ssl_err.c",
          "ssl/ssl_locl.h",
          "ssl/statem/statem_lib.c"
        ],
        "message": "Limit the number of KeyUpdate messages we can process\n\nToo many KeyUpdate message could be inicative of a problem (e.g. an\ninfinite KeyUpdate loop if the peer always responds to a KeyUpdate message\nwith an \"update_requested\" KeyUpdate response), or (conceivably) an attack.\nEither way we limit the number of KeyUpdate messages we are prepared to\nhandle.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2609)",
        "before_after_code_files": [
          "include/openssl/ssl.h||include/openssl/ssl.h",
          "ssl/ssl_err.c||ssl/ssl_err.c",
          "ssl/ssl_locl.h||ssl/ssl_locl.h",
          "ssl/statem/statem_lib.c||ssl/statem/statem_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ],
          "candidate": [
            "include/openssl/ssl.h||include/openssl/ssl.h",
            "ssl/ssl_err.c||ssl/ssl_err.c"
          ]
        }
      },
      "candidate_diff": {
        "include/openssl/ssl.h||include/openssl/ssl.h": [
          "File: include/openssl/ssl.h -> include/openssl/ssl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "2622: # define SSL_R_TLS_HEARTBEAT_PENDING                      366",
          "2623: # define SSL_R_TLS_ILLEGAL_EXPORTER_LABEL                 367",
          "2624: # define SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST             157",
          "2625: # define SSL_R_TOO_MANY_WARN_ALERTS                       409",
          "2626: # define SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS             314",
          "2627: # define SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS       239",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2625: # define SSL_R_TOO_MANY_KEY_UPDATES                       132",
          "",
          "---------------"
        ],
        "ssl/ssl_err.c||ssl/ssl_err.c": [
          "File: ssl/ssl_err.c -> ssl/ssl_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "764:      \"tls illegal exporter label\"},",
          "765:     {ERR_REASON(SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST),",
          "766:      \"tls invalid ecpointformat list\"},",
          "767:     {ERR_REASON(SSL_R_TOO_MANY_WARN_ALERTS), \"too many warn alerts\"},",
          "768:     {ERR_REASON(SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS),",
          "769:      \"unable to find ecdh parameters\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "767:     {ERR_REASON(SSL_R_TOO_MANY_KEY_UPDATES), \"too many key updates\"},",
          "",
          "---------------"
        ],
        "ssl/ssl_locl.h||ssl/ssl_locl.h": [
          "File: ssl/ssl_locl.h -> ssl/ssl_locl.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1001:     unsigned int key_update_count;",
          "",
          "---------------"
        ],
        "ssl/statem/statem_lib.c||ssl/statem/statem_lib.c": [
          "File: ssl/statem/statem_lib.c -> ssl/statem/statem_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "510:     return 0;",
          "511: }",
          "514: MSG_PROCESS_RETURN tls_process_key_update(SSL *s, PACKET *pkt)",
          "515: {",
          "516:     int al;",
          "517:     unsigned int updatetype;",
          "519:     if (!PACKET_get_1(pkt, &updatetype)",
          "520:             || PACKET_remaining(pkt) != 0",
          "521:             || (updatetype != SSL_KEY_UPDATE_NOT_REQUESTED",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "513: #define MAX_KEY_UPDATE_MESSAGES     32",
          "520:     s->key_update_count++;",
          "521:     if (s->key_update_count > MAX_KEY_UPDATE_MESSAGES) {",
          "522:         al = SSL_AD_ILLEGAL_PARAMETER;",
          "523:         SSLerr(SSL_F_TLS_PROCESS_KEY_UPDATE, SSL_R_TOO_MANY_KEY_UPDATES);",
          "524:         goto err;",
          "525:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}