{
  "cve_id": "CVE-2020-11722",
  "cve_desc": "Dungeon Crawl Stone Soup (aka DCSS or crawl) before 0.25 allows remote attackers to execute arbitrary code via Lua bytecode embedded in an uploaded .crawlrc file.",
  "repo": "crawl/crawl",
  "patch_hash": "fc522ff6eb1bbb85e3de60c60a45762571e48c28",
  "patch_info": {
    "commit_hash": "fc522ff6eb1bbb85e3de60c60a45762571e48c28",
    "repo": "crawl/crawl",
    "commit_url": "https://github.com/crawl/crawl/commit/fc522ff6eb1bbb85e3de60c60a45762571e48c28",
    "files": [
      "crawl-ref/source/clua.cc"
    ],
    "message": "Disable lua load(), loadstring() bytcode loading",
    "before_after_code_files": [
      "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
    ]
  },
  "patch_diff": {
    "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
      "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "304:     while (!f.eof())",
      "305:         script += f.get_line() + \"\\n\";",
      "308:     return luaL_loadbuffer(ls, &script[0], script.length(),",
      "309:                            (\"@\" + file).c_str());",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "307:     if (script[0] == 0x1b)",
      "308:         abort();",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "797:     lua_pushcfunction(_state, lua_loadstring);",
      "798:     lua_setglobal(_state, \"loadstring\");",
      "801:     cluaopen_kills(_state);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "802:     lua_pushnil(_state);",
      "803:     lua_setglobal(_state, \"load\");",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5fc253370d665bb64d6ccc2b289d5ac4ed1d4cc7",
      "candidate_info": {
        "commit_hash": "5fc253370d665bb64d6ccc2b289d5ac4ed1d4cc7",
        "repo": "crawl/crawl",
        "commit_url": "https://github.com/crawl/crawl/commit/5fc253370d665bb64d6ccc2b289d5ac4ed1d4cc7",
        "files": [
          "crawl-ref/source/clua.cc"
        ],
        "message": "Disable lua load(), loadstring() bytcode loading\n\n(cherry picked from commit fc522ff6eb1bbb85e3de60c60a45762571e48c28)",
        "before_after_code_files": [
          "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ],
          "candidate": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ]
        }
      },
      "candidate_diff": {
        "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
          "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "252:     while (!f.eof())",
          "253:         script += f.get_line() + \"\\n\";",
          "256:     return luaL_loadbuffer(ls, &script[0], script.length(),",
          "257:                            (\"@\" + file).c_str());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "255:     if (script[0] == 0x1b)",
          "256:         abort();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "664:     lua_pushcfunction(_state, lua_loadstring);",
          "665:     lua_setglobal(_state, \"loadstring\");",
          "668:     cluaopen_kills(_state);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "669:     lua_pushnil(_state);",
          "670:     lua_setglobal(_state, \"load\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "28b50fd9bbfa03c60023d352549f5d9fcd534570",
      "candidate_info": {
        "commit_hash": "28b50fd9bbfa03c60023d352549f5d9fcd534570",
        "repo": "crawl/crawl",
        "commit_url": "https://github.com/crawl/crawl/commit/28b50fd9bbfa03c60023d352549f5d9fcd534570",
        "files": [
          "crawl-ref/source/clua.cc"
        ],
        "message": "Disable lua load(), loadstring() bytcode loading\n\n(cherry picked from commit fc522ff6eb1bbb85e3de60c60a45762571e48c28)",
        "before_after_code_files": [
          "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ],
          "candidate": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ]
        }
      },
      "candidate_diff": {
        "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
          "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "315:     while (!f.eof())",
          "316:         script += f.get_line() + \"\\n\";",
          "319:     return luaL_loadbuffer(ls, &script[0], script.length(),",
          "320:                            (\"@\" + file).c_str());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "318:     if (script[0] == 0x1b)",
          "319:         abort();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "775:     lua_pushcfunction(_state, lua_loadstring);",
          "776:     lua_setglobal(_state, \"loadstring\");",
          "779:     cluaopen_kills(_state);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "780:     lua_pushnil(_state);",
          "781:     lua_setglobal(_state, \"load\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c4c63601f357cf2664f0867cda2d55f21ad2391d",
      "candidate_info": {
        "commit_hash": "c4c63601f357cf2664f0867cda2d55f21ad2391d",
        "repo": "crawl/crawl",
        "commit_url": "https://github.com/crawl/crawl/commit/c4c63601f357cf2664f0867cda2d55f21ad2391d",
        "files": [
          "crawl-ref/source/clua.cc"
        ],
        "message": "Disable lua load(), loadstring() bytcode loading\n\n(cherry picked from commit fc522ff6eb1bbb85e3de60c60a45762571e48c28)",
        "before_after_code_files": [
          "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ],
          "candidate": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ]
        }
      },
      "candidate_diff": {
        "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
          "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "315:     while (!f.eof())",
          "316:         script += f.get_line() + \"\\n\";",
          "319:     return luaL_loadbuffer(ls, &script[0], script.length(),",
          "320:                            (\"@\" + file).c_str());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "318:     if (script[0] == 0x1b)",
          "319:         abort();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "810:     lua_pushcfunction(_state, lua_loadstring);",
          "811:     lua_setglobal(_state, \"loadstring\");",
          "814:     cluaopen_kills(_state);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "815:     lua_pushnil(_state);",
          "816:     lua_setglobal(_state, \"load\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dd222cab7df401c031dab80c3f378ec4e6b32c71",
      "candidate_info": {
        "commit_hash": "dd222cab7df401c031dab80c3f378ec4e6b32c71",
        "repo": "crawl/crawl",
        "commit_url": "https://github.com/crawl/crawl/commit/dd222cab7df401c031dab80c3f378ec4e6b32c71",
        "files": [
          "crawl-ref/source/clua.cc"
        ],
        "message": "Disable lua load(), loadstring() bytcode loading\n\n(cherry picked from commit fc522ff6eb1bbb85e3de60c60a45762571e48c28)",
        "before_after_code_files": [
          "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ],
          "candidate": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ]
        }
      },
      "candidate_diff": {
        "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
          "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "314:     while (!f.eof())",
          "315:         script += f.get_line() + \"\\n\";",
          "318:     return luaL_loadbuffer(ls, &script[0], script.length(),",
          "319:                            (\"@\" + file).c_str());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "317:     if (script[0] == 0x1b)",
          "318:         abort();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "774:     lua_pushcfunction(_state, lua_loadstring);",
          "775:     lua_setglobal(_state, \"loadstring\");",
          "778:     cluaopen_kills(_state);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "779:     lua_pushnil(_state);",
          "780:     lua_setglobal(_state, \"load\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "47ae8add2ec14fb5f4675fda86000adcf15a8748",
      "candidate_info": {
        "commit_hash": "47ae8add2ec14fb5f4675fda86000adcf15a8748",
        "repo": "crawl/crawl",
        "commit_url": "https://github.com/crawl/crawl/commit/47ae8add2ec14fb5f4675fda86000adcf15a8748",
        "files": [
          "crawl-ref/source/clua.cc"
        ],
        "message": "Disable lua load(), loadstring() bytcode loading\n\n(cherry picked from commit fc522ff6eb1bbb85e3de60c60a45762571e48c28)",
        "before_after_code_files": [
          "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ],
          "candidate": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ]
        }
      },
      "candidate_diff": {
        "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
          "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "314:     while (!f.eof())",
          "315:         script += f.get_line() + \"\\n\";",
          "318:     return luaL_loadbuffer(ls, &script[0], script.length(),",
          "319:                            (\"@\" + file).c_str());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "317:     if (script[0] == 0x1b)",
          "318:         abort();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "774:     lua_pushcfunction(_state, lua_loadstring);",
          "775:     lua_setglobal(_state, \"loadstring\");",
          "778:     cluaopen_kills(_state);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "779:     lua_pushnil(_state);",
          "780:     lua_setglobal(_state, \"load\");",
          "",
          "---------------"
        ]
      }
    }
  ]
}