{
  "cve_id": "CVE-2014-1879",
  "cve_desc": "Cross-site scripting (XSS) vulnerability in import.php in phpMyAdmin before 4.1.7 allows remote authenticated users to inject arbitrary web script or HTML via a crafted filename in an import action.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "968d5d5f486820bfa30af046f063b9f23304e14a",
  "patch_info": {
    "commit_hash": "968d5d5f486820bfa30af046f063b9f23304e14a",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/968d5d5f486820bfa30af046f063b9f23304e14a",
    "files": [
      "import.php"
    ],
    "message": "Sanitize filename in import message\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
    "before_after_code_files": [
      "import.php||import.php"
    ]
  },
  "patch_diff": {
    "import.php||import.php": [
      "File: import.php -> import.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "568:             $message->addString($import_notice);",
      "569:         }",
      "570:         if (isset($local_import_file)) {",
      "572:         } else {",
      "574:         }",
      "575:     }",
      "576: }",
      "",
      "[Removed Lines]",
      "571:             $message->addString('(' . $local_import_file . ')');",
      "573:             $message->addString('(' . $_FILES['import_file']['name'] . ')');",
      "",
      "[Added Lines]",
      "571:             $message->addString('(' . htmlspecialchars($local_import_file) . ')');",
      "573:             $message->addString('(' . htmlspecialchars($_FILES['import_file']['name']) . ')');",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8bf86d9a7ae37f0007b14c3d675c72a78ef10541",
      "candidate_info": {
        "commit_hash": "8bf86d9a7ae37f0007b14c3d675c72a78ef10541",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/8bf86d9a7ae37f0007b14c3d675c72a78ef10541",
        "files": [
          "ChangeLog",
          "import.php"
        ],
        "message": "Fix bug #3891 Server upload folder import file name missing in success message",
        "before_after_code_files": [
          "import.php||import.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "import.php||import.php"
          ],
          "candidate": [
            "import.php||import.php"
          ]
        }
      },
      "candidate_diff": {
        "import.php||import.php": [
          "File: import.php -> import.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "529:             $message->addParam($executed_queries);",
          "531:             $message->addString($import_notice);",
          "533:         } else {",
          "534:             $message = PMA_Message::success(",
          "535:                 __('Import has been successfully finished, %d queries executed.')",
          "536:             );",
          "537:             $message->addParam($executed_queries);",
          "539:         }",
          "540:     }",
          "541: }",
          "",
          "[Removed Lines]",
          "532:             $message->addString('(' . $_FILES['import_file']['name'] . ')');",
          "538:             $message->addString('(' . $_FILES['import_file']['name'] . ')');",
          "",
          "[Added Lines]",
          "532:             if (isset($local_import_file)) {",
          "533:                 $message->addString('(' . $local_import_file . ')');",
          "534:             } else {",
          "535:                 $message->addString('(' . $_FILES['import_file']['name'] . ')');",
          "536:             }",
          "542:             if (isset($local_import_file)) {",
          "543:                 $message->addString('(' . $local_import_file . ')');",
          "544:             } else {",
          "545:                 $message->addString('(' . $_FILES['import_file']['name'] . ')');",
          "546:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "addebbee8b42b3352129d057217362f92103ea5d",
      "candidate_info": {
        "commit_hash": "addebbee8b42b3352129d057217362f92103ea5d",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/addebbee8b42b3352129d057217362f92103ea5d",
        "files": [
          "import.php"
        ],
        "message": "Avoid code duplication\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
        "before_after_code_files": [
          "import.php||import.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "import.php||import.php"
          ],
          "candidate": [
            "import.php||import.php"
          ]
        }
      },
      "candidate_diff": {
        "import.php||import.php": [
          "File: import.php -> import.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "557:     if ($import_type == 'query') {",
          "558:         $message = PMA_Message::success();",
          "559:     } else {",
          "568:             $message->addString($import_notice);",
          "574:         } else {",
          "584:         }",
          "585:     }",
          "586: }",
          "",
          "[Removed Lines]",
          "560:         if ($import_notice) {",
          "561:             $message = PMA_Message::success(",
          "562:                 '<em>'",
          "563:                 . __('Import has been successfully finished, %d queries executed.')",
          "564:                 . '</em>'",
          "565:             );",
          "566:             $message->addParam($executed_queries);",
          "569:             if (isset($local_import_file)) {",
          "570:                 $message->addString('(' . $local_import_file . ')');",
          "571:             } else {",
          "572:                 $message->addString('(' . $_FILES['import_file']['name'] . ')');",
          "573:             }",
          "575:             $message = PMA_Message::success(",
          "576:                 __('Import has been successfully finished, %d queries executed.')",
          "577:             );",
          "578:             $message->addParam($executed_queries);",
          "579:             if (isset($local_import_file)) {",
          "580:                 $message->addString('(' . $local_import_file . ')');",
          "581:             } else {",
          "582:                 $message->addString('(' . $_FILES['import_file']['name'] . ')');",
          "583:             }",
          "",
          "[Added Lines]",
          "560:         $message = PMA_Message::success(",
          "561:             '<em>'",
          "562:             . __('Import has been successfully finished, %d queries executed.')",
          "563:             . '</em>'",
          "564:         );",
          "565:         $message->addParam($executed_queries);",
          "567:         if ($import_notice) {",
          "569:         }",
          "570:         if (isset($local_import_file)) {",
          "571:             $message->addString('(' . $local_import_file . ')');",
          "573:             $message->addString('(' . $_FILES['import_file']['name'] . ')');",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bbeacf8e78fb375b5b73f79e467c91cb054df1ec",
      "candidate_info": {
        "commit_hash": "bbeacf8e78fb375b5b73f79e467c91cb054df1ec",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/bbeacf8e78fb375b5b73f79e467c91cb054df1ec",
        "files": [
          "import.php",
          "libraries/import.lib.php"
        ],
        "message": "Fix coding style\n\nSigned-off-by: Marc Delisle <marc@infomarc.info>",
        "before_after_code_files": [
          "import.php||import.php",
          "libraries/import.lib.php||libraries/import.lib.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "import.php||import.php"
          ],
          "candidate": [
            "import.php||import.php"
          ]
        }
      },
      "candidate_diff": {
        "import.php||import.php": [
          "File: import.php -> import.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "584:         if (isset($local_import_file)) {",
          "585:             $message->addString('(' . htmlspecialchars($local_import_file) . ')');",
          "586:         } else {",
          "588:         }",
          "589:     }",
          "590: }",
          "",
          "[Removed Lines]",
          "587:             $message->addString('(' . htmlspecialchars($_FILES['import_file']['name']) . ')');",
          "",
          "[Added Lines]",
          "588:             $message->addString(",
          "589:                 '(' . htmlspecialchars($_FILES['import_file']['name']) . ')'",
          "590:             );",
          "",
          "---------------"
        ],
        "libraries/import.lib.php||libraries/import.lib.php": [
          "File: libraries/import.lib.php -> libraries/import.lib.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "1323:     global $import_handle, $file_to_unlink;",
          "",
          "[Removed Lines]",
          "1322: function PMA_stopImport( PMA_Message $error_message ) {",
          "",
          "[Added Lines]",
          "1322: function PMA_stopImport( PMA_Message $error_message )",
          "1323: {",
          "",
          "---------------"
        ]
      }
    }
  ]
}