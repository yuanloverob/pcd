{
  "cve_id": "CVE-2021-29592",
  "cve_desc": "TensorFlow is an end-to-end open source platform for machine learning. The fix for CVE-2020-15209(https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-15209) missed the case when the target shape of `Reshape` operator is given by the elements of a 1-D tensor. As such, the fix for the vulnerability(https://github.com/tensorflow/tensorflow/blob/9c1dc920d8ffb4893d6c9d27d1f039607b326743/tensorflow/lite/core/subgraph.cc#L1062-L1074) allowed passing a null-buffer-backed tensor with a 1D shape. The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "f8378920345f4f4604202d4ab15ef64b2aceaa16",
  "patch_info": {
    "commit_hash": "f8378920345f4f4604202d4ab15ef64b2aceaa16",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/f8378920345f4f4604202d4ab15ef64b2aceaa16",
    "files": [
      "tensorflow/lite/core/subgraph.cc"
    ],
    "message": "Prevent a null pointer dereference in TFLite.\n\nPiperOrigin-RevId: 370800353\nChange-Id: Ic9c9712ce5c6e384c954dcd640a5bd9ff05c9a05",
    "before_after_code_files": [
      "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc": [
      "File: tensorflow/lite/core/subgraph.cc -> tensorflow/lite/core/subgraph.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "1060:         TF_LITE_ENSURE_STATUS(EnsureTensorDataIsReadable(tensor_index));",
      "1061:       }",
      "1062:       if (tensor->data.raw == nullptr && tensor->bytes > 0) {",
      "1067:           continue;",
      "1068:         } else {",
      "",
      "[Removed Lines]",
      "1063:         if (registration.builtin_code == kTfLiteBuiltinReshape && i == 1) {",
      "",
      "[Added Lines]",
      "1063:         if (registration.builtin_code == kTfLiteBuiltinReshape && i == 1 &&",
      "1064:             tensor->dims->size != 1) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0b28cdac4552e004cdb3af2a3287c4dc8f2a0e6e",
      "candidate_info": {
        "commit_hash": "0b28cdac4552e004cdb3af2a3287c4dc8f2a0e6e",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/0b28cdac4552e004cdb3af2a3287c4dc8f2a0e6e",
        "files": [
          "tensorflow/lite/core/subgraph.cc"
        ],
        "message": "Prevent a null pointer dereference in TFLite.\n\nPiperOrigin-RevId: 370800353\nChange-Id: Ic9c9712ce5c6e384c954dcd640a5bd9ff05c9a05",
        "before_after_code_files": [
          "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc"
          ],
          "candidate": [
            "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/core/subgraph.cc||tensorflow/lite/core/subgraph.cc": [
          "File: tensorflow/lite/core/subgraph.cc -> tensorflow/lite/core/subgraph.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "936:         TF_LITE_ENSURE_STATUS(EnsureTensorDataIsReadable(tensor_index));",
          "937:       }",
          "938:       if (tensor->data.raw == nullptr && tensor->bytes > 0) {",
          "943:           continue;",
          "944:         } else {",
          "",
          "[Removed Lines]",
          "939:         if (registration.builtin_code == kTfLiteBuiltinReshape && i == 1) {",
          "",
          "[Added Lines]",
          "939:         if (registration.builtin_code == kTfLiteBuiltinReshape && i == 1 &&",
          "940:             tensor->dims->size != 1) {",
          "",
          "---------------"
        ]
      }
    }
  ]
}