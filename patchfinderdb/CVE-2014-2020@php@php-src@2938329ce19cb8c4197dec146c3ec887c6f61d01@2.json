{
  "cve_id": "CVE-2014-2020",
  "cve_desc": "ext/gd/gd.c in PHP 5.5.x before 5.5.9 does not check data types, which might allow remote attackers to obtain sensitive information by using a (1) string or (2) array data type in place of a numeric data type, as demonstrated by an imagecrop function call with a string for the x dimension value, a different vulnerability than CVE-2013-7226.",
  "repo": "php/php-src",
  "patch_hash": "2938329ce19cb8c4197dec146c3ec887c6f61d01",
  "patch_info": {
    "commit_hash": "2938329ce19cb8c4197dec146c3ec887c6f61d01",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/2938329ce19cb8c4197dec146c3ec887c6f61d01",
    "files": [
      "NEWS",
      "ext/gd/gd.c",
      "ext/gd/tests/bug66356.phpt",
      "main/php_version.h"
    ],
    "message": "Fixed bug #66356 (Heap Overflow Vulnerability in imagecrop())\n\nAnd also fixed the bug: arguments are altered after some calls",
    "before_after_code_files": [
      "ext/gd/gd.c||ext/gd/gd.c",
      "ext/gd/tests/bug66356.phpt||ext/gd/tests/bug66356.phpt",
      "main/php_version.h||main/php_version.h"
    ]
  },
  "patch_diff": {
    "ext/gd/gd.c||ext/gd/gd.c": [
      "File: ext/gd/gd.c -> ext/gd/gd.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1538:    break;",
      "1539:   }",
      "1544:  }",
      "1546:  gdImageSetStyle(im, stylearr, index);",
      "",
      "[Removed Lines]",
      "1541:   convert_to_long_ex(item);",
      "1543:   stylearr[index++] = Z_LVAL_PP(item);",
      "",
      "[Added Lines]",
      "1541:   if (Z_TYPE_PP(item) != IS_LONG) {",
      "1542:    zval lval;",
      "1543:    lval = **item;",
      "1544:    zval_copy_ctor(&lval);",
      "1545:    convert_to_long(&lval);",
      "1546:    stylearr[index++] = Z_LVAL(lval);",
      "1547:   } else {",
      "1548:    stylearr[index++] = Z_LVAL_PP(item);",
      "1549:   }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3347:  for (i = 0; i < npoints; i++) {",
      "3348:   if (zend_hash_index_find(Z_ARRVAL_P(POINTS), (i * 2), (void **) &var) == SUCCESS) {",
      "3352:   }",
      "3353:   if (zend_hash_index_find(Z_ARRVAL_P(POINTS), (i * 2) + 1, (void **) &var) == SUCCESS) {",
      "3357:   }",
      "3358:  }",
      "",
      "[Removed Lines]",
      "3349:    SEPARATE_ZVAL((var));",
      "3350:    convert_to_long(*var);",
      "3351:    points[i].x = Z_LVAL_PP(var);",
      "3354:    SEPARATE_ZVAL(var);",
      "3355:    convert_to_long(*var);",
      "3356:    points[i].y = Z_LVAL_PP(var);",
      "",
      "[Added Lines]",
      "3355:    if (Z_TYPE_PP(var) != IS_LONG) {",
      "3356:     zval lval;",
      "3357:     lval = **var;",
      "3358:     zval_copy_ctor(&lval);",
      "3359:     convert_to_long(&lval);",
      "3360:     points[i].x = Z_LVAL(lval);",
      "3361:    } else {",
      "3362:     points[i].x = Z_LVAL_PP(var);",
      "3363:    }",
      "3366:    if (Z_TYPE_PP(var) != IS_LONG) {",
      "3367:     zval lval;",
      "3368:     lval = **var;",
      "3369:     zval_copy_ctor(&lval);",
      "3370:     convert_to_long(&lval);",
      "3371:     points[i].y = Z_LVAL(lval);",
      "3372:    } else {",
      "3373:     points[i].y = Z_LVAL_PP(var);",
      "3374:    }",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "4860:    for (j=0; j<3; j++) {",
      "4861:     if (zend_hash_index_find(Z_ARRVAL_PP(var), (j), (void **) &var2) == SUCCESS) {",
      "4865:     } else {",
      "4866:      php_error_docref(NULL TSRMLS_CC, E_WARNING, \"You must have a 3x3 matrix\");",
      "4867:      RETURN_FALSE;",
      "",
      "[Removed Lines]",
      "4862:      SEPARATE_ZVAL(var2);",
      "4863:      convert_to_double(*var2);",
      "4864:      matrix[i][j] = (float)Z_DVAL_PP(var2);",
      "",
      "[Added Lines]",
      "4880:      if (Z_TYPE_PP(var2) != IS_DOUBLE) {",
      "4881:       zval dval;",
      "4882:       dval = **var;",
      "4883:       zval_copy_ctor(&dval);",
      "4884:       convert_to_double(&dval);",
      "4885:       matrix[i][j] = (float)Z_DVAL(dval);",
      "4886:      } else {",
      "4887:       matrix[i][j] = (float)Z_DVAL_PP(var2);",
      "4888:      }",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "4954:  ZEND_FETCH_RESOURCE(im, gdImagePtr, &IM, -1, \"Image\", le_gd);",
      "4956:  if (zend_hash_find(HASH_OF(z_rect), \"x\", sizeof(\"x\"), (void **)&tmp) != FAILURE) {",
      "4958:  } else {",
      "4959:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing x position\");",
      "4960:   RETURN_FALSE;",
      "4961:  }",
      "4963:  if (zend_hash_find(HASH_OF(z_rect), \"y\", sizeof(\"x\"), (void **)&tmp) != FAILURE) {",
      "4965:  } else {",
      "4966:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing y position\");",
      "4967:   RETURN_FALSE;",
      "4968:  }",
      "4970:  if (zend_hash_find(HASH_OF(z_rect), \"width\", sizeof(\"width\"), (void **)&tmp) != FAILURE) {",
      "4972:  } else {",
      "4973:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing width\");",
      "4974:   RETURN_FALSE;",
      "4975:  }",
      "4977:  if (zend_hash_find(HASH_OF(z_rect), \"height\", sizeof(\"height\"), (void **)&tmp) != FAILURE) {",
      "4979:  } else {",
      "4980:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing height\");",
      "4981:   RETURN_FALSE;",
      "",
      "[Removed Lines]",
      "4957:   rect.x = Z_LVAL_PP(tmp);",
      "4964:   rect.y = Z_LVAL_PP(tmp);",
      "4971:   rect.width = Z_LVAL_PP(tmp);",
      "4978:   rect.height = Z_LVAL_PP(tmp);",
      "",
      "[Added Lines]",
      "4981:   if (Z_TYPE_PP(tmp) != IS_LONG) {",
      "4982:    zval lval;",
      "4983:    lval = **tmp;",
      "4984:    zval_copy_ctor(&lval);",
      "4985:    convert_to_long(&lval);",
      "4986:    rect.x = Z_LVAL(lval);",
      "4987:   } else {",
      "4988:    rect.x = Z_LVAL_PP(tmp);",
      "4989:   }",
      "4996:   if (Z_TYPE_PP(tmp) != IS_LONG) {",
      "4997:    zval lval;",
      "4998:    lval = **tmp;",
      "4999:    zval_copy_ctor(&lval);",
      "5000:    convert_to_long(&lval);",
      "5001:    rect.y = Z_LVAL(lval);",
      "5002:   } else {",
      "5003:    rect.y = Z_LVAL_PP(tmp);",
      "5004:   }",
      "5011:   if (Z_TYPE_PP(tmp) != IS_LONG) {",
      "5012:    zval lval;",
      "5013:    lval = **tmp;",
      "5014:    zval_copy_ctor(&lval);",
      "5015:    convert_to_long(&lval);",
      "5016:    rect.width = Z_LVAL(lval);",
      "5017:   } else {",
      "5018:    rect.width = Z_LVAL_PP(tmp);",
      "5019:   }",
      "5026:   if (Z_TYPE_PP(tmp) != IS_LONG) {",
      "5027:    zval lval;",
      "5028:    lval = **tmp;",
      "5029:    zval_copy_ctor(&lval);",
      "5030:    convert_to_long(&lval);",
      "5031:    rect.height = Z_LVAL(lval);",
      "5032:   } else {",
      "5033:    rect.height = Z_LVAL_PP(tmp);",
      "5034:   }",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "5124:      affine[i] = Z_DVAL_PP(zval_affine_elem);",
      "5125:      break;",
      "5126:     case IS_STRING:",
      "5129:      break;",
      "5130:     default:",
      "5131:      php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Invalid type for element %i\", i);",
      "",
      "[Removed Lines]",
      "5127:      convert_to_double_ex(zval_affine_elem);",
      "5128:      affine[i] = Z_DVAL_PP(zval_affine_elem);",
      "",
      "[Added Lines]",
      "5183:      {",
      "5184:       zval dval;",
      "5185:       dval = **zval_affine_elem;",
      "5186:       zval_copy_ctor(&dval);",
      "5187:       convert_to_double(&dval);",
      "5188:       affine[i] = Z_DVAL(dval);",
      "5189:      }",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "5137:  if (z_rect != NULL) {",
      "5138:   if (zend_hash_find(HASH_OF(z_rect), \"x\", sizeof(\"x\"), (void **)&tmp) != FAILURE) {",
      "5141:   } else {",
      "5142:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing x position\");",
      "5143:    RETURN_FALSE;",
      "5144:   }",
      "5146:   if (zend_hash_find(HASH_OF(z_rect), \"y\", sizeof(\"x\"), (void **)&tmp) != FAILURE) {",
      "5149:   } else {",
      "5150:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing y position\");",
      "5151:    RETURN_FALSE;",
      "5152:   }",
      "5154:   if (zend_hash_find(HASH_OF(z_rect), \"width\", sizeof(\"width\"), (void **)&tmp) != FAILURE) {",
      "5157:   } else {",
      "5158:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing width\");",
      "5159:    RETURN_FALSE;",
      "5160:   }",
      "5162:   if (zend_hash_find(HASH_OF(z_rect), \"height\", sizeof(\"height\"), (void **)&tmp) != FAILURE) {",
      "5165:   } else {",
      "5166:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing height\");",
      "5167:    RETURN_FALSE;",
      "",
      "[Removed Lines]",
      "5139:    convert_to_long_ex(tmp);",
      "5140:    rect.x = Z_LVAL_PP(tmp);",
      "5147:    convert_to_long_ex(tmp);",
      "5148:    rect.y = Z_LVAL_PP(tmp);",
      "5155:    convert_to_long_ex(tmp);",
      "5156:    rect.width = Z_LVAL_PP(tmp);",
      "5163:    convert_to_long_ex(tmp);",
      "5164:    rect.height = Z_LVAL_PP(tmp);",
      "",
      "[Added Lines]",
      "5200:    if (Z_TYPE_PP(tmp) != IS_LONG) {",
      "5201:     zval lval;",
      "5202:     lval = **tmp;",
      "5203:     zval_copy_ctor(&lval);",
      "5204:     convert_to_long(&lval);",
      "5205:     rect.x = Z_LVAL(lval);",
      "5206:    } else {",
      "5207:     rect.x = Z_LVAL_PP(tmp);",
      "5208:    }",
      "5215:    if (Z_TYPE_PP(tmp) != IS_LONG) {",
      "5216:     zval lval;",
      "5217:     lval = **tmp;",
      "5218:     zval_copy_ctor(&lval);",
      "5219:     convert_to_long(&lval);",
      "5220:     rect.y = Z_LVAL(lval);",
      "5221:    } else {",
      "5222:     rect.y = Z_LVAL_PP(tmp);",
      "5223:    }",
      "5230:    if (Z_TYPE_PP(tmp) != IS_LONG) {",
      "5231:     zval lval;",
      "5232:     lval = **tmp;",
      "5233:     zval_copy_ctor(&lval);",
      "5234:     convert_to_long(&lval);",
      "5235:     rect.width = Z_LVAL(lval);",
      "5236:    } else {",
      "5237:     rect.width = Z_LVAL_PP(tmp);",
      "5238:    }",
      "5245:    if (Z_TYPE_PP(tmp) != IS_LONG) {",
      "5246:     zval lval;",
      "5247:     lval = **tmp;",
      "5248:     zval_copy_ctor(&lval);",
      "5249:     convert_to_long(&lval);",
      "5250:     rect.height = Z_LVAL(lval);",
      "5251:    } else {",
      "5252:     rect.height = Z_LVAL_PP(tmp);",
      "5253:    }",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "5211:     php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Array expected as options\");",
      "5212:    }",
      "5213:    if (zend_hash_find(HASH_OF(options), \"x\", sizeof(\"x\"), (void **)&tmp) != FAILURE) {",
      "5216:    } else {",
      "5217:     php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing x position\");",
      "5218:     RETURN_FALSE;",
      "5219:    }",
      "5221:    if (zend_hash_find(HASH_OF(options), \"y\", sizeof(\"y\"), (void **)&tmp) != FAILURE) {",
      "5224:    } else {",
      "5225:     php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing y position\");",
      "5226:     RETURN_FALSE;",
      "",
      "[Removed Lines]",
      "5214:     convert_to_double_ex(tmp);",
      "5215:     x = Z_DVAL_PP(tmp);",
      "5222:     convert_to_double_ex(tmp);",
      "5223:     y = Z_DVAL_PP(tmp);",
      "",
      "[Added Lines]",
      "5303:     if (Z_TYPE_PP(tmp) != IS_DOUBLE) {",
      "5304:      zval dval;",
      "5305:      dval = **tmp;",
      "5306:      zval_copy_ctor(&dval);",
      "5307:      convert_to_double(&dval);",
      "5308:      x = Z_DVAL(dval);",
      "5309:     } else {",
      "5310:      x = Z_DVAL_PP(tmp);",
      "5311:     }",
      "5318:     if (Z_TYPE_PP(tmp) != IS_DOUBLE) {",
      "5319:      zval dval;",
      "5320:      dval = **tmp;",
      "5321:      zval_copy_ctor(&dval);",
      "5322:      convert_to_double(&dval);",
      "5323:      y = Z_DVAL(dval);",
      "5324:     } else {",
      "5325:      y = Z_DVAL_PP(tmp);",
      "5326:     }",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "5300:      m1[i] = Z_DVAL_PP(tmp);",
      "5301:      break;",
      "5302:     case IS_STRING:",
      "5305:      break;",
      "5306:     default:",
      "5307:      php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Invalid type for element %i\", i);",
      "",
      "[Removed Lines]",
      "5303:      convert_to_double_ex(tmp);",
      "5304:      m1[i] = Z_DVAL_PP(tmp);",
      "",
      "[Added Lines]",
      "5406:      {",
      "5407:       zval dval;",
      "5408:       dval = **tmp;",
      "5409:       zval_copy_ctor(&dval);",
      "5410:       convert_to_double(&dval);",
      "5411:       m1[i] = Z_DVAL(dval);",
      "5412:      }",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "5317:      m2[i] = Z_DVAL_PP(tmp);",
      "5318:      break;",
      "5319:     case IS_STRING:",
      "5322:      break;",
      "5323:     default:",
      "5324:      php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Invalid type for element %i\", i);",
      "",
      "[Removed Lines]",
      "5320:      convert_to_double_ex(tmp);",
      "5321:      m2[i] = Z_DVAL_PP(tmp);",
      "",
      "[Added Lines]",
      "5428:      {",
      "5429:       zval dval;",
      "5430:       dval = **tmp;",
      "5431:       zval_copy_ctor(&dval);",
      "5432:       convert_to_double(&dval);",
      "5433:       m2[i] = Z_DVAL(dval);",
      "5434:      }",
      "",
      "---------------"
    ],
    "ext/gd/tests/bug66356.phpt||ext/gd/tests/bug66356.phpt": [
      "File: ext/gd/tests/bug66356.phpt -> ext/gd/tests/bug66356.phpt",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: --TEST--",
      "2: Bug #66356 (Heap Overflow Vulnerability in imagecrop())",
      "3: --SKIPIF--",
      "4: <?php",
      "5:  if(!extension_loaded('gd')){ die('skip gd extension not available'); }",
      "6: ?>",
      "7: --FILE--",
      "8: <?php",
      "9: $img = imagecreatetruecolor(10, 10);",
      "10: $img = imagecrop($img, array(\"x\" => \"a\", \"y\" => 0, \"width\" => 10, \"height\" => 10));",
      "11: $arr = array(\"x\" => \"a\", \"y\" => \"12b\", \"width\" => 10, \"height\" => 10);",
      "12: $img = imagecrop($img, $arr);",
      "13: print_r($arr);",
      "14: ?>",
      "15: --EXPECTF--",
      "16: Array",
      "17: (",
      "18:     [x] => a",
      "19:     [y] => 12b",
      "20:     [width] => 10",
      "21:     [height] => 10",
      "22: )",
      "",
      "---------------"
    ],
    "main/php_version.h||main/php_version.h": [
      "File: main/php_version.h -> main/php_version.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: #define PHP_MAJOR_VERSION 5",
      "4: #define PHP_MINOR_VERSION 5",
      "6: #define PHP_EXTRA_VERSION \"-dev\"",
      "",
      "[Removed Lines]",
      "5: #define PHP_RELEASE_VERSION 8",
      "7: #define PHP_VERSION \"5.5.8-dev\"",
      "8: #define PHP_VERSION_ID 50508",
      "",
      "[Added Lines]",
      "5: #define PHP_RELEASE_VERSION 5",
      "7: #define PHP_VERSION \"5.5.5-dev\"",
      "8: #define PHP_VERSION_ID 50505",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "aba76f09fa3adca5208b877ed75b2c2ef8f4498f",
      "candidate_info": {
        "commit_hash": "aba76f09fa3adca5208b877ed75b2c2ef8f4498f",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/aba76f09fa3adca5208b877ed75b2c2ef8f4498f",
        "files": [
          "main/php_version.h"
        ],
        "message": "Revert accidented committed php_version.h",
        "before_after_code_files": [
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 5",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "",
          "[Removed Lines]",
          "5: #define PHP_RELEASE_VERSION 5",
          "7: #define PHP_VERSION \"5.5.5-dev\"",
          "8: #define PHP_VERSION_ID 50505",
          "",
          "[Added Lines]",
          "5: #define PHP_RELEASE_VERSION 8",
          "7: #define PHP_VERSION \"5.5.8-dev\"",
          "8: #define PHP_VERSION_ID 50508",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1984919ddc3252c0f9b5d5d0beef10bdc4804091",
      "candidate_info": {
        "commit_hash": "1984919ddc3252c0f9b5d5d0beef10bdc4804091",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/1984919ddc3252c0f9b5d5d0beef10bdc4804091",
        "files": [
          "NEWS",
          "configure.in",
          "main/php_version.h"
        ],
        "message": "5.5.7 now",
        "before_after_code_files": [
          "configure.in||configure.in",
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "120: PHP_MAJOR_VERSION=5",
          "121: PHP_MINOR_VERSION=5",
          "123: PHP_EXTRA_VERSION=\"-dev\"",
          "124: PHP_VERSION=\"$PHP_MAJOR_VERSION.$PHP_MINOR_VERSION.$PHP_RELEASE_VERSION$PHP_EXTRA_VERSION\"",
          "125: PHP_VERSION_ID=`expr [$]PHP_MAJOR_VERSION \\* 10000 + [$]PHP_MINOR_VERSION \\* 100 + [$]PHP_RELEASE_VERSION`",
          "",
          "[Removed Lines]",
          "122: PHP_RELEASE_VERSION=6",
          "",
          "[Added Lines]",
          "122: PHP_RELEASE_VERSION=7",
          "",
          "---------------"
        ],
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 5",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "",
          "[Removed Lines]",
          "5: #define PHP_RELEASE_VERSION 6",
          "7: #define PHP_VERSION \"5.5.6-dev\"",
          "8: #define PHP_VERSION_ID 50506",
          "",
          "[Added Lines]",
          "5: #define PHP_RELEASE_VERSION 7",
          "7: #define PHP_VERSION \"5.5.7-dev\"",
          "8: #define PHP_VERSION_ID 50507",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7c5da4607c30637566e54d45bebc8918dc66f83b",
      "candidate_info": {
        "commit_hash": "7c5da4607c30637566e54d45bebc8918dc66f83b",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/7c5da4607c30637566e54d45bebc8918dc66f83b",
        "files": [
          "ext/gd/gd.c"
        ],
        "message": "Fix casts in GD\n\nUsing convert_to_* after ZVAL_COPY is unsafe.",
        "before_after_code_files": [
          "ext/gd/gd.c||ext/gd/gd.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/gd/gd.c||ext/gd/gd.c"
          ],
          "candidate": [
            "ext/gd/gd.c||ext/gd/gd.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/gd/gd.c||ext/gd/gd.c": [
          "File: ext/gd/gd.c -> ext/gd/gd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1539:  stylearr = safe_emalloc(sizeof(int), zend_hash_num_elements(HASH_OF(styles)), 0);",
          "1541:  ZEND_HASH_FOREACH_VAL(HASH_OF(styles), item) {",
          "1550:  } ZEND_HASH_FOREACH_END();",
          "1552:  gdImageSetStyle(im, stylearr, index);",
          "",
          "[Removed Lines]",
          "1542:   if (Z_TYPE_P(item) != IS_LONG) {",
          "1543:    zval lval;",
          "1544:    ZVAL_COPY(&lval, item);",
          "1545:    convert_to_long(&lval);",
          "1546:    stylearr[index++] = Z_LVAL(lval);",
          "1547:   } else {",
          "1548:    stylearr[index++] = Z_LVAL_P(item);",
          "1549:   }",
          "",
          "[Added Lines]",
          "1542:   stylearr[index++] = zval_get_long(item);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3357:  for (i = 0; i < npoints; i++) {",
          "3358:   if ((var = zend_hash_index_find(Z_ARRVAL_P(POINTS), (i * 2))) != NULL) {",
          "3367:   }",
          "3368:   if ((var = zend_hash_index_find(Z_ARRVAL_P(POINTS), (i * 2) + 1)) != NULL) {",
          "3377:   }",
          "3378:  }",
          "",
          "[Removed Lines]",
          "3359:    if (Z_TYPE_P(var) != IS_LONG) {",
          "3360:     zval lval;",
          "3361:     ZVAL_COPY(&lval, var);",
          "3362:     convert_to_long(&lval);",
          "3363:     points[i].x = Z_LVAL(lval);",
          "3364:    } else {",
          "3365:     points[i].x = Z_LVAL_P(var);",
          "3366:    }",
          "3369:    if (Z_TYPE_P(var) != IS_LONG) {",
          "3370:     zval lval;",
          "3371:     ZVAL_COPY(&lval, var);",
          "3372:     convert_to_long(&lval);",
          "3373:     points[i].y = Z_LVAL(lval);",
          "3374:    } else {",
          "3375:     points[i].y = Z_LVAL_P(var);",
          "3376:    }",
          "",
          "[Added Lines]",
          "3352:    points[i].x = zval_get_long(var);",
          "3355:    points[i].y = zval_get_long(var);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3844:     continue;",
          "3845:    }",
          "3846:    if (strcmp(\"linespacing\", key->val) == 0) {",
          "3848:     strex.flags |= gdFTEX_LINESPACE;",
          "3850:    }",
          "3851:   } ZEND_HASH_FOREACH_END();",
          "3852:  }",
          "",
          "[Removed Lines]",
          "3847:     convert_to_double_ex(item);",
          "3849:     strex.linespacing = Z_DVAL_P(item);",
          "",
          "[Added Lines]",
          "3827:     strex.linespacing = zval_get_double(item);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "4874:    }",
          "4876:    for (j=0; j<3; j++) {",
          "4886:     } else {",
          "4887:      php_error_docref(NULL TSRMLS_CC, E_WARNING, \"You must have a 3x3 matrix\");",
          "4888:      RETURN_FALSE;",
          "",
          "[Removed Lines]",
          "4877:     if ((var2 = zend_hash_index_find(Z_ARRVAL_P(var), (j))) != NULL) {",
          "4878:      if (Z_TYPE_P(var2) != IS_DOUBLE) {",
          "4879:       zval dval;",
          "4880:       ZVAL_COPY(&dval, var2);",
          "4881:       convert_to_double(&dval);",
          "4882:       matrix[i][j] = (float)Z_DVAL(dval);",
          "4883:      } else {",
          "4884:       matrix[i][j] = (float)Z_DVAL_P(var2);",
          "4885:      }",
          "",
          "[Added Lines]",
          "4855:     if ((var2 = zend_hash_index_find(Z_ARRVAL_P(var), j)) != NULL) {",
          "4856:      matrix[i][j] = (float) zval_get_double(var2);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "4975:  ZEND_FETCH_RESOURCE(im, gdImagePtr, IM, -1, \"Image\", le_gd);",
          "4977:  if ((tmp = zend_hash_str_find(HASH_OF(z_rect), \"x\", sizeof(\"x\") -1)) != NULL) {",
          "4986:  } else {",
          "4987:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing x position\");",
          "4988:   RETURN_FALSE;",
          "4989:  }",
          "4991:  if ((tmp = zend_hash_str_find(HASH_OF(z_rect), \"y\", sizeof(\"y\") - 1)) != NULL) {",
          "5000:  } else {",
          "5001:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing y position\");",
          "5002:   RETURN_FALSE;",
          "5003:  }",
          "5005:  if ((tmp = zend_hash_str_find(HASH_OF(z_rect), \"width\", sizeof(\"width\") - 1)) != NULL) {",
          "5014:  } else {",
          "5015:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing width\");",
          "5016:   RETURN_FALSE;",
          "5017:  }",
          "5019:  if ((tmp = zend_hash_str_find(HASH_OF(z_rect), \"height\", sizeof(\"height\") - 1)) != NULL) {",
          "5028:  } else {",
          "5029:   php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing height\");",
          "5030:   RETURN_FALSE;",
          "",
          "[Removed Lines]",
          "4978:   if (Z_TYPE_P(tmp) != IS_LONG) {",
          "4979:    zval lval;",
          "4980:    ZVAL_COPY(&lval, tmp);",
          "4981:    convert_to_long(&lval);",
          "4982:    rect.x = Z_LVAL(lval);",
          "4983:   } else {",
          "4984:    rect.x = Z_LVAL_P(tmp);",
          "4985:   }",
          "4992:   if (Z_TYPE_P(tmp) != IS_LONG) {",
          "4993:    zval lval;",
          "4994:    ZVAL_COPY(&lval, tmp);",
          "4995:    convert_to_long(&lval);",
          "4996:    rect.y = Z_LVAL(lval);",
          "4997:   } else {",
          "4998:    rect.y = Z_LVAL_P(tmp);",
          "4999:   }",
          "5006:   if (Z_TYPE_P(tmp) != IS_LONG) {",
          "5007:    zval lval;",
          "5008:    ZVAL_COPY(&lval, tmp);",
          "5009:    convert_to_long(&lval);",
          "5010:    rect.width = Z_LVAL(lval);",
          "5011:   } else {",
          "5012:    rect.width = Z_LVAL_P(tmp);",
          "5013:   }",
          "5020:   if (Z_TYPE_P(tmp) != IS_LONG) {",
          "5021:    zval lval;",
          "5022:    ZVAL_COPY(&lval, tmp);",
          "5023:    convert_to_long(&lval);",
          "5024:    rect.height = Z_LVAL(lval);",
          "5025:   } else {",
          "5026:    rect.height = Z_LVAL_P(tmp);",
          "5027:   }",
          "",
          "[Added Lines]",
          "4949:   rect.x = zval_get_long(tmp);",
          "4956:   rect.y = zval_get_long(tmp);",
          "4963:   rect.width = zval_get_long(tmp);",
          "4970:   rect.height = zval_get_long(tmp);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "5157:      affine[i] = Z_DVAL_P(zval_affine_elem);",
          "5158:      break;",
          "5159:     case IS_STRING:",
          "5166:      break;",
          "5167:     default:",
          "5168:      php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Invalid type for element %i\", i);",
          "",
          "[Removed Lines]",
          "5160:      {",
          "5161:       zval dval;",
          "5162:       ZVAL_COPY(&dval, zval_affine_elem);",
          "5163:       convert_to_double(&dval);",
          "5164:       affine[i] = Z_DVAL(dval);",
          "5165:      }",
          "",
          "[Added Lines]",
          "5103:      affine[i] = zval_get_double(zval_affine_elem);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "5174:  if (z_rect != NULL) {",
          "5175:   if ((tmp = zend_hash_str_find(HASH_OF(z_rect), \"x\", sizeof(\"x\") - 1)) != NULL) {",
          "5184:   } else {",
          "5185:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing x position\");",
          "5186:    RETURN_FALSE;",
          "5187:   }",
          "5189:   if ((tmp = zend_hash_str_find(HASH_OF(z_rect), \"y\", sizeof(\"y\") - 1)) != NULL) {",
          "5198:   } else {",
          "5199:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing y position\");",
          "5200:    RETURN_FALSE;",
          "5201:   }",
          "5203:   if ((tmp = zend_hash_str_find(HASH_OF(z_rect), \"width\", sizeof(\"width\") - 1)) != NULL) {",
          "5212:   } else {",
          "5213:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing width\");",
          "5214:    RETURN_FALSE;",
          "5215:   }",
          "5217:   if ((tmp = zend_hash_str_find(HASH_OF(z_rect), \"height\", sizeof(\"height\") - 1)) != NULL) {",
          "5226:   } else {",
          "5227:    php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing height\");",
          "5228:    RETURN_FALSE;",
          "",
          "[Removed Lines]",
          "5176:    if (Z_TYPE_P(tmp) != IS_LONG) {",
          "5177:     zval lval;",
          "5178:     ZVAL_COPY(&lval, tmp);",
          "5179:     convert_to_long(&lval);",
          "5180:     rect.x = Z_LVAL(lval);",
          "5181:    } else {",
          "5182:     rect.x = Z_LVAL_P(tmp);",
          "5183:    }",
          "5190:    if (Z_TYPE_P(tmp) != IS_LONG) {",
          "5191:     zval lval;",
          "5192:     ZVAL_COPY(&lval, tmp);",
          "5193:     convert_to_long(&lval);",
          "5194:     rect.y = Z_LVAL(lval);",
          "5195:    } else {",
          "5196:     rect.y = Z_LVAL_P(tmp);",
          "5197:    }",
          "5204:    if (Z_TYPE_P(tmp) != IS_LONG) {",
          "5205:     zval lval;",
          "5206:     ZVAL_COPY(&lval, tmp);",
          "5207:     convert_to_long(&lval);",
          "5208:     rect.width = Z_LVAL(lval);",
          "5209:    } else {",
          "5210:     rect.width = Z_LVAL_P(tmp);",
          "5211:    }",
          "5218:    if (Z_TYPE_P(tmp) != IS_LONG) {",
          "5219:     zval lval;",
          "5220:     ZVAL_COPY(&lval, tmp);",
          "5221:     convert_to_long(&lval);",
          "5222:     rect.height = Z_LVAL(lval);",
          "5223:    } else {",
          "5224:     rect.height = Z_LVAL_P(tmp);",
          "5225:    }",
          "",
          "[Added Lines]",
          "5114:    rect.x = zval_get_long(tmp);",
          "5121:    rect.y = zval_get_long(tmp);",
          "5128:    rect.width = zval_get_long(tmp);",
          "5135:    rect.height = zval_get_long(tmp);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "5271:     RETURN_FALSE;",
          "5272:    }",
          "5273:    if ((tmp = zend_hash_str_find(HASH_OF(options), \"x\", sizeof(\"x\") - 1)) != NULL) {",
          "5282:    } else {",
          "5283:     php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing x position\");",
          "5284:     RETURN_FALSE;",
          "5285:    }",
          "5287:    if ((tmp = zend_hash_str_find(HASH_OF(options), \"y\", sizeof(\"y\") - 1)) != NULL) {",
          "5296:    } else {",
          "5297:     php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Missing y position\");",
          "5298:     RETURN_FALSE;",
          "",
          "[Removed Lines]",
          "5274:     if (Z_TYPE_P(tmp) != IS_DOUBLE) {",
          "5275:      zval dval;",
          "5276:      ZVAL_COPY(&dval, tmp);",
          "5277:      convert_to_double(&dval);",
          "5278:      x = Z_DVAL(dval);",
          "5279:     } else {",
          "5280:      x = Z_DVAL_P(tmp);",
          "5281:     }",
          "5288:     if (Z_TYPE_P(tmp) != IS_DOUBLE) {",
          "5289:      zval dval;",
          "5290:      ZVAL_COPY(&dval, tmp);",
          "5291:      convert_to_double(&dval);",
          "5292:      y = Z_DVAL(dval);",
          "5293:     } else {",
          "5294:      y = Z_DVAL_P(tmp);",
          "5295:     }",
          "",
          "[Added Lines]",
          "5184:     x = zval_get_double(tmp);",
          "5191:     y = zval_get_double(tmp);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "5315:     php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Number is expected as option\");",
          "5316:     RETURN_FALSE;",
          "5317:    }",
          "5321:    if (type == GD_AFFINE_SHEAR_HORIZONTAL) {",
          "5322:     res = gdAffineShearHorizontal(affine, angle);",
          "",
          "[Removed Lines]",
          "5318:    convert_to_double_ex(options);",
          "5319:    angle = Z_DVAL_P(options);",
          "",
          "[Added Lines]",
          "5215:    angle = zval_get_double(options);",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "5375:      m1[i] = Z_DVAL_P(tmp);",
          "5376:      break;",
          "5377:     case IS_STRING:",
          "5384:      break;",
          "5385:     default:",
          "5386:      php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Invalid type for element %i\", i);",
          "",
          "[Removed Lines]",
          "5378:      {",
          "5379:       zval dval;",
          "5380:       ZVAL_COPY(&dval, tmp);",
          "5381:       convert_to_double(&dval);",
          "5382:       m1[i] = Z_DVAL(dval);",
          "5383:      }",
          "",
          "[Added Lines]",
          "5274:      m1[i] = zval_get_double(tmp);",
          "",
          "---------------",
          "--- Hunk 11 ---",
          "[Context before]",
          "5396:      m2[i] = Z_DVAL_P(tmp);",
          "5397:      break;",
          "5398:     case IS_STRING:",
          "5405:      break;",
          "5406:     default:",
          "5407:      php_error_docref(NULL TSRMLS_CC, E_WARNING, \"Invalid type for element %i\", i);",
          "",
          "[Removed Lines]",
          "5399:      {",
          "5400:       zval dval;",
          "5401:       ZVAL_COPY(&dval, tmp);",
          "5402:       convert_to_double(&dval);",
          "5403:       m2[i] = Z_DVAL(dval);",
          "5404:      }",
          "",
          "[Added Lines]",
          "5290:      m2[i] = zval_get_double(tmp);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7262bf67a250194453006c559a6a51afc85399c3",
      "candidate_info": {
        "commit_hash": "7262bf67a250194453006c559a6a51afc85399c3",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/7262bf67a250194453006c559a6a51afc85399c3",
        "files": [
          "NEWS",
          "configure.in",
          "main/php_version.h"
        ],
        "message": "5.4.10-dev",
        "before_after_code_files": [
          "configure.in||configure.in",
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "configure.in||configure.in": [
          "File: configure.in -> configure.in",
          "--- Hunk 1 ---",
          "[Context before]",
          "120: PHP_MAJOR_VERSION=5",
          "121: PHP_MINOR_VERSION=4",
          "123: PHP_EXTRA_VERSION=\"-dev\"",
          "124: PHP_VERSION=\"$PHP_MAJOR_VERSION.$PHP_MINOR_VERSION.$PHP_RELEASE_VERSION$PHP_EXTRA_VERSION\"",
          "125: PHP_VERSION_ID=`expr [$]PHP_MAJOR_VERSION \\* 10000 + [$]PHP_MINOR_VERSION \\* 100 + [$]PHP_RELEASE_VERSION`",
          "",
          "[Removed Lines]",
          "122: PHP_RELEASE_VERSION=9",
          "",
          "[Added Lines]",
          "122: PHP_RELEASE_VERSION=10",
          "",
          "---------------"
        ],
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "4: #define PHP_MINOR_VERSION 4",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "",
          "[Removed Lines]",
          "5: #define PHP_RELEASE_VERSION 9",
          "7: #define PHP_VERSION \"5.4.9-dev\"",
          "8: #define PHP_VERSION_ID 50409",
          "",
          "[Added Lines]",
          "5: #define PHP_RELEASE_VERSION 10",
          "7: #define PHP_VERSION \"5.4.10-dev\"",
          "8: #define PHP_VERSION_ID 50410",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c0748c785619e6a1180c3c7b9c50a6831bc8a12f",
      "candidate_info": {
        "commit_hash": "c0748c785619e6a1180c3c7b9c50a6831bc8a12f",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/c0748c785619e6a1180c3c7b9c50a6831bc8a12f",
        "files": [
          "main/php_version.h"
        ],
        "message": "- version",
        "before_after_code_files": [
          "main/php_version.h||main/php_version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "main/php_version.h||main/php_version.h"
          ],
          "candidate": [
            "main/php_version.h||main/php_version.h"
          ]
        }
      },
      "candidate_diff": {
        "main/php_version.h||main/php_version.h": [
          "File: main/php_version.h -> main/php_version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: #define PHP_MAJOR_VERSION 5",
          "6: #define PHP_EXTRA_VERSION \"-dev\"",
          "",
          "[Removed Lines]",
          "4: #define PHP_MINOR_VERSION 3",
          "5: #define PHP_RELEASE_VERSION 99",
          "7: #define PHP_VERSION \"5.3.99-dev\"",
          "8: #define PHP_VERSION_ID 50399",
          "",
          "[Added Lines]",
          "4: #define PHP_MINOR_VERSION 4",
          "5: #define PHP_RELEASE_VERSION 0",
          "7: #define PHP_VERSION \"5.4.0-dev\"",
          "8: #define PHP_VERSION_ID 50400",
          "",
          "---------------"
        ]
      }
    }
  ]
}