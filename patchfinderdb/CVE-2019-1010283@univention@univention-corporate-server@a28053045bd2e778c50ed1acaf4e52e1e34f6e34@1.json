{
  "cve_id": "CVE-2019-1010283",
  "cve_desc": "Univention Corporate Server univention-directory-notifier 12.0.1-3 and earlier is affected by: CWE-213: Intentional Information Exposure. The impact is: Loss of Confidentiality. The component is: function data_on_connection() in src/callback.c. The attack vector is: network connectivity. The fixed version is: 12.0.1-4 and later.",
  "repo": "univention/univention-corporate-server",
  "patch_hash": "a28053045bd2e778c50ed1acaf4e52e1e34f6e34",
  "patch_info": {
    "commit_hash": "a28053045bd2e778c50ed1acaf4e52e1e34f6e34",
    "repo": "univention/univention-corporate-server",
    "commit_url": "https://github.com/univention/univention-corporate-server/commit/a28053045bd2e778c50ed1acaf4e52e1e34f6e34",
    "files": [
      "management/univention-directory-notifier/debian/changelog",
      "management/univention-directory-notifier/src/callback.c"
    ],
    "message": "Bug #48427 UDN: Forbid vulnerable GET_DN for VERSION >= 3\n\nUDL using PROTOCOL_3 must no longer use GET_DN but WAIT_DN - if it is\nstill used this is a protocol violation. UDL simply will not get an\nanswer.\n\nWhen UCRV 'notifier/protocol/version is set to 3, any old client still\nusing PROTOCOL_2 will get rejected while negotiating the protocol\nversion, so it is asserted that \"version >= network_procotol_version\".",
    "before_after_code_files": [
      "management/univention-directory-notifier/src/callback.c||management/univention-directory-notifier/src/callback.c"
    ]
  },
  "patch_diff": {
    "management/univention-directory-notifier/src/callback.c||management/univention-directory-notifier/src/callback.c": [
      "File: management/univention-directory-notifier/src/callback.c -> management/univention-directory-notifier/src/callback.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "199:    p+=strlen(network_line);",
      "204:    univention_debug(UV_DEBUG_TRANSFILE, UV_DEBUG_ALL, \"RECV: GET_DN\");",
      "",
      "[Removed Lines]",
      "202:   } else if ( !strncmp(network_line, \"GET_DN \", strlen(\"GET_DN \")) && msg_id != UINT32_MAX && network_client_get_version(fd) > 0) {",
      "",
      "[Added Lines]",
      "202:   } else if ( !strncmp(network_line, \"GET_DN \", strlen(\"GET_DN \")) && msg_id != UINT32_MAX && version > PROTOCOL_UNKNOWN && version < PROTOCOL_3) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d0f8cc581b7b5e0cc0e87ea6ba0ecb588a8d3323",
      "candidate_info": {
        "commit_hash": "d0f8cc581b7b5e0cc0e87ea6ba0ecb588a8d3323",
        "repo": "univention/univention-corporate-server",
        "commit_url": "https://github.com/univention/univention-corporate-server/commit/d0f8cc581b7b5e0cc0e87ea6ba0ecb588a8d3323",
        "files": [
          "management/univention-join/debian/changelog",
          "management/univention-join/univention-join",
          "management/univention-ldap/01univention-ldap-server-init.inst",
          "management/univention-ldap/debian/changelog",
          "management/univention-ldap/debian/univention-ldap-server.postinst",
          "management/univention-ldap/scripts/setup-translog"
        ],
        "message": "Bug #48427: Improve setup-translog\n\nHide slapcat output.\nForce remove translog on re-join.",
        "before_after_code_files": [
          "management/univention-ldap/01univention-ldap-server-init.inst||management/univention-ldap/01univention-ldap-server-init.inst",
          "management/univention-ldap/debian/univention-ldap-server.postinst||management/univention-ldap/debian/univention-ldap-server.postinst"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "management/univention-ldap/01univention-ldap-server-init.inst||management/univention-ldap/01univention-ldap-server-init.inst": [
          "File: management/univention-ldap/01univention-ldap-server-init.inst -> management/univention-ldap/01univention-ldap-server-init.inst",
          "--- Hunk 1 ---",
          "[Context before]",
          "111:  test -x /usr/sbin/nscd && /usr/sbin/nscd -i passwd",
          "112:  test -x /usr/sbin/nscd && /usr/sbin/nscd -i group",
          "113: fi",
          "116: service slapd start",
          "",
          "[Removed Lines]",
          "114: /usr/share/univention-ldap/setup-translog db \"$@\"",
          "",
          "[Added Lines]",
          "114: /usr/share/univention-ldap/setup-translog init \"$@\"",
          "",
          "---------------"
        ],
        "management/univention-ldap/debian/univention-ldap-server.postinst||management/univention-ldap/debian/univention-ldap-server.postinst": [
          "File: management/univention-ldap/debian/univention-ldap-server.postinst -> management/univention-ldap/debian/univention-ldap-server.postinst",
          "--- Hunk 1 ---",
          "[Context before]",
          "188: }",
          "190: if [ \"$server_role\" = \"domaincontroller_master\" ] || [ \"$server_role\" = \"domaincontroller_backup\" ]; then",
          "192:  /usr/lib/univention-install/01univention-ldap-server-init.inst || true",
          "193:  /usr/lib/univention-install/10univention-ldap-server.inst || true",
          "194:  [ \"$1\" = configure ] && dpkg --compare-versions \"$2\" lt-nl 11.0.12-5 && upgrade_license || :",
          "",
          "[Removed Lines]",
          "191:  JOIN_FORCE=\"$([ \"$1\" = configure ] && dpkg --compare-versions \"$2\" lt-nl 14.0.2-35 && echo 1)\" \\",
          "",
          "[Added Lines]",
          "191:  JOIN_FORCE=\"$([ \"$1\" = configure ] && dpkg --compare-versions \"$2\" lt-nl 14.0.2-37 && echo 1)\" \\",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7187856e7b28ebe95603222c1359c5a71f77ee82",
      "candidate_info": {
        "commit_hash": "7187856e7b28ebe95603222c1359c5a71f77ee82",
        "repo": "univention/univention-corporate-server",
        "commit_url": "https://github.com/univention/univention-corporate-server/commit/7187856e7b28ebe95603222c1359c5a71f77ee82",
        "files": [
          "test/branch-tests/base/master-slave.cfg",
          "test/branch-tests/base/s4-connector.cfg",
          "test/branch-tests/base/samba-domain.cfg",
          "test/branch-tests/base/singlemaster-all-components.cfg"
        ],
        "message": "Bug #48427 test: No DHCP for eth1\n\nThis is the internal interface for IPv6 link-local communication.\nStarting DHCP from networking.service delays the boot by 5 minutes.",
        "before_after_code_files": [
          "test/branch-tests/base/master-slave.cfg||test/branch-tests/base/master-slave.cfg",
          "test/branch-tests/base/s4-connector.cfg||test/branch-tests/base/s4-connector.cfg",
          "test/branch-tests/base/samba-domain.cfg||test/branch-tests/base/samba-domain.cfg",
          "test/branch-tests/base/singlemaster-all-components.cfg||test/branch-tests/base/singlemaster-all-components.cfg"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/branch-tests/base/master-slave.cfg||test/branch-tests/base/master-slave.cfg": [
          "File: test/branch-tests/base/master-slave.cfg -> test/branch-tests/base/master-slave.cfg",
          "--- Hunk 1 ---",
          "[Context before]",
          "35:  packages_install=\"\"",
          "36:  server/role=\"domaincontroller_master\"",
          "37:  interfaces/eth0/type=\"dhcp\"",
          "39: command1:",
          "40:  . utils.sh && basic_setup",
          "41:  . utils.sh && add_tech_key_authorized_keys",
          "",
          "[Removed Lines]",
          "38:  interfaces/eth1/type=\"dhcp\"",
          "",
          "[Added Lines]",
          "38:  interfaces/eth1/type=\"manual\"",
          "39:  interfaces/eth1/start=\"true\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "81:  packages_install=\"\"",
          "82:  server/role=\"domaincontroller_slave\"",
          "83:  interfaces/eth0/type=\"dhcp\"",
          "85: command1:",
          "86:  ucr set nameserver1=\"[master_NETWORK_DHCP_IP]\"",
          "87:  . utils.sh && basic_setup",
          "",
          "[Removed Lines]",
          "84:  interfaces/eth1/type=\"dhcp\"",
          "",
          "[Added Lines]",
          "85:  interfaces/eth1/type=\"manual\"",
          "86:  interfaces/eth1/start=\"true\"",
          "",
          "---------------"
        ],
        "test/branch-tests/base/s4-connector.cfg||test/branch-tests/base/s4-connector.cfg": [
          "File: test/branch-tests/base/s4-connector.cfg -> test/branch-tests/base/s4-connector.cfg",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:  packages_install=\"univention-s4-connector\"",
          "38:  server/role=\"domaincontroller_master\"",
          "39:  interfaces/eth0/type=\"dhcp\"",
          "41: command1:",
          "42:  . utils.sh && basic_setup",
          "43:  . utils.sh && add_tech_key_authorized_keys",
          "",
          "[Removed Lines]",
          "40:  interfaces/eth1/type=\"dhcp\"",
          "",
          "[Added Lines]",
          "40:  interfaces/eth1/type=\"manual\"",
          "41:  interfaces/eth1/start=\"true\"",
          "",
          "---------------"
        ],
        "test/branch-tests/base/samba-domain.cfg||test/branch-tests/base/samba-domain.cfg": [
          "File: test/branch-tests/base/samba-domain.cfg -> test/branch-tests/base/samba-domain.cfg",
          "--- Hunk 1 ---",
          "[Context before]",
          "34:  packages_install=\"univention-s4-connector univention-samba4\"",
          "35:  server/role=\"domaincontroller_master\"",
          "36:  interfaces/eth0/type=\"dhcp\"",
          "38: command1:",
          "39:  . utils.sh && basic_setup",
          "40:  . utils.sh && add_tech_key_authorized_keys",
          "",
          "[Removed Lines]",
          "37:  interfaces/eth1/type=\"dhcp\"",
          "",
          "[Added Lines]",
          "37:  interfaces/eth1/type=\"manual\"",
          "38:  interfaces/eth1/start=\"true\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "76:  packages_install=\"univention-s4-connector univention-samba4\"",
          "77:  server/role=\"domaincontroller_backup\"",
          "78:  interfaces/eth0/type=\"dhcp\"",
          "80:  nameserver=[master_IP]",
          "81: command1:",
          "82:  . utils.sh && basic_setup",
          "",
          "[Removed Lines]",
          "79:  interfaces/eth1/type=\"dhcp\"",
          "",
          "[Added Lines]",
          "80:  interfaces/eth1/type=\"manual\"",
          "81:  interfaces/eth1/start=\"true\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "119:  packages_install=\"univention-s4-connector univention-samba4\"",
          "120:  server/role=\"domaincontroller_slave\"",
          "121:  interfaces/eth0/type=\"dhcp\"",
          "123:  nameserver=[master_IP]",
          "124: command1:",
          "125:  . utils.sh && basic_setup",
          "",
          "[Removed Lines]",
          "122:  interfaces/eth1/type=\"dhcp\"",
          "",
          "[Added Lines]",
          "124:  interfaces/eth1/type=\"manual\"",
          "125:  interfaces/eth1/start=\"true\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "161:  packages_install=\"univention-samba\"",
          "162:  server/role=\"memberserver\"",
          "163:  interfaces/eth0/type=\"dhcp\"",
          "165:  nameserver=[master_IP]",
          "166: command1:",
          "167:  . utils.sh && basic_setup",
          "",
          "[Removed Lines]",
          "164:  interfaces/eth1/type=\"dhcp\"",
          "",
          "[Added Lines]",
          "167:  interfaces/eth1/type=\"manual\"",
          "168:  interfaces/eth1/start=\"true\"",
          "",
          "---------------"
        ],
        "test/branch-tests/base/singlemaster-all-components.cfg||test/branch-tests/base/singlemaster-all-components.cfg": [
          "File: test/branch-tests/base/singlemaster-all-components.cfg -> test/branch-tests/base/singlemaster-all-components.cfg",
          "--- Hunk 1 ---",
          "[Context before]",
          "37:  packages_install=\" univention-ad-connector univention-admingrp-user-passwordreset univention-antivir-mail univention-dhcp univention-fetchmail,univention-fetchmail-schema univention-java univention-kde univention-mail-server univention-management-console-module-adtakeover univention-nagios-server univention-pkgdb univention-printquota univention-printserver univention-radius univention-s4-connector univention-samba univention-samba4 univention-samba4,univention-s4-connector univention-self-service,univention-self-service-passwordreset-umc univention-spamassassin univention-squid univention-virtual-machine-manager-cloud-ec2 univention-virtual-machine-manager-daemon univention-virtual-machine-manager-node-kvm\"",
          "38:  server/role=\"domaincontroller_master\"",
          "39:  interfaces/eth0/type=\"dhcp\"",
          "41: command1:",
          "42:  . utils.sh && basic_setup",
          "43:  . utils.sh && add_tech_key_authorized_keys",
          "",
          "[Removed Lines]",
          "40:  interfaces/eth1/type=\"dhcp\"",
          "",
          "[Added Lines]",
          "40:  interfaces/eth1/type=\"manual\"",
          "41:  interfaces/eth1/start=\"true\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ef4533e472726c8e564a6720d1092f0ee9c61a6d",
      "candidate_info": {
        "commit_hash": "ef4533e472726c8e564a6720d1092f0ee9c61a6d",
        "repo": "univention/univention-corporate-server",
        "commit_url": "https://github.com/univention/univention-corporate-server/commit/ef4533e472726c8e564a6720d1092f0ee9c61a6d",
        "files": [
          "management/univention-directory-notifier/debian/control",
          "management/univention-directory-notifier/src/Makefile",
          "management/univention-directory-notifier/src/notify.c"
        ],
        "message": "Bug #48427 udn: Write translog to LDAP\n\nlibldap() internally uses liblber(), which uses write() on the socket to\nslapd. It the connection is closed, this raises SIGPIPE, which\nterminates the process.",
        "before_after_code_files": [
          "management/univention-directory-notifier/src/notify.c||management/univention-directory-notifier/src/notify.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "management/univention-directory-notifier/src/notify.c||management/univention-directory-notifier/src/notify.c": [
          "File: management/univention-directory-notifier/src/notify.c -> management/univention-directory-notifier/src/notify.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "39: #include <sys/types.h>",
          "40: #include <sys/stat.h>",
          "41: #include <pthread.h>",
          "43: #include <univention/debug.h>",
          "44: #include \"notify.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "42: #include <time.h>",
          "43: #include <ldap.h>",
          "44: #include <sasl/sasl.h>",
          "45: #include <univention/debug.h>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "296:  fclose_lock(FILE_NAME_SAVE, &notify->save, &notify->l_save);",
          "297: }",
          "299: void notify_init ( Notify_t *notify )",
          "300: {",
          "301:  notify->irf   = NULL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "312: static int sasl_proc(LDAP *ld, unsigned flags, void *defaults, void *in) {",
          "313:  sasl_interact_t *interact = in;",
          "314:  const char *dflt = interact->defresult;",
          "315:  univention_debug(UV_DEBUG_TRANSFILE, UV_DEBUG_ALL, \"SASL: id=%ld chal=%s prom=%s def=%s\", interact->id, interact->challenge, interact->prompt, interact->defresult);",
          "316:  switch (interact->id) {",
          "317:  case SASL_CB_USER:",
          "318:   interact->result = \"\";",
          "319:   interact->len = 0;",
          "320:   return LDAP_SUCCESS;",
          "321:  default:",
          "322:   interact->result = (dflt && *dflt) ? dflt : \"\";",
          "323:   interact->len = strlen(interact->result);",
          "324:   return LDAP_INAPPROPRIATE_AUTH;",
          "325:  }",
          "326: }",
          "332: static void notify_dump_to_ldap(NotifyEntry_t *trans) {",
          "333:  static LDAP *ld = NULL;",
          "334:  LDAPControl **serverctrls = NULL;",
          "335:  LDAPControl **clientctrls = NULL;",
          "336:  int rc;",
          "337:  struct sigaction oldact, act = {",
          "338:   .sa_handler = SIG_IGN,",
          "339:   .sa_flags = 0,",
          "340:  };",
          "342:  if (trans == NULL)",
          "343:   return;",
          "346:  sigaction(SIGPIPE, &act, &oldact);",
          "348: reopen:",
          "349:  if (!ld) {",
          "350:   if ((rc = ldap_initialize(&ld, \"ldapi:///\")) != LDAP_SUCCESS) {",
          "351:    univention_debug(UV_DEBUG_TRANSFILE, UV_DEBUG_ERROR, \"ldap_initialize(): %s\", ldap_err2string(rc));",
          "352:    abort();",
          "353:   }",
          "355:   unsigned long version = LDAP_VERSION3;",
          "356:   if ((rc = ldap_set_option(ld, LDAP_OPT_PROTOCOL_VERSION, &version)) != LDAP_SUCCESS) {",
          "357:    univention_debug(UV_DEBUG_TRANSFILE, UV_DEBUG_ERROR, \"ldap_set_option(): %s\", ldap_err2string(rc));",
          "358:    abort();",
          "359:   }",
          "361:   const char *who = NULL;",
          "362:   const char mechanism[] = \"EXTERNAL\";",
          "363:   unsigned flags = LDAP_SASL_QUIET;",
          "364:   void *defaults = NULL;",
          "365:   if ((rc = ldap_sasl_interactive_bind_s(ld, who, mechanism, serverctrls, clientctrls, flags, sasl_proc, defaults)) != LDAP_SUCCESS) {",
          "366:    univention_debug(UV_DEBUG_TRANSFILE, UV_DEBUG_ERROR, \"ldap_sasl_interactive_bind_s(): %s\", ldap_err2string(rc));",
          "367:    abort();",
          "368:   }",
          "369:  }",
          "371:  for (; trans != NULL; trans = trans->next) {",
          "372:   if (!trans->dn)",
          "373:    continue;",
          "374:   if (!trans->notify_id.id)",
          "375:    continue;",
          "377:   char dn[44];  // strlen(\"reqSession=%ld,cn=translog\") + strlen(ULONG_MAX)",
          "378:   snprintf(dn, sizeof(dn), \"reqSession=%ld,cn=translog\", trans->notify_id.id);",
          "380:   char *oc_values[] = { \"auditObject\", NULL };",
          "381:   LDAPMod oc_mod = {",
          "382:    .mod_op = LDAP_MOD_ADD,",
          "383:    .mod_type = \"objectClass\",",
          "384:    .mod_values = oc_values,",
          "385:   };",
          "387:   char start[16]; // strlen('YYYYmmddHHMMSSZ')",
          "388:   time_t t = time(NULL);",
          "389:   struct tm tm ;",
          "390:   gmtime_r(&t, &tm);",
          "391:   strftime(start, sizeof(start), \"%Y%m%d%H%M%SZ\", &tm);",
          "392:   char *start_values[] = { start, NULL };",
          "393:   LDAPMod time_mod = {",
          "394:    .mod_op = LDAP_MOD_ADD,",
          "395:    .mod_type = \"reqStart\",",
          "396:    .mod_values = start_values,",
          "397:   };",
          "399:   char id[21];  // strlen(ULONG_MAX)",
          "400:   snprintf(id, sizeof(id), \"%ld\", trans->notify_id.id);",
          "401:   char *index_values[] = { id, NULL };",
          "402:   LDAPMod index_mod = {",
          "403:    .mod_op = LDAP_MOD_ADD,",
          "404:    .mod_type = \"reqSession\",",
          "405:    .mod_values = index_values,",
          "406:   };",
          "408:   char *dn_values[] = { trans->dn, NULL };",
          "409:   LDAPMod dn_mod = {",
          "410:    .mod_op = LDAP_MOD_ADD,",
          "411:    .mod_type = \"reqDN\",",
          "412:    .mod_values = dn_values,",
          "413:   };",
          "415:   char cmd[2];",
          "416:   cmd[0] = trans->command;",
          "417:   cmd[1] = '\\0';",
          "418:   char *cmd_values[] = { cmd, NULL };",
          "419:   LDAPMod cmd_mod = {",
          "420:    .mod_op = LDAP_MOD_ADD,",
          "421:    .mod_type = \"reqType\",",
          "422:    .mod_values = cmd_values,",
          "423:   };",
          "425:   LDAPMod *attrs[] = {",
          "426:    &oc_mod,",
          "427:    &time_mod,",
          "428:    &index_mod,",
          "429:    &dn_mod,",
          "430:    &cmd_mod,",
          "431:    NULL",
          "432:   };",
          "434:   univention_debug(UV_DEBUG_TRANSFILE, UV_DEBUG_ALL, \"LDIF dn: %s\", dn);",
          "435:   for (rc = 0; attrs[rc]; rc++)",
          "436:    univention_debug(UV_DEBUG_TRANSFILE, UV_DEBUG_ALL, \"LDIF %s: %s\", attrs[rc]->mod_type, attrs[rc]->mod_values[0]);",
          "438:   rc = ldap_add_ext_s(ld, dn, attrs, serverctrls, clientctrls);",
          "439:   switch (rc) {",
          "440:    case LDAP_SUCCESS:",
          "441:     break;",
          "442:    case LDAP_SERVER_DOWN:",
          "443:     if ((rc = ldap_unbind_ext_s(ld, serverctrls, clientctrls)) != LDAP_SUCCESS)",
          "444:      univention_debug(UV_DEBUG_TRANSFILE, UV_DEBUG_PROCESS, \"%ld ldap_unbind_ext_s(): %s\", trans->notify_id.id, ldap_err2string(rc));",
          "445:     ld = NULL;",
          "446:     goto reopen;",
          "447:    case LDAP_ALREADY_EXISTS:",
          "448:     univention_debug(UV_DEBUG_TRANSFILE, UV_DEBUG_WARN, \"%ld ldap_add() already exists\", trans->notify_id.id);",
          "449:     break;",
          "450:    default:",
          "451:     univention_debug(UV_DEBUG_TRANSFILE, UV_DEBUG_ERROR, \"%ld ldap_add(): %s\", trans->notify_id.id, ldap_err2string(rc));",
          "452:     abort();",
          "453:   }",
          "454:  }",
          "456:  sigaction(SIGPIPE, &oldact, NULL);",
          "457: }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "800:  if ( (nread = fread( buf, sizeof(char), stat_buf.st_size, file)) != 0 ) {",
          "801:   split_transaction_buffer ( entry, buf, nread);",
          "802:   notify_dump_to_files(&notify, entry);",
          "803:   fseek(file, 0, SEEK_SET);",
          "804:   ftruncate(fileno(file), 0);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "963:   notify_dump_to_ldap(entry);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8ab87108310a905d4affe23ec5d674052b03ae2d",
      "candidate_info": {
        "commit_hash": "8ab87108310a905d4affe23ec5d674052b03ae2d",
        "repo": "univention/univention-corporate-server",
        "commit_url": "https://github.com/univention/univention-corporate-server/commit/8ab87108310a905d4affe23ec5d674052b03ae2d",
        "files": [
          "management/univention-directory-notifier/02univention-directory-notifier.inst",
          "management/univention-directory-notifier/debian/univention-directory-notifier.install",
          "management/univention-directory-notifier/debian/univention-directory-notifier.postinst",
          "management/univention-directory-notifier/univention-translog"
        ],
        "message": "Bug #48427 udn: Load transaction log into LDAP\n\nAdd tool to import /var/lib/univention-ldap/notify/transaction into LDAP\ncn=translog.\n\ncount: 10_000 -> 100_000\npercent: 10%\nsize: 1M -> 100M\n\nFix architecture dependant parsing of index file.\nSupport mode without reading the index on import.\nAllow 'stat' to be used without LDAP.\nPrepare for re-building the missing index file.\nFix bug where not the last line was parsed, but the last known\ntransaction.",
        "before_after_code_files": [
          "management/univention-directory-notifier/02univention-directory-notifier.inst||management/univention-directory-notifier/02univention-directory-notifier.inst",
          "management/univention-directory-notifier/debian/univention-directory-notifier.install||management/univention-directory-notifier/debian/univention-directory-notifier.install",
          "management/univention-directory-notifier/debian/univention-directory-notifier.postinst||management/univention-directory-notifier/debian/univention-directory-notifier.postinst"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "management/univention-directory-notifier/02univention-directory-notifier.inst||management/univention-directory-notifier/02univention-directory-notifier.inst": [
          "File: management/univention-directory-notifier/02univention-directory-notifier.inst -> management/univention-directory-notifier/02univention-directory-notifier.inst",
          "--- Hunk 1 ---",
          "[Context before]",
          "35: . /usr/share/univention-join/joinscripthelper.lib",
          "36: joinscript_init",
          "40: /etc/init.d/univention-directory-notifier start",
          "42: joinscript_save_current_version",
          "43: exit 0",
          "",
          "[Removed Lines]",
          "38: ln -sf /etc/runit/univention-directory-notifier /etc/runit/univention/univention-directory-notifier",
          "",
          "[Added Lines]",
          "38: ln -snf /etc/runit/univention-directory-notifier /etc/runit/univention/univention-directory-notifier",
          "",
          "---------------"
        ],
        "management/univention-directory-notifier/debian/univention-directory-notifier.install||management/univention-directory-notifier/debian/univention-directory-notifier.install": [
          "File: management/univention-directory-notifier/debian/univention-directory-notifier.install -> management/univention-directory-notifier/debian/univention-directory-notifier.install",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: 15univention-directory-notifier-post.inst usr/lib/univention-install/",
          "4: univention-replicate-one usr/sbin/",
          "5: etc/network/if-post-down.d/univention-directory-notifier etc/network/if-post-down.d/",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6: univention-translog usr/share/univention-directory-notifier/",
          "",
          "---------------"
        ],
        "management/univention-directory-notifier/debian/univention-directory-notifier.postinst||management/univention-directory-notifier/debian/univention-directory-notifier.postinst": [
          "File: management/univention-directory-notifier/debian/univention-directory-notifier.postinst -> management/univention-directory-notifier/debian/univention-directory-notifier.postinst",
          "--- Hunk 1 ---",
          "[Context before]",
          "102: call_joinscript 02univention-directory-notifier.inst",
          "104: if [ -h /etc/runit/univention/univention-ldap-notifier ]; then",
          "106:     rm /etc/runit/univention/univention-ldap-notifier",
          "107: fi",
          "",
          "[Removed Lines]",
          "105:  ln -sf /etc/runit/univention-directory-notifier /etc/runit/univention/univention-directory-notifier",
          "",
          "[Added Lines]",
          "105:  ln -snf /etc/runit/univention-directory-notifier /etc/runit/univention/univention-directory-notifier",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "114:   /etc/init.d/univention-directory-notifier restart || :",
          "115:  else  # upgrade",
          "116:   ucr set notifier/protocol/version?2",
          "118:  fi",
          "119: fi",
          "",
          "[Removed Lines]",
          "117:   /etc/init.d/univention-directory-notifier crestart || :",
          "",
          "[Added Lines]",
          "118:   if [ -f /var/univention-join/joined ] &&",
          "119:    [ -s /var/lib/univention-ldap/notify/transaction ] &&",
          "120:    dpkg --compare-versions \"$2\" lt-nl 12.0.1-3",
          "121:   then",
          "122:    if /etc/init.d/univention-directory-notifier status >/dev/null",
          "123:    then",
          "124:     /etc/init.d/univention-directory-notifier stop",
          "125:     /usr/share/univention-directory-notifier/univention-translog --lenient import",
          "126:     /etc/init.d/univention-directory-notifier start",
          "127:    else",
          "128:     /usr/share/univention-directory-notifier/univention-translog --lenient import",
          "129:    fi",
          "130:   else",
          "131:    /etc/init.d/univention-directory-notifier crestart || :",
          "132:   fi",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "43d98bf91c150b12964b883d73166fdae73bcacf",
      "candidate_info": {
        "commit_hash": "43d98bf91c150b12964b883d73166fdae73bcacf",
        "repo": "univention/univention-corporate-server",
        "commit_url": "https://github.com/univention/univention-corporate-server/commit/43d98bf91c150b12964b883d73166fdae73bcacf",
        "files": [
          "management/univention-management-console-module-diagnostic/debian/changelog",
          "management/univention-management-console-module-diagnostic/umc/python/diagnostic/plugins/03_check_notifier_replication.py"
        ],
        "message": "Bug #48427 umc-diag: Use UDN protocol version 3",
        "before_after_code_files": [
          "management/univention-management-console-module-diagnostic/umc/python/diagnostic/plugins/03_check_notifier_replication.py||management/univention-management-console-module-diagnostic/umc/python/diagnostic/plugins/03_check_notifier_replication.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "management/univention-management-console-module-diagnostic/umc/python/diagnostic/plugins/03_check_notifier_replication.py||management/univention-management-console-module-diagnostic/umc/python/diagnostic/plugins/03_check_notifier_replication.py": [
          "File: management/univention-management-console-module-diagnostic/umc/python/diagnostic/plugins/03_check_notifier_replication.py -> management/univention-management-console-module-diagnostic/umc/python/diagnostic/plugins/03_check_notifier_replication.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "51: def get_id(master, cmd='GET_ID'):",
          "55:  sock.recv(100)",
          "57:  sock.send('MSGID: 1\\n{cmd}\\n\\n'.format(cmd=cmd))",
          "",
          "[Removed Lines]",
          "52:  sock = socket.create_connection((master, 6669))",
          "54:  sock.send('Version: 2\\nCapabilities: \\n\\n')",
          "",
          "[Added Lines]",
          "52:  sock = socket.create_connection((master, 6669), 60.0)",
          "54:  sock.send('Version: 3\\nCapabilities: \\n\\n')",
          "",
          "---------------"
        ]
      }
    }
  ]
}