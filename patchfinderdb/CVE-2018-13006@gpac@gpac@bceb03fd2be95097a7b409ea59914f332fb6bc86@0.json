{
  "cve_id": "CVE-2018-13006",
  "cve_desc": "An issue was discovered in MP4Box in GPAC 0.7.1. There is a heap-based buffer over-read in the isomedia/box_dump.c function hdlr_dump.",
  "repo": "gpac/gpac",
  "patch_hash": "bceb03fd2be95097a7b409ea59914f332fb6bc86",
  "patch_info": {
    "commit_hash": "bceb03fd2be95097a7b409ea59914f332fb6bc86",
    "repo": "gpac/gpac",
    "commit_url": "https://github.com/gpac/gpac/commit/bceb03fd2be95097a7b409ea59914f332fb6bc86",
    "files": [
      "include/gpac/internal/isomedia_dev.h",
      "src/isomedia/box_code_base.c",
      "src/isomedia/box_dump.c"
    ],
    "message": "fixed 2 possible heap overflows (inc. #1088)",
    "before_after_code_files": [
      "include/gpac/internal/isomedia_dev.h||include/gpac/internal/isomedia_dev.h",
      "src/isomedia/box_code_base.c||src/isomedia/box_code_base.c",
      "src/isomedia/box_dump.c||src/isomedia/box_dump.c"
    ]
  },
  "patch_diff": {
    "include/gpac/internal/isomedia_dev.h||include/gpac/internal/isomedia_dev.h": [
      "File: include/gpac/internal/isomedia_dev.h -> include/gpac/internal/isomedia_dev.h",
      "--- Hunk 1 ---",
      "[Context before]",
      "3710:   char __ptype[5];\\",
      "3711:   strcpy(__ptype, gf_4cc_to_str(__parent->type) );\\",
      "3712:   GF_LOG(GF_LOG_WARNING, GF_LOG_CONTAINER, (\"[iso file] extra box %s found in %s, deleting\\n\", gf_4cc_to_str(__abox->type), __ptype)); \\",
      "3714:   return GF_OK;\\",
      "3715:  }",
      "",
      "[Removed Lines]",
      "3713:   gf_isom_box_del(a);\\",
      "",
      "[Added Lines]",
      "3713:   gf_isom_box_del(__abox);\\",
      "",
      "---------------"
    ],
    "src/isomedia/box_code_base.c||src/isomedia/box_code_base.c": [
      "File: src/isomedia/box_code_base.c -> src/isomedia/box_code_base.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "634:  i = 0;",
      "636:   i++;",
      "637:  }",
      "",
      "[Removed Lines]",
      "635:  while ( (tmpName[i] != 0) && (i < to_read) ) {",
      "",
      "[Added Lines]",
      "635:  while ( (i < to_read) && (tmpName[i] != 0) ) {",
      "",
      "---------------"
    ],
    "src/isomedia/box_dump.c||src/isomedia/box_dump.c": [
      "File: src/isomedia/box_dump.c -> src/isomedia/box_dump.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "484: {",
      "485:  GF_HandlerBox *p = (GF_HandlerBox *)a;",
      "486:  gf_isom_box_dump_start(a, \"HandlerBox\", trace);",
      "488:   fprintf(trace, \"hdlrType=\\\"%s\\\" Name=\\\"%s\\\" \", gf_4cc_to_str(p->handlerType), p->nameUTF8+1);",
      "489:  } else {",
      "490:   fprintf(trace, \"hdlrType=\\\"%s\\\" Name=\\\"%s\\\" \", gf_4cc_to_str(p->handlerType), p->nameUTF8);",
      "",
      "[Removed Lines]",
      "487:  if (p->nameUTF8 && (u32) p->nameUTF8[0] == strlen(p->nameUTF8+1)) {",
      "",
      "[Added Lines]",
      "487:  if (p->nameUTF8 && (u32) p->nameUTF8[0] == strlen(p->nameUTF8)-1) {",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "4157:   fprintf(trace, \" maxPicWidth=\\\"%u\\\" maxPicHeight=\\\"%u\\\"\", op->maxPicWidth, op->maxPicHeight);",
      "4158:   fprintf(trace, \" maxChromaFormat=\\\"%u\\\" maxBitDepth=\\\"%u\\\"\", op->maxChromaFormat, op->maxBitDepth);",
      "4159:   fprintf(trace, \" frame_rate_info_flag=\\\"%u\\\" bit_rate_info_flag=\\\"%u\\\"\", op->frame_rate_info_flag, op->bit_rate_info_flag);",
      "4161:    fprintf(trace, \" avgFrameRate=\\\"%u\\\" constantFrameRate=\\\"%u\\\"\", op->avgFrameRate, op->constantFrameRate);",
      "4163:    fprintf(trace, \" maxBitRate=\\\"%u\\\" avgBitRate=\\\"%u\\\"\", op->maxBitRate, op->avgBitRate);",
      "4164:   fprintf(trace, \"/>\\n\");",
      "4165:  }",
      "",
      "[Removed Lines]",
      "4160:   if (op->frame_rate_info_flag)",
      "4162:   if (op->bit_rate_info_flag)",
      "",
      "[Added Lines]",
      "4160:   if (op->frame_rate_info_flag)",
      "4162:   if (op->bit_rate_info_flag)",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "4507:   fprintf(trace, \"\\\"  KID=\\\"\");",
      "4508:  }",
      "4509:  dump_data_hex(trace, (char *) ptr->KID, 16);",
      "4511:   fprintf(trace, \"\\\" crypt_byte_block=\\\"%d\\\" skip_byte_block=\\\"%d\", ptr->crypt_byte_block, ptr->skip_byte_block);",
      "4512:  fprintf(trace, \"\\\">\\n\");",
      "4513:  gf_isom_box_dump_done(\"TrackEncryptionBox\", a, trace);",
      "",
      "[Removed Lines]",
      "4510:  if (ptr->version)",
      "",
      "[Added Lines]",
      "4510:  if (ptr->version)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e762660d0875aded9710233c64f4507ab70981d2",
      "candidate_info": {
        "commit_hash": "e762660d0875aded9710233c64f4507ab70981d2",
        "repo": "gpac/gpac",
        "commit_url": "https://github.com/gpac/gpac/commit/e762660d0875aded9710233c64f4507ab70981d2",
        "files": [
          "include/gpac/internal/isomedia_dev.h"
        ],
        "message": "fix for duplicated boxes in dump mode\n\napplies to #1090, #1077, #1080, #1166",
        "before_after_code_files": [
          "include/gpac/internal/isomedia_dev.h||include/gpac/internal/isomedia_dev.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "include/gpac/internal/isomedia_dev.h||include/gpac/internal/isomedia_dev.h"
          ],
          "candidate": [
            "include/gpac/internal/isomedia_dev.h||include/gpac/internal/isomedia_dev.h"
          ]
        }
      },
      "candidate_diff": {
        "include/gpac/internal/isomedia_dev.h||include/gpac/internal/isomedia_dev.h": [
          "File: include/gpac/internal/isomedia_dev.h -> include/gpac/internal/isomedia_dev.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "4018: #define ERROR_ON_DUPLICATED_BOX(__abox, __parent) { \\",
          "4019:   char __ptype[5];\\",
          "4020:   strcpy(__ptype, gf_4cc_to_str(__parent->type) );\\",
          "4021:   GF_LOG(GF_LOG_WARNING, GF_LOG_CONTAINER, (\"[iso file] extra box %s found in %s, deleting\\n\", gf_4cc_to_str(__abox->type), __ptype)); \\",
          "4023:   __abox=NULL;\\",
          "4024:   return GF_OK;\\",
          "4025:  }",
          "",
          "[Removed Lines]",
          "4022:   gf_isom_box_del(__abox);\\",
          "",
          "[Added Lines]",
          "4019:   extern Bool use_dump_mode;\\",
          "4023:   if (!use_dump_mode) gf_isom_box_del(__abox);\\",
          "",
          "---------------"
        ]
      }
    }
  ]
}