{
  "cve_id": "CVE-2017-13083",
  "cve_desc": "Akeo Consulting Rufus prior to version 2.17.1187 does not adequately validate the integrity of updates downloaded over HTTP, allowing an attacker to easily convince a user to execute arbitrary code",
  "repo": "pbatard/rufus",
  "patch_hash": "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
  "patch_info": {
    "commit_hash": "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
    "repo": "pbatard/rufus",
    "commit_url": "https://github.com/pbatard/rufus/commit/c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
    "files": [
      "res/localization/rufus.loc",
      "src/pki.c",
      "src/rufus.rc",
      "src/stdlg.c"
    ],
    "message": "[pki] fix https://www.kb.cert.org/vuls/id/403768\n\n* This commit effectively fixes https://www.kb.cert.org/vuls/id/403768 (CVE-2017-13083) as\n  it is described per its revision 11, which is the latest revision at the time of this commit,\n  by disabling Windows prompts, enacted during signature validation, that allow the user to\n  bypass the intended signature verification checks.\n* It needs to be pointed out that the vulnerability (\"allow(ing) the use of a self-signed\n  certificate\"), which relies on the end-user actively ignoring a Windows prompt that tells\n  them that the update failed the signature validation whilst also advising against running it,\n  is being fully addressed, even as the update protocol remains HTTP.\n* It also need to be pointed out that the extended delay (48 hours) between the time the\n  vulnerability was reported and the moment it is fixed in our codebase has to do with\n  the fact that the reporter chose to deviate from standard security practices by not\n  disclosing the details of the vulnerability with us, be it publicly or privately,\n  before creating the cert.org report. The only advance notification we received was a\n  generic note about the use of HTTP vs HTTPS, which, as have established, is not\n  immediately relevant to addressing the reported vulnerability.\n* Closes #1009\n* Note: The other vulnerability scenario described towards the end of #1009, which\n  doesn't have to do with the \"lack of CA checking\", will be addressed separately.",
    "before_after_code_files": [
      "res/localization/rufus.loc||res/localization/rufus.loc",
      "src/pki.c||src/pki.c",
      "src/rufus.rc||src/rufus.rc",
      "src/stdlg.c||src/stdlg.c"
    ]
  },
  "patch_diff": {
    "res/localization/rufus.loc||res/localization/rufus.loc": [
      "File: res/localization/rufus.loc -> res/localization/rufus.loc",
      "--- Hunk 1 ---",
      "[Context before]",
      "487: # eg. \"Partitioning (MBR)...\"",
      "488: t MSG_238 \"Partitioning (%s)...\"",
      "489: t MSG_239 \"Deleting partitions...\"",
      "490: t MSG_241 \"Downloading: %0.1f%%\"",
      "491: t MSG_242 \"Failed to download file.\"",
      "492: t MSG_243 \"Checking for Rufus updates...\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "490: t MSG_240 \"The signature for the downloaded update can not be validated. This could mean that your \"",
      "491:  \"system is improperly configured for signature validation or indicate a malicious download.\\n\\n\"",
      "492:  \"The download will be deleted. Please check the log for more details.\"",
      "",
      "---------------"
    ],
    "src/pki.c||src/pki.c": [
      "File: src/pki.c -> src/pki.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "53:  static char error_string[64];",
      "54:  DWORD error_code = GetLastError();",
      "57:   return WindowsErrorString();",
      "59:  switch (error_code) {",
      "",
      "[Removed Lines]",
      "56:  if ((error_code >> 16) != 0x8009)",
      "",
      "[Added Lines]",
      "56:  if (((error_code >> 16) != 0x8009) && ((error_code >> 16) != 0x800B))",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "113:   return \"Cannot complete usage check.\";",
      "114:  case CRYPT_E_NO_TRUSTED_SIGNER:",
      "115:   return \"None of the signers of the cryptographic message or certificate trust list is trusted.\";",
      "116:  default:",
      "117:   static_sprintf(error_string, \"Unknown PKI error 0x%08lX\", error_code);",
      "118:   return error_string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "116:  case CERT_E_UNTRUSTEDROOT:",
      "117:   return \"The root certificate is not trusted.\";",
      "118:  case TRUST_E_NOSIGNATURE:",
      "119:   return \"Not digitally signed.\";",
      "120:  case TRUST_E_EXPLICIT_DISTRUST:",
      "121:   return \"One of the certificates used was marked as untrusted by the user.\";",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "268:  }",
      "270:  trust_data.cbStruct = sizeof(trust_data);",
      "273:  trust_data.fdwRevocationChecks = WTD_REVOKE_WHOLECHAIN;",
      "",
      "[Removed Lines]",
      "271:  trust_data.dwUIChoice = WTD_UI_ALL;",
      "",
      "[Added Lines]",
      "283:  trust_data.dwUIChoice = WTD_UI_NONE;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "279:  r = WinVerifyTrust(NULL, &guid_generic_verify, &trust_data);",
      "280:  safe_free(trust_file.pcwszFilePath);",
      "282:  return r;",
      "283: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "293:  switch (r) {",
      "294:  case ERROR_SUCCESS:",
      "295:   break;",
      "296:  case TRUST_E_NOSIGNATURE:",
      "298:   uprintf(\"PKI: File does not appear to be signed: %s\", WinPKIErrorString());",
      "299:   MessageBoxExU(hDlg, lmprintf(MSG_284), lmprintf(MSG_283), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);",
      "300:   break;",
      "301:  default:",
      "302:   uprintf(\"PKI: Failed to validate signature: %s\", WinPKIErrorString());",
      "303:   MessageBoxExU(hDlg, lmprintf(MSG_240), lmprintf(MSG_283), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);",
      "304:   break;",
      "305:  }",
      "",
      "---------------"
    ],
    "src/rufus.rc||src/rufus.rc": [
      "File: src/rufus.rc -> src/rufus.rc",
      "--- Hunk 1 ---",
      "[Context before]",
      "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
      "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
      "35: EXSTYLE WS_EX_ACCEPTFILES",
      "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
      "38: BEGIN",
      "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
      "",
      "[Removed Lines]",
      "36: CAPTION \"Rufus 2.17.1186\"",
      "",
      "[Added Lines]",
      "36: CAPTION \"Rufus 2.17.1187\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "368: VS_VERSION_INFO VERSIONINFO",
      "371:  FILEFLAGSMASK 0x3fL",
      "372: #ifdef _DEBUG",
      "373:  FILEFLAGS 0x1L",
      "",
      "[Removed Lines]",
      "369:  FILEVERSION 2,17,1186,0",
      "370:  PRODUCTVERSION 2,17,1186,0",
      "",
      "[Added Lines]",
      "369:  FILEVERSION 2,17,1187,0",
      "370:  PRODUCTVERSION 2,17,1187,0",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "384:         BEGIN",
      "385:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
      "386:             VALUE \"FileDescription\", \"Rufus\"",
      "388:             VALUE \"InternalName\", \"Rufus\"",
      "389:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
      "390:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
      "391:             VALUE \"OriginalFilename\", \"rufus.exe\"",
      "392:             VALUE \"ProductName\", \"Rufus\"",
      "394:         END",
      "395:     END",
      "396:     BLOCK \"VarFileInfo\"",
      "",
      "[Removed Lines]",
      "387:             VALUE \"FileVersion\", \"2.17.1186\"",
      "393:             VALUE \"ProductVersion\", \"2.17.1186\"",
      "",
      "[Added Lines]",
      "387:             VALUE \"FileVersion\", \"2.17.1187\"",
      "393:             VALUE \"ProductVersion\", \"2.17.1187\"",
      "",
      "---------------"
    ],
    "src/stdlg.c||src/stdlg.c": [
      "File: src/stdlg.c -> src/stdlg.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1674:    case 2:  // Launch newer version and close this one",
      "1675:     Sleep(1000); // Add a delay on account of antivirus scanners",
      "1678:      break;",
      "1680:     memset(&si, 0, sizeof(si));",
      "1681:     memset(&pi, 0, sizeof(pi));",
      "",
      "[Removed Lines]",
      "1677:     if (ValidateSignature(hDlg, filepath) != NO_ERROR)",
      "",
      "[Added Lines]",
      "1677:     if (ValidateSignature(hDlg, filepath) != NO_ERROR) {",
      "1679:      _unlinkU(filepath);",
      "1680:      EnableWindow(GetDlgItem(hDlg, IDC_DOWNLOAD), FALSE);",
      "1682:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "92c05556d17769465ec161d5ad65cb2f2a7c03b4",
      "candidate_info": {
        "commit_hash": "92c05556d17769465ec161d5ad65cb2f2a7c03b4",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/92c05556d17769465ec161d5ad65cb2f2a7c03b4",
        "files": [
          "src/libcdio/iso9660/iso9660_fs.c",
          "src/rufus.rc"
        ],
        "message": "[iso] add a warning for unsupported multi-extent ISO-9660 files\n\n* This is related to issue #1007, which libcdio still needs to fix.",
        "before_after_code_files": [
          "src/libcdio/iso9660/iso9660_fs.c||src/libcdio/iso9660/iso9660_fs.c",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "src/libcdio/iso9660/iso9660_fs.c||src/libcdio/iso9660/iso9660_fs.c": [
          "File: src/libcdio/iso9660/iso9660_fs.c -> src/libcdio/iso9660/iso9660_fs.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "799:       }",
          "800:     }",
          "801:   }",
          "804:   iso9660_get_dtime(&(p_iso9660_dir->recording_time), true, &(p_stat->tm));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "803:   if (p_iso9660_dir->file_flags & ISO_MULTIEXTENT)",
          "804:   {",
          "805:     cdio_warn(\"Can't handle multi-extent file '%s' - Data will be truncated!\", p_stat->filename);",
          "806:     free(p_stat);",
          "807:     return NULL;",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.17.1196\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.17.1197\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "368: VS_VERSION_INFO VERSIONINFO",
          "371:  FILEFLAGSMASK 0x3fL",
          "372: #ifdef _DEBUG",
          "373:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "369:  FILEVERSION 2,17,1196,0",
          "370:  PRODUCTVERSION 2,17,1196,0",
          "",
          "[Added Lines]",
          "369:  FILEVERSION 2,17,1197,0",
          "370:  PRODUCTVERSION 2,17,1197,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "384:         BEGIN",
          "385:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "386:             VALUE \"FileDescription\", \"Rufus\"",
          "388:             VALUE \"InternalName\", \"Rufus\"",
          "389:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "390:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "391:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "392:             VALUE \"ProductName\", \"Rufus\"",
          "394:         END",
          "395:     END",
          "396:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "387:             VALUE \"FileVersion\", \"2.17.1196\"",
          "393:             VALUE \"ProductVersion\", \"2.17.1196\"",
          "",
          "[Added Lines]",
          "387:             VALUE \"FileVersion\", \"2.17.1197\"",
          "393:             VALUE \"ProductVersion\", \"2.17.1197\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "eb0890de0861fa204d8aae176aba1ed106145a30",
      "candidate_info": {
        "commit_hash": "eb0890de0861fa204d8aae176aba1ed106145a30",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/eb0890de0861fa204d8aae176aba1ed106145a30",
        "files": [
          "res/localization/rufus.loc",
          "src/rufus.rc"
        ],
        "message": "[loc] update Romanian translation to latest",
        "before_after_code_files": [
          "res/localization/rufus.loc||res/localization/rufus.loc",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "res/localization/rufus.loc||res/localization/rufus.loc": [
          "File: res/localization/rufus.loc -> res/localization/rufus.loc",
          "--- Hunk 1 ---",
          "[Context before]",
          "13056: ################################################################################",
          "13057: l \"ro-RO\" \"Romanian (Rom\u00e2n\u0103)\" 0x0418, 0x0818",
          "13059: b \"en-US\"",
          "13061: g IDD_DIALOG",
          "",
          "[Removed Lines]",
          "13058: v 1.0.20",
          "",
          "[Added Lines]",
          "13058: v 1.0.21",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "13469:  \"indica o anumit\u0103 form\u0103 de activitate d\u0103un\u0103toare...\\nSunte\u021bi sigur c\u0103 dori\u021bi s\u0103 executa\u021bi acest fi\u0219ier?\"",
          "13470: t MSG_286 \"Unitatea zero: %0.1f%% finisat\"",
          "13471: t MSG_287 \"Detectarea unit\u0103\u021bilor mobile de baz\u0103 non-USB\"",
          "13473: ################################################################################",
          "13474: l \"ru-RU\" \"Russian (\u0420\u0443\u0441\u0441\u043a\u0438\u0439)\" 0x0419, 0x0819",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "13472: t MSG_288 \"Lips\u0103 privilegii ridicate\"",
          "13473: t MSG_289 \"Aceast\u0103 aplica\u021bie ruleaz\u0103 numai cu privilegii ridicate\"",
          "13474: t MSG_290 \"Indexare fi\u0219ier\"",
          "13475: t MSG_291 \"Selectare versiune\"",
          "13476: t MSG_292 \"Selecta\u021bi versiunea de Windows pentru instalare: \"",
          "13477: t MSG_293 \"Versiune Windows neacceptat\u0103\"",
          "13478: t MSG_294 \"Aceast\u0103 versiune Windows nu mai este suportat\u0103 de Rufus.\"",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.12.1040\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.12.1041\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,12,1040,0",
          "338:  PRODUCTVERSION 2,12,1040,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,12,1041,0",
          "338:  PRODUCTVERSION 2,12,1041,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.12.1040\"",
          "361:             VALUE \"ProductVersion\", \"2.12.1040\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.12.1041\"",
          "361:             VALUE \"ProductVersion\", \"2.12.1041\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bfecb9e29f010cdd9d7fee6fd63d1361b9fcb5fe",
      "candidate_info": {
        "commit_hash": "bfecb9e29f010cdd9d7fee6fd63d1361b9fcb5fe",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/bfecb9e29f010cdd9d7fee6fd63d1361b9fcb5fe",
        "files": [
          "res/localization/rufus.loc",
          "src/rufus.rc"
        ],
        "message": "[loc] Update Portuguese (Brazilian) translation\n\n* Closes #974",
        "before_after_code_files": [
          "res/localization/rufus.loc||res/localization/rufus.loc",
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "res/localization/rufus.loc||res/localization/rufus.loc",
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "res/localization/rufus.loc||res/localization/rufus.loc": [
          "File: res/localization/rufus.loc -> res/localization/rufus.loc",
          "--- Hunk 1 ---",
          "[Context before]",
          "12311: # Dialog that appears when a new version is available",
          "12312: g IDD_NEW_VERSION",
          "12313: t IDD_NEW_VERSION \"Procurar atualiza\u00e7\u00f5es de Rufus\"",
          "12315: t IDC_WEBSITE \"Clique aqui para ir ao Site de Rufus\"",
          "12316: t IDS_NEW_VERSION_NOTES_GRP \"Sobre esta vers\u00e3o\"",
          "12317: t IDCANCEL \"Fechar\"",
          "",
          "[Removed Lines]",
          "12314: t IDS_NEW_VERSION_AVAIL_TXT \"Nova vers\u00e3o dispon\u00edvel. Por favor, fa\u00e7a Download da \u00faltima vers\u00e3o!\"",
          "",
          "[Added Lines]",
          "12314: t IDS_NEW_VERSION_AVAIL_TXT \"Nova vers\u00e3o dispon\u00edvel. Por favor, fa\u00e7a o download da \u00faltima vers\u00e3o!\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "12364: t MSG_036 \"Imagem ISO\"",
          "12365: t MSG_037 \"Aplica\u00e7\u00e3o\"",
          "12366: t MSG_038 \"Abortar\"",
          "12368: t MSG_040 \"Descarregar\"",
          "12369: t MSG_041 \"Opera\u00e7\u00e3o cancelada pelo usu\u00e1rio\"",
          "12370: t MSG_042 \"Erro\"",
          "",
          "[Removed Lines]",
          "12367: t MSG_039 \"Inciar\"",
          "",
          "[Added Lines]",
          "12367: t MSG_039 \"Iniciar\"",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "12644: t MSG_275 \"A imagem que voc\u00ea selecionou \u00e9 do tipo 'ISOHybrid'. Isso significa que pode ser escrita em \"",
          "12645:  \"modo %s (c\u00f3pia de arquivo) ou modo %s (imagem de disco).\\n\"",
          "12646:  \"Rufus recomenda usar o modo %s, para que voc\u00ea sempre tenha acesso total ao drive ap\u00f3s a grava\u00e7\u00e3o.\\n\"",
          "12649: t MSG_276 \"Gravar no modo %s (Recomendado)\"",
          "12650: t MSG_277 \"Gravar no modo %s\"",
          "12651: t MSG_278 \"Tipo de Boot\"",
          "",
          "[Removed Lines]",
          "12647:  \"No entanto, se voc\u00ea encontrar algum erro durante o boot, voc\u00ea pode tentar gravar novamente pelo modo %s.\\n\\n\"",
          "12648:  \"Por favor selecione o modo que deseja usar para gravar esta imagem:\"",
          "",
          "[Added Lines]",
          "12647:  \"No entanto, se voc\u00ea encontrar algum erro durante o boot, tente gravar novamente pelo modo %s.\\n\\n\"",
          "12648:  \"Por favor, selecione o modo que deseja usar para gravar essa imagem:\"",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "12975: t MSG_169 \"Cria uma parti\u00e7\u00e3o extra oculta e e tenta alinhar limites das parti\u00e7\u00f5es. \"",
          "12976:  \"Isto pode melhorar a dete\u00e7\u00e3o do USB inicializ\u00e1vel para as BIOS antigas\"",
          "12977: t MSG_170 \"Ativa a dete\u00e7\u00e3o de discos r\u00edgidos port\u00e1teis USB. USE-O POR SEU PR\u00d3PRIO RISCO!!!\"",
          "12979: t MSG_172 \"Informa\u00e7\u00e3o da licen\u00e7a e cr\u00e9ditos\"",
          "12980: t MSG_173 \"Clique para selecionar...\"",
          "12981: # The following will appear in the about dialog",
          "",
          "[Removed Lines]",
          "12978: t MSG_171 \"Iniciar a opera\u00e7\u00e3o de formata\u00e7\u00e3o.\\nTodos os dados no dispositivo ser\u00e3o DESTRUIDOS!\"",
          "",
          "[Added Lines]",
          "12978: t MSG_171 \"Iniciar a opera\u00e7\u00e3o de formata\u00e7\u00e3o.\\nTodos os dados no dispositivo ser\u00e3o DESTRU\u00cdDOS!\"",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.15.1120\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.15.1121\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,15,1120,0",
          "338:  PRODUCTVERSION 2,15,1120,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,15,1121,0",
          "338:  PRODUCTVERSION 2,15,1121,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.15.1120\"",
          "361:             VALUE \"ProductVersion\", \"2.15.1120\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.15.1121\"",
          "361:             VALUE \"ProductVersion\", \"2.15.1121\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "42e8d714e8949ccc1d447d9d33a94d6f4e6ca179",
      "candidate_info": {
        "commit_hash": "42e8d714e8949ccc1d447d9d33a94d6f4e6ca179",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/42e8d714e8949ccc1d447d9d33a94d6f4e6ca179",
        "files": [
          "ChangeLog.txt",
          "src/rufus.rc"
        ],
        "message": "v2.14 (build 1086)",
        "before_after_code_files": [
          "src/rufus.rc||src/rufus.rc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.14.1085\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.14.1086\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,14,1085,0",
          "338:  PRODUCTVERSION 2,14,1085,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,14,1086,0",
          "338:  PRODUCTVERSION 2,14,1086,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.14.1085\"",
          "361:             VALUE \"ProductVersion\", \"2.14.1085\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.14.1086\"",
          "361:             VALUE \"ProductVersion\", \"2.14.1086\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "477ff95f93f92d8f15127d7d6ce71e36bbfa3b5e",
      "candidate_info": {
        "commit_hash": "477ff95f93f92d8f15127d7d6ce71e36bbfa3b5e",
        "repo": "pbatard/rufus",
        "commit_url": "https://github.com/pbatard/rufus/commit/477ff95f93f92d8f15127d7d6ce71e36bbfa3b5e",
        "files": [
          "src/drive.c",
          "src/drive.h",
          "src/format.c",
          "src/rufus.rc",
          "src/syslinux.c"
        ],
        "message": "[core] display device paths in GetHandle()\n\n* Also reorder bLockDrive and bWriteAccess parameters",
        "before_after_code_files": [
          "src/drive.c||src/drive.c",
          "src/drive.h||src/drive.h",
          "src/format.c||src/format.c",
          "src/rufus.rc||src/rufus.rc",
          "src/syslinux.c||src/syslinux.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/rufus.rc||src/rufus.rc"
          ],
          "candidate": [
            "src/rufus.rc||src/rufus.rc"
          ]
        }
      },
      "candidate_diff": {
        "src/drive.c||src/drive.c": [
          "File: src/drive.c -> src/drive.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "59: RUFUS_DRIVE_INFO SelectedDrive;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "60: extern BOOL lock_drive;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "121: {",
          "122:  int i;",
          "123:  DWORD size;",
          "124:  HANDLE hDrive = INVALID_HANDLE_VALUE;",
          "127:   goto out;",
          "128:  for (i = 0; i < DRIVE_ACCESS_RETRIES; i++) {",
          "134:   hDrive = CreateFileA(Path, GENERIC_READ|(bWriteAccess?GENERIC_WRITE:0),",
          "136:   if (hDrive != INVALID_HANDLE_VALUE)",
          "137:    break;",
          "138:   if ((GetLastError() != ERROR_SHARING_VIOLATION) && (GetLastError() != ERROR_ACCESS_DENIED))",
          "139:    break;",
          "141:    uprintf(\"Waiting for access...\");",
          "142:   Sleep(DRIVE_ACCESS_TIMEOUT / DRIVE_ACCESS_RETRIES);",
          "143:  }",
          "144:  if (hDrive == INVALID_HANDLE_VALUE) {",
          "146:   goto out;",
          "147:  }",
          "149:  if (bWriteAccess) {",
          "151:  }",
          "153:  if (bLockDrive) {",
          "",
          "[Removed Lines]",
          "120: static HANDLE GetHandle(char* Path, BOOL bWriteAccess, BOOL bLockDrive, BOOL bWriteShare)",
          "126:  if (Path == NULL)",
          "135:    FILE_SHARE_READ|(bWriteShare?FILE_SHARE_WRITE:0), NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);",
          "140:   if (i == 0)",
          "145:   uprintf(\"Could not open drive %s: %s\\n\", Path, WindowsErrorString());",
          "150:   uprintf(\"Opened drive %s for write access\\n\", Path);",
          "",
          "[Added Lines]",
          "121: static HANDLE GetHandle(char* Path, BOOL bLockDrive, BOOL bWriteAccess, BOOL bWriteShare)",
          "126:  char DevPath[MAX_PATH];",
          "128:  if ((safe_strlen(Path) < 5) || (Path[0] != '\\\\') || (Path[1] != '\\\\') || (Path[3] != '\\\\'))",
          "133:  if (QueryDosDeviceA(&Path[4], DevPath, sizeof(DevPath)) == 0)",
          "134:   strcpy(DevPath, \"???\");",
          "143:    FILE_SHARE_READ|((bWriteAccess && bWriteShare)?FILE_SHARE_WRITE:0),",
          "144:    NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);",
          "149:   if (i == 0) {",
          "151:   } else if (!lock_drive && bWriteAccess && !bWriteShare && (i > (2*DRIVE_ACCESS_RETRIES)/3)) {",
          "154:    uprintf(\"Can't access %s - Retrying with write sharing enabled...\");",
          "155:    bWriteShare = TRUE;",
          "156:   }",
          "160:   uprintf(\"Could not open %s [%s]: %s\\n\", Path, DevPath, WindowsErrorString());",
          "165:   uprintf(\"Opened %s [%s] for write access\\n\", Path, DevPath);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "163:    Sleep(DRIVE_ACCESS_TIMEOUT/DRIVE_ACCESS_RETRIES);",
          "164:   }",
          "167:   safe_closehandle(hDrive);",
          "168:  }",
          "",
          "[Removed Lines]",
          "166:   uprintf(\"Could not get exclusive access to device %s: %s\\n\", Path, WindowsErrorString());",
          "",
          "[Added Lines]",
          "181:   uprintf(\"Could not get exclusive access to %s [%s]: %s\\n\", Path, DevPath, WindowsErrorString());",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "194: {",
          "195:  HANDLE hPhysical = INVALID_HANDLE_VALUE;",
          "196:  char* PhysicalPath = GetPhysicalName(DriveIndex);",
          "198:  safe_free(PhysicalPath);",
          "199:  return hPhysical;",
          "200: }",
          "",
          "[Removed Lines]",
          "193: HANDLE GetPhysicalHandle(DWORD DriveIndex, BOOL bWriteAccess, BOOL bLockDrive)",
          "197:  hPhysical = GetHandle(PhysicalPath, bWriteAccess, bLockDrive, FALSE);",
          "",
          "[Added Lines]",
          "208: HANDLE GetPhysicalHandle(DWORD DriveIndex, BOOL bLockDrive, BOOL bWriteAccess)",
          "212:  hPhysical = GetHandle(PhysicalPath, bLockDrive, bWriteAccess, FALSE);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "319: {",
          "320:  HANDLE hLogical = INVALID_HANDLE_VALUE;",
          "321:  char* LogicalPath = GetLogicalName(DriveIndex, FALSE, FALSE);",
          "",
          "[Removed Lines]",
          "318: HANDLE GetLogicalHandle(DWORD DriveIndex, BOOL bWriteAccess, BOOL bLockDrive, BOOL bWriteShare)",
          "",
          "[Added Lines]",
          "332: HANDLE GetLogicalHandle(DWORD DriveIndex, BOOL bLockDrive, BOOL bWriteAccess, BOOL bWriteShare)",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "325:   return NULL;",
          "326:  }",
          "329:  free(LogicalPath);",
          "330:  return hLogical;",
          "331: }",
          "",
          "[Removed Lines]",
          "328:  hLogical = GetHandle(LogicalPath, bWriteAccess, bLockDrive, bWriteShare);",
          "",
          "[Added Lines]",
          "342:  hLogical = GetHandle(LogicalPath, bLockDrive, bWriteAccess, bWriteShare);",
          "",
          "---------------"
        ],
        "src/drive.h||src/drive.h": [
          "File: src/drive.h -> src/drive.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "79: BOOL SetAutoMount(BOOL enable);",
          "80: BOOL GetAutoMount(BOOL* enabled);",
          "81: char* GetPhysicalName(DWORD DriveIndex);",
          "83: char* GetLogicalName(DWORD DriveIndex, BOOL bKeepTrailingBackslash, BOOL bSilent);",
          "84: BOOL WaitForLogical(DWORD DriveIndex);",
          "86: int GetDriveNumber(HANDLE hDrive, char* path);",
          "87: BOOL GetDriveLetters(DWORD DriveIndex, char* drive_letters);",
          "88: UINT GetDriveTypeFromIndex(DWORD DriveIndex);",
          "",
          "[Removed Lines]",
          "82: HANDLE GetPhysicalHandle(DWORD DriveIndex, BOOL bWriteAccess, BOOL bLockDrive);",
          "85: HANDLE GetLogicalHandle(DWORD DriveIndex, BOOL bWriteAccess, BOOL bLockDrive, BOOL bWriteShare);",
          "",
          "[Added Lines]",
          "82: HANDLE GetPhysicalHandle(DWORD DriveIndex, BOOL bLockDrive, BOOL bWriteAccess);",
          "85: HANDLE GetLogicalHandle(DWORD DriveIndex, BOOL bLockDrive, BOOL bWriteAccess, BOOL bWriteShare);",
          "",
          "---------------"
        ],
        "src/format.c||src/format.c": [
          "File: src/format.c -> src/format.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1641:   extra_partitions = XP_COMPAT;",
          "1643:  PrintInfoDebug(0, MSG_225);",
          "1645:  if (hPhysicalDrive == INVALID_HANDLE_VALUE) {",
          "1646:   FormatStatus = ERROR_SEVERITY_ERROR|FAC(FACILITY_STORAGE)|ERROR_OPEN_FAILED;",
          "1647:   goto out;",
          "",
          "[Removed Lines]",
          "1644:  hPhysicalDrive = GetPhysicalHandle(DriveIndex, TRUE, lock_drive);",
          "",
          "[Added Lines]",
          "1644:  hPhysicalDrive = GetPhysicalHandle(DriveIndex, lock_drive, TRUE);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1683:  uprintf(\"Will use '%c:' as volume mountpoint\\n\", drive_name[0]);",
          "1687:  if (hLogicalVolume == INVALID_HANDLE_VALUE) {",
          "1688:   uprintf(\"Could not lock volume\\n\");",
          "1689:   FormatStatus = ERROR_SEVERITY_ERROR|FAC(FACILITY_STORAGE)|ERROR_OPEN_FAILED;",
          "",
          "[Removed Lines]",
          "1686:  hLogicalVolume = GetLogicalHandle(DriveIndex, FALSE, TRUE, FALSE);",
          "",
          "[Added Lines]",
          "1686:  hLogicalVolume = GetLogicalHandle(DriveIndex, TRUE, FALSE, FALSE);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1925:   } else {",
          "1929:    if ((hLogicalVolume == INVALID_HANDLE_VALUE) || (hLogicalVolume == NULL)) {",
          "1930:     uprintf(\"Could not re-mount volume for partition boot record access\\n\");",
          "1931:     FormatStatus = ERROR_SEVERITY_ERROR|FAC(FACILITY_STORAGE)|ERROR_OPEN_FAILED;",
          "",
          "[Removed Lines]",
          "1928:    hLogicalVolume = GetLogicalHandle(DriveIndex, TRUE, FALSE, FALSE);",
          "",
          "[Added Lines]",
          "1928:    hLogicalVolume = GetLogicalHandle(DriveIndex, FALSE, TRUE, FALSE);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2074:  LastRefresh = 0;",
          "2075:  switch (img_save->Type) {",
          "2076:  case IMG_SAVE_TYPE_VHD:",
          "2078:   break;",
          "2079:  case IMG_SAVE_TYPE_ISO:",
          "2080:   hPhysicalDrive = CreateFileA(img_save->DevicePath, GENERIC_READ, FILE_SHARE_READ,",
          "",
          "[Removed Lines]",
          "2077:   hPhysicalDrive = GetPhysicalHandle(img_save->DeviceNum, FALSE, TRUE);",
          "",
          "[Added Lines]",
          "2077:   hPhysicalDrive = GetPhysicalHandle(img_save->DeviceNum, TRUE, FALSE);",
          "",
          "---------------"
        ],
        "src/rufus.rc||src/rufus.rc": [
          "File: src/rufus.rc -> src/rufus.rc",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: IDD_DIALOG DIALOGEX 12, 12, 242, 376",
          "34: STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU",
          "35: EXSTYLE WS_EX_ACCEPTFILES",
          "37: FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0",
          "38: BEGIN",
          "39:     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8",
          "",
          "[Removed Lines]",
          "36: CAPTION \"Rufus 2.13.1082\"",
          "",
          "[Added Lines]",
          "36: CAPTION \"Rufus 2.13.1083\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "336: VS_VERSION_INFO VERSIONINFO",
          "339:  FILEFLAGSMASK 0x3fL",
          "340: #ifdef _DEBUG",
          "341:  FILEFLAGS 0x1L",
          "",
          "[Removed Lines]",
          "337:  FILEVERSION 2,13,1082,0",
          "338:  PRODUCTVERSION 2,13,1082,0",
          "",
          "[Added Lines]",
          "337:  FILEVERSION 2,13,1083,0",
          "338:  PRODUCTVERSION 2,13,1083,0",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "352:         BEGIN",
          "353:             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"",
          "354:             VALUE \"FileDescription\", \"Rufus\"",
          "356:             VALUE \"InternalName\", \"Rufus\"",
          "357:             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"",
          "358:             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"",
          "359:             VALUE \"OriginalFilename\", \"rufus.exe\"",
          "360:             VALUE \"ProductName\", \"Rufus\"",
          "362:         END",
          "363:     END",
          "364:     BLOCK \"VarFileInfo\"",
          "",
          "[Removed Lines]",
          "355:             VALUE \"FileVersion\", \"2.13.1082\"",
          "361:             VALUE \"ProductVersion\", \"2.13.1082\"",
          "",
          "[Added Lines]",
          "355:             VALUE \"FileVersion\", \"2.13.1083\"",
          "361:             VALUE \"ProductVersion\", \"2.13.1083\"",
          "",
          "---------------"
        ],
        "src/syslinux.c||src/syslinux.c": [
          "File: src/syslinux.c -> src/syslinux.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "141:  if ((d_handle == INVALID_HANDLE_VALUE) || (d_handle == NULL)) {",
          "142:   uprintf(\"Could open volume for Syslinux installation\");",
          "143:   goto out;",
          "",
          "[Removed Lines]",
          "140:  d_handle = GetLogicalHandle(drive_index, TRUE, FALSE, TRUE);",
          "",
          "[Added Lines]",
          "140:  d_handle = GetLogicalHandle(drive_index, FALSE, TRUE, TRUE);",
          "",
          "---------------"
        ]
      }
    }
  ]
}