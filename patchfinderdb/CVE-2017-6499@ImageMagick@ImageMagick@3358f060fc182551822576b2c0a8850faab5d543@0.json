{
  "cve_id": "CVE-2017-6499",
  "cve_desc": "An issue was discovered in Magick++ in ImageMagick 6.9.7. A specially crafted file creating a nested exception could lead to a memory leak (thus, a DoS).",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "3358f060fc182551822576b2c0a8850faab5d543",
  "patch_info": {
    "commit_hash": "3358f060fc182551822576b2c0a8850faab5d543",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/3358f060fc182551822576b2c0a8850faab5d543",
    "files": [
      "ChangeLog",
      "Magick++/lib/Exception.cpp"
    ],
    "message": "Fixed memory leak when creating nested exceptions in Magick++.",
    "before_after_code_files": [
      "Magick++/lib/Exception.cpp||Magick++/lib/Exception.cpp"
    ]
  },
  "patch_diff": {
    "Magick++/lib/Exception.cpp||Magick++/lib/Exception.cpp": [
      "File: Magick++/lib/Exception.cpp -> Magick++/lib/Exception.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "852:             exception_->description) != 0))",
      "853:           {",
      "854:             if (nestedException == (Exception *) NULL)",
      "856:             else",
      "857:               {",
      "861:               }",
      "862:           }",
      "863:       }",
      "",
      "[Removed Lines]",
      "855:               nestedException=createException(p);",
      "858:                 q=createException(p);",
      "859:                 nestedException->nested(q);",
      "860:                 nestedException=q;",
      "",
      "[Added Lines]",
      "855:               {",
      "856:                 nestedException=createException(p);",
      "857:                 q=nestedException;",
      "858:               }",
      "861:                 Exception",
      "864:                 r=createException(p);",
      "865:                 q->nested(r);",
      "866:                 q=r;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "425344a2b019d080fc7b4069ae79e5de4dd49fd6",
      "candidate_info": {
        "commit_hash": "425344a2b019d080fc7b4069ae79e5de4dd49fd6",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/425344a2b019d080fc7b4069ae79e5de4dd49fd6",
        "files": [
          "ChangeLog",
          "Magick++/lib/Exception.cpp"
        ],
        "message": "Fixed memory leak when creating nested exceptions in Magick++.",
        "before_after_code_files": [
          "Magick++/lib/Exception.cpp||Magick++/lib/Exception.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "Magick++/lib/Exception.cpp||Magick++/lib/Exception.cpp"
          ],
          "candidate": [
            "Magick++/lib/Exception.cpp||Magick++/lib/Exception.cpp"
          ]
        }
      },
      "candidate_diff": {
        "Magick++/lib/Exception.cpp||Magick++/lib/Exception.cpp": [
          "File: Magick++/lib/Exception.cpp -> Magick++/lib/Exception.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "843:   message=formatExceptionMessage(exception_);",
          "844:   nestedException=(Exception *) NULL;",
          "845:   LockSemaphoreInfo(exception_->semaphore);",
          "846:   if (exception_->exceptions != (void *) NULL)",
          "847:     {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "845:   q=(Exception *) NULL;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "856:             exception_->description) != 0))",
          "857:           {",
          "858:             if (nestedException == (Exception *) NULL)",
          "860:             else",
          "861:               {",
          "865:               }",
          "866:           }",
          "867:       }",
          "",
          "[Removed Lines]",
          "859:               nestedException=createException(p);",
          "862:                 q=createException(p);",
          "863:                 nestedException->nested(q);",
          "864:                 nestedException=q;",
          "",
          "[Added Lines]",
          "860:               {",
          "861:                 nestedException=createException(p);",
          "862:                 q=nestedException;",
          "863:               }",
          "866:                 Exception",
          "869:                 r=createException(p);",
          "870:                 q->nested(r);",
          "871:                 q=r;",
          "",
          "---------------"
        ]
      }
    }
  ]
}