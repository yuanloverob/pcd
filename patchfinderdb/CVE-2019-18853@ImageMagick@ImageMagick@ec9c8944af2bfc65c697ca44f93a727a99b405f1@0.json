{
  "cve_id": "CVE-2019-18853",
  "cve_desc": "ImageMagick before 7.0.9-0 allows remote attackers to cause a denial of service because XML_PARSE_HUGE is not properly restricted in coders/svg.c, related to SVG and libxml2.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "ec9c8944af2bfc65c697ca44f93a727a99b405f1",
  "patch_info": {
    "commit_hash": "ec9c8944af2bfc65c697ca44f93a727a99b405f1",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/ec9c8944af2bfc65c697ca44f93a727a99b405f1",
    "files": [
      "coders/svg.c"
    ],
    "message": "[FG-VD-19-136] ImageMagick Convert SVG MacOS Denial Of Service",
    "before_after_code_files": [
      "coders/svg.c||coders/svg.c"
    ]
  },
  "patch_diff": {
    "coders/svg.c||coders/svg.c": [
      "File: coders/svg.c -> coders/svg.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "65: #include \"MagickCore/memory-private.h\"",
      "66: #include \"MagickCore/module.h\"",
      "67: #include \"MagickCore/monitor.h\"",
      "69: #include \"MagickCore/quantum-private.h\"",
      "70: #include \"MagickCore/pixel-accessor.h\"",
      "71: #include \"MagickCore/property.h\"",
      "72: #include \"MagickCore/resource_.h\"",
      "73: #include \"MagickCore/static.h\"",
      "",
      "[Removed Lines]",
      "68: #include \"MagickCore/monitor-private.h\"",
      "",
      "[Added Lines]",
      "68: #include \"MagickCore/monitor-private.h\"",
      "71: #include \"MagickCore/property.h\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "3579:   sax_modules.error=SVGError;",
      "3580:   sax_modules.fatalError=SVGError;",
      "3581:   sax_modules.getParameterEntity=SVGGetParameterEntity;",
      "3582:   sax_modules.cdataBlock=SVGCDataBlock;",
      "3583:   sax_modules.externalSubset=SVGExternalSubset;",
      "3585:   n=ReadBlob(image,MagickPathExtent-1,message);",
      "3586:   message[n]='\\0';",
      "3587:   if (n > 0)",
      "",
      "[Removed Lines]",
      "3584:   sax_handler=(&sax_modules);",
      "",
      "[Added Lines]",
      "3583:   sax_modules.cdataBlock=SVGCDataBlock;",
      "3584:   sax_modules.externalSubset=SVGExternalSubset;",
      "3585:   sax_handler=(&sax_modules);",
      "3588:   if (n > 0)",
      "3589:     {",
      "3590:       const char",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "76923ae26a539108d3a949d6137f9b684cd2e662",
      "candidate_info": {
        "commit_hash": "76923ae26a539108d3a949d6137f9b684cd2e662",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/76923ae26a539108d3a949d6137f9b684cd2e662",
        "files": [
          "ChangeLog",
          "coders/svg.c"
        ],
        "message": "Also support svg:xml-parse-huge when using librsvg",
        "before_after_code_files": [
          "coders/svg.c||coders/svg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/svg.c||coders/svg.c"
          ],
          "candidate": [
            "coders/svg.c||coders/svg.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/svg.c||coders/svg.c": [
          "File: coders/svg.c -> coders/svg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3184: #if defined(__cplusplus) || defined(c_plusplus)",
          "3185: }",
          "3186: #endif",
          "3188: static Image *ReadSVGImage(const ImageInfo *image_info,ExceptionInfo *exception)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3186: #endif",
          "3188: static Image *ReadSVGImage(const ImageInfo *image_info,ExceptionInfo *exception)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3303:         register Quantum",
          "3306:         RsvgHandle",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3309:         RsvgHandle",
          "3312:         ssize_t",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3578:   sax_modules.error=SVGError;",
          "3579:   sax_modules.fatalError=SVGError;",
          "3580:   sax_modules.getParameterEntity=SVGGetParameterEntity;",
          "3584:   n=ReadBlob(image,MagickPathExtent-1,message);",
          "3585:   message[n]='\\0';",
          "3588:       const char",
          "",
          "[Removed Lines]",
          "3581:   sax_modules.cdataBlock=SVGCDataBlock;",
          "3582:   sax_modules.externalSubset=SVGExternalSubset;",
          "3583:   sax_handler=(&sax_modules);",
          "3586:   if (n > 0)",
          "3587:     {",
          "",
          "[Added Lines]",
          "3590:   sax_handler=(&sax_modules);",
          "3591:   n=ReadBlob(image,MagickPathExtent-1,message);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "43dfb1894761c4929d5d5c98dc80ba4e59a0d114",
      "candidate_info": {
        "commit_hash": "43dfb1894761c4929d5d5c98dc80ba4e59a0d114",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/43dfb1894761c4929d5d5c98dc80ba4e59a0d114",
        "files": [
          "coders/svg.c"
        ],
        "message": "Handle null pointer return from call to xmlCreatePushParserCtxt (#2624).",
        "before_after_code_files": [
          "coders/svg.c||coders/svg.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/svg.c||coders/svg.c"
          ],
          "candidate": [
            "coders/svg.c||coders/svg.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/svg.c||coders/svg.c": [
          "File: coders/svg.c -> coders/svg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3605:   sax_modules.getParameterEntity=SVGGetParameterEntity;",
          "3606:   sax_modules.cdataBlock=SVGCDataBlock;",
          "3607:   sax_modules.externalSubset=SVGExternalSubset;",
          "3618:       while ((n=ReadBlob(image,MagickPathExtent-1,message)) != 0)",
          "3619:       {",
          "3620:         message[n]='\\0';",
          "",
          "[Removed Lines]",
          "3608:   sax_handler=(&sax_modules);",
          "3609:   n=ReadBlob(image,MagickPathExtent-1,message);",
          "3610:   message[n]='\\0';",
          "3611:   if (n > 0)",
          "3612:     {",
          "3613:       svg_info->parser=xmlCreatePushParserCtxt(sax_handler,svg_info,(char *)",
          "3614:         message,n,image->filename);",
          "3615:       option=GetImageOption(image_info,\"svg:xml-parse-huge\");",
          "3616:       if ((option != (char *) NULL) && (IsStringTrue(option) != MagickFalse))",
          "3617:         (void) xmlCtxtUseOptions(svg_info->parser,XML_PARSE_HUGE);",
          "",
          "[Added Lines]",
          "3608:   sax_handler=(&sax_modules);",
          "3609:   n=ReadBlob(image,MagickPathExtent-1,message);",
          "3610:   message[n]='\\0';",
          "3611:   if (n > 0)",
          "3612:     {",
          "3613:       svg_info->parser=xmlCreatePushParserCtxt(sax_handler,svg_info,(char *)",
          "3614:         message,n,image->filename);",
          "3615:       if (svg_info->parser != (xmlParserCtxtPtr) NULL)",
          "3616:         {",
          "3617:           option=GetImageOption(image_info,\"svg:xml-parse-huge\");",
          "3618:           if ((option != (char *) NULL) && (IsStringTrue(option) != MagickFalse))",
          "3619:             (void) xmlCtxtUseOptions(svg_info->parser,XML_PARSE_HUGE);",
          "3620:           while ((n=ReadBlob(image,MagickPathExtent-1,message)) != 0)",
          "3621:           {",
          "3622:             message[n]='\\0';",
          "3623:             status=xmlParseChunk(svg_info->parser,(char *) message,(int) n,0);",
          "3624:             if (status != 0)",
          "3625:               break;",
          "3626:           }",
          "3627:         }",
          "",
          "---------------"
        ]
      }
    }
  ]
}