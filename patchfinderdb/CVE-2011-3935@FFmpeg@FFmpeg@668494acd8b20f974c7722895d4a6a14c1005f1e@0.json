{
  "cve_id": "CVE-2011-3935",
  "cve_desc": "The codec_get_buffer function in ffmpeg.c in FFmpeg before 0.10 allows remote attackers to have an unspecified impact via vectors related to a crafted image size.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "668494acd8b20f974c7722895d4a6a14c1005f1e",
  "patch_info": {
    "commit_hash": "668494acd8b20f974c7722895d4a6a14c1005f1e",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/668494acd8b20f974c7722895d4a6a14c1005f1e",
    "files": [
      "ffmpeg.c"
    ],
    "message": "ffmpeg: add image size check to codec_get_buffer()\n\nFixes CVE-2011-3935\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "ffmpeg.c||ffmpeg.c"
    ]
  },
  "patch_diff": {
    "ffmpeg.c||ffmpeg.c": [
      "File: ffmpeg.c -> ffmpeg.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "546:     FrameBuffer *buf;",
      "547:     int ret, i;",
      "549:     if (!ist->buffer_pool && (ret = alloc_buffer(s, ist, &ist->buffer_pool)) < 0)",
      "550:         return ret;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "549:     if(av_image_check_size(s->width, s->height, 0, s))",
      "550:         return -1;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c2500635235d809e0c0ac526a7e13072ab7c8900",
      "candidate_info": {
        "commit_hash": "c2500635235d809e0c0ac526a7e13072ab7c8900",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/c2500635235d809e0c0ac526a7e13072ab7c8900",
        "files": [
          "ffmpeg.c",
          "ffplay.c",
          "libavcodec/utils.c"
        ],
        "message": "get_buffers: Check that pix_fmt is not NONE.\n\nThis is somewhat redundant as no decoder should call get_buffer() with such argument.\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "ffmpeg.c||ffmpeg.c",
          "ffplay.c||ffplay.c",
          "libavcodec/utils.c||libavcodec/utils.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ffmpeg.c||ffmpeg.c"
          ],
          "candidate": [
            "ffmpeg.c||ffmpeg.c"
          ]
        }
      },
      "candidate_diff": {
        "ffmpeg.c||ffmpeg.c": [
          "File: ffmpeg.c -> ffmpeg.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "553:     FrameBuffer *buf;",
          "554:     int ret, i;",
          "557:         return -1;",
          "559:     if (!ist->buffer_pool && (ret = alloc_buffer(s, ist, &ist->buffer_pool)) < 0)",
          "",
          "[Removed Lines]",
          "556:     if(av_image_check_size(s->width, s->height, 0, s))",
          "",
          "[Added Lines]",
          "556:     if(av_image_check_size(s->width, s->height, 0, s) || s->pix_fmt<0)",
          "",
          "---------------"
        ],
        "ffplay.c||ffplay.c": [
          "File: ffplay.c -> ffplay.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1564:     w = codec->width;",
          "1565:     h = codec->height;",
          "1568:         return -1;",
          "1570:     avcodec_align_dimensions2(codec, &w, &h, stride);",
          "",
          "[Removed Lines]",
          "1567:     if(av_image_check_size(w, h, 0, codec))",
          "",
          "[Added Lines]",
          "1567:     if(av_image_check_size(w, h, 0, codec) || codec->pix_fmt<0)",
          "",
          "---------------"
        ],
        "libavcodec/utils.c||libavcodec/utils.c": [
          "File: libavcodec/utils.c -> libavcodec/utils.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "414:         return -1;",
          "415:     }",
          "418:         return -1;",
          "420:     if (!avci->buffer) {",
          "",
          "[Removed Lines]",
          "417:     if(av_image_check_size(w, h, 0, s))",
          "",
          "[Added Lines]",
          "417:     if(av_image_check_size(w, h, 0, s) || s->pix_fmt<0)",
          "",
          "---------------"
        ]
      }
    }
  ]
}