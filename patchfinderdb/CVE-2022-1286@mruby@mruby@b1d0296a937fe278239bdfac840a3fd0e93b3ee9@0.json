{
  "cve_id": "CVE-2022-1286",
  "cve_desc": "heap-buffer-overflow in mrb_vm_exec in mruby/mruby in GitHub repository mruby/mruby prior to 3.2. Possible arbitrary code execution if being exploited.",
  "repo": "mruby/mruby",
  "patch_hash": "b1d0296a937fe278239bdfac840a3fd0e93b3ee9",
  "patch_info": {
    "commit_hash": "b1d0296a937fe278239bdfac840a3fd0e93b3ee9",
    "repo": "mruby/mruby",
    "commit_url": "https://github.com/mruby/mruby/commit/b1d0296a937fe278239bdfac840a3fd0e93b3ee9",
    "files": [
      "src/class.c"
    ],
    "message": "class.c: clear method cache after `remove_method`.",
    "before_after_code_files": [
      "src/class.c||src/class.c"
    ]
  },
  "patch_diff": {
    "src/class.c||src/class.c": [
      "File: src/class.c -> src/class.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2361:   MRB_CLASS_ORIGIN(c);",
      "2362:   h = c->mt;",
      "2365:   mrb_name_error(mrb, mid, \"method '%n' not defined in %C\", mid, c);",
      "2366: }",
      "",
      "[Removed Lines]",
      "2364:   if (h && mt_del(mrb, h, mid)) return;",
      "",
      "[Added Lines]",
      "2364:   if (h && mt_del(mrb, h, mid)) {",
      "2365:     mrb_mc_clear_by_class(mrb, c);",
      "2366:     return;",
      "2367:   }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "638356af03a00a7edce4e108084d10dab0a42028",
      "candidate_info": {
        "commit_hash": "638356af03a00a7edce4e108084d10dab0a42028",
        "repo": "mruby/mruby",
        "commit_url": "https://github.com/mruby/mruby/commit/638356af03a00a7edce4e108084d10dab0a42028",
        "files": [
          "src/class.c"
        ],
        "message": "class.c (mc_clear_by_id): clear method cache with method id specified.",
        "before_after_code_files": [
          "src/class.c||src/class.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/class.c||src/class.c"
          ],
          "candidate": [
            "src/class.c||src/class.c"
          ]
        }
      },
      "candidate_diff": {
        "src/class.c||src/class.c": [
          "File: src/class.c -> src/class.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "551: static mrb_value mrb_do_nothing(mrb_state *mrb, mrb_value);",
          "552: #ifndef MRB_NO_METHOD_CACHE",
          "553: static void mc_clear(mrb_state *mrb);",
          "554: #else",
          "555: #define mc_clear(mrb)",
          "556: #endif",
          "558: static void",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "554: static void mc_clear_by_id(mrb_state *mrb, mrb_sym mid);",
          "557: #define mc_clear_by_id(mrb,mid)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "774:     ptr.func = MRB_METHOD_FUNC(m);",
          "775:   }",
          "776:   mt_put(mrb, h, mid, MT_FLAGS(MRB_METHOD_FUNC_P(m), MRB_METHOD_NOARG_P(m)), ptr);",
          "778: }",
          "780: MRB_API void",
          "",
          "[Removed Lines]",
          "777:   mc_clear(mrb);",
          "",
          "[Added Lines]",
          "779:   mc_clear_by_id(mrb, mid);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1736:     if (mc->c == c || mc->c0 == c) mc->c = 0;",
          "1737:   }",
          "1738: }",
          "1739: #endif",
          "1741: MRB_API mrb_method_t",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1743: static void",
          "1744: mc_clear_by_id(mrb_state *mrb, mrb_sym id)",
          "1745: {",
          "1746:   struct mrb_cache_entry *mc = mrb->cache;",
          "1748:   for (int i=0; i<MRB_METHOD_CACHE_SIZE; mc++,i++) {",
          "1749:     if (mc->mid == id) mc->c = 0;",
          "1750:   }",
          "1751: }",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "2335:   h = c->mt;",
          "2337:   if (h && mt_del(mrb, h, mid)) {",
          "2339:     return;",
          "2340:   }",
          "2341:   mrb_name_error(mrb, mid, \"method '%n' not defined in %C\", mid, c);",
          "",
          "[Removed Lines]",
          "2338:     mrb_mc_clear_by_class(mrb, c);",
          "",
          "[Added Lines]",
          "2351:     mc_clear_by_id(mrb, mid);",
          "",
          "---------------"
        ]
      }
    }
  ]
}