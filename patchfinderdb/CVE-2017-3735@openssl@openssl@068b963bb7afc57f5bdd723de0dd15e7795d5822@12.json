{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "fae00c9321e9d843355b37358a12756634e267e6",
      "candidate_info": {
        "commit_hash": "fae00c9321e9d843355b37358a12756634e267e6",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/fae00c9321e9d843355b37358a12756634e267e6",
        "files": [
          "test/bad_dtls_test.c"
        ],
        "message": "Remove unicode characters from source\n\nSome compilers react badly to non-ASCII characters\n\nFixes #4877\n\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4879)\n\n(cherry picked from commit d68a0eaf45f12392065f3cf716a1a2682d55d3ce)",
        "before_after_code_files": [
          "test/bad_dtls_test.c||test/bad_dtls_test.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/bad_dtls_test.c||test/bad_dtls_test.c": [
          "File: test/bad_dtls_test.c -> test/bad_dtls_test.c"
        ]
      }
    },
    {
      "candidate_hash": "21815512063d00325fd8e25f3f39ced047cb968b",
      "candidate_info": {
        "commit_hash": "21815512063d00325fd8e25f3f39ced047cb968b",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/21815512063d00325fd8e25f3f39ced047cb968b",
        "files": [
          "crypto/bio/bss_dgram.c",
          "include/openssl/bio.h",
          "ssl/statem/statem.c"
        ],
        "message": "Fix DTLS failure when used in a build which has SCTP enabled\n\nThe value of BIO_CTRL_DGRAM_SET_PEEK_MODE was clashing with the value for\nBIO_CTRL_DGRAM_SCTP_SET_IN_HANDSHAKE. In an SCTP enabled build\nBIO_CTRL_DGRAM_SCTP_SET_IN_HANDSHAKE was used unconditionally with\nthe reasoning that it would be ignored if SCTP wasn't in use. Unfortunately\ndue to this clash, this wasn't the case. The BIO ended up going into peek\nmode and was continually reading the same data over and over - throwing it\naway as a replay.\n\nFixes #3723\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3724)\n\n(cherry picked from commit 9924087573cfbc8d2bc97088f36d1a81ca00cda3)",
        "before_after_code_files": [
          "crypto/bio/bss_dgram.c||crypto/bio/bss_dgram.c",
          "include/openssl/bio.h||include/openssl/bio.h",
          "ssl/statem/statem.c||ssl/statem/statem.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/bio/bss_dgram.c||crypto/bio/bss_dgram.c": [
          "File: crypto/bio/bss_dgram.c -> crypto/bio/bss_dgram.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "782:     case BIO_CTRL_DGRAM_GET_MTU_OVERHEAD:",
          "783:         ret = dgram_get_mtu_overhead(data);",
          "784:         break;",
          "785:     case BIO_CTRL_DGRAM_SET_PEEK_MODE:",
          "786:         data->peekmode = (unsigned int)num;",
          "787:         break;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "793:     case BIO_CTRL_DGRAM_SCTP_SET_IN_HANDSHAKE:",
          "",
          "---------------"
        ],
        "include/openssl/bio.h||include/openssl/bio.h": [
          "File: include/openssl/bio.h -> include/openssl/bio.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "126: # define BIO_CTRL_DGRAM_GET_MTU_OVERHEAD   49",
          "130: # ifndef OPENSSL_NO_SCTP",
          "133: #  define BIO_CTRL_DGRAM_SCTP_ADD_AUTH_KEY                51",
          "134: #  define BIO_CTRL_DGRAM_SCTP_NEXT_AUTH_KEY               52",
          "135: #  define BIO_CTRL_DGRAM_SCTP_AUTH_CCS_RCVD               53",
          "",
          "[Removed Lines]",
          "128: # define BIO_CTRL_DGRAM_SET_PEEK_MODE      50",
          "132: #  define BIO_CTRL_DGRAM_SCTP_SET_IN_HANDSHAKE    50",
          "",
          "[Added Lines]",
          "129: #  define BIO_CTRL_DGRAM_SCTP_SET_IN_HANDSHAKE    50",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "142: #  define BIO_CTRL_DGRAM_SCTP_SAVE_SHUTDOWN               70",
          "143: # endif",
          "146: # define BIO_FP_READ             0x02",
          "147: # define BIO_FP_WRITE            0x04",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "144: # define BIO_CTRL_DGRAM_SET_PEEK_MODE      71",
          "",
          "---------------"
        ],
        "ssl/statem/statem.c||ssl/statem/statem.c": [
          "File: ssl/statem/statem.c -> ssl/statem/statem.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "241:             return -1;",
          "242:     }",
          "243: #ifndef OPENSSL_NO_SCTP",
          "249:         BIO_ctrl(SSL_get_wbio(s), BIO_CTRL_DGRAM_SCTP_SET_IN_HANDSHAKE,",
          "250:                  st->in_handshake, NULL);",
          "",
          "[Removed Lines]",
          "244:     if (SSL_IS_DTLS(s)) {",
          "",
          "[Added Lines]",
          "244:     if (SSL_IS_DTLS(s) && BIO_dgram_is_sctp(SSL_get_wbio(s))) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "417:     st->in_handshake--;",
          "419: #ifndef OPENSSL_NO_SCTP",
          "425:         BIO_ctrl(SSL_get_wbio(s), BIO_CTRL_DGRAM_SCTP_SET_IN_HANDSHAKE,",
          "426:                  st->in_handshake, NULL);",
          "",
          "[Removed Lines]",
          "420:     if (SSL_IS_DTLS(s)) {",
          "",
          "[Added Lines]",
          "420:     if (SSL_IS_DTLS(s) && BIO_dgram_is_sctp(SSL_get_wbio(s))) {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bc8a4d54a87b3ac3307683c94eccf5d817348000",
      "candidate_info": {
        "commit_hash": "bc8a4d54a87b3ac3307683c94eccf5d817348000",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/bc8a4d54a87b3ac3307683c94eccf5d817348000",
        "files": [
          "crypto/bn/bn_print.c"
        ],
        "message": "Remove dead code.\n\nThe second BN_is_zero test can never be true.\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3434)\n(cherry picked from commit 3f97052392cb10fca5309212bf720685262ad4a6)",
        "before_after_code_files": [
          "crypto/bn/bn_print.c||crypto/bn/bn_print.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/bn/bn_print.c||crypto/bn/bn_print.c": [
          "File: crypto/bn/bn_print.c -> crypto/bn/bn_print.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "33:     p = buf;",
          "34:     if (a->neg)",
          "38:     for (i = a->top - 1; i >= 0; i--) {",
          "39:         for (j = BN_BITS2 - 8; j >= 0; j -= 8) {",
          "",
          "[Removed Lines]",
          "36:     if (BN_is_zero(a))",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f05cece6e23ff1737f8cad7f9442dcca25745de1",
      "candidate_info": {
        "commit_hash": "f05cece6e23ff1737f8cad7f9442dcca25745de1",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/f05cece6e23ff1737f8cad7f9442dcca25745de1",
        "files": [
          "crypto/evp/m_sigver.c"
        ],
        "message": "Fix memleak in EVP_DigestSignFinal/VerifyFinal.\n\nReviewed-by: Matt Caswell <matt@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3658)\n(cherry picked from commit 19546246cf44d30043fb17d1899b2c325924ac8b)",
        "before_after_code_files": [
          "crypto/evp/m_sigver.c||crypto/evp/m_sigver.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/evp/m_sigver.c||crypto/evp/m_sigver.c": [
          "File: crypto/evp/m_sigver.c -> crypto/evp/m_sigver.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "109:                 r = EVP_DigestFinal_ex(ctx, md, &mdlen);",
          "110:         } else {",
          "111:             EVP_MD_CTX *tmp_ctx = EVP_MD_CTX_new();",
          "113:                 return 0;",
          "114:             if (sctx)",
          "115:                 r = tmp_ctx->pctx->pmeth->signctx(tmp_ctx->pctx,",
          "116:                                                   sigret, siglen, tmp_ctx);",
          "",
          "[Removed Lines]",
          "112:             if (tmp_ctx == NULL || !EVP_MD_CTX_copy_ex(tmp_ctx, ctx))",
          "",
          "[Added Lines]",
          "112:             if (tmp_ctx == NULL)",
          "114:             if (!EVP_MD_CTX_copy_ex(tmp_ctx, ctx)) {",
          "115:                 EVP_MD_CTX_free(tmp_ctx);",
          "116:                 return 0;",
          "117:             }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "154:             r = EVP_DigestFinal_ex(ctx, md, &mdlen);",
          "155:     } else {",
          "156:         EVP_MD_CTX *tmp_ctx = EVP_MD_CTX_new();",
          "158:             return -1;",
          "159:         if (vctx) {",
          "160:             r = tmp_ctx->pctx->pmeth->verifyctx(tmp_ctx->pctx,",
          "161:                                                 sig, siglen, tmp_ctx);",
          "",
          "[Removed Lines]",
          "157:         if (tmp_ctx == NULL || !EVP_MD_CTX_copy_ex(tmp_ctx, ctx))",
          "",
          "[Added Lines]",
          "161:         if (tmp_ctx == NULL)",
          "162:             return -1;",
          "163:         if (!EVP_MD_CTX_copy_ex(tmp_ctx, ctx)) {",
          "164:             EVP_MD_CTX_free(tmp_ctx);",
          "166:         }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "09f87aa6a14f518c2fdf7170462b594c24a7c527",
      "candidate_info": {
        "commit_hash": "09f87aa6a14f518c2fdf7170462b594c24a7c527",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/09f87aa6a14f518c2fdf7170462b594c24a7c527",
        "files": [
          "crypto/rsa/rsa_oaep.c",
          "crypto/rsa/rsa_pk1.c"
        ],
        "message": "Fix an information leak in the RSA padding check code. The memory blocks contain secret data and must be cleared before returning to the system heap.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4062)\n\n(cherry picked from commit e670db0183079b5f6325ce2abd9d785e0f966890)",
        "before_after_code_files": [
          "crypto/rsrsa_oaep.c||crypto/rsa/rsa_oaep.c",
          "crypto/rsrsa_pk1.c||crypto/rsa/rsa_pk1.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/rsrsa_oaep.c||crypto/rsa/rsa_oaep.c": [
          "File: crypto/rsrsa_oaep.c -> crypto/rsa/rsa_oaep.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "125:     int i, dblen = 0, mlen = -1, one_index = 0, msg_index;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "242:     OPENSSL_clear_free(db, dblen);",
          "243:     OPENSSL_clear_free(em, num);",
          "",
          "---------------"
        ],
        "crypto/rsrsa_pk1.c||crypto/rsa/rsa_pk1.c": [
          "File: crypto/rsrsa_pk1.c -> crypto/rsa/rsa_pk1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "238:     OPENSSL_clear_free(em, num);",
          "",
          "---------------"
        ]
      }
    }
  ]
}