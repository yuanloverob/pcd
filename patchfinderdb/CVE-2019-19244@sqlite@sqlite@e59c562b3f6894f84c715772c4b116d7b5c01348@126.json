{
  "cve_id": "CVE-2019-19244",
  "cve_desc": "sqlite3Select in select.c in SQLite 3.30.1 allows a crash if a sub-select uses both DISTINCT and window functions, and also has certain ORDER BY usage.",
  "repo": "sqlite/sqlite",
  "patch_hash": "e59c562b3f6894f84c715772c4b116d7b5c01348",
  "patch_info": {
    "commit_hash": "e59c562b3f6894f84c715772c4b116d7b5c01348",
    "repo": "sqlite/sqlite",
    "commit_url": "https://github.com/sqlite/sqlite/commit/e59c562b3f6894f84c715772c4b116d7b5c01348",
    "files": [
      "manifest",
      "manifest.uuid",
      "src/select.c",
      "test/window1.test"
    ],
    "message": "Fix a crash that could occur if a sub-select that uses both DISTINCT and window functions also used an ORDER BY that is the same as its select list.\n\nFossilOrigin-Name: bcdd66c1691955c697f3d756c2b035acfe98f6aad72e90b0021bab6e9023b3ba",
    "before_after_code_files": [
      "manifest.uuid||manifest.uuid",
      "src/select.c||src/select.c",
      "test/window1.test||test/window1.test"
    ]
  },
  "patch_diff": {
    "manifest.uuid||manifest.uuid": [
      "File: manifest.uuid -> manifest.uuid",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "1: 6a64fb6a2da6c98f1e87b55ad5689967e1db4eae2e08345471d95e28cd567e0f",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "src/select.c||src/select.c": [
      "File: src/select.c -> src/select.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "6065:   if( (p->selFlags & (SF_Distinct|SF_Aggregate))==SF_Distinct",
      "6066:    && sqlite3ExprListCompare(sSort.pOrderBy, pEList, -1)==0",
      "6067:   ){",
      "6068:     p->selFlags &= ~SF_Distinct;",
      "6069:     pGroupBy = p->pGroupBy = sqlite3ExprListDup(db, pEList, 0);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6067:    && p->pWin==0",
      "",
      "---------------"
    ],
    "test/window1.test||test/window1.test": [
      "File: test/window1.test -> test/window1.test",
      "--- Hunk 1 ---",
      "[Context before]",
      "1243:   ALTER TABLE a0 RENAME TO S;",
      "1244: } {1 {error in view a: 1st ORDER BY term does not match any column in the result set}}",
      "1246: finish_test",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1246: reset_db",
      "1247: do_execsql_test 33.1 {",
      "1248:   CREATE TABLE t1(aa, bb);",
      "1249:   INSERT INTO t1 VALUES(1, 2);",
      "1250:   INSERT INTO t1 VALUES(5, 6);",
      "1251:   CREATE TABLE t2(x);",
      "1252:   INSERT INTO t2 VALUES(1);",
      "1253: }",
      "1254: do_execsql_test 33.2 {",
      "1255:   SELECT (SELECT DISTINCT sum(aa) OVER() FROM t1 ORDER BY 1), x FROM t2",
      "1256:   ORDER BY 1;",
      "1257: } {6 1}",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "908e7c43a7386594926bdfce4029884cd20ea012",
      "candidate_info": {
        "commit_hash": "908e7c43a7386594926bdfce4029884cd20ea012",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/908e7c43a7386594926bdfce4029884cd20ea012",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/memjournal.c"
        ],
        "message": "Always check for reads past the end of the file on the in-memory journal driver.  This used to be an assert().\n\nFossilOrigin-Name: 4d41ca7d6efbdac70890a8d4159488fc7f59bf78a550b00597b4df990c4fcaef",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/memjournal.c||src/memjournal.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: a21d1dde73f811244b5b43f9fed5877263a9c5061470221f417e501f5530edfa",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/memjournal.c||src/memjournal.c": [
          "File: src/memjournal.c -> src/memjournal.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "96:   int iChunkOffset;",
          "97:   FileChunk *pChunk;",
          "101:   if( (iAmt+iOfst)>p->endpoint.iOffset ){",
          "102:     return SQLITE_IOERR_SHORT_READ;",
          "103:   }",
          "107:   assert( p->readpoint.iOffset==0 || p->readpoint.pChunk!=0 );",
          "108:   if( p->readpoint.iOffset!=iOfst || iOfst==0 ){",
          "109:     sqlite3_int64 iOff = 0;",
          "",
          "[Removed Lines]",
          "99: #if defined(SQLITE_ENABLE_ATOMIC_WRITE) \\",
          "100:  || defined(SQLITE_ENABLE_BATCH_ATOMIC_WRITE)",
          "104: #endif",
          "106:   assert( (iAmt+iOfst)<=p->endpoint.iOffset );",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "d6401e869baca759a169a58de148689785dc7907",
      "candidate_info": {
        "commit_hash": "d6401e869baca759a169a58de148689785dc7907",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/d6401e869baca759a169a58de148689785dc7907",
        "files": [
          "manifest",
          "manifest.uuid",
          "src/pcache1.c"
        ],
        "message": "Expand the size of the temporary page used during btree rebalancing by a few bytes, to avoid problems with small buffer overreads that can occur on corrupted database files.\n\nFossilOrigin-Name: 32754ca6f86da8165e274f98f35fc3df3aebd273e9da08387e2d0c3c89abda0f",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "src/pcache1.c||src/pcache1.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 160b1e31c0f27257c06c2987af9ec3a64abfacb2150325b72e8ccd3d217b5baa",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "src/pcache1.c||src/pcache1.c": [
          "File: src/pcache1.c -> src/pcache1.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "479: void *sqlite3PageMalloc(int sz){",
          "481: }",
          "",
          "[Removed Lines]",
          "480:   return pcache1Alloc(sz);",
          "",
          "[Added Lines]",
          "483:   return pcache1Alloc(sz + 32);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a47e45f734d793d82421c383bfa90547436989f6",
      "candidate_info": {
        "commit_hash": "a47e45f734d793d82421c383bfa90547436989f6",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/a47e45f734d793d82421c383bfa90547436989f6",
        "files": [
          "ext/fts5/fts5_index.c",
          "ext/fts5/test/fts5corrupt3.test",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Fix an out-of-bounds read in SQL function fts5_decode() that could occur if it was passed a corrupt record.\n\nFossilOrigin-Name: 931278b257b12ac14fc8fbc82c6dc88ce4ac4b8e0d668543e68f0289d825daa1",
        "before_after_code_files": [
          "ext/fts5/fts5_index.c||ext/fts5/fts5_index.c",
          "ext/fts5/test/fts5corrupt3.test||ext/fts5/test/fts5corrupt3.test",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/fts5/fts5_index.c||ext/fts5/fts5_index.c": [
          "File: ext/fts5/fts5_index.c -> ext/fts5/fts5_index.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "6409:     nDoclist = (iTermOff ? iTermOff : szLeaf) - iOff;",
          "6410:     fts5DecodeDoclist(&rc, &s, &a[iOff], nDoclist);",
          "6415:       int iEnd;",
          "",
          "[Removed Lines]",
          "6412:     while( iPgidxOff<n ){",
          "",
          "[Added Lines]",
          "6412:     while( iPgidxOff<n && rc==SQLITE_OK ){",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "6428:       if( bFirst==0 ){",
          "6429:         iOff += fts5GetVarint32(&a[iOff], nByte);",
          "6430:         term.n = nByte;",
          "6431:       }",
          "6432:       iOff += fts5GetVarint32(&a[iOff], nByte);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "6430:         if( nByte>term.n ){",
          "6431:           rc = FTS5_CORRUPT;",
          "6432:           goto decode_out;",
          "6433:         }",
          "",
          "---------------"
        ],
        "ext/fts5/test/fts5corrupt3.test||ext/fts5/test/fts5corrupt3.test": [
          "File: ext/fts5/test/fts5corrupt3.test -> ext/fts5/test/fts5corrupt3.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "23:   return",
          "24: }",
          "25: sqlite3_fts5_may_be_corrupt 1",
          "27: proc create_t1 {} {",
          "28:   expr srand(0)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "26: database_may_be_corrupt",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3012:   DELETE FROM t1 WHERE a MATCH 'fts*';",
          "3013: } {1 {database disk image is malformed}}",
          "3015: sqlite3_fts5_may_be_corrupt 0",
          "3016: finish_test",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3016: #-------------------------------------------------------------------------",
          "3017: reset_db",
          "3018: do_test 28.0 {",
          "3019:   sqlite3 db {}",
          "3020:   db deserialize [decode_hexdb {",
          "3021: | size 40960 pagesize 4096 filename crash-e2d47e0624a42c.db",
          "3022: | page 1 offset 0",
          "3023: |      0: 53 51 4c 69 74 65 20 66 6f 72 6d 61 74 20 33 00   SQLite format 3.",
          "3024: |     16: 10 00 01 01 00 40 20 20 00 00 00 00 00 00 00 0a   .....@  ........",
          "3025: |     32: 00 00 00 00 00 00 00 00 00 00 00 0d 00 00 00 04   ................",
          "3026: |     48: 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00   ................",
          "3027: |     96: 00 00 00 00 0d 00 00 00 0d 0b 6e 00 0f a3 0f 4c   ..........n....L",
          "3028: |    112: 0e e1 0e 81 0e 24 0d cc 0d 72 0d 1b 0c b0 0c 50   .....$...r.....P",
          "3029: |    128: 0b f8 0b b3 0b 6e 00 00 00 00 00 00 00 00 00 00   .....n..........",
          "3030: |   2912: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 43 0d   ..............C.",
          "3031: |   2928: 06 17 11 11 08 75 74 61 62 6c 65 74 34 74 34 43   .....utablet4t4C",
          "3032: |   2944: 52 45 41 54 45 20 56 49 52 54 55 41 4c 20 54 41   REATE VIRTUAL TA",
          "3033: |   2960: 42 4c 45 20 74 34 20 55 53 49 4e 47 20 66 74 73   BLE t4 USING fts",
          "3034: |   2976: 35 76 6f 63 61 62 28 27 74 32 27 2c 20 27 72 6f   5vocab('t2', 'ro",
          "3035: |   2992: 77 27 29 43 0c 06 17 11 11 08 75 74 61 62 6c 65   w')C......utable",
          "3036: |   3008: 74 33 74 33 43 52 45 41 54 45 20 56 49 52 54 55   t3t3CREATE VIRTU",
          "3037: |   3024: 41 4c 20 54 41 42 4c 45 20 74 33 20 55 53 49 4e   AL TABLE t3 USIN",
          "3038: |   3040: 47 20 66 74 73 35 76 6f 63 61 62 28 27 74 31 27   G fts5vocab('t1'",
          "3039: |   3056: 2c 20 27 72 6f 77 27 29 56 0b 06 17 1f 1f 01 7d   , 'row')V.......",
          "3040: |   3072: 74 61 62 6c 65 74 32 5f 63 6f 6e 66 69 67 74 32   tablet2_configt2",
          "3041: |   3088: 5f 63 6f 6e 66 69 67 0a 43 52 45 41 54 45 20 54   _config.CREATE T",
          "3042: |   3104: 41 42 4c 45 20 27 74 32 5f 63 6f 6e 66 69 67 27   ABLE 't2_config'",
          "3043: |   3120: 28 6b 20 50 52 49 4d 41 52 59 20 4b 45 59 2c 20   (k PRIMARY KEY,",
          "3044: |   3136: 76 29 20 57 49 54 48 4f 55 54 20 52 4f 57 49 44   v) WITHOUT ROWID",
          "3045: |   3152: 5e 0a 07 17 21 21 01 81 07 74 61 62 6c 65 74 32   ^...!!...tablet2",
          "3046: |   3168: 5f 63 6f 6e 74 65 6e 74 74 32 5f 63 6f 6e 74 65   _contentt2_conte",
          "3047: |   3184: 6e 74 09 43 52 45 41 54 45 20 54 41 42 4c 45 20   nt.CREATE TABLE",
          "3048: |   3200: 27 74 32 5f 63 6f 6e 74 65 6e 74 27 28 69 64 20   't2_content'(id",
          "3049: |   3216: 49 4e 54 45 47 45 52 20 50 52 49 4d 41 52 59 20   INTEGER PRIMARY",
          "3050: |   3232: 4b 45 59 2c 20 63 30 2c 20 63 31 2c 20 63 32 29   KEY, c0, c1, c2)",
          "3051: |   3248: 69 09 07 17 19 19 01 81 2d 74 61 62 6c 65 74 32   i.......-tablet2",
          "3052: |   3264: 5f 69 64 78 74 32 5f 69 64 78 08 43 52 45 41 54   _idxt2_idx.CREAT",
          "3053: |   3280: 45 20 54 41 42 4c 45 20 27 74 32 5f 69 64 78 27   E TABLE 't2_idx'",
          "3054: |   3296: 28 73 65 67 69 64 2c 20 74 65 72 6d 2c 20 70 67   (segid, term, pg",
          "3055: |   3312: 6e 6f 2c 20 50 52 49 4d 41 52 59 20 4b 45 59 28   no, PRIMARY KEY(",
          "3056: |   3328: 73 65 67 69 64 2c 20 74 65 72 6d 29 29 20 57 49   segid, term)) WI",
          "3057: |   3344: 54 48 4f 55 54 20 52 4f 57 49 44 55 08 07 17 1b   THOUT ROWIDU....",
          "3058: |   3360: 1b 01 81 01 74 61 62 6c 65 74 32 5f 64 61 74 61   ....tablet2_data",
          "3059: |   3376: 74 32 5f 64 61 74 61 07 43 52 45 41 54 45 20 54   t2_data.CREATE T",
          "3060: |   3392: 41 42 4c 45 20 27 74 32 5f 64 61 74 61 27 28 69   ABLE 't2_data'(i",
          "3061: |   3408: 64 20 49 4e 54 45 47 45 52 20 50 52 49 4d 41 52   d INTEGER PRIMAR",
          "3062: |   3424: 59 20 4b 45 59 2c 20 62 6c 6f 63 6b 20 42 4c 4f   Y KEY, block BLO",
          "3063: |   3440: 42 29 58 07 07 17 11 11 08 81 1d 74 61 62 6c 65   B)X........table",
          "3064: |   3456: 74 32 74 32 43 52 45 41 54 45 20 56 49 52 54 55   t2t2CREATE VIRTU",
          "3065: |   3472: 41 4c 20 54 41 42 4c 45 20 74 32 20 55 53 49 4e   AL TABLE t2 USIN",
          "3066: |   3488: 47 20 66 74 73 35 28 27 61 27 2c 5b 62 5d 2c 22   G fts5('a',[b],.",
          "3067: |   3504: 63 22 2c 64 65 74 61 69 6c 3d 6e 6f 6e 65 2c 63   c.,detail=none,c",
          "3068: |   3520: 6f 6c 75 6d 6e 73 69 7a 65 3d 30 29 56 06 06 17   olumnsize=0)V...",
          "3069: |   3536: 1f 1f 01 7d 74 61 62 6c 65 74 31 5f 63 6f 6e 66   ....tablet1_conf",
          "3070: |   3552: 69 67 74 31 5f 63 6f 6e 66 69 67 06 43 52 45 41   igt1_config.CREA",
          "3071: |   3568: 54 45 20 54 41 42 4c 45 20 27 74 31 5f 63 6f 6e   TE TABLE 't1_con",
          "3072: |   3584: 66 69 67 27 28 6b 20 50 52 49 4d 41 52 59 20 4b   fig'(k PRIMARY K",
          "3073: |   3600: 45 59 2c 20 76 29 20 57 49 54 48 4f 55 54 20 52   EY, v) WITHOUT R",
          "3074: |   3616: 4f 57 49 44 5b 05 07 17 21 21 01 81 01 74 61 62   OWID[...!!...tab",
          "3075: |   3632: 6c 65 74 31 5f 64 6f 63 73 69 7a 65 74 31 5f 64   let1_docsizet1_d",
          "3076: |   3648: 6f 63 73 69 7a 65 05 43 52 45 41 54 45 20 54 41   ocsize.CREATE TA",
          "3077: |   3664: 42 4c 45 20 27 74 31 5f 64 6f 63 73 69 7a 65 27   BLE 't1_docsize'",
          "3078: |   3680: 28 69 64 20 49 4e 54 45 47 45 52 20 50 52 49 4d   (id INTEGER PRIM",
          "3079: |   3696: 41 52 59 20 4b 45 59 2c 20 73 7a 20 42 4c 4f 42   ARY KEY, sz BLOB",
          "3080: |   3712: 29 5e 04 07 17 21 21 01 81 07 74 61 62 6c 65 74   )^...!!...tablet",
          "3081: |   3728: 31 5f 63 6f 6e 74 65 6e 74 74 31 5f 63 6f 6e 74   1_contentt1_cont",
          "3082: |   3744: 65 6e 74 04 43 52 45 41 54 45 20 54 41 42 4c 45   ent.CREATE TABLE",
          "3083: |   3760: 20 27 74 31 5f 63 6f 6e 74 65 6e 74 27 28 69 64    't1_content'(id",
          "3084: |   3776: 20 49 4e 54 45 47 45 52 20 50 52 49 4d 41 52 59    INTEGER PRIMARY",
          "3085: |   3792: 20 4b 45 59 2c 20 63 30 2c 20 63 31 2c 20 63 32    KEY, c0, c1, c2",
          "3086: |   3808: 29 69 03 07 17 19 19 01 81 2d 74 61 62 6c 65 74   )i.......-tablet",
          "3087: |   3824: 31 5f 69 64 78 74 31 5f 69 64 78 03 43 52 45 41   1_idxt1_idx.CREA",
          "3088: |   3840: 54 45 20 54 41 42 4c 45 20 27 74 31 5f 69 64 78   TE TABLE 't1_idx",
          "3089: |   3856: 27 28 73 65 67 69 64 2c 20 74 65 72 6d 2c 20 70   '(segid, term, p",
          "3090: |   3872: 67 6e 6f 2c 20 50 52 49 4d 41 52 59 20 4b 45 59   gno, PRIMARY KEY",
          "3091: |   3888: 28 73 65 67 69 64 2c 20 74 65 72 6d 29 29 20 57   (segid, term)) W",
          "3092: |   3904: 49 54 48 4f 55 54 20 52 4f 57 49 44 55 02 07 17   ITHOUT ROWIDU...",
          "3093: |   3920: 1b 1b 01 81 01 74 61 62 6c 65 74 31 5f 64 61 74   .....tablet1_dat",
          "3094: |   3936: 61 74 31 5f 64 61 74 61 02 43 52 45 41 54 45 20   at1_data.CREATE",
          "3095: |   3952: 54 41 42 4c 45 20 27 74 31 5f 64 61 74 61 27 28   TABLE 't1_data'(",
          "3096: |   3968: 69 64 20 49 4e 54 45 47 45 52 20 50 52 49 4d 41   id INTEGER PRIMA",
          "3097: |   3984: 52 59 20 4b 45 59 2c 20 62 6c 6f 63 6b 20 42 4c   RY KEY, block BL",
          "3098: |   4000: 4f 42 29 5b 01 07 17 11 11 08 81 23 74 61 62 6c   OB)[.......#tabl",
          "3099: |   4016: 65 74 31 74 31 43 52 45 41 54 45 20 56 49 52 54   et1t1CREATE VIRT",
          "3100: |   4032: 55 41 4c 20 54 41 42 4c 45 20 74 31 20 55 53 49   UAL TABLE t1 USI",
          "3101: |   4048: 4e 47 20 66 74 73 35 28 61 2c 62 20 75 6e 69 6e   NG fts5(a,b unin",
          "3102: |   4064: 64 65 78 65 64 2c 63 2c 74 6f 6b 65 6e 69 7a 65   dexed,c,tokenize",
          "3103: |   4080: 3d 22 70 6f 72 74 65 72 20 61 73 63 69 69 22 29   =.porter ascii.)",
          "3104: | page 2 offset 4096",
          "3105: |      0: 0d 0f 68 00 05 0f 13 00 0f e6 0f 13 0f a8 0f 7c   ..h............|",
          "3106: |     16: 0f 2a 00 00 00 00 00 00 00 00 00 00 00 00 00 00   .*..............",
          "3107: |   3856: 00 00 00 15 0a 03 00 30 00 00 00 00 01 03 03 00   .......0........",
          "3108: |   3872: 03 01 01 01 02 01 01 03 01 01 37 8c 80 80 80 80   ..........7.....",
          "3109: |   3888: 01 03 00 74 00 00 00 2e 02 30 61 03 02 02 01 01   ...t.....0a.....",
          "3110: |   3904: 62 03 02 03 01 01 63 03 02 04 01 01 67 03 06 01   b.....c.....g...",
          "3111: |   3920: 02 02 01 01 68 03 06 01 02 03 01 01 69 03 06 01   ....h.......i...",
          "3112: |   3936: 02 04 04 06 06 06 08 08 0f ef 00 14 2a 00 00 00   ............*...",
          "3113: |   3952: 00 01 02 02 00 02 01 01 01 02 01 01 25 88 80 80   ............%...",
          "3114: |   3968: 80 80 01 03 00 50 00 00 00 1f 02 30 67 02 08 02   .....P.....0g...",
          "3115: |   3984: 01 02 02 01 01 68 02 08 03 01 02 03 01 01 69 02   .....h........i.",
          "3116: |   4000: 08 04 01 02 04 04 09 09 37 84 80 80 80 80 01 03   ........7.......",
          "3117: |   4016: 00 74 00 00 00 2e 02 30 61 01 02 02 01 01 62 01   .t.....0a.....b.",
          "3118: |   4032: 02 03 01 01 63 01 02 04 01 01 67 01 06 01 02 20   ....c.....g....",
          "3119: |   4048: 10 16 80 10 60 10 20 30 10 16 90 10 60 10 20 40   ....`. 0....`. @",
          "3120: |   4064: 40 60 60 60 80 80 70 10 30 01 40 30 90 00 90 00   @```..p.0.@0....",
          "3121: |   4080: 00 01 12 40 00 00 00 00 10 10 10 00 10 10 10 10   ...@............",
          "3122: | page 3 offset 8192",
          "3123: |      0: a0 00 00 00 30 fe c0 00 ff a0 ff 30 fe 00 00 00   ....0......0....",
          "3124: |   4064: 00 00 00 00 00 00 00 00 00 00 00 00 06 04 01 0c   ................",
          "3125: |   4080: 01 03 02 06 04 01 0c 01 02 02 05 04 09 0c 01 02   ................",
          "3126: | page 4 offset 12288",
          "3127: |      0: 0d 00 00 00 03 0f be 00 0f ea 0f d4 0f be 00 00   ................",
          "3128: |   4016: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 14 03   ................",
          "3129: |   4032: 05 00 17 17 17 61 20 62 20 63 67 20 68 20 69 67   .....a b cg h ig",
          "3130: |   4048: 20 68 20 69 14 02 05 00 17 17 17 67 20 68 20 69    h i.......g h i",
          "3131: |   4064: 61 20 62 20 63 67 20 68 20 69 14 01 05 00 17 17   a b cg h i......",
          "3132: |   4080: 17 61 20 62 20 63 64 20 65 20 66 67 20 68 20 69   .a b cd e fg h i",
          "3133: | page 5 offset 16384",
          "3134: |      0: 0d 00 00 00 03 0f e8 00 0f f8 0f f0 0f e8 00 00   ................",
          "3135: |   4064: 00 00 00 00 00 00 00 00 06 03 03 00 12 03 00 03   ................",
          "3136: |   4080: 06 02 03 00 12 03 00 03 06 01 03 00 12 03 00 03   ................",
          "3137: | page 6 offset 20480",
          "3138: |      0: 0a 00 00 00 01 0f f4 00 0f f4 00 00 00 00 00 00   ................",
          "3139: |   4080: 00 00 00 00 0b 03 1b 01 76 65 72 73 69 6f 6e 04   ........version.",
          "3140: | page 7 offset 24576",
          "3141: |      0: 0d 00 00 00 03 0f 9e 00 0f e6 0f ef 0f 9e 00 00   ................",
          "3142: |   3984: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 41 84   ..............A.",
          "3143: |   4000: 80 80 80 80 01 04 00 81 06 00 00 00 34 02 30 61   ............4.0a",
          "3144: |   4016: 01 01 01 01 01 62 01 01 01 01 01 63 01 01 01 01   .....b.....c....",
          "3145: |   4032: 01 64 01 01 01 65 01 01 01 66 01 01 01 01 01 68   .d...e...f.....h",
          "3146: |   4048: 01 01 01 01 01 69 01 01 01 04 06 06 06 04 04 04   .....i..........",
          "3147: |   4064: 06 06 07 01 03 00 14 03 09 09 09 0f 0a 03 00 24   ...............$",
          "3148: |   4080: 00 00 00 00 01 01 01 00 01 01 01 01 0a 00 00 00   ................",
          "3149: | page 8 offset 28672",
          "3150: |      0: 01 0f fa 00 0f fa 00 00 00 00 00 00 00 00 00 00   ................",
          "3151: |   4080: 00 00 00 00 00 00 00 00 00 00 05 04 09 0c 01 02   ................",
          "3152: | page 9 offset 32768",
          "3153: |      0: 0d 00 00 00 03 0f be 00 0f ea 0f d4 1f be 00 00   ................",
          "3154: |   4016: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 14 03   ................",
          "3155: |   4032: 05 00 17 17 17 61 20 62 20 63 67 20 68 20 69 67   .....a b cg h ig",
          "3156: |   4048: 20 68 20 69 14 02 05 00 17 17 17 67 20 68 20 69    h i.......g h i",
          "3157: |   4064: 61 20 62 20 63 67 20 68 20 69 14 01 05 00 17 17   a b cg h i......",
          "3158: |   4080: 17 61 20 62 20 63 64 20 65 20 66 67 20 68 20 69   .a b cd e fg h i",
          "3159: | page 10 offset 36864",
          "3160: |      0: 0a 00 00 00 01 0f f4 00 0f f4 00 00 00 00 00 00   ................",
          "3161: |   4080: 00 00 00 00 0b 03 1b 01 76 65 72 73 69 6f 6e 04   ........version.",
          "3162: | end crash-e2d47e0624a42c.db",
          "3163: }]} {}",
          "3165: do_catchsql_test 28.1 {",
          "3166:   SELECT count( fts5_decode(id, block) ) FROM t2_data;",
          "3167: } {1 {database disk image is malformed}}",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 383437be276719ac1c72688ae81017c63907ac561f2ffb8e42c43b012248f294",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "158931ab640fe6b0d3829d0321d04a4315e6e6cb",
      "candidate_info": {
        "commit_hash": "158931ab640fe6b0d3829d0321d04a4315e6e6cb",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/158931ab640fe6b0d3829d0321d04a4315e6e6cb",
        "files": [
          "manifest",
          "manifest.uuid",
          "test/badutf2.test",
          "test/journal3.test",
          "test/shell1.test",
          "test/wal2.test"
        ],
        "message": "Test case changes so that they work with both Tcl8.6 and Tcl8.7.\n\nFossilOrigin-Name: 7b771405a9adc3ec191156be4ebe7122f4c698d88d69ae2134c75acb8d8feebb",
        "before_after_code_files": [
          "manifest.uuid||manifest.uuid",
          "test/badutf2.test||test/badutf2.test",
          "test/journal3.test||test/journal3.test",
          "test/shell1.test||test/shell1.test",
          "test/wal2.test||test/wal2.test"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: dd248c186a157b5ed60bbdae669b31237b8354c1a7e6ed64d377904043bd57ee",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "test/badutf2.test||test/badutf2.test": [
          "File: test/badutf2.test -> test/badutf2.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "98:     } $uval",
          "99:   }",
          "108:   ifcapable debug {",
          "109:     do_test badutf2-5.1.$i {",
          "",
          "[Removed Lines]",
          "101:   do_test badutf2-4.1.$i {",
          "102:     sqlite3_reset $S",
          "103:     sqlite3_bind_text $S 1 $xstr $len",
          "104:     sqlite3_step $S",
          "105:     utf8_to_ustr2 [ sqlite3_column_text $S 0 ]",
          "106:   } $ustr",
          "",
          "[Added Lines]",
          "101:   # Tcl 8.7 and later do automatic bad-utf8 correction for",
          "102:   # characters 0x80 thru 0x9f so test case 5 does not work here.",
          "103:   if {$i==5 && $tcl_version>=8.7} {",
          "104:      # no-op",
          "105:   } else {",
          "106:     do_test badutf2-4.1.$i {",
          "107:       sqlite3_reset $S",
          "108:       sqlite3_bind_text $S 1 $xstr $len",
          "109:       sqlite3_step $S",
          "110:       utf8_to_ustr2 [ sqlite3_column_text $S 0 ]",
          "111:     } $ustr",
          "112:   }",
          "",
          "---------------"
        ],
        "test/journal3.test||test/journal3.test": [
          "File: test/journal3.test -> test/journal3.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "38:   } {",
          "39:     db close",
          "40:     #set effective [format %.5o [expr $permissions & ~$umask]]",
          "41:     set effective $permissions",
          "42:     do_test journal3-1.2.$tn.1 {",
          "43:       catch { forcedelete test.db-journal }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "41:     if {$tcl_version>=8.7} {",
          "42:        regsub {^00} $permissions {0o} permissions",
          "43:     }",
          "",
          "---------------"
        ],
        "test/shell1.test||test/shell1.test": [
          "File: test/shell1.test -> test/shell1.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "1022:     if {$i==0x0D || ($tcl_platform(platform)==\"windows\" && $i==0x1A)} {",
          "1023:       continue",
          "1024:     }",
          "1025:     if {$i>=0xE0 && $tcl_platform(os)==\"OpenBSD\"}  continue",
          "1026:     if {$i>=0xE0 && $i<=0xEF && $tcl_platform(os)==\"Linux\"}  continue",
          "1027:     set hex [format %02X $i]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1025:     # Tcl 8.7 maps 0x80 through 0x9f into valid UTF8.  So skip those tests.",
          "1026:     if {$i>=0x80 && $i<=0x9f} continue",
          "",
          "---------------"
        ],
        "test/wal2.test||test/wal2.test": [
          "File: test/wal2.test -> test/wal2.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "1085:     set effective [format %.5o [expr $permissions & ~$umask]]",
          "1086:     do_test wal2-12.2.$tn.1 {",
          "1087:       file attributes test.db -permissions $permissions",
          "1089:     } $permissions",
          "1090:     do_test wal2-12.2.$tn.2 {",
          "1091:       list [file exists test.db-wal] [file exists test.db-shm]",
          "",
          "[Removed Lines]",
          "1088:       file attributes test.db -permissions",
          "",
          "[Added Lines]",
          "1088:       string map {o 0} [file attributes test.db -permissions]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1096:       list [file exists test.db-wal] [file exists test.db-shm]",
          "1097:     } {1 1}",
          "1098:     do_test wal2-12.2.$tn.4 {",
          "1100:     } [list $effective $effective]",
          "1101:     do_test wal2-12.2.$tn.5 {",
          "1102:       db close",
          "",
          "[Removed Lines]",
          "1099:       list [file attr test.db-wal -perm] [file attr test.db-shm -perm]",
          "",
          "[Added Lines]",
          "1099:       set x [list [file attr test.db-wal -perm] [file attr test.db-shm -perm]]",
          "1100:       string map {o 0} $x",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1154:       set     L [file attr test.db -perm]",
          "1155:       lappend L [file attr test.db-wal -perm]",
          "1156:       lappend L [file attr test.db-shm -perm]",
          "1157:     } [list $db_perm $wal_perm $shm_perm]",
          "1159:     # If $can_open is true, then it should be possible to open a database",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1158:       string map {o 0} $L",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e9ad07c0a3967aeed1003181626c10e298aa504e",
      "candidate_info": {
        "commit_hash": "e9ad07c0a3967aeed1003181626c10e298aa504e",
        "repo": "sqlite/sqlite",
        "commit_url": "https://github.com/sqlite/sqlite/commit/e9ad07c0a3967aeed1003181626c10e298aa504e",
        "files": [
          "ext/fts5/fts5_index.c",
          "ext/fts5/test/fts5interrupt.test",
          "manifest",
          "manifest.uuid"
        ],
        "message": "Fix some problems with sqlite3_interrupt() handling in fts5.\n\nFossilOrigin-Name: c0eb839a3c23612b93002d2e1fbc41bf5db140775267989f85db52146144750b",
        "before_after_code_files": [
          "ext/fts5/fts5_index.c||ext/fts5/fts5_index.c",
          "ext/fts5/test/fts5interrupt.test||ext/fts5/test/fts5interrupt.test",
          "manifest.uuid||manifest.uuid"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "manifest.uuid||manifest.uuid"
          ],
          "candidate": [
            "manifest.uuid||manifest.uuid"
          ]
        }
      },
      "candidate_diff": {
        "ext/fts5/fts5_index.c||ext/fts5/fts5_index.c": [
          "File: ext/fts5/fts5_index.c -> ext/fts5/fts5_index.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3759: ){",
          "3760:   fts5WriteFlushBtree(p, pWriter);",
          "3763: }",
          "",
          "[Removed Lines]",
          "3761:   fts5BufferSet(&p->rc, &pWriter->btterm, nTerm, pTerm);",
          "3762:   pWriter->iBtPage = pWriter->writer.pgno;",
          "",
          "[Added Lines]",
          "3761:   if( p->rc==SQLITE_OK ){",
          "3762:     fts5BufferSet(&p->rc, &pWriter->btterm, nTerm, pTerm);",
          "3763:     pWriter->iBtPage = pWriter->writer.pgno;",
          "3764:   }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3920:   if( (pPage->buf.n + pPgidx->n + nTerm + 2)>=p->pConfig->pgsz ){",
          "3921:     if( pPage->buf.n>4 ){",
          "3922:       fts5WriteFlushLeaf(p, pWriter);",
          "3923:     }",
          "3924:     fts5BufferGrow(&p->rc, &pPage->buf, nTerm+FTS5_DATA_PADDING);",
          "3925:   }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3925:       if( p->rc!=SQLITE_OK ) return;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "3955:         n = 1 + fts5PrefixCompress(nMin, pPage->term.p, pTerm);",
          "3956:       }",
          "3957:       fts5WriteBtreeTerm(p, pWriter, n, pTerm);",
          "3958:       pPage = &pWriter->writer;",
          "3959:     }",
          "3960:   }else{",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3961:       if( p->rc!=SQLITE_OK ) return;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "4521:       sqlite3Fts5HashScanEntry(pHash, &zTerm, &pDoclist, &nDoclist);",
          "4522:       fts5WriteAppendTerm(p, &writer, (int)strlen(zTerm), (const u8*)zTerm);",
          "4524:       assert( writer.bFirstRowidInPage==0 );",
          "4525:       if( pgsz>=(pBuf->n + pPgidx->n + nDoclist + 1) ){",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "4527:       if( p->rc!=SQLITE_OK ) break;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "4601:       assert( pBuf->n<=pBuf->nSpace );",
          "4603:     }",
          "4604:     sqlite3Fts5HashClear(pHash);",
          "4605:     fts5WriteFinish(p, &writer, &pgnoLast);",
          "",
          "[Removed Lines]",
          "4602:       sqlite3Fts5HashScanNext(pHash);",
          "",
          "[Added Lines]",
          "4607:       if( p->rc==SQLITE_OK ) sqlite3Fts5HashScanNext(pHash);",
          "",
          "---------------"
        ],
        "ext/fts5/test/fts5interrupt.test||ext/fts5/test/fts5interrupt.test": [
          "File: ext/fts5/test/fts5interrupt.test -> ext/fts5/test/fts5interrupt.test",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # 2019 Jan 4",
          "2: #",
          "3: # The author disclaims copyright to this source code.  In place of",
          "4: # a legal notice, here is a blessing:",
          "5: #",
          "6: #    May you do good and not evil.",
          "7: #    May you find forgiveness for yourself and forgive others.",
          "8: #    May you share freely, never taking more than you give.",
          "9: #",
          "10: #*************************************************************************",
          "11: # This file implements regression tests for SQLite library.  The",
          "12: # focus of this script is testing the FTS5 module.",
          "13: #",
          "15: source [file join [file dirname [info script]] fts5_common.tcl]",
          "16: set testprefix fts5interrupt",
          "18: # If SQLITE_ENABLE_FTS5 is not defined, omit this file.",
          "19: ifcapable !fts5 {",
          "20:   finish_test",
          "21:   return",
          "22: }",
          "24: do_execsql_test 1.0 {",
          "25:   CREATE VIRTUAL TABLE t1 USING fts5(a);",
          "26:   INSERT INTO t1(t1, rank) VALUES('pgsz', 40);",
          "27: }",
          "28: db_save_and_close",
          "30: proc progress_handler {args} {",
          "31:   incr ::progress_handler_delay -1",
          "32:   if {$::progress_handler_delay<=0} { return 1 }",
          "33:   return 0",
          "34: }",
          "36: foreach {tn sql} {",
          "37:   1 { INSERT INTO t1(rowid, a) VALUES(0, 'z z z z') }",
          "38:   2 { COMMIT }",
          "39: } {",
          "40:   set bDone 0",
          "41:   for {set i 1} {$bDone==0} {incr i} {",
          "42:     do_test 1.$tn.$i {",
          "43:       db_restore_and_reopen",
          "44:       execsql {",
          "45:         BEGIN;",
          "46:           INSERT INTO t1(rowid, a) VALUES(1, 'a b c d');",
          "47:           INSERT INTO t1(rowid, a) VALUES(2, 'd e f g');",
          "48:           INSERT INTO t1(rowid, a) VALUES(3, 'h i j k');",
          "49:           INSERT INTO t1(rowid, a) VALUES(4, 'l m n o');",
          "50:       }",
          "52:       set ::progress_handler_delay $i",
          "53:       db progress 1 progress_handler",
          "54:       set res [catchsql $sql]",
          "55:       db close",
          "56:       if {$res==\"0 {}\"} {",
          "57:         set bDone 1",
          "58:       } else {",
          "59:         if {$res!=\"1 interrupted\"} { error \"got: $res\" }",
          "60:       }",
          "61:       set {} {}",
          "62:     } {}",
          "63:   }",
          "64: }",
          "66: finish_test",
          "",
          "---------------"
        ],
        "manifest.uuid||manifest.uuid": [
          "File: manifest.uuid -> manifest.uuid",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "1: 36eaf5a5e51b20699328aae67c2bfd325f81bea342e2b167fddd859a50a26e28",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}