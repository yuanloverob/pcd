{
  "cve_id": "CVE-2010-3429",
  "cve_desc": "flicvideo.c in libavcodec 0.6 and earlier in FFmpeg, as used in MPlayer and other products, allows remote attackers to execute arbitrary code via a crafted flic file, related to an \"arbitrary offset dereference vulnerability.\"",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "6e73cef6e3b536fbccdb82bd9260440d836b3f03",
  "patch_info": {
    "commit_hash": "6e73cef6e3b536fbccdb82bd9260440d836b3f03",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/6e73cef6e3b536fbccdb82bd9260440d836b3f03",
    "files": [
      "libavcodec/flicvideo.c"
    ],
    "message": "Fix several security issues in flicvideo.c This fixes CVE-2010-3429\n\nOriginally committed as revision 25223 to svn://svn.ffmpeg.org/ffmpeg/trunk",
    "before_after_code_files": [
      "libavcodec/flicvideo.c||libavcodec/flicvideo.c"
    ]
  },
  "patch_diff": {
    "libavcodec/flicvideo.c||libavcodec/flicvideo.c": [
      "File: libavcodec/flicvideo.c -> libavcodec/flicvideo.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "159:     int pixel_skip;",
      "160:     int pixel_countdown;",
      "161:     unsigned char *pixels;",
      "164:     s->frame.reference = 1;",
      "165:     s->frame.buffer_hints = FF_BUFFER_HINTS_VALID | FF_BUFFER_HINTS_PRESERVE | FF_BUFFER_HINTS_REUSABLE;",
      "",
      "[Removed Lines]",
      "162:     int pixel_limit;",
      "",
      "[Added Lines]",
      "162:     unsigned int pixel_limit;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "253:                     av_log(avctx, AV_LOG_ERROR, \"Undefined opcode (%x) in DELTA_FLI\\n\", line_packets);",
      "254:                 } else if ((line_packets & 0xC000) == 0x8000) {",
      "257:                 } else {",
      "258:                     compressed_lines--;",
      "259:                     pixel_ptr = y_ptr;",
      "260:                     pixel_countdown = s->avctx->width;",
      "261:                     for (i = 0; i < line_packets; i++) {",
      "",
      "[Removed Lines]",
      "256:                     pixels[y_ptr + s->frame.linesize[0] - 1] = line_packets & 0xff;",
      "",
      "[Added Lines]",
      "256:                     pixel_ptr= y_ptr + s->frame.linesize[0] - 1;",
      "257:                     CHECK_PIXEL_PTR(0);",
      "258:                     pixels[pixel_ptr] = line_packets & 0xff;",
      "262:                     CHECK_PIXEL_PTR(0);",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "268:                             byte_run = -byte_run;",
      "269:                             palette_idx1 = buf[stream_ptr++];",
      "270:                             palette_idx2 = buf[stream_ptr++];",
      "272:                             for (j = 0; j < byte_run; j++, pixel_countdown -= 2) {",
      "273:                                 pixels[pixel_ptr++] = palette_idx1;",
      "274:                                 pixels[pixel_ptr++] = palette_idx2;",
      "",
      "[Removed Lines]",
      "271:                             CHECK_PIXEL_PTR(byte_run);",
      "",
      "[Added Lines]",
      "274:                             CHECK_PIXEL_PTR(byte_run * 2);",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "298:             stream_ptr += 2;",
      "299:             while (compressed_lines > 0) {",
      "300:                 pixel_ptr = y_ptr;",
      "301:                 pixel_countdown = s->avctx->width;",
      "302:                 line_packets = buf[stream_ptr++];",
      "303:                 if (line_packets > 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "304:                 CHECK_PIXEL_PTR(0);",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "453:     int pixel_countdown;",
      "454:     unsigned char *pixels;",
      "455:     int pixel;",
      "458:     s->frame.reference = 1;",
      "459:     s->frame.buffer_hints = FF_BUFFER_HINTS_VALID | FF_BUFFER_HINTS_PRESERVE | FF_BUFFER_HINTS_REUSABLE;",
      "",
      "[Removed Lines]",
      "456:     int pixel_limit;",
      "",
      "[Added Lines]",
      "460:     unsigned int pixel_limit;",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "503:                 } else {",
      "504:                     compressed_lines--;",
      "505:                     pixel_ptr = y_ptr;",
      "506:                     pixel_countdown = s->avctx->width;",
      "507:                     for (i = 0; i < line_packets; i++) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "510:                     CHECK_PIXEL_PTR(0);",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "514:                             byte_run = -byte_run;",
      "515:                             pixel    = AV_RL16(&buf[stream_ptr]);",
      "516:                             stream_ptr += 2;",
      "518:                             for (j = 0; j < byte_run; j++, pixel_countdown -= 2) {",
      "520:                                 pixel_ptr += 2;",
      "521:                             }",
      "522:                         } else {",
      "524:                             for (j = 0; j < byte_run; j++, pixel_countdown--) {",
      "526:                                 stream_ptr += 2;",
      "",
      "[Removed Lines]",
      "517:                             CHECK_PIXEL_PTR(byte_run);",
      "523:                             CHECK_PIXEL_PTR(byte_run);",
      "",
      "[Added Lines]",
      "522:                             CHECK_PIXEL_PTR(2 * byte_run);",
      "528:                             CHECK_PIXEL_PTR(2 * byte_run);",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "611:                     if (byte_run > 0) {",
      "612:                         pixel    = AV_RL16(&buf[stream_ptr]);",
      "613:                         stream_ptr += 2;",
      "615:                         for (j = 0; j < byte_run; j++) {",
      "617:                             pixel_ptr += 2;",
      "",
      "[Removed Lines]",
      "614:                         CHECK_PIXEL_PTR(byte_run);",
      "",
      "[Added Lines]",
      "619:                         CHECK_PIXEL_PTR(2 * byte_run);",
      "",
      "---------------",
      "--- Hunk 9 ---",
      "[Context before]",
      "622:                         }",
      "624:                         byte_run = -byte_run;",
      "626:                         for (j = 0; j < byte_run; j++) {",
      "628:                             stream_ptr += 2;",
      "",
      "[Removed Lines]",
      "625:                         CHECK_PIXEL_PTR(byte_run);",
      "",
      "[Added Lines]",
      "630:                         CHECK_PIXEL_PTR(2 * byte_run);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "79a16f0cac9a7251c7849923a25ddb048b5ce5f6",
      "candidate_info": {
        "commit_hash": "79a16f0cac9a7251c7849923a25ddb048b5ce5f6",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/79a16f0cac9a7251c7849923a25ddb048b5ce5f6",
        "files": [
          "libavcodec/flicvideo.c"
        ],
        "message": "Fix several security issues in flicvideo.c This fixes CVE-2010-3429\n\nbackport r25223 by michael\n\n\nOriginally committed as revision 25307 to svn://svn.ffmpeg.org/ffmpeg/branches/0.6",
        "before_after_code_files": [
          "libavcodec/flicvideo.c||libavcodec/flicvideo.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/flicvideo.c||libavcodec/flicvideo.c"
          ],
          "candidate": [
            "libavcodec/flicvideo.c||libavcodec/flicvideo.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/flicvideo.c||libavcodec/flicvideo.c": [
          "File: libavcodec/flicvideo.c -> libavcodec/flicvideo.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "159:     int pixel_skip;",
          "160:     int pixel_countdown;",
          "161:     unsigned char *pixels;",
          "164:     s->frame.reference = 1;",
          "165:     s->frame.buffer_hints = FF_BUFFER_HINTS_VALID | FF_BUFFER_HINTS_PRESERVE | FF_BUFFER_HINTS_REUSABLE;",
          "",
          "[Removed Lines]",
          "162:     int pixel_limit;",
          "",
          "[Added Lines]",
          "162:     unsigned int pixel_limit;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "253:                     av_log(avctx, AV_LOG_ERROR, \"Undefined opcode (%x) in DELTA_FLI\\n\", line_packets);",
          "254:                 } else if ((line_packets & 0xC000) == 0x8000) {",
          "257:                 } else {",
          "258:                     compressed_lines--;",
          "259:                     pixel_ptr = y_ptr;",
          "260:                     pixel_countdown = s->avctx->width;",
          "261:                     for (i = 0; i < line_packets; i++) {",
          "",
          "[Removed Lines]",
          "256:                     pixels[y_ptr + s->frame.linesize[0] - 1] = line_packets & 0xff;",
          "",
          "[Added Lines]",
          "256:                     pixel_ptr= y_ptr + s->frame.linesize[0] - 1;",
          "257:                     CHECK_PIXEL_PTR(0);",
          "258:                     pixels[pixel_ptr] = line_packets & 0xff;",
          "262:                     CHECK_PIXEL_PTR(0);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "268:                             byte_run = -byte_run;",
          "269:                             palette_idx1 = buf[stream_ptr++];",
          "270:                             palette_idx2 = buf[stream_ptr++];",
          "272:                             for (j = 0; j < byte_run; j++, pixel_countdown -= 2) {",
          "273:                                 pixels[pixel_ptr++] = palette_idx1;",
          "274:                                 pixels[pixel_ptr++] = palette_idx2;",
          "",
          "[Removed Lines]",
          "271:                             CHECK_PIXEL_PTR(byte_run);",
          "",
          "[Added Lines]",
          "274:                             CHECK_PIXEL_PTR(byte_run * 2);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "298:             stream_ptr += 2;",
          "299:             while (compressed_lines > 0) {",
          "300:                 pixel_ptr = y_ptr;",
          "301:                 pixel_countdown = s->avctx->width;",
          "302:                 line_packets = buf[stream_ptr++];",
          "303:                 if (line_packets > 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "304:                 CHECK_PIXEL_PTR(0);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "453:     int pixel_countdown;",
          "454:     unsigned char *pixels;",
          "455:     int pixel;",
          "458:     s->frame.reference = 1;",
          "459:     s->frame.buffer_hints = FF_BUFFER_HINTS_VALID | FF_BUFFER_HINTS_PRESERVE | FF_BUFFER_HINTS_REUSABLE;",
          "",
          "[Removed Lines]",
          "456:     int pixel_limit;",
          "",
          "[Added Lines]",
          "460:     unsigned int pixel_limit;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "503:                 } else {",
          "504:                     compressed_lines--;",
          "505:                     pixel_ptr = y_ptr;",
          "506:                     pixel_countdown = s->avctx->width;",
          "507:                     for (i = 0; i < line_packets; i++) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "510:                     CHECK_PIXEL_PTR(0);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "514:                             byte_run = -byte_run;",
          "515:                             pixel    = AV_RL16(&buf[stream_ptr]);",
          "516:                             stream_ptr += 2;",
          "518:                             for (j = 0; j < byte_run; j++, pixel_countdown -= 2) {",
          "520:                                 pixel_ptr += 2;",
          "521:                             }",
          "522:                         } else {",
          "524:                             for (j = 0; j < byte_run; j++, pixel_countdown--) {",
          "526:                                 stream_ptr += 2;",
          "",
          "[Removed Lines]",
          "517:                             CHECK_PIXEL_PTR(byte_run);",
          "523:                             CHECK_PIXEL_PTR(byte_run);",
          "",
          "[Added Lines]",
          "522:                             CHECK_PIXEL_PTR(2 * byte_run);",
          "528:                             CHECK_PIXEL_PTR(2 * byte_run);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "611:                     if (byte_run > 0) {",
          "612:                         pixel    = AV_RL16(&buf[stream_ptr]);",
          "613:                         stream_ptr += 2;",
          "615:                         for (j = 0; j < byte_run; j++) {",
          "617:                             pixel_ptr += 2;",
          "",
          "[Removed Lines]",
          "614:                         CHECK_PIXEL_PTR(byte_run);",
          "",
          "[Added Lines]",
          "619:                         CHECK_PIXEL_PTR(2 * byte_run);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "622:                         }",
          "624:                         byte_run = -byte_run;",
          "626:                         for (j = 0; j < byte_run; j++) {",
          "628:                             stream_ptr += 2;",
          "",
          "[Removed Lines]",
          "625:                         CHECK_PIXEL_PTR(byte_run);",
          "",
          "[Added Lines]",
          "630:                         CHECK_PIXEL_PTR(2 * byte_run);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2f504d7a90605b77d1a9ac43a8d1efa208e0f515",
      "candidate_info": {
        "commit_hash": "2f504d7a90605b77d1a9ac43a8d1efa208e0f515",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/2f504d7a90605b77d1a9ac43a8d1efa208e0f515",
        "files": [
          "libavcodec/flicvideo.c"
        ],
        "message": "Fix several security issues in flicvideo.c This fixes CVE-2010-3429\n\nbackport r25223 by michael\n\n\nOriginally committed as revision 25325 to svn://svn.ffmpeg.org/ffmpeg/branches/0.5",
        "before_after_code_files": [
          "libavcodec/flicvideo.c||libavcodec/flicvideo.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_olp_changes": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/flicvideo.c||libavcodec/flicvideo.c"
          ],
          "candidate": [
            "libavcodec/flicvideo.c||libavcodec/flicvideo.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/flicvideo.c||libavcodec/flicvideo.c": [
          "File: libavcodec/flicvideo.c -> libavcodec/flicvideo.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "160:     int pixel_skip;",
          "161:     int pixel_countdown;",
          "162:     unsigned char *pixels;",
          "165:     s->frame.reference = 1;",
          "166:     s->frame.buffer_hints = FF_BUFFER_HINTS_VALID | FF_BUFFER_HINTS_PRESERVE | FF_BUFFER_HINTS_REUSABLE;",
          "",
          "[Removed Lines]",
          "163:     int pixel_limit;",
          "",
          "[Added Lines]",
          "163:     unsigned int pixel_limit;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "254:                     av_log(avctx, AV_LOG_ERROR, \"Undefined opcode (%x) in DELTA_FLI\\n\", line_packets);",
          "255:                 } else if ((line_packets & 0xC000) == 0x8000) {",
          "258:                 } else {",
          "259:                     compressed_lines--;",
          "260:                     pixel_ptr = y_ptr;",
          "261:                     pixel_countdown = s->avctx->width;",
          "262:                     for (i = 0; i < line_packets; i++) {",
          "",
          "[Removed Lines]",
          "257:                     pixels[y_ptr + s->frame.linesize[0] - 1] = line_packets & 0xff;",
          "",
          "[Added Lines]",
          "257:                     pixel_ptr= y_ptr + s->frame.linesize[0] - 1;",
          "258:                     CHECK_PIXEL_PTR(0);",
          "259:                     pixels[pixel_ptr] = line_packets & 0xff;",
          "263:                     CHECK_PIXEL_PTR(0);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "269:                             byte_run = -byte_run;",
          "270:                             palette_idx1 = buf[stream_ptr++];",
          "271:                             palette_idx2 = buf[stream_ptr++];",
          "273:                             for (j = 0; j < byte_run; j++, pixel_countdown -= 2) {",
          "274:                                 pixels[pixel_ptr++] = palette_idx1;",
          "275:                                 pixels[pixel_ptr++] = palette_idx2;",
          "",
          "[Removed Lines]",
          "272:                             CHECK_PIXEL_PTR(byte_run);",
          "",
          "[Added Lines]",
          "275:                             CHECK_PIXEL_PTR(byte_run * 2);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "299:             stream_ptr += 2;",
          "300:             while (compressed_lines > 0) {",
          "301:                 pixel_ptr = y_ptr;",
          "302:                 pixel_countdown = s->avctx->width;",
          "303:                 line_packets = buf[stream_ptr++];",
          "304:                 if (line_packets > 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "305:                 CHECK_PIXEL_PTR(0);",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "454:     int pixel_countdown;",
          "455:     unsigned char *pixels;",
          "456:     int pixel;",
          "459:     s->frame.reference = 1;",
          "460:     s->frame.buffer_hints = FF_BUFFER_HINTS_VALID | FF_BUFFER_HINTS_PRESERVE | FF_BUFFER_HINTS_REUSABLE;",
          "",
          "[Removed Lines]",
          "457:     int pixel_limit;",
          "",
          "[Added Lines]",
          "461:     unsigned int pixel_limit;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "504:                 } else {",
          "505:                     compressed_lines--;",
          "506:                     pixel_ptr = y_ptr;",
          "507:                     pixel_countdown = s->avctx->width;",
          "508:                     for (i = 0; i < line_packets; i++) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "511:                     CHECK_PIXEL_PTR(0);",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "515:                             byte_run = -byte_run;",
          "516:                             pixel    = AV_RL16(&buf[stream_ptr]);",
          "517:                             stream_ptr += 2;",
          "519:                             for (j = 0; j < byte_run; j++, pixel_countdown -= 2) {",
          "521:                                 pixel_ptr += 2;",
          "522:                             }",
          "523:                         } else {",
          "525:                             for (j = 0; j < byte_run; j++, pixel_countdown--) {",
          "527:                                 stream_ptr += 2;",
          "",
          "[Removed Lines]",
          "518:                             CHECK_PIXEL_PTR(byte_run);",
          "524:                             CHECK_PIXEL_PTR(byte_run);",
          "",
          "[Added Lines]",
          "523:                             CHECK_PIXEL_PTR(2 * byte_run);",
          "529:                             CHECK_PIXEL_PTR(2 * byte_run);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "612:                     if (byte_run > 0) {",
          "613:                         pixel    = AV_RL16(&buf[stream_ptr]);",
          "614:                         stream_ptr += 2;",
          "616:                         for (j = 0; j < byte_run; j++) {",
          "618:                             pixel_ptr += 2;",
          "",
          "[Removed Lines]",
          "615:                         CHECK_PIXEL_PTR(byte_run);",
          "",
          "[Added Lines]",
          "620:                         CHECK_PIXEL_PTR(2 * byte_run);",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "623:                         }",
          "625:                         byte_run = -byte_run;",
          "627:                         for (j = 0; j < byte_run; j++) {",
          "629:                             stream_ptr += 2;",
          "",
          "[Removed Lines]",
          "626:                         CHECK_PIXEL_PTR(byte_run);",
          "",
          "[Added Lines]",
          "631:                         CHECK_PIXEL_PTR(2 * byte_run);",
          "",
          "---------------"
        ]
      }
    }
  ]
}