{
  "cve_id": "CVE-2014-4344",
  "cve_desc": "The acc_ctx_cont function in the SPNEGO acceptor in lib/gssapi/spnego/spnego_mech.c in MIT Kerberos 5 (aka krb5) 1.5.x through 1.12.x before 1.12.2 allows remote attackers to cause a denial of service (NULL pointer dereference and application crash) via an empty continuation token at a certain point during a SPNEGO negotiation.",
  "repo": "krb5/krb5",
  "patch_hash": "a7886f0ed1277c69142b14a2c6629175a6331edc",
  "patch_info": {
    "commit_hash": "a7886f0ed1277c69142b14a2c6629175a6331edc",
    "repo": "krb5/krb5",
    "commit_url": "https://github.com/krb5/krb5/commit/a7886f0ed1277c69142b14a2c6629175a6331edc",
    "files": [
      "src/lib/gssapi/spnego/spnego_mech.c"
    ],
    "message": "Fix null deref in SPNEGO acceptor [CVE-2014-4344]\n\nWhen processing a continuation token, acc_ctx_cont was dereferencing\nthe initial byte of the token without checking the length.  This could\nresult in a null dereference.\n\nCVE-2014-4344:\n\nIn MIT krb5 1.5 and newer, an unauthenticated or partially\nauthenticated remote attacker can cause a NULL dereference and\napplication crash during a SPNEGO negotiation by sending an empty\ntoken as the second or later context token from initiator to acceptor.\nThe attacker must provide at least one valid context token in the\nsecurity context negotiation before sending the empty token.  This can\nbe done by an unauthenticated attacker by forcing SPNEGO to\nrenegotiate the underlying mechanism, or by using IAKERB to wrap an\nunauthenticated AS-REQ as the first token.\n\n    CVSSv2 Vector: AV:N/AC:L/Au:N/C:N/I:N/A:C/E:POC/RL:OF/RC:C\n\n[kaduk@mit.edu: CVE summary, CVSSv2 vector]\n\n(cherry picked from commit 524688ce87a15fc75f87efc8c039ba4c7d5c197b)\n\nticket: 7970\nversion_fixed: 1.12.2\nstatus: resolved",
    "before_after_code_files": [
      "src/lib/gssapi/spnego/spnego_mech.c||src/lib/gssapi/spnego/spnego_mech.c"
    ]
  },
  "patch_diff": {
    "src/lib/gssapi/spnego/spnego_mech.c||src/lib/gssapi/spnego/spnego_mech.c": [
      "File: src/lib/gssapi/spnego/spnego_mech.c -> src/lib/gssapi/spnego/spnego_mech.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1443:  ptr = bufstart = buf->value;",
      "1444: #define REMAIN (buf->length - (ptr - bufstart))",
      "1446:   return GSS_S_DEFECTIVE_TOKEN;",
      "",
      "[Removed Lines]",
      "1445:  if (REMAIN > INT_MAX)",
      "",
      "[Added Lines]",
      "1445:  if (REMAIN == 0 || REMAIN > INT_MAX)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "524688ce87a15fc75f87efc8c039ba4c7d5c197b",
      "candidate_info": {
        "commit_hash": "524688ce87a15fc75f87efc8c039ba4c7d5c197b",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/524688ce87a15fc75f87efc8c039ba4c7d5c197b",
        "files": [
          "src/lib/gssapi/spnego/spnego_mech.c"
        ],
        "message": "Fix null deref in SPNEGO acceptor [CVE-2014-4344]\n\nWhen processing a continuation token, acc_ctx_cont was dereferencing\nthe initial byte of the token without checking the length.  This could\nresult in a null dereference.\n\nCVE-2014-4344:\n\nIn MIT krb5 1.5 and newer, an unauthenticated or partially\nauthenticated remote attacker can cause a NULL dereference and\napplication crash during a SPNEGO negotiation by sending an empty\ntoken as the second or later context token from initiator to acceptor.\nThe attacker must provide at least one valid context token in the\nsecurity context negotiation before sending the empty token.  This can\nbe done by an unauthenticated attacker by forcing SPNEGO to\nrenegotiate the underlying mechanism, or by using IAKERB to wrap an\nunauthenticated AS-REQ as the first token.\n\n    CVSSv2 Vector: AV:N/AC:L/Au:N/C:N/I:N/A:C/E:POC/RL:OF/RC:C\n\n[kaduk@mit.edu: CVE summary, CVSSv2 vector]\n\nticket: 7970 (new)\nsubject: NULL dereference in SPNEGO acceptor for continuation tokens [CVE-2014-4344]\ntarget_version: 1.12.2\ntags: pullup",
        "before_after_code_files": [
          "src/lib/gssapi/spnego/spnego_mech.c||src/lib/gssapi/spnego/spnego_mech.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/gssapi/spnego/spnego_mech.c||src/lib/gssapi/spnego/spnego_mech.c"
          ],
          "candidate": [
            "src/lib/gssapi/spnego/spnego_mech.c||src/lib/gssapi/spnego/spnego_mech.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/gssapi/spnego/spnego_mech.c||src/lib/gssapi/spnego/spnego_mech.c": [
          "File: src/lib/gssapi/spnego/spnego_mech.c -> src/lib/gssapi/spnego/spnego_mech.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1469:  ptr = bufstart = buf->value;",
          "1470: #define REMAIN (buf->length - (ptr - bufstart))",
          "1472:   return GSS_S_DEFECTIVE_TOKEN;",
          "",
          "[Removed Lines]",
          "1471:  if (REMAIN > INT_MAX)",
          "",
          "[Added Lines]",
          "1471:  if (REMAIN == 0 || REMAIN > INT_MAX)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "90df9bcfe3124ccac2cf2399e3286103076a2271",
      "candidate_info": {
        "commit_hash": "90df9bcfe3124ccac2cf2399e3286103076a2271",
        "repo": "krb5/krb5",
        "commit_url": "https://github.com/krb5/krb5/commit/90df9bcfe3124ccac2cf2399e3286103076a2271",
        "files": [
          "src/lib/gssapi/spnego/spnego_mech.c"
        ],
        "message": "Fix null deref in SPNEGO acceptor [CVE-2014-4344]\n\nWhen processing a continuation token, acc_ctx_cont was dereferencing\nthe initial byte of the token without checking the length.  This could\nresult in a null dereference.\n\nCVE-2014-4344:\n\nIn MIT krb5 1.5 and newer, an unauthenticated or partially\nauthenticated remote attacker can cause a NULL dereference and\napplication crash during a SPNEGO negotiation by sending an empty\ntoken as the second or later context token from initiator to acceptor.\nThe attacker must provide at least one valid context token in the\nsecurity context negotiation before sending the empty token.  This can\nbe done by an unauthenticated attacker by forcing SPNEGO to\nrenegotiate the underlying mechanism, or by using IAKERB to wrap an\nunauthenticated AS-REQ as the first token.\n\n    CVSSv2 Vector: AV:N/AC:L/Au:N/C:N/I:N/A:C/E:POC/RL:OF/RC:C\n\n[kaduk@mit.edu: CVE summary, CVSSv2 vector]\n\n(cherry picked from commit 524688ce87a15fc75f87efc8c039ba4c7d5c197b)\n\nticket: 8114 (new)\nsubject: NULL dereference in SPNEGO acceptor for continuation tokens [CVE-2014-4344]\nversion_fixed: 1.11.6\nstatus: resolved",
        "before_after_code_files": [
          "src/lib/gssapi/spnego/spnego_mech.c||src/lib/gssapi/spnego/spnego_mech.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "src/lib/gssapi/spnego/spnego_mech.c||src/lib/gssapi/spnego/spnego_mech.c"
          ],
          "candidate": [
            "src/lib/gssapi/spnego/spnego_mech.c||src/lib/gssapi/spnego/spnego_mech.c"
          ]
        }
      },
      "candidate_diff": {
        "src/lib/gssapi/spnego/spnego_mech.c||src/lib/gssapi/spnego/spnego_mech.c": [
          "File: src/lib/gssapi/spnego/spnego_mech.c -> src/lib/gssapi/spnego/spnego_mech.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1438:  ptr = bufstart = buf->value;",
          "1439: #define REMAIN (buf->length - (ptr - bufstart))",
          "1441:   return GSS_S_DEFECTIVE_TOKEN;",
          "",
          "[Removed Lines]",
          "1440:  if (REMAIN > INT_MAX)",
          "",
          "[Added Lines]",
          "1440:  if (REMAIN == 0 || REMAIN > INT_MAX)",
          "",
          "---------------"
        ]
      }
    }
  ]
}