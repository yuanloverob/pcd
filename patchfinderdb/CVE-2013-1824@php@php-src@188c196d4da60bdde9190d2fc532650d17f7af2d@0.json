{
  "cve_id": "CVE-2013-1824",
  "cve_desc": "The SOAP parser in PHP before 5.3.22 and 5.4.x before 5.4.12 allows remote attackers to read arbitrary files via a SOAP WSDL file containing an XML external entity declaration in conjunction with an entity reference, related to an XML External Entity (XXE) issue in the soap_xmlParseFile and soap_xmlParseMemory functions.",
  "repo": "php/php-src",
  "patch_hash": "188c196d4da60bdde9190d2fc532650d17f7af2d",
  "patch_info": {
    "commit_hash": "188c196d4da60bdde9190d2fc532650d17f7af2d",
    "repo": "php/php-src",
    "commit_url": "https://github.com/php/php-src/commit/188c196d4da60bdde9190d2fc532650d17f7af2d",
    "files": [
      "ext/soap/php_xml.c"
    ],
    "message": "Proper bit reset code",
    "before_after_code_files": [
      "ext/soap/php_xml.c||ext/soap/php_xml.c"
    ]
  },
  "patch_diff": {
    "ext/soap/php_xml.c||ext/soap/php_xml.c": [
      "File: ext/soap/php_xml.c -> ext/soap/php_xml.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "92:  PG(allow_url_fopen) = old_allow_url_fopen;",
      "93:  if (ctxt) {",
      "94:   ctxt->keepBlanks = 0;",
      "96:   ctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;",
      "97:   ctxt->sax->comment = soap_Comment;",
      "98:   ctxt->sax->warning = NULL;",
      "",
      "[Removed Lines]",
      "95:   ctxt->options -= XML_PARSE_DTDLOAD;",
      "",
      "[Added Lines]",
      "95:   ctxt->options &= ~XML_PARSE_DTDLOAD;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "135:  ctxt = xmlCreateMemoryParserCtxt(buf, buf_size);",
      "136:  if (ctxt) {",
      "138:   ctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;",
      "139:   ctxt->sax->comment = soap_Comment;",
      "140:   ctxt->sax->warning = NULL;",
      "",
      "[Removed Lines]",
      "137:   ctxt->options -= XML_PARSE_DTDLOAD;",
      "",
      "[Added Lines]",
      "137:   ctxt->options &= ~XML_PARSE_DTDLOAD;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "588d7adcb2660ab6a4e1736b88c45b7e073aa74d",
      "candidate_info": {
        "commit_hash": "588d7adcb2660ab6a4e1736b88c45b7e073aa74d",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/588d7adcb2660ab6a4e1736b88c45b7e073aa74d",
        "files": [
          "ext/soap/php_xml.c"
        ],
        "message": "Proper bit reset code (cherry picked from commit 188c196d4da60bdde9190d2fc532650d17f7af2d)",
        "before_after_code_files": [
          "ext/soap/php_xml.c||ext/soap/php_xml.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/soap/php_xml.c||ext/soap/php_xml.c"
          ],
          "candidate": [
            "ext/soap/php_xml.c||ext/soap/php_xml.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/soap/php_xml.c||ext/soap/php_xml.c": [
          "File: ext/soap/php_xml.c -> ext/soap/php_xml.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "92:  PG(allow_url_fopen) = old_allow_url_fopen;",
          "93:  if (ctxt) {",
          "94:   ctxt->keepBlanks = 0;",
          "96:   ctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;",
          "97:   ctxt->sax->comment = soap_Comment;",
          "98:   ctxt->sax->warning = NULL;",
          "",
          "[Removed Lines]",
          "95:   ctxt->options -= XML_PARSE_DTDLOAD;",
          "",
          "[Added Lines]",
          "95:   ctxt->options &= ~XML_PARSE_DTDLOAD;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "135:  ctxt = xmlCreateMemoryParserCtxt(buf, buf_size);",
          "136:  if (ctxt) {",
          "138:   ctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;",
          "139:   ctxt->sax->comment = soap_Comment;",
          "140:   ctxt->sax->warning = NULL;",
          "",
          "[Removed Lines]",
          "137:   ctxt->options -= XML_PARSE_DTDLOAD;",
          "",
          "[Added Lines]",
          "137:   ctxt->options &= ~XML_PARSE_DTDLOAD;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "afe98b7829d50806559acac9b530acb8283c3bf4",
      "candidate_info": {
        "commit_hash": "afe98b7829d50806559acac9b530acb8283c3bf4",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/afe98b7829d50806559acac9b530acb8283c3bf4",
        "files": [
          "ext/soap/php_xml.c"
        ],
        "message": "Disabled external entities loading",
        "before_after_code_files": [
          "ext/soap/php_xml.c||ext/soap/php_xml.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/soap/php_xml.c||ext/soap/php_xml.c"
          ],
          "candidate": [
            "ext/soap/php_xml.c||ext/soap/php_xml.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/soap/php_xml.c||ext/soap/php_xml.c": [
          "File: ext/soap/php_xml.c -> ext/soap/php_xml.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "92:  PG(allow_url_fopen) = old_allow_url_fopen;",
          "93:  if (ctxt) {",
          "94:   ctxt->keepBlanks = 0;",
          "95:   ctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;",
          "96:   ctxt->sax->comment = soap_Comment;",
          "97:   ctxt->sax->warning = NULL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "95:   ctxt->options -= XML_PARSE_DTDLOAD;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "134:  ctxt = xmlCreateMemoryParserCtxt(buf, buf_size);",
          "135:  if (ctxt) {",
          "136:   ctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;",
          "137:   ctxt->sax->comment = soap_Comment;",
          "138:   ctxt->sax->warning = NULL;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "137:   ctxt->options -= XML_PARSE_DTDLOAD;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8e76d0404b7f664ee6719fd98f0483f0ac4669d6",
      "candidate_info": {
        "commit_hash": "8e76d0404b7f664ee6719fd98f0483f0ac4669d6",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/8e76d0404b7f664ee6719fd98f0483f0ac4669d6",
        "files": [
          "ext/libxml/libxml.c",
          "ext/libxml/php_libxml.h",
          "ext/soap/php_xml.c"
        ],
        "message": "Fixed external entity loading",
        "before_after_code_files": [
          "ext/libxml/libxml.c||ext/libxml/libxml.c",
          "ext/libxml/php_libxml.h||ext/libxml/php_libxml.h",
          "ext/soap/php_xml.c||ext/soap/php_xml.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "ext/soap/php_xml.c||ext/soap/php_xml.c"
          ],
          "candidate": [
            "ext/soap/php_xml.c||ext/soap/php_xml.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/libxml/libxml.c||ext/libxml/libxml.c": [
          "File: ext/libxml/libxml.c -> ext/libxml/libxml.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "261:  libxml_globals->stream_context = NULL;",
          "262:  libxml_globals->error_buffer.c = NULL;",
          "263:  libxml_globals->error_list = NULL;",
          "264: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "264:  libxml_globals->entity_loader_disabled = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "347:  return php_stream_close((php_stream*)context);",
          "348: }",
          "356: static xmlParserInputBufferPtr",
          "357: php_libxml_input_buffer_create_filename(const char *URI, xmlCharEncoding enc)",
          "358: {",
          "359:  xmlParserInputBufferPtr ret;",
          "360:  void *context = NULL;",
          "362:  if (URI == NULL)",
          "363:   return(NULL);",
          "",
          "[Removed Lines]",
          "350: static xmlParserInputBufferPtr",
          "351: php_libxml_input_buffer_noload(const char *URI, xmlCharEncoding enc)",
          "352: {",
          "353:  return NULL;",
          "354: }",
          "",
          "[Added Lines]",
          "356:  TSRMLS_FETCH();",
          "358:  if (LIBXML(entity_loader_disabled)) {",
          "359:   return NULL;",
          "360:  }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "834: }",
          "839: static PHP_FUNCTION(libxml_disable_entity_loader)",
          "840: {",
          "841:  zend_bool disable = 1;",
          "844:  if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"|b\", &disable) == FAILURE) {",
          "845:   return;",
          "846:  }",
          "859: }",
          "",
          "[Removed Lines]",
          "842:  xmlParserInputBufferCreateFilenameFunc old;",
          "848:  if (disable == 0) {",
          "849:   old = xmlParserInputBufferCreateFilenameDefault(php_libxml_input_buffer_create_filename);",
          "850:  } else {",
          "851:   old = xmlParserInputBufferCreateFilenameDefault(php_libxml_input_buffer_noload);",
          "852:  }",
          "854:  if (old == php_libxml_input_buffer_noload) {",
          "855:   RETURN_TRUE;",
          "856:  }",
          "858:  RETURN_FALSE;",
          "",
          "[Added Lines]",
          "837: PHP_LIBXML_API zend_bool php_libxml_disable_entity_loader(zend_bool disable TSRMLS_DC)",
          "838: {",
          "839:  zend_bool old = LIBXML(entity_loader_disabled);",
          "841:  LIBXML(entity_loader_disabled) = disable;",
          "842:  return old;",
          "843: }",
          "855:  RETURN_BOOL(php_libxml_disable_entity_loader(disable TSRMLS_CC));",
          "",
          "---------------"
        ],
        "ext/libxml/php_libxml.h||ext/libxml/php_libxml.h": [
          "File: ext/libxml/php_libxml.h -> ext/libxml/php_libxml.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "43:  zval *stream_context;",
          "44:  smart_str error_buffer;",
          "45:  zend_llist *error_list;",
          "46: ZEND_END_MODULE_GLOBALS(libxml)",
          "48: typedef struct _libxml_doc_props {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "46:  zend_bool entity_loader_disabled;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "93: PHP_LIBXML_API int php_libxml_xmlCheckUTF8(const unsigned char *s);",
          "94: PHP_LIBXML_API zval *php_libxml_switch_context(zval *context TSRMLS_DC);",
          "95: PHP_LIBXML_API void php_libxml_issue_error(int level, const char *msg TSRMLS_DC);",
          "98: PHP_LIBXML_API void php_libxml_initialize(void);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "97: PHP_LIBXML_API zend_bool php_libxml_disable_entity_loader(zend_bool disable TSRMLS_DC);",
          "",
          "---------------"
        ],
        "ext/soap/php_xml.c||ext/soap/php_xml.c": [
          "File: ext/soap/php_xml.c -> ext/soap/php_xml.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: #include \"php_soap.h\"",
          "23: #include \"libxml/parser.h\"",
          "24: #include \"libxml/parserInternals.h\"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "23: #include \"ext/libxml/php_libxml.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "91:  ctxt = xmlCreateFileParserCtxt(filename);",
          "92:  PG(allow_url_fopen) = old_allow_url_fopen;",
          "93:  if (ctxt) {",
          "94:   ctxt->keepBlanks = 0;",
          "96:   ctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;",
          "97:   ctxt->sax->comment = soap_Comment;",
          "98:   ctxt->sax->warning = NULL;",
          "99:   ctxt->sax->error = NULL;",
          "101:   xmlParseDocument(ctxt);",
          "102:   if (ctxt->wellFormed) {",
          "103:    ret = ctxt->myDoc;",
          "104:    if (ret->URL == NULL && ctxt->directory != NULL) {",
          "",
          "[Removed Lines]",
          "95:   ctxt->options &= ~XML_PARSE_DTDLOAD;",
          "",
          "[Added Lines]",
          "95:   zend_bool old;",
          "103:   old = php_libxml_disable_entity_loader(1);",
          "105:   php_libxml_disable_entity_loader(old);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "135:  ctxt = xmlCreateMemoryParserCtxt(buf, buf_size);",
          "136:  if (ctxt) {",
          "138:   ctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;",
          "139:   ctxt->sax->comment = soap_Comment;",
          "140:   ctxt->sax->warning = NULL;",
          "",
          "[Removed Lines]",
          "137:   ctxt->options &= ~XML_PARSE_DTDLOAD;",
          "",
          "[Added Lines]",
          "141:   zend_bool old;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "143: #if LIBXML_VERSION >= 20703",
          "144:   ctxt->options |= XML_PARSE_HUGE;",
          "145: #endif",
          "146:   xmlParseDocument(ctxt);",
          "147:   if (ctxt->wellFormed) {",
          "148:    ret = ctxt->myDoc;",
          "149:    if (ret->URL == NULL && ctxt->directory != NULL) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "151:   old = php_libxml_disable_entity_loader(1);",
          "153:   php_libxml_disable_entity_loader(old);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "904d2202eaecb7c300c36f37ebc5503513220c09",
      "candidate_info": {
        "commit_hash": "904d2202eaecb7c300c36f37ebc5503513220c09",
        "repo": "php/php-src",
        "commit_url": "https://github.com/php/php-src/commit/904d2202eaecb7c300c36f37ebc5503513220c09",
        "files": [
          "ext/soap/php_xml.c"
        ],
        "message": "Proper bit reset code",
        "before_after_code_files": [
          "ext/soap/php_xml.c||ext/soap/php_xml.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "ext/soap/php_xml.c||ext/soap/php_xml.c"
          ],
          "candidate": [
            "ext/soap/php_xml.c||ext/soap/php_xml.c"
          ]
        }
      },
      "candidate_diff": {
        "ext/soap/php_xml.c||ext/soap/php_xml.c": [
          "File: ext/soap/php_xml.c -> ext/soap/php_xml.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "92:  PG(allow_url_fopen) = old_allow_url_fopen;",
          "93:  if (ctxt) {",
          "94:   ctxt->keepBlanks = 0;",
          "96:   ctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;",
          "97:   ctxt->sax->comment = soap_Comment;",
          "98:   ctxt->sax->warning = NULL;",
          "",
          "[Removed Lines]",
          "95:   ctxt->options -= XML_PARSE_DTDLOAD;",
          "",
          "[Added Lines]",
          "95:   ctxt->options &= ~XML_PARSE_DTDLOAD;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "135:  ctxt = xmlCreateMemoryParserCtxt(buf, buf_size);",
          "136:  if (ctxt) {",
          "138:   ctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;",
          "139:   ctxt->sax->comment = soap_Comment;",
          "140:   ctxt->sax->warning = NULL;",
          "",
          "[Removed Lines]",
          "137:   ctxt->options -= XML_PARSE_DTDLOAD;",
          "",
          "[Added Lines]",
          "137:   ctxt->options &= ~XML_PARSE_DTDLOAD;",
          "",
          "---------------"
        ]
      }
    }
  ]
}