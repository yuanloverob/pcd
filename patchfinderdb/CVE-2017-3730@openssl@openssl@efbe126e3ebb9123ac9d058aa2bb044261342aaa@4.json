{
  "cve_id": "CVE-2017-3730",
  "cve_desc": "In OpenSSL 1.1.0 before 1.1.0d, if a malicious server supplies bad parameters for a DHE or ECDHE key exchange then this can result in the client attempting to dereference a NULL pointer leading to a client crash. This could be exploited in a Denial of Service attack.",
  "repo": "openssl/openssl",
  "patch_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
  "patch_info": {
    "commit_hash": "efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/efbe126e3ebb9123ac9d058aa2bb044261342aaa",
    "files": [
      "ssl/statem/statem_clnt.c"
    ],
    "message": "Fix missing NULL checks in CKE processing\n\nReviewed-by: Rich Salz <rsalz@openssl.org>",
    "before_after_code_files": [
      "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c"
    ]
  },
  "patch_diff": {
    "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
      "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "2258:         return 0;",
      "2259:     }",
      "2260:     ckey = ssl_generate_pkey(skey);",
      "2261:     dh_clnt = EVP_PKEY_get0_DH(ckey);",
      "2263:     if (dh_clnt == NULL || ssl_derive(s, ckey, skey) == 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2261:     if (ckey == NULL) {",
      "2262:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_DHE, ERR_R_INTERNAL_ERROR);",
      "2263:         return 0;",
      "2264:     }",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "2296:     }",
      "2298:     ckey = ssl_generate_pkey(skey);",
      "2300:     if (ssl_derive(s, ckey, skey) == 0) {",
      "2301:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_EVP_LIB);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "2304:     if (ckey == NULL) {",
      "2305:         SSLerr(SSL_F_TLS_CONSTRUCT_CKE_ECDHE, ERR_R_INTERNAL_ERROR);",
      "2306:         goto err;",
      "2307:     }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "98bdd4363bd657304d88fb4b64a684e26c66b774",
      "candidate_info": {
        "commit_hash": "98bdd4363bd657304d88fb4b64a684e26c66b774",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/98bdd4363bd657304d88fb4b64a684e26c66b774",
        "files": [
          "crypto/x509/t_x509.c"
        ],
        "message": "Add missing braces.\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\nGH: #2234\n(cherry picked from commit c4a60150914fc260c3fc2854e13372c870bdde76)",
        "before_after_code_files": [
          "crypto/x509/t_x509.c||crypto/x509/t_x509.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/x509/t_x509.c||crypto/x509/t_x509.c": [
          "File: crypto/x509/t_x509.c -> crypto/x509/t_x509.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "97:             if (bs->type == V_ASN1_NEG_INTEGER) {",
          "98:                 ul = 0 - (unsigned long)l;",
          "99:                 neg = \"-\";",
          "101:                 ul = l;",
          "102:                 neg = \"\";",
          "103:             if (BIO_printf(bp, \" %s%lu (%s0x%lx)\\n\", neg, ul, neg, ul) <= 0)",
          "104:                 goto err;",
          "105:         } else {",
          "",
          "[Removed Lines]",
          "100:             } else",
          "",
          "[Added Lines]",
          "100:             } else {",
          "103:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "91eaf079b7430cb4ebb7f3ccabe74aa383b27c4e",
      "candidate_info": {
        "commit_hash": "91eaf079b7430cb4ebb7f3ccabe74aa383b27c4e",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/91eaf079b7430cb4ebb7f3ccabe74aa383b27c4e",
        "files": [
          "CHANGES",
          "NEWS",
          "README",
          "include/openssl/opensslv.h"
        ],
        "message": "Prepare for 1.1.0c release\n\nReviewed-by: Richard Levitte <levitte@openssl.org>",
        "before_after_code_files": [
          "include/openssl/opensslv.h||include/openssl/opensslv.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "include/openssl/opensslv.h||include/openssl/opensslv.h": [
          "File: include/openssl/opensslv.h -> include/openssl/opensslv.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "43: # ifdef OPENSSL_FIPS",
          "45: # else",
          "47: # endif",
          "",
          "[Removed Lines]",
          "42: # define OPENSSL_VERSION_NUMBER  0x10100030L",
          "44: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0c-fips-dev  xx XXX xxxx\"",
          "46: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0c-dev  xx XXX xxxx\"",
          "",
          "[Added Lines]",
          "42: # define OPENSSL_VERSION_NUMBER  0x1010003fL",
          "44: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0c-fips  10 Nov 2016\"",
          "46: #  define OPENSSL_VERSION_TEXT    \"OpenSSL 1.1.0c  10 Nov 2016\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9ebcbbba81eba52282df9ad8902f047e2d501f51",
      "candidate_info": {
        "commit_hash": "9ebcbbba81eba52282df9ad8902f047e2d501f51",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/9ebcbbba81eba52282df9ad8902f047e2d501f51",
        "files": [
          "test/bntest.c"
        ],
        "message": "test/bntest.c: regression test for CVE-2016-7055.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit dca2e0ee1745ed2d9cba8c29f334f881a58f85dc)",
        "before_after_code_files": [
          "test/bntest.c||test/bntest.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/bntest.c||test/bntest.c": [
          "File: test/bntest.c -> test/bntest.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "836:             return 0;",
          "837:         }",
          "838:     }",
          "839:     BN_MONT_CTX_free(mont);",
          "840:     BN_free(a);",
          "841:     BN_free(b);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "841:     BN_hex2bn(&a,",
          "842:         \"7878787878787878787878787878787878787878787878787878787878787878\"",
          "843:         \"7878787878787878787878787878787878787878787878787878787878787878\"",
          "844:         \"7878787878787878787878787878787878787878787878787878787878787878\"",
          "845:         \"7878787878787878787878787878787878787878787878787878787878787878\");",
          "846:     BN_hex2bn(&b,",
          "847:         \"095D72C08C097BA488C5E439C655A192EAFB6380073D8C2664668EDDB4060744\"",
          "848:         \"E16E57FB4EDB9AE10A0CEFCDC28A894F689A128379DB279D48A2E20849D68593\"",
          "849:         \"9B7803BCF46CEBF5C533FB0DD35B080593DE5472E3FE5DB951B8BFF9B4CB8F03\"",
          "850:         \"9CC638A5EE8CDD703719F8000E6A9F63BEED5F2FCD52FF293EA05A251BB4AB81\");",
          "851:     BN_hex2bn(&n,",
          "852:         \"D78AF684E71DB0C39CFF4E64FB9DB567132CB9C50CC98009FEB820B26F2DED9B\"",
          "853:         \"91B9B5E2B83AE0AE4EB4E0523CA726BFBE969B89FD754F674CE99118C3F2D1C5\"",
          "854:         \"D81FDC7C54E02B60262B241D53C040E99E45826ECA37A804668E690E1AFC1CA4\"",
          "855:         \"2C9A15D84D4954425F0B7642FC0BD9D7B24E2618D2DCC9B729D944BADACFDDAF\");",
          "856:     BN_MONT_CTX_set(mont, n, ctx);",
          "857:     BN_mod_mul_montgomery(c, a, b, mont, ctx);",
          "858:     BN_mod_mul_montgomery(d, b, a, mont, ctx);",
          "859:     if (BN_cmp(c, d)) {",
          "860:         fprintf(stderr, \"Montgomery multiplication test failed:\"",
          "861:                         \" a*b != b*a.\\n\");",
          "862:         return 0;",
          "863:     }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "22e9f9211de80d7edcb1bd3b86eef7611718ab5c",
      "candidate_info": {
        "commit_hash": "22e9f9211de80d7edcb1bd3b86eef7611718ab5c",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/22e9f9211de80d7edcb1bd3b86eef7611718ab5c",
        "files": [
          "crypto/evp/evp_err.c",
          "crypto/evp/pmeth_fn.c",
          "include/openssl/evp.h"
        ],
        "message": "M_check_autoarg: sanity check the key\n\nFor now, checking that the size is non-zero will suffice.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/2120)\n(cherry picked from commit d7c8f142ea5953bf260b70a58739c1c9b0f038eb)",
        "before_after_code_files": [
          "crypto/evp/evp_err.c||crypto/evp/evp_err.c",
          "crypto/evp/pmeth_fn.c||crypto/evp/pmeth_fn.c",
          "include/openssl/evp.h||include/openssl/evp.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/evp/evp_err.c||crypto/evp/evp_err.c": [
          "File: crypto/evp/evp_err.c -> crypto/evp/evp_err.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "120:     {ERR_REASON(EVP_R_INPUT_NOT_INITIALIZED), \"input not initialized\"},",
          "121:     {ERR_REASON(EVP_R_INVALID_DIGEST), \"invalid digest\"},",
          "122:     {ERR_REASON(EVP_R_INVALID_FIPS_MODE), \"invalid fips mode\"},",
          "123:     {ERR_REASON(EVP_R_INVALID_KEY_LENGTH), \"invalid key length\"},",
          "124:     {ERR_REASON(EVP_R_INVALID_OPERATION), \"invalid operation\"},",
          "125:     {ERR_REASON(EVP_R_KEYGEN_FAILURE), \"keygen failure\"},",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "123:     {ERR_REASON(EVP_R_INVALID_KEY), \"invalid key\"},",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "135:     {ERR_REASON(EVP_R_OPERATION_NOT_SUPPORTED_FOR_THIS_KEYTYPE),",
          "136:      \"operation not supported for this keytype\"},",
          "137:     {ERR_REASON(EVP_R_OPERATON_NOT_INITIALIZED), \"operaton not initialized\"},",
          "139:     {ERR_REASON(EVP_R_PRIVATE_KEY_DECODE_ERROR), \"private key decode error\"},",
          "140:     {ERR_REASON(EVP_R_PRIVATE_KEY_ENCODE_ERROR), \"private key encode error\"},",
          "141:     {ERR_REASON(EVP_R_PUBLIC_KEY_NOT_RSA), \"public key not rsa\"},",
          "",
          "[Removed Lines]",
          "138:     {ERR_REASON(EVP_R_PARTIALLY_OVERLAPPING), \"partially overlapping buffers\"},",
          "",
          "[Added Lines]",
          "139:     {ERR_REASON(EVP_R_PARTIALLY_OVERLAPPING),",
          "140:      \"partially overlapping buffers\"},",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "143:     {ERR_REASON(EVP_R_UNKNOWN_DIGEST), \"unknown digest\"},",
          "144:     {ERR_REASON(EVP_R_UNKNOWN_OPTION), \"unknown option\"},",
          "145:     {ERR_REASON(EVP_R_UNKNOWN_PBE_ALGORITHM), \"unknown pbe algorithm\"},",
          "148:     {ERR_REASON(EVP_R_UNSUPPORTED_ALGORITHM), \"unsupported algorithm\"},",
          "149:     {ERR_REASON(EVP_R_UNSUPPORTED_CIPHER), \"unsupported cipher\"},",
          "150:     {ERR_REASON(EVP_R_UNSUPPORTED_KEYLENGTH), \"unsupported keylength\"},",
          "151:     {ERR_REASON(EVP_R_UNSUPPORTED_KEY_DERIVATION_FUNCTION),",
          "152:      \"unsupported key derivation function\"},",
          "153:     {ERR_REASON(EVP_R_UNSUPPORTED_KEY_SIZE), \"unsupported key size\"},",
          "154:     {ERR_REASON(EVP_R_UNSUPPORTED_PRF), \"unsupported prf\"},",
          "155:     {ERR_REASON(EVP_R_UNSUPPORTED_PRIVATE_KEY_ALGORITHM),",
          "156:      \"unsupported private key algorithm\"},",
          "",
          "[Removed Lines]",
          "146:     {ERR_REASON(EVP_R_UNSUPPORTED_NUMBER_OF_ROUNDS),",
          "147:      \"unsupported number of rounds\"},",
          "",
          "[Added Lines]",
          "154:     {ERR_REASON(EVP_R_UNSUPPORTED_NUMBER_OF_ROUNDS),",
          "155:      \"unsupported number of rounds\"},",
          "",
          "---------------"
        ],
        "crypto/evp/pmeth_fn.c||crypto/evp/pmeth_fn.c": [
          "File: crypto/evp/pmeth_fn.c -> crypto/evp/pmeth_fn.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "18:         if (ctx->pmeth->flags & EVP_PKEY_FLAG_AUTOARGLEN) \\",
          "19:                 { \\",
          "20:                 size_t pksize = (size_t)EVP_PKEY_size(ctx->pkey); \\",
          "22:                         { \\",
          "24:                         return 1; \\",
          "",
          "[Removed Lines]",
          "21:                 if (!arg) \\",
          "",
          "[Added Lines]",
          "21:                 if (pksize == 0) \\",
          "22:                         { \\",
          "23:                         EVPerr(err, EVP_R_INVALID_KEY); /*ckerr_ignore*/\\",
          "24:                         return 0; \\",
          "25:                         } \\",
          "26:                 else if (!arg)                 \\",
          "",
          "---------------"
        ],
        "include/openssl/evp.h||include/openssl/evp.h": [
          "File: include/openssl/evp.h -> include/openssl/evp.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "1546: # define EVP_R_INPUT_NOT_INITIALIZED                      111",
          "1547: # define EVP_R_INVALID_DIGEST                             152",
          "1548: # define EVP_R_INVALID_FIPS_MODE                          168",
          "1549: # define EVP_R_INVALID_KEY_LENGTH                         130",
          "1550: # define EVP_R_INVALID_OPERATION                          148",
          "1551: # define EVP_R_KEYGEN_FAILURE                             120",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1549: # define EVP_R_INVALID_KEY                                163",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1568: # define EVP_R_UNKNOWN_DIGEST                             161",
          "1569: # define EVP_R_UNKNOWN_OPTION                             169",
          "1570: # define EVP_R_UNKNOWN_PBE_ALGORITHM                      121",
          "1572: # define EVP_R_UNSUPPORTED_ALGORITHM                      156",
          "1573: # define EVP_R_UNSUPPORTED_CIPHER                         107",
          "1574: # define EVP_R_UNSUPPORTED_KEYLENGTH                      123",
          "1575: # define EVP_R_UNSUPPORTED_KEY_DERIVATION_FUNCTION        124",
          "1576: # define EVP_R_UNSUPPORTED_KEY_SIZE                       108",
          "1577: # define EVP_R_UNSUPPORTED_PRF                            125",
          "1578: # define EVP_R_UNSUPPORTED_PRIVATE_KEY_ALGORITHM          118",
          "1579: # define EVP_R_UNSUPPORTED_SALT_TYPE                      126",
          "",
          "[Removed Lines]",
          "1571: # define EVP_R_UNSUPPORTED_NUMBER_OF_ROUNDS               135",
          "",
          "[Added Lines]",
          "1577: # define EVP_R_UNSUPPORTED_NUMBER_OF_ROUNDS               135",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9fd47a037079f33ca3b71c32fb4a86397e0bfcd1",
      "candidate_info": {
        "commit_hash": "9fd47a037079f33ca3b71c32fb4a86397e0bfcd1",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/9fd47a037079f33ca3b71c32fb4a86397e0bfcd1",
        "files": [
          "apps/passwd.c"
        ],
        "message": "Fix 'openssl passwd' with arguments -1 or -apr1\n\nRT#4674\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(cherry picked from commit 9f9f962d96425ed741569460791eee0280fcf942)",
        "before_after_code_files": [
          "apps/passwd.c||apps/passwd.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/passwd.c||apps/passwd.c": [
          "File: apps/passwd.c -> apps/passwd.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "319:         || !EVP_DigestUpdate(md, magic, magic_len)",
          "320:         || !EVP_DigestUpdate(md, \"$\", 1)",
          "321:         || !EVP_DigestUpdate(md, salt_out, salt_len))",
          "323:     md2 = EVP_MD_CTX_new();",
          "324:     if (md2 == NULL",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "322:         goto err;",
          "",
          "---------------"
        ]
      }
    }
  ]
}