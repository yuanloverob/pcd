{
  "cve_id": "CVE-2017-12876",
  "cve_desc": "Heap-based buffer overflow in enhance.c in ImageMagick before 7.0.6-6 allows remote attackers to cause a denial of service via a crafted file.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "1cc6f0ccc92c20c7cab6c4a7335daf29c91f0d8e",
  "patch_info": {
    "commit_hash": "1cc6f0ccc92c20c7cab6c4a7335daf29c91f0d8e",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/1cc6f0ccc92c20c7cab6c4a7335daf29c91f0d8e",
    "files": [
      "MagickCore/enhance.c"
    ],
    "message": "https://github.com/ImageMagick/ImageMagick/issues/663 https://github.com/ImageMagick/ImageMagick/issues/655",
    "before_after_code_files": [
      "MagickCore/enhance.c||MagickCore/enhance.c"
    ]
  },
  "patch_diff": {
    "MagickCore/enhance.c||MagickCore/enhance.c": [
      "File: MagickCore/enhance.c -> MagickCore/enhance.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "45: #include \"MagickCore/accelerate-private.h\"",
      "46: #include \"MagickCore/artifact.h\"",
      "47: #include \"MagickCore/attribute.h\"",
      "48: #include \"MagickCore/cache.h\"",
      "49: #include \"MagickCore/cache-view.h\"",
      "50: #include \"MagickCore/channel.h\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "48: #include \"MagickCore/cache.h\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1048:   ssize_t",
      "1049:     y;",
      "1052:     Allocate histogram and stretch map.",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1530:     progress;",
      "1532:   register ssize_t",
      "1533:     i;",
      "1535:   ssize_t",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1536:     i;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "8622ecc7ccc278a5793d1e93823d7a05f1eea3c1",
      "candidate_info": {
        "commit_hash": "8622ecc7ccc278a5793d1e93823d7a05f1eea3c1",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/8622ecc7ccc278a5793d1e93823d7a05f1eea3c1",
        "files": [
          "MagickCore/cache.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/655",
        "before_after_code_files": [
          "MagickCore/cache.c||MagickCore/cache.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "MagickCore/cache.c||MagickCore/cache.c": [
          "File: MagickCore/cache.c -> MagickCore/cache.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "420:   const CacheInfo",
          "434:     MagickPathExtent);",
          "436:   clone_info->colorspace=cache_info->colorspace;",
          "437:   clone_info->alpha_trait=cache_info->alpha_trait;",
          "438:   clone_info->read_mask=cache_info->read_mask;",
          "439:   clone_info->write_mask=cache_info->write_mask;",
          "",
          "[Removed Lines]",
          "423:   assert(cache != NULL);",
          "424:   cache_info=(const CacheInfo *) cache;",
          "425:   assert(cache_info->signature == MagickCoreSignature);",
          "426:   if (cache_info->debug != MagickFalse)",
          "427:     (void) LogMagickEvent(TraceEvent,GetMagickModule(),\"%s\",",
          "428:       cache_info->filename);",
          "429:   clone_info=(CacheInfo *) AcquirePixelCache(cache_info->number_threads);",
          "430:   if (clone_info == (Cache) NULL)",
          "431:     return((Cache) NULL);",
          "432:   clone_info->file=(-1);",
          "433:   (void) CopyMagickString(clone_info->filename,cache_info->filename,",
          "435:   clone_info->storage_class=cache_info->storage_class;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3875: %",
          "3876: %    o offset: the offset in the persistent cache to store pixels.",
          "3877: %",
          "3879: %",
          "3881: MagickExport MagickBooleanType PersistPixelCache(Image *image,",
          "",
          "[Removed Lines]",
          "3878: %    o exception: return any errors or warnings in this structure.",
          "",
          "[Added Lines]",
          "3864: %    o exception: return any errors or warnings in this structure.",
          "3865: %",
          "3867: MagickExport MagickBooleanType PersistPixelCache(Image *image,",
          "3868:   const char *filename,const MagickBooleanType attach,MagickOffsetType *offset,",
          "3869:   ExceptionInfo *exception)",
          "3870: {",
          "3871:   CacheInfo",
          "3875:   MagickBooleanType",
          "3876:     status;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "03e8b3089e4631d080ba9c09205908b53eafbcb4",
      "candidate_info": {
        "commit_hash": "03e8b3089e4631d080ba9c09205908b53eafbcb4",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/03e8b3089e4631d080ba9c09205908b53eafbcb4",
        "files": [
          "MagickCore/cache.c"
        ],
        "message": "https://github.com/ImageMagick/ImageMagick/issues/655",
        "before_after_code_files": [
          "MagickCore/cache.c||MagickCore/cache.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_issue": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "MagickCore/cache.c||MagickCore/cache.c": [
          "File: MagickCore/cache.c -> MagickCore/cache.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "3861: %",
          "3862: %    o offset: the offset in the persistent cache to store pixels.",
          "3863: %",
          "3864: %    o exception: return any errors or warnings in this structure.",
          "3867: MagickExport MagickBooleanType PersistPixelCache(Image *image,",
          "3868:   const char *filename,const MagickBooleanType attach,MagickOffsetType *offset,",
          "3869:   ExceptionInfo *exception)",
          "",
          "[Removed Lines]",
          "3865: %",
          "",
          "[Added Lines]",
          "3864: %    o exception: return any errors or warnings in this structure.",
          "3865: %",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "3875:   MagickBooleanType",
          "3878:   ssize_t",
          "3879:     page_size;",
          "3882:   assert(image->signature == MagickCoreSignature);",
          "3883:   if (image->debug != MagickFalse)",
          "3884:     (void) LogMagickEvent(TraceEvent,GetMagickModule(),\"%s\",image->filename);",
          "",
          "[Removed Lines]",
          "3876:     status;",
          "3881:   assert(image != (Image *) NULL);",
          "",
          "[Added Lines]",
          "3876:     status;",
          "",
          "---------------"
        ]
      }
    }
  ]
}