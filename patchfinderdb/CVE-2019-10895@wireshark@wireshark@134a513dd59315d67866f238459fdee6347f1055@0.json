{
  "cve_id": "CVE-2019-10895",
  "cve_desc": "In Wireshark 2.4.0 to 2.4.13, 2.6.0 to 2.6.7, and 3.0.0, the NetScaler file parser could crash. This was addressed in wiretap/netscaler.c by improving data validation.",
  "repo": "wireshark/wireshark",
  "patch_hash": "134a513dd59315d67866f238459fdee6347f1055",
  "patch_info": {
    "commit_hash": "134a513dd59315d67866f238459fdee6347f1055",
    "repo": "wireshark/wireshark",
    "commit_url": "https://github.com/wireshark/wireshark/commit/134a513dd59315d67866f238459fdee6347f1055",
    "files": [
      "wiretap/netscaler.c"
    ],
    "message": "netscaler: add more sanity checks.\n\nFix more crashes found in the provided bug report.\n\nBug: 15497\nChange-Id: If84498fa879ad56c8677f8c1442a8dc0e5906003\nReviewed-on: https://code.wireshark.org/review/32333\nPetri-Dish: Dario Lombardo <lomato@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>",
    "before_after_code_files": [
      "wiretap/netscaler.c||wiretap/netscaler.c"
    ]
  },
  "patch_diff": {
    "wiretap/netscaler.c||wiretap/netscaler.c": [
      "File: wiretap/netscaler.c -> wiretap/netscaler.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "928:                 switch (nspr_getv##ver##recordtype(fp))\\",
      "929:                 {\\",
      "930:                     case NSPR_ABSTIME_V##ver:\\",
      "931:                         ns_setabstime(nstrace, pletoh32(&((nspr_abstime_v##ver##_t *) fp)->abs_Time), pletoh16(&((nspr_abstime_v##ver##_t *) fp)->abs_RelTime));\\",
      "932:                         nstrace->nstrace_buf_offset = nstrace_buf_offset + nspr_getv##ver##recordsize(fp);\\",
      "933:                         nstrace->nstrace_buflen = nstrace_buflen;\\",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "931:                         if (!nstrace_ensure_buflen(nstrace, nstrace_buf_offset, sizeof(nspr_abstime_v##ver##_t), err, err_info))\\",
      "932:                             return FALSE;\\",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1321:                 case NSPR_RELTIME_V20:",
      "1322:                 {",
      "1323:                     nspr_pktracefull_v20_t *fp20 = (nspr_pktracefull_v20_t *) &nstrace_buf[nstrace_buf_offset];",
      "1324:                     if (nspr_getv20recordsize((nspr_hd_v20_t *)fp20) == 0) {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1325:                     if (!nstrace_ensure_buflen(nstrace, nstrace_buf_offset, sizeof(nspr_hd_v20_t), err, err_info))",
      "1326:                         return FALSE;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3ced6f5b05094edd1989f7787a7c267cdfec9a45",
      "candidate_info": {
        "commit_hash": "3ced6f5b05094edd1989f7787a7c267cdfec9a45",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/3ced6f5b05094edd1989f7787a7c267cdfec9a45",
        "files": [
          "wiretap/netscaler.c"
        ],
        "message": "netscaler: add more sanity checks.\n\nFix more crashes found in the provided bug report.\n\nBug: 15497\nChange-Id: If84498fa879ad56c8677f8c1442a8dc0e5906003\nReviewed-on: https://code.wireshark.org/review/32333\nPetri-Dish: Dario Lombardo <lomato@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>\n(cherry picked from commit 134a513dd59315d67866f238459fdee6347f1055)\nReviewed-on: https://code.wireshark.org/review/32421",
        "before_after_code_files": [
          "wiretap/netscaler.c||wiretap/netscaler.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "wiretap/netscaler.c||wiretap/netscaler.c"
          ],
          "candidate": [
            "wiretap/netscaler.c||wiretap/netscaler.c"
          ]
        }
      },
      "candidate_diff": {
        "wiretap/netscaler.c||wiretap/netscaler.c": [
          "File: wiretap/netscaler.c -> wiretap/netscaler.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "928:                 switch (nspr_getv##ver##recordtype(fp))\\",
          "929:                 {\\",
          "930:                     case NSPR_ABSTIME_V##ver:\\",
          "931:                         ns_setabstime(nstrace, pletoh32(&((nspr_abstime_v##ver##_t *) fp)->abs_Time), pletoh16(&((nspr_abstime_v##ver##_t *) fp)->abs_RelTime));\\",
          "932:                         nstrace->nstrace_buf_offset = nstrace_buf_offset + nspr_getv##ver##recordsize(fp);\\",
          "933:                         nstrace->nstrace_buflen = nstrace_buflen;\\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "931:                         if (!nstrace_ensure_buflen(nstrace, nstrace_buf_offset, sizeof(nspr_abstime_v##ver##_t), err, err_info))\\",
          "932:                             return FALSE;\\",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1321:                 case NSPR_RELTIME_V20:",
          "1322:                 {",
          "1323:                     nspr_pktracefull_v20_t *fp20 = (nspr_pktracefull_v20_t *) &nstrace_buf[nstrace_buf_offset];",
          "1324:                     if (nspr_getv20recordsize((nspr_hd_v20_t *)fp20) == 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1325:                     if (!nstrace_ensure_buflen(nstrace, nstrace_buf_offset, sizeof(nspr_hd_v20_t), err, err_info))",
          "1326:                         return FALSE;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fc8367a50516e832be960a9001ccdb09ced9b27f",
      "candidate_info": {
        "commit_hash": "fc8367a50516e832be960a9001ccdb09ced9b27f",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/fc8367a50516e832be960a9001ccdb09ced9b27f",
        "files": [
          "wiretap/netscaler.c"
        ],
        "message": "netscaler: add more sanity checks.\n\nFix more crashes found in the provided bug report.\n\nBug: 15497\nChange-Id: If84498fa879ad56c8677f8c1442a8dc0e5906003\nReviewed-on: https://code.wireshark.org/review/32333\nPetri-Dish: Dario Lombardo <lomato@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>\n(cherry picked from commit 134a513dd59315d67866f238459fdee6347f1055)\nReviewed-on: https://code.wireshark.org/review/32422",
        "before_after_code_files": [
          "wiretap/netscaler.c||wiretap/netscaler.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "wiretap/netscaler.c||wiretap/netscaler.c"
          ],
          "candidate": [
            "wiretap/netscaler.c||wiretap/netscaler.c"
          ]
        }
      },
      "candidate_diff": {
        "wiretap/netscaler.c||wiretap/netscaler.c": [
          "File: wiretap/netscaler.c -> wiretap/netscaler.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "928:                 switch (nspr_getv##ver##recordtype(fp))\\",
          "929:                 {\\",
          "930:                     case NSPR_ABSTIME_V##ver:\\",
          "931:                         ns_setabstime(nstrace, pletoh32(&((nspr_abstime_v##ver##_t *) fp)->abs_Time), pletoh16(&((nspr_abstime_v##ver##_t *) fp)->abs_RelTime));\\",
          "932:                         nstrace->nstrace_buf_offset = nstrace_buf_offset + nspr_getv##ver##recordsize(fp);\\",
          "933:                         nstrace->nstrace_buflen = nstrace_buflen;\\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "931:                         if (!nstrace_ensure_buflen(nstrace, nstrace_buf_offset, sizeof(nspr_abstime_v##ver##_t), err, err_info))\\",
          "932:                             return FALSE;\\",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1321:                 case NSPR_RELTIME_V20:",
          "1322:                 {",
          "1323:                     nspr_pktracefull_v20_t *fp20 = (nspr_pktracefull_v20_t *) &nstrace_buf[nstrace_buf_offset];",
          "1324:                     if (nspr_getv20recordsize((nspr_hd_v20_t *)fp20) == 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1325:                     if (!nstrace_ensure_buflen(nstrace, nstrace_buf_offset, sizeof(nspr_hd_v20_t), err, err_info))",
          "1326:                         return FALSE;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "2fbbde780e5d5d82e31dca656217daf278cf62bb",
      "candidate_info": {
        "commit_hash": "2fbbde780e5d5d82e31dca656217daf278cf62bb",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/2fbbde780e5d5d82e31dca656217daf278cf62bb",
        "files": [
          "wiretap/netscaler.c"
        ],
        "message": "netscaler: add more sanity checks.\n\nFix more crashes found in the provided bug report.\n\nBug: 15497\nChange-Id: If84498fa879ad56c8677f8c1442a8dc0e5906003\nReviewed-on: https://code.wireshark.org/review/32333\nPetri-Dish: Dario Lombardo <lomato@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>\n(cherry picked from commit 134a513dd59315d67866f238459fdee6347f1055)\nReviewed-on: https://code.wireshark.org/review/32422\n(cherry picked from commit fc8367a50516e832be960a9001ccdb09ced9b27f)\nReviewed-on: https://code.wireshark.org/review/32430\nReviewed-by: Guy Harris <guy@alum.mit.edu>",
        "before_after_code_files": [
          "wiretap/netscaler.c||wiretap/netscaler.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "wiretap/netscaler.c||wiretap/netscaler.c"
          ],
          "candidate": [
            "wiretap/netscaler.c||wiretap/netscaler.c"
          ]
        }
      },
      "candidate_diff": {
        "wiretap/netscaler.c||wiretap/netscaler.c": [
          "File: wiretap/netscaler.c -> wiretap/netscaler.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "940:                 switch (nspr_getv##ver##recordtype(fp))\\",
          "941:                 {\\",
          "942:                     case NSPR_ABSTIME_V##ver:\\",
          "943:                         ns_setabstime(nstrace, pletoh32(&((nspr_abstime_v##ver##_t *) fp)->abs_Time), pletoh16(&((nspr_abstime_v##ver##_t *) fp)->abs_RelTime));\\",
          "944:                         nstrace->nstrace_buf_offset = nstrace_buf_offset + nspr_getv##ver##recordsize(fp);\\",
          "945:                         nstrace->nstrace_buflen = nstrace_buflen;\\",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "943:                         if (!nstrace_ensure_buflen(nstrace, nstrace_buf_offset, sizeof(nspr_abstime_v##ver##_t), err, err_info))\\",
          "944:                             return FALSE;\\",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1331:                 case NSPR_RELTIME_V20:",
          "1332:                 {",
          "1333:                     nspr_pktracefull_v20_t *fp20 = (nspr_pktracefull_v20_t *) &nstrace_buf[nstrace_buf_offset];",
          "1334:                     if (nspr_getv20recordsize((nspr_hd_v20_t *)fp20) == 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1335:                     if (!nstrace_ensure_buflen(nstrace, nstrace_buf_offset, sizeof(nspr_hd_v20_t), err, err_info))",
          "1336:                         return FALSE;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e38fea4dbaac2c4966f80c721b2d64c91ff451c6",
      "candidate_info": {
        "commit_hash": "e38fea4dbaac2c4966f80c721b2d64c91ff451c6",
        "repo": "wireshark/wireshark",
        "commit_url": "https://github.com/wireshark/wireshark/commit/e38fea4dbaac2c4966f80c721b2d64c91ff451c6",
        "files": [
          "wiretap/netscaler.c"
        ],
        "message": "netscaler: fix nstrace_ensure_buflen call.\n\nThe call must ensure enough bytes are in the buffer for subsequent\ncasts. Next cast is for nspr_pktracefull_v20_t.\n\nChange-Id: I8b77aa243f528f82786af1047e8d26100f306a07\nReviewed-on: https://code.wireshark.org/review/35837\nReviewed-by: Dario Lombardo <lomato@gmail.com>\nPetri-Dish: Dario Lombardo <lomato@gmail.com>\nTested-by: Petri Dish Buildbot\nReviewed-by: Anders Broman <a.broman58@gmail.com>",
        "before_after_code_files": [
          "wiretap/netscaler.c||wiretap/netscaler.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "wiretap/netscaler.c||wiretap/netscaler.c"
          ],
          "candidate": [
            "wiretap/netscaler.c||wiretap/netscaler.c"
          ]
        }
      },
      "candidate_diff": {
        "wiretap/netscaler.c||wiretap/netscaler.c": [
          "File: wiretap/netscaler.c -> wiretap/netscaler.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1380:                 case NSPR_RELTIME_V20:",
          "1381:                 {",
          "1383:                         return FALSE;",
          "1384:                     nspr_pktracefull_v20_t *fp20 = (nspr_pktracefull_v20_t *) &nstrace_buf[nstrace_buf_offset];",
          "1385:                     if (nspr_getv20recordsize((nspr_hd_v20_t *)fp20) == 0) {",
          "",
          "[Removed Lines]",
          "1382:                     if (!nstrace_ensure_buflen(nstrace, nstrace_buf_offset, sizeof(nspr_hd_v20_t), err, err_info))",
          "",
          "[Added Lines]",
          "1382:                     if (!nstrace_ensure_buflen(nstrace, nstrace_buf_offset, sizeof(nspr_pktracefull_v20_t), err, err_info))",
          "",
          "---------------"
        ]
      }
    }
  ]
}