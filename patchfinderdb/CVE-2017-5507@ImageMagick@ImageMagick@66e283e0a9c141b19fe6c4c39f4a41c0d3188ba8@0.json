{
  "cve_id": "CVE-2017-5507",
  "cve_desc": "Memory leak in coders/mpc.c in ImageMagick before 6.9.7-4 and 7.x before 7.0.4-4 allows remote attackers to cause a denial of service (memory consumption) via vectors involving a pixel cache.",
  "repo": "ImageMagick/ImageMagick",
  "patch_hash": "66e283e0a9c141b19fe6c4c39f4a41c0d3188ba8",
  "patch_info": {
    "commit_hash": "66e283e0a9c141b19fe6c4c39f4a41c0d3188ba8",
    "repo": "ImageMagick/ImageMagick",
    "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/66e283e0a9c141b19fe6c4c39f4a41c0d3188ba8",
    "files": [
      "ChangeLog",
      "coders/mpc.c"
    ],
    "message": "...",
    "before_after_code_files": [
      "coders/mpc.c||coders/mpc.c"
    ]
  },
  "patch_diff": {
    "coders/mpc.c||coders/mpc.c": [
      "File: coders/mpc.c -> coders/mpc.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "66: #include \"MagickCore/option.h\"",
      "67: #include \"MagickCore/profile.h\"",
      "68: #include \"MagickCore/property.h\"",
      "69: #include \"MagickCore/quantum-private.h\"",
      "70: #include \"MagickCore/static.h\"",
      "71: #include \"MagickCore/statistic.h\"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "69: #include \"MagickCore/quantum-private.h\"",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "834:       }",
      "835:     depth=GetImageQuantumDepth(image,MagickFalse);",
      "836:     if (image->storage_class == PseudoClass)",
      "839:           Create image colormap.",
      "",
      "[Removed Lines]",
      "837:       {",
      "",
      "[Added Lines]",
      "838:       {",
      "840:           Create image colormap.",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "923:         ThrowFileException(exception,CorruptImageError,\"UnexpectedEndOfFile\",",
      "924:           image->filename);",
      "925:         break;",
      "929:         break;",
      "930:     status=SetImageExtent(image,image->columns,image->rows,exception);",
      "931:     if (status == MagickFalse)",
      "",
      "[Removed Lines]",
      "926:       }",
      "927:     if ((image_info->ping != MagickFalse) && (image_info->number_scenes != 0))",
      "928:       if (image->scene >= (image_info->scene+image_info->number_scenes-1))",
      "",
      "[Added Lines]",
      "929:       }",
      "930:     if ((image_info->ping != MagickFalse) && (image_info->number_scenes != 0))",
      "931:       if (image->scene >= (image_info->scene+image_info->number_scenes-1))",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "862ac224977be815f51cae441393b142914d65e6",
      "candidate_info": {
        "commit_hash": "862ac224977be815f51cae441393b142914d65e6",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/862ac224977be815f51cae441393b142914d65e6",
        "files": [
          "coders/mpc.c"
        ],
        "message": "...",
        "before_after_code_files": [
          "coders/mpc.c||coders/mpc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/mpc.c||coders/mpc.c"
          ],
          "candidate": [
            "coders/mpc.c||coders/mpc.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/mpc.c||coders/mpc.c": [
          "File: coders/mpc.c -> coders/mpc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "66: #include \"MagickCore/option.h\"",
          "67: #include \"MagickCore/profile.h\"",
          "68: #include \"MagickCore/property.h\"",
          "70: #include \"MagickCore/resource.h\"",
          "71: #include \"MagickCore/static.h\"",
          "72: #include \"MagickCore/statistic.h\"",
          "",
          "[Removed Lines]",
          "69: #include \"MagickCore/quantum-private.h\"",
          "",
          "[Added Lines]",
          "69: #include \"MagickCore/quantum-private.h\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ad7765b78e19ab75f509de8e6effce25c362a750",
      "candidate_info": {
        "commit_hash": "ad7765b78e19ab75f509de8e6effce25c362a750",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/ad7765b78e19ab75f509de8e6effce25c362a750",
        "files": [
          "MagickCore/colormap.c",
          "coders/mpc.c"
        ],
        "message": "https://www.imagemagick.org/discourse-server/viewtopic.php?f=3&t=31438",
        "before_after_code_files": [
          "MagickCore/colormap.c||MagickCore/colormap.c",
          "coders/mpc.c||coders/mpc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/mpc.c||coders/mpc.c"
          ],
          "candidate": [
            "coders/mpc.c||coders/mpc.c"
          ]
        }
      },
      "candidate_diff": {
        "MagickCore/colormap.c||MagickCore/colormap.c": [
          "File: MagickCore/colormap.c -> MagickCore/colormap.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "128:       image->colors=0;",
          "129:       image->storage_class=DirectClass;",
          "130:       ThrowBinaryException(ResourceLimitError,\"MemoryAllocationFailed\",",
          "131:         image->filename);",
          "132:     }",
          "133:   for (i=0; i < (ssize_t) image->colors; i++)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "131:         image->filename);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "141:     image->colormap[i].red=pixel;",
          "142:     image->colormap[i].green=pixel;",
          "143:     image->colormap[i].blue=pixel;",
          "145:   }",
          "146:   return(SetImageStorageClass(image,PseudoClass,exception));",
          "147: }",
          "",
          "[Removed Lines]",
          "144:     image->colormap[i].alpha=OpaqueAlpha;",
          "",
          "[Added Lines]",
          "145:     image->colormap[i].alpha=OpaqueAlpha;",
          "",
          "---------------"
        ],
        "coders/mpc.c||coders/mpc.c": [
          "File: coders/mpc.c -> coders/mpc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "850:       }",
          "851:     depth=GetImageQuantumDepth(image,MagickFalse);",
          "852:     if (image->storage_class == PseudoClass)",
          "857:         image->colormap=(PixelInfo *) AcquireQuantumMemory(image->colors+1,",
          "858:           sizeof(*image->colormap));",
          "",
          "[Removed Lines]",
          "853:       {",
          "855:           Create image colormap.",
          "",
          "[Added Lines]",
          "853:       {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f1eb973c0b7a320562504e6525a20045c4e33dde",
      "candidate_info": {
        "commit_hash": "f1eb973c0b7a320562504e6525a20045c4e33dde",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/f1eb973c0b7a320562504e6525a20045c4e33dde",
        "files": [
          "coders/mpc.c"
        ],
        "message": "...",
        "before_after_code_files": [
          "coders/mpc.c||coders/mpc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/mpc.c||coders/mpc.c"
          ],
          "candidate": [
            "coders/mpc.c||coders/mpc.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/mpc.c||coders/mpc.c": [
          "File: coders/mpc.c -> coders/mpc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "850:       }",
          "851:     depth=GetImageQuantumDepth(image,MagickFalse);",
          "852:     if (image->storage_class == PseudoClass)",
          "855:           Create image colormap.",
          "",
          "[Removed Lines]",
          "853:       {",
          "",
          "[Added Lines]",
          "853:       {",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8f3f88e52f84f7dcca902a8a56b3f3e841c86e68",
      "candidate_info": {
        "commit_hash": "8f3f88e52f84f7dcca902a8a56b3f3e841c86e68",
        "repo": "ImageMagick/ImageMagick",
        "commit_url": "https://github.com/ImageMagick/ImageMagick/commit/8f3f88e52f84f7dcca902a8a56b3f3e841c86e68",
        "files": [
          "coders/mpc.c"
        ],
        "message": "...",
        "before_after_code_files": [
          "coders/mpc.c||coders/mpc.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "coders/mpc.c||coders/mpc.c"
          ],
          "candidate": [
            "coders/mpc.c||coders/mpc.c"
          ]
        }
      },
      "candidate_diff": {
        "coders/mpc.c||coders/mpc.c": [
          "File: coders/mpc.c -> coders/mpc.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "850:       }",
          "851:     depth=GetImageQuantumDepth(image,MagickFalse);",
          "852:     if (image->storage_class == PseudoClass)",
          "855:           Create image colormap.",
          "",
          "[Removed Lines]",
          "853:       {",
          "",
          "[Added Lines]",
          "853:       {",
          "855:           Create image colormap.",
          "",
          "---------------"
        ]
      }
    }
  ]
}