{
  "cve_id": "CVE-2015-8363",
  "cve_desc": "The jpeg2000_read_main_headers function in libavcodec/jpeg2000dec.c in FFmpeg before 2.6.5, 2.7.x before 2.7.3, and 2.8.x through 2.8.2 does not enforce uniqueness of the SIZ marker in a JPEG 2000 image, which allows remote attackers to cause a denial of service (out-of-bounds heap-memory access) or possibly have unspecified other impact via a crafted image with two or more of these markers.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "44a7f17d0b20e6f8d836b2957e3e357b639f19a2",
  "patch_info": {
    "commit_hash": "44a7f17d0b20e6f8d836b2957e3e357b639f19a2",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/44a7f17d0b20e6f8d836b2957e3e357b639f19a2",
    "files": [
      "libavcodec/jpeg2000dec.c"
    ],
    "message": "avcodec/jpeg2000dec: Check for duplicate SIZ marker\n\nFixes: 0231a17345734228011c6f35a64e4594/asan_heap-oob_1d92a72_3218_1213809a9e3affec77e4c191fdfdc0a9.mov\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
    "before_after_code_files": [
      "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
    ]
  },
  "patch_diff": {
    "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
      "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1797:     memset(s->properties, 0, sizeof(s->properties));",
      "1798:     memset(&s->poc  , 0, sizeof(s->poc));",
      "1799:     s->numXtiles = s->numYtiles = 0;",
      "1800: }",
      "1802: static int jpeg2000_read_main_headers(Jpeg2000DecoderContext *s)",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1800:     s->ncomponents = 0;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "1855:         switch (marker) {",
      "1856:         case JPEG2000_SIZ:",
      "1857:             ret = get_siz(s);",
      "1858:             if (!s->tile)",
      "1859:                 s->numXtiles = s->numYtiles = 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1858:             if (s->ncomponents) {",
      "1859:                 av_log(s->avctx, AV_LOG_ERROR, \"Duplicate SIZ\\n\");",
      "1860:                 return AVERROR_INVALIDDATA;",
      "1861:             }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "53869b687c4ec13aa534a147fb3a3648fe72b191",
      "candidate_info": {
        "commit_hash": "53869b687c4ec13aa534a147fb3a3648fe72b191",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/53869b687c4ec13aa534a147fb3a3648fe72b191",
        "files": [
          "libavcodec/jpeg2000dec.c"
        ],
        "message": "avcodec/jpeg2000dec: Check for duplicate SIZ marker\n\nFixes: 0231a17345734228011c6f35a64e4594/asan_heap-oob_1d92a72_3218_1213809a9e3affec77e4c191fdfdc0a9.mov\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 44a7f17d0b20e6f8d836b2957e3e357b639f19a2)\n\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ],
          "candidate": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
          "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1356:     memset(s->codsty, 0, sizeof(s->codsty));",
          "1357:     memset(s->qntsty, 0, sizeof(s->qntsty));",
          "1358:     s->numXtiles = s->numYtiles = 0;",
          "1359: }",
          "1361: static int jpeg2000_read_main_headers(Jpeg2000DecoderContext *s)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1359:     s->ncomponents = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1411:         switch (marker) {",
          "1412:         case JPEG2000_SIZ:",
          "1413:             ret = get_siz(s);",
          "1414:             if (!s->tile)",
          "1415:                 s->numXtiles = s->numYtiles = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1414:             if (s->ncomponents) {",
          "1415:                 av_log(s->avctx, AV_LOG_ERROR, \"Duplicate SIZ\\n\");",
          "1416:                 return AVERROR_INVALIDDATA;",
          "1417:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "be4b41b6cb7cd3c962cfcde6305d5e7537645bf2",
      "candidate_info": {
        "commit_hash": "be4b41b6cb7cd3c962cfcde6305d5e7537645bf2",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/be4b41b6cb7cd3c962cfcde6305d5e7537645bf2",
        "files": [
          "libavcodec/jpeg2000dec.c"
        ],
        "message": "avcodec/jpeg2000dec: Check for duplicate SIZ marker\n\nFixes: 0231a17345734228011c6f35a64e4594/asan_heap-oob_1d92a72_3218_1213809a9e3affec77e4c191fdfdc0a9.mov\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 44a7f17d0b20e6f8d836b2957e3e357b639f19a2)\n\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ],
          "candidate": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
          "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1356:     memset(s->codsty, 0, sizeof(s->codsty));",
          "1357:     memset(s->qntsty, 0, sizeof(s->qntsty));",
          "1358:     s->numXtiles = s->numYtiles = 0;",
          "1359: }",
          "1361: static int jpeg2000_read_main_headers(Jpeg2000DecoderContext *s)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1359:     s->ncomponents = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1411:         switch (marker) {",
          "1412:         case JPEG2000_SIZ:",
          "1413:             ret = get_siz(s);",
          "1414:             if (!s->tile)",
          "1415:                 s->numXtiles = s->numYtiles = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1414:             if (s->ncomponents) {",
          "1415:                 av_log(s->avctx, AV_LOG_ERROR, \"Duplicate SIZ\\n\");",
          "1416:                 return AVERROR_INVALIDDATA;",
          "1417:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ac302efb9151addfc9d45495d56592ba6fd384b2",
      "candidate_info": {
        "commit_hash": "ac302efb9151addfc9d45495d56592ba6fd384b2",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/ac302efb9151addfc9d45495d56592ba6fd384b2",
        "files": [
          "libavcodec/jpeg2000dec.c"
        ],
        "message": "avcodec/jpeg2000dec: Check for duplicate SIZ marker\n\nFixes: 0231a17345734228011c6f35a64e4594/asan_heap-oob_1d92a72_3218_1213809a9e3affec77e4c191fdfdc0a9.mov\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 44a7f17d0b20e6f8d836b2957e3e357b639f19a2)\n\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ],
          "candidate": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
          "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1403:     memset(s->codsty, 0, sizeof(s->codsty));",
          "1404:     memset(s->qntsty, 0, sizeof(s->qntsty));",
          "1405:     s->numXtiles = s->numYtiles = 0;",
          "1406: }",
          "1408: static int jpeg2000_read_main_headers(Jpeg2000DecoderContext *s)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1406:     s->ncomponents = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1458:         switch (marker) {",
          "1459:         case JPEG2000_SIZ:",
          "1460:             ret = get_siz(s);",
          "1461:             if (!s->tile)",
          "1462:                 s->numXtiles = s->numYtiles = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1461:             if (s->ncomponents) {",
          "1462:                 av_log(s->avctx, AV_LOG_ERROR, \"Duplicate SIZ\\n\");",
          "1463:                 return AVERROR_INVALIDDATA;",
          "1464:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dbfec68d323cd1497a291c6dcf12be7828c74636",
      "candidate_info": {
        "commit_hash": "dbfec68d323cd1497a291c6dcf12be7828c74636",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/dbfec68d323cd1497a291c6dcf12be7828c74636",
        "files": [
          "libavcodec/jpeg2000dec.c"
        ],
        "message": "avcodec/jpeg2000dec: Check for duplicate SIZ marker\n\nFixes: 0231a17345734228011c6f35a64e4594/asan_heap-oob_1d92a72_3218_1213809a9e3affec77e4c191fdfdc0a9.mov\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 44a7f17d0b20e6f8d836b2957e3e357b639f19a2)\n\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ],
          "candidate": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
          "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1817:     memset(s->properties, 0, sizeof(s->properties));",
          "1818:     memset(&s->poc  , 0, sizeof(s->poc));",
          "1819:     s->numXtiles = s->numYtiles = 0;",
          "1820: }",
          "1822: static int jpeg2000_read_main_headers(Jpeg2000DecoderContext *s)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1820:     s->ncomponents = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1875:         switch (marker) {",
          "1876:         case JPEG2000_SIZ:",
          "1877:             ret = get_siz(s);",
          "1878:             if (!s->tile)",
          "1879:                 s->numXtiles = s->numYtiles = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1878:             if (s->ncomponents) {",
          "1879:                 av_log(s->avctx, AV_LOG_ERROR, \"Duplicate SIZ\\n\");",
          "1880:                 return AVERROR_INVALIDDATA;",
          "1881:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3300005351e7153caa4e59f960bb2b9a18f877b3",
      "candidate_info": {
        "commit_hash": "3300005351e7153caa4e59f960bb2b9a18f877b3",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/3300005351e7153caa4e59f960bb2b9a18f877b3",
        "files": [
          "libavcodec/jpeg2000dec.c"
        ],
        "message": "avcodec/jpeg2000dec: Check for duplicate SIZ marker\n\nFixes: 0231a17345734228011c6f35a64e4594/asan_heap-oob_1d92a72_3218_1213809a9e3affec77e4c191fdfdc0a9.mov\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>\n(cherry picked from commit 44a7f17d0b20e6f8d836b2957e3e357b639f19a2)\n\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "before_after_code_files": [
          "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ],
          "candidate": [
            "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/jpeg2000dec.c||libavcodec/jpeg2000dec.c": [
          "File: libavcodec/jpeg2000dec.c -> libavcodec/jpeg2000dec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1400:     memset(s->codsty, 0, sizeof(s->codsty));",
          "1401:     memset(s->qntsty, 0, sizeof(s->qntsty));",
          "1402:     s->numXtiles = s->numYtiles = 0;",
          "1403: }",
          "1405: static int jpeg2000_read_main_headers(Jpeg2000DecoderContext *s)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1403:     s->ncomponents = 0;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1455:         switch (marker) {",
          "1456:         case JPEG2000_SIZ:",
          "1457:             ret = get_siz(s);",
          "1458:             if (!s->tile)",
          "1459:                 s->numXtiles = s->numYtiles = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1458:             if (s->ncomponents) {",
          "1459:                 av_log(s->avctx, AV_LOG_ERROR, \"Duplicate SIZ\\n\");",
          "1460:                 return AVERROR_INVALIDDATA;",
          "1461:             }",
          "",
          "---------------"
        ]
      }
    }
  ]
}