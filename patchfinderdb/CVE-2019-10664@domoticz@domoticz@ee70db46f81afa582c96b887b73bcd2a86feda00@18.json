{
  "cve_id": "CVE-2019-10664",
  "cve_desc": "Domoticz before 4.10578 allows SQL Injection via the idx parameter in CWebServer::GetFloorplanImage in WebServer.cpp.",
  "repo": "domoticz/domoticz",
  "patch_hash": "ee70db46f81afa582c96b887b73bcd2a86feda00",
  "patch_info": {
    "commit_hash": "ee70db46f81afa582c96b887b73bcd2a86feda00",
    "repo": "domoticz/domoticz",
    "commit_url": "https://github.com/domoticz/domoticz/commit/ee70db46f81afa582c96b887b73bcd2a86feda00",
    "files": [
      "main/WebServer.cpp"
    ],
    "message": "Fixed possible SQL Injection Vulnerability (Thanks to Fabio Carretto!)",
    "before_after_code_files": [
      "main/WebServer.cpp||main/WebServer.cpp"
    ]
  },
  "patch_diff": {
    "main/WebServer.cpp||main/WebServer.cpp": [
      "File: main/WebServer.cpp -> main/WebServer.cpp",
      "--- Hunk 1 ---",
      "[Context before]",
      "10772:     return;",
      "10773:    }",
      "10774:    std::vector<std::vector<std::string> > result;",
      "10776:    if (result.empty())",
      "10777:     return;",
      "10778:    reply::set_content(&rep, result[0][0].begin(), result[0][0].end());",
      "",
      "[Removed Lines]",
      "10775:    result = m_sql.safe_queryBlob(\"SELECT Image FROM Floorplans WHERE ID=%s\", idx.c_str());",
      "",
      "[Added Lines]",
      "10775:    result = m_sql.safe_queryBlob(\"SELECT Image FROM Floorplans WHERE ID=%d\", atol(idx.c_str()));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3f0a62a06b71809130416feac976fd3a35f9b74e",
      "candidate_info": {
        "commit_hash": "3f0a62a06b71809130416feac976fd3a35f9b74e",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/3f0a62a06b71809130416feac976fd3a35f9b74e",
        "files": [
          "hardware/cayenne_lpp/CayenneLPP.h",
          "hardware/cayenne_lpp/CayenneLPP_Dec.cpp"
        ],
        "message": "CayenneLPP, added initial support for LPP_UNIXTIME",
        "before_after_code_files": [
          "hardware/cayenne_lpp/CayenneLPP.h||hardware/cayenne_lpp/CayenneLPP.h",
          "hardware/cayenne_lpp/CayenneLPP_Dec.cpp||hardware/cayenne_lpp/CayenneLPP_Dec.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "hardware/cayenne_lpp/CayenneLPP.h||hardware/cayenne_lpp/CayenneLPP.h": [
          "File: hardware/cayenne_lpp/CayenneLPP.h -> hardware/cayenne_lpp/CayenneLPP.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "16: #define LPP_RELATIVE_HUMIDITY   104     // 1 byte, 0.5% unsigned",
          "17: #define LPP_ACCELEROMETER       113     // 2 bytes per axis, 0.001G",
          "18: #define LPP_BAROMETRIC_PRESSURE 115     // 2 bytes 0.1 hPa Unsigned",
          "19: #define LPP_GYROMETER           134     // 2 bytes per axis, 0.01 \u00b0/s",
          "20: #define LPP_GPS                 136     // 3 byte lon/lat 0.0001 \u00b0, 3 bytes alt 0.01 meter",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "19: #define LPP_UNIXTIME   133  // 4 bytes, unsigned uint_32_t",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "31: #define LPP_RELATIVE_HUMIDITY_SIZE   3       // 1 byte, 0.5% unsigned",
          "32: #define LPP_ACCELEROMETER_SIZE       8       // 2 bytes per axis, 0.001G",
          "33: #define LPP_BAROMETRIC_PRESSURE_SIZE 4       // 2 bytes 0.1 hPa Unsigned",
          "34: #define LPP_GYROMETER_SIZE           8       // 2 bytes per axis, 0.01 \u00b0/s",
          "35: #define LPP_GPS_SIZE                 11      // 3 byte lon/lat 0.0001 \u00b0, 3 bytes alt 0.01 meter",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35: #define LPP_UNIXTIME_SIZE    6   // 4 bytes, unsigned uint_32_t",
          "",
          "---------------"
        ],
        "hardware/cayenne_lpp/CayenneLPP_Dec.cpp||hardware/cayenne_lpp/CayenneLPP_Dec.cpp": [
          "File: hardware/cayenne_lpp/CayenneLPP_Dec.cpp -> hardware/cayenne_lpp/CayenneLPP_Dec.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "189:    pBuffer += LPP_BAROMETRIC_PRESSURE_SIZE;",
          "190:    Len -= LPP_BAROMETRIC_PRESSURE_SIZE;",
          "191:   }",
          "192:   else if (lpp_type == LPP_GYROMETER) {",
          "193:    if (Len < LPP_GYROMETER_SIZE)",
          "194:     return false;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "192:   else if (lpp_type == LPP_UNIXTIME) {",
          "193:    if (Len < LPP_UNIXTIME_SIZE)",
          "194:     return false;",
          "196:    root[iIndex][\"channel\"] = channel;",
          "197:    root[iIndex][\"type\"] = \"unixtime\";",
          "199:    uint32_t value = (pBuffer[2] << 24) | (pBuffer[3] << 16) | (pBuffer[4] << 8) | pBuffer[5];",
          "200:    root[iIndex++][\"value\"] = value;",
          "202:    pBuffer += LPP_UNIXTIME_SIZE;",
          "203:    Len -= LPP_UNIXTIME_SIZE;",
          "204:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "fad48f6fb5de80c487774b65c9ef819a7c33495d",
      "candidate_info": {
        "commit_hash": "fad48f6fb5de80c487774b65c9ef819a7c33495d",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/fad48f6fb5de80c487774b65c9ef819a7c33495d",
        "files": [
          "hardware/ASyncTCP.cpp"
        ],
        "message": "ASyncTCP masking unreferenced local variable warning",
        "before_after_code_files": [
          "hardware/ASyncTCP.cpp||hardware/ASyncTCP.cpp"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "hardware/ASyncTCP.cpp||hardware/ASyncTCP.cpp": [
          "File: hardware/ASyncTCP.cpp -> hardware/ASyncTCP.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "9:  #include <unistd.h> //gethostbyname",
          "10: #endif",
          "12: #define RECONNECT_TIME 30",
          "14: ASyncTCP::ASyncTCP()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "12: #define Q_UNUSED(x) (void)x;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "61:  }",
          "62:  catch (const std::exception &e)",
          "63:  {",
          "64:   if (!mAllowCallbacks)",
          "65:    return;",
          "66:   OnError(boost::system::error_code(boost::asio::error::host_not_found));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "66:   Q_UNUSED(e);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "16e1fd39a8c6a94405b5e30a5cc52922d4592080",
      "candidate_info": {
        "commit_hash": "16e1fd39a8c6a94405b5e30a5cc52922d4592080",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/16e1fd39a8c6a94405b5e30a5cc52922d4592080",
        "files": [
          "History.txt",
          "push/InfluxPush.cpp",
          "push/InfluxPush.h",
          "webserver/Base64.cpp",
          "webserver/Base64.h",
          "www/app/DPInfluxController.js",
          "www/views/dpinflux.html"
        ],
        "message": "Implemented: InfluxDB Data push, support for Username/Password",
        "before_after_code_files": [
          "push/InfluxPush.cpp||push/InfluxPush.cpp",
          "push/InfluxPush.h||push/InfluxPush.h",
          "webserver/Base64.cpp||webserver/Base64.cpp",
          "webserver/Base64.h||webserver/Base64.h",
          "www/app/DPInfluxController.js||www/app/DPInfluxController.js",
          "www/views/dpinflux.html||www/views/dpinflux.html"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "push/InfluxPush.cpp||push/InfluxPush.cpp": [
          "File: push/InfluxPush.cpp -> push/InfluxPush.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "8: #include \"../main/mainworker.h\"",
          "9: #include \"../main/RFXtrx.h\"",
          "10: #include \"../main/SQLHelper.h\"",
          "12: #include \"../main/WebServer.h\"",
          "13: #include \"../webserver/cWebem.h\"",
          "14: #include \"../main/localtime_r.h\"",
          "15: #define __STDC_FORMAT_MACROS",
          "",
          "[Removed Lines]",
          "11: #include \"../webserver/Base64.h\"",
          "",
          "[Added Lines]",
          "12: #include \"../webserver/Base64.h\"",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "46:  m_sql.GetPreferencesVar(\"InfluxIP\", m_InfluxIP);",
          "47:  m_sql.GetPreferencesVar(\"InfluxPort\", m_InfluxPort);",
          "48:  m_sql.GetPreferencesVar(\"InfluxDatabase\", m_InfluxDatabase);",
          "49:  int InfluxDebugActiveInt = 0;",
          "50:  m_bInfluxDebugActive = false;",
          "51:  m_sql.GetPreferencesVar(\"InfluxDebug\", InfluxDebugActiveInt);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "49:  m_sql.GetPreferencesVar(\"InfluxUsername\", m_InfluxUsername);",
          "50:  m_sql.GetPreferencesVar(\"InfluxPassword\", m_InfluxPassword);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "54:  }",
          "55:  m_szURL = \"\";",
          "56:  if (",
          "58:   (m_InfluxPort == 0) ||",
          "60:   )",
          "61:   return;",
          "62:  std::stringstream sURL;",
          "63:  if (m_InfluxIP.find(\"://\") == std::string::npos)",
          "64:   sURL << \"http://\";",
          "66:  m_szURL = sURL.str();",
          "67: }",
          "",
          "[Removed Lines]",
          "57:   (m_InfluxIP == \"\") ||",
          "59:   (m_InfluxDatabase == \"\")",
          "65:  sURL << m_InfluxIP << \":\" << m_InfluxPort << \"/write?db=\" << m_InfluxDatabase;",
          "",
          "[Added Lines]",
          "60:   (m_InfluxIP.empty()) ||",
          "62:   (m_InfluxDatabase.empty())",
          "68:  sURL << m_InfluxIP << \":\" << m_InfluxPort << \"/write?\";",
          "69:  if ((!m_InfluxUsername.empty()) && (!m_InfluxPassword.empty()))",
          "70:   sURL << \"u=\" << m_InfluxUsername << \"&p=\" << base64_decode(m_InfluxPassword) << \"&\";",
          "71:  sURL << \"db=\" << m_InfluxDatabase;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "225:    std::string remote = request::findValue(&req, \"remote\");",
          "226:    std::string port = request::findValue(&req, \"port\");",
          "227:    std::string database = request::findValue(&req, \"database\");",
          "228:    std::string debugenabled = request::findValue(&req, \"debugenabled\");",
          "229:    if (",
          "230:     (linkactive == \"\") ||",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "234:    std::string username = request::findValue(&req, \"username\");",
          "235:    std::string password = request::findValue(&req, \"password\");",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "240:    m_sql.UpdatePreferencesVar(\"InfluxIP\", remote.c_str());",
          "241:    m_sql.UpdatePreferencesVar(\"InfluxPort\", atoi(port.c_str()));",
          "242:    m_sql.UpdatePreferencesVar(\"InfluxDatabase\", database.c_str());",
          "243:    m_sql.UpdatePreferencesVar(\"InfluxDebug\", idebugenabled);",
          "244:    m_influxpush.UpdateSettings();",
          "245:    root[\"status\"] = \"OK\";",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "251:    m_sql.UpdatePreferencesVar(\"InfluxUsername\", username.c_str());",
          "252:    m_sql.UpdatePreferencesVar(\"InfluxPassword\", base64_encode(password));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "273:    {",
          "274:     root[\"InfluxDatabase\"] = sValue;",
          "275:    }",
          "276:    if (m_sql.GetPreferencesVar(\"InfluxDebug\", nValue)) {",
          "277:     root[\"InfluxDebug\"] = nValue;",
          "278:    }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "286:    if (m_sql.GetPreferencesVar(\"InfluxUsername\", sValue))",
          "287:    {",
          "288:     root[\"InfluxUsername\"] = sValue;",
          "289:    }",
          "290:    if (m_sql.GetPreferencesVar(\"InfluxPassword\", sValue))",
          "291:    {",
          "292:     root[\"InfluxPassword\"] = base64_decode(sValue);",
          "293:    }",
          "",
          "---------------"
        ],
        "push/InfluxPush.h||push/InfluxPush.h": [
          "File: push/InfluxPush.h -> push/InfluxPush.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "32:  std::string m_InfluxIP;",
          "33:  int m_InfluxPort;",
          "34:  std::string m_InfluxDatabase;",
          "35:  bool m_bInfluxDebugActive;",
          "36: };",
          "37: extern CInfluxPush m_influxpush;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35:  std::string m_InfluxUsername;",
          "36:  std::string m_InfluxPassword;",
          "",
          "---------------"
        ],
        "webserver/Base64.cpp||webserver/Base64.cpp": [
          "File: webserver/Base64.cpp -> webserver/Base64.cpp",
          "--- Hunk 1 ---",
          "[Context before]",
          "98: }",
          "100: std::string base64_decode(std::string const& encoded_string) {",
          "101:   size_t in_len = encoded_string.size();",
          "102:   int i = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "100: std::string base64_encode(std::string const& s) {",
          "101:  return base64_encode((unsigned char const*)s.c_str(), (unsigned int)s.size());",
          "102: }",
          "",
          "---------------"
        ],
        "webserver/Base64.h||webserver/Base64.h": [
          "File: webserver/Base64.h -> webserver/Base64.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: #include <string>",
          "7: std::string base64_encode(unsigned char const* , unsigned int len);",
          "8: std::string base64_decode(std::string const& s);",
          "10: #endif",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8: std::string base64_encode(std::string const& s);",
          "",
          "---------------"
        ],
        "www/app/DPInfluxController.js||www/app/DPInfluxController.js": [
          "File: www/app/DPInfluxController.js -> www/app/DPInfluxController.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "13:        $('#influxremote #tcpaddress').val(data.InfluxIP);",
          "14:        $('#influxremote #tcpport').val(data.InfluxPort);",
          "15:        $('#influxremote #database').val(data.InfluxDatabase);",
          "16:        $('#influxremote #influxlinkenabled').prop('checked', false);",
          "17:        if (data.InfluxActive) {",
          "18:         $('#influxremote #influxlinkenabled').prop('checked', true);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16:        $('#influxremote #username').val(data.InfluxUsername);",
          "17:        $('#influxremote #password').val(data.InfluxPassword);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "42:    if (port.Length==0)",
          "43:     port=\"8086\";",
          "44:    var database = $('#influxremote #database').val();",
          "45:    var debugenabled = 0;",
          "46:    if ($('#influxremote #debugenabled').is(\":checked\"))",
          "47:    {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "47:    var username = $('#influxremote #username').val();",
          "48:    var password = $('#influxremote #password').val();",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "54:      \"&remote=\" + encodeURIComponent(remoteurl) +",
          "55:      \"&port=\" + port +",
          "56:      \"&database=\" + encodeURIComponent(database) +",
          "57:      \"&debugenabled=\" + debugenabled,",
          "58:      async: false,",
          "59:      dataType: 'json',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "61:      \"&username=\" + encodeURIComponent(username) +",
          "62:      \"&password=\" + encodeURIComponent(password) +",
          "",
          "---------------"
        ],
        "www/views/dpinflux.html||www/views/dpinflux.html": [
          "File: www/views/dpinflux.html -> www/views/dpinflux.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "66:    <td align=\"right\" style=\"width:110px\"><label><span data-i18n=\"Database\"></span>:</label></td>",
          "67:    <td><input type=\"text\" id=\"database\" style=\"width: 150px; padding: .2em;\" class=\"text ui-widget-content ui-corner-all\" />",
          "68:   </tr>",
          "69:   <tr>",
          "70:    <td align=\"right\" style=\"width:80px\"><span data-i18n=\"Debug to logfile\"></span>:</td>",
          "71:    <td><input type=\"checkbox\" id=\"debugenabled\" checked><label for=\"debugenabled\"/></td>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "69:   <tr>",
          "70:    <td align=\"right\" style=\"width:110px\"><label><span data-i18n=\"Username\"></span>:</label></td>",
          "71:    <td><input type=\"text\" id=\"username\" style=\"width: 150px; padding: .2em;\" class=\"text ui-widget-content ui-corner-all\" />",
          "72:   </tr>",
          "73:   <tr>",
          "74:    <td align=\"right\" style=\"width:110px\"><label><span data-i18n=\"Password\"></span>:</label></td>",
          "75:    <td><input type=\"text\" id=\"password\" style=\"width: 150px; padding: .2em;\" class=\"text ui-widget-content ui-corner-all\" />",
          "76:   </tr>",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4dd3263e5bf38d89b9d7442b16608f9f80f7d43d",
      "candidate_info": {
        "commit_hash": "4dd3263e5bf38d89b9d7442b16608f9f80f7d43d",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/4dd3263e5bf38d89b9d7442b16608f9f80f7d43d",
        "files": [
          "www/app/SetupController.js"
        ],
        "message": "Using MapQuest Geo API (fixes #2929)",
        "before_after_code_files": [
          "www/app/SetupController.js||www/app/SetupController.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "www/app/SetupController.js||www/app/SetupController.js": [
          "File: www/app/SetupController.js -> www/app/SetupController.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "812:        bootbox.alert($.t('Please enter a Address to search for!...'), 3500, true);",
          "813:        return false;",
          "814:       }",
          "822:        }",
          "823:       });",
          "824:       return false;",
          "825:      });",
          "",
          "[Removed Lines]",
          "815:       geocoder = new google.maps.Geocoder();",
          "816:       geocoder.geocode({ 'address': address }, function (results, status) {",
          "817:        if (status == google.maps.GeocoderStatus.OK) {",
          "818:         $('#dialog-findlatlong #latitude').val(results[0].geometry.location.lat().toFixed(6));",
          "819:         $('#dialog-findlatlong #longitude').val(results[0].geometry.location.lng().toFixed(6));",
          "820:        } else {",
          "821:         bootbox.alert($.t('Geocode was not successful for the following reason') + ': ' + status);",
          "",
          "[Added Lines]",
          "815:       var url = \"https://www.mapquestapi.com/geocoding/v1/address?key=XN5Eyt9GjLaRPG6T2if7VtUueRLckR8b&inFormat=kvp&outFormat=json&thumbMaps=false&location=\" + address;",
          "816:       $http({",
          "817:        url: url,",
          "818:        async: true,",
          "819:        dataType: 'json'",
          "820:       }).then(function successCallback(response) {",
          "821:        var data = response.data;",
          "822:        var bIsOK = false;",
          "823:        if(data.hasOwnProperty('results')) {",
          "824:         if (data['results'][0]['locations'].length > 0) {",
          "825:          $('#dialog-findlatlong #latitude').val(data['results'][0]['locations'][0]['displayLatLng']['lat']);",
          "826:          $('#dialog-findlatlong #longitude').val(data['results'][0]['locations'][0]['displayLatLng']['lng']);//.toFixed(6)",
          "827:          bIsOK = true;",
          "828:         }",
          "829:        }",
          "830:        if (!bIsOk) {",
          "831:         bootbox.alert($.t('Geocode was not successful for the following reason') + ': Invalid/No data returned!');",
          "833:       }, function errorCallback(response) {",
          "834:        bootbox.alert($.t('Geocode was not successful for the following reason') + ': ' + response.statusText);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3517365885e6fcc7b15d8ec432c5d34816415b51",
      "candidate_info": {
        "commit_hash": "3517365885e6fcc7b15d8ec432c5d34816415b51",
        "repo": "domoticz/domoticz",
        "commit_url": "https://github.com/domoticz/domoticz/commit/3517365885e6fcc7b15d8ec432c5d34816415b51",
        "files": [
          "www/app/events/Events.html",
          "www/app/events/Events.js"
        ],
        "message": "Added Time/Sun set/rise to events frame",
        "before_after_code_files": [
          "www/app/events/Events.html||www/app/events/Events.html",
          "www/app/events/Events.js||www/app/events/Events.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/domoticz/domoticz/pull/3180"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "www/app/events/Events.html||www/app/events/Events.html": [
          "File: www/app/events/Events.html -> www/app/events/Events.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "113: </div>",
          "",
          "[Removed Lines]",
          "1: <div class=\"events-editor\">",
          "2:     <section class=\"events-editor__tree\" ng-show=\"$ctrl.isListExpanded\">",
          "3:         <h2>{{:: 'My automation scripts' | translate }}</h2>",
          "4:         <input class=\"events-editor__search\" type=\"search\" ng-model=\"$ctrl.search.name\" placeholder=\"{{:: 'Filter' | translate }}\" />",
          "5:         <nav class=\"events-editor-tree\">",
          "6:             <li class=\"events-editor-tree-item\"",
          "7:                 ng-class=\"{",
          "8:                     'events-editor-tree-item_disabled': event.eventstatus === '0',",
          "9:                     'events-editor-tree-item_active': event.id === $ctrl.activeEventId",
          "10:                 }\"",
          "11:                 ng-repeat=\"event in $ctrl.events | filter:$ctrl.search track by event.id\"",
          "12:             >",
          "13:                 <a class=\"events-editor-tree-item__file\"",
          "14:                    href=\"javascript:void(0)\"",
          "15:                    ng-click=\"$ctrl.openEvent(event)\"",
          "16:                 >",
          "17:                     <span class=\"label label-important\" ng-if=\"event.eventstatus === '0'\">{{:: 'Disabled' | translate }}</span>",
          "18:                     {{ event.name }}",
          "19:                 </a>",
          "20:             </li>",
          "21:         </nav>",
          "22:     </section>",
          "24:     <button type=\"button\"",
          "25:             class=\"events-editor__splitter\"",
          "26:             ng-click=\"$ctrl.isListExpanded = !$ctrl.isListExpanded\"",
          "27:     >",
          "28:         <i ng-class=\"{'icon-chevron-left': $ctrl.isListExpanded, 'icon-chevron-right': !$ctrl.isListExpanded}\"></i>",
          "29:     </button>",
          "31:     <section class=\"events-editor__editor\">",
          "32:         <nav class=\"events-editor__file-list\">",
          "33:             <a class=\"events-editor__file\"",
          "34:                href=\"javascript:void(0)\"",
          "35:                ng-class=\"{'events-editor__file_active': $ctrl.activeEventId === 'states'}\"",
          "36:                ng-click=\"$ctrl.setActiveEventId('states')\"",
          "37:                title=\"{{:: 'Devices current states' | translate}}\"",
          "38:            >",
          "39:                 <i class=\"icon-tasks\"></i>",
          "40:             </a>",
          "42:             <a class=\"events-editor__file\"",
          "43:                href=\"javascript:void(0)\"",
          "44:                ng-repeat=\"event in $ctrl.openedEvents track by event.id\"",
          "45:                ng-class=\"{'events-editor__file_active': event.id === $ctrl.activeEventId}\"",
          "46:                ng-click=\"$ctrl.setActiveEventId(event.id)\"",
          "47:             >",
          "48:                 {{ event.name }}",
          "49:                 <span ng-if=\"event.isChanged\">*</span>",
          "50:                 <button class=\"events-editor__file-close\" ng-click=\"$ctrl.closeEvent(event)\">\u00d7</button>",
          "51:             </a>",
          "53:             <div class=\"events-editor__file-create\">",
          "54:                 <button class=\"events-editor__file\"",
          "55:                         title=\"{{:: 'Add automation script' | translate}}\"",
          "56:                         data-toggle=\"dropdown\"",
          "57:                 >",
          "58:                     <i class=\"icon-plus\"></i>",
          "59:                 </button>",
          "60:                 <ul class=\"dropdown-menu events-editor__menu\">",
          "61:                     <li ng-if=\":: $ctrl.isInterpreterSupported('Blockly')\">",
          "62:                         <a class=\"events-editor__menu-item\" tabindex=\"-1\" href=\"javascript:void(0)\" ng-click=\"$ctrl.createEvent('Blockly')\">Blockly</a>",
          "63:                     </li>",
          "64:                     <li ng-if=\":: $ctrl.isInterpreterSupported('Python')\">",
          "65:                         <a class=\"events-editor__menu-item\" tabindex=\"-1\" href=\"javascript:void(0)\" ng-click=\"$ctrl.createEvent('Python')\">Python</a>",
          "66:                     </li>",
          "67:                     <li ng-if=\":: $ctrl.isInterpreterSupported('Lua')\" class=\"dropdown-submenu\">",
          "68:                         <a class=\"events-editor__menu-item\" tabindex=\"-1\" href=\"javascript:void(0)\">Lua</a>",
          "69:                         <ul class=\"dropdown-menu events-editor__menu\">",
          "70:                             <li ng-repeat=\"template in ::$ctrl.luaTemplates\">",
          "71:                                 <a tabindex=\"-1\"",
          "72:                                    class=\"events-editor__menu-item\"",
          "73:                                    href=\"javascript:void(0)\"",
          "74:                                    ng-click=\"$ctrl.createEvent('Lua', template.id)\"",
          "75:                                 >",
          "76:                                     {{:: template.name}}",
          "77:                                 </a>",
          "78:                             </li>",
          "79:                         </ul>",
          "80:                     </li>",
          "81:                     <li ng-if=\":: $ctrl.isInterpreterSupported('dzVents')\" class=\"dropdown-submenu\">",
          "82:                         <a class=\"events-editor__menu-item\" tabindex=\"-1\" href=\"javascript:void(0)\">dzVents</a>",
          "83:                         <ul class=\"dropdown-menu events-editor__menu\">",
          "84:                             <li ng-repeat=\"template in ::$ctrl.dzVentsTemplates\">",
          "85:                                 <a tabindex=\"-1\"",
          "86:                                    class=\"events-editor__menu-item\"",
          "87:                                    href=\"javascript:void(0)\"",
          "88:                                    ng-click=\"$ctrl.createEvent('dzVents', template.id)\"",
          "89:                                 >",
          "90:                                     {{:: template.name}}",
          "91:                                 </a>",
          "92:                             </li>",
          "93:                         </ul>",
          "94:                     </li>",
          "95:                 </ul>",
          "96:             </div>",
          "97:         </nav>",
          "99:         <events-current-states",
          "100:             class=\"events-editor-file events-editor__file-content\"",
          "101:             ng-show=\"$ctrl.activeEventId === 'states'\"",
          "102:         />",
          "104:         <event-viewer",
          "105:                 class=\"events-editor-file events-editor__file-content\"",
          "106:                 ng-repeat=\"event in $ctrl.openedEvents track by event.id\"",
          "107:                 ng-show=\"event.id === $ctrl.activeEventId\"",
          "108:                 event=\"event\"",
          "109:                 on-update=\"$ctrl.updateEvent(event)\"",
          "110:                 on-delete=\"$ctrl.deleteEvent(event)\"",
          "111:         />",
          "112:     </section>",
          "",
          "[Added Lines]",
          "1: <div class=\"row\" style=\"margin: -14px 0 0 -8px;\">",
          "2:  <timesun></timesun>",
          "3: </div>",
          "4: <div class=\"row\">",
          "5:  <div class=\"events-editor\">",
          "6:   <section class=\"events-editor__tree\" ng-show=\"$ctrl.isListExpanded\">",
          "7:    <h2>{{:: 'My automation scripts' | translate }}</h2>",
          "8:    <input class=\"events-editor__search\" type=\"search\" ng-model=\"$ctrl.search.name\" placeholder=\"{{:: 'Filter' | translate }}\" />",
          "9:    <nav class=\"events-editor-tree\">",
          "10:     <li class=\"events-editor-tree-item\"",
          "11:      ng-class=\"{",
          "12:       'events-editor-tree-item_disabled': event.eventstatus === '0',",
          "13:       'events-editor-tree-item_active': event.id === $ctrl.activeEventId",
          "14:      }\"",
          "15:      ng-repeat=\"event in $ctrl.events | filter:$ctrl.search track by event.id\"",
          "16:     >",
          "17:      <a class=\"events-editor-tree-item__file\"",
          "18:         href=\"javascript:void(0)\"",
          "19:         ng-click=\"$ctrl.openEvent(event)\"",
          "20:      >",
          "21:       <span class=\"label label-important\" ng-if=\"event.eventstatus === '0'\">{{:: 'Disabled' | translate }}</span>",
          "22:       {{ event.name }}",
          "23:      </a>",
          "24:     </li>",
          "25:    </nav>",
          "26:   </section>",
          "28:   <button type=\"button\"",
          "29:     class=\"events-editor__splitter\"",
          "30:     ng-click=\"$ctrl.isListExpanded = !$ctrl.isListExpanded\"",
          "31:   >",
          "32:    <i ng-class=\"{'icon-chevron-left': $ctrl.isListExpanded, 'icon-chevron-right': !$ctrl.isListExpanded}\"></i>",
          "33:   </button>",
          "35:   <section class=\"events-editor__editor\">",
          "36:    <nav class=\"events-editor__file-list\">",
          "37:     <a class=\"events-editor__file\"",
          "38:        href=\"javascript:void(0)\"",
          "39:        ng-class=\"{'events-editor__file_active': $ctrl.activeEventId === 'states'}\"",
          "40:        ng-click=\"$ctrl.setActiveEventId('states')\"",
          "41:        title=\"{{:: 'Devices current states' | translate}}\"",
          "42:       >",
          "43:      <i class=\"icon-tasks\"></i>",
          "44:     </a>",
          "46:     <a class=\"events-editor__file\"",
          "47:        href=\"javascript:void(0)\"",
          "48:        ng-repeat=\"event in $ctrl.openedEvents track by event.id\"",
          "49:        ng-class=\"{'events-editor__file_active': event.id === $ctrl.activeEventId}\"",
          "50:        ng-click=\"$ctrl.setActiveEventId(event.id)\"",
          "51:     >",
          "52:      {{ event.name }}",
          "53:      <span ng-if=\"event.isChanged\">*</span>",
          "54:      <button class=\"events-editor__file-close\" ng-click=\"$ctrl.closeEvent(event)\">\u00d7</button>",
          "55:     </a>",
          "57:     <div class=\"events-editor__file-create\">",
          "58:      <button class=\"events-editor__file\"",
          "59:        title=\"{{:: 'Add automation script' | translate}}\"",
          "60:        data-toggle=\"dropdown\"",
          "61:      >",
          "62:       <i class=\"icon-plus\"></i>",
          "63:      </button>",
          "64:      <ul class=\"dropdown-menu events-editor__menu\">",
          "65:       <li ng-if=\":: $ctrl.isInterpreterSupported('Blockly')\">",
          "66:        <a class=\"events-editor__menu-item\" tabindex=\"-1\" href=\"javascript:void(0)\" ng-click=\"$ctrl.createEvent('Blockly')\">Blockly</a>",
          "67:       </li>",
          "68:       <li ng-if=\":: $ctrl.isInterpreterSupported('Python')\">",
          "69:        <a class=\"events-editor__menu-item\" tabindex=\"-1\" href=\"javascript:void(0)\" ng-click=\"$ctrl.createEvent('Python')\">Python</a>",
          "70:       </li>",
          "71:       <li ng-if=\":: $ctrl.isInterpreterSupported('Lua')\" class=\"dropdown-submenu\">",
          "72:        <a class=\"events-editor__menu-item\" tabindex=\"-1\" href=\"javascript:void(0)\">Lua</a>",
          "73:        <ul class=\"dropdown-menu events-editor__menu\">",
          "74:         <li ng-repeat=\"template in ::$ctrl.luaTemplates\">",
          "75:          <a tabindex=\"-1\"",
          "76:             class=\"events-editor__menu-item\"",
          "77:             href=\"javascript:void(0)\"",
          "78:             ng-click=\"$ctrl.createEvent('Lua', template.id)\"",
          "79:          >",
          "80:           {{:: template.name}}",
          "81:          </a>",
          "82:         </li>",
          "83:        </ul>",
          "84:       </li>",
          "85:       <li ng-if=\":: $ctrl.isInterpreterSupported('dzVents')\" class=\"dropdown-submenu\">",
          "86:        <a class=\"events-editor__menu-item\" tabindex=\"-1\" href=\"javascript:void(0)\">dzVents</a>",
          "87:        <ul class=\"dropdown-menu events-editor__menu\">",
          "88:         <li ng-repeat=\"template in ::$ctrl.dzVentsTemplates\">",
          "89:          <a tabindex=\"-1\"",
          "90:             class=\"events-editor__menu-item\"",
          "91:             href=\"javascript:void(0)\"",
          "92:             ng-click=\"$ctrl.createEvent('dzVents', template.id)\"",
          "93:          >",
          "94:           {{:: template.name}}",
          "95:          </a>",
          "96:         </li>",
          "97:        </ul>",
          "98:       </li>",
          "99:      </ul>",
          "100:     </div>",
          "101:    </nav>",
          "103:    <events-current-states",
          "104:     class=\"events-editor-file events-editor__file-content\"",
          "105:     ng-show=\"$ctrl.activeEventId === 'states'\"",
          "106:    />",
          "108:    <event-viewer",
          "109:      class=\"events-editor-file events-editor__file-content\"",
          "110:      ng-repeat=\"event in $ctrl.openedEvents track by event.id\"",
          "111:      ng-show=\"event.id === $ctrl.activeEventId\"",
          "112:      event=\"event\"",
          "113:      on-update=\"$ctrl.updateEvent(event)\"",
          "114:      on-delete=\"$ctrl.deleteEvent(event)\"",
          "115:    />",
          "116:   </section>",
          "117:  </div>",
          "",
          "---------------"
        ],
        "www/app/events/Events.js||www/app/events/Events.js": [
          "File: www/app/events/Events.js -> www/app/events/Events.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: define(['app', 'events/factories', 'events/EventViewer', 'events/CurrentStates'], function (app) {",
          "2:     app.controller('EventsController', EventsController);",
          "5:         var vm = this;",
          "6:         vm.createEvent = createEvent;",
          "7:         vm.openEvent = openEvent;",
          "",
          "[Removed Lines]",
          "4:     function EventsController($q, domoticzApi, domoticzEventsApi, bootbox) {",
          "",
          "[Added Lines]",
          "4:     function EventsController($q, $rootScope, domoticzApi, domoticzEventsApi, bootbox) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "52:         }",
          "54:         function fetchEvents() {",
          "55:             return domoticzEventsApi.fetchEvents().then(function (data) {",
          "56:                 vm.events = data.events;",
          "57:                 vm.interpreters = data.interpreters;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "55:    $rootScope.RefreshTimeAndSun();",
          "",
          "---------------"
        ]
      }
    }
  ]
}