{
  "cve_id": "CVE-2015-0278",
  "cve_desc": "libuv before 0.10.34 does not properly drop group privileges, which allows context-dependent attackers to gain privileges via unspecified vectors.",
  "repo": "libuv/libuv",
  "patch_hash": "66ab38918c911bcff025562cf06237d7fedaba0c",
  "patch_info": {
    "commit_hash": "66ab38918c911bcff025562cf06237d7fedaba0c",
    "repo": "libuv/libuv",
    "commit_url": "https://github.com/libuv/libuv/commit/66ab38918c911bcff025562cf06237d7fedaba0c",
    "files": [
      "src/unix/process.c"
    ],
    "message": "unix: call setgoups before calling setuid/setgid\n\nPartial fix for #1093",
    "before_after_code_files": [
      "src/unix/process.c||src/unix/process.c"
    ]
  },
  "patch_diff": {
    "src/unix/process.c||src/unix/process.c": [
      "File: src/unix/process.c -> src/unix/process.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "330:     _exit(127);",
      "331:   }",
      "333:   if ((options->flags & UV_PROCESS_SETGID) && setgid(options->gid)) {",
      "334:     uv__write_int(error_fd, -errno);",
      "335:     perror(\"setgid()\");",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "333:   if (options->flags & (UV_PROCESS_SETUID | UV_PROCESS_SETGID)) {",
      "341:     SAVE_ERRNO(setgroups(0, NULL));",
      "342:   }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "e56717ae988416ddaebadbb1c23c07f466bab046",
      "candidate_info": {
        "commit_hash": "e56717ae988416ddaebadbb1c23c07f466bab046",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/e56717ae988416ddaebadbb1c23c07f466bab046",
        "files": [
          "src/win/tty.c"
        ],
        "message": "windows: add invert ANSI (7 / 27) emulation",
        "before_after_code_files": [
          "src/win/tty.c||src/win/tty.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/41"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/win/tty.c||src/win/tty.c": [
          "File: src/win/tty.c -> src/win/tty.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1117:   return 0;",
          "1118: }",
          "1121: static int uv_tty_set_style(uv_tty_t* handle, DWORD* error) {",
          "1122:   unsigned short argc = handle->ansi_csi_argc;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1120: #define FLIP_FGBG                                                             \\",
          "1121:     do {                                                                      \\",
          "1122:       WORD fg = info.wAttributes & 0xF;                                       \\",
          "1123:       WORD bg = info.wAttributes & 0xF0;                                      \\",
          "1124:       info.wAttributes &= 0xFF00;                                             \\",
          "1125:       info.wAttributes |= fg << 4;                                            \\",
          "1126:       info.wAttributes |= bg >> 4;                                            \\",
          "1127:     } while (0)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1127:   char fg_color = -1, bg_color = -1;",
          "1128:   char fg_bright = -1, bg_bright = -1;",
          "1130:   if (argc == 0) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1137:   char inverse = -1;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1133:     bg_color = 0;",
          "1134:     fg_bright = 0;",
          "1135:     bg_bright = 0;",
          "1136:   }",
          "1138:   for (i = 0; i < argc; i++) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1145:     inverse = 0;",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1144:       bg_color = 0;",
          "1145:       fg_bright = 0;",
          "1146:       bg_bright = 0;",
          "1148:     } else if (arg == 1) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1157:       inverse = 0;",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "1159:       bg_bright = 1;",
          "1161:     } else if (arg == 21 || arg == 22) {",
          "1163:       fg_bright = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1172:     } else if (arg == 7) {",
          "1174:       inverse = 1;",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "1167:       bg_bright = 0;",
          "1169:     } else if (arg >= 30 && arg <= 37) {",
          "1171:       fg_color = arg - 30;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1184:     } else if (arg == 27) {",
          "1186:       inverse = 0;",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "1198:   }",
          "1200:   if (fg_color == -1 && bg_color == -1 && fg_bright == -1 &&",
          "1203:     return 0;",
          "1204:   }",
          "",
          "[Removed Lines]",
          "1201:       bg_bright == -1) {",
          "",
          "[Added Lines]",
          "1220:       bg_bright == -1 && inverse == -1) {",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "1208:     return -1;",
          "1209:   }",
          "1211:   if (fg_color != -1) {",
          "1212:     info.wAttributes &= ~(FOREGROUND_RED | FOREGROUND_GREEN | FOREGROUND_BLUE);",
          "1213:     if (fg_color & 1) info.wAttributes |= FOREGROUND_RED;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1230:   if ((info.wAttributes & COMMON_LVB_REVERSE_VIDEO) > 0) {",
          "1231:     FLIP_FGBG;",
          "1232:   }",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "1238:     }",
          "1239:   }",
          "1241:   if (!SetConsoleTextAttribute(handle->handle, info.wAttributes)) {",
          "1243:     return -1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1264:   if (inverse != -1) {",
          "1265:     if (inverse) {",
          "1266:       info.wAttributes |= COMMON_LVB_REVERSE_VIDEO;",
          "1267:     } else {",
          "1268:       info.wAttributes &= ~COMMON_LVB_REVERSE_VIDEO;",
          "1269:     }",
          "1270:   }",
          "1272:   if ((info.wAttributes & COMMON_LVB_REVERSE_VIDEO) > 0) {",
          "1273:     FLIP_FGBG;",
          "1274:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b5548f18c93eaee14d98241d0a88d4f5ec804d51",
      "candidate_info": {
        "commit_hash": "b5548f18c93eaee14d98241d0a88d4f5ec804d51",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/b5548f18c93eaee14d98241d0a88d4f5ec804d51",
        "files": [
          "ChangeLog",
          "configure.ac",
          "include/uv-version.h"
        ],
        "message": "Now working on v0.11.26",
        "before_after_code_files": [
          "configure.ac||configure.ac",
          "include/uv-version.h||include/uv-version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/41"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: # OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.",
          "15: AC_PREREQ(2.57)",
          "17: AC_CONFIG_MACRO_DIR([m4])",
          "18: m4_include([m4/libuv-extra-automake-flags.m4])",
          "19: m4_include([m4/as_case.m4])",
          "",
          "[Removed Lines]",
          "16: AC_INIT([libuv], [0.11.25], [https://github.com/joyent/libuv/issues])",
          "",
          "[Added Lines]",
          "16: AC_INIT([libuv], [0.11.26], [https://github.com/joyent/libuv/issues])",
          "",
          "---------------"
        ],
        "include/uv-version.h||include/uv-version.h": [
          "File: include/uv-version.h -> include/uv-version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: #define UV_VERSION_MAJOR 0",
          "34: #define UV_VERSION_MINOR 11",
          "",
          "[Removed Lines]",
          "35: #define UV_VERSION_PATCH 25",
          "36: #define UV_VERSION_IS_RELEASE 1",
          "",
          "[Added Lines]",
          "35: #define UV_VERSION_PATCH 26",
          "36: #define UV_VERSION_IS_RELEASE 0",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "6462eaf4dc194489e810331a3b37aca9f59b8c97",
      "candidate_info": {
        "commit_hash": "6462eaf4dc194489e810331a3b37aca9f59b8c97",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/6462eaf4dc194489e810331a3b37aca9f59b8c97",
        "files": [
          "test/test-tty.c"
        ],
        "message": "test: relax TTY availability assumptions\n\ntest-tty.c currently assumes that a TTY is available to the test runner,\nand fails hard if not. This may not be true on some autobuilding\nenvironment, making the build fail as shown in [0].\nInstead, let's properly skip the test in such cases.\n\n[0] http://ur1.ca/fr5bd\n\nSigned-off-by: Luca Bruno <lucab@debian.org>",
        "before_after_code_files": [
          "test/test-tty.c||test/test-tty.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/41"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "test/test-tty.c||test/test-tty.c": [
          "File: test/test-tty.c -> test/test-tty.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "67:   ttyin_fd = open(\"/dev/tty\", O_RDONLY, 0);",
          "69:     LOGF(\"Cannot open /dev/tty as read-only: %s\\n\", strerror(errno));",
          "71:   ttyout_fd = open(\"/dev/tty\", O_WRONLY, 0);",
          "73:     LOGF(\"Cannot open /dev/tty as write-only: %s\\n\", strerror(errno));",
          "74: #endif",
          "76:   ASSERT(ttyin_fd >= 0);",
          "",
          "[Removed Lines]",
          "68:   if (ttyin_fd < 0)",
          "72:   if (ttyout_fd < 0)",
          "",
          "[Added Lines]",
          "68:   if (ttyin_fd < 0) {",
          "70:     return TEST_SKIP;",
          "71:   }",
          "74:   if (ttyout_fd < 0) {",
          "76:     return TEST_SKIP;",
          "77:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "db1dccb9ecd33d35e1b3b4ff6a9d37828adea974",
      "candidate_info": {
        "commit_hash": "db1dccb9ecd33d35e1b3b4ff6a9d37828adea974",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/db1dccb9ecd33d35e1b3b4ff6a9d37828adea974",
        "files": [
          "src/uv-common.c"
        ],
        "message": "windows: fix missing return value warning\n\nFixes the following warning:\n\n    src\\uv-common.c(476): warning C4715:\n    'uv__getaddrinfo_translate_error' : not all control paths return\n    a value\n\nThe function never returns - the final statement is a call to abort() -\nbut it seems MSVC's program flow analyzer is too weak to figure that\nout.",
        "before_after_code_files": [
          "src/uv-common.c||src/uv-common.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/41"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/uv-common.c||src/uv-common.c": [
          "File: src/uv-common.c -> src/uv-common.c"
        ]
      }
    },
    {
      "candidate_hash": "4661f2d6c0bc9496aa13ce8ec142b4c70ee27592",
      "candidate_info": {
        "commit_hash": "4661f2d6c0bc9496aa13ce8ec142b4c70ee27592",
        "repo": "libuv/libuv",
        "commit_url": "https://github.com/libuv/libuv/commit/4661f2d6c0bc9496aa13ce8ec142b4c70ee27592",
        "files": [
          "ChangeLog",
          "configure.ac",
          "include/uv-version.h"
        ],
        "message": "Now working on v0.11.27",
        "before_after_code_files": [
          "configure.ac||configure.ac",
          "include/uv-version.h||include/uv-version.h"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/libuv/libuv/pull/41"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "configure.ac||configure.ac": [
          "File: configure.ac -> configure.ac",
          "--- Hunk 1 ---",
          "[Context before]",
          "13: # OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.",
          "15: AC_PREREQ(2.57)",
          "17: AC_CONFIG_MACRO_DIR([m4])",
          "18: m4_include([m4/libuv-extra-automake-flags.m4])",
          "19: m4_include([m4/as_case.m4])",
          "",
          "[Removed Lines]",
          "16: AC_INIT([libuv], [0.11.26], [https://github.com/joyent/libuv/issues])",
          "",
          "[Added Lines]",
          "16: AC_INIT([libuv], [0.11.27], [https://github.com/joyent/libuv/issues])",
          "",
          "---------------"
        ],
        "include/uv-version.h||include/uv-version.h": [
          "File: include/uv-version.h -> include/uv-version.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "33: #define UV_VERSION_MAJOR 0",
          "34: #define UV_VERSION_MINOR 11",
          "",
          "[Removed Lines]",
          "35: #define UV_VERSION_PATCH 26",
          "36: #define UV_VERSION_IS_RELEASE 1",
          "",
          "[Added Lines]",
          "35: #define UV_VERSION_PATCH 27",
          "36: #define UV_VERSION_IS_RELEASE 0",
          "",
          "---------------"
        ]
      }
    }
  ]
}