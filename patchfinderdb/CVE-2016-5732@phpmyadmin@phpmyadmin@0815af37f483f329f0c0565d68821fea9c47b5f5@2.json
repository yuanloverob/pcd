{
  "cve_id": "CVE-2016-5732",
  "cve_desc": "Multiple cross-site scripting (XSS) vulnerabilities in the partition-range implementation in templates/table/structure/display_partitions.phtml in the table-structure page in phpMyAdmin 4.6.x before 4.6.3 allow remote attackers to inject arbitrary web script or HTML via crafted table parameters.",
  "repo": "phpmyadmin/phpmyadmin",
  "patch_hash": "0815af37f483f329f0c0565d68821fea9c47b5f5",
  "patch_info": {
    "commit_hash": "0815af37f483f329f0c0565d68821fea9c47b5f5",
    "repo": "phpmyadmin/phpmyadmin",
    "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/0815af37f483f329f0c0565d68821fea9c47b5f5",
    "files": [
      "templates/table/structure/display_partitions.phtml"
    ],
    "message": "Add missing escaping to partition listing\n\nSigned-off-by: Michal \u010ciha\u0159 <michal@cihar.com>",
    "before_after_code_files": [
      "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
    ]
  },
  "patch_diff": {
    "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml": [
      "File: templates/table/structure/display_partitions.phtml -> templates/table/structure/display_partitions.phtml",
      "--- Hunk 1 ---",
      "[Context before]",
      "10:         <?php else: ?>",
      "11:             <p>",
      "12:                 <?= __('Partitioned by:');?>",
      "14:             </p>",
      "15:             <?php if ($hasSubPartitions): ?>",
      "16:                 <p>",
      "17:                     <?= __('Sub partitioned by:'); ?>",
      "19:                 <p>",
      "20:             <?php endif; ?>",
      "21:             <table>",
      "",
      "[Removed Lines]",
      "13:                 <code><?= $partitionMethod , '(' , $partitionExpression , ' )'; ?></code>",
      "18:                     <code><?= $subPartitionMethod , '(' , $subPartitionExpression , ' )'; ?></code>",
      "",
      "[Added Lines]",
      "13:                 <code><?= htmlspecialchars($partitionMethod) , '(' , htmlspecialchars($partitionExpression) , ' )'; ?></code>",
      "18:                     <code><?= htmlspecialchars($subPartitionMethod) , '(' , htmlspecialchars($subPartitionExpression) , ' )'; ?></code>",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "139:             <?php endif; ?>",
      "140:         </form>",
      "141:     </fieldset>",
      "",
      "[Removed Lines]",
      "142: </div>",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "43d24d6d1bf9a5cc03508d5a8e83413b096e1c30",
      "candidate_info": {
        "commit_hash": "43d24d6d1bf9a5cc03508d5a8e83413b096e1c30",
        "repo": "phpmyadmin/phpmyadmin",
        "commit_url": "https://github.com/phpmyadmin/phpmyadmin/commit/43d24d6d1bf9a5cc03508d5a8e83413b096e1c30",
        "files": [
          "templates/table/structure/display_partitions.phtml",
          "templates/table/structure/display_structure.phtml"
        ],
        "message": "Move variable declarations out of view\n\nSigned-off-by: Madhura Jayaratne <madhura.cj@gmail.com>",
        "before_after_code_files": [
          "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml",
          "templates/table/structure/display_structure.phtml||templates/table/structure/display_structure.phtml"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ],
          "candidate": [
            "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml"
          ]
        }
      },
      "candidate_diff": {
        "templates/table/structure/display_partitions.phtml||templates/table/structure/display_partitions.phtml": [
          "File: templates/table/structure/display_partitions.phtml -> templates/table/structure/display_partitions.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "3:         <legend><?php echo __('Partitions')",
          "4:             . PMA_Util::showMySQLDocu('partitioning'); ?>",
          "5:         </legend>",
          "11:         <p>",
          "12:             <?php echo __('Partitioned by:');?>",
          "15:         </p>",
          "16:         <?php if ($hasSubPartitions): ?>",
          "21:             <p>",
          "22:                 <?php echo __('Sub partitioned by:'); ?>",
          "25:             <p>",
          "26:         <?php endif; ?>",
          "27:         <table>",
          "",
          "[Removed Lines]",
          "6:         <?php",
          "7:             $firstPartition = $partitions[0];",
          "8:             $hasSubPartitions = $firstPartition->hasSubPartitions();",
          "9:             $hasDescription = ! empty($firstPartition->getDescription());",
          "10:         ?>",
          "13:             <code><?php echo $firstPartition->getMethod()",
          "14:                 . '(' . $firstPartition->getExpression() . ' )'; ?></code>",
          "17:             <?php",
          "18:                 $subParitions = $firstPartition->getSubPartitions();",
          "19:                 $fristSubParition = $subParitions[0];",
          "20:             ?>",
          "23:                 <code><?php echo $fristSubParition->getMethod()",
          "24:                     . '(' . $fristSubParition->getExpression() . ' )'; ?></code>",
          "",
          "[Added Lines]",
          "8:             <code><?php echo $partitionMethod . '(' . $partitionExpression . ' )'; ?></code>",
          "13:                 <code><?php echo $subPartitionMethod . '(' . $subPartitionExpression . ' )'; ?></code>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "40:             </thead>",
          "41:             <tbody>",
          "42:             <?php $odd = true; ?>",
          "54:             <?php foreach ($partitions as $partition): ?>",
          "55:                 <tr class=\"noclick <?php echo $odd ? 'odd' : 'even'; echo $hasSubPartitions ? ' marked' : '';?>\">",
          "56:                     <?php if ($hasSubPartitions): ?>",
          "",
          "[Removed Lines]",
          "43:             <?php",
          "44:                 $titles = array(",
          "45:                     'ANALYZE' => PMA_Util::getIcon('b_empty.png', __('Analyze')),",
          "46:                     'CHECK' => PMA_Util::getIcon('eye.png', __('Check')),",
          "47:                     'OPTIMIZE' => PMA_Util::getIcon('normalize.png', __('Optimize')),",
          "48:                     'REBUILD' => PMA_Util::getIcon('b_empty.png', __('Rebuild')),",
          "49:                     'REPAIR' => PMA_Util::getIcon('b_tblops.png', __('Repair')),",
          "50:                     'TRUNCATE' => PMA_Util::getIcon('b_empty.png', __('Truncate')),",
          "51:                     'DROP' => PMA_Util::getIcon('b_drop.png', __('Drop'))",
          "52:                 );",
          "53:             ?>",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "83:                         <span><?php echo $value; ?></span>",
          "84:                         <span class=\"unit\"><?php echo $unit; ?></span>",
          "85:                     </td>",
          "87:                         <td>",
          "88:                             <a  href=\"tbl_structure.php<?php echo $url_query; ?>&amp;partition_maintenance=1&amp;sql_query=<?php echo urlencode(",
          "90:                                 ) ?>\"",
          "93:                                 class=\"ajax\"",
          "94:                             >",
          "96:                             </a>",
          "97:                         </td>",
          "98:                     <?php endforeach; ?>",
          "",
          "[Removed Lines]",
          "86:                     <?php foreach ($titles as $operation => $title): ?>",
          "89:                                     \"ALTER TABLE \" . PMA_Util::backquote($table) . $operation . \" PARTITION \" . $partition->getName()",
          "91:                                 id=\"partition_action_<?php echo $operation; ?>\"",
          "92:                                 name=\"partition_action_<?php echo $operation; ?>\"",
          "95:                                 <?php echo $title; ?>",
          "",
          "[Added Lines]",
          "64:                     <?php foreach ($actionIcons as $action => $icon): ?>",
          "67:                                     \"ALTER TABLE \" . PMA_Util::backquote($table) . $action . \" PARTITION \" . $partition->getName()",
          "69:                                 id=\"partition_action_<?php echo $action; ?>\"",
          "70:                                 name=\"partition_action_<?php echo $action; ?>\"",
          "73:                                 <?php echo $icon; ?>",
          "",
          "---------------"
        ],
        "templates/table/structure/display_structure.phtml||templates/table/structure/display_structure.phtml": [
          "File: templates/table/structure/display_structure.phtml -> templates/table/structure/display_structure.phtml",
          "--- Hunk 1 ---",
          "[Context before]",
          "164: <!--Display partition details-->",
          "165: <?php",
          "166: $partition_names = PMA_Partition::getPartitionNames($db, $table);",
          "168: if (! is_null($partition_names[0])) {",
          "169:     echo PMA\\Template::get('table/structure/display_partitions')->render(",
          "170:         array(",
          "171:             'table' => $table,",
          "172:             'url_query'  => $url_query,",
          "174:         )",
          "175:     );",
          "176: }",
          "",
          "[Removed Lines]",
          "173:             'partitions' => PMA_Partition::getParititions($db, $table),",
          "",
          "[Added Lines]",
          "170:     $partitions = PMA_Partition::getParititions($db, $table);",
          "171:     $firstPartition = $partitions[0];",
          "172:     $subParitions = $firstPartition->getSubPartitions();",
          "173:     $hasSubPartitions = $firstPartition->hasSubPartitions();",
          "174:     if ($hasSubPartitions) {",
          "175:         $firstSubPartition = $subParitions[0];",
          "176:     }",
          "178:     $actionIcons = array(",
          "179:         'ANALYZE' => PMA_Util::getIcon('b_empty.png', __('Analyze')),",
          "180:         'CHECK' => PMA_Util::getIcon('eye.png', __('Check')),",
          "181:         'OPTIMIZE' => PMA_Util::getIcon('normalize.png', __('Optimize')),",
          "182:         'REBUILD' => PMA_Util::getIcon('b_empty.png', __('Rebuild')),",
          "183:         'REPAIR' => PMA_Util::getIcon('b_tblops.png', __('Repair')),",
          "184:         'TRUNCATE' => PMA_Util::getIcon('b_empty.png', __('Truncate')),",
          "185:         'DROP' => PMA_Util::getIcon('b_drop.png', __('Drop'))",
          "186:     );",
          "192:             'partitions' => $partitions,",
          "193:             'partitionMethod' => $firstPartition->getMethod(),",
          "194:             'partitionExpression' => $firstPartition->getExpression(),",
          "195:             'hasDescription' => ! empty($firstPartition->getDescription()),",
          "196:             'hasSubPartitions' => $hasSubPartitions,",
          "197:             'subPartitionMethod' => $hasSubPartitions ? $firstSubPartition->getMethod() : null,",
          "198:             'subPartitionExpression' => $hasSubPartitions ? $firstSubPartition->getExpression() : null,",
          "199:             'actionIcons' => $actionIcons,",
          "",
          "---------------"
        ]
      }
    }
  ]
}