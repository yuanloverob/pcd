{
  "cve_id": "CVE-2020-11722",
  "cve_desc": "Dungeon Crawl Stone Soup (aka DCSS or crawl) before 0.25 allows remote attackers to execute arbitrary code via Lua bytecode embedded in an uploaded .crawlrc file.",
  "repo": "crawl/crawl",
  "patch_hash": "fc522ff6eb1bbb85e3de60c60a45762571e48c28",
  "patch_info": {
    "commit_hash": "fc522ff6eb1bbb85e3de60c60a45762571e48c28",
    "repo": "crawl/crawl",
    "commit_url": "https://github.com/crawl/crawl/commit/fc522ff6eb1bbb85e3de60c60a45762571e48c28",
    "files": [
      "crawl-ref/source/clua.cc"
    ],
    "message": "Disable lua load(), loadstring() bytcode loading",
    "before_after_code_files": [
      "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
    ]
  },
  "patch_diff": {
    "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
      "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "304:     while (!f.eof())",
      "305:         script += f.get_line() + \"\\n\";",
      "308:     return luaL_loadbuffer(ls, &script[0], script.length(),",
      "309:                            (\"@\" + file).c_str());",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "307:     if (script[0] == 0x1b)",
      "308:         abort();",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "797:     lua_pushcfunction(_state, lua_loadstring);",
      "798:     lua_setglobal(_state, \"loadstring\");",
      "801:     cluaopen_kills(_state);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "802:     lua_pushnil(_state);",
      "803:     lua_setglobal(_state, \"load\");",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "3d82e3a98a09ad8f81572e5d26dab04ffd7735aa",
      "candidate_info": {
        "commit_hash": "3d82e3a98a09ad8f81572e5d26dab04ffd7735aa",
        "repo": "crawl/crawl",
        "commit_url": "https://github.com/crawl/crawl/commit/3d82e3a98a09ad8f81572e5d26dab04ffd7735aa",
        "files": [
          "crawl-ref/source/clua.cc"
        ],
        "message": "Disable lua load(), loadstring() bytcode loading\n\n(cherry picked from commit fc522ff6eb1bbb85e3de60c60a45762571e48c28)",
        "before_after_code_files": [
          "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ],
          "candidate": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ]
        }
      },
      "candidate_diff": {
        "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
          "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "251:     while (!f.eof())",
          "252:         script += f.get_line() + \"\\n\";",
          "255:     return luaL_loadbuffer(ls, &script[0], script.length(),",
          "256:                            (\"@\" + file).c_str());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "254:     if (script[0] == 0x1b)",
          "255:         abort();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "661:     lua_pushcfunction(_state, lua_loadstring);",
          "662:     lua_setglobal(_state, \"loadstring\");",
          "665:     cluaopen_kills(_state);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "666:     lua_pushnil(_state);",
          "667:     lua_setglobal(_state, \"load\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e1a6273f384ed710cea30f5b5e5d46b56a1bbe0e",
      "candidate_info": {
        "commit_hash": "e1a6273f384ed710cea30f5b5e5d46b56a1bbe0e",
        "repo": "crawl/crawl",
        "commit_url": "https://github.com/crawl/crawl/commit/e1a6273f384ed710cea30f5b5e5d46b56a1bbe0e",
        "files": [
          "crawl-ref/source/clua.cc"
        ],
        "message": "Disable lua load(), loadstring() bytcode loading\n\n(cherry picked from commit fc522ff6eb1bbb85e3de60c60a45762571e48c28)",
        "before_after_code_files": [
          "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ],
          "candidate": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ]
        }
      },
      "candidate_diff": {
        "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
          "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "314:     while (!f.eof())",
          "315:         script += f.get_line() + \"\\n\";",
          "318:     return luaL_loadbuffer(ls, &script[0], script.length(),",
          "319:                            (\"@\" + file).c_str());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "317:     if (script[0] == 0x1b)",
          "318:         abort();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "774:     lua_pushcfunction(_state, lua_loadstring);",
          "775:     lua_setglobal(_state, \"loadstring\");",
          "778:     cluaopen_kills(_state);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "779:     lua_pushnil(_state);",
          "780:     lua_setglobal(_state, \"load\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "74d1fa498536ccb9628d74057db7e4005a21d1d4",
      "candidate_info": {
        "commit_hash": "74d1fa498536ccb9628d74057db7e4005a21d1d4",
        "repo": "crawl/crawl",
        "commit_url": "https://github.com/crawl/crawl/commit/74d1fa498536ccb9628d74057db7e4005a21d1d4",
        "files": [
          "crawl-ref/source/clua.cc"
        ],
        "message": "Disable lua load(), loadstring() bytcode loading\n\n(cherry picked from commit fc522ff6eb1bbb85e3de60c60a45762571e48c28)",
        "before_after_code_files": [
          "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ],
          "candidate": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ]
        }
      },
      "candidate_diff": {
        "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
          "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "262:     while (!f.eof())",
          "263:         script += f.get_line() + \"\\n\";",
          "266:     return luaL_loadbuffer(ls, &script[0], script.length(),",
          "267:                            (\"@\" + file).c_str());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "265:     if (script[0] == 0x1b)",
          "266:         abort();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "704:     lua_pushcfunction(_state, lua_loadstring);",
          "705:     lua_setglobal(_state, \"loadstring\");",
          "708:     cluaopen_kills(_state);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "709:     lua_pushnil(_state);",
          "710:     lua_setglobal(_state, \"load\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "faa3be8cc35396b58ca93b2137b25a451f3ba5c6",
      "candidate_info": {
        "commit_hash": "faa3be8cc35396b58ca93b2137b25a451f3ba5c6",
        "repo": "crawl/crawl",
        "commit_url": "https://github.com/crawl/crawl/commit/faa3be8cc35396b58ca93b2137b25a451f3ba5c6",
        "files": [
          "crawl-ref/source/clua.cc"
        ],
        "message": "Disable lua load(), loadstring() bytcode loading\n\n(cherry picked from commit fc522ff6eb1bbb85e3de60c60a45762571e48c28)",
        "before_after_code_files": [
          "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ],
          "candidate": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ]
        }
      },
      "candidate_diff": {
        "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
          "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "252:     while (!f.eof())",
          "253:         script += f.get_line() + \"\\n\";",
          "256:     return luaL_loadbuffer(ls, &script[0], script.length(),",
          "257:                            (\"@\" + file).c_str());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "255:     if (script[0] == 0x1b)",
          "256:         abort();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "664:     lua_pushcfunction(_state, lua_loadstring);",
          "665:     lua_setglobal(_state, \"loadstring\");",
          "668:     cluaopen_kills(_state);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "669:     lua_pushnil(_state);",
          "670:     lua_setglobal(_state, \"load\");",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4af34eaf8e1457a0eebf232db768bf9d29957840",
      "candidate_info": {
        "commit_hash": "4af34eaf8e1457a0eebf232db768bf9d29957840",
        "repo": "crawl/crawl",
        "commit_url": "https://github.com/crawl/crawl/commit/4af34eaf8e1457a0eebf232db768bf9d29957840",
        "files": [
          "crawl-ref/source/clua.cc"
        ],
        "message": "Disable lua load(), loadstring() bytcode loading\n\n(cherry picked from commit fc522ff6eb1bbb85e3de60c60a45762571e48c28)",
        "before_after_code_files": [
          "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ],
          "candidate": [
            "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc"
          ]
        }
      },
      "candidate_diff": {
        "crawl-ref/source/clua.cc||crawl-ref/source/clua.cc": [
          "File: crawl-ref/source/clua.cc -> crawl-ref/source/clua.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "315:     while (!f.eof())",
          "316:         script += f.get_line() + \"\\n\";",
          "319:     return luaL_loadbuffer(ls, &script[0], script.length(),",
          "320:                            (\"@\" + file).c_str());",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "318:     if (script[0] == 0x1b)",
          "319:         abort();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "775:     lua_pushcfunction(_state, lua_loadstring);",
          "776:     lua_setglobal(_state, \"loadstring\");",
          "779:     cluaopen_kills(_state);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "780:     lua_pushnil(_state);",
          "781:     lua_setglobal(_state, \"load\");",
          "",
          "---------------"
        ]
      }
    }
  ]
}