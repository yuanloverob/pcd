{
  "cve_id": "CVE-2021-29588",
  "cve_desc": "TensorFlow is an end-to-end open source platform for machine learning. The optimized implementation of the `TransposeConv` TFLite operator is [vulnerable to a division by zero error](https://github.com/tensorflow/tensorflow/blob/0d45ea1ca641b21b73bcf9c00e0179cda284e7e7/tensorflow/lite/kernels/internal/optimized/optimized_ops.h#L5221-L5222). An attacker can craft a model such that `stride_{h,w}` values are 0. Code calling this function must validate these arguments. The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "801c1c6be5324219689c98e1bd3e0ca365ee834d",
  "patch_info": {
    "commit_hash": "801c1c6be5324219689c98e1bd3e0ca365ee834d",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/801c1c6be5324219689c98e1bd3e0ca365ee834d",
    "files": [
      "tensorflow/lite/kernels/transpose_conv.cc"
    ],
    "message": "Fix another division by 0 in TFLite\n\nPiperOrigin-RevId: 370800181\nChange-Id: I924809166a6131f5075e6d45c455106538d755f9",
    "before_after_code_files": [
      "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc": [
      "File: tensorflow/lite/kernels/transpose_conv.cc -> tensorflow/lite/kernels/transpose_conv.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "591:   const auto* params =",
      "592:       reinterpret_cast<TfLiteTransposeConvParams*>(node->builtin_data);",
      "595:   if (IsDynamicTensor(output)) {",
      "596:     TF_LITE_ENSURE_OK(context, ResizeTensor(context, output_shape, output));",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "595:   TF_LITE_ENSURE(context, params->stride_height > 0);",
      "596:   TF_LITE_ENSURE(context, params->stride_width > 0);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "5a473c58eceecb9fcf1f9cb5bb411ca3a20aa071",
      "candidate_info": {
        "commit_hash": "5a473c58eceecb9fcf1f9cb5bb411ca3a20aa071",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/5a473c58eceecb9fcf1f9cb5bb411ca3a20aa071",
        "files": [
          "tensorflow/lite/kernels/transpose_conv.cc"
        ],
        "message": "Fix another division by 0 in TFLite\n\nPiperOrigin-RevId: 370800181\nChange-Id: I924809166a6131f5075e6d45c455106538d755f9",
        "before_after_code_files": [
          "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc": [
          "File: tensorflow/lite/kernels/transpose_conv.cc -> tensorflow/lite/kernels/transpose_conv.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "392:   const auto* params =",
          "393:       reinterpret_cast<TfLiteTransposeConvParams*>(node->builtin_data);",
          "396:   if (IsDynamicTensor(output)) {",
          "397:     TF_LITE_ENSURE_OK(context, ResizeTensor(context, output_shape, output));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "396:   TF_LITE_ENSURE(context, params->stride_height > 0);",
          "397:   TF_LITE_ENSURE(context, params->stride_width > 0);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "643a8b97a2050e141ec826ff3268eee6dfbaf047",
      "candidate_info": {
        "commit_hash": "643a8b97a2050e141ec826ff3268eee6dfbaf047",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/643a8b97a2050e141ec826ff3268eee6dfbaf047",
        "files": [
          "tensorflow/lite/kernels/transpose_conv.cc"
        ],
        "message": "Fix another division by 0 in TFLite\n\nPiperOrigin-RevId: 370800181\nChange-Id: I924809166a6131f5075e6d45c455106538d755f9",
        "before_after_code_files": [
          "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc": [
          "File: tensorflow/lite/kernels/transpose_conv.cc -> tensorflow/lite/kernels/transpose_conv.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "492:   const auto* params =",
          "493:       reinterpret_cast<TfLiteTransposeConvParams*>(node->builtin_data);",
          "496:   if (IsDynamicTensor(output)) {",
          "497:     TF_LITE_ENSURE_OK(context, ResizeTensor(context, output_shape, output));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "496:   TF_LITE_ENSURE(context, params->stride_height > 0);",
          "497:   TF_LITE_ENSURE(context, params->stride_width > 0);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4cca125bcd80fd74df651b6e857719b4d2ac04af",
      "candidate_info": {
        "commit_hash": "4cca125bcd80fd74df651b6e857719b4d2ac04af",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/4cca125bcd80fd74df651b6e857719b4d2ac04af",
        "files": [
          "tensorflow/lite/kernels/transpose_conv.cc"
        ],
        "message": "Fix another division by 0 in TFLite\n\nPiperOrigin-RevId: 370800181\nChange-Id: I924809166a6131f5075e6d45c455106538d755f9",
        "before_after_code_files": [
          "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc": [
          "File: tensorflow/lite/kernels/transpose_conv.cc -> tensorflow/lite/kernels/transpose_conv.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "591:   const auto* params =",
          "592:       reinterpret_cast<TfLiteTransposeConvParams*>(node->builtin_data);",
          "595:   if (IsDynamicTensor(output)) {",
          "596:     TF_LITE_ENSURE_OK(context, ResizeTensor(context, output_shape, output));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "595:   TF_LITE_ENSURE(context, params->stride_height > 0);",
          "596:   TF_LITE_ENSURE(context, params->stride_width > 0);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "0d014d8cb18e405d8b27ba844dd8a02adfd6bbc9",
      "candidate_info": {
        "commit_hash": "0d014d8cb18e405d8b27ba844dd8a02adfd6bbc9",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/0d014d8cb18e405d8b27ba844dd8a02adfd6bbc9",
        "files": [
          "tensorflow/lite/kernels/transpose_conv.cc"
        ],
        "message": "Fix another division by 0 in TFLite\n\nPiperOrigin-RevId: 370800181\nChange-Id: I924809166a6131f5075e6d45c455106538d755f9",
        "before_after_code_files": [
          "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc": [
          "File: tensorflow/lite/kernels/transpose_conv.cc -> tensorflow/lite/kernels/transpose_conv.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "590:   const auto* params =",
          "591:       reinterpret_cast<TfLiteTransposeConvParams*>(node->builtin_data);",
          "594:   if (IsDynamicTensor(output)) {",
          "595:     TF_LITE_ENSURE_OK(context, ResizeTensor(context, output_shape, output));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "594:   TF_LITE_ENSURE(context, params->stride_height > 0);",
          "595:   TF_LITE_ENSURE(context, params->stride_width > 0);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bb8bdb05722ced7f074e761bd1ba477520b5b9e1",
      "candidate_info": {
        "commit_hash": "bb8bdb05722ced7f074e761bd1ba477520b5b9e1",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/bb8bdb05722ced7f074e761bd1ba477520b5b9e1",
        "files": [
          "tensorflow/lite/kernels/transpose_conv.cc"
        ],
        "message": "Fix another division by 0 in TFLite\n\nPiperOrigin-RevId: 370800181\nChange-Id: I924809166a6131f5075e6d45c455106538d755f9",
        "before_after_code_files": [
          "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
          ],
          "candidate": [
            "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/lite/kernels/transpose_conv.cc||tensorflow/lite/kernels/transpose_conv.cc": [
          "File: tensorflow/lite/kernels/transpose_conv.cc -> tensorflow/lite/kernels/transpose_conv.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "573:   const auto* params =",
          "574:       reinterpret_cast<TfLiteTransposeConvParams*>(node->builtin_data);",
          "577:   if (IsDynamicTensor(output)) {",
          "578:     TF_LITE_ENSURE_OK(context, ResizeTensor(context, output_shape, output));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "577:   TF_LITE_ENSURE(context, params->stride_height > 0);",
          "578:   TF_LITE_ENSURE(context, params->stride_width > 0);",
          "",
          "---------------"
        ]
      }
    }
  ]
}