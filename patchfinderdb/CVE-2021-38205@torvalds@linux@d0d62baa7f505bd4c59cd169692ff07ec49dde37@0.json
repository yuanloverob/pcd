{
  "cve_id": "CVE-2021-38205",
  "cve_desc": "drivers/net/ethernet/xilinx/xilinx_emaclite.c in the Linux kernel before 5.13.3 makes it easier for attackers to defeat an ASLR protection mechanism because it prints a kernel pointer (i.e., the real IOMEM pointer).",
  "repo": "torvalds/linux",
  "patch_hash": "d0d62baa7f505bd4c59cd169692ff07ec49dde37",
  "patch_info": {
    "commit_hash": "d0d62baa7f505bd4c59cd169692ff07ec49dde37",
    "repo": "torvalds/linux",
    "commit_url": "https://github.com/torvalds/linux/commit/d0d62baa7f505bd4c59cd169692ff07ec49dde37",
    "files": [
      "drivers/net/ethernet/xilinx/xilinx_emaclite.c"
    ],
    "message": "net: xilinx_emaclite: Do not print real IOMEM pointer\n\nPrinting kernel pointers is discouraged because they might leak kernel\nmemory layout.  This fixes smatch warning:\n\ndrivers/net/ethernet/xilinx/xilinx_emaclite.c:1191 xemaclite_of_probe() warn:\n argument 4 to %08lX specifier is cast from pointer\n\nSigned-off-by: YueHaibing <yuehaibing@huawei.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
    "before_after_code_files": [
      "drivers/net/ethernet/xilinx/xilinx_emaclite.c||drivers/net/ethernet/xilinx/xilinx_emaclite.c"
    ]
  },
  "patch_diff": {
    "drivers/net/ethernet/xilinx/xilinx_emaclite.c||drivers/net/ethernet/xilinx/xilinx_emaclite.c": [
      "File: drivers/net/ethernet/xilinx/xilinx_emaclite.c -> drivers/net/ethernet/xilinx/xilinx_emaclite.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "1189:  }",
      "1191:  dev_info(dev,",
      "1195:  return 0;",
      "1197: error:",
      "",
      "[Removed Lines]",
      "1192:    \"Xilinx EmacLite at 0x%08lX mapped to 0x%08lX, irq=%d\\n\",",
      "1193:    (unsigned long __force)ndev->mem_start,",
      "1194:    (unsigned long __force)lp->base_addr, ndev->irq);",
      "",
      "[Added Lines]",
      "1192:    \"Xilinx EmacLite at 0x%08lX mapped to 0x%p, irq=%d\\n\",",
      "1193:    (unsigned long __force)ndev->mem_start, lp->base_addr, ndev->irq);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "18af77c50fede5b3fc22aa9f0a9b255a5c5285c9",
      "candidate_info": {
        "commit_hash": "18af77c50fede5b3fc22aa9f0a9b255a5c5285c9",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/18af77c50fede5b3fc22aa9f0a9b255a5c5285c9",
        "files": [
          "drivers/net/ethernet/xilinx/Kconfig",
          "drivers/net/ethernet/xilinx/xilinx_emaclite.c"
        ],
        "message": "drivers: net: xilinx_emaclite: remove arch limitation\n\nThe changes made in eccd540 is enough for xilinx_emaclite to run\nwithout problem on 64-bit systems. I have tested it on a Xilinx\nFPGA with RV64 softcore. The architecture limitation in Kconfig\nseems no longer necessary.\n\nA small change is included to print address with %lx instead of\ncasting to int and print with %x.\n\nSigned-off-by: Gary Guo <gary@garyguo.net>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
        "before_after_code_files": [
          "drivers/net/ethernet/xilinx/xilinx_emaclite.c||drivers/net/ethernet/xilinx/xilinx_emaclite.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "drivers/net/ethernet/xilinx/xilinx_emaclite.c||drivers/net/ethernet/xilinx/xilinx_emaclite.c"
          ],
          "candidate": [
            "drivers/net/ethernet/xilinx/xilinx_emaclite.c||drivers/net/ethernet/xilinx/xilinx_emaclite.c"
          ]
        }
      },
      "candidate_diff": {
        "drivers/net/ethernet/xilinx/xilinx_emaclite.c||drivers/net/ethernet/xilinx/xilinx_emaclite.c": [
          "File: drivers/net/ethernet/xilinx/xilinx_emaclite.c -> drivers/net/ethernet/xilinx/xilinx_emaclite.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1193:  }",
          "1195:  dev_info(dev,",
          "1198:    (unsigned long __force)lp->base_addr, ndev->irq);",
          "1199:  return 0;",
          "",
          "[Removed Lines]",
          "1196:    \"Xilinx EmacLite at 0x%08X mapped to 0x%08lX, irq=%d\\n\",",
          "1197:    (unsigned int __force)ndev->mem_start,",
          "",
          "[Added Lines]",
          "1196:    \"Xilinx EmacLite at 0x%08lX mapped to 0x%08lX, irq=%d\\n\",",
          "1197:    (unsigned long __force)ndev->mem_start,",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "eccd5403814b4e762e270ef0464bb86fb217b1bf",
      "candidate_info": {
        "commit_hash": "eccd5403814b4e762e270ef0464bb86fb217b1bf",
        "repo": "torvalds/linux",
        "commit_url": "https://github.com/torvalds/linux/commit/eccd5403814b4e762e270ef0464bb86fb217b1bf",
        "files": [
          "drivers/net/ethernet/xilinx/xilinx_emaclite.c"
        ],
        "message": "drivers: net: xilinx_emaclite: Fix -Wpointer-to-int-cast warnings with W=1\n\ndrivers/net/ethernet//xilinx/xilinx_emaclite.c:341:35: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]\n  341 |   addr = (void __iomem __force *)((u32 __force)addr ^\n\nUse uintptr_t instead of u32 to avoid problems on 64 bit systems.\n\nAlso, cast the address to an unsigned long for printing.\n\nSigned-off-by: Andrew Lunn <andrew@lunn.ch>\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
        "before_after_code_files": [
          "drivers/net/ethernet/xilinx/xilinx_emaclite.c||drivers/net/ethernet/xilinx/xilinx_emaclite.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "drivers/net/ethernet/xilinx/xilinx_emaclite.c||drivers/net/ethernet/xilinx/xilinx_emaclite.c"
          ],
          "candidate": [
            "drivers/net/ethernet/xilinx/xilinx_emaclite.c||drivers/net/ethernet/xilinx/xilinx_emaclite.c"
          ]
        }
      },
      "candidate_diff": {
        "drivers/net/ethernet/xilinx/xilinx_emaclite.c||drivers/net/ethernet/xilinx/xilinx_emaclite.c": [
          "File: drivers/net/ethernet/xilinx/xilinx_emaclite.c -> drivers/net/ethernet/xilinx/xilinx_emaclite.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "97: #define ALIGNMENT  4",
          "102: #ifdef __BIG_ENDIAN",
          "103: #define xemaclite_readl  ioread32be",
          "",
          "[Removed Lines]",
          "100: #define BUFFER_ALIGN(adr) ((ALIGNMENT - ((u32)adr)) % ALIGNMENT)",
          "",
          "[Added Lines]",
          "100: #define BUFFER_ALIGN(adr) ((ALIGNMENT - ((uintptr_t)adr)) % ALIGNMENT)",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "342:        XEL_BUFFER_OFFSET);",
          "343:   reg_data = xemaclite_readl(addr + XEL_TSR_OFFSET);",
          "",
          "[Removed Lines]",
          "341:   addr = (void __iomem __force *)((u32 __force)addr ^",
          "",
          "[Added Lines]",
          "341:   addr = (void __iomem __force *)((uintptr_t __force)addr ^",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "401:   if (drvdata->rx_ping_pong != 0)",
          "404:   else",
          "",
          "[Removed Lines]",
          "402:    addr = (void __iomem __force *)((u32 __force)addr ^",
          "403:         XEL_BUFFER_OFFSET);",
          "",
          "[Added Lines]",
          "402:    addr = (void __iomem __force *)",
          "403:     ((uintptr_t __force)addr ^",
          "404:      XEL_BUFFER_OFFSET);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1192:  }",
          "1194:  dev_info(dev,",
          "1196:    (unsigned int __force)ndev->mem_start,",
          "1198:  return 0;",
          "1200: error:",
          "",
          "[Removed Lines]",
          "1195:    \"Xilinx EmacLite at 0x%08X mapped to 0x%08X, irq=%d\\n\",",
          "1197:    (unsigned int __force)lp->base_addr, ndev->irq);",
          "",
          "[Added Lines]",
          "1196:    \"Xilinx EmacLite at 0x%08X mapped to 0x%08lX, irq=%d\\n\",",
          "1198:    (unsigned long __force)lp->base_addr, ndev->irq);",
          "",
          "---------------"
        ]
      }
    }
  ]
}