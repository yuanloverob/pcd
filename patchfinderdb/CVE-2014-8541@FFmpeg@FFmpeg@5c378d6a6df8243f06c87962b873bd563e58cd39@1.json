{
  "cve_id": "CVE-2014-8541",
  "cve_desc": "libavcodec/mjpegdec.c in FFmpeg before 2.4.2 considers only dimension differences, and not bits-per-pixel differences, when determining whether an image size has changed, which allows remote attackers to cause a denial of service (out-of-bounds access) or possibly have unspecified other impact via crafted MJPEG data.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "5c378d6a6df8243f06c87962b873bd563e58cd39",
  "patch_info": {
    "commit_hash": "5c378d6a6df8243f06c87962b873bd563e58cd39",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/5c378d6a6df8243f06c87962b873bd563e58cd39",
    "files": [
      "libavcodec/mjpegdec.c"
    ],
    "message": "avcodec/mjpegdec: check bits per pixel for changes similar to dimensions\n\nFixes out of array accesses\nFixes: asan_heap-oob_16668e9_2_asan_heap-oob_16668e9_346_miss_congeniality_pegasus_mjpg.avi\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
    ]
  },
  "patch_diff": {
    "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c": [
      "File: libavcodec/mjpegdec.c -> libavcodec/mjpegdec.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "245: int ff_mjpeg_decode_sof(MJpegDecodeContext *s)",
      "246: {",
      "248:     int h_count[MAX_COMPONENTS];",
      "249:     int v_count[MAX_COMPONENTS];",
      "",
      "[Removed Lines]",
      "247:     int len, nb_components, i, width, height, pix_fmt_id, ret;",
      "",
      "[Added Lines]",
      "247:     int len, nb_components, i, width, height, bits, pix_fmt_id, ret;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "255:     len     = get_bits(&s->gb, 16);",
      "256:     s->avctx->bits_per_raw_sample =",
      "259:     if (s->pegasus_rct)",
      "262:         s->rct  = 1;    // FIXME ugly",
      "264:     if(s->lossless && s->avctx->lowres){",
      "",
      "[Removed Lines]",
      "257:     s->bits = get_bits(&s->gb, 8);",
      "260:         s->bits = 9;",
      "261:     if (s->bits == 9 && !s->pegasus_rct)",
      "",
      "[Added Lines]",
      "257:     bits = get_bits(&s->gb, 8);",
      "260:         bits = 9;",
      "261:     if (bits == 9 && !s->pegasus_rct)",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "291:             return AVERROR_INVALIDDATA;",
      "292:         }",
      "293:     }",
      "295:         avpriv_report_missing_feature(s->avctx,",
      "296:                                       \"JPEG-LS that is not <= 8 \"",
      "297:                                       \"bits/component or 16-bit gray\");",
      "",
      "[Removed Lines]",
      "294:     if (s->ls && !(s->bits <= 8 || nb_components == 1)) {",
      "",
      "[Added Lines]",
      "294:     if (s->ls && !(bits <= 8 || nb_components == 1)) {",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "339:     if (   width != s->width || height != s->height",
      "340:         || memcmp(s->h_count, h_count, sizeof(h_count))",
      "341:         || memcmp(s->v_count, v_count, sizeof(v_count))) {",
      "343:         s->width      = width;",
      "344:         s->height     = height;",
      "345:         memcpy(s->h_count, h_count, sizeof(h_count));",
      "346:         memcpy(s->v_count, v_count, sizeof(v_count));",
      "347:         s->interlaced = 0;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "340:         || bits != s->bits",
      "346:         s->bits       = bits;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "b5e661bcd2bb4fe771cb2c1e21215c68e6a17665",
      "candidate_info": {
        "commit_hash": "b5e661bcd2bb4fe771cb2c1e21215c68e6a17665",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/b5e661bcd2bb4fe771cb2c1e21215c68e6a17665",
        "files": [
          "libavcodec/mjpegdec.c"
        ],
        "message": "avcodec/mjpegdec: check bits per pixel for changes similar to dimensions\n\nFixes out of array accesses\nFixes: asan_heap-oob_16668e9_2_asan_heap-oob_16668e9_346_miss_congeniality_pegasus_mjpg.avi\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 5c378d6a6df8243f06c87962b873bd563e58cd39)\n\nConflicts:\n\n\tlibavcodec/mjpegdec.c\n(cherry picked from commit 94371a404c663c3dae3d542fa43951567ab67f82)\n\nConflicts:\n\n\tlibavcodec/mjpegdec.c\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
          ],
          "candidate": [
            "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c": [
          "File: libavcodec/mjpegdec.c -> libavcodec/mjpegdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "213: int ff_mjpeg_decode_sof(MJpegDecodeContext *s)",
          "214: {",
          "218:     len = get_bits(&s->gb, 16);",
          "225:         av_log(s->avctx, AV_LOG_ERROR, \"only 8 bits/component accepted\\n\");",
          "226:         return -1;",
          "227:     }",
          "",
          "[Removed Lines]",
          "215:     int len, nb_components, i, width, height, pix_fmt_id;",
          "219:     s->bits= get_bits(&s->gb, 8);",
          "221:     if(s->pegasus_rct) s->bits=9;",
          "222:     if(s->bits==9 && !s->pegasus_rct) s->rct=1;    //FIXME ugly",
          "224:     if (s->bits != 8 && !s->lossless){",
          "",
          "[Added Lines]",
          "215:     int len, nb_components, i, width, height, bits, pix_fmt_id;",
          "219:     bits= get_bits(&s->gb, 8);",
          "221:     if(s->pegasus_rct) bits=9;",
          "222:     if(bits==9 && !s->pegasus_rct) s->rct=1;    //FIXME ugly",
          "224:     if (bits != 8 && !s->lossless){",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "241:     if (nb_components <= 0 ||",
          "242:         nb_components > MAX_COMPONENTS)",
          "243:         return -1;",
          "245:         av_log(s->avctx, AV_LOG_ERROR, \"only <= 8 bits/component or 16-bit gray accepted for JPEG-LS\\n\");",
          "246:         return -1;",
          "247:     }",
          "",
          "[Removed Lines]",
          "244:     if (s->ls && !(s->bits <= 8 || nb_components == 1)){",
          "",
          "[Added Lines]",
          "244:     if (s->ls && !(bits <= 8 || nb_components == 1)){",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "278:         av_freep(&s->qscale_table);",
          "280:         s->width = width;",
          "281:         s->height = height;",
          "282:         s->interlaced = 0;",
          "",
          "[Removed Lines]",
          "277:     if (width != s->width || height != s->height) {",
          "",
          "[Added Lines]",
          "277:     if (   width != s->width || height != s->height",
          "278:         || bits != s->bits",
          "279:        ) {",
          "284:         s->bits       = bits;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "29abba35723ad6ce481dfe277dad6d0575f2dbb6",
      "candidate_info": {
        "commit_hash": "29abba35723ad6ce481dfe277dad6d0575f2dbb6",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/29abba35723ad6ce481dfe277dad6d0575f2dbb6",
        "files": [
          "libavcodec/mjpegdec.c"
        ],
        "message": "avcodec/mjpegdec: check bits per pixel for changes similar to dimensions\n\nFixes out of array accesses\nFixes: asan_heap-oob_16668e9_2_asan_heap-oob_16668e9_346_miss_congeniality_pegasus_mjpg.avi\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 5c378d6a6df8243f06c87962b873bd563e58cd39)\n\nConflicts:\n\n\tlibavcodec/mjpegdec.c\n(cherry picked from commit 94371a404c663c3dae3d542fa43951567ab67f82)\n\nConflicts:\n\n\tlibavcodec/mjpegdec.c",
        "before_after_code_files": [
          "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
          ],
          "candidate": [
            "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c": [
          "File: libavcodec/mjpegdec.c -> libavcodec/mjpegdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "212: int ff_mjpeg_decode_sof(MJpegDecodeContext *s)",
          "213: {",
          "215:     int h_count[MAX_COMPONENTS];",
          "216:     int v_count[MAX_COMPONENTS];",
          "",
          "[Removed Lines]",
          "214:     int len, nb_components, i, width, height, pix_fmt_id;",
          "",
          "[Added Lines]",
          "214:     int len, nb_components, i, width, height, bits, pix_fmt_id;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "222:     len     = get_bits(&s->gb, 16);",
          "225:     if (s->pegasus_rct)",
          "228:         s->rct  = 1;    // FIXME ugly",
          "231:         av_log(s->avctx, AV_LOG_ERROR, \"only 8 bits/component accepted\\n\");",
          "232:         return -1;",
          "233:     }",
          "",
          "[Removed Lines]",
          "223:     s->bits = get_bits(&s->gb, 8);",
          "226:         s->bits = 9;",
          "227:     if (s->bits == 9 && !s->pegasus_rct)",
          "230:     if (s->bits != 8 && !s->lossless) {",
          "",
          "[Added Lines]",
          "223:     bits = get_bits(&s->gb, 8);",
          "226:         bits = 9;",
          "227:     if (bits == 9 && !s->pegasus_rct)",
          "230:     if (bits != 8 && !s->lossless) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "259:             return AVERROR_INVALIDDATA;",
          "260:         }",
          "261:     }",
          "263:         av_log_missing_feature(s->avctx,",
          "264:                                \"For JPEG-LS anything except <= 8 bits/component\"",
          "265:                                \" or 16-bit gray\", 0);",
          "",
          "[Removed Lines]",
          "262:     if (s->ls && !(s->bits <= 8 || nb_components == 1)) {",
          "",
          "[Added Lines]",
          "262:     if (s->ls && !(bits <= 8 || nb_components == 1)) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "309:     if (   width != s->width || height != s->height",
          "310:         || memcmp(s->h_count, h_count, sizeof(h_count[0])*nb_components)",
          "311:         || memcmp(s->v_count, v_count, sizeof(v_count[0])*nb_components)) {",
          "312:         av_freep(&s->qscale_table);",
          "314:         s->width      = width;",
          "315:         s->height     = height;",
          "316:         memcpy(s->h_count, h_count, sizeof(h_count));",
          "317:         memcpy(s->v_count, v_count, sizeof(v_count));",
          "318:         s->interlaced = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "310:         || bits != s->bits",
          "317:         s->bits       = bits;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "57bdb3f3dde3de7e84c888ae205574873bd1787b",
      "candidate_info": {
        "commit_hash": "57bdb3f3dde3de7e84c888ae205574873bd1787b",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/57bdb3f3dde3de7e84c888ae205574873bd1787b",
        "files": [
          "libavcodec/mjpegdec.c"
        ],
        "message": "avcodec/mjpegdec: check bits per pixel for changes similar to dimensions\n\nFixes out of array accesses\nFixes: asan_heap-oob_16668e9_2_asan_heap-oob_16668e9_346_miss_congeniality_pegasus_mjpg.avi\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 5c378d6a6df8243f06c87962b873bd563e58cd39)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
          ],
          "candidate": [
            "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c": [
          "File: libavcodec/mjpegdec.c -> libavcodec/mjpegdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "245: int ff_mjpeg_decode_sof(MJpegDecodeContext *s)",
          "246: {",
          "248:     int h_count[MAX_COMPONENTS];",
          "249:     int v_count[MAX_COMPONENTS];",
          "",
          "[Removed Lines]",
          "247:     int len, nb_components, i, width, height, pix_fmt_id, ret;",
          "",
          "[Added Lines]",
          "247:     int len, nb_components, i, width, height, bits, pix_fmt_id, ret;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "255:     len     = get_bits(&s->gb, 16);",
          "256:     s->avctx->bits_per_raw_sample =",
          "259:     if (s->pegasus_rct)",
          "262:         s->rct  = 1;    // FIXME ugly",
          "264:     if(s->lossless && s->avctx->lowres){",
          "",
          "[Removed Lines]",
          "257:     s->bits = get_bits(&s->gb, 8);",
          "260:         s->bits = 9;",
          "261:     if (s->bits == 9 && !s->pegasus_rct)",
          "",
          "[Added Lines]",
          "257:     bits = get_bits(&s->gb, 8);",
          "260:         bits = 9;",
          "261:     if (bits == 9 && !s->pegasus_rct)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "291:             return AVERROR_INVALIDDATA;",
          "292:         }",
          "293:     }",
          "295:         avpriv_report_missing_feature(s->avctx,",
          "296:                                       \"JPEG-LS that is not <= 8 \"",
          "297:                                       \"bits/component or 16-bit gray\");",
          "",
          "[Removed Lines]",
          "294:     if (s->ls && !(s->bits <= 8 || nb_components == 1)) {",
          "",
          "[Added Lines]",
          "294:     if (s->ls && !(bits <= 8 || nb_components == 1)) {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "339:     if (   width != s->width || height != s->height",
          "340:         || memcmp(s->h_count, h_count, sizeof(h_count))",
          "341:         || memcmp(s->v_count, v_count, sizeof(v_count))) {",
          "343:         s->width      = width;",
          "344:         s->height     = height;",
          "345:         memcpy(s->h_count, h_count, sizeof(h_count));",
          "346:         memcpy(s->v_count, v_count, sizeof(v_count));",
          "347:         s->interlaced = 0;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "340:         || bits != s->bits",
          "346:         s->bits       = bits;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f7170c48328d5d1b22a2d5e7e8888fab37da37b5",
      "candidate_info": {
        "commit_hash": "f7170c48328d5d1b22a2d5e7e8888fab37da37b5",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/f7170c48328d5d1b22a2d5e7e8888fab37da37b5",
        "files": [
          "libavcodec/mjpegdec.c"
        ],
        "message": "avcodec/mjpegdec: check bits per pixel for changes similar to dimensions\n\nFixes out of array accesses\nFixes: asan_heap-oob_16668e9_2_asan_heap-oob_16668e9_346_miss_congeniality_pegasus_mjpg.avi\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 5c378d6a6df8243f06c87962b873bd563e58cd39)\n\nConflicts:\n\n\tlibavcodec/mjpegdec.c\n(cherry picked from commit 94371a404c663c3dae3d542fa43951567ab67f82)\n\nConflicts:\n\n\tlibavcodec/mjpegdec.c\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
          ],
          "candidate": [
            "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c": [
          "File: libavcodec/mjpegdec.c -> libavcodec/mjpegdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "194: int ff_mjpeg_decode_sof(MJpegDecodeContext *s)",
          "195: {",
          "199:     len = get_bits(&s->gb, 16);",
          "206:         av_log(s->avctx, AV_LOG_ERROR, \"only 8 bits/component accepted\\n\");",
          "207:         return -1;",
          "208:     }",
          "",
          "[Removed Lines]",
          "196:     int len, nb_components, i, width, height, pix_fmt_id;",
          "200:     s->bits= get_bits(&s->gb, 8);",
          "202:     if(s->pegasus_rct) s->bits=9;",
          "203:     if(s->bits==9 && !s->pegasus_rct) s->rct=1;    //FIXME ugly",
          "205:     if (s->bits != 8 && !s->lossless){",
          "",
          "[Added Lines]",
          "196:     int len, nb_components, i, width, height, bits, pix_fmt_id;",
          "200:     bits= get_bits(&s->gb, 8);",
          "202:     if(s->pegasus_rct) bits=9;",
          "203:     if(bits==9 && !s->pegasus_rct) s->rct=1;    //FIXME ugly",
          "205:     if (bits != 8 && !s->lossless){",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "222:     if (nb_components <= 0 ||",
          "223:         nb_components > MAX_COMPONENTS)",
          "224:         return -1;",
          "226:         av_log(s->avctx, AV_LOG_ERROR, \"only <= 8 bits/component or 16-bit gray accepted for JPEG-LS\\n\");",
          "227:         return -1;",
          "228:     }",
          "",
          "[Removed Lines]",
          "225:     if (s->ls && !(s->bits <= 8 || nb_components == 1)){",
          "",
          "[Added Lines]",
          "225:     if (s->ls && !(bits <= 8 || nb_components == 1)){",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "259:         av_freep(&s->qscale_table);",
          "261:         s->width = width;",
          "262:         s->height = height;",
          "263:         s->interlaced = 0;",
          "",
          "[Removed Lines]",
          "258:     if (width != s->width || height != s->height) {",
          "",
          "[Added Lines]",
          "258:     if (   width != s->width || height != s->height",
          "259:         || bits != s->bits",
          "260:        ) {",
          "265:         s->bits       = bits;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bb6a8a0509d5fcc93aff6e3c62135ed5f6f9cb25",
      "candidate_info": {
        "commit_hash": "bb6a8a0509d5fcc93aff6e3c62135ed5f6f9cb25",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/bb6a8a0509d5fcc93aff6e3c62135ed5f6f9cb25",
        "files": [
          "libavcodec/mjpegdec.c"
        ],
        "message": "avcodec/mjpegdec: check bits per pixel for changes similar to dimensions\n\nFixes out of array accesses\nFixes: asan_heap-oob_16668e9_2_asan_heap-oob_16668e9_346_miss_congeniality_pegasus_mjpg.avi\n\nFound-by: Mateusz \"j00ru\" Jurczyk and Gynvael Coldwind\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 5c378d6a6df8243f06c87962b873bd563e58cd39)\n\nConflicts:\n\n\tlibavcodec/mjpegdec.c\n(cherry picked from commit 94371a404c663c3dae3d542fa43951567ab67f82)\n\nConflicts:\n\n\tlibavcodec/mjpegdec.c\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
          ],
          "candidate": [
            "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/mjpegdec.c||libavcodec/mjpegdec.c": [
          "File: libavcodec/mjpegdec.c -> libavcodec/mjpegdec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "217: int ff_mjpeg_decode_sof(MJpegDecodeContext *s)",
          "218: {",
          "221:     s->cur_scan = 0;",
          "222:     s->upscale_h = s->upscale_v = 0;",
          "225:     len     = get_bits(&s->gb, 16);",
          "228:     if (s->pegasus_rct)",
          "231:         s->rct  = 1;    // FIXME ugly",
          "234:         av_log(s->avctx, AV_LOG_ERROR, \"only 8 bits/component accepted\\n\");",
          "235:         return -1;",
          "236:     }",
          "",
          "[Removed Lines]",
          "219:     int len, nb_components, i, width, height, pix_fmt_id;",
          "226:     s->bits = get_bits(&s->gb, 8);",
          "229:         s->bits = 9;",
          "230:     if (s->bits == 9 && !s->pegasus_rct)",
          "233:     if (s->bits != 8 && !s->lossless) {",
          "",
          "[Added Lines]",
          "219:     int len, nb_components, i, width, height, bits, pix_fmt_id;",
          "226:     bits = get_bits(&s->gb, 8);",
          "229:         bits = 9;",
          "230:     if (bits == 9 && !s->pegasus_rct)",
          "233:     if (bits != 8 && !s->lossless) {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "262:             return AVERROR_INVALIDDATA;",
          "263:         }",
          "264:     }",
          "266:         av_log(s->avctx, AV_LOG_ERROR,",
          "267:                \"only <= 8 bits/component or 16-bit gray accepted for JPEG-LS\\n\");",
          "268:         return -1;",
          "",
          "[Removed Lines]",
          "265:     if (s->ls && !(s->bits <= 8 || nb_components == 1)) {",
          "",
          "[Added Lines]",
          "265:     if (s->ls && !(bits <= 8 || nb_components == 1)) {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "310:         av_freep(&s->qscale_table);",
          "312:         s->width      = width;",
          "313:         s->height     = height;",
          "314:         s->interlaced = 0;",
          "",
          "[Removed Lines]",
          "309:     if (width != s->width || height != s->height) {",
          "",
          "[Added Lines]",
          "309:     if (   width != s->width || height != s->height",
          "310:         || bits != s->bits",
          "311:        ) {",
          "316:         s->bits       = bits;",
          "",
          "---------------"
        ]
      }
    }
  ]
}