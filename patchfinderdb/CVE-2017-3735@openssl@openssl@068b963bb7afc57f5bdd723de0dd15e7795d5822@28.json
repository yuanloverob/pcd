{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "36097bd81a8ec365c94e33ec3bac2f143cbf0b16",
      "candidate_info": {
        "commit_hash": "36097bd81a8ec365c94e33ec3bac2f143cbf0b16",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/36097bd81a8ec365c94e33ec3bac2f143cbf0b16",
        "files": [
          "apps/s_client.c"
        ],
        "message": "Addressed build failure because of missing #ifdef AF_UNIX guard CLA: trivial\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4067)\n\n(cherry picked from commit 326eaa941e03a8922a3789ccab0d134c63d05c92)",
        "before_after_code_files": [
          "apps/s_client.c||apps/s_client.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/s_client.c||apps/s_client.c": [
          "File: apps/s_client.c -> apps/s_client.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "1370:         }",
          "1371:     }",
          "1373:     if (socket_family == AF_UNIX && socket_type != SOCK_STREAM) {",
          "1374:         BIO_printf(bio_err,",
          "1375:                    \"Can't use unix sockets and datagrams together\\n\");",
          "1376:         goto end;",
          "1377:     }",
          "1379:     if (split_send_fragment > SSL3_RT_MAX_PLAIN_LENGTH) {",
          "1380:         BIO_printf(bio_err, \"Bad split send fragment size\\n\");",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1373: #ifdef AF_UNIX",
          "1379: #endif",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9716b1234b40c5d36be46465567ea060e09d30d6",
      "candidate_info": {
        "commit_hash": "9716b1234b40c5d36be46465567ea060e09d30d6",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/9716b1234b40c5d36be46465567ea060e09d30d6",
        "files": [
          "crypto/asn1/asn_mime.c"
        ],
        "message": "Fix error-path memory leak in asn_mime.c\n\nReviewed-by: Bernd Edlinger <bernd.edlinger@hotmail.de>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/5142)\n\n(cherry picked from commit a26dd465b21d8def440c16b6bd90227b03e12e02)",
        "before_after_code_files": [
          "crypto/asn1/asn_mime.c||crypto/asn1/asn_mime.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/asn1/asn_mime.c||crypto/asn1/asn_mime.c": [
          "File: crypto/asn1/asn_mime.c -> crypto/asn1/asn_mime.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "425:             || hdr->value == NULL) {",
          "426:             sk_MIME_HEADER_pop_free(headers, mime_hdr_free);",
          "427:             ASN1err(ASN1_F_SMIME_READ_ASN1, ASN1_R_NO_SIG_CONTENT_TYPE);",
          "428:             return NULL;",
          "429:         }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "428:             sk_BIO_pop_free(parts, BIO_vfree);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "44e688bca36ab4e1b4cd1cf6710871b7906e7c96",
      "candidate_info": {
        "commit_hash": "44e688bca36ab4e1b4cd1cf6710871b7906e7c96",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/44e688bca36ab4e1b4cd1cf6710871b7906e7c96",
        "files": [
          "apps/s_client.c"
        ],
        "message": "Fix intermittent Cygwin failures in s_client\n\nThis was identified for Windows almost two years ago for VC and\nmsys/mingw.  It seems that Cygwin suffers from the same issue, and\nsince Cygwin doesn't define OPENSSL_SYS_WINDOWS, we need to make a\nspecial case to have a 50ms pause before closing the TLS connection.\n\nRef: git commit cb2e10f257a464c6b475b321dd9e4769df84dbf6\n\nReviewed-by: Bernd Edlinger <bernd.edlinger@hotmail.de>\n(Merged from https://github.com/openssl/openssl/pull/5074)\n\n(cherry picked from commit 27da42d85212f80fc0db02b1cedf1d49fbfb8c43)",
        "before_after_code_files": [
          "apps/s_client.c||apps/s_client.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "apps/s_client.c||apps/s_client.c": [
          "File: apps/s_client.c -> apps/s_client.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "2461:     if (in_init)",
          "2462:         print_stuff(bio_c_out, con, full_log);",
          "2463:     do_ssl_shutdown(con);",
          "",
          "[Removed Lines]",
          "2464: #if defined(OPENSSL_SYS_WINDOWS)",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "2472:     Sleep(50);",
          "2473: #endif",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2472: #if defined(OPENSSL_SYS_WINDOWS)",
          "2474: #elif defined(OPENSSL_SYS_CYGWIN)",
          "2475:     usleep(50000);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ab9195255a2616fc1b5511407b2ded4ea2765ad1",
      "candidate_info": {
        "commit_hash": "ab9195255a2616fc1b5511407b2ded4ea2765ad1",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/ab9195255a2616fc1b5511407b2ded4ea2765ad1",
        "files": [
          "crypto/ec/ecdsa_ossl.c"
        ],
        "message": "Address a timing side channel whereby it is possible to determine some\n\ninformation about the length of the scalar used in ECDSA operations\nfrom a large number (2^32) of signatures.\n\nThis doesn't rate as a CVE because:\n\n* For the non-constant time code, there are easier ways to extract\n  more information.\n\n* For the constant time code, it requires a significant number of signatures\n  to leak a small amount of information.\n\nThanks to Neals Fournaise, Eliane Jaulmes and Jean-Rene Reinhard for\nreporting this issue.\n\nReviewed-by: Andy Polyakov <appro@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4576)\n\n(cherry picked from commit 4a089bbdf11f9e231cc68f42bba934c954d81a49)",
        "before_after_code_files": [
          "crypto/ec/ecdsa_ossl.c||crypto/ec/ecdsa_ossl.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/ec/ecdsa_ossl.c||crypto/ec/ecdsa_ossl.c": [
          "File: crypto/ec/ecdsa_ossl.c -> crypto/ec/ecdsa_ossl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "41:     EC_POINT *tmp_point = NULL;",
          "42:     const EC_GROUP *group;",
          "43:     int ret = 0;",
          "45:     if (eckey == NULL || (group = EC_KEY_get0_group(eckey)) == NULL) {",
          "46:         ECerr(EC_F_ECDSA_SIGN_SETUP, ERR_R_PASSED_NULL_PARAMETER);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "44:     int order_bits;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "77:         goto err;",
          "78:     }",
          "80:     do {",
          "82:         do",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "82:     order_bits = BN_num_bits(order);",
          "83:     if (!BN_set_bit(k, order_bits)",
          "84:         || !BN_set_bit(r, order_bits)",
          "85:         || !BN_set_bit(X, order_bits))",
          "86:         goto err;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "106:             goto err;",
          "112:         if (!EC_POINT_mul(group, tmp_point, k, NULL, NULL, ctx)) {",
          "",
          "[Removed Lines]",
          "105:         if (!BN_add(k, k, order))",
          "107:         if (BN_num_bits(k) <= BN_num_bits(order))",
          "108:             if (!BN_add(k, k, order))",
          "109:                 goto err;",
          "",
          "[Added Lines]",
          "120:         if (!BN_add(r, k, order)",
          "121:             || !BN_add(X, r, order)",
          "122:             || !BN_copy(k, BN_num_bits(r) > order_bits ? r : X))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "42999a230f893d63a17dd9aca4f8df5c860fc836",
      "candidate_info": {
        "commit_hash": "42999a230f893d63a17dd9aca4f8df5c860fc836",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/42999a230f893d63a17dd9aca4f8df5c860fc836",
        "files": [
          "crypto/mem_sec.c"
        ],
        "message": "Add a configure option to opt-out secure memory\n\n./config -DOPENSSL_NO_SECURE_MEMORY\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/5113)\n\n(cherry picked from commit 154d8c132fbe22a248f95e95ef21f1840451da62)",
        "before_after_code_files": [
          "crypto/mem_sec.c||crypto/mem_sec.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/mem_sec.c||crypto/mem_sec.c": [
          "File: crypto/mem_sec.c -> crypto/mem_sec.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "25: #include <string.h>",
          "29:     && defined(_POSIX_VERSION) && _POSIX_VERSION >= 200112L",
          "30: # define IMPLEMENTED",
          "31: # include <stdlib.h>",
          "",
          "[Removed Lines]",
          "28: #if defined(OPENSSL_SYS_UNIX) \\",
          "",
          "[Added Lines]",
          "28: #if !defined(OPENSSL_NO_SECURE_MEMORY) && defined(OPENSSL_SYS_UNIX) \\",
          "",
          "---------------"
        ]
      }
    }
  ]
}