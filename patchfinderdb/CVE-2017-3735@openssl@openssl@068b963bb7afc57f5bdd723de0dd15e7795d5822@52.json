{
  "cve_id": "CVE-2017-3735",
  "cve_desc": "While parsing an IPAddressFamily extension in an X.509 certificate, it is possible to do a one-byte overread. This would result in an incorrect text display of the certificate. This bug has been present since 2006 and is present in all versions of OpenSSL before 1.0.2m and 1.1.0g.",
  "repo": "openssl/openssl",
  "patch_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
  "patch_info": {
    "commit_hash": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "repo": "openssl/openssl",
    "commit_url": "https://github.com/openssl/openssl/commit/068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      "crypto/x509v3/v3_addr.c"
    ],
    "message": "Avoid out-of-bounds read\n\nFixes CVE 2017-3735\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n(Merged from https://github.com/openssl/openssl/pull/4276)\n\n(cherry picked from commit b23171744b01e473ebbfd6edad70c1c3825ffbcd)",
    "before_after_code_files": [
      "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c"
    ]
  },
  "patch_diff": {
    "crypto/x509v3/v3_addr.c||crypto/x509v3/v3_addr.c": [
      "File: crypto/x509v3/v3_addr.c -> crypto/x509v3/v3_addr.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "85: unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)",
      "86: {",
      "91: }",
      "",
      "[Removed Lines]",
      "87:     return ((f != NULL &&",
      "88:              f->addressFamily != NULL && f->addressFamily->data != NULL)",
      "89:             ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))",
      "90:             : 0);",
      "",
      "[Added Lines]",
      "87:     if (f == NULL",
      "88:             || f->addressFamily == NULL",
      "89:             || f->addressFamily->data == NULL",
      "90:             || f->addressFamily->length < 2)",
      "91:         return 0;",
      "92:     return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6717d1cf7db731e1087d84aa5195c3d0e71c4d30",
      "candidate_info": {
        "commit_hash": "6717d1cf7db731e1087d84aa5195c3d0e71c4d30",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/6717d1cf7db731e1087d84aa5195c3d0e71c4d30",
        "files": [
          "ssl/statem/statem_clnt.c"
        ],
        "message": "Remove an incorrect comment\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4456)\n\n(cherry picked from commit 786b4df402ce57e375012401a02ad7a6696b90c2)",
        "before_after_code_files": [
          "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "ssl/statem/statem_clnt.c||ssl/statem/statem_clnt.c": [
          "File: ssl/statem/statem_clnt.c -> ssl/statem/statem_clnt.c"
        ]
      }
    },
    {
      "candidate_hash": "8bc6b51ce2eba016d35e1524250c17f1c5de9911",
      "candidate_info": {
        "commit_hash": "8bc6b51ce2eba016d35e1524250c17f1c5de9911",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/8bc6b51ce2eba016d35e1524250c17f1c5de9911",
        "files": [
          "crypto/x509v3/v3_lib.c"
        ],
        "message": "Fix possible leaks on sk_X509_EXTENSION_push() failure ...\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\nReviewed-by: Andy Polyakov <appro@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4677)\n\n(cherry picked from commit 1687aa760cdd164b12c5b70e65cadcbce1e7ccfa)",
        "before_after_code_files": [
          "crypto/x509v3/v3_lib.c||crypto/x509v3/v3_lib.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/x509v3/v3_lib.c||crypto/x509v3/v3_lib.c": [
          "File: crypto/x509v3/v3_lib.c -> crypto/x509v3/v3_lib.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "284: int X509V3_add1_i2d(STACK_OF(X509_EXTENSION) **x, int nid, void *value,",
          "285:                     int crit, unsigned long flags)",
          "286: {",
          "290:     unsigned long ext_op = flags & X509V3_ADD_OP_MASK;",
          "",
          "[Removed Lines]",
          "287:     int extidx = -1;",
          "288:     int errcode;",
          "289:     X509_EXTENSION *ext, *extmp;",
          "",
          "[Added Lines]",
          "289:     int errcode, extidx = -1;",
          "290:     X509_EXTENSION *ext = NULL, *extmp;",
          "291:     STACK_OF(X509_EXTENSION) *ret = NULL;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "345:         return 1;",
          "346:     }",
          "348:     if (*x == NULL",
          "354:     return 1;",
          "356:  err:",
          "357:     if (!(flags & X509V3_ADD_SILENT))",
          "358:         X509V3err(X509V3_F_X509V3_ADD1_I2D, errcode);",
          "",
          "[Removed Lines]",
          "349:         && (*x = sk_X509_EXTENSION_new_null()) == NULL)",
          "350:         return -1;",
          "351:     if (!sk_X509_EXTENSION_push(*x, ext))",
          "352:         return -1;",
          "",
          "[Added Lines]",
          "350:     ret = *x;",
          "352:         && (ret = sk_X509_EXTENSION_new_null()) == NULL)",
          "353:         goto m_fail;",
          "354:     if (!sk_X509_EXTENSION_push(ret, ext))",
          "355:         goto m_fail;",
          "360:  m_fail:",
          "362:     if (ret != *x)",
          "363:         sk_X509_EXTENSION_free(ret);",
          "364:     X509_EXTENSION_free(ext);",
          "365:     return -1;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dea20b941f68c60fbe1885ecf8156a76eb30789a",
      "candidate_info": {
        "commit_hash": "dea20b941f68c60fbe1885ecf8156a76eb30789a",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/dea20b941f68c60fbe1885ecf8156a76eb30789a",
        "files": [
          "crypto/ocsp/ocsp_vfy.c",
          "doc/crypto/OCSP_resp_find_status.pod"
        ],
        "message": "Fix more OCSP_resp_get0_signer() nits\n\nFix a typo for \"retrieve\" and some indentation.\n\nReviewed-by: Kurt Roeckx <kurt@roeckx.be>\n\n(cherry picked from commit eb48052ec96a7551391b5955f03f5ef70b3528f6)\n\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/4723)",
        "before_after_code_files": [
          "crypto/ocsp/ocsp_vfy.c||crypto/ocsp/ocsp_vfy.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/ocsp/ocsp_vfy.c||crypto/ocsp/ocsp_vfy.c": [
          "File: crypto/ocsp/ocsp_vfy.c -> crypto/ocsp/ocsp_vfy.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "139: }",
          "141: int OCSP_resp_get0_signer(OCSP_BASICRESP *bs, X509 **signer,",
          "143: {",
          "144:     int ret;",
          "",
          "[Removed Lines]",
          "142:                      STACK_OF(X509) *extra_certs)",
          "",
          "[Added Lines]",
          "142:                           STACK_OF(X509) *extra_certs)",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "60ccf93d1bb5fb29907f789a913e6e259dfc1ee2",
      "candidate_info": {
        "commit_hash": "60ccf93d1bb5fb29907f789a913e6e259dfc1ee2",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/60ccf93d1bb5fb29907f789a913e6e259dfc1ee2",
        "files": [
          "util/mkdef.pl"
        ],
        "message": "util/mkdef.pl: Make symbol version processing Linux only\n\nFor Windows, we care which way it is, the resulting file is just a pile\nof symbols.  For VMS, we really need to care about the numeric ordering,\nand getting the symbols sorted by symbol version too didn't agree with\nthat.\n\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3804)\n\n(cherry picked from commit 0e288c2af2f24121ebd5f0c58912d9429915c02a)",
        "before_after_code_files": [
          "util/mkdef.pl||util/mkdef.pl"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "util/mkdef.pl||util/mkdef.pl": [
          "File: util/mkdef.pl -> util/mkdef.pl",
          "--- Hunk 1 ---",
          "[Context before]",
          "1244:      if(!$do_update);",
          "1245:    } else {",
          "1246:     (my $n, my $symversion, my $dummy) = split /\\\\/, $nums{$s};",
          "1248:     my %pf = ();",
          "1249:     my $p = ($i =~ /^[^:]*:([^:]*):/,$1);",
          "1250:     my $a = ($i =~ /^[^:]*:[^:]*:[^:]*:([^:]*)/,$1);",
          "",
          "[Removed Lines]",
          "1247:     next if $symversion ne $thisversion;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1257:      }",
          "1258:      $prev = $s2; # To warn about duplicates...",
          "1259:      if($linux) {",
          "1260:       if ($symversion ne $prevsymversion) {",
          "1261:        if ($prevsymversion ne \"\") {",
          "1262:         if ($prevprevsymversion ne \"\") {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1259:       next if $symversion ne $thisversion;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1312:     }",
          "1313:    }",
          "1314:   }",
          "1316:  if ($linux) {",
          "1317:   if ($prevprevsymversion ne \"\") {",
          "1318:    print OUT \"    local: *;\\n} OPENSSL_$prevprevsymversion;\\n\\n\";",
          "",
          "[Removed Lines]",
          "1315:  } while ($thisversion ne $currversion);",
          "",
          "[Added Lines]",
          "1315:  } while ($linux && $thisversion ne $currversion);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4b797282c23450406c2dc73aea051b4b85589b8d",
      "candidate_info": {
        "commit_hash": "4b797282c23450406c2dc73aea051b4b85589b8d",
        "repo": "openssl/openssl",
        "commit_url": "https://github.com/openssl/openssl/commit/4b797282c23450406c2dc73aea051b4b85589b8d",
        "files": [
          "crypto/ec/ecdh_ossl.c"
        ],
        "message": "Fix crash in ecdh_simple_compute_key.\n\nReviewed-by: Matt Caswell <matt@openssl.org>\nReviewed-by: Rich Salz <rsalz@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/3671)\n(cherry picked from commit abea494cf75061650deecf584adc2cd293ce322d)",
        "before_after_code_files": [
          "crypto/ec/ecdh_ossl.c||crypto/ec/ecdh_ossl.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_pr": 1,
        "olp_pr_links": [
          "https://github.com/EktapopaT/openssl/pull/1"
        ],
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "crypto/ec/ecdh_ossl.c||crypto/ec/ecdh_ossl.c": [
          "File: crypto/ec/ecdh_ossl.c -> crypto/ec/ecdh_ossl.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "66:     BN_CTX_start(ctx);",
          "67:     x = BN_CTX_get(ctx);",
          "68:     y = BN_CTX_get(ctx);",
          "70:     priv_key = EC_KEY_get0_private_key(ecdh);",
          "71:     if (priv_key == NULL) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "69:     if (y == NULL) {",
          "70:         ECerr(EC_F_ECDH_SIMPLE_COMPUTE_KEY, ERR_R_MALLOC_FAILURE);",
          "71:         goto err;",
          "72:     }",
          "",
          "---------------"
        ]
      }
    }
  ]
}