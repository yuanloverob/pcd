{
  "cve_id": "CVE-2021-29564",
  "cve_desc": "TensorFlow is an end-to-end open source platform for machine learning. An attacker can trigger a null pointer dereference in the implementation of `tf.raw_ops.EditDistance`. This is because the implementation(https://github.com/tensorflow/tensorflow/blob/79865b542f9ffdc9caeb255631f7c56f1d4b6517/tensorflow/core/kernels/edit_distance_op.cc#L103-L159) has incomplete validation of the input parameters. The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range.",
  "repo": "tensorflow/tensorflow",
  "patch_hash": "f4c364a5d6880557f6f5b6eb5cee2c407f0186b3",
  "patch_info": {
    "commit_hash": "f4c364a5d6880557f6f5b6eb5cee2c407f0186b3",
    "repo": "tensorflow/tensorflow",
    "commit_url": "https://github.com/tensorflow/tensorflow/commit/f4c364a5d6880557f6f5b6eb5cee2c407f0186b3",
    "files": [
      "tensorflow/core/kernels/edit_distance_op.cc"
    ],
    "message": "Fix multiple issues in EditDistance\n\nPiperOrigin-RevId: 372033948\nChange-Id: Ieb957c29894af05bdfeb1a0402fced808dfcfd7b",
    "before_after_code_files": [
      "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
    ]
  },
  "patch_diff": {
    "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc": [
      "File: tensorflow/core/kernels/edit_distance_op.cc -> tensorflow/core/kernels/edit_distance_op.cc",
      "--- Hunk 1 ---",
      "[Context before]",
      "64:     return errors::InvalidArgument(",
      "65:         \"truth_shape should be a vector, but got shape: \",",
      "66:         truth_shape.shape().DebugString());",
      "67:   if (hypothesis_shape.NumElements() != hypothesis_indices.dim_size(1))",
      "68:     return errors::InvalidArgument(",
      "69:         \"Expected hypothesis_shape.NumElements == \"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "67:   if (hypothesis_values.NumElements() != hypothesis_indices.dim_size(0))",
      "68:     return errors::InvalidArgument(",
      "69:         \"Expected hypothesis_values.NumElements == \"",
      "70:         \"#rows(hypothesis_indices), their shapes are: \",",
      "71:         hypothesis_values.shape().DebugString(), \" and \",",
      "72:         hypothesis_indices.shape().DebugString());",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "75:         \"Input SparseTensors must have rank at least 2, but truth_shape \"",
      "76:         \"rank is: \",",
      "77:         truth_shape.NumElements());",
      "78:   if (truth_shape.NumElements() != truth_indices.dim_size(1))",
      "79:     return errors::InvalidArgument(",
      "80:         \"Expected truth_shape.NumElements == \"",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "84:   if (truth_values.NumElements() != truth_indices.dim_size(0))",
      "85:     return errors::InvalidArgument(",
      "86:         \"Expected truth_values.NumElements == \"",
      "87:         \"#rows(truth_indices), their shapes are: \",",
      "88:         truth_values.shape().DebugString(), \" and \",",
      "89:         truth_indices.shape().DebugString());",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "153:       output_shape.AddDim(std::max(hypothesis_st_shape.dim_size(d),",
      "154:                                    truth_st_shape.dim_size(d)));",
      "155:     }",
      "157:     Tensor* output = nullptr;",
      "158:     OP_REQUIRES_OK(ctx, ctx->allocate_output(\"output\", output_shape, &output));",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "168:     const auto output_elements = output_shape.num_elements();",
      "169:     OP_REQUIRES(",
      "170:         ctx, output_elements > 0,",
      "171:         errors::InvalidArgument(\"Got output shape \", output_shape.DebugString(),",
      "172:                                 \" which has 0 elements\"));",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "185:       if (g_truth == g_hypothesis) {",
      "186:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
      "187:                                       output_strides.begin(), int64{0});",
      "188:         output_t(loc) =",
      "189:             gtl::LevenshteinDistance<T>(truth_seq, hypothesis_seq, cmp);",
      "190:         if (normalize_) output_t(loc) /= truth_seq.size();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "205:         OP_REQUIRES(",
      "206:             ctx, loc < output_elements,",
      "207:             errors::Internal(\"Got an inner product \", loc,",
      "208:                              \" which would require in writing to outside of \"",
      "209:                              \"the buffer for the output tensor (max elements \",",
      "210:                              output_elements, \")\"));",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "194:       } else if (g_truth > g_hypothesis) {  // zero-length truth",
      "195:         auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
      "196:                                       output_strides.begin(), int64{0});",
      "197:         output_t(loc) = hypothesis_seq.size();",
      "198:         if (normalize_ && output_t(loc) != 0.0f) {",
      "199:           output_t(loc) = std::numeric_limits<float>::infinity();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "220:         OP_REQUIRES(",
      "221:             ctx, loc < output_elements,",
      "222:             errors::Internal(\"Got an inner product \", loc,",
      "223:                              \" which would require in writing to outside of \"",
      "224:                              \"the buffer for the output tensor (max elements \",",
      "225:                              output_elements, \")\"));",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "202:       } else {  // zero-length hypothesis",
      "203:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
      "204:                                       output_strides.begin(), int64{0});",
      "205:         output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
      "206:         ++truth_iter;",
      "207:       }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "234:         OP_REQUIRES(",
      "235:             ctx, loc < output_elements,",
      "236:             errors::Internal(\"Got an inner product \", loc,",
      "237:                              \" which would require in writing to outside of \"",
      "238:                              \"the buffer for the output tensor (max elements \",",
      "239:                              output_elements, \")\"));",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "212:       auto hypothesis_seq = hypothesis_j.values<T>();",
      "213:       auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
      "214:                                     output_strides.begin(), int64{0});",
      "215:       output_t(loc) = hypothesis_seq.size();",
      "216:       if (normalize_ && output_t(loc) != 0.0f) {",
      "217:         output_t(loc) = std::numeric_limits<float>::infinity();",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "250:       OP_REQUIRES(",
      "251:           ctx, loc < output_elements,",
      "252:           errors::Internal(\"Got an inner product \", loc,",
      "253:                            \" which would require in writing to outside of the \"",
      "254:                            \"buffer for the output tensor (max elements \",",
      "255:                            output_elements, \")\"));",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "224:       auto truth_seq = truth_i.values<T>();",
      "225:       auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
      "226:                                     output_strides.begin(), int64{0});",
      "227:       output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
      "228:       ++truth_iter;",
      "229:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "268:       OP_REQUIRES(",
      "269:           ctx, loc < output_elements,",
      "270:           errors::Internal(\"Got an inner product \", loc,",
      "271:                            \" which would require in writing to outside of the \"",
      "272:                            \"buffer for the output tensor (max elements \",",
      "273:                            output_elements, \")\"));",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "abb64c3b0c21fff3883f6f9f5399552a72cff6b3",
      "candidate_info": {
        "commit_hash": "abb64c3b0c21fff3883f6f9f5399552a72cff6b3",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/abb64c3b0c21fff3883f6f9f5399552a72cff6b3",
        "files": [
          "tensorflow/core/kernels/edit_distance_op.cc"
        ],
        "message": "Fix multiple issues in EditDistance\n\nPiperOrigin-RevId: 372033948\nChange-Id: Ieb957c29894af05bdfeb1a0402fced808dfcfd7b",
        "before_after_code_files": [
          "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc": [
          "File: tensorflow/core/kernels/edit_distance_op.cc -> tensorflow/core/kernels/edit_distance_op.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:     return errors::InvalidArgument(",
          "65:         \"truth_shape should be a vector, but got shape: \",",
          "66:         truth_shape.shape().DebugString());",
          "67:   if (hypothesis_shape.NumElements() != hypothesis_indices.dim_size(1))",
          "68:     return errors::InvalidArgument(",
          "69:         \"Expected hypothesis_shape.NumElements == \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67:   if (hypothesis_values.NumElements() != hypothesis_indices.dim_size(0))",
          "68:     return errors::InvalidArgument(",
          "69:         \"Expected hypothesis_values.NumElements == \"",
          "70:         \"#rows(hypothesis_indices), their shapes are: \",",
          "71:         hypothesis_values.shape().DebugString(), \" and \",",
          "72:         hypothesis_indices.shape().DebugString());",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "75:         \"Input SparseTensors must have rank at least 2, but truth_shape \"",
          "76:         \"rank is: \",",
          "77:         truth_shape.NumElements());",
          "78:   if (truth_shape.NumElements() != truth_indices.dim_size(1))",
          "79:     return errors::InvalidArgument(",
          "80:         \"Expected truth_shape.NumElements == \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "84:   if (truth_values.NumElements() != truth_indices.dim_size(0))",
          "85:     return errors::InvalidArgument(",
          "86:         \"Expected truth_values.NumElements == \"",
          "87:         \"#rows(truth_indices), their shapes are: \",",
          "88:         truth_values.shape().DebugString(), \" and \",",
          "89:         truth_indices.shape().DebugString());",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "153:       output_shape.AddDim(std::max(hypothesis_st_shape.dim_size(d),",
          "154:                                    truth_st_shape.dim_size(d)));",
          "155:     }",
          "157:     Tensor* output = nullptr;",
          "158:     OP_REQUIRES_OK(ctx, ctx->allocate_output(\"output\", output_shape, &output));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "168:     const auto output_elements = output_shape.num_elements();",
          "169:     OP_REQUIRES(",
          "170:         ctx, output_elements > 0,",
          "171:         errors::InvalidArgument(\"Got output shape \", output_shape.DebugString(),",
          "172:                                 \" which has 0 elements\"));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "185:       if (g_truth == g_hypothesis) {",
          "186:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "187:                                       output_strides.begin(), int64{0});",
          "188:         output_t(loc) =",
          "189:             gtl::LevenshteinDistance<T>(truth_seq, hypothesis_seq, cmp);",
          "190:         if (normalize_) output_t(loc) /= truth_seq.size();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "205:         OP_REQUIRES(",
          "206:             ctx, loc < output_elements,",
          "207:             errors::Internal(\"Got an inner product \", loc,",
          "208:                              \" which would require in writing to outside of \"",
          "209:                              \"the buffer for the output tensor (max elements \",",
          "210:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "194:       } else if (g_truth > g_hypothesis) {  // zero-length truth",
          "195:         auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
          "196:                                       output_strides.begin(), int64{0});",
          "197:         output_t(loc) = hypothesis_seq.size();",
          "198:         if (normalize_ && output_t(loc) != 0.0f) {",
          "199:           output_t(loc) = std::numeric_limits<float>::infinity();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "220:         OP_REQUIRES(",
          "221:             ctx, loc < output_elements,",
          "222:             errors::Internal(\"Got an inner product \", loc,",
          "223:                              \" which would require in writing to outside of \"",
          "224:                              \"the buffer for the output tensor (max elements \",",
          "225:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "202:       } else {  // zero-length hypothesis",
          "203:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "204:                                       output_strides.begin(), int64{0});",
          "205:         output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
          "206:         ++truth_iter;",
          "207:       }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "234:         OP_REQUIRES(",
          "235:             ctx, loc < output_elements,",
          "236:             errors::Internal(\"Got an inner product \", loc,",
          "237:                              \" which would require in writing to outside of \"",
          "238:                              \"the buffer for the output tensor (max elements \",",
          "239:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "212:       auto hypothesis_seq = hypothesis_j.values<T>();",
          "213:       auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
          "214:                                     output_strides.begin(), int64{0});",
          "215:       output_t(loc) = hypothesis_seq.size();",
          "216:       if (normalize_ && output_t(loc) != 0.0f) {",
          "217:         output_t(loc) = std::numeric_limits<float>::infinity();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "250:       OP_REQUIRES(",
          "251:           ctx, loc < output_elements,",
          "252:           errors::Internal(\"Got an inner product \", loc,",
          "253:                            \" which would require in writing to outside of the \"",
          "254:                            \"buffer for the output tensor (max elements \",",
          "255:                            output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "224:       auto truth_seq = truth_i.values<T>();",
          "225:       auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "226:                                     output_strides.begin(), int64{0});",
          "227:       output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
          "228:       ++truth_iter;",
          "229:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "268:       OP_REQUIRES(",
          "269:           ctx, loc < output_elements,",
          "270:           errors::Internal(\"Got an inner product \", loc,",
          "271:                            \" which would require in writing to outside of the \"",
          "272:                            \"buffer for the output tensor (max elements \",",
          "273:                            output_elements, \")\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a87887c549ea1f28e15c826fb25df99edc1a368b",
      "candidate_info": {
        "commit_hash": "a87887c549ea1f28e15c826fb25df99edc1a368b",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/a87887c549ea1f28e15c826fb25df99edc1a368b",
        "files": [
          "tensorflow/core/kernels/edit_distance_op.cc"
        ],
        "message": "Fix multiple issues in EditDistance\n\nPiperOrigin-RevId: 372033948\nChange-Id: Ieb957c29894af05bdfeb1a0402fced808dfcfd7b",
        "before_after_code_files": [
          "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc": [
          "File: tensorflow/core/kernels/edit_distance_op.cc -> tensorflow/core/kernels/edit_distance_op.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:     return errors::InvalidArgument(",
          "65:         \"truth_shape should be a vector, but got shape: \",",
          "66:         truth_shape.shape().DebugString());",
          "67:   if (hypothesis_shape.NumElements() != hypothesis_indices.dim_size(1))",
          "68:     return errors::InvalidArgument(",
          "69:         \"Expected hypothesis_shape.NumElements == \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67:   if (hypothesis_values.NumElements() != hypothesis_indices.dim_size(0))",
          "68:     return errors::InvalidArgument(",
          "69:         \"Expected hypothesis_values.NumElements == \"",
          "70:         \"#rows(hypothesis_indices), their shapes are: \",",
          "71:         hypothesis_values.shape().DebugString(), \" and \",",
          "72:         hypothesis_indices.shape().DebugString());",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "75:         \"Input SparseTensors must have rank at least 2, but truth_shape \"",
          "76:         \"rank is: \",",
          "77:         truth_shape.NumElements());",
          "78:   if (truth_shape.NumElements() != truth_indices.dim_size(1))",
          "79:     return errors::InvalidArgument(",
          "80:         \"Expected truth_shape.NumElements == \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "84:   if (truth_values.NumElements() != truth_indices.dim_size(0))",
          "85:     return errors::InvalidArgument(",
          "86:         \"Expected truth_values.NumElements == \"",
          "87:         \"#rows(truth_indices), their shapes are: \",",
          "88:         truth_values.shape().DebugString(), \" and \",",
          "89:         truth_indices.shape().DebugString());",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "153:       output_shape.AddDim(std::max(hypothesis_st_shape.dim_size(d),",
          "154:                                    truth_st_shape.dim_size(d)));",
          "155:     }",
          "157:     Tensor* output = nullptr;",
          "158:     OP_REQUIRES_OK(ctx, ctx->allocate_output(\"output\", output_shape, &output));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "168:     const auto output_elements = output_shape.num_elements();",
          "169:     OP_REQUIRES(",
          "170:         ctx, output_elements > 0,",
          "171:         errors::InvalidArgument(\"Got output shape \", output_shape.DebugString(),",
          "172:                                 \" which has 0 elements\"));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "185:       if (g_truth == g_hypothesis) {",
          "186:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "187:                                       output_strides.begin(), int64{0});",
          "188:         output_t(loc) =",
          "189:             gtl::LevenshteinDistance<T>(truth_seq, hypothesis_seq, cmp);",
          "190:         if (normalize_) output_t(loc) /= truth_seq.size();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "205:         OP_REQUIRES(",
          "206:             ctx, loc < output_elements,",
          "207:             errors::Internal(\"Got an inner product \", loc,",
          "208:                              \" which would require in writing to outside of \"",
          "209:                              \"the buffer for the output tensor (max elements \",",
          "210:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "194:       } else if (g_truth > g_hypothesis) {  // zero-length truth",
          "195:         auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
          "196:                                       output_strides.begin(), int64{0});",
          "197:         output_t(loc) = hypothesis_seq.size();",
          "198:         if (normalize_ && output_t(loc) != 0.0f) {",
          "199:           output_t(loc) = std::numeric_limits<float>::infinity();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "220:         OP_REQUIRES(",
          "221:             ctx, loc < output_elements,",
          "222:             errors::Internal(\"Got an inner product \", loc,",
          "223:                              \" which would require in writing to outside of \"",
          "224:                              \"the buffer for the output tensor (max elements \",",
          "225:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "202:       } else {  // zero-length hypothesis",
          "203:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "204:                                       output_strides.begin(), int64{0});",
          "205:         output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
          "206:         ++truth_iter;",
          "207:       }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "234:         OP_REQUIRES(",
          "235:             ctx, loc < output_elements,",
          "236:             errors::Internal(\"Got an inner product \", loc,",
          "237:                              \" which would require in writing to outside of \"",
          "238:                              \"the buffer for the output tensor (max elements \",",
          "239:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "212:       auto hypothesis_seq = hypothesis_j.values<T>();",
          "213:       auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
          "214:                                     output_strides.begin(), int64{0});",
          "215:       output_t(loc) = hypothesis_seq.size();",
          "216:       if (normalize_ && output_t(loc) != 0.0f) {",
          "217:         output_t(loc) = std::numeric_limits<float>::infinity();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "250:       OP_REQUIRES(",
          "251:           ctx, loc < output_elements,",
          "252:           errors::Internal(\"Got an inner product \", loc,",
          "253:                            \" which would require in writing to outside of the \"",
          "254:                            \"buffer for the output tensor (max elements \",",
          "255:                            output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "224:       auto truth_seq = truth_i.values<T>();",
          "225:       auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "226:                                     output_strides.begin(), int64{0});",
          "227:       output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
          "228:       ++truth_iter;",
          "229:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "268:       OP_REQUIRES(",
          "269:           ctx, loc < output_elements,",
          "270:           errors::Internal(\"Got an inner product \", loc,",
          "271:                            \" which would require in writing to outside of the \"",
          "272:                            \"buffer for the output tensor (max elements \",",
          "273:                            output_elements, \")\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a84151994b611b32f13ce40471ff9cc8a1dcfc4e",
      "candidate_info": {
        "commit_hash": "a84151994b611b32f13ce40471ff9cc8a1dcfc4e",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/a84151994b611b32f13ce40471ff9cc8a1dcfc4e",
        "files": [
          "tensorflow/core/kernels/edit_distance_op.cc"
        ],
        "message": "Fix multiple issues in EditDistance\n\nPiperOrigin-RevId: 372033948\nChange-Id: Ieb957c29894af05bdfeb1a0402fced808dfcfd7b",
        "before_after_code_files": [
          "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc": [
          "File: tensorflow/core/kernels/edit_distance_op.cc -> tensorflow/core/kernels/edit_distance_op.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:     return errors::InvalidArgument(",
          "65:         \"truth_shape should be a vector, but got shape: \",",
          "66:         truth_shape.shape().DebugString());",
          "67:   if (hypothesis_shape.NumElements() != hypothesis_indices.dim_size(1))",
          "68:     return errors::InvalidArgument(",
          "69:         \"Expected hypothesis_shape.NumElements == \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67:   if (hypothesis_values.NumElements() != hypothesis_indices.dim_size(0))",
          "68:     return errors::InvalidArgument(",
          "69:         \"Expected hypothesis_values.NumElements == \"",
          "70:         \"#rows(hypothesis_indices), their shapes are: \",",
          "71:         hypothesis_values.shape().DebugString(), \" and \",",
          "72:         hypothesis_indices.shape().DebugString());",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "75:         \"Input SparseTensors must have rank at least 2, but truth_shape \"",
          "76:         \"rank is: \",",
          "77:         truth_shape.NumElements());",
          "78:   if (truth_shape.NumElements() != truth_indices.dim_size(1))",
          "79:     return errors::InvalidArgument(",
          "80:         \"Expected truth_shape.NumElements == \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "84:   if (truth_values.NumElements() != truth_indices.dim_size(0))",
          "85:     return errors::InvalidArgument(",
          "86:         \"Expected truth_values.NumElements == \"",
          "87:         \"#rows(truth_indices), their shapes are: \",",
          "88:         truth_values.shape().DebugString(), \" and \",",
          "89:         truth_indices.shape().DebugString());",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "153:       output_shape.AddDim(std::max(hypothesis_st_shape.dim_size(d),",
          "154:                                    truth_st_shape.dim_size(d)));",
          "155:     }",
          "157:     Tensor* output = nullptr;",
          "158:     OP_REQUIRES_OK(ctx, ctx->allocate_output(\"output\", output_shape, &output));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "168:     const auto output_elements = output_shape.num_elements();",
          "169:     OP_REQUIRES(",
          "170:         ctx, output_elements > 0,",
          "171:         errors::InvalidArgument(\"Got output shape \", output_shape.DebugString(),",
          "172:                                 \" which has 0 elements\"));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "185:       if (g_truth == g_hypothesis) {",
          "186:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "187:                                       output_strides.begin(), int64{0});",
          "188:         output_t(loc) =",
          "189:             gtl::LevenshteinDistance<T>(truth_seq, hypothesis_seq, cmp);",
          "190:         if (normalize_) output_t(loc) /= truth_seq.size();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "205:         OP_REQUIRES(",
          "206:             ctx, loc < output_elements,",
          "207:             errors::Internal(\"Got an inner product \", loc,",
          "208:                              \" which would require in writing to outside of \"",
          "209:                              \"the buffer for the output tensor (max elements \",",
          "210:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "194:       } else if (g_truth > g_hypothesis) {  // zero-length truth",
          "195:         auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
          "196:                                       output_strides.begin(), int64{0});",
          "197:         output_t(loc) = hypothesis_seq.size();",
          "198:         if (normalize_ && output_t(loc) != 0.0f) {",
          "199:           output_t(loc) = std::numeric_limits<float>::infinity();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "220:         OP_REQUIRES(",
          "221:             ctx, loc < output_elements,",
          "222:             errors::Internal(\"Got an inner product \", loc,",
          "223:                              \" which would require in writing to outside of \"",
          "224:                              \"the buffer for the output tensor (max elements \",",
          "225:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "202:       } else {  // zero-length hypothesis",
          "203:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "204:                                       output_strides.begin(), int64{0});",
          "205:         output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
          "206:         ++truth_iter;",
          "207:       }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "234:         OP_REQUIRES(",
          "235:             ctx, loc < output_elements,",
          "236:             errors::Internal(\"Got an inner product \", loc,",
          "237:                              \" which would require in writing to outside of \"",
          "238:                              \"the buffer for the output tensor (max elements \",",
          "239:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "212:       auto hypothesis_seq = hypothesis_j.values<T>();",
          "213:       auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
          "214:                                     output_strides.begin(), int64{0});",
          "215:       output_t(loc) = hypothesis_seq.size();",
          "216:       if (normalize_ && output_t(loc) != 0.0f) {",
          "217:         output_t(loc) = std::numeric_limits<float>::infinity();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "250:       OP_REQUIRES(",
          "251:           ctx, loc < output_elements,",
          "252:           errors::Internal(\"Got an inner product \", loc,",
          "253:                            \" which would require in writing to outside of the \"",
          "254:                            \"buffer for the output tensor (max elements \",",
          "255:                            output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "224:       auto truth_seq = truth_i.values<T>();",
          "225:       auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "226:                                     output_strides.begin(), int64{0});",
          "227:       output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
          "228:       ++truth_iter;",
          "229:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "268:       OP_REQUIRES(",
          "269:           ctx, loc < output_elements,",
          "270:           errors::Internal(\"Got an inner product \", loc,",
          "271:                            \" which would require in writing to outside of the \"",
          "272:                            \"buffer for the output tensor (max elements \",",
          "273:                            output_elements, \")\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5fbc82ecec988def44332702d747a4e6520494ca",
      "candidate_info": {
        "commit_hash": "5fbc82ecec988def44332702d747a4e6520494ca",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/5fbc82ecec988def44332702d747a4e6520494ca",
        "files": [
          "tensorflow/core/kernels/edit_distance_op.cc"
        ],
        "message": "Fix multiple issues in EditDistance\n\nPiperOrigin-RevId: 372033948\nChange-Id: Ieb957c29894af05bdfeb1a0402fced808dfcfd7b",
        "before_after_code_files": [
          "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc": [
          "File: tensorflow/core/kernels/edit_distance_op.cc -> tensorflow/core/kernels/edit_distance_op.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:     return errors::InvalidArgument(",
          "65:         \"truth_shape should be a vector, but got shape: \",",
          "66:         truth_shape.shape().DebugString());",
          "67:   if (hypothesis_shape.NumElements() != hypothesis_indices.dim_size(1))",
          "68:     return errors::InvalidArgument(",
          "69:         \"Expected hypothesis_shape.NumElements == \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67:   if (hypothesis_values.NumElements() != hypothesis_indices.dim_size(0))",
          "68:     return errors::InvalidArgument(",
          "69:         \"Expected hypothesis_values.NumElements == \"",
          "70:         \"#rows(hypothesis_indices), their shapes are: \",",
          "71:         hypothesis_values.shape().DebugString(), \" and \",",
          "72:         hypothesis_indices.shape().DebugString());",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "75:         \"Input SparseTensors must have rank at least 2, but truth_shape \"",
          "76:         \"rank is: \",",
          "77:         truth_shape.NumElements());",
          "78:   if (truth_shape.NumElements() != truth_indices.dim_size(1))",
          "79:     return errors::InvalidArgument(",
          "80:         \"Expected truth_shape.NumElements == \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "84:   if (truth_values.NumElements() != truth_indices.dim_size(0))",
          "85:     return errors::InvalidArgument(",
          "86:         \"Expected truth_values.NumElements == \"",
          "87:         \"#rows(truth_indices), their shapes are: \",",
          "88:         truth_values.shape().DebugString(), \" and \",",
          "89:         truth_indices.shape().DebugString());",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "153:       output_shape.AddDim(std::max(hypothesis_st_shape.dim_size(d),",
          "154:                                    truth_st_shape.dim_size(d)));",
          "155:     }",
          "157:     Tensor* output = nullptr;",
          "158:     OP_REQUIRES_OK(ctx, ctx->allocate_output(\"output\", output_shape, &output));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "168:     const auto output_elements = output_shape.num_elements();",
          "169:     OP_REQUIRES(",
          "170:         ctx, output_elements > 0,",
          "171:         errors::InvalidArgument(\"Got output shape \", output_shape.DebugString(),",
          "172:                                 \" which has 0 elements\"));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "185:       if (g_truth == g_hypothesis) {",
          "186:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "187:                                       output_strides.begin(), int64{0});",
          "188:         output_t(loc) =",
          "189:             gtl::LevenshteinDistance<T>(truth_seq, hypothesis_seq, cmp);",
          "190:         if (normalize_) output_t(loc) /= truth_seq.size();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "205:         OP_REQUIRES(",
          "206:             ctx, loc < output_elements,",
          "207:             errors::Internal(\"Got an inner product \", loc,",
          "208:                              \" which would require in writing to outside of \"",
          "209:                              \"the buffer for the output tensor (max elements \",",
          "210:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "194:       } else if (g_truth > g_hypothesis) {  // zero-length truth",
          "195:         auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
          "196:                                       output_strides.begin(), int64{0});",
          "197:         output_t(loc) = hypothesis_seq.size();",
          "198:         if (normalize_ && output_t(loc) != 0.0f) {",
          "199:           output_t(loc) = std::numeric_limits<float>::infinity();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "220:         OP_REQUIRES(",
          "221:             ctx, loc < output_elements,",
          "222:             errors::Internal(\"Got an inner product \", loc,",
          "223:                              \" which would require in writing to outside of \"",
          "224:                              \"the buffer for the output tensor (max elements \",",
          "225:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "202:       } else {  // zero-length hypothesis",
          "203:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "204:                                       output_strides.begin(), int64{0});",
          "205:         output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
          "206:         ++truth_iter;",
          "207:       }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "234:         OP_REQUIRES(",
          "235:             ctx, loc < output_elements,",
          "236:             errors::Internal(\"Got an inner product \", loc,",
          "237:                              \" which would require in writing to outside of \"",
          "238:                              \"the buffer for the output tensor (max elements \",",
          "239:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "212:       auto hypothesis_seq = hypothesis_j.values<T>();",
          "213:       auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
          "214:                                     output_strides.begin(), int64{0});",
          "215:       output_t(loc) = hypothesis_seq.size();",
          "216:       if (normalize_ && output_t(loc) != 0.0f) {",
          "217:         output_t(loc) = std::numeric_limits<float>::infinity();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "250:       OP_REQUIRES(",
          "251:           ctx, loc < output_elements,",
          "252:           errors::Internal(\"Got an inner product \", loc,",
          "253:                            \" which would require in writing to outside of the \"",
          "254:                            \"buffer for the output tensor (max elements \",",
          "255:                            output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "224:       auto truth_seq = truth_i.values<T>();",
          "225:       auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "226:                                     output_strides.begin(), int64{0});",
          "227:       output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
          "228:       ++truth_iter;",
          "229:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "268:       OP_REQUIRES(",
          "269:           ctx, loc < output_elements,",
          "270:           errors::Internal(\"Got an inner product \", loc,",
          "271:                            \" which would require in writing to outside of the \"",
          "272:                            \"buffer for the output tensor (max elements \",",
          "273:                            output_elements, \")\"));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "446645bd67d9acff2e8b9f01ec9e8243a17f6896",
      "candidate_info": {
        "commit_hash": "446645bd67d9acff2e8b9f01ec9e8243a17f6896",
        "repo": "tensorflow/tensorflow",
        "commit_url": "https://github.com/tensorflow/tensorflow/commit/446645bd67d9acff2e8b9f01ec9e8243a17f6896",
        "files": [
          "tensorflow/core/kernels/edit_distance_op.cc"
        ],
        "message": "Fix multiple issues in EditDistance\n\nPiperOrigin-RevId: 372033948\nChange-Id: Ieb957c29894af05bdfeb1a0402fced808dfcfd7b",
        "before_after_code_files": [
          "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
          ],
          "candidate": [
            "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc"
          ]
        }
      },
      "candidate_diff": {
        "tensorflow/core/kernels/edit_distance_op.cc||tensorflow/core/kernels/edit_distance_op.cc": [
          "File: tensorflow/core/kernels/edit_distance_op.cc -> tensorflow/core/kernels/edit_distance_op.cc",
          "--- Hunk 1 ---",
          "[Context before]",
          "64:     return errors::InvalidArgument(",
          "65:         \"truth_shape should be a vector, but got shape: \",",
          "66:         truth_shape.shape().DebugString());",
          "67:   if (hypothesis_shape.NumElements() != hypothesis_indices.dim_size(1))",
          "68:     return errors::InvalidArgument(",
          "69:         \"Expected hypothesis_shape.NumElements == \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "67:   if (hypothesis_values.NumElements() != hypothesis_indices.dim_size(0))",
          "68:     return errors::InvalidArgument(",
          "69:         \"Expected hypothesis_values.NumElements == \"",
          "70:         \"#rows(hypothesis_indices), their shapes are: \",",
          "71:         hypothesis_values.shape().DebugString(), \" and \",",
          "72:         hypothesis_indices.shape().DebugString());",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "75:         \"Input SparseTensors must have rank at least 2, but truth_shape \"",
          "76:         \"rank is: \",",
          "77:         truth_shape.NumElements());",
          "78:   if (truth_shape.NumElements() != truth_indices.dim_size(1))",
          "79:     return errors::InvalidArgument(",
          "80:         \"Expected truth_shape.NumElements == \"",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "84:   if (truth_values.NumElements() != truth_indices.dim_size(0))",
          "85:     return errors::InvalidArgument(",
          "86:         \"Expected truth_values.NumElements == \"",
          "87:         \"#rows(truth_indices), their shapes are: \",",
          "88:         truth_values.shape().DebugString(), \" and \",",
          "89:         truth_indices.shape().DebugString());",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "153:       output_shape.AddDim(std::max(hypothesis_st_shape.dim_size(d),",
          "154:                                    truth_st_shape.dim_size(d)));",
          "155:     }",
          "157:     Tensor* output = nullptr;",
          "158:     OP_REQUIRES_OK(ctx, ctx->allocate_output(\"output\", output_shape, &output));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "168:     const auto output_elements = output_shape.num_elements();",
          "169:     OP_REQUIRES(",
          "170:         ctx, output_elements > 0,",
          "171:         errors::InvalidArgument(\"Got output shape \", output_shape.DebugString(),",
          "172:                                 \" which has 0 elements\"));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "185:       if (g_truth == g_hypothesis) {",
          "186:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "187:                                       output_strides.begin(), int64{0});",
          "188:         output_t(loc) =",
          "189:             gtl::LevenshteinDistance<T>(truth_seq, hypothesis_seq, cmp);",
          "190:         if (normalize_) output_t(loc) /= truth_seq.size();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "205:         OP_REQUIRES(",
          "206:             ctx, loc < output_elements,",
          "207:             errors::Internal(\"Got an inner product \", loc,",
          "208:                              \" which would require in writing to outside of \"",
          "209:                              \"the buffer for the output tensor (max elements \",",
          "210:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "194:       } else if (g_truth > g_hypothesis) {  // zero-length truth",
          "195:         auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
          "196:                                       output_strides.begin(), int64{0});",
          "197:         output_t(loc) = hypothesis_seq.size();",
          "198:         if (normalize_ && output_t(loc) != 0.0f) {",
          "199:           output_t(loc) = std::numeric_limits<float>::infinity();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "220:         OP_REQUIRES(",
          "221:             ctx, loc < output_elements,",
          "222:             errors::Internal(\"Got an inner product \", loc,",
          "223:                              \" which would require in writing to outside of \"",
          "224:                              \"the buffer for the output tensor (max elements \",",
          "225:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "202:       } else {  // zero-length hypothesis",
          "203:         auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "204:                                       output_strides.begin(), int64{0});",
          "205:         output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
          "206:         ++truth_iter;",
          "207:       }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "234:         OP_REQUIRES(",
          "235:             ctx, loc < output_elements,",
          "236:             errors::Internal(\"Got an inner product \", loc,",
          "237:                              \" which would require in writing to outside of \"",
          "238:                              \"the buffer for the output tensor (max elements \",",
          "239:                              output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "212:       auto hypothesis_seq = hypothesis_j.values<T>();",
          "213:       auto loc = std::inner_product(g_hypothesis.begin(), g_hypothesis.end(),",
          "214:                                     output_strides.begin(), int64{0});",
          "215:       output_t(loc) = hypothesis_seq.size();",
          "216:       if (normalize_ && output_t(loc) != 0.0f) {",
          "217:         output_t(loc) = std::numeric_limits<float>::infinity();",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "250:       OP_REQUIRES(",
          "251:           ctx, loc < output_elements,",
          "252:           errors::Internal(\"Got an inner product \", loc,",
          "253:                            \" which would require in writing to outside of the \"",
          "254:                            \"buffer for the output tensor (max elements \",",
          "255:                            output_elements, \")\"));",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "224:       auto truth_seq = truth_i.values<T>();",
          "225:       auto loc = std::inner_product(g_truth.begin(), g_truth.end(),",
          "226:                                     output_strides.begin(), int64{0});",
          "227:       output_t(loc) = (normalize_) ? 1.0 : truth_seq.size();",
          "228:       ++truth_iter;",
          "229:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "268:       OP_REQUIRES(",
          "269:           ctx, loc < output_elements,",
          "270:           errors::Internal(\"Got an inner product \", loc,",
          "271:                            \" which would require in writing to outside of the \"",
          "272:                            \"buffer for the output tensor (max elements \",",
          "273:                            output_elements, \")\"));",
          "",
          "---------------"
        ]
      }
    }
  ]
}