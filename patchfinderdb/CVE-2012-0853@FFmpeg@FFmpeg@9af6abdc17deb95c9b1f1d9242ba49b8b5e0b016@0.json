{
  "cve_id": "CVE-2012-0853",
  "cve_desc": "The decodeTonalComponents function in the Actrac3 codec (atrac3.c) in libavcodec in FFmpeg 0.7.x before 0.7.12, and 0.8.x before 0.8.11; and in Libav 0.5.x before 0.5.9, 0.6.x before 0.6.6, 0.7.x before 0.7.5, and 0.8.x before 0.8.1 allows remote attackers to cause a denial of service (infinite loop and crash) and possibly execute arbitrary code via a large component count in an Atrac 3 file.",
  "repo": "FFmpeg/FFmpeg",
  "patch_hash": "9af6abdc17deb95c9b1f1d9242ba49b8b5e0b016",
  "patch_info": {
    "commit_hash": "9af6abdc17deb95c9b1f1d9242ba49b8b5e0b016",
    "repo": "FFmpeg/FFmpeg",
    "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/9af6abdc17deb95c9b1f1d9242ba49b8b5e0b016",
    "files": [
      "libavcodec/atrac3.c"
    ],
    "message": "atrac3: Fix crash in tonal component decoding. Fixes Ticket780 Bug Found by: cosminamironesei\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
    "before_after_code_files": [
      "libavcodec/atrac3.c||libavcodec/atrac3.c"
    ]
  },
  "patch_diff": {
    "libavcodec/atrac3.c||libavcodec/atrac3.c": [
      "File: libavcodec/atrac3.c -> libavcodec/atrac3.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "403:             for (k=0; k<coded_components; k++) {",
      "404:                 sfIndx = get_bits(gb,6);",
      "405:                 pComponent[component_count].pos = j * 64 + (get_bits(gb,6));",
      "406:                 max_coded_values = SAMPLES_PER_FRAME - pComponent[component_count].pos;",
      "407:                 coded_values = coded_values_per_component + 1;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "405:                 if(component_count>=64)",
      "406:                     return AVERROR_INVALIDDATA;",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "049b08d04cd5a6e53e0b0814525313fe5bd3e47a",
      "candidate_info": {
        "commit_hash": "049b08d04cd5a6e53e0b0814525313fe5bd3e47a",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/049b08d04cd5a6e53e0b0814525313fe5bd3e47a",
        "files": [
          "libavcodec/atrac3.c"
        ],
        "message": "atrac3: Fix crash in tonal component decoding. Fixes Ticket780 Bug Found by: cosminamironesei\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 9af6abdc17deb95c9b1f1d9242ba49b8b5e0b016)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/atrac3.c||libavcodec/atrac3.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/atrac3.c||libavcodec/atrac3.c"
          ],
          "candidate": [
            "libavcodec/atrac3.c||libavcodec/atrac3.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/atrac3.c||libavcodec/atrac3.c": [
          "File: libavcodec/atrac3.c -> libavcodec/atrac3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "396:             for (k=0; k<coded_components; k++) {",
          "397:                 sfIndx = get_bits(gb,6);",
          "398:                 pComponent[component_count].pos = j * 64 + (get_bits(gb,6));",
          "399:                 max_coded_values = 1024 - pComponent[component_count].pos;",
          "400:                 coded_values = coded_values_per_component + 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "398:                 if(component_count>=64)",
          "399:                     return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1014e20492d529ba165227a5376d9199a4e24175",
      "candidate_info": {
        "commit_hash": "1014e20492d529ba165227a5376d9199a4e24175",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/1014e20492d529ba165227a5376d9199a4e24175",
        "files": [
          "libavcodec/atrac3.c"
        ],
        "message": "atrac3: Fix crash in tonal component decoding. Fixes Ticket780 Bug Found by: cosminamironesei\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 9af6abdc17deb95c9b1f1d9242ba49b8b5e0b016)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/atrac3.c||libavcodec/atrac3.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/atrac3.c||libavcodec/atrac3.c"
          ],
          "candidate": [
            "libavcodec/atrac3.c||libavcodec/atrac3.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/atrac3.c||libavcodec/atrac3.c": [
          "File: libavcodec/atrac3.c -> libavcodec/atrac3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "394:             for (k=0; k<coded_components; k++) {",
          "395:                 sfIndx = get_bits(gb,6);",
          "396:                 pComponent[component_count].pos = j * 64 + (get_bits(gb,6));",
          "397:                 max_coded_values = 1024 - pComponent[component_count].pos;",
          "398:                 coded_values = coded_values_per_component + 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "396:                 if(component_count>=64)",
          "397:                     return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "8c2fe23b1c74d38048668ae200514a5b95fe4eb0",
      "candidate_info": {
        "commit_hash": "8c2fe23b1c74d38048668ae200514a5b95fe4eb0",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/8c2fe23b1c74d38048668ae200514a5b95fe4eb0",
        "files": [
          "libavcodec/atrac3.c"
        ],
        "message": "atrac3: Fix crash in tonal component decoding. Fixes Ticket780 Bug Found by: cosminamironesei\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 9af6abdc17deb95c9b1f1d9242ba49b8b5e0b016)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/atrac3.c||libavcodec/atrac3.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/atrac3.c||libavcodec/atrac3.c"
          ],
          "candidate": [
            "libavcodec/atrac3.c||libavcodec/atrac3.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/atrac3.c||libavcodec/atrac3.c": [
          "File: libavcodec/atrac3.c -> libavcodec/atrac3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "403:             for (k=0; k<coded_components; k++) {",
          "404:                 sfIndx = get_bits(gb,6);",
          "405:                 pComponent[component_count].pos = j * 64 + (get_bits(gb,6));",
          "406:                 max_coded_values = SAMPLES_PER_FRAME - pComponent[component_count].pos;",
          "407:                 coded_values = coded_values_per_component + 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "405:                 if(component_count>=64)",
          "406:                     return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "f13de3c653168f9d9a0bf8653b175035a5d9230b",
      "candidate_info": {
        "commit_hash": "f13de3c653168f9d9a0bf8653b175035a5d9230b",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/f13de3c653168f9d9a0bf8653b175035a5d9230b",
        "files": [
          "libavcodec/atrac3.c"
        ],
        "message": "atrac3: Fix crash in tonal component decoding. Fixes Ticket780 Bug Found by: cosminamironesei\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\n(cherry picked from commit 9af6abdc17deb95c9b1f1d9242ba49b8b5e0b016)\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>",
        "before_after_code_files": [
          "libavcodec/atrac3.c||libavcodec/atrac3.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_cherry_pick": 1,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/atrac3.c||libavcodec/atrac3.c"
          ],
          "candidate": [
            "libavcodec/atrac3.c||libavcodec/atrac3.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/atrac3.c||libavcodec/atrac3.c": [
          "File: libavcodec/atrac3.c -> libavcodec/atrac3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "455:             for (k=0; k<coded_components; k++) {",
          "456:                 sfIndx = get_bits(gb,6);",
          "457:                 pComponent[component_count].pos = j * 64 + (get_bits(gb,6));",
          "458:                 max_coded_values = 1024 - pComponent[component_count].pos;",
          "459:                 coded_values = coded_values_per_component + 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "457:                 if(component_count>=64)",
          "458:                     return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "224025d852dcc42f752c0922fef7121808d1e42f",
      "candidate_info": {
        "commit_hash": "224025d852dcc42f752c0922fef7121808d1e42f",
        "repo": "FFmpeg/FFmpeg",
        "commit_url": "https://github.com/FFmpeg/FFmpeg/commit/224025d852dcc42f752c0922fef7121808d1e42f",
        "files": [
          "libavcodec/atrac3.c"
        ],
        "message": "atrac3: Fix crash in tonal component decoding.\n\nAdd a check to avoid writing past the end of the channel_unit.components[]\narray.\n\nBug Found by: cosminamironesei\nFixes CVE-2012-0853\nCC: libav-stable@libav.org\n\nSigned-off-by: Michael Niedermayer <michaelni@gmx.at>\nSigned-off-by: Justin Ruggles <justin.ruggles@gmail.com>\n(cherry picked from commit c509f4f74713b035a06f79cb4d00e708f5226bc5)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>\n(cherry picked from commit f43b6e2b1ed47a1254a5d44c700a7fad5e9784be)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>\n(cherry picked from commit f728ad26f0ec87650d2986a892785c0e2b97d161)\n\nSigned-off-by: Reinhard Tartler <siretart@tauware.de>",
        "before_after_code_files": [
          "libavcodec/atrac3.c||libavcodec/atrac3.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "diff_branch_same_aad": 1,
        "olp_code_files": {
          "patch": [
            "libavcodec/atrac3.c||libavcodec/atrac3.c"
          ],
          "candidate": [
            "libavcodec/atrac3.c||libavcodec/atrac3.c"
          ]
        }
      },
      "candidate_diff": {
        "libavcodec/atrac3.c||libavcodec/atrac3.c": [
          "File: libavcodec/atrac3.c -> libavcodec/atrac3.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "394:             for (k=0; k<coded_components; k++) {",
          "395:                 sfIndx = get_bits(gb,6);",
          "396:                 pComponent[component_count].pos = j * 64 + (get_bits(gb,6));",
          "397:                 max_coded_values = 1024 - pComponent[component_count].pos;",
          "398:                 coded_values = coded_values_per_component + 1;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "396:                 if (component_count >= 64)",
          "397:                     return AVERROR_INVALIDDATA;",
          "",
          "---------------"
        ]
      }
    }
  ]
}