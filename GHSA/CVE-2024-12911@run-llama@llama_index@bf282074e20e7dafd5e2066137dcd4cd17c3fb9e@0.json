{
  "cve_id": "CVE-2024-12911",
  "cve_desc": "A vulnerability in the `default_jsonalyzer` function of the `JSONalyzeQueryEngine` in the run-llama/llama_index repository allows for SQL injection via prompt injection. This can lead to arbitrary file creation and Denial-of-Service (DoS) attacks. The vulnerability affects the latest version and is fixed in version 0.5.1.",
  "repo": "run-llama/llama_index",
  "patch_hash": "bf282074e20e7dafd5e2066137dcd4cd17c3fb9e",
  "patch_info": {
    "commit_hash": "bf282074e20e7dafd5e2066137dcd4cd17c3fb9e",
    "repo": "run-llama/llama_index",
    "commit_url": "https://github.com/run-llama/llama_index/commit/bf282074e20e7dafd5e2066137dcd4cd17c3fb9e",
    "files": [
      "llama-index-core/llama_index/core/query_engine/__init__.py",
      "llama-index-core/llama_index/core/query_engine/jsonalyze/BUILD",
      "llama-index-core/llama_index/core/query_engine/jsonalyze/__init__.py",
      "llama-index-core/llama_index/core/query_engine/jsonalyze/jsonalyze_query_engine.py",
      "llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/BUILD",
      "llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py",
      "llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/jsonalyze_query_engine.py",
      "llama-index-experimental/pyproject.toml"
    ],
    "message": "[FIX] Move `JSONalyzeQueryEngine` to experimental (#17110)\n\n* add new deprecated JSONalyzeQueryEngine deprecation\n\n* rename folder\n\n* wip\n\n* mv jsonalyze to experimental\n\n* pants BUILD\n\n* more pants BUILD",
    "before_after_code_files": [
      "llama-index-core/llama_index/core/query_engine/__init__.py||llama-index-core/llama_index/core/query_engine/__init__.py",
      "llama-index-core/llama_index/core/query_engine/jsonalyze/__init__.py||llama-index-core/llama_index/core/query_engine/jsonalyze/__init__.py",
      "llama-index-core/llama_index/core/query_engine/jsonalyze/jsonalyze_query_engine.py||llama-index-core/llama_index/core/query_engine/jsonalyze/jsonalyze_query_engine.py",
      "llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py||llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py",
      "llama-index-core/llama_index/core/query_engine/jsonalyze_query_engine.py||llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/jsonalyze_query_engine.py"
    ]
  },
  "patch_diff": {
    "llama-index-core/llama_index/core/query_engine/__init__.py||llama-index-core/llama_index/core/query_engine/__init__.py": [
      "File: llama-index-core/llama_index/core/query_engine/__init__.py -> llama-index-core/llama_index/core/query_engine/__init__.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "15: from llama_index.core.query_engine.graph_query_engine import (",
      "16:     ComposableGraphQueryEngine,",
      "17: )",
      "19:     JSONalyzeQueryEngine,",
      "20: )",
      "21: from llama_index.core.query_engine.knowledge_graph_query_engine import (",
      "",
      "[Removed Lines]",
      "18: from llama_index.core.query_engine.jsonalyze_query_engine import (",
      "",
      "[Added Lines]",
      "18: from llama_index.core.query_engine.jsonalyze import (",
      "",
      "---------------"
    ],
    "llama-index-core/llama_index/core/query_engine/jsonalyze/__init__.py||llama-index-core/llama_index/core/query_engine/jsonalyze/__init__.py": [
      "File: llama-index-core/llama_index/core/query_engine/jsonalyze/__init__.py -> llama-index-core/llama_index/core/query_engine/jsonalyze/__init__.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: \"\"\"Init file.\"\"\"",
      "3: from llama_index.core.query_engine.jsonalyze.jsonalyze_query_engine import (",
      "4:     JSONalyzeQueryEngine,",
      "5: )",
      "7: __all__ = [\"JSONalyzeQueryEngine\"]",
      "",
      "---------------"
    ],
    "llama-index-core/llama_index/core/query_engine/jsonalyze/jsonalyze_query_engine.py||llama-index-core/llama_index/core/query_engine/jsonalyze/jsonalyze_query_engine.py": [
      "File: llama-index-core/llama_index/core/query_engine/jsonalyze/jsonalyze_query_engine.py -> llama-index-core/llama_index/core/query_engine/jsonalyze/jsonalyze_query_engine.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: \"\"\"JSONalyze Query Engine.",
      "3: WARNING: This tool executes a SQL prompt generated by the LLM with SQL Lite and",
      "4: may lead to arbitrary file creation on the machine running this tool.",
      "5: This tool is not recommended to be used in a production setting, and would",
      "6: require heavy sandboxing or virtual machines.",
      "8: DEPRECATED: Use `JSONalyzeQueryEngine` from `llama-index-experimental` instead.",
      "10: \"\"\"",
      "12: from typing import Any",
      "15: class JSONalyzeQueryEngine:",
      "16:     \"\"\"JSONalyze query engine.",
      "18:     DEPRECATED: Use `JSONalyzeQueryEngine` from `llama-index-experimental` instead.",
      "19:     \"\"\"",
      "21:     def __init__(self, *args: Any, **kwargs: Any) -> None:",
      "22:         raise DeprecationWarning(",
      "23:             \"JSONalyzeQueryEngine has been moved to `llama-index-experimental`.\\n\"",
      "24:             \"`pip install llama-index-experimental`\\n\"",
      "25:             \"`from llama_index.experimental.query_engine import JSONalyzeQueryEngine`\\n\"",
      "26:             \"Note that the JSONalyzeQueryEngine allows for arbitrary file creation, \\n\"",
      "27:             \"and should be used in a secure environment.\"",
      "28:         )",
      "",
      "---------------"
    ],
    "llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py||llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py": [
      "File: llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py -> llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: \"\"\"Init file.\"\"\"",
      "3: from llama_index.core.query_engine.jsonalyze.jsonalyze_query_engine import (",
      "4:     JSONalyzeQueryEngine,",
      "5: )",
      "7: __all__ = [\"JSONalyzeQueryEngine\"]",
      "",
      "---------------"
    ],
    "llama-index-core/llama_index/core/query_engine/jsonalyze_query_engine.py||llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/jsonalyze_query_engine.py": [
      "File: llama-index-core/llama_index/core/query_engine/jsonalyze_query_engine.py -> llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/jsonalyze_query_engine.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: import asyncio",
      "2: import json",
      "3: import logging",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1: \"\"\"JSONalyze Query Engine.",
      "3: WARNING: This tool executes a SQL prompt generated by the LLM with SQL Lite and",
      "4: may lead to arbitrary file creation on the machine running this tool.",
      "5: This tool is not recommended to be used in a production setting, and would",
      "6: require heavy sandboxing or virtual machines.",
      "8: DEPRECATED: Use `JSONalyzeQueryEngine` from `llama-index-experimental` instead.",
      "10: \"\"\"",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "9a6f30d52a0e2f4ed62af3df75c925d1c0fb82b8",
      "candidate_info": {
        "commit_hash": "9a6f30d52a0e2f4ed62af3df75c925d1c0fb82b8",
        "repo": "run-llama/llama_index",
        "commit_url": "https://github.com/run-llama/llama_index/commit/9a6f30d52a0e2f4ed62af3df75c925d1c0fb82b8",
        "files": [
          "llama-index-experimental/llama_index/experimental/query_engine/__init__.py",
          "llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py",
          "llama-index-experimental/pyproject.toml"
        ],
        "message": "Fixed import errors for experimental JSONalyzeQueryEngine (#17228)",
        "before_after_code_files": [
          "llama-index-experimental/llama_index/experimental/query_engine/__init__.py||llama-index-experimental/llama_index/experimental/query_engine/__init__.py",
          "llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py||llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py||llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py"
          ],
          "candidate": [
            "llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py||llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py"
          ]
        }
      },
      "candidate_diff": {
        "llama-index-experimental/llama_index/experimental/query_engine/__init__.py||llama-index-experimental/llama_index/experimental/query_engine/__init__.py": [
          "File: llama-index-experimental/llama_index/experimental/query_engine/__init__.py -> llama-index-experimental/llama_index/experimental/query_engine/__init__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: from llama_index.experimental.query_engine.pandas.output_parser import (",
          "5:     PandasInstructionParser,",
          "6: )",
          "",
          "[Removed Lines]",
          "8: __all__ = [\"PandasQueryEngine\", \"PandasInstructionParser\"]",
          "",
          "[Added Lines]",
          "7: from llama_index.experimental.query_engine.jsonalyze.jsonalyze_query_engine import (",
          "8:     JSONalyzeQueryEngine,",
          "9: )",
          "11: __all__ = [\"PandasQueryEngine\", \"PandasInstructionParser\", \"JSONalyzeQueryEngine\"]",
          "",
          "---------------"
        ],
        "llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py||llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py": [
          "File: llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py -> llama-index-experimental/llama_index/experimental/query_engine/jsonalyze/__init__.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: \"\"\"Init file.\"\"\"",
          "4:     JSONalyzeQueryEngine,",
          "5: )",
          "",
          "[Removed Lines]",
          "3: from llama_index.core.query_engine.jsonalyze.jsonalyze_query_engine import (",
          "",
          "[Added Lines]",
          "3: from llama_index.experimental.query_engine.jsonalyze.jsonalyze_query_engine import (",
          "",
          "---------------"
        ]
      }
    }
  ]
}