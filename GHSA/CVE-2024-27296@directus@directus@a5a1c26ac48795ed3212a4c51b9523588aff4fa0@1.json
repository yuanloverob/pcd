{
  "cve_id": "CVE-2024-27296",
  "cve_desc": "Directus is a real-time API and App dashboard for managing SQL database content. Prior to version 10.8.3, the exact Directus version number was being shipped in compiled JS bundles which are accessible without authentication. With this information a malicious attacker can trivially look for known vulnerabilities in Directus core or any of its shipped dependencies in that specific running version. The problem has been resolved in versions 10.8.3 and newer.",
  "repo": "directus/directus",
  "patch_hash": "a5a1c26ac48795ed3212a4c51b9523588aff4fa0",
  "patch_info": {
    "commit_hash": "a5a1c26ac48795ed3212a4c51b9523588aff4fa0",
    "repo": "directus/directus",
    "commit_url": "https://github.com/directus/directus/commit/a5a1c26ac48795ed3212a4c51b9523588aff4fa0",
    "files": [
      "app/env.d.ts",
      "app/src/main.ts",
      "app/src/modules/settings/components/navigation.vue",
      "app/src/stores/server.ts",
      "app/vite.config.js"
    ],
    "message": "replaced hardcoded versions in the app",
    "before_after_code_files": [
      "app/env.d.ts||app/env.d.ts",
      "app/src/main.ts||app/src/main.ts",
      "app/src/modules/settings/components/navigation.vue||app/src/modules/settings/components/navigation.vue",
      "app/src/stores/server.ts||app/src/stores/server.ts",
      "app/vite.config.js||app/vite.config.js"
    ]
  },
  "patch_diff": {
    "app/env.d.ts||app/env.d.ts": [
      "File: app/env.d.ts -> app/env.d.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "4: declare const __DIRECTUS_VERSION__: string;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ],
    "app/src/main.ts||app/src/main.ts": [
      "File: app/src/main.ts -> app/src/main.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "17: init();",
      "19: async function init() {",
      "22:  console.log(DIRECTUS_LOGO);",
      "24:  console.info(",
      "25:   `Hey! Interested in helping build this open-source data management platform?\\nIf so, join our growing team of contributors at: https://directus.chat`,",
      "26:  );",
      "34:  console.time('\ud83d\udd53 Application Loaded');",
      "",
      "[Removed Lines]",
      "20:  const version = __DIRECTUS_VERSION__;",
      "28:  if (import.meta.env.DEV) {",
      "29:   console.info(`%c\ud83d\udc30 Starting Directus v${version}...`, 'color:Green');",
      "30:  } else {",
      "31:   console.info(`%c\ud83d\udc30 Starting Directus...`, 'color:Green');",
      "32:  }",
      "",
      "[Added Lines]",
      "26:  console.info(`%c\ud83d\udc30 Starting Directus...`, 'color:Green');",
      "",
      "---------------"
    ],
    "app/src/modules/settings/components/navigation.vue||app/src/modules/settings/components/navigation.vue": [
      "File: app/src/modules/settings/components/navigation.vue -> app/src/modules/settings/components/navigation.vue",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: <script setup lang=\"ts\">",
      "2: import { computed } from 'vue';",
      "3: import { useI18n } from 'vue-i18n';",
      "7: const { t } = useI18n();",
      "9: const dataItems = [",
      "10:  {",
      "",
      "[Removed Lines]",
      "5: const version = __DIRECTUS_VERSION__;",
      "",
      "[Added Lines]",
      "2: import { useServerStore } from '@/stores/server';",
      "7: const { info } = useServerStore();",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "103:   <v-list-item href=\"https://github.com/directus/directus/releases\" class=\"version\">",
      "104:    <v-list-item-icon><v-icon name=\"directus\" /></v-list-item-icon>",
      "105:    <v-list-item-content>",
      "107:    </v-list-item-content>",
      "108:   </v-list-item>",
      "109:  </v-list>",
      "",
      "[Removed Lines]",
      "106:     <v-text-overflow class=\"version\" :text=\"`Directus ${version}`\" />",
      "",
      "[Added Lines]",
      "106:     <v-text-overflow class=\"version\" :text=\"`Directus ${info.version}`\" />",
      "",
      "---------------"
    ],
    "app/src/stores/server.ts||app/src/stores/server.ts": [
      "File: app/src/stores/server.ts -> app/src/stores/server.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "43:   default: number;",
      "44:   max: number;",
      "45:  };",
      "46: };",
      "48: export type Auth = {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "46:  version?: string;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "84:   info.project = serverInfoResponse.data.data?.project;",
      "85:   info.queryLimit = serverInfoResponse.data.data?.queryLimit;",
      "87:   auth.providers = authResponse.data.data;",
      "88:   auth.disableDefault = authResponse.data.disableDefault;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "87:   info.version = serverInfoResponse.data.data?.version;",
      "",
      "---------------"
    ],
    "app/vite.config.js||app/vite.config.js": [
      "File: app/vite.config.js -> app/vite.config.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "18: import path from 'node:path';",
      "19: import { searchForWorkspaceRoot } from 'vite';",
      "20: import { defineConfig } from 'vitest/config';",
      "23: const API_PATH = path.join('..', 'api');",
      "24: const EXTENSIONS_PATH = path.join(API_PATH, 'extensions');",
      "27: export default defineConfig({",
      "31:  plugins: [",
      "32:   directusExtensions(),",
      "33:   vue(),",
      "",
      "[Removed Lines]",
      "21: import { version } from '../directus/package.json';",
      "28:  define: {",
      "29:   __DIRECTUS_VERSION__: JSON.stringify(version),",
      "30:  },",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "d5395ce72c696585cac653c71fcb0ef0efcabbfd",
      "candidate_info": {
        "commit_hash": "d5395ce72c696585cac653c71fcb0ef0efcabbfd",
        "repo": "directus/directus",
        "commit_url": "https://github.com/directus/directus/commit/d5395ce72c696585cac653c71fcb0ef0efcabbfd",
        "files": [
          "app/package.json",
          "app/src/components/register.ts",
          "app/src/lang/translations/en-US.yaml",
          "app/src/views/private/components/docs-wrapper.vue",
          "app/src/views/private/private-view.vue",
          "app/vite.config.js",
          "pnpm-lock.yaml"
        ],
        "message": "Follow-up on \"Drop inline rendering of docs\" (#17449)\n\n* Follow-up of \"Drop inline rendering of docs\"\n\n* Remove docs hack\n\n---------\n\nCo-authored-by: rijkvanzanten <rijkvanzanten@me.com>",
        "before_after_code_files": [
          "app/src/components/register.ts||app/src/components/register.ts",
          "app/src/views/private/components/docs-wrapper.vue||app/src/views/private/components/docs-wrapper.vue",
          "app/src/views/private/private-view.vue||app/src/views/private/private-view.vue",
          "app/vite.config.js||app/vite.config.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "app/vite.config.js||app/vite.config.js"
          ],
          "candidate": [
            "app/vite.config.js||app/vite.config.js"
          ]
        }
      },
      "candidate_diff": {
        "app/src/components/register.ts||app/src/components/register.ts": [
          "File: app/src/components/register.ts -> app/src/components/register.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: import SidebarDetail from '@/views/private/components/sidebar-detail.vue';",
          "5: import UserPopover from '@/views/private/components/user-popover.vue';",
          "6: import ValueNull from '@/views/private/components/value-null.vue';",
          "8: import DrawerItem from '@/views/private/components/drawer-item.vue';",
          "9: import DrawerBatch from '@/views/private/components/drawer-batch.vue';",
          "10: import { App } from 'vue';",
          "",
          "[Removed Lines]",
          "7: import DocsWrapper from '@/views/private/components/docs-wrapper.vue';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "144:  app.component('SidebarDetail', SidebarDetail);",
          "145:  app.component('UserPopover', UserPopover);",
          "146:  app.component('ValueNull', ValueNull);",
          "148:  app.component('DrawerItem', DrawerItem);",
          "149:  app.component('DrawerBatch', DrawerBatch);",
          "150: }",
          "",
          "[Removed Lines]",
          "147:  app.component('DocsWrapper', DocsWrapper);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "app/src/views/private/components/docs-wrapper.vue||app/src/views/private/components/docs-wrapper.vue": [
          "File: app/src/views/private/components/docs-wrapper.vue -> app/src/views/private/components/docs-wrapper.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "app/src/views/private/private-view.vue||app/src/views/private/private-view.vue": [
          "File: app/src/views/private/private-view.vue -> app/src/views/private/private-view.vue",
          "--- Hunk 1 ---",
          "[Context before]",
          "147: provide('main-element', contentEl);",
          "149: router.afterEach(async (to, from) => {",
          "153:  contentEl.value?.scrollTo({ top: 0 });",
          "154:  fullScreen.value = false;",
          "155: });",
          "",
          "[Removed Lines]",
          "151:  if (to.path === from.path) return;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "app/vite.config.js||app/vite.config.js": [
          "File: app/vite.config.js -> app/vite.config.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "12: } from '@directus/shared/utils/node';",
          "13: import yaml from '@rollup/plugin-yaml';",
          "14: import vue from '@vitejs/plugin-vue';",
          "16: import path from 'path';",
          "17: import fs from 'fs';",
          "22: import { searchForWorkspaceRoot } from 'vite';",
          "23: import { defineConfig } from 'vitest/config';",
          "",
          "[Removed Lines]",
          "15: import hljs from 'highlight.js';",
          "18: import markdownItAnchor from 'markdown-it-anchor';",
          "19: import markdownItContainer from 'markdown-it-container';",
          "20: import markdownItTableOfContents from 'markdown-it-table-of-contents';",
          "21: import md from 'vite-plugin-vue-markdown';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "29: export default defineConfig({",
          "30:  plugins: [",
          "31:   directusExtensions(),",
          "127:   yaml({",
          "128:    transform(data) {",
          "129:     return data === null ? {} : undefined;",
          "",
          "[Removed Lines]",
          "32:   vue({",
          "33:    include: [/\\.vue$/, /\\.md$/],",
          "34:   }),",
          "35:   md({",
          "36:    wrapperComponent: 'docs-wrapper',",
          "37:    markdownItOptions: {",
          "38:     highlight(str, lang) {",
          "39:      if (lang && hljs.getLanguage(lang)) {",
          "40:       try {",
          "41:        return hljs.highlight(str, { language: lang }).value;",
          "42:       } catch (err) {",
          "44:        console.warn('There was an error highlighting in Markdown');",
          "46:        console.error(err);",
          "47:       }",
          "48:      }",
          "50:      return '';",
          "51:     },",
          "52:    },",
          "53:    markdownItSetup(md) {",
          "54:     md.use(markdownItTableOfContents, { includeLevel: [2] });",
          "55:     md.use(markdownItAnchor, {",
          "56:      permalink: markdownItAnchor.permalink.linkInsideHeader({ placement: 'before' }),",
          "57:     });",
          "59:     function hintRenderer(type) {",
          "60:      return (tokens, idx) => {",
          "61:       const token = tokens[idx];",
          "62:       let title = token.info.trim().slice(type.length).trim() || '';",
          "64:       if (title) title = `<div class=\"hint-title\">${title}</div>`;",
          "66:       if (token.nesting === 1) {",
          "67:        return `<div class=\"${type} hint\">${title}\\n`;",
          "68:       } else {",
          "69:        return '</div>\\n';",
          "70:       }",
          "71:      };",
          "72:     }",
          "74:     md.use(markdownItContainer, 'tip', { render: hintRenderer('tip') });",
          "75:     md.use(markdownItContainer, 'warning', { render: hintRenderer('warning') });",
          "76:     md.use(markdownItContainer, 'danger', { render: hintRenderer('danger') });",
          "78:     md.core.ruler.push('router-link', (state) => {",
          "79:      state.tokens.forEach((token) => {",
          "80:       if (token.type === 'inline') {",
          "81:        const inlineTokens = token.children;",
          "83:        let isTraversingLink = false;",
          "84:        for (let i = 0; i < inlineTokens.length; i++) {",
          "85:         if (isTraversingLink && inlineTokens[i].type === 'link_close') {",
          "86:          inlineTokens[i].tag = 'router-link';",
          "88:          isTraversingLink = false;",
          "89:         } else if (inlineTokens[i].type === 'link_open') {",
          "90:          const href = inlineTokens[i].attrs.find((attr) => attr[0] === 'href');",
          "92:          if (href) {",
          "93:           if (href[1].startsWith('http')) {",
          "94:            inlineTokens[i].attrs.push(['target', '_blank']);",
          "95:            inlineTokens[i].attrs.push(['rel', 'noopener noreferrer']);",
          "96:           } else if (!href[1].startsWith('#')) {",
          "97:            inlineTokens[i].tag = 'router-link';",
          "98:            inlineTokens[i].attrs = [['to', `/docs${href[1]}`]];",
          "100:            isTraversingLink = true;",
          "101:           }",
          "102:          }",
          "103:         }",
          "104:        }",
          "105:       }",
          "106:      });",
          "107:     });",
          "108:    },",
          "109:    transforms: {",
          "110:     before(code) {",
          "111:      const titleRegex = /^# ([^\\n]+?)( <small><\\/small>)?\\n/m;",
          "113:      const titleLine = code.match(titleRegex);",
          "115:      const title = titleLine?.[1] ?? null;",
          "116:      const modularExtension = Boolean(titleLine?.[2]);",
          "117:      const codeWithoutTitle = code.replace(titleRegex, '');",
          "119:      const newCode = `---\\ntitle: \"${title}\"\\nmodularExtension: ${modularExtension}${",
          "120:       code.startsWith('---\\n') ? codeWithoutTitle.substring(3) : `\\n---\\n\\n${codeWithoutTitle}`",
          "121:      }`;",
          "123:      return newCode;",
          "124:     },",
          "125:    },",
          "126:   }),",
          "",
          "[Added Lines]",
          "27:   vue(),",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "59c795d7a9f6f718ab92d287be10046638d41ffe",
      "candidate_info": {
        "commit_hash": "59c795d7a9f6f718ab92d287be10046638d41ffe",
        "repo": "directus/directus",
        "commit_url": "https://github.com/directus/directus/commit/59c795d7a9f6f718ab92d287be10046638d41ffe",
        "files": [
          ".changeset/friendly-pumpkins-notice.md",
          "app/src/main.ts",
          "contributors.yml"
        ],
        "message": "Fix initialization order to avoid page-not-found error (#19685)\n\n* Fix initialization order to avoid page-not-found error\n\n* Sign CLA\n\n* Sign CLA\n\n* Slightly adjust the comment\n\n* Add changeset\n\n---------\n\nCo-authored-by: Pascal Jufer <pascal-jufer@bluewin.ch>",
        "before_after_code_files": [
          "app/src/main.ts||app/src/main.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "app/src/main.ts||app/src/main.ts"
          ],
          "candidate": [
            "app/src/main.ts||app/src/main.ts"
          ]
        }
      },
      "candidate_diff": {
        "app/src/main.ts||app/src/main.ts": [
          "File: app/src/main.ts -> app/src/main.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "36:  const app = createApp(App);",
          "39:  app.use(i18n);",
          "40:  app.use(createPinia());",
          "41:  app.use(createHead());",
          "",
          "[Removed Lines]",
          "38:  app.use(router);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "52:  registerViews(app);",
          "54:  await loadExtensions();",
          "56:  registerExtensions(app);",
          "58:  app.mount('#app');",
          "60:  console.timeEnd('\ud83d\udd53 Application Loaded');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "57:  app.use(router);",
          "",
          "---------------"
        ]
      }
    }
  ]
}