{
  "cve_id": "CVE-2024-29881",
  "cve_desc": "TinyMCE is an open source rich text editor.  A cross-site scripting (XSS) vulnerability was discovered in TinyMCE\u2019s content loading and content inserting code. A SVG image could be loaded though an `object` or `embed` element and that image could potentially contain a XSS payload. This vulnerability is fixed in 6.8.1 and 7.0.0.",
  "repo": "tinymce/tinymce",
  "patch_hash": "bcdea2ad14e3c2cea40743fb48c63bba067ae6d1",
  "patch_info": {
    "commit_hash": "bcdea2ad14e3c2cea40743fb48c63bba067ae6d1",
    "repo": "tinymce/tinymce",
    "commit_url": "https://github.com/tinymce/tinymce/commit/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1",
    "files": [
      "modules/tinymce/CHANGELOG.md",
      "modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
      "modules/tinymce/src/core/main/ts/api/Options.ts",
      "modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
      "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
      "modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
      "modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
      "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
      "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
      "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
      "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
      "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
      "modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts"
    ],
    "message": "TINY-10348 & TINY-10349: Add sandbox_iframes and convert_unsafe_embeds options (#9172)\n\n* TINY-10348: Add sandbox_iframes option\n\n* TINY-10349: Add convert_unsafe_embeds option\n\n* TINY-10348 & TINY-10349: Add paste tests\n\n* TINY-10348 & TINY-10349: Add changelog entries\n\n* TINY-10348: Add missing PageBreakPlugin dependency in SelectionToolbarTest\n\n* TINY-10349: Add attribute preservation tests for convert_unsafe_embeds",
    "before_after_code_files": [
      "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
      "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
      "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
      "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
      "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
      "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
      "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
      "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
      "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
      "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
      "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts||modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
      "modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts||modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts"
    ]
  },
  "patch_diff": {
    "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts": [
      "File: modules/tinymce/src/core/main/ts/api/OptionTypes.ts -> modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "86:   contextmenu?: string | string[] | false;",
      "87:   contextmenu_never_use_native?: boolean;",
      "88:   convert_fonts_to_spans?: boolean;",
      "89:   convert_urls?: boolean;",
      "90:   custom_colors?: boolean;",
      "91:   custom_elements?: string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "89:   convert_unsafe_embeds?: boolean;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "197:   resize?: boolean | 'both';",
      "198:   resize_img_proportional?: boolean;",
      "199:   root_name?: string;",
      "200:   schema?: SchemaType;",
      "201:   selector?: string;",
      "202:   setup?: SetupCallback;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "201:   sandbox_iframes?: boolean;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "289:   color_default_foreground: string;",
      "290:   content_css: string[];",
      "291:   contextmenu: string[];",
      "292:   custom_colors: boolean;",
      "293:   default_font_stack: string[];",
      "294:   document_base_url: string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "294:   convert_unsafe_embeds: boolean;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "336:   promotion: boolean;",
      "337:   readonly: boolean;",
      "338:   removed_menuitems: string;",
      "339:   toolbar: boolean | string | string[] | Array<ToolbarGroup>;",
      "340:   toolbar_groups: Record<string, Toolbar.GroupToolbarButtonSpec>;",
      "341:   toolbar_location: ToolbarLocation;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "342:   sandbox_iframes: boolean;",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
      "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "836:     default: 'off',",
      "837:   });",
      "840:   editor.on('ScriptsLoaded', () => {",
      "841:     registerOption('directionality', {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "839:   registerOption('sandbox_iframes', {",
      "840:     processor: 'boolean',",
      "841:     default: false",
      "842:   });",
      "844:   registerOption('convert_unsafe_embeds', {",
      "845:     processor: 'boolean',",
      "846:     default: false",
      "847:   });",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "944: const shouldHighlightOnFocus = option('highlight_on_focus');",
      "945: const shouldSanitizeXss = option('xss_sanitization');",
      "946: const shouldUseDocumentWrite = option('init_content_sync');",
      "963: const hasTableTabNavigation = option('table_tab_navigation');",
      "965: const getDetailsInitialState = option('details_initial_state');",
      "966: const getDetailsSerializedState = option('details_serialized_state');",
      "968: const shouldForceHexColor = option('force_hex_color');",
      "970: export {",
      "971:   register,",
      "",
      "[Removed Lines]",
      "948: const hasTextPatternsLookup = (editor: Editor): boolean =>",
      "949:   editor.options.isSet('text_patterns_lookup');",
      "951: const getFontStyleValues = (editor: Editor): string[] =>",
      "952:   Tools.explode(editor.options.get('font_size_style_values'));",
      "954: const getFontSizeClasses = (editor: Editor): string[] =>",
      "955:   Tools.explode(editor.options.get('font_size_classes'));",
      "957: const isEncodingXml = (editor: Editor): boolean =>",
      "958:   editor.options.get('encoding') === 'xml';",
      "960: const getAllowedImageFileTypes = (editor: Editor): string[] =>",
      "961:   Tools.explode(editor.options.get('images_file_types'));",
      "",
      "[Added Lines]",
      "957: const hasTextPatternsLookup = (editor: Editor): boolean => editor.options.isSet('text_patterns_lookup');",
      "958: const getFontStyleValues = (editor: Editor): string[] => Tools.explode(editor.options.get('font_size_style_values'));",
      "959: const getFontSizeClasses = (editor: Editor): string[] => Tools.explode(editor.options.get('font_size_classes'));",
      "960: const isEncodingXml = (editor: Editor): boolean => editor.options.get('encoding') === 'xml';",
      "961: const getAllowedImageFileTypes = (editor: Editor): string[] => Tools.explode(editor.options.get('images_file_types'));",
      "966: const shouldSandboxIframes = option('sandbox_iframes');",
      "967: const shouldConvertUnsafeEmbeds = option('convert_unsafe_embeds');",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1071:   getDetailsInitialState,",
      "1072:   getDetailsSerializedState,",
      "1073:   shouldUseDocumentWrite,",
      "1075: };",
      "",
      "[Removed Lines]",
      "1074:   shouldForceHexColor",
      "",
      "[Added Lines]",
      "1073:   shouldForceHexColor,",
      "1074:   shouldSandboxIframes,",
      "1075:   shouldConvertUnsafeEmbeds",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts": [
      "File: modules/tinymce/src/core/main/ts/api/html/DomParser.ts -> modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "57:   allow_unsafe_link_target?: boolean;",
      "58:   blob_cache?: BlobCache;",
      "59:   convert_fonts_to_spans?: boolean;",
      "60:   document?: Document;",
      "61:   fix_list_elements?: boolean;",
      "62:   font_size_legacy_values?: string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "60:   convert_unsafe_embeds?: boolean;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "70:   remove_trailing_brs?: boolean;",
      "71:   root_name?: string;",
      "72:   sanitize?: boolean;",
      "73:   validate?: boolean;",
      "74: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "73:   sandbox_iframes?: boolean;",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts": [
      "File: modules/tinymce/src/core/main/ts/content/PrePostProcess.ts -> modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: import Editor from '../api/Editor';",
      "4: import * as Events from '../api/Events';",
      "6: import HtmlSerializer from '../api/html/Serializer';",
      "7: import * as Options from '../api/Options';",
      "8: import { EditorEvent } from '../api/util/EventDispatcher';",
      "",
      "[Removed Lines]",
      "5: import DomParser from '../api/html/DomParser';",
      "",
      "[Added Lines]",
      "5: import DomParser, { DomParserSettings } from '../api/html/DomParser';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "11: const serializeContent = (content: Content): string =>",
      "12:   isTreeNode(content) ? HtmlSerializer({ validate: false }).serialize(content) : content;",
      "15:   const serializedContent = serializeContent(content);",
      "16:   const eventArgs = fireEvent(serializedContent);",
      "17:   if (eventArgs.isDefaultPrevented()) {",
      "",
      "[Removed Lines]",
      "14: const withSerializedContent = <R extends EditorEvent<{ content: string }>>(content: Content, fireEvent: (content: string) => R, sanitize: boolean): R & { content: Content } => {",
      "",
      "[Added Lines]",
      "14: const withSerializedContent = <R extends EditorEvent<{ content: string }>>(content: Content, fireEvent: (content: string) => R, parserSettings: DomParserSettings): R & { content: Content } => {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "22:     if (eventArgs.content !== serializedContent) {",
      "24:       return { ...eventArgs, content: rootNode };",
      "25:     } else {",
      "26:       return { ...eventArgs, content };",
      "",
      "[Removed Lines]",
      "23:       const rootNode = DomParser({ validate: false, forced_root_block: false, sanitize }).parse(eventArgs.content, { context: content.name });",
      "",
      "[Added Lines]",
      "23:       const rootNode = DomParser({ validate: false, forced_root_block: false, ...parserSettings }).parse(eventArgs.content, { context: content.name });",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "47:   if (args.no_events) {",
      "48:     return content;",
      "49:   } else {",
      "51:     return processedEventArgs.content;",
      "52:   }",
      "53: };",
      "",
      "[Removed Lines]",
      "50:     const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), Options.shouldSanitizeXss(editor));",
      "",
      "[Added Lines]",
      "50:     const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), { sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) });",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "56:   if (args.no_events) {",
      "57:     return Result.value(args);",
      "58:   } else {",
      "60:     if (processedEventArgs.isDefaultPrevented()) {",
      "61:       Events.fireSetContent(editor, processedEventArgs);",
      "62:       return Result.error(undefined);",
      "",
      "[Removed Lines]",
      "59:     const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), Options.shouldSanitizeXss(editor));",
      "",
      "[Added Lines]",
      "59:     const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), { sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts": [
      "File: modules/tinymce/src/core/main/ts/html/ParserFilters.ts -> modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: import Env from '../api/Env';",
      "4: import DomParser, { DomParserSettings } from '../api/html/DomParser';",
      "",
      "[Removed Lines]",
      "1: import { Arr, Type } from '@ephox/katamari';",
      "",
      "[Added Lines]",
      "1: import { Arr, Strings, Type } from '@ephox/katamari';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "32:   }",
      "33: };",
      "35: const register = (parser: DomParser, settings: DomParserSettings): void => {",
      "36:   const schema = parser.schema;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "35: const isMimeType = (mime: string, type: 'image' | 'video' | 'audio'): boolean => Strings.startsWith(mime, `${type}/`);",
      "37: const createSafeEmbed = (mime?: string, src?: string, width?: string, height?: string, sandboxIframes?: boolean): AstNode => {",
      "38:   let name: 'iframe' | 'img' | 'video' | 'audio';",
      "39:   if (Type.isUndefined(mime)) {",
      "40:     name = 'iframe';",
      "41:   } else if (isMimeType(mime, 'image')) {",
      "42:     name = 'img';",
      "43:   } else if (isMimeType(mime, 'video')) {",
      "44:     name = 'video';",
      "45:   } else if (isMimeType(mime, 'audio')) {",
      "46:     name = 'audio';",
      "47:   } else {",
      "48:     name = 'iframe';",
      "49:   }",
      "51:   const embed = new AstNode(name, 1);",
      "52:   embed.attr(name === 'audio' ? { src } : { src, width, height });",
      "55:   if (name === 'audio' || name === 'video') {",
      "56:     embed.attr('controls', '');",
      "57:   }",
      "59:   if (name === 'iframe' && sandboxIframes) {",
      "60:     embed.attr('sandbox', '');",
      "61:   }",
      "62:   return embed;",
      "63: };",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "153:   }",
      "155:   registerBase64ImageFilter(parser, settings);",
      "156: };",
      "158: export {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "187:   if (settings.convert_unsafe_embeds) {",
      "188:     parser.addNodeFilter('object,embed', (nodes) => Arr.each(nodes, (node) => {",
      "189:       node.replace(",
      "190:         createSafeEmbed(",
      "191:           node.attr('type'),",
      "192:           node.name === 'object' ? node.attr('data') : node.attr('src'),",
      "193:           node.attr('width'),",
      "194:           node.attr('height'),",
      "195:           settings.sandbox_iframes",
      "196:         ));",
      "197:     }));",
      "198:   }",
      "200:   if (settings.sandbox_iframes) {",
      "201:     parser.addNodeFilter('iframe', (nodes) => Arr.each(nodes, (node) => node.attr('sandbox', '')));",
      "202:   }",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts": [
      "File: modules/tinymce/src/core/main/ts/init/InitContentBody.ts -> modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "73:     allow_html_in_named_anchor: getOption('allow_html_in_named_anchor'),",
      "74:     allow_script_urls: getOption('allow_script_urls'),",
      "75:     allow_unsafe_link_target: getOption('allow_unsafe_link_target'),",
      "76:     convert_fonts_to_spans: getOption('convert_fonts_to_spans'),",
      "77:     fix_list_elements: getOption('fix_list_elements'),",
      "78:     font_size_legacy_values: getOption('font_size_legacy_values'),",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "76:     convert_unsafe_embeds: getOption('convert_unsafe_embeds'),",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "81:     preserve_cdata: getOption('preserve_cdata'),",
      "82:     inline_styles: getOption('inline_styles'),",
      "83:     root_name: getRootName(editor),",
      "84:     sanitize: getOption('xss_sanitization'),",
      "85:     validate: true,",
      "86:     blob_cache: blobCache,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "85:     sandbox_iframes: getOption('sandbox_iframes'),",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts": [
      "File: modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts -> modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "11: }",
      "13: const preProcess = (editor: Editor, html: string): string => {",
      "17:   parser.addNodeFilter('meta', (nodes) => {",
      "",
      "[Removed Lines]",
      "14:   const parser = DomParser({ sanitize: Options.shouldSanitizeXss(editor) }, editor.schema);",
      "",
      "[Added Lines]",
      "14:   const parser = DomParser({ sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) }, editor.schema);",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts": [
      "File: modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts -> modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "350:             assert.equal(content, final, 'ZWNBSP should be stripped');",
      "351:           });",
      "352:         });",
      "353:       });",
      "354:     }",
      "355:   );",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "354:         context('iframe sandboxing', () => {",
      "355:           context('sandbox_iframes default', () => {",
      "356:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "357:               ...options,",
      "358:               base_url: '/project/tinymce/js/tinymce'",
      "359:             }, []);",
      "361:             it('TINY-10348: Iframe should not be sandboxed by default', () => {",
      "362:               const editor = hook.editor();",
      "363:               editor.setContent('<iframe src=\"about:blank\"></iframe>');",
      "364:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\"></iframe></p>');",
      "365:             });",
      "366:           });",
      "368:           context('sandbox_iframes: false', () => {",
      "369:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "370:               ...options,",
      "371:               base_url: '/project/tinymce/js/tinymce',",
      "372:               sandbox_iframes: false",
      "373:             }, []);",
      "375:             it('TINY-10348: Iframe should not be sandboxed when sandbox_iframes: false', () => {",
      "376:               const editor = hook.editor();",
      "377:               editor.setContent('<iframe src=\"about:blank\"></iframe>');",
      "378:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\"></iframe></p>');",
      "379:             });",
      "381:             it('TINY-10348: Iframe with sandbox attribute should not be modified when sandbox_iframes: false', () => {",
      "382:               const editor = hook.editor();",
      "383:               editor.setContent('<iframe src=\"about:blank\" sandbox=\"allow-scripts allow-same-origin allow-forms\"></iframe>');",
      "384:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"allow-scripts allow-same-origin allow-forms\"></iframe></p>');",
      "385:             });",
      "386:           });",
      "388:           context('sandbox_iframes: true', () => {",
      "389:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "390:               ...options,",
      "391:               base_url: '/project/tinymce/js/tinymce',",
      "392:               sandbox_iframes: true",
      "393:             }, []);",
      "395:             it('TINY-10348: Iframe should be sandboxed when sandbox_iframes: true', () => {",
      "396:               const editor = hook.editor();",
      "397:               editor.setContent('<iframe src=\"about:blank\"></iframe>');",
      "398:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>');",
      "399:             });",
      "401:             it('TINY-10348: Iframe with sandbox attribute should be sandboxed when sandbox_iframes: true', () => {",
      "402:               const editor = hook.editor();",
      "403:               editor.setContent('<iframe src=\"about:blank\" sandbox=\"allow-scripts allow-same-origin allow-forms\"></iframe>');",
      "404:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>');",
      "405:             });",
      "406:           });",
      "407:         });",
      "409:         context('Convert unsafe embeds', () => {",
      "410:           const setAndAssertEmbed = (editor: Editor, embedHtml: string, expectedHtml: string) => {",
      "411:             editor.setContent(embedHtml);",
      "412:             TinyAssertions.assertContent(editor, `<p>${expectedHtml}</p>`);",
      "413:           };",
      "415:           const testNoConversion = (hook: TinyHooks.Hook<Editor>, embedHtml: string) => () => {",
      "416:             const editor = hook.editor();",
      "417:             setAndAssertEmbed(editor, embedHtml, embedHtml);",
      "418:           };",
      "420:           const testConversion = (hook: TinyHooks.Hook<Editor>, embedHtml: string, expectedHtml: string) => () => {",
      "421:             const editor = hook.editor();",
      "422:             setAndAssertEmbed(editor, embedHtml, expectedHtml);",
      "423:           };",
      "425:           context('convert_unsafe_embeds default', () => {",
      "426:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "427:               ...options,",
      "428:               base_url: '/project/tinymce/js/tinymce'",
      "429:             }, []);",
      "431:             it('TINY-10349: Object elements should not be converted', testNoConversion(hook, '<object data=\"about:blank\"></object>'));",
      "432:             it('TINY-10349: Embed elements should not be converted', testNoConversion(hook, '<embed src=\"about:blank\">'));",
      "433:           });",
      "435:           context('convert_unsafe_embeds: false', () => {",
      "436:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "437:               ...options,",
      "438:               base_url: '/project/tinymce/js/tinymce',",
      "439:               convert_unsafe_embeds: false",
      "440:             }, []);",
      "442:             it('TINY-10349: Object elements should not be converted', testNoConversion(hook, '<object data=\"about:blank\"></object>'));",
      "443:             it('TINY-10349: Embed elements should not be converted', testNoConversion(hook, '<embed src=\"about:blank\">'));",
      "444:           });",
      "446:           context('convert_unsafe_embeds: true', () => {",
      "447:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "448:               ...options,",
      "449:               base_url: '/project/tinymce/js/tinymce',",
      "450:               convert_unsafe_embeds: true",
      "451:             }, []);",
      "453:             it('TINY-10349: Object elements should be converted to iframe',",
      "454:               testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
      "456:             it('TINY-10349: Embed elements should be converted to iframe',",
      "457:               testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\"></iframe>'));",
      "458:           });",
      "460:           context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
      "461:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "462:               ...options,",
      "463:               base_url: '/project/tinymce/js/tinymce',",
      "464:               convert_unsafe_embeds: true,",
      "465:               sandbox_iframes: true",
      "466:             }, []);",
      "468:             it('TINY-10349: Object elements should be converted to sandboxed iframe',",
      "469:               testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "471:             it('TINY-10349: Embed elements should be converted to sandboxed iframe',",
      "472:               testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "473:           });",
      "474:         });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts": [
      "File: modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts -> modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "1531:           }));",
      "1532:         });",
      "1533:       });",
      "1534:     });",
      "1535:   });",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1535:       context('Sandboxing iframes', () => {",
      "1536:         const serializeIframeHtml = (sandbox: boolean): string => {",
      "1537:           const parser = DomParser({ ...scenario.settings, sandbox_iframes: sandbox });",
      "1538:           return serializer.serialize(parser.parse('<iframe src=\"about:blank\"></iframe>'));",
      "1539:         };",
      "1541:         it('TINY-10348: iframes should be sandboxed when sandbox_iframes: false', () =>",
      "1542:           assert.equal(serializeIframeHtml(false), '<iframe src=\"about:blank\"></iframe>'));",
      "1544:         it('TINY-10348: iframes should be sandboxed when sandbox_iframes: true', () =>",
      "1545:           assert.equal(serializeIframeHtml(true), '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "1546:       });",
      "1548:       context('Convert unsafe embeds', () => {",
      "1549:         const serializeEmbedHtml = (embedHtml: string, convert: boolean): string => {",
      "1550:           const parser = DomParser({ ...scenario.settings, convert_unsafe_embeds: convert });",
      "1551:           return serializer.serialize(parser.parse(embedHtml));",
      "1552:         };",
      "1554:         const testConversion = (embedHtml: string, expectedHtml: string) => () => {",
      "1555:           const serializedHtml = serializeEmbedHtml(embedHtml, true);",
      "1556:           assert.equal(serializedHtml, expectedHtml);",
      "1557:         };",
      "1559:         context('convert_unsafe_embeds: false', () => {",
      "1560:           const testNoConversion = (embedHtml: string) => () => {",
      "1561:             const serializedHtml = serializeEmbedHtml(embedHtml, false);",
      "1562:             assert.equal(serializedHtml, embedHtml);",
      "1563:           };",
      "1565:           it('TINY-10349: Object elements should not be converted', testNoConversion('<object data=\"about:blank\"></object>'));",
      "1566:           it('TINY-10349: Object elements with a mime type should not be converted', testNoConversion('<object data=\"about:blank\" type=\"image/png\"></object>'));",
      "1567:           it('TINY-10349: Embed elements should notr be converted', testNoConversion('<embed src=\"about:blank\">'));",
      "1568:           it('TINY-10349: Embed elements with a mime type should not be converted', testNoConversion('<embed src=\"about:blank\" type=\"image/png\">'));",
      "1569:         });",
      "1571:         context('convert_unsafe_embeds: true', () => {",
      "1572:           it('TINY-10349: Object elements without a mime type should be converted to iframe',",
      "1573:             testConversion('<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
      "1574:           it('TINY-10349: Object elements with an image mime type should be converted to img',",
      "1575:             testConversion('<object data=\"about:blank\" type=\"image/png\"></object>', '<img src=\"about:blank\">'));",
      "1576:           it('TINY-10349: Object elements with a video mime type should be converted to video',",
      "1577:             testConversion('<object data=\"about:blank\" type=\"video/mp4\"></object>', '<video src=\"about:blank\" controls=\"\"></video>'));",
      "1578:           it('TINY-10349: Object elements with an audio mime type should be converted to audio',",
      "1579:             testConversion('<object data=\"about:blank\" type=\"audio/mpeg\"></object>', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1580:           it('TINY-10349: Object elements with other mime type should be converted to iframe',",
      "1581:             testConversion('<object data=\"about:blank\" type=\"application/pdf\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
      "1583:           it('TINY-10349: Embed elements without a mime type should be converted to iframe',",
      "1584:             testConversion('<embed src=\"about:blank\">', '<iframe src=\"about:blank\"></iframe>'));",
      "1585:           it('TINY-10349: Embed elements with an image mime type should be converted to img',",
      "1586:             testConversion('<embed src=\"about:blank\" type=\"image/png\">', '<img src=\"about:blank\">'));",
      "1587:           it('TINY-10349: Embed elements with a video mime type should be converted to video',",
      "1588:             testConversion('<embed src=\"about:blank\" type=\"video/mp4\">', '<video src=\"about:blank\" controls=\"\"></video>'));",
      "1589:           it('TINY-10349: Embed elements with an audio mime type should be converted to audio',",
      "1590:             testConversion('<embed src=\"about:blank\" type=\"audio/mpeg\">', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1591:           it('TINY-10349: Embed elements with other mime type should be converted to iframe',",
      "1592:             testConversion('<embed src=\"about:blank\" type=\"application/pdf\">', '<iframe src=\"about:blank\"></iframe>'));",
      "1593:         });",
      "1595:         context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
      "1596:           const testSandboxedConversion = (embedHtml: string, expectedHtml: string) => () => {",
      "1597:             const parser = DomParser({ ...scenario.settings, convert_unsafe_embeds: true, sandbox_iframes: true });",
      "1598:             const serializedHtml = serializer.serialize(parser.parse(embedHtml));",
      "1599:             assert.equal(serializedHtml, expectedHtml);",
      "1600:           };",
      "1602:           it('TINY-10349: Object elements without a mime type should be converted to sandboxed iframe',",
      "1603:             testSandboxedConversion('<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "1605:           it('TINY-10349: Embed elements without a mime type should be converted to sandboxed iframe',",
      "1606:             testSandboxedConversion('<embed src=\"about:blank\">', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "1607:         });",
      "1609:         context('convert_unsafe_embeds: true, attribute preservation', () => {",
      "1610:           it('TINY-10349: Object elements should perserve width and height attributes only',",
      "1611:             testConversion('<object data=\"about:blank\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1612:           it('TINY-10349: Object elements with an image mime type should perserve width and height attributes only',",
      "1613:             testConversion('<object data=\"about:blank\" type=\"image/png\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<img src=\"about:blank\" width=\"100\" height=\"100\">'));",
      "1614:           it('TINY-10349: Object elements with a video mime type should perserve width and height attributes only',",
      "1615:             testConversion('<object data=\"about:blank\" type=\"video/mp4\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<video src=\"about:blank\" width=\"100\" height=\"100\" controls=\"\"></video>'));",
      "1616:           it('TINY-10349: Object elements with an audio mime type should not perserve other attributes only',",
      "1617:             testConversion('<object data=\"about:blank\" type=\"audio/mpeg\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1618:           it('TINY-10349: Object elements with other mime type should perserve width and height attributes only',",
      "1619:             testConversion('<object data=\"about:blank\" type=\"application/pdf\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1621:           it('TINY-10349: Embed elements should preserve width and heigth attributes only',",
      "1622:             testConversion('<embed src=\"about:blank\" width=\"100\" height=\"100\" style=\"color: red;\">', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1623:           it('TINY-10349: Embed elements with an image mime type should preserve width and height attributes only',",
      "1624:             testConversion('<embed src=\"about:blank\" type=\"image/png\" width=\"100\" height=\"100\" style=\"color: red;\">', '<img src=\"about:blank\" width=\"100\" height=\"100\">'));",
      "1625:           it('TINY-10349: Embed elements with a video mime type should preserve width and height attributes only',",
      "1626:             testConversion('<embed src=\"about:blank\" type=\"video/mp4\" width=\"100\" height=\"100\" style=\"color: red;\">', '<video src=\"about:blank\" width=\"100\" height=\"100\" controls=\"\"></video>'));",
      "1627:           it('TINY-10349: Embed elements with an audio mime type should not preserve other attributes',",
      "1628:             testConversion('<embed src=\"about:blank\" type=\"audio/mpeg\" width=\"100\" height=\"100\" style=\"color: red;\">', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1629:           it('TINY-10349: Embed elements with other mime type should preserve width and height attributes only',",
      "1630:             testConversion('<embed src=\"about:blank\" type=\"application/pdf\" width=\"100\" height=\"100\" style=\"color: red;\">', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1631:         });",
      "1632:       });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts": [
      "File: modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts -> modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "19:     base_url: '/project/tinymce/js/tinymce'",
      "20:   }, [], true);",
      "22:   beforeEach(() => {",
      "23:     const editor = hook.editor();",
      "24:     editor.setContent('');",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22:   const testPasteHtml = (hook: TinyHooks.Hook<Editor>, html: string, expected: string) => () => {",
      "23:     const editor = hook.editor();",
      "24:     editor.setContent('');",
      "25:     editor.execCommand('mceInsertClipboardContent', false, { html });",
      "26:     TinyAssertions.assertContent(editor, expected);",
      "27:   };",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "505:       editor.off('beforeinput', setBeforeInputEvent);",
      "506:       editor.off('input', setInputEvent);",
      "507:     });",
      "508:   });",
      "509: });",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "516:     context('iframe sandboxing', () => {",
      "517:       context('sandbox_iframes: false', () => {",
      "518:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "519:           base_url: '/project/tinymce/js/tinymce',",
      "520:           sandbox_iframes: false",
      "521:         });",
      "523:         it('TINY-10348: Pasted iframe should not be sandboxed',",
      "524:           testPasteHtml(hook, '<iframe src=\"about:blank\"></iframe>', '<p><iframe src=\"about:blank\"></iframe></p>'));",
      "525:       });",
      "527:       context('sandbox_iframes: true', () => {",
      "528:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "529:           base_url: '/project/tinymce/js/tinymce',",
      "530:           sandbox_iframes: true",
      "531:         });",
      "533:         it('TINY-10348: Pasted iframe should be sandboxed',",
      "534:           testPasteHtml(hook, '<iframe src=\"about:blank\"></iframe>', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
      "535:       });",
      "536:     });",
      "538:     context('Convert unsafe embeds', () => {",
      "539:       context('convert_unsafe_embeds: false', () => {",
      "540:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "541:           base_url: '/project/tinymce/js/tinymce',",
      "542:           convert_unsafe_embeds: false",
      "543:         });",
      "545:         it('TINY-10349: Pasted object element should not be converted',",
      "546:           testPasteHtml(hook, '<object data=\"about:blank\"></object>', '<p><object data=\"about:blank\"></object></p>'));",
      "548:         it('TINY-10349: Pasted embed element should not be converted',",
      "549:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><embed src=\"about:blank\"></p>'));",
      "550:       });",
      "552:       context('convert_unsafe_embeds: true', () => {",
      "553:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "554:           base_url: '/project/tinymce/js/tinymce',",
      "555:           convert_unsafe_embeds: true",
      "556:         });",
      "558:         it('TINY-10349: Pasted object element should be converted to iframe',",
      "559:           testPasteHtml(hook, '<object data=\"about:blank\">', '<p><iframe src=\"about:blank\"></iframe></p>'));",
      "561:         it('TINY-10349: Pasted embed element should be converted to iframe',",
      "562:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><iframe src=\"about:blank\"></iframe></p>'));",
      "563:       });",
      "565:       context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
      "566:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "567:           base_url: '/project/tinymce/js/tinymce',",
      "568:           convert_unsafe_embeds: true,",
      "569:           sandbox_iframes: true",
      "570:         });",
      "572:         it('TINY-10349: Pasted object element should be converted to sandboxed iframe',",
      "573:           testPasteHtml(hook, '<object data=\"about:blank\"></object>', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
      "575:         it('TINY-10349: Pasted embed element should be converted to sandboxed iframe',",
      "576:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
      "577:       });",
      "578:     });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts||modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts": [
      "File: modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts -> modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "91:   if (name === 'iframe') {",
      "92:     previewNode.attr({",
      "93:       allowfullscreen: node.attr('allowfullscreen'),",
      "95:     });",
      "96:   } else {",
      "",
      "[Removed Lines]",
      "94:       frameborder: '0'",
      "",
      "[Added Lines]",
      "94:       frameborder: '0',",
      "95:       sandbox: node.attr('sandbox')",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts": [
      "File: modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "57:     );",
      "58:   });",
      "60:   it('TBA: Iframe with innerHTML retained as is with xss_sanitization: false', async () => {",
      "62:     const editor = await McEditor.pFromSettings<Editor>({",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "60:   it('TINY-10348: Iframe retained as is with sandbox_iframes: false', async () => {",
      "61:     const editor = await McEditor.pFromSettings({ ...settings, sandbox_iframes: false });",
      "62:     editor.setContent('<iframe src=\"320x240.ogg\" allowfullscreen></iframe>');",
      "63:     TinyAssertions.assertContent(editor,",
      "64:       '<p><iframe src=\"320x240.ogg\" width=\"300\" height=\"150\" allowfullscreen=\"allowfullscreen\"></iframe></p>'",
      "65:     );",
      "66:     McEditor.remove(editor);",
      "67:   });",
      "69:   it('TINY-10348: Iframe retained as is with sandbox_iframes: true', async () => {",
      "70:     const editor = await McEditor.pFromSettings({ ...settings, sandbox_iframes: true });",
      "71:     editor.setContent('<iframe src=\"320x240.ogg\" allowfullscreen></iframe>');",
      "72:     TinyAssertions.assertContent(editor,",
      "73:       '<p><iframe src=\"320x240.ogg\" width=\"300\" height=\"150\" sandbox=\"\" allowfullscreen=\"allowfullscreen\"></iframe></p>'",
      "74:     );",
      "75:     McEditor.remove(editor);",
      "76:   });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts": [
      "File: modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: import { ApproxStructure, Assertions, StructAssert, UiFinder } from '@ephox/agar';",
      "6: import Editor from 'tinymce/core/api/Editor';",
      "7: import Plugin from 'tinymce/plugins/media/Plugin';",
      "9: describe('browser.tinymce.plugins.media.core.LiveEmbedNodeTest', () => {",
      "11:     plugins: [ 'media' ],",
      "13:     base_url: '/project/tinymce/js/tinymce'",
      "14:   }, [ Plugin ]);",
      "",
      "[Removed Lines]",
      "2: import { describe, it } from '@ephox/bedrock-client';",
      "3: import { Arr, Fun, Obj } from '@ephox/katamari';",
      "4: import { TinyDom, TinyHooks } from '@ephox/wrap-mcagar';",
      "10:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "12:     toolbar: 'media',",
      "",
      "[Added Lines]",
      "2: import { context, describe, it } from '@ephox/bedrock-client';",
      "3: import { Arr, Fun, Obj, Type } from '@ephox/katamari';",
      "4: import { McEditor, TinyDom, TinyHooks } from '@ephox/wrap-mcagar';",
      "10:   const baseSettings = {",
      "12:     toolbar: 'media'",
      "13:   };",
      "14:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "15:     ...baseSettings,",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "17:     editor: Editor,",
      "18:     tag: string,",
      "19:     classes: string[],",
      "21:     styles: Record<string, string>,",
      "22:     getChildren: ApproxStructure.Builder<StructAssert[]> = Fun.constant([])",
      "23:   ) => {",
      "",
      "[Removed Lines]",
      "20:     attrs: Record<string, string>,",
      "",
      "[Added Lines]",
      "23:     attrs: Record<string, string | null>,",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "36:           attrs: {",
      "37:             height: str.none('should not have height'),",
      "38:             width: str.none('should not have width'),",
      "40:           },",
      "41:           styles: {",
      "42:             height: str.none('should not have height style'),",
      "",
      "[Removed Lines]",
      "39:             ...Obj.map(attrs, (value) => str.is(value))",
      "",
      "[Added Lines]",
      "42:             ...Obj.map(attrs, (value) => Type.isNull(value) ? str.none() : str.is(value))",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "131:       })",
      "132:     ]);",
      "133:   });",
      "134: });",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "138:   context('Sandboxing iframes', () => {",
      "139:     const initialIframeHtml = '<iframe src=\"about:blank\"></iframe>';",
      "141:     it('TINY-10348: sandbox_iframes: false should not have sandbox attribute in live embed', async () => {",
      "142:       const editor = await McEditor.pFromSettings<Editor>({ ...baseSettings, sandbox_iframes: false });",
      "143:       editor.setContent(initialIframeHtml);",
      "144:       assertStructure(editor, 'iframe', [ ], { sandbox: null }, { });",
      "145:     });",
      "147:     it('TINY-10348: sandbox_iframes: true should havce sandbox attribute in live embed', async () => {",
      "148:       const editor = await McEditor.pFromSettings<Editor>({ ...baseSettings, sandbox_iframes: true });",
      "149:       editor.setContent(initialIframeHtml);",
      "150:       assertStructure(editor, 'iframe', [ ], { sandbox: '' }, { });",
      "151:     });",
      "152:   });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts": [
      "File: modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: import { ApproxStructure, StructAssert, Waiter } from '@ephox/agar';",
      "2: import { before, context, describe, it } from '@ephox/bedrock-client';",
      "5: import Editor from 'tinymce/core/api/Editor';",
      "6: import Env from 'tinymce/core/api/Env';",
      "",
      "[Removed Lines]",
      "3: import { TinyAssertions, TinyHooks, TinyUiActions } from '@ephox/wrap-mcagar';",
      "",
      "[Added Lines]",
      "3: import { McEditor, TinyAssertions, TinyHooks, TinyUiActions } from '@ephox/wrap-mcagar';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "9: import * as Utils from '../module/test/Utils';",
      "11: describe('browser.tinymce.plugins.media.core.PlaceholderTest', () => {",
      "13:     plugins: [ 'media' ],",
      "14:     toolbar: 'media',",
      "16:     base_url: '/project/tinymce/js/tinymce'",
      "17:   }, [ Plugin ]);",
      "",
      "[Removed Lines]",
      "12:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "15:     extended_valid_elements: 'script[src|type]',",
      "",
      "[Added Lines]",
      "12:   const baseSettings = {",
      "15:     extended_valid_elements: 'script[src|type]'",
      "16:   };",
      "18:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "19:     ...baseSettings,",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "42:     });",
      "43:   });",
      "63:   context('media_live_embeds=false', () => {",
      "64:     before(() => {",
      "65:       const editor = hook.editor();",
      "",
      "[Removed Lines]",
      "45:   const iframeStructure = ApproxStructure.build((s) => {",
      "46:     return s.element('body', {",
      "47:       children: [",
      "48:         s.element('p', {",
      "49:           children: [",
      "50:             s.element('span', {",
      "51:               children: [",
      "52:                 s.element('iframe', {}),",
      "53:                 s.element('span', {})",
      "54:               ]",
      "55:             })",
      "56:           ]",
      "57:         }),",
      "58:         s.theRest()",
      "59:       ]",
      "60:     });",
      "61:   });",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "88:   });",
      "90:   context('media_live_embeds=true', () => {",
      "91:     before(() => {",
      "92:       const editor = hook.editor();",
      "93:       editor.options.set('media_live_embeds', true);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "77:     const createIframeStructure = (sandbox: boolean) => ApproxStructure.build((s, str) => {",
      "78:       return s.element('body', {",
      "79:         children: [",
      "80:           s.element('p', {",
      "81:             children: [",
      "82:               s.element('span', {",
      "83:                 children: [",
      "84:                   s.element('iframe', {",
      "85:                     attrs: {",
      "86:                       sandbox: sandbox ? str.is('') : str.none()",
      "87:                     }",
      "88:                   }),",
      "89:                   s.element('span', {})",
      "90:                 ]",
      "91:               })",
      "92:             ]",
      "93:           }),",
      "94:           s.theRest()",
      "95:         ]",
      "96:       });",
      "97:     });",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "97:       'https://www.youtube.com/watch?v=P_205ZY52pY',",
      "98:       '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
      "99:       'height=\"314\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
      "101:     ));",
      "102:   });",
      "103: });",
      "",
      "[Removed Lines]",
      "100:       iframeStructure",
      "",
      "[Added Lines]",
      "108:       createIframeStructure(false)",
      "111:     it('TINY-10348: Live iframe embed structure when sandbox_iframes: false', async () => {",
      "112:       const editor = await McEditor.pFromSettings<Editor>({",
      "113:         ...baseSettings,",
      "114:         sandbox_iframes: false",
      "115:       });",
      "116:       pTestPlaceholder(editor,",
      "117:         'https://www.youtube.com/watch?v=P_205ZY52pY',",
      "118:         '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
      "119:         'height=\"314\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
      "120:         createIframeStructure(false)",
      "121:       );",
      "122:     });",
      "124:     it('TINY-10348: Live iframe embed structure when sandbox_iframes: true', async () => {",
      "125:       const editor = await McEditor.pFromSettings<Editor>({",
      "126:         ...baseSettings,",
      "127:         sandbox_iframes: true",
      "128:       });",
      "129:       pTestPlaceholder(editor,",
      "130:         'https://www.youtube.com/watch?v=P_205ZY52pY',",
      "131:         '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
      "132:         'height=\"314\" sandbox=\"\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
      "133:         createIframeStructure(true)",
      "134:       );",
      "135:     });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts||modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts": [
      "File: modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts -> modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "6: import Editor from 'tinymce/core/api/Editor';",
      "7: import LinkPlugin from 'tinymce/plugins/link/Plugin';",
      "8: import QuickbarsPlugin from 'tinymce/plugins/quickbars/Plugin';",
      "10: enum Alignment {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "8: import PageBreakPlugin from 'tinymce/plugins/pagebreak/Plugin';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "20:     toolbar: false,",
      "21:     menubar: false,",
      "22:     base_url: '/project/tinymce/js/tinymce'",
      "25:   const imgSrc = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';",
      "",
      "[Removed Lines]",
      "23:   }, [ LinkPlugin, QuickbarsPlugin ], true);",
      "",
      "[Added Lines]",
      "24:   }, [ LinkPlugin, QuickbarsPlugin, PageBreakPlugin ], true);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "94acea35f3d5fb30a63b077690c49bb3c7c2aedc",
      "candidate_info": {
        "commit_hash": "94acea35f3d5fb30a63b077690c49bb3c7c2aedc",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/94acea35f3d5fb30a63b077690c49bb3c7c2aedc",
        "files": [
          ".changes/unreleased/polaris-TINY-10350-2024-01-04.yaml",
          ".changes/unreleased/tinymce-TINY-10350-2024-01-04.yaml",
          ".changes/unreleased/tinymce-TINY-10350-2024-01-04_2.yaml",
          "modules/polaris/src/main/ts/ephox/polaris/api/Main.ts",
          "modules/polaris/src/main/ts/ephox/polaris/api/Regexes.ts",
          "modules/polaris/src/main/ts/ephox/polaris/api/Strings.ts",
          "modules/polaris/src/main/ts/ephox/polaris/api/Url.ts",
          "modules/polaris/src/test/ts/atomic/api/RegexesTest.ts",
          "modules/polaris/src/test/ts/atomic/api/StringSplitTest.ts",
          "modules/polaris/src/test/ts/atomic/api/StringsSplitsTest.ts",
          "modules/polaris/src/test/ts/atomic/api/UrlTest.ts",
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
          "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
          "modules/tinymce/src/core/main/ts/html/Embed.ts",
          "modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
          "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
          "modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/EphoxEmbedTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/MediaAlignmentTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/SubmitTest.ts",
          "modules/tinymce/src/themes/silver/test/ts/browser/editor/SilverPopupSinkBoundsTest.ts",
          "versions.txt"
        ],
        "message": "TINY-10350: Implement iframe sandbox exclusions and default sandbox_iframes to true (#9280)\n\n* TINY-10350: Refactor RegexesTest using BDD\n\n* TINY-10350: Implement Regexes.extractHost function to extract host name from url string\n\n* TINY-10350: Adjust existing tests based on default behavior change of sandbox_iframes\n\n* TINY-10350: Implement iframe sandbox whitelisting via new sandbox_iframes_whitelist option and default sandbox_iframes to true\n\n* TINY-10350: Separate extractHost logic into a new Url module and place it under Polaris's Strings API module\n\n* TINY-10350: Adjusts tests to accommodate for sandbox_iframes: true default\n\n* TINY-10350: Add default whitelisted domains for iframe sandboxing\n\n* TINY-10350: Rename option to sandbox_iframes_exclusions and apply to parser on init\n\n* TINY-10350: Add changelog entries for TinyMCE and Polaris and update versions.txt\n\n* TINY-10350: Add changelog entry on change to sandbox_iframes option default\n\n* TINY-10350: Add edge-case exclusions tests to DomParserTest\n\n* TINY-10350: Move extractHost function to new Url API module in Polaris\n\n* TINY-10350: Set sandbox_iframe_exclusions to [] in unrelated tests to keep behavior consistency\n\n* TINY-10350: Apply suggestions\n\n* TINY-10350: Fix safari test\n\n* TINY-10350: Fix title attribute test\n\n* TINY-10350: Fix Safari tests\n\n* TINY-10350: Update tests with new default behaviour\n\n* TINY-10350: Fix safari tests\n\n---------\n\nCo-authored-by: MitchCTiny <89239746+MitchCTiny@users.noreply.github.com>",
        "before_after_code_files": [
          "modules/polaris/src/main/ts/ephox/polaris/api/Main.ts||modules/polaris/src/main/ts/ephox/polaris/api/Main.ts",
          "modules/polaris/src/main/ts/ephox/polaris/api/Regexes.ts||modules/polaris/src/main/ts/ephox/polaris/api/Regexes.ts",
          "modules/polaris/src/main/ts/ephox/polaris/api/Strings.ts||modules/polaris/src/main/ts/ephox/polaris/api/Strings.ts",
          "modules/polaris/src/main/ts/ephox/polaris/api/Url.ts||modules/polaris/src/main/ts/ephox/polaris/api/Url.ts",
          "modules/polaris/src/test/ts/atomic/api/RegexesTest.ts||modules/polaris/src/test/ts/atomic/api/RegexesTest.ts",
          "modules/polaris/src/test/ts/atomic/api/StringSplitTest.ts||modules/polaris/src/test/ts/atomic/api/StringSplitTest.ts",
          "modules/polaris/src/test/ts/atomic/api/StringsSplitsTest.ts||modules/polaris/src/test/ts/atomic/api/StringsSplitsTest.ts",
          "modules/polaris/src/test/ts/atomic/api/UrlTest.ts||modules/polaris/src/test/ts/atomic/api/UrlTest.ts",
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
          "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
          "modules/tinymce/src/core/main/ts/html/Embed.ts||modules/tinymce/src/core/main/ts/html/Embed.ts",
          "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
          "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
          "modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts||modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/EphoxEmbedTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/EphoxEmbedTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/MediaAlignmentTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/MediaAlignmentTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/SubmitTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/SubmitTest.ts",
          "modules/tinymce/src/themes/silver/test/ts/browser/editor/SilverPopupSinkBoundsTest.ts||modules/tinymce/src/themes/silver/test/ts/browser/editor/SilverPopupSinkBoundsTest.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
            "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
            "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
            "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
            "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
            "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
            "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
            "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
            "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
            "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
            "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
            "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
            "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
            "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
            "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
            "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
            "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/polaris/src/main/ts/ephox/polaris/api/Main.ts||modules/polaris/src/main/ts/ephox/polaris/api/Main.ts": [
          "File: modules/polaris/src/main/ts/ephox/polaris/api/Main.ts -> modules/polaris/src/main/ts/ephox/polaris/api/Main.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: import * as Search from './Search';",
          "8: import { Splitting } from './Splitting';",
          "9: import * as Strings from './Strings';",
          "10: import * as Words from './Words';",
          "12: export {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10: import * as Url from './Url';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "19:   Search,",
          "20:   Splitting,",
          "21:   Strings,",
          "22:   Words,",
          "23:   WordOptions",
          "",
          "[Removed Lines]",
          "24: };",
          "",
          "[Added Lines]",
          "23:   Url,",
          "",
          "---------------"
        ],
        "modules/polaris/src/main/ts/ephox/polaris/api/Regexes.ts||modules/polaris/src/main/ts/ephox/polaris/api/Regexes.ts": [
          "File: modules/polaris/src/main/ts/ephox/polaris/api/Regexes.ts -> modules/polaris/src/main/ts/ephox/polaris/api/Regexes.ts"
        ],
        "modules/polaris/src/main/ts/ephox/polaris/api/Strings.ts||modules/polaris/src/main/ts/ephox/polaris/api/Strings.ts": [
          "File: modules/polaris/src/main/ts/ephox/polaris/api/Strings.ts -> modules/polaris/src/main/ts/ephox/polaris/api/Strings.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "10: export {",
          "11:   cssSanitise,",
          "12:   splits",
          "",
          "[Removed Lines]",
          "13: };",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "modules/polaris/src/main/ts/ephox/polaris/api/Url.ts||modules/polaris/src/main/ts/ephox/polaris/api/Url.ts": [
          "File: modules/polaris/src/main/ts/ephox/polaris/api/Url.ts -> modules/polaris/src/main/ts/ephox/polaris/api/Url.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { Arr, Optional, Strings } from '@ephox/katamari';",
          "5: const hostCaptureRegex = /^(?:(?:(?:[A-Za-z][A-Za-z\\d.+-]{0,14}:\\/\\/(?:[-.~*+=!&;:'%@?^${}(),\\w]+@)?|www\\.|[-;:&=+$,.\\w]+@)([A-Za-z\\d-]+(?:\\.[A-Za-z\\d-]+)*))(?::\\d+)?(?:\\/(?:[-.~*+=!;:'%@$(),\\/\\w]*[-~*+=%@$()\\/\\w])?)?(?:\\?(?:[-.~*+=!&;:'%@?^${}(),\\/\\w]+)?)?(?:#(?:[-.~*+=!&;:'%@?^${}(),\\/\\w]+)?)?)$/;",
          "7: const extractHost = (url: string): Optional<string> =>",
          "8:   Optional.from(url.match(hostCaptureRegex)).bind((ms) => Arr.get(ms, 1)).map((h) => Strings.startsWith(h, 'www.') ? h.substring(4) : h);",
          "10: export {",
          "11:   extractHost",
          "12: };",
          "",
          "---------------"
        ],
        "modules/polaris/src/test/ts/atomic/api/RegexesTest.ts||modules/polaris/src/test/ts/atomic/api/RegexesTest.ts": [
          "File: modules/polaris/src/test/ts/atomic/api/RegexesTest.ts -> modules/polaris/src/test/ts/atomic/api/RegexesTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: import { Arr, Obj } from '@ephox/katamari';",
          "4: import * as Regexes from 'ephox/polaris/api/Regexes';",
          "165:       });",
          "256:   });",
          "300:   });",
          "301: });",
          "",
          "[Removed Lines]",
          "1: import { Assert, UnitTest } from '@ephox/bedrock-client';",
          "6: UnitTest.test('RegexesTest', () => {",
          "7:   const ephoxCases = [",
          "8:     'www.google.com.au',",
          "9:     'www.google.com.au:80',",
          "10:     'maurizio@ephox.com',",
          "11:     'http://www.ephox.com',",
          "12:     'https://www.google.it',",
          "13:     'mailto:maurizio@ephox.com',",
          "14:     'maurizio.napoleoni@ephox.com',",
          "15:     'http://maurizio@ephox.com:3443/mystuff',",
          "16:     'maurizio-napoleoni-email@gmail.com',",
          "17:     'http://link/',",
          "18:     'https://www.google.com.au/search?espv=2&q=hello+world&oq=hello+world&gs_l=serp.3..0l10.12435.15279.0.15482.13.9.0.3.3.0.241.1121.0j1j4.5.0.msedr...0...1c.1.64.serp..5.8.1125.GLORIzEXy3Y',",
          "19:     'https://icmobile4.rtp.raleigh.ibm.com/files/app#/file/d0f8ed3e-f6d2-4577-8989-fa21ac332a20',",
          "20:     `https://www.google.com.aa/test.htm?$-_.+!*'()test,test;test:test@=&`,",
          "21:     `http://-.~_!$&'()*+,;=:%40:80%2f::::::@example.com?-.~_!$&'()*+,;=:%40:80%2f::::::@e#-.~_!$&'()*+,;=:%40:80%2f::::::@e`,",
          "22:     'http://xn--domain.com',",
          "23:     'www.google.ca/index.htm?id=/bla/bla',",
          "24:     'https://www.amazon.com.au/gp/product/B0798R2WXG/ref=s9_acsd_top_hd_bw_b5QhTfX_c_x_w?pf_rd_m=ANEGB3WVEVKZB&pf_rd_s=merchandised-search-4&pf_rd_r=KF6SD7C0M69MKF2FR9CC&pf_rd_t=101&pf_rd_p=8ad3bdba-b846-5350-9c00-72c2cb7191dd&pf_rd_i=4975211051',",
          "25:     'https://www.birddoctor.net/refId,56511/refDownload.pml',",
          "26:     'https://www.example.com/:w:/s/b026324c6904b2a9cb4b88d6d61c81d1?q=abc123',",
          "27:     'https://website.com/test/!test'",
          "28:   ];",
          "31:   const mathiasBynens = [",
          "32:     'http://foo.com/blah_blah',",
          "33:     'http://foo.com/blah_blah/',",
          "34:     'http://foo.com/blah_blah_(wikipedia)',",
          "35:     'http://foo.com/blah_blah_(wikipedia)_(again)',",
          "36:     'http://www.example.com/wpstyle/?p=364',",
          "37:     'https://www.example.com/foo/?bar=baz&inga=42&quux',",
          "38:     'http://userid:password@example.com:8080',",
          "39:     'http://userid:password@example.com:8080/',",
          "40:     'http://userid@example.com',",
          "41:     'http://userid@example.com/',",
          "42:     'http://userid@example.com:8080',",
          "43:     'http://userid@example.com:8080/',",
          "44:     'http://userid:password@example.com',",
          "45:     'http://userid:password@example.com/',",
          "46:     'http://142.42.1.1/',",
          "47:     'http://142.42.1.1:8080/',",
          "48:     'http://foo.com/blah_(wikipedia)#cite-1',",
          "49:     'http://foo.com/blah_(wikipedia)_blah#cite-1',",
          "50:     'http://foo.com/(something)?after=parens',",
          "51:     'http://code.google.com/events/#&product=browser',",
          "52:     'http://j.mp',",
          "53:     'ftp://foo.bar/baz',",
          "54:     'http://foo.bar/?q=Test%20URL-encoded%20stuff',",
          "55:     `http://-.~_!$&'()*+,;=:%40:80%2f::::::@example.com`,",
          "56:     'http://1337.net',",
          "57:     'http://a.b-c.de',",
          "58:     'http://223.255.255.254'",
          "70:   ];",
          "72:   const validSchemes = [",
          "73:     'h://foo.com',",
          "74:     'h1://foo.com',",
          "75:     'h1+://foo.com',",
          "76:     'h1+.://foo.com',",
          "77:     'h1+.-://foo.com',",
          "78:     'p72internal://foo.com',",
          "79:     'but15characters://foo.com',",
          "80:   ];",
          "82:   const trueCases = ephoxCases.concat(mathiasBynens).concat(validSchemes);",
          "84:   const ephoxFalseCases = [",
          "85:     'I am not a link',",
          "86:     '#hashtag',",
          "87:     '@mention',",
          "88:     '[~jiramention]',",
          "89:     'aSimpleString',",
          "90:     'something.containing.dots',",
          "91:     '',",
          "92:     '\\n',",
          "93:     '',",
          "94:     'http://google.com.',",
          "95:     'http://google.com)',",
          "96:     'www.google.com.',",
          "97:     'www.google.com)',",
          "98:     'asdf:one'",
          "99:   ];",
          "101:   const mathiasBynensFalse = [",
          "102:     'http://',",
          "103:     'http://foo.bar?q=Spaces should be encoded',",
          "104:     'http:// shouldfail.com',",
          "105:     'http://foo.bar/foo(bar)baz quux',",
          "106:     'foo.com',",
          "107:     ':// should fail',",
          "108:     'http://?',",
          "109:     'http://??',",
          "110:     'http://??/',",
          "111:     'http://#',",
          "112:     'http://##',",
          "113:     'http://##/',",
          "114:     '//',",
          "115:     '//a',",
          "116:     '///a',",
          "117:     '///',",
          "118:     'http:///a'",
          "141:   ];",
          "143:   const invalidSchemes = [",
          "144:     '1h://foo.com',",
          "145:     '+h://foo.com',",
          "146:     '.h://foo.com',",
          "147:     '-h://foo.com',",
          "148:     'h!://foo.com',",
          "149:     'h/://foo.com',",
          "150:     'h_://foo.com',",
          "151:     'morethanfifteencharacters://foo.com',",
          "152:   ];",
          "154:   const falseCases = ephoxFalseCases.concat(mathiasBynensFalse).concat(invalidSchemes);",
          "156:   Arr.each(trueCases, (cs) => {",
          "157:     const matched = Regexes.link().exec(cs);",
          "158:     Assert.eq('expected true but was false: ' + cs, cs, matched !== null && matched[0]);",
          "159:     if (matched !== null && matched.length > 1) {",
          "161:       console.log('matched groups:');",
          "162:       Arr.each(matched, (s, i) => {",
          "164:         console.log(i, s);",
          "166:       Assert.fail('link regex must not capture any groups');",
          "167:     }",
          "168:   });",
          "170:   Arr.each(falseCases, (cs) => {",
          "171:     const match = Regexes.link().exec(cs);",
          "172:     Assert.eq('expected false but was true: ' + cs, false, match !== null && cs === match[0]);",
          "173:   });",
          "175:   const autolinks = { // Ignore trailing: \\-_.~*+=!&;:\\'%@?#^${}(),",
          "176:     'http://google.com\\\\': 'http://google.com',",
          "178:     'http://google.com_': 'http://google.com',",
          "179:     'http://google.com.': 'http://google.com',",
          "180:     'http://google.com~': 'http://google.com',",
          "181:     'http://google.com*': 'http://google.com',",
          "182:     'http://google.com+': 'http://google.com',",
          "183:     'http://google.com=': 'http://google.com',",
          "184:     'http://google.com!': 'http://google.com',",
          "185:     'http://google.com&': 'http://google.com',",
          "186:     'http://google.com;': 'http://google.com',",
          "187:     'http://google.com:': 'http://google.com',",
          "188:     'http://google.com\\'': 'http://google.com',",
          "189:     'http://google.com%': 'http://google.com',",
          "190:     'http://google.com@': 'http://google.com',",
          "191:     'http://google.com?': 'http://google.com',",
          "192:     'http://google.com#': 'http://google.com',",
          "193:     'http://google.com^': 'http://google.com',",
          "194:     'http://google.com$': 'http://google.com',",
          "195:     'http://google.com{': 'http://google.com',",
          "196:     'http://google.com}': 'http://google.com',",
          "197:     'http://google.com(': 'http://google.com',",
          "198:     'http://google.com)': 'http://google.com',",
          "199:     'http://google.com?x=y': 'http://google.com?x=y',",
          "200:     'http://google.com#a-b_c': 'http://google.com#a-b_c',",
          "201:     'http://google.com?x=y#a-b_c%20': 'http://google.com?x=y#a-b_c%20',",
          "202:     'http://google.com?x=y&a=1&c=2#a-b_c%20': 'http://google.com?x=y&a=1&c=2#a-b_c%20',",
          "203:     'http://google.com:80/a/path/ok/?x=y#a-b_c%20': 'http://google.com:80/a/path/ok/?x=y#a-b_c%20',",
          "204:     'https://mike:pass@google.com:80/a/path/ok/?x=y#a-b_c%20': 'https://mike:pass@google.com:80/a/path/ok/?x=y#a-b_c%20',",
          "205:     'http://eg.com?cc=you%40eg.com&x=y': 'http://eg.com?cc=you%40eg.com&x=y',",
          "206:     'http://eg.com?m=bob%40eg.com': 'http://eg.com?m=bob%40eg.com',",
          "208:     'www.google.com\\\\': 'www.google.com',",
          "210:     'www.google.com_': 'www.google.com',",
          "211:     'www.google.com.': 'www.google.com',",
          "212:     'www.google.com~': 'www.google.com',",
          "213:     'www.google.com*': 'www.google.com',",
          "214:     'www.google.com+': 'www.google.com',",
          "215:     'www.google.com=': 'www.google.com',",
          "216:     'www.google.com!': 'www.google.com',",
          "217:     'www.google.com&': 'www.google.com',",
          "218:     'www.google.com;': 'www.google.com',",
          "219:     'www.google.com:': 'www.google.com',",
          "220:     'www.google.com\\'': 'www.google.com',",
          "221:     'www.google.com%': 'www.google.com',",
          "222:     'www.google.com@': 'www.google.com',",
          "223:     'www.google.com?': 'www.google.com',",
          "224:     'www.google.com#': 'www.google.com',",
          "225:     'www.google.com^': 'www.google.com',",
          "226:     'www.google.com$': 'www.google.com',",
          "227:     'www.google.com{': 'www.google.com',",
          "228:     'www.google.com}': 'www.google.com',",
          "229:     'www.google.com(': 'www.google.com',",
          "230:     'www.google.com)': 'www.google.com',",
          "231:     'www.google.com:80/a/path/ok/?x=y#a-b_c%20': 'www.google.com:80/a/path/ok/?x=y#a-b_c%20',",
          "233:     'mailto:me@eg.com': 'mailto:me@eg.com',",
          "234:     'mailto:me@eg.com.': 'mailto:me@eg.com',",
          "235:     'mailto:me@eg.com?': 'mailto:me@eg.com',",
          "236:     'mailto:me@eg.com)': 'mailto:me@eg.com',",
          "237:     'mailto:me@eg.com?cc=you%40eg.com': 'mailto:me@eg.com?cc=you%40eg.com',",
          "239:     'mailto:me@eg.com?cc=you%40eg.com&x=y': 'mailto:me@eg.com?cc=you%40eg.com&x=y',",
          "241:     'ftp://google.com': 'ftp://google.com',",
          "242:     'ftp://google.com.': 'ftp://google.com',",
          "243:     'ftp://google.com?': 'ftp://google.com',",
          "244:     'ftp://google.com/a/b/c/d.e?v=2': 'ftp://google.com/a/b/c/d.e?v=2'",
          "245:   };",
          "248:   Obj.each(autolinks, (v, k) => {",
          "249:     const match = Regexes.autolink().exec(k);",
          "250:     if (match !== null) {",
          "251:       const url = match[1];",
          "252:       Assert.eq('expected ' + v + ' but was \"' + url + '\"', true, v === url);",
          "253:     } else {",
          "254:       Assert.fail('expected ' + v + ' but did not match \"' + k + '\"');",
          "255:     }",
          "259:   const onlyWithPathLinks = {",
          "260:     'http://google.com': 'http://google.com',",
          "261:     'http://google.com.': 'http://google.com',",
          "262:     'http://google.com,': 'http://google.com',",
          "263:     'http://google.com!': 'http://google.com',",
          "264:     'http://google.com;': 'http://google.com',",
          "265:     'http://google.com:': 'http://google.com',",
          "266:     'http://google.com/,': 'http://google.com/',",
          "267:     'http://google.com/,,': 'http://google.com/',",
          "268:     'http://google.com/.': 'http://google.com/',",
          "269:     'http://google.com/..': 'http://google.com/',",
          "270:     'http://google.com/!': 'http://google.com/',",
          "271:     'http://google.com/:': 'http://google.com/',",
          "272:     'http://google.com/;': 'http://google.com/',",
          "273:     'http://google.com/,/': 'http://google.com/,/',",
          "274:     'http://google.com/,/,': 'http://google.com/,/',",
          "275:     'http://google.com/abc': 'http://google.com/abc',",
          "276:     'http://google.com/abc,': 'http://google.com/abc',",
          "277:     'http://google.com/abc.': 'http://google.com/abc',",
          "278:     'http://google.com/abc!': 'http://google.com/abc',",
          "279:     'http://google.com/abc;': 'http://google.com/abc',",
          "280:     'http://google.com/abc:': 'http://google.com/abc',",
          "281:     'http://google.com/,ab,c': 'http://google.com/,ab,c',",
          "282:     'http://google.com/ab,c': 'http://google.com/ab,c',",
          "283:     'http://google.com/ab,c,': 'http://google.com/ab,c',",
          "284:     'http://google.com/ab,c.': 'http://google.com/ab,c',",
          "285:     'http://google.com/abc,d/,': 'http://google.com/abc,d/',",
          "286:     'http://google.com/abc,d/.': 'http://google.com/abc,d/',",
          "287:     'http://google.com/a,bc,d/,': 'http://google.com/a,bc,d/',",
          "288:     'http://google.com/a,bc,d/.': 'http://google.com/a,bc,d/',",
          "289:     'Visit, please, http://google.com/a,bc,d/. Good luck!': 'http://google.com/a,bc,d/',",
          "290:   };",
          "292:   Obj.each(onlyWithPathLinks, (v, k) => {",
          "293:     const match = Regexes.link().exec(k);",
          "294:     if (match !== null) {",
          "295:       const url = match[0];",
          "296:       Assert.eq('expected ' + v + ' but was \"' + url + '\"', true, v === url);",
          "297:     } else {",
          "298:       Assert.fail('expected ' + v + ' but did not match \"' + k + '\"');",
          "299:     }",
          "",
          "[Added Lines]",
          "1: import { Assert, context, describe, it } from '@ephox/bedrock-client';",
          "6: describe('atomic.polaris.api.RegexesTest', () => {",
          "7:   context('link', () => {",
          "8:     const ephoxCases = [",
          "9:       'www.google.com.au',",
          "10:       'www.google.com.au:80',",
          "11:       'maurizio@ephox.com',",
          "12:       'http://www.ephox.com',",
          "13:       'https://www.google.it',",
          "14:       'mailto:maurizio@ephox.com',",
          "15:       'maurizio.napoleoni@ephox.com',",
          "16:       'http://maurizio@ephox.com:3443/mystuff',",
          "17:       'maurizio-napoleoni-email@gmail.com',",
          "18:       'http://link/',",
          "19:       'https://www.google.com.au/search?espv=2&q=hello+world&oq=hello+world&gs_l=serp.3..0l10.12435.15279.0.15482.13.9.0.3.3.0.241.1121.0j1j4.5.0.msedr...0...1c.1.64.serp..5.8.1125.GLORIzEXy3Y',",
          "20:       'https://icmobile4.rtp.raleigh.ibm.com/files/app#/file/d0f8ed3e-f6d2-4577-8989-fa21ac332a20',",
          "21:       `https://www.google.com.aa/test.htm?$-_.+!*'()test,test;test:test@=&`,",
          "22:       `http://-.~_!$&'()*+,;=:%40:80%2f::::::@example.com?-.~_!$&'()*+,;=:%40:80%2f::::::@e#-.~_!$&'()*+,;=:%40:80%2f::::::@e`,",
          "23:       'http://xn--domain.com',",
          "24:       'www.google.ca/index.htm?id=/bla/bla',",
          "25:       'https://www.amazon.com.au/gp/product/B0798R2WXG/ref=s9_acsd_top_hd_bw_b5QhTfX_c_x_w?pf_rd_m=ANEGB3WVEVKZB&pf_rd_s=merchandised-search-4&pf_rd_r=KF6SD7C0M69MKF2FR9CC&pf_rd_t=101&pf_rd_p=8ad3bdba-b846-5350-9c00-72c2cb7191dd&pf_rd_i=4975211051',",
          "26:       'https://www.birddoctor.net/refId,56511/refDownload.pml',",
          "27:       'https://www.example.com/:w:/s/b026324c6904b2a9cb4b88d6d61c81d1?q=abc123',",
          "28:       'https://website.com/test/!test'",
          "29:     ];",
          "32:     const mathiasBynens = [",
          "33:       'http://foo.com/blah_blah',",
          "34:       'http://foo.com/blah_blah/',",
          "35:       'http://foo.com/blah_blah_(wikipedia)',",
          "36:       'http://foo.com/blah_blah_(wikipedia)_(again)',",
          "37:       'http://www.example.com/wpstyle/?p=364',",
          "38:       'https://www.example.com/foo/?bar=baz&inga=42&quux',",
          "39:       'http://userid:password@example.com:8080',",
          "40:       'http://userid:password@example.com:8080/',",
          "41:       'http://userid@example.com',",
          "42:       'http://userid@example.com/',",
          "43:       'http://userid@example.com:8080',",
          "44:       'http://userid@example.com:8080/',",
          "45:       'http://userid:password@example.com',",
          "46:       'http://userid:password@example.com/',",
          "47:       'http://142.42.1.1/',",
          "48:       'http://142.42.1.1:8080/',",
          "49:       'http://foo.com/blah_(wikipedia)#cite-1',",
          "50:       'http://foo.com/blah_(wikipedia)_blah#cite-1',",
          "51:       'http://foo.com/(something)?after=parens',",
          "52:       'http://code.google.com/events/#&product=browser',",
          "53:       'http://j.mp',",
          "54:       'ftp://foo.bar/baz',",
          "55:       'http://foo.bar/?q=Test%20URL-encoded%20stuff',",
          "56:       `http://-.~_!$&'()*+,;=:%40:80%2f::::::@example.com`,",
          "57:       'http://1337.net',",
          "58:       'http://a.b-c.de',",
          "59:       'http://223.255.255.254'",
          "71:     ];",
          "73:     const validSchemes = [",
          "74:       'h://foo.com',",
          "75:       'h1://foo.com',",
          "76:       'h1+://foo.com',",
          "77:       'h1+.://foo.com',",
          "78:       'h1+.-://foo.com',",
          "79:       'p72internal://foo.com',",
          "80:       'but15characters://foo.com',",
          "81:     ];",
          "83:     const trueCases = [ ...ephoxCases, ...mathiasBynens, ...validSchemes ];",
          "85:     const ephoxFalseCases = [",
          "86:       'I am not a link',",
          "87:       '#hashtag',",
          "88:       '@mention',",
          "89:       '[~jiramention]',",
          "90:       'aSimpleString',",
          "91:       'something.containing.dots',",
          "92:       '',",
          "93:       '\\n',",
          "94:       '',",
          "95:       'http://google.com.',",
          "96:       'http://google.com)',",
          "97:       'www.google.com.',",
          "98:       'www.google.com)',",
          "99:       'asdf:one'",
          "100:     ];",
          "102:     const mathiasBynensFalse = [",
          "103:       'http://',",
          "104:       'http://foo.bar?q=Spaces should be encoded',",
          "105:       'http:// shouldfail.com',",
          "106:       'http://foo.bar/foo(bar)baz quux',",
          "107:       'foo.com',",
          "108:       ':// should fail',",
          "109:       'http://?',",
          "110:       'http://??',",
          "111:       'http://??/',",
          "112:       'http://#',",
          "113:       'http://##',",
          "114:       'http://##/',",
          "115:       '//',",
          "116:       '//a',",
          "117:       '///a',",
          "118:       '///',",
          "119:       'http:///a'",
          "142:     ];",
          "144:     const invalidSchemes = [",
          "145:       '1h://foo.com',",
          "146:       '+h://foo.com',",
          "147:       '.h://foo.com',",
          "148:       '-h://foo.com',",
          "149:       'h!://foo.com',",
          "150:       'h/://foo.com',",
          "151:       'h_://foo.com',",
          "152:       'morethanfifteencharacters://foo.com',",
          "153:     ];",
          "155:     const falseCases = [ ...ephoxFalseCases, ...mathiasBynensFalse, ...invalidSchemes ];",
          "157:     it('should match true cases', () => {",
          "158:       Arr.each(trueCases, (cs) => {",
          "159:         const matched = Regexes.link().exec(cs);",
          "160:         Assert.eq(`expected true but was false: ${cs}`, cs, matched !== null && matched[0]);",
          "161:         if (matched !== null && matched.length > 1) {",
          "163:           console.log('matched groups:');",
          "164:           Arr.each(matched, (s, i) => {",
          "166:             console.log(i, s);",
          "167:           });",
          "168:           Assert.fail('link regex must not capture any groups');",
          "169:         }",
          "171:     });",
          "173:     it('should not match false cases', () => {",
          "174:       Arr.each(falseCases, (cs) => {",
          "175:         const match = Regexes.link().exec(cs);",
          "176:         Assert.eq(`expected false but was true: ${cs}`, false, match !== null && cs === match[0]);",
          "177:       });",
          "178:     });",
          "180:     context('only with path', () => {",
          "182:       const onlyWithPathLinks = {",
          "183:         'http://google.com': 'http://google.com',",
          "184:         'http://google.com.': 'http://google.com',",
          "185:         'http://google.com,': 'http://google.com',",
          "186:         'http://google.com!': 'http://google.com',",
          "187:         'http://google.com;': 'http://google.com',",
          "188:         'http://google.com:': 'http://google.com',",
          "189:         'http://google.com/,': 'http://google.com/',",
          "190:         'http://google.com/,,': 'http://google.com/',",
          "191:         'http://google.com/.': 'http://google.com/',",
          "192:         'http://google.com/..': 'http://google.com/',",
          "193:         'http://google.com/!': 'http://google.com/',",
          "194:         'http://google.com/:': 'http://google.com/',",
          "195:         'http://google.com/;': 'http://google.com/',",
          "196:         'http://google.com/,/': 'http://google.com/,/',",
          "197:         'http://google.com/,/,': 'http://google.com/,/',",
          "198:         'http://google.com/abc': 'http://google.com/abc',",
          "199:         'http://google.com/abc,': 'http://google.com/abc',",
          "200:         'http://google.com/abc.': 'http://google.com/abc',",
          "201:         'http://google.com/abc!': 'http://google.com/abc',",
          "202:         'http://google.com/abc;': 'http://google.com/abc',",
          "203:         'http://google.com/abc:': 'http://google.com/abc',",
          "204:         'http://google.com/,ab,c': 'http://google.com/,ab,c',",
          "205:         'http://google.com/ab,c': 'http://google.com/ab,c',",
          "206:         'http://google.com/ab,c,': 'http://google.com/ab,c',",
          "207:         'http://google.com/ab,c.': 'http://google.com/ab,c',",
          "208:         'http://google.com/abc,d/,': 'http://google.com/abc,d/',",
          "209:         'http://google.com/abc,d/.': 'http://google.com/abc,d/',",
          "210:         'http://google.com/a,bc,d/,': 'http://google.com/a,bc,d/',",
          "211:         'http://google.com/a,bc,d/.': 'http://google.com/a,bc,d/',",
          "212:         'Visit, please, http://google.com/a,bc,d/. Good luck!': 'http://google.com/a,bc,d/',",
          "213:       };",
          "215:       it('should match only with path', () => {",
          "216:         Obj.each(onlyWithPathLinks, (v, k) => {",
          "217:           const match = Regexes.link().exec(k);",
          "218:           if (match !== null) {",
          "219:             const url = match[0];",
          "220:             Assert.eq(`expected ${v} but was ${url}`, true, v === url);",
          "221:           } else {",
          "222:             Assert.fail(`expected ${v} but did not match ${k}`);",
          "223:           }",
          "224:         });",
          "225:       });",
          "226:     });",
          "229:   context('autolink', () => {",
          "230:     const autolinks = { // Ignore trailing: \\-_.~*+=!&;:\\'%@?#^${}(),",
          "231:       'http://google.com\\\\': 'http://google.com',",
          "233:       'http://google.com_': 'http://google.com',",
          "234:       'http://google.com.': 'http://google.com',",
          "235:       'http://google.com~': 'http://google.com',",
          "236:       'http://google.com*': 'http://google.com',",
          "237:       'http://google.com+': 'http://google.com',",
          "238:       'http://google.com=': 'http://google.com',",
          "239:       'http://google.com!': 'http://google.com',",
          "240:       'http://google.com&': 'http://google.com',",
          "241:       'http://google.com;': 'http://google.com',",
          "242:       'http://google.com:': 'http://google.com',",
          "243:       'http://google.com\\'': 'http://google.com',",
          "244:       'http://google.com%': 'http://google.com',",
          "245:       'http://google.com@': 'http://google.com',",
          "246:       'http://google.com?': 'http://google.com',",
          "247:       'http://google.com#': 'http://google.com',",
          "248:       'http://google.com^': 'http://google.com',",
          "249:       'http://google.com$': 'http://google.com',",
          "250:       'http://google.com{': 'http://google.com',",
          "251:       'http://google.com}': 'http://google.com',",
          "252:       'http://google.com(': 'http://google.com',",
          "253:       'http://google.com)': 'http://google.com',",
          "254:       'http://google.com?x=y': 'http://google.com?x=y',",
          "255:       'http://google.com#a-b_c': 'http://google.com#a-b_c',",
          "256:       'http://google.com?x=y#a-b_c%20': 'http://google.com?x=y#a-b_c%20',",
          "257:       'http://google.com?x=y&a=1&c=2#a-b_c%20': 'http://google.com?x=y&a=1&c=2#a-b_c%20',",
          "258:       'http://google.com:80/a/path/ok/?x=y#a-b_c%20': 'http://google.com:80/a/path/ok/?x=y#a-b_c%20',",
          "259:       'https://mike:pass@google.com:80/a/path/ok/?x=y#a-b_c%20': 'https://mike:pass@google.com:80/a/path/ok/?x=y#a-b_c%20',",
          "260:       'http://eg.com?cc=you%40eg.com&x=y': 'http://eg.com?cc=you%40eg.com&x=y',",
          "261:       'http://eg.com?m=bob%40eg.com': 'http://eg.com?m=bob%40eg.com',",
          "263:       'www.google.com\\\\': 'www.google.com',",
          "265:       'www.google.com_': 'www.google.com',",
          "266:       'www.google.com.': 'www.google.com',",
          "267:       'www.google.com~': 'www.google.com',",
          "268:       'www.google.com*': 'www.google.com',",
          "269:       'www.google.com+': 'www.google.com',",
          "270:       'www.google.com=': 'www.google.com',",
          "271:       'www.google.com!': 'www.google.com',",
          "272:       'www.google.com&': 'www.google.com',",
          "273:       'www.google.com;': 'www.google.com',",
          "274:       'www.google.com:': 'www.google.com',",
          "275:       'www.google.com\\'': 'www.google.com',",
          "276:       'www.google.com%': 'www.google.com',",
          "277:       'www.google.com@': 'www.google.com',",
          "278:       'www.google.com?': 'www.google.com',",
          "279:       'www.google.com#': 'www.google.com',",
          "280:       'www.google.com^': 'www.google.com',",
          "281:       'www.google.com$': 'www.google.com',",
          "282:       'www.google.com{': 'www.google.com',",
          "283:       'www.google.com}': 'www.google.com',",
          "284:       'www.google.com(': 'www.google.com',",
          "285:       'www.google.com)': 'www.google.com',",
          "286:       'www.google.com:80/a/path/ok/?x=y#a-b_c%20': 'www.google.com:80/a/path/ok/?x=y#a-b_c%20',",
          "288:       'mailto:me@eg.com': 'mailto:me@eg.com',",
          "289:       'mailto:me@eg.com.': 'mailto:me@eg.com',",
          "290:       'mailto:me@eg.com?': 'mailto:me@eg.com',",
          "291:       'mailto:me@eg.com)': 'mailto:me@eg.com',",
          "292:       'mailto:me@eg.com?cc=you%40eg.com': 'mailto:me@eg.com?cc=you%40eg.com',",
          "294:       'mailto:me@eg.com?cc=you%40eg.com&x=y': 'mailto:me@eg.com?cc=you%40eg.com&x=y',",
          "296:       'ftp://google.com': 'ftp://google.com',",
          "297:       'ftp://google.com.': 'ftp://google.com',",
          "298:       'ftp://google.com?': 'ftp://google.com',",
          "299:       'ftp://google.com/a/b/c/d.e?v=2': 'ftp://google.com/a/b/c/d.e?v=2'",
          "300:     };",
          "302:     it('should match autolinks', () => {",
          "304:       Obj.each(autolinks, (v, k) => {",
          "305:         const match = Regexes.autolink().exec(k);",
          "306:         if (match !== null) {",
          "307:           const url = match[1];",
          "308:           Assert.eq(`expected ${v} but was ${url}`, true, v === url);",
          "309:         } else {",
          "310:           Assert.fail(`expected ${v} but did not match ${k}`);",
          "311:         }",
          "312:       });",
          "313:     });",
          "",
          "---------------"
        ],
        "modules/polaris/src/test/ts/atomic/api/StringSplitTest.ts||modules/polaris/src/test/ts/atomic/api/StringSplitTest.ts": [
          "File: modules/polaris/src/test/ts/atomic/api/StringSplitTest.ts -> modules/polaris/src/test/ts/atomic/api/StringSplitTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "modules/polaris/src/test/ts/atomic/api/StringsSplitsTest.ts||modules/polaris/src/test/ts/atomic/api/StringsSplitsTest.ts": [
          "File: modules/polaris/src/test/ts/atomic/api/StringsSplitsTest.ts -> modules/polaris/src/test/ts/atomic/api/StringsSplitsTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { Assert, describe, it } from '@ephox/bedrock-client';",
          "3: import * as Strings from 'ephox/polaris/api/Strings';",
          "5: describe('atomic.polaris.api.StringsSplitsTest', () => {",
          "6:   const check = (expected: string[], input: string, points: number[]) => {",
          "7:     const actual = Strings.splits(input, points);",
          "8:     Assert.eq('', expected, actual);",
          "9:   };",
          "11:   it('should chunk a string into substrings based on the given indices', () => {",
          "12:     check([ '' ], '', [ ]);",
          "13:     check([ 'a' ], 'a', [ ]);",
          "14:     check([ 'a' ], 'a', [ 0 ]);",
          "15:     check([ 'a' ], 'a', [ 1 ]);",
          "16:     check([ 'a', 'b', 'c' ], 'abc', [ 0, 1, 2, 3 ]);",
          "17:     check([ 'ab', 'cdef', 'ghi' ], 'abcdefghi', [ 2, 6 ]);",
          "18:   });",
          "19: });",
          "",
          "---------------"
        ],
        "modules/polaris/src/test/ts/atomic/api/UrlTest.ts||modules/polaris/src/test/ts/atomic/api/UrlTest.ts": [
          "File: modules/polaris/src/test/ts/atomic/api/UrlTest.ts -> modules/polaris/src/test/ts/atomic/api/UrlTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { Assert, context, describe, it } from '@ephox/bedrock-client';",
          "2: import { Obj } from '@ephox/katamari';",
          "4: import * as Url from 'ephox/polaris/api/Url';",
          "6: describe('atomic.polaris.api.UrlTest', () => {",
          "7:   context('extractHost', () => {",
          "8:     const hostMap: Record<string, string> = {",
          "9:       'www.google.com.au': 'google.com.au',",
          "10:       'www.google.com.au:80': 'google.com.au',",
          "11:       'maurizio@ephox.com': 'ephox.com',",
          "12:       'http://www.ephox.com': 'ephox.com',",
          "13:       'https://www.google.it': 'google.it',",
          "14:       'mailto:maurizio@ephox.com': 'ephox.com',",
          "15:       'maurizio.napoleoni@ephox.com': 'ephox.com',",
          "16:       'http://maurizio@ephox.com:3443/mystuff': 'ephox.com',",
          "17:       'maurizio-napoleoni-email@gmail.com': 'gmail.com',",
          "18:       'http://link/': 'link',",
          "19:       'https://www.google.com.au/search?espv=2&q=hello+world&oq=hello+world&gs_l=serp.3..0l10.12435.15279.0.15482.13.9.0.3.3.0.241.1121.0j1j4.5.0.msedr...0...1c.1.64.serp..5.8.1125.GLORIzEXy3Y': 'google.com.au',",
          "20:       'https://icmobile4.rtp.raleigh.ibm.com/files/app#/file/d0f8ed3e-f6d2-4577-8989-fa21ac332a20': 'icmobile4.rtp.raleigh.ibm.com',",
          "21:       'https://www.google.com.aa/test.htm?$-_.+!*\\'()test,test;test:test@=&': 'google.com.aa',",
          "22:       'http://-.~_!$&\\'()*+,;=:%40:80%2f::::::@example.com?-.~_!$&\\'()*+,;=:%40:80%2f::::::@e#-.~_!$&\\'()*+,;=:%40:80%2f::::::@e': 'e',",
          "23:       'http://xn--domain.com': 'xn--domain.com',",
          "24:       'www.google.ca/index.htm?id=/bla/bla': 'google.ca',",
          "25:       'https://www.amazon.com.au/gp/product/B0798R2WXG/ref=s9_acsd_top_hd_bw_b5QhTfX_c_x_w?pf_rd_m=ANEGB3WVEVKZB&pf_rd_s=merchandised-search-4&pf_rd_r=KF6SD7C0M69MKF2FR9CC&pf_rd_t=101&pf_rd_p=8ad3bdba-b846-5350-9c00-72c2cb7191dd&pf_rd_i=4975211051':",
          "26:         'amazon.com.au',",
          "27:       'https://www.birddoctor.net/refId,56511/refDownload.pml': 'birddoctor.net',",
          "28:       'https://www.example.com/:w:/s/b026324c6904b2a9cb4b88d6d61c81d1?q=abc123': 'example.com',",
          "29:       'https://website.com/test/!test': 'website.com',",
          "30:       'http://foo.com/blah_blah': 'foo.com',",
          "31:       'http://foo.com/blah_blah/': 'foo.com',",
          "32:       'http://foo.com/blah_blah_(wikipedia)': 'foo.com',",
          "33:       'http://foo.com/blah_blah_(wikipedia)_(again)': 'foo.com',",
          "34:       'http://www.example.com/wpstyle/?p=364': 'example.com',",
          "35:       'https://www.example.com/foo/?bar=baz&inga=42&quux': 'example.com',",
          "36:       'http://userid:password@example.com:8080': 'example.com',",
          "37:       'http://userid:password@example.com:8080/': 'example.com',",
          "38:       'http://userid@example.com': 'example.com',",
          "39:       'http://userid@example.com/': 'example.com',",
          "40:       'http://userid@example.com:8080': 'example.com',",
          "41:       'http://userid@example.com:8080/': 'example.com',",
          "42:       'http://userid:password@example.com': 'example.com',",
          "43:       'http://userid:password@example.com/': 'example.com',",
          "44:       'http://142.42.1.1/': '142.42.1.1',",
          "45:       'http://142.42.1.1:8080/': '142.42.1.1',",
          "46:       'http://foo.com/blah_(wikipedia)#cite-1': 'foo.com',",
          "47:       'http://foo.com/blah_(wikipedia)_blah#cite-1': 'foo.com',",
          "48:       'http://foo.com/(something)?after=parens': 'foo.com',",
          "49:       'http://code.google.com/events/#&product=browser': 'code.google.com',",
          "50:       'http://j.mp': 'j.mp',",
          "51:       'ftp://foo.bar/baz': 'foo.bar',",
          "52:       'http://foo.bar/?q=Test%20URL-encoded%20stuff': 'foo.bar',",
          "53:       'http://-.~_!$&\\'()*+,;=:%40:80%2f::::::@example.com': 'example.com',",
          "54:       'http://1337.net': '1337.net',",
          "55:       'http://a.b-c.de': 'a.b-c.de',",
          "56:       'http://223.255.255.254': '223.255.255.254',",
          "57:       'h://foo.com': 'foo.com',",
          "58:       'h1://foo.com': 'foo.com',",
          "59:       'h1+://foo.com': 'foo.com',",
          "60:       'h1+.://foo.com': 'foo.com',",
          "61:       'h1+.-://foo.com': 'foo.com',",
          "62:       'p72internal://foo.com': 'foo.com',",
          "63:       'but15characters://foo.com': 'foo.com'",
          "64:     };",
          "66:     Obj.each(hostMap, (v, k) => {",
          "67:       it(`TINY-10350: Should correctly extract ${v} from ${k}`, () => {",
          "68:         const host = Url.extractHost(k).getOrDie();",
          "69:         Assert.eq(`expected host to be ${v} but was ${host}`, v, host);",
          "70:       });",
          "71:     });",
          "72:   });",
          "73: });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts": [
          "File: modules/tinymce/src/core/main/ts/api/OptionTypes.ts -> modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "199:   resize_img_proportional?: boolean;",
          "200:   root_name?: string;",
          "201:   sandbox_iframes?: boolean;",
          "202:   schema?: SchemaType;",
          "203:   selector?: string;",
          "204:   setup?: SetupCallback;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "202:   sandbox_iframes_exclusions?: string[];",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "340:   readonly: boolean;",
          "341:   removed_menuitems: string;",
          "342:   sandbox_iframes: boolean;",
          "343:   toolbar: boolean | string | string[] | Array<ToolbarGroup>;",
          "344:   toolbar_groups: Record<string, Toolbar.GroupToolbarButtonSpec>;",
          "345:   toolbar_location: ToolbarLocation;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "344:   sandbox_iframes_exclusions: string[];",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "841:   registerOption('sandbox_iframes', {",
          "842:     processor: 'boolean',",
          "844:   });",
          "846:   registerOption('convert_unsafe_embeds', {",
          "",
          "[Removed Lines]",
          "843:     default: false",
          "",
          "[Added Lines]",
          "843:     default: true",
          "844:   });",
          "846:   registerOption('sandbox_iframes_exclusions', {",
          "847:     processor: 'string[]',",
          "848:     default: [",
          "849:       'youtube.com',",
          "850:       'youtu.be',",
          "851:       'vimeo.com',",
          "852:       'dailymotion.com',",
          "853:       'dai.ly',",
          "854:       'codepen.io'",
          "855:     ]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "966: const getDetailsSerializedState = option('details_serialized_state');",
          "967: const shouldForceHexColor = option('force_hex_color');",
          "968: const shouldSandboxIframes = option('sandbox_iframes');",
          "969: const shouldConvertUnsafeEmbeds = option('convert_unsafe_embeds');",
          "971: export {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "981: const getSandboxIframesExclusions = (editor: Editor): string[] => editor.options.get('sandbox_iframes_exclusions');",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1074:   shouldUseDocumentWrite,",
          "1075:   shouldForceHexColor,",
          "1076:   shouldSandboxIframes,",
          "1077:   shouldConvertUnsafeEmbeds",
          "1078: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1090:   getSandboxIframesExclusions,",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts": [
          "File: modules/tinymce/src/core/main/ts/api/html/DomParser.ts -> modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "68:   preserve_cdata?: boolean;",
          "69:   root_name?: string;",
          "70:   sandbox_iframes?: boolean;",
          "71:   sanitize?: boolean;",
          "72:   validate?: boolean;",
          "73: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "71:   sandbox_iframes_exclusions?: string[];",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts": [
          "File: modules/tinymce/src/core/main/ts/content/PrePostProcess.ts -> modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "30:   }",
          "31: };",
          "33: const preProcessGetContent = <T extends GetContentArgs>(editor: Editor, args: T): Result<T, Content> => {",
          "34:   if (args.no_events) {",
          "35:     return Result.value(args);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "33: const makeParserSettings = (editor: Editor): DomParserSettings => ({",
          "34:   sanitize: Options.shouldSanitizeXss(editor),",
          "35:   sandbox_iframes: Options.shouldSandboxIframes(editor),",
          "36:   sandbox_iframes_exclusions: Options.getSandboxIframesExclusions(editor)",
          "37: });",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "47:   if (args.no_events) {",
          "48:     return content;",
          "49:   } else {",
          "51:     return processedEventArgs.content;",
          "52:   }",
          "53: };",
          "",
          "[Removed Lines]",
          "50:     const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), { sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) });",
          "",
          "[Added Lines]",
          "56:     const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), makeParserSettings(editor));",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "56:   if (args.no_events) {",
          "57:     return Result.value(args);",
          "58:   } else {",
          "60:     if (processedEventArgs.isDefaultPrevented()) {",
          "61:       Events.fireSetContent(editor, processedEventArgs);",
          "62:       return Result.error(undefined);",
          "",
          "[Removed Lines]",
          "59:     const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), { sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) });",
          "",
          "[Added Lines]",
          "65:     const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), makeParserSettings(editor));",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/html/Embed.ts||modules/tinymce/src/core/main/ts/html/Embed.ts": [
          "File: modules/tinymce/src/core/main/ts/html/Embed.ts -> modules/tinymce/src/core/main/ts/html/Embed.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2: import { Arr, Optional, Strings, Type } from '@ephox/katamari';",
          "3: import { Url } from '@ephox/polaris';",
          "5: import AstNode from '../api/html/Node';",
          "7: interface EmbedAttrs {",
          "8:   readonly type?: string;",
          "9:   readonly src?: string;",
          "10:   readonly width?: string;",
          "11:   readonly height?: string;",
          "12: }",
          "14: const sandboxIframe = (iframeNode: AstNode, exclusions: string[]): void => {",
          "15:   if (Optional.from(iframeNode.attr('src')).bind(Url.extractHost).forall((host) => !Arr.contains(exclusions, host))) {",
          "16:     iframeNode.attr('sandbox', '');",
          "17:   }",
          "18: };",
          "20: const isMimeType = (mime: string, type: 'image' | 'video' | 'audio'): boolean => Strings.startsWith(mime, `${type}/`);",
          "22: const getEmbedType = (type: string | undefined): 'iframe' | 'img' | 'video' | 'audio' => {",
          "23:   if (Type.isUndefined(type)) {",
          "24:     return 'iframe';",
          "25:   } else if (isMimeType(type, 'image')) {",
          "26:     return 'img';",
          "27:   } else if (isMimeType(type, 'video')) {",
          "28:     return 'video';",
          "29:   } else if (isMimeType(type, 'audio')) {",
          "30:     return 'audio';",
          "31:   } else {",
          "32:     return 'iframe';",
          "33:   }",
          "34: };",
          "36: const createSafeEmbed = ({ type, src, width, height }: EmbedAttrs = {}, sandboxIframes: boolean, sandboxIframesExclusions: string[]): AstNode => {",
          "37:   const name = getEmbedType(type);",
          "38:   const embed = new AstNode(name, 1);",
          "39:   embed.attr(name === 'audio' ? { src } : { src, width, height });",
          "42:   if (name === 'audio' || name === 'video') {",
          "43:     embed.attr('controls', '');",
          "44:   }",
          "46:   if (name === 'iframe' && sandboxIframes) {",
          "47:     sandboxIframe(embed, sandboxIframesExclusions);",
          "48:   }",
          "49:   return embed;",
          "50: };",
          "52: export {",
          "53:   createSafeEmbed,",
          "54:   sandboxIframe",
          "55: };",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts": [
          "File: modules/tinymce/src/core/main/ts/html/ParserFilters.ts -> modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: import Env from '../api/Env';",
          "4: import DomParser, { DomParserSettings } from '../api/html/DomParser';",
          "5: import AstNode from '../api/html/Node';",
          "6: import Tools from '../api/util/Tools';",
          "9: const isBogusImage = (img: AstNode): boolean =>",
          "10:   Type.isNonNullable(img.attr('data-mce-bogus'));",
          "",
          "[Removed Lines]",
          "1: import { Arr, Strings, Type } from '@ephox/katamari';",
          "7: import { dataUriToBlobInfo } from '../file/BlobCacheUtils';",
          "",
          "[Added Lines]",
          "1: import { Arr, Type } from '@ephox/katamari';",
          "7: import * as BlobCacheUtils from '../file/BlobCacheUtils';",
          "8: import * as Embed from './Embed';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "22:         return;",
          "23:       }",
          "26:         img.attr('src', blobInfo.blobUri());",
          "27:       });",
          "28:     };",
          "",
          "[Removed Lines]",
          "25:       dataUriToBlobInfo(blobCache, inputSrc, true).each((blobInfo) => {",
          "",
          "[Added Lines]",
          "26:       BlobCacheUtils.dataUriToBlobInfo(blobCache, inputSrc, true).each((blobInfo) => {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "31:   }",
          "32: };",
          "64: const register = (parser: DomParser, settings: DomParserSettings): void => {",
          "65:   const schema = parser.schema;",
          "",
          "[Removed Lines]",
          "34: const isMimeType = (mime: string, type: 'image' | 'video' | 'audio'): boolean => Strings.startsWith(mime, `${type}/`);",
          "36: const createSafeEmbed = (mime?: string, src?: string, width?: string, height?: string, sandboxIframes?: boolean): AstNode => {",
          "37:   let name: 'iframe' | 'img' | 'video' | 'audio';",
          "38:   if (Type.isUndefined(mime)) {",
          "39:     name = 'iframe';",
          "40:   } else if (isMimeType(mime, 'image')) {",
          "41:     name = 'img';",
          "42:   } else if (isMimeType(mime, 'video')) {",
          "43:     name = 'video';",
          "44:   } else if (isMimeType(mime, 'audio')) {",
          "45:     name = 'audio';",
          "46:   } else {",
          "47:     name = 'iframe';",
          "48:   }",
          "50:   const embed = new AstNode(name, 1);",
          "51:   embed.attr(name === 'audio' ? { src } : { src, width, height });",
          "54:   if (name === 'audio' || name === 'video') {",
          "55:     embed.attr('controls', '');",
          "56:   }",
          "58:   if (name === 'iframe' && sandboxIframes) {",
          "59:     embed.attr('sandbox', '');",
          "60:   }",
          "61:   return embed;",
          "62: };",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "180:   registerBase64ImageFilter(parser, settings);",
          "182:   if (settings.convert_unsafe_embeds) {",
          "183:     parser.addNodeFilter('object,embed', (nodes) => Arr.each(nodes, (node) => {",
          "184:       node.replace(",
          "192:     }));",
          "193:   }",
          "197:   }",
          "198: };",
          "",
          "[Removed Lines]",
          "185:         createSafeEmbed(",
          "186:           node.attr('type'),",
          "187:           node.name === 'object' ? node.attr('data') : node.attr('src'),",
          "188:           node.attr('width'),",
          "189:           node.attr('height'),",
          "190:           settings.sandbox_iframes",
          "191:         ));",
          "195:   if (settings.sandbox_iframes) {",
          "196:     parser.addNodeFilter('iframe', (nodes) => Arr.each(nodes, (node) => node.attr('sandbox', '')));",
          "",
          "[Added Lines]",
          "153:   const shouldSandboxIframes = settings.sandbox_iframes ?? false;",
          "154:   const sandboxIframesExclusions = Arr.unique(settings.sandbox_iframes_exclusions ?? []);",
          "158:         Embed.createSafeEmbed({",
          "159:           type: node.attr('type'),",
          "160:           src: node.name === 'object' ? node.attr('data') : node.attr('src'),",
          "161:           width: node.attr('width'),",
          "162:           height: node.attr('height'),",
          "163:         },",
          "164:         shouldSandboxIframes,",
          "165:         sandboxIframesExclusions));",
          "169:   if (shouldSandboxIframes) {",
          "170:     parser.addNodeFilter('iframe', (nodes) => Arr.each(nodes, (node) => Embed.sandboxIframe(node, sandboxIframesExclusions)));",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts": [
          "File: modules/tinymce/src/core/main/ts/init/InitContentBody.ts -> modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "83:     inline_styles: getOption('inline_styles'),",
          "84:     root_name: getRootName(editor),",
          "85:     sandbox_iframes: getOption('sandbox_iframes'),",
          "86:     sanitize: getOption('xss_sanitization'),",
          "87:     validate: true,",
          "88:     blob_cache: blobCache,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "86:     sandbox_iframes_exclusions: Options.getSandboxIframesExclusions(editor),",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts": [
          "File: modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts -> modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "14:   const parser = DomParser({",
          "15:     sanitize: Options.shouldSanitizeXss(editor),",
          "16:     sandbox_iframes: Options.shouldSandboxIframes(editor),",
          "17:     convert_unsafe_embeds: Options.shouldConvertUnsafeEmbeds(editor)",
          "18:   }, editor.schema);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "17:     sandbox_iframes_exclusions: Options.getSandboxIframesExclusions(editor),",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts -> modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: ];",
          "20: describe('browser.tinymce.core.content.EditorContentTest', () => {",
          "23:   const toHtml = (node: AstNode): string => HtmlSerializer({}).serialize(node);",
          "",
          "[Removed Lines]",
          "21:   const isSafari = PlatformDetection.detect().browser.isSafari();",
          "",
          "[Added Lines]",
          "22:   const platform = PlatformDetection.detect();",
          "23:   const isSafari = platform.browser.isSafari();",
          "24:   const isSafariLessThan17 = isSafari && platform.browser.version.major < 17;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "358:               base_url: '/project/tinymce/js/tinymce'",
          "359:             }, []);",
          "362:               const editor = hook.editor();",
          "363:               editor.setContent('<iframe src=\"about:blank\"></iframe>');",
          "365:             });",
          "366:           });",
          "",
          "[Removed Lines]",
          "361:             it('TINY-10348: Iframe should not be sandboxed by default', () => {",
          "364:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\"></iframe></p>');",
          "",
          "[Added Lines]",
          "364:             it('TINY-10348: Iframe should be sandboxed by default', () => {",
          "367:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>');",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "404:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>');",
          "405:             });",
          "406:           });",
          "407:         });",
          "409:         context('Convert unsafe embeds', () => {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "411:           context('sandbox_iframes_exclusions', () => {",
          "412:             const hook = TinyHooks.bddSetupLight<Editor>({",
          "413:               ...options,",
          "414:               base_url: '/project/tinymce/js/tinymce',",
          "415:               sandbox_iframes: true,",
          "416:               sandbox_iframes_exclusions: [ 'tiny.cloud' ]",
          "417:             }, []);",
          "419:             it('TINY-10350: Iframe should be sandboxed when sandbox_iframes: true and not excluded', () => {",
          "420:               const editor = hook.editor();",
          "421:               editor.setContent('<iframe src=\"https://example.com\"></iframe>');",
          "422:               TinyAssertions.assertContent(editor, '<p><iframe src=\"https://example.com\" sandbox=\"\"></iframe></p>');",
          "423:             });",
          "425:             it('TINY-10350: Iframe should not be sandboxed when sandbox_iframes: true and excluded', () => {",
          "426:               const editor = hook.editor();",
          "427:               editor.setContent('<iframe src=\"https://tiny.cloud\"></iframe>');",
          "428:               TinyAssertions.assertContent(editor, '<p><iframe src=\"https://tiny.cloud\"></iframe></p>');",
          "429:             });",
          "430:           });",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "428:               base_url: '/project/tinymce/js/tinymce'",
          "429:             }, []);",
          "433:           });",
          "435:           context('convert_unsafe_embeds: false', () => {",
          "",
          "[Removed Lines]",
          "431:             it('TINY-10349: Object elements should be converted', testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
          "432:             it('TINY-10349: Embed elements should be converted', testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\"></iframe>'));",
          "",
          "[Added Lines]",
          "455:             it('TINY-10349: Object elements should be converted', testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
          "456:             it('TINY-10349: Embed elements should be converted', testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "451:             }, []);",
          "453:             it('TINY-10349: Object elements should be converted to iframe',",
          "456:             it('TINY-10349: Embed elements should be converted to iframe',",
          "458:           });",
          "460:           context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
          "",
          "[Removed Lines]",
          "454:               testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
          "457:               testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\"></iframe>'));",
          "",
          "[Added Lines]",
          "478:               testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
          "481:               testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "554:           const editor = hook.editor();",
          "555:           editor.setContent('<p><iframe><p>test</p></iframe></p>');",
          "556:           const content = editor.getContent();",
          "563:         });",
          "565:         it('getContent text with unsanitized content should get text from unsanitized content', () => {",
          "",
          "[Removed Lines]",
          "557:           assert.equal(content,",
          "559:             isSafari",
          "560:               ? '<p><iframe>&lt;p&gt;test&lt;/p&gt;</iframe></p>'",
          "561:               : '<p><iframe><p>test</p></iframe></p>',",
          "562:             'getContent should not error when there is iframes with child nodes in content');",
          "",
          "[Added Lines]",
          "582:           const expected = isSafariLessThan17",
          "583:             ? '<p><iframe sandbox=\"\">&lt;p&gt;test&lt;/p&gt;</iframe></p>'",
          "584:             : '<p><iframe sandbox=\"\"><p>test</p></iframe></p>';",
          "585:           assert.equal(content, expected, 'getContent should not error when there is iframes with child nodes in content');",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "596:       it('TINY-10305: setContent html should sanitize content that can cause mXSS via ZWNBSP trimming', () => {",
          "597:         const editor = hook.editor();",
          "598:         editor.setContent('<p>test</p><!--\\ufeff><iframe onload=alert(document.domain)>-></body>-->');",
          "601:       });",
          "603:       it('TINY-10305: setContent tree should sanitize content that can cause mXSS via ZWNBSP trimming', () => {",
          "",
          "[Removed Lines]",
          "600:         TinyAssertions.assertRawContent(editor, isSafari ? '<p>test</p><!----><p><iframe>-&gt;&lt;/body&gt;--&gt;&lt;/body&gt;</iframe></p>' : '<p>test</p><!---->');",
          "",
          "[Added Lines]",
          "623:         const expected = isSafariLessThan17",
          "624:           ? '<p>test</p><!----><p><iframe sandbox=\"\">-&gt;&lt;/body&gt;--&gt;&lt;/body&gt;</iframe></p>'",
          "625:           : '<p>test</p><!---->';",
          "626:         TinyAssertions.assertRawContent(editor, expected);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts -> modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "7: import Editor from 'tinymce/core/api/Editor';",
          "9: describe('browser.tinymce.core.content.EditorGetContentRawTest', () => {",
          "12:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "13:     base_url: '/project/tinymce/js/tinymce'",
          "",
          "[Removed Lines]",
          "10:   const isSafari = PlatformDetection.detect().browser.isSafari();",
          "",
          "[Added Lines]",
          "11:   const platform = PlatformDetection.detect();",
          "12:   const isSafariLessThan17 = platform.browser.isSafari() && platform.browser.version.major < 17;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "50:     assert.strictEqual(editor.getContent({ format: 'raw' }), '<p>test0</p><plaintext></plaintext>', 'Should be expected html');",
          "52:     TinyAssertions.assertRawContent(editor,",
          "54:   });",
          "56:   context('Content XSS', () => {",
          "",
          "[Removed Lines]",
          "53:       isSafari ? '<p>test0</p><plaintext>te\\uFEFFst1 test2&lt;p&gt;te\\uFEFFst3&lt;/p&gt;</plaintext>' : `${initial}</plaintext>`);",
          "",
          "[Added Lines]",
          "55:       isSafariLessThan17 ? '<p>test0</p><plaintext>te\\uFEFFst1 test2&lt;p&gt;te\\uFEFFst3&lt;/p&gt;</plaintext>' : `${initial}</plaintext>`);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts -> modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "9: import * as InsertContent from 'tinymce/core/content/InsertContent';",
          "11: describe('browser.tinymce.core.content.InsertContentTest', () => {",
          "14:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "15:     add_unload_trigger: false,",
          "",
          "[Removed Lines]",
          "12:   const isSafari = PlatformDetection.detect().browser.isSafari();",
          "",
          "[Added Lines]",
          "13:   const platform = PlatformDetection.detect();",
          "14:   const isSafariLessThan17 = platform.browser.isSafari() && platform.browser.version.major < 17;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "843:       TinySelections.setCursor(editor, [ 0 ], 0);",
          "844:       editor.insertContent('<!--\\ufeff><iframe onload=alert(document.domain)>-></body>-->');",
          "848:         : '<p><!---->initial</p>');",
          "849:     });",
          "850:   });",
          "",
          "[Removed Lines]",
          "846:       TinyAssertions.assertRawContent(editor, isSafari",
          "847:         ? '<p><!----><iframe>-&gt;&lt;/body&gt;--&gt;&lt;span id=\"mce_marker\" data-mce-type=\"bookmark\"&gt;&amp;#xFEFF;&lt;/span&gt;&lt;/body&gt;</iframe>initial</p>'",
          "",
          "[Added Lines]",
          "848:       TinyAssertions.assertRawContent(editor, isSafariLessThan17",
          "849:         ? '<p><!----><iframe sandbox=\"\">-&gt;&lt;/body&gt;--&gt;&lt;span id=\"mce_marker\" data-mce-type=\"bookmark\"&gt;&amp;#xFEFF;&lt;/span&gt;&lt;/body&gt;</iframe>initial</p>'",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts -> modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1476:       });",
          "1478:       context('Sandboxing iframes', () => {",
          "1489:       });",
          "1491:       context('Convert unsafe embeds', () => {",
          "",
          "[Removed Lines]",
          "1479:         const serializeIframeHtml = (sandbox: boolean): string => {",
          "1480:           const parser = DomParser({ ...scenario.settings, sandbox_iframes: sandbox });",
          "1481:           return serializer.serialize(parser.parse('<iframe src=\"about:blank\"></iframe>'));",
          "1482:         };",
          "1484:         it('TINY-10348: iframes should be sandboxed when sandbox_iframes: false', () =>",
          "1485:           assert.equal(serializeIframeHtml(false), '<iframe src=\"about:blank\"></iframe>'));",
          "1487:         it('TINY-10348: iframes should be sandboxed when sandbox_iframes: true', () =>",
          "1488:           assert.equal(serializeIframeHtml(true), '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
          "",
          "[Added Lines]",
          "1479:         context('sandbox_iframes', () => {",
          "1480:           const testSandboxIframe = (sandbox: boolean, expected: string) => () => {",
          "1481:             const parser = DomParser({ ...scenario.settings, sandbox_iframes: sandbox });",
          "1482:             const serialized = serializer.serialize(parser.parse('<iframe src=\"about:blank\"></iframe>'));",
          "1483:             assert.equal(serialized, expected);",
          "1484:           };",
          "1486:           it('TINY-10348: iframes should be sandboxed when sandbox_iframes: false',",
          "1487:             testSandboxIframe(false, '<iframe src=\"about:blank\"></iframe>'));",
          "1489:           it('TINY-10348: iframes should be sandboxed when sandbox_iframes: true',",
          "1490:             testSandboxIframe(true, '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
          "1491:         });",
          "1493:         context('sandbox_iframes_exclusions', () => {",
          "1494:           const exclusions = [ 'tiny.cloud' ];",
          "1495:           const parser = DomParser({ ...scenario.settings, sandbox_iframes: true, sandbox_iframes_exclusions: exclusions });",
          "1497:           const testSandboxIframeExclusions = (src: string, expected: string) => () => {",
          "1498:             const serialized = serializer.serialize(parser.parse(`<iframe src=\"${src}\"></iframe>`));",
          "1499:             assert.equal(serialized, expected);",
          "1500:           };",
          "1502:           it('TINY-10350: iframes should be sandboxed when sandbox_iframes: true and host is not excluded',",
          "1503:             testSandboxIframeExclusions('https://www.example.com', '<iframe src=\"https://www.example.com\" sandbox=\"\"></iframe>'));",
          "1505:           it('TINY-10350: iframes should not be sandboxed when sandbox_iframes: true and host is excluded',",
          "1506:             testSandboxIframeExclusions('https://www.tiny.cloud', '<iframe src=\"https://www.tiny.cloud\"></iframe>'));",
          "1508:           it('TINY-10350: iframes with non-URL src should be sandboxed when sandbox_iframes: true',",
          "1509:             testSandboxIframeExclusions('abc', '<iframe src=\"abc\" sandbox=\"\"></iframe>'));",
          "1511:           it('TINY-10350: iframes with no src should be sandboxed when sandbox_iframes: true', () => {",
          "1512:             const serialized = serializer.serialize(parser.parse('<iframe></iframe>'));",
          "1513:             assert.equal(serialized, '<iframe sandbox=\"\"></iframe>');",
          "1514:           });",
          "1515:         });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts -> modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "556:         });",
          "558:         it('TINY-10349: Pasted object element should be converted to iframe',",
          "561:         it('TINY-10349: Pasted embed element should be converted to iframe',",
          "563:       });",
          "565:       context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
          "",
          "[Removed Lines]",
          "559:           testPasteHtml(hook, '<object data=\"about:blank\">', '<p><iframe src=\"about:blank\"></iframe></p>'));",
          "562:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><iframe src=\"about:blank\"></iframe></p>'));",
          "",
          "[Added Lines]",
          "559:           testPasteHtml(hook, '<object data=\"about:blank\">', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
          "562:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts||modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts -> modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: import { Fun } from '@ephox/katamari';",
          "3: import { TinyHooks } from '@ephox/wrap-mcagar';",
          "4: import { assert } from 'chai';",
          "",
          "[Removed Lines]",
          "1: import { describe, it } from '@ephox/bedrock-client';",
          "",
          "[Added Lines]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "12: type PostProcessHandler = (e: EditorEvent<PastePostProcessEvent>) => void;",
          "14: describe('browser.tinymce.core.paste.ProcessFiltersTest', () => {",
          "16:     add_unload_trigger: false,",
          "17:     indent: false,",
          "18:     base_url: '/project/tinymce/js/tinymce',",
          "19:     extended_valid_elements: 'b[*]'",
          "20:   }, []);",
          "",
          "[Removed Lines]",
          "15:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "",
          "[Added Lines]",
          "16:   const baseSettings = {",
          "20:   };",
          "22:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "23:     ...baseSettings,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "118:     const editor = hook.editor();",
          "120:     const objectRes = processPrePost(editor, '<object data=\"about:blank\"></object>', true, Fun.noop, Fun.noop);",
          "123:     const embedRes = processPrePost(editor, '<embed src=\"about:blank\">', true, Fun.noop, Fun.noop);",
          "125:   });",
          "126: });",
          "",
          "[Removed Lines]",
          "121:     assert.deepEqual(objectRes, { content: '<iframe src=\"about:blank\"></iframe>', cancelled: false }, '<object> should be converted');",
          "124:     assert.deepEqual(embedRes, { content: '<iframe src=\"about:blank\"></iframe>', cancelled: false }, '<embed> should be converted');",
          "",
          "[Added Lines]",
          "126:     assert.deepEqual(objectRes, { content: '<iframe src=\"about:blank\" sandbox=\"\"></iframe>', cancelled: false }, '<object> should be converted');",
          "129:     assert.deepEqual(embedRes, { content: '<iframe src=\"about:blank\" sandbox=\"\"></iframe>', cancelled: false }, '<embed> should be converted');",
          "130:   });",
          "132:   context('iframe sandboxing', () => {",
          "133:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "134:       ...baseSettings,",
          "135:       sandbox_iframes_exclusions: [ 'tiny.cloud' ]",
          "136:     }, []);",
          "138:     it('TINY-10350: iframe should be sandboxed on preprocess/postprocess', () => {",
          "139:       const editor = hook.editor();",
          "140:       const result = processPrePost(editor, '<iframe src=\"https://example.com\"></iframe>', true, Fun.noop, Fun.noop);",
          "141:       assert.deepEqual(result, { content: '<iframe src=\"https://example.com\" sandbox=\"\"></iframe>', cancelled: false }, 'iframe should be sandboxed');",
          "142:     });",
          "144:     it('TINY-10350: Excluded iframes should not be sandboxed on preprocess/postprocess', () => {",
          "145:       const editor = hook.editor();",
          "146:       const result = processPrePost(editor, '<iframe src=\"https://tiny.cloud\"></iframe>', true, Fun.noop, Fun.noop);",
          "147:       assert.deepEqual(result, { content: '<iframe src=\"https://tiny.cloud\"></iframe>', cancelled: false }, 'Excluded iframe should not be sandboxed');",
          "148:     });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts": [
          "File: modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "86:       '<iframe src=\"320x240.ogg\" allowfullscreen>text<a href=\"#\">link</a></iframe>'",
          "87:     );",
          "88:     TinyAssertions.assertContent(editor,",
          "90:     );",
          "91:     McEditor.remove(editor);",
          "92:   });",
          "",
          "[Removed Lines]",
          "89:       '<p><iframe src=\"320x240.ogg\" width=\"300\" height=\"150\" allowfullscreen=\"allowfullscreen\">text<a href=\"#\">link</a></iframe></p>'",
          "",
          "[Added Lines]",
          "89:       '<p><iframe src=\"320x240.ogg\" width=\"300\" height=\"150\" sandbox=\"\" allowfullscreen=\"allowfullscreen\">text<a href=\"#\">link</a></iframe></p>'",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/media/test/ts/browser/EphoxEmbedTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/EphoxEmbedTest.ts": [
          "File: modules/tinymce/src/plugins/media/test/ts/browser/EphoxEmbedTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/EphoxEmbedTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "16:       children: [",
          "17:         s.element('iframe', {",
          "18:           attrs: {",
          "20:           }",
          "21:         })",
          "22:       ],",
          "",
          "[Removed Lines]",
          "19:             src: str.is('about:blank')",
          "",
          "[Added Lines]",
          "19:             src: str.is('about:blank'),",
          "20:             sandbox: str.is('')",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "49:     it('TBA: Open dialog, assert embedded content, close dialog and assert div structure', async () => {",
          "50:       const editor = hook.editor();",
          "51:       const content = '<div contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\"></iframe></div>';",
          "52:       editor.setContent(content);",
          "53:       assertDivStructure(editor, ephoxEmbedStructure);",
          "54:       TinySelections.select(editor, 'div', []);",
          "55:       await Utils.pOpenDialog(editor);",
          "56:       await Utils.pAssertSourceValue(editor, 'embed-iri');",
          "58:       TinyUiActions.submitDialog(editor);",
          "59:       await Waiter.pTryUntil('wait for div structure', () => assertDivStructure(editor, ephoxEmbedStructure));",
          "60:     });",
          "",
          "[Removed Lines]",
          "57:       await Utils.pAssertEmbedData(editor, content);",
          "",
          "[Added Lines]",
          "53:       const sandboxedContent = '<div contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\" sandbox=\"\"></iframe></div>';",
          "59:       await Utils.pAssertEmbedData(editor, sandboxedContent);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/media/test/ts/browser/MediaAlignmentTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/MediaAlignmentTest.ts": [
          "File: modules/tinymce/src/plugins/media/test/ts/browser/MediaAlignmentTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/MediaAlignmentTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "50:   context('apply alignment to ephox embed elements', () => {",
          "51:     it('TINY-8687: align ephox embed element without styles to the left', () => testAlignLeft(",
          "52:       '<div contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\"></iframe></div>',",
          "54:     ));",
          "56:     it('TINY-8687: align ephox embed element without styles to the center', () => testAlignCenter(",
          "57:       '<div contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\"></iframe></div>',",
          "59:     ));",
          "61:     it('TINY-8687: align ephox embed element without styles to the right', () => testAlignRight(",
          "62:       '<div contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\"></iframe></div>',",
          "64:     ));",
          "65:   });",
          "",
          "[Removed Lines]",
          "53:       '<div style=\"float: left;\" contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\"></iframe></div>'",
          "58:       '<div style=\"margin-left: auto; margin-right: auto;\" contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\"></iframe></div>'",
          "63:       '<div style=\"float: right;\" contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\"></iframe></div>'",
          "",
          "[Added Lines]",
          "53:       '<div style=\"float: left;\" contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\" sandbox=\"\"></iframe></div>'",
          "58:       '<div style=\"margin-left: auto; margin-right: auto;\" contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\" sandbox=\"\"></iframe></div>'",
          "63:       '<div style=\"float: right;\" contenteditable=\"false\" data-ephox-embed-iri=\"embed-iri\"><iframe src=\"about:blank\" sandbox=\"\"></iframe></div>'",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts": [
          "File: modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "12:   const baseSettings = {",
          "13:     plugins: [ 'media' ],",
          "14:     toolbar: 'media',",
          "16:   };",
          "18:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "",
          "[Removed Lines]",
          "15:     extended_valid_elements: 'script[src|type]'",
          "",
          "[Added Lines]",
          "15:     extended_valid_elements: 'script[src|type]',",
          "16:     sandbox_iframes_exclusions: []",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:     it('TBA: Set and assert iframe placeholder structure', () => pTestPlaceholder(hook.editor(),",
          "56:       'https://www.youtube.com/watch?v=P_205ZY52pY',",
          "57:       '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
          "59:       placeholderStructure",
          "60:     ));",
          "",
          "[Removed Lines]",
          "58:       'height=\"314\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
          "",
          "[Added Lines]",
          "59:       'height=\"314\" sandbox=\"\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "104:     it('TBA: Set and assert live iframe embed structure', () => pTestPlaceholder(hook.editor(),",
          "105:       'https://www.youtube.com/watch?v=P_205ZY52pY',",
          "106:       '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
          "109:     ));",
          "111:     it('TINY-10348: Live iframe embed structure when sandbox_iframes: false', async () => {",
          "",
          "[Removed Lines]",
          "107:       'height=\"314\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
          "108:       createIframeStructure(false)",
          "",
          "[Added Lines]",
          "108:       'height=\"314\" sandbox=\"\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
          "109:       createIframeStructure(true)",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/media/test/ts/browser/SubmitTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/SubmitTest.ts": [
          "File: modules/tinymce/src/plugins/media/test/ts/browser/SubmitTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/SubmitTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "14:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "15:       plugins: [ 'media' ],",
          "16:       toolbar: 'media',",
          "18:     }, [ Plugin ]);",
          "20:     const mediaUrlResolver = (data: { url: string }, resolve: (data: { html: string }) => void) => {",
          "",
          "[Removed Lines]",
          "17:       base_url: '/project/tinymce/js/tinymce'",
          "",
          "[Added Lines]",
          "17:       base_url: '/project/tinymce/js/tinymce',",
          "18:       sandbox_iframes_exclusions: []",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "31:     ' width=\"560\" height=\"314\" allowfullscreen=\"allowfullscreen\">' +",
          "32:     '</iframe></div>';",
          "34:     const pTestResolvedEmbedContentSubmit = async (editor: Editor, url: string, expected: string) => {",
          "35:       await Utils.pOpenDialog(editor);",
          "36:       await Utils.pSetFormItemNoEvent(editor, url);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "35:     const sandboxedCustomEmbed =",
          "36:     '<div style=\"left: 0px; width: 100%; height: 0px; position: relative; padding-bottom: 56.338%; max-width: 650px;\">' +",
          "37:     '<iframe src=\"https://www.youtube.com/embed/IcgmSRJHu_8\"' +",
          "38:     ' width=\"560\" height=\"314\" sandbox=\"\" allowfullscreen=\"allowfullscreen\">' +",
          "39:     '</iframe></div>';",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "78:       editor.options.unset('media_url_resolver');",
          "79:       await pTestResolvedEmbedContentSubmit(editor,",
          "80:         'https://www.youtube.com/watch?v=IcgmSRJHu_8',",
          "82:       );",
          "83:     });",
          "85:     it('TBA: Open dialog, set embed content, submit dialog and assert content', async () => {",
          "86:       const editor = hook.editor();",
          "87:       editor.options.set('media_url_resolver', mediaUrlResolver);",
          "89:       editor.options.unset('media_url_resolver');",
          "91:     });",
          "93:     it('TBA: Set audio_template_callback and embed content, submit dialog and assert content', async () => {",
          "",
          "[Removed Lines]",
          "81:         '<p><iframe src=\"https://www.youtube.com/embed/IcgmSRJHu_8\" width=\"560\" height=\"314\" allowfullscreen=\"allowfullscreen\"></iframe></p>'",
          "88:       await pTestManualEmbedContentSubmit(editor, customEmbed, customEmbed);",
          "90:       await pTestEmbedUnchangedAfterOpenCloseDialog(editor, customEmbed);",
          "",
          "[Added Lines]",
          "88:         '<p><iframe src=\"https://www.youtube.com/embed/IcgmSRJHu_8\" width=\"560\" height=\"314\" sandbox=\"\" allowfullscreen=\"allowfullscreen\"></iframe></p>'",
          "95:       await pTestManualEmbedContentSubmit(editor, customEmbed, sandboxedCustomEmbed);",
          "97:       await pTestEmbedUnchangedAfterOpenCloseDialog(editor, sandboxedCustomEmbed);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "113:       const editor = hook.editor();",
          "114:       const iframeTemplateCallback = Fun.constant('<iframe id=\"template\" title=\"testcallback\" src=\"https://www.youtube.com/embed/IcgmSRJHu_8\" width=\"500\" height=\"300\"></iframe>');",
          "116:       await pTestTemplateCallbackContentSubmit(editor, 'iframe_template_callback', iframeTemplateCallback, 'https://www.youtube.com/embed/IcgmSRJHu_8', expected);",
          "117:       await pTestEmbedUnchangedAfterOpenCloseDialog(editor, expected);",
          "118:     });",
          "",
          "[Removed Lines]",
          "115:       const expected = '<p><iframe id=\"template\" title=\"testcallback\" src=\"https://www.youtube.com/embed/IcgmSRJHu_8\" width=\"500\" height=\"300\"></iframe></p>';",
          "",
          "[Added Lines]",
          "122:       const expected = '<p><iframe id=\"template\" title=\"testcallback\" src=\"https://www.youtube.com/embed/IcgmSRJHu_8\" width=\"500\" height=\"300\" sandbox=\"\"></iframe></p>';",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "123:       plugins: [ 'media' ],",
          "124:       toolbar: 'media',",
          "125:       base_url: '/project/tinymce/js/tinymce',",
          "126:       setup: (editor: Editor) => {",
          "127:         editor.on('PreInit', () => {",
          "128:           const converter = (nodes: AstNode[]): void => {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "133:       sandbox_iframes_exclusions: [],",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "159:       await Utils.pSetHeightAndWidth(editor, '500', '700');",
          "160:       await Utils.pAssertHeightAndWidth(editor, '500', '700');",
          "161:       TinyUiActions.submitDialog(editor);",
          "163:     });",
          "164:   });",
          "165: });",
          "",
          "[Removed Lines]",
          "162:       await Utils.pAssertEditorContent(editor, '<p><iframe src=\"https://www.youtube.com/embed/5auGeCM0knQ\" width=\"700\" height=\"500\" allowfullscreen=\"allowfullscreen\"></iframe></p>');",
          "",
          "[Added Lines]",
          "170:       await Utils.pAssertEditorContent(editor, '<p><iframe src=\"https://www.youtube.com/embed/5auGeCM0knQ\" width=\"700\" height=\"500\" sandbox=\"\" allowfullscreen=\"allowfullscreen\"></iframe></p>');",
          "",
          "---------------"
        ],
        "modules/tinymce/src/themes/silver/test/ts/browser/editor/SilverPopupSinkBoundsTest.ts||modules/tinymce/src/themes/silver/test/ts/browser/editor/SilverPopupSinkBoundsTest.ts": [
          "File: modules/tinymce/src/themes/silver/test/ts/browser/editor/SilverPopupSinkBoundsTest.ts -> modules/tinymce/src/themes/silver/test/ts/browser/editor/SilverPopupSinkBoundsTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "223:         await TinyUiActions.pWaitForUi(editor, '[role=menu]');",
          "225:         Arr.range(nestedLevel, async (x) => {",
          "228:         });",
          "230:         const shadowHost = UiFinder.findIn(SugarBody.body(), '.test-shadow-root').getOrDie();",
          "",
          "[Removed Lines]",
          "226:           TinyUiActions.clickOnUi(editor, `[role=\"menu\"] div[title=\"Nested Item ${x}\"]`);",
          "227:           await TinyUiActions.pWaitForUi(editor, `[role=\"menu\"] div[title=\"Nested Item ${x}\"]`);",
          "",
          "[Added Lines]",
          "226:           TinyUiActions.clickOnUi(editor, `[role=\"menu\"] div[aria-label=\"Nested Item ${x}\"]`);",
          "227:           await TinyUiActions.pWaitForUi(editor, `[role=\"menu\"] div[aria-label=\"Nested Item ${x}\"]`);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e58a4df48b48d9a713081ab5587f37344294563b",
      "candidate_info": {
        "commit_hash": "e58a4df48b48d9a713081ab5587f37344294563b",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/e58a4df48b48d9a713081ab5587f37344294563b",
        "files": [
          "modules/tinymce/CHANGELOG.md",
          "modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/selection/DetailsElement.ts",
          "modules/tinymce/src/core/test/ts/browser/selection/DetailsElementTest.ts",
          "modules/tinymce/src/plugins/accordion/demo/html/demo.html",
          "modules/tinymce/src/plugins/accordion/demo/ts/demo/Demo.ts"
        ],
        "message": "TINY-9732: Add details_initial_state and details_serialized_state options (#8699)\n\n* TINY-9731: Add details_initial_state and details_serialized_state options\n\n* TINY-9732: Remove attr reassigning for inherited value",
        "before_after_code_files": [
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/selection/DetailsElement.ts||modules/tinymce/src/core/main/ts/selection/DetailsElement.ts",
          "modules/tinymce/src/core/test/ts/browser/selection/DetailsElementTest.ts||modules/tinymce/src/core/test/ts/browser/selection/DetailsElementTest.ts",
          "modules/tinymce/src/plugins/accordion/demo/html/demo.html||modules/tinymce/src/plugins/accordion/demo/html/demo.html",
          "modules/tinymce/src/plugins/accordion/demo/ts/demo/Demo.ts||modules/tinymce/src/plugins/accordion/demo/ts/demo/Demo.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "790:     default: true",
          "791:   });",
          "794:   editor.on('ScriptsLoaded', () => {",
          "795:     registerOption('directionality', {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "793:   registerOption('details_initial_state', {",
          "794:     processor: (value) => {",
          "795:       const valid = Arr.contains([ 'inherited', 'collapsed', 'expanded' ], value);",
          "796:       return valid ? { value, valid } : { valid: false, message: 'Must be one of: inherited, collapsed, or expanded.' };",
          "797:     },",
          "798:     default: 'inherited'",
          "799:   });",
          "801:   registerOption('details_serialized_state', {",
          "802:     processor: (value) => {",
          "803:       const valid = Arr.contains([ 'inherited', 'collapsed', 'expanded' ], value);",
          "804:       return valid ? { value, valid } : { valid: false, message: 'Must be one of: inherited, collapsed, or expanded.' };",
          "805:     },",
          "806:     default: 'inherited'",
          "807:   });",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "914: const hasTableTabNavigation = option('table_tab_navigation');",
          "916: export {",
          "917:   register,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "932: const getDetailsInitialState = option('details_initial_state');",
          "933: const getDetailsSerializedState = option('details_serialized_state');",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1011:   hasTableTabNavigation,",
          "1012:   shouldPreserveCData,",
          "1013:   shouldHighlightOnFocus,",
          "1015: };",
          "",
          "[Removed Lines]",
          "1014:   shouldSanitizeXss",
          "",
          "[Added Lines]",
          "1033:   shouldSanitizeXss,",
          "1034:   getDetailsInitialState,",
          "1035:   getDetailsSerializedState",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/selection/DetailsElement.ts||modules/tinymce/src/core/main/ts/selection/DetailsElement.ts": [
          "File: modules/tinymce/src/core/main/ts/selection/DetailsElement.ts -> modules/tinymce/src/core/main/ts/selection/DetailsElement.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: import Editor from '../api/Editor';",
          "5: const preventSummaryToggle = (editor: Editor): void => {",
          "6:   editor.on('click', (e) => {",
          "",
          "[Removed Lines]",
          "1: import { Arr, Type } from '@ephox/katamari';",
          "",
          "[Added Lines]",
          "1: import { Arr } from '@ephox/katamari';",
          "4: import * as Options from '../api/Options';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "10:   });",
          "11: };",
          "14: const filterDetails = (editor: Editor): void => {",
          "15:   editor.parser.addNodeFilter('details', (elms) => {",
          "16:     Arr.each(elms, (details) => {",
          "19:     });",
          "20:   });",
          "22:   editor.serializer.addNodeFilter('details', (elms) => {",
          "23:     Arr.each(elms, (details) => {",
          "27:     });",
          "28:   });",
          "29: };",
          "",
          "[Removed Lines]",
          "17:       details.attr('data-mce-open', details.attr('open'));",
          "18:       details.attr('open', 'open');",
          "24:       const open = details.attr('data-mce-open');",
          "25:       details.attr('open', Type.isString(open) ? open : null);",
          "26:       details.attr('data-mce-open', null);",
          "",
          "[Added Lines]",
          "16:     const initialStateOption = Options.getDetailsInitialState(editor);",
          "18:       if (initialStateOption === 'expanded') {",
          "19:         details.attr('open', 'open');",
          "20:       } else if (initialStateOption === 'collapsed') {",
          "21:         details.attr('open', null);",
          "22:       }",
          "27:     const serializedStateOption = Options.getDetailsSerializedState(editor);",
          "29:       if (serializedStateOption === 'expanded') {",
          "30:         details.attr('open', 'open');",
          "31:       } else if (serializedStateOption === 'collapsed') {",
          "32:         details.attr('open', null);",
          "33:       }",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/selection/DetailsElementTest.ts||modules/tinymce/src/core/test/ts/browser/selection/DetailsElementTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/selection/DetailsElementTest.ts -> modules/tinymce/src/core/test/ts/browser/selection/DetailsElementTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: import { describe, it } from '@ephox/bedrock-client';",
          "3: import { TinyAssertions, TinyHooks } from '@ephox/wrap-mcagar';",
          "5: import Editor from 'tinymce/core/api/Editor';",
          "7: describe('browser.tinymce.selection.DetailsElementTest', () => {",
          "8:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "9:     indent: false,",
          "10:     base_url: '/project/tinymce/js/tinymce'",
          "11:   }, []);",
          "14:     const editor = hook.editor();",
          "37:   });",
          "40:     const editor = hook.editor();",
          "63:   });",
          "64: });",
          "",
          "[Removed Lines]",
          "1: import { ApproxStructure } from '@ephox/agar';",
          "13:   it('Should should retain open attribute if it is not opened', () => {",
          "15:     editor.setContent('<details><summary>a</summary>b</details>');",
          "16:     TinyAssertions.assertContentStructure(editor,",
          "17:       ApproxStructure.build((s, str, _arr) => s.element('body', {",
          "18:         children: [",
          "19:           s.element('details', {",
          "20:             attrs: {",
          "21:               'open': str.is('open'),",
          "22:               'data-mce-open': str.none('Should not have a data attr')",
          "23:             },",
          "24:             children: [",
          "25:               s.element('summary', {",
          "26:                 children: [",
          "27:                   s.text(str.is('a'))",
          "28:                 ]",
          "29:               }),",
          "30:               s.text(str.is('b'))",
          "31:             ]",
          "32:           })",
          "33:         ]",
          "34:       }))",
          "35:     );",
          "36:     TinyAssertions.assertContent(editor, '<details><summary>a</summary>b</details>');",
          "39:   it('Should should retain open attribute if it opened', () => {",
          "41:     editor.setContent('<details open=\"open\"><summary>a</summary>b</details>');",
          "42:     TinyAssertions.assertContentStructure(editor,",
          "43:       ApproxStructure.build((s, str, _arr) => s.element('body', {",
          "44:         children: [",
          "45:           s.element('details', {",
          "46:             attrs: {",
          "47:               'open': str.is('open'),",
          "48:               'data-mce-open': str.is('open')",
          "49:             },",
          "50:             children: [",
          "51:               s.element('summary', {",
          "52:                 children: [",
          "53:                   s.text(str.is('a'))",
          "54:                 ]",
          "55:               }),",
          "56:               s.text(str.is('b'))",
          "57:             ]",
          "58:           })",
          "59:         ]",
          "60:       }))",
          "61:     );",
          "62:     TinyAssertions.assertContent(editor, '<details open=\"open\"><summary>a</summary>b</details>');",
          "",
          "[Added Lines]",
          "3: import { assert } from 'chai';",
          "7: const createAccordion = (",
          "8:   { open = true, summary = 'Accordion summary...', body = '<p>Accordion body...</p>' }:",
          "9:   { open?: boolean; summary?: string; body?: string } = {}): string =>",
          "10:   `<details class=\"mce-accordion\"${open ? ` open=\"open\"` : ''}><summary class=\"mce-accordion-summary\">${summary}</summary>${body}</details>`;",
          "15:     entities: 'raw',",
          "19:   it('TINY-9731: Should not modify initial details if details_initial_state == inherited', () => {",
          "20:     const editor = hook.editor();",
          "21:     editor.options.set('details_initial_state', 'inherited');",
          "22:     const content = [ createAccordion({ open: true }), createAccordion({ open: false }) ].join('');",
          "23:     editor.setContent(content);",
          "24:     TinyAssertions.assertContent(editor, content);",
          "25:     editor.options.unset('details_initial_state');",
          "26:   });",
          "28:   it('TINY-9731: Should expand initial details if details_initial_state == expanded', () => {",
          "29:     const editor = hook.editor();",
          "30:     editor.options.set('details_initial_state', 'expanded');",
          "31:     editor.setContent([ createAccordion({ open: true }), createAccordion({ open: false }) ].join(''));",
          "32:     TinyAssertions.assertContent(editor, [ createAccordion({ open: true }), createAccordion({ open: true }) ].join(''));",
          "33:     editor.options.unset('details_initial_state');",
          "34:   });",
          "36:   it('TINY-9731: Should collapse initial details if details_initial_state == collapsed', () => {",
          "37:     const editor = hook.editor();",
          "38:     editor.options.set('details_initial_state', 'collapsed');",
          "39:     editor.setContent([ createAccordion({ open: true }), createAccordion({ open: false }) ].join(''));",
          "40:     TinyAssertions.assertContent(editor, [ createAccordion({ open: false }), createAccordion({ open: false }) ].join(''));",
          "41:     editor.options.unset('details_initial_state');",
          "42:   });",
          "44:   it('TINY-9731: Should not modify serialized details if details_serialized_state == inherited', () => {",
          "45:     const editor = hook.editor();",
          "46:     editor.options.set('details_serialized_state', 'inherited');",
          "47:     const content = [ createAccordion({ open: true }), createAccordion({ open: false }) ].join('');",
          "48:     editor.setContent(content);",
          "49:     assert.equal(content, editor.getContent());",
          "50:     editor.options.unset('details_serialized_state');",
          "51:   });",
          "53:   it('TINY-9731: Should expand serialized details if details_serialized_state == expanded', () => {",
          "55:     editor.options.set('details_serialized_state', 'expanded');",
          "56:     editor.setContent([ createAccordion({ open: true }), createAccordion({ open: false }) ].join(''));",
          "57:     TinyAssertions.assertContent(editor, [ createAccordion({ open: true }), createAccordion({ open: true }) ].join(''));",
          "58:     editor.options.unset('details_serialized_state');",
          "61:   it('TINY-9731: Should collapse serialized details if details_serialized_state == collapsed', () => {",
          "63:     editor.options.set('details_serialized_state', 'collapsed');",
          "64:     editor.setContent([ createAccordion({ open: true }), createAccordion({ open: false }) ].join(''));",
          "65:     TinyAssertions.assertContent(editor, [ createAccordion({ open: false }), createAccordion({ open: false }) ].join(''));",
          "66:     editor.options.unset('details_serialized_state');",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/accordion/demo/html/demo.html||modules/tinymce/src/plugins/accordion/demo/html/demo.html": [
          "File: modules/tinymce/src/plugins/accordion/demo/html/demo.html -> modules/tinymce/src/plugins/accordion/demo/html/demo.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "5:   </head>",
          "7:   <body>",
          "9:     <div id=\"ephox-ui\">",
          "11:     </div>",
          "13:     <script src=\"../../../../../js/tinymce/tinymce.js\"></script>",
          "",
          "[Removed Lines]",
          "8:   <h2>Plugin: accordion Demo Page</h2>",
          "10:       <textarea cols=\"30\" rows=\"10\" class=\"tinymce\"></textarea>",
          "",
          "[Added Lines]",
          "8:     <h2>Plugin: accordion Demo Page</h2>",
          "11:       <textarea cols=\"30\" rows=\"10\" class=\"tinymce\">",
          "12:         <details class=\"mce-accordion\" open=\"open\">",
          "13:           <summary class=\"mce-accordion-summary\">Expanded accordion</summary>",
          "14:           <p>Accordion body...</p>",
          "15:         </details>",
          "16:         <details class=\"mce-accordion\">",
          "17:           <summary class=\"mce-accordion-summary\">Closed accordion</summary>",
          "18:           <p>Accordion body...</p>",
          "19:         </details>",
          "20:       </textarea>",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/accordion/demo/ts/demo/Demo.ts||modules/tinymce/src/plugins/accordion/demo/ts/demo/Demo.ts": [
          "File: modules/tinymce/src/plugins/accordion/demo/ts/demo/Demo.ts -> modules/tinymce/src/plugins/accordion/demo/ts/demo/Demo.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:   plugins: 'table lists image accordion code',",
          "8:   toolbar: 'table | numlist bullist | image | accordion | code',",
          "9:   menu: { insert: { title: 'Insert', items: 'table | image | accordion' }},",
          "10: });",
          "12: export {};",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "10:   details_initial_state: 'inherited',",
          "11:   details_serialize_state: 'inherited',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dd4c601aab9f1e5e8b64b98bf929c24dbcc38305",
      "candidate_info": {
        "commit_hash": "dd4c601aab9f1e5e8b64b98bf929c24dbcc38305",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/dd4c601aab9f1e5e8b64b98bf929c24dbcc38305",
        "files": [
          "modules/tinymce/CHANGELOG.md",
          "modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
          "modules/tinymce/src/core/main/ts/dom/DomSerializerFilters.ts",
          "modules/tinymce/src/core/main/ts/dom/DomSerializerImpl.ts",
          "modules/tinymce/src/core/main/ts/dom/RemoveTrailingBr.ts",
          "modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/test/ts/browser/dom/SerializerTest.ts",
          "modules/tinymce/src/plugins/table/test/ts/browser/TableRemoveTrailingBrTest.ts"
        ],
        "message": "TINY-3909: remove_trailing_brs: true breaks selection on table insert (#8689)\n\n* TINY-3909: Move remove_trailing_brs node filter from DomParser to DomSerializer\n\n* TINY-3909: update SerializerTest.ts and DomParserTest.ts\n\n* TINY-3909: update CHANGELOG.md\n\n* Update modules/tinymce/CHANGELOG.md\n\n* TINY-3909: add TableInsertionTest.ts\n\n* TINY-3909: recreate deleted DomParserTest tests in SerializerTest.ts\n\n* TINY-3909: update the TableInsertionTest.ts to assert cursor position, instead of table html\n\n* Update modules/tinymce/src/plugins/table/test/ts/browser/TableInsertionTest.ts\n\nCo-authored-by: ltrouton <46954949+ltrouton@users.noreply.github.com>\n\n* Update modules/tinymce/src/plugins/table/test/ts/browser/TableInsertionTest.ts\n\nCo-authored-by: ltrouton <46954949+ltrouton@users.noreply.github.com>\n\n* TINY-3909: rename TableInsertionTest.ts to TableRemoveTrailingBrTest.ts, updated test\n\n* TINY-3909: separate `removeTrailingBr` function to a separate file and call in both serializer and ParserFilters.ts\n\n* TINY-3909: moved `remove_trailing_br` option from mkParserSetting to mkSerializerSetting\n\n* TINY-3909: add deprecated message to `remove_trailing_br`\n\n* TINY-3909: separate `remove_trailing_br` function to RemoveTrailingBr.ts, add function call to DomSerializerFilters.ts and ParserFilters.ts\n\n* Update modules/tinymce/src/core/main/ts/api/html/DomParser.ts\n\nCo-authored-by: tiny-ben-tran <ben.tran@tiny.cloud>\n\n* Update modules/tinymce/src/core/main/ts/api/html/DomParser.ts\n\nCo-authored-by: mkzhx <mkzh.org@gmail.com>\n\n* Update modules/tinymce/src/core/main/ts/dom/DomSerializerFilters.ts\n\nCo-authored-by: mkzhx <mkzh.org@gmail.com>\n\n* Update modules/tinymce/src/core/main/ts/dom/DomSerializerImpl.ts\n\nCo-authored-by: mkzhx <mkzh.org@gmail.com>\n\n* TINY-3901: move config location for consistency\n\n* TINY-3901: remove `remove_trailing_brs` config in test case\n\n* TINY-3901: add back deleted tests in DomParserTest.ts\n\n* TINY-3901: add default serializer setting to DomSerializerImpl.ts\n\n* TINY-3901: move RemoveTrailingBr.ts loacation to `modules/tinymce/src/core/main/ts/dom`\n\n* TINY-3901: refactor DomSerializerImpl function\n\n* TINY-3901: fix lint issue\n\n---------\n\nCo-authored-by: Mike Zhu <mkzh.org@gmail.com>\nCo-authored-by: ltrouton <46954949+ltrouton@users.noreply.github.com>\nCo-authored-by: tiny-ben-tran <ben.tran@tiny.cloud>",
        "before_after_code_files": [
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
          "modules/tinymce/src/core/main/ts/dom/DomSerializerFilters.ts||modules/tinymce/src/core/main/ts/dom/DomSerializerFilters.ts",
          "modules/tinymce/src/core/main/ts/dom/DomSerializerImpl.ts||modules/tinymce/src/core/main/ts/dom/DomSerializerImpl.ts",
          "modules/tinymce/src/core/main/ts/dom/RemoveTrailingBr.ts||modules/tinymce/src/core/main/ts/dom/RemoveTrailingBr.ts",
          "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/test/ts/browser/dom/SerializerTest.ts||modules/tinymce/src/core/test/ts/browser/dom/SerializerTest.ts",
          "modules/tinymce/src/plugins/table/test/ts/browser/TableRemoveTrailingBrTest.ts||modules/tinymce/src/plugins/table/test/ts/browser/TableRemoveTrailingBrTest.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
            "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
            "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "559:   });",
          "561:   registerOption('remove_trailing_brs', {",
          "563:   });",
          "565:   registerOption('inline_styles', {",
          "",
          "[Removed Lines]",
          "562:     processor: 'boolean'",
          "",
          "[Added Lines]",
          "562:     processor: 'boolean',",
          "563:     default: true",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts": [
          "File: modules/tinymce/src/core/main/ts/api/html/DomParser.ts -> modules/tinymce/src/core/main/ts/api/html/DomParser.ts"
        ],
        "modules/tinymce/src/core/main/ts/dom/DomSerializerFilters.ts||modules/tinymce/src/core/main/ts/dom/DomSerializerFilters.ts": [
          "File: modules/tinymce/src/core/main/ts/dom/DomSerializerFilters.ts -> modules/tinymce/src/core/main/ts/dom/DomSerializerFilters.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: import AstNode from '../api/html/Node';",
          "7: import * as Zwsp from '../text/Zwsp';",
          "8: import { DomSerializerSettings } from './DomSerializerImpl';",
          "10: declare const unescape: any;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "9: import * as RemoveTrailingBr from './RemoveTrailingBr';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "189:       }",
          "190:     }",
          "191:   );",
          "192: };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "197:   if (settings.remove_trailing_brs) {",
          "198:     RemoveTrailingBr.addNodeFilter(htmlParser, htmlParser.schema);",
          "199:   }",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/dom/DomSerializerImpl.ts||modules/tinymce/src/core/main/ts/dom/DomSerializerImpl.ts": [
          "File: modules/tinymce/src/core/main/ts/dom/DomSerializerImpl.ts -> modules/tinymce/src/core/main/ts/dom/DomSerializerImpl.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "17: import { isWsPreserveElement } from './ElementType';",
          "19: interface DomSerializerSettings extends DomParserSettings, WriterSettings, SchemaSettings, HtmlSerializerSettings {",
          "20:   url_converter?: URLConverter;",
          "21:   url_converter_scope?: {};",
          "22: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20:   remove_trailing_brs?: boolean;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "88: const DomSerializerImpl = (settings: DomSerializerSettings, editor?: Editor): DomSerializerImpl => {",
          "89:   const tempAttrs = [ 'data-mce-selected' ];",
          "91:   const dom = editor && editor.dom ? editor.dom : DOMUtils.DOM;",
          "99:   const serialize = (node: Element, parserArgs: ParserArgs = {}): string | AstNode => {",
          "100:     const args = { format: 'html', ...parserArgs };",
          "101:     const targetNode = DomSerializerPreProcess.process(editor, node, args);",
          "102:     const html = getHtmlFromNode(dom, targetNode, args);",
          "103:     const rootNode = parseHtml(htmlParser, html, args);",
          "105:   };",
          "107:   return {",
          "",
          "[Removed Lines]",
          "92:   const schema = editor && editor.schema ? editor.schema : Schema(settings);",
          "93:   settings.entity_encoding = settings.entity_encoding || 'named';",
          "94:   settings.remove_trailing_brs = 'remove_trailing_brs' in settings ? settings.remove_trailing_brs : true;",
          "96:   const htmlParser = DomParser(settings, schema);",
          "97:   DomSerializerFilters.register(htmlParser, settings, dom);",
          "104:     return args.format === 'tree' ? rootNode : toHtml(editor, settings, schema, rootNode, args);",
          "",
          "[Added Lines]",
          "92:   const defaultedSettings: DomSerializerSettings = {",
          "93:     entity_encoding: 'named',",
          "94:     remove_trailing_brs: true,",
          "95:     ...settings",
          "96:   };",
          "99:   const schema = editor && editor.schema ? editor.schema : Schema(defaultedSettings);",
          "101:   const htmlParser = DomParser(defaultedSettings, schema);",
          "102:   DomSerializerFilters.register(htmlParser, defaultedSettings, dom);",
          "109:     return args.format === 'tree' ? rootNode : toHtml(editor, defaultedSettings, schema, rootNode, args);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/dom/RemoveTrailingBr.ts||modules/tinymce/src/core/main/ts/dom/RemoveTrailingBr.ts": [
          "File: modules/tinymce/src/core/main/ts/dom/RemoveTrailingBr.ts -> modules/tinymce/src/core/main/ts/dom/RemoveTrailingBr.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { Unicode } from '@ephox/katamari';",
          "3: import DomParser from '../api/html/DomParser';",
          "4: import AstNode from '../api/html/Node';",
          "5: import Schema from '../api/html/Schema';",
          "6: import Tools from '../api/util/Tools';",
          "7: import * as TransparentElements from '../content/TransparentElements';",
          "8: import { isEmpty, paddEmptyNode } from '../html/ParserUtils';",
          "10: export const addNodeFilter = (htmlParser: DomParser, schema: Schema): void => {",
          "11:   htmlParser.addNodeFilter('br', (nodes, _, args) => {",
          "12:     const blockElements = Tools.extend({}, schema.getBlockElements());",
          "13:     const nonEmptyElements = schema.getNonEmptyElements();",
          "14:     const whitespaceElements = schema.getWhitespaceElements();",
          "17:     blockElements.body = 1;",
          "19:     const isBlock = (node: AstNode) => node.name in blockElements && TransparentElements.isTransparentAstInline(schema, node);",
          "22:     for (let i = 0, l = nodes.length; i < l; i++) {",
          "23:       let node: AstNode | null = nodes[i];",
          "24:       let parent = node.parent;",
          "26:       if (parent && blockElements[parent.name] && node === parent.lastChild) {",
          "29:         let prev = node.prev;",
          "30:         while (prev) {",
          "31:           const prevName = prev.name;",
          "34:           if (prevName !== 'span' || prev.attr('data-mce-type') !== 'bookmark') {",
          "36:             if (prevName === 'br') {",
          "37:               node = null;",
          "38:             }",
          "39:             break;",
          "40:           }",
          "42:           prev = prev.prev;",
          "43:         }",
          "45:         if (node) {",
          "46:           node.remove();",
          "49:           if (isEmpty(schema, nonEmptyElements, whitespaceElements, parent)) {",
          "50:             const elementRule = schema.getElementRule(parent.name);",
          "53:             if (elementRule) {",
          "54:               if (elementRule.removeEmpty) {",
          "55:                 parent.remove();",
          "56:               } else if (elementRule.paddEmpty) {",
          "57:                 paddEmptyNode(args, isBlock, parent);",
          "58:               }",
          "59:             }",
          "60:           }",
          "61:         }",
          "62:       } else {",
          "65:         let lastParent = node;",
          "66:         while (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {",
          "67:           lastParent = parent;",
          "69:           if (blockElements[parent.name]) {",
          "70:             break;",
          "71:           }",
          "73:           parent = parent.parent;",
          "74:         }",
          "76:         if (lastParent === parent) {",
          "77:           const textNode = new AstNode('#text', 3);",
          "78:           textNode.value = Unicode.nbsp;",
          "79:           node.replace(textNode);",
          "80:         }",
          "81:       }",
          "82:     }",
          "83:   });",
          "84: };",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts": [
          "File: modules/tinymce/src/core/main/ts/html/ParserFilters.ts -> modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: import Env from '../api/Env';",
          "4: import DomParser, { DomParserSettings } from '../api/html/DomParser';",
          "5: import AstNode from '../api/html/Node';",
          "6: import Tools from '../api/util/Tools';",
          "8: import { dataUriToBlobInfo } from '../file/BlobCacheUtils';",
          "11: const isBogusImage = (img: AstNode): boolean =>",
          "12:   Type.isNonNullable(img.attr('data-mce-bogus'));",
          "",
          "[Removed Lines]",
          "1: import { Arr, Type, Unicode } from '@ephox/katamari';",
          "7: import * as TransparentElements from '../content/TransparentElements';",
          "9: import { isEmpty, paddEmptyNode } from './ParserUtils';",
          "",
          "[Added Lines]",
          "1: import { Arr, Type } from '@ephox/katamari';",
          "7: import * as RemoveTrailingBr from '../dom/RemoveTrailingBr';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "36: const register = (parser: DomParser, settings: DomParserSettings): void => {",
          "37:   const schema = parser.schema;",
          "42:   if (settings.remove_trailing_brs) {",
          "116:   }",
          "118:   parser.addAttributeFilter('href', (nodes) => {",
          "",
          "[Removed Lines]",
          "43:     parser.addNodeFilter('br', (nodes, _, args) => {",
          "44:       const blockElements = Tools.extend({}, schema.getBlockElements());",
          "45:       const nonEmptyElements = schema.getNonEmptyElements();",
          "46:       const whitespaceElements = schema.getWhitespaceElements();",
          "49:       blockElements.body = 1;",
          "51:       const isBlock = (node: AstNode) => node.name in blockElements && TransparentElements.isTransparentAstInline(schema, node);",
          "54:       for (let i = 0, l = nodes.length; i < l; i++) {",
          "55:         let node: AstNode | null = nodes[i];",
          "56:         let parent = node.parent;",
          "58:         if (parent && blockElements[parent.name] && node === parent.lastChild) {",
          "61:           let prev = node.prev;",
          "62:           while (prev) {",
          "63:             const prevName = prev.name;",
          "66:             if (prevName !== 'span' || prev.attr('data-mce-type') !== 'bookmark') {",
          "68:               if (prevName === 'br') {",
          "69:                 node = null;",
          "70:               }",
          "71:               break;",
          "72:             }",
          "74:             prev = prev.prev;",
          "75:           }",
          "77:           if (node) {",
          "78:             node.remove();",
          "81:             if (isEmpty(schema, nonEmptyElements, whitespaceElements, parent)) {",
          "82:               const elementRule = schema.getElementRule(parent.name);",
          "85:               if (elementRule) {",
          "86:                 if (elementRule.removeEmpty) {",
          "87:                   parent.remove();",
          "88:                 } else if (elementRule.paddEmpty) {",
          "89:                   paddEmptyNode(args, isBlock, parent);",
          "90:                 }",
          "91:               }",
          "92:             }",
          "93:           }",
          "94:         } else {",
          "97:           let lastParent = node;",
          "98:           while (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {",
          "99:             lastParent = parent;",
          "101:             if (blockElements[parent.name]) {",
          "102:               break;",
          "103:             }",
          "105:             parent = parent.parent;",
          "106:           }",
          "108:           if (lastParent === parent) {",
          "109:             const textNode = new AstNode('#text', 3);",
          "110:             textNode.value = Unicode.nbsp;",
          "111:             node.replace(textNode);",
          "112:           }",
          "113:         }",
          "114:       }",
          "115:     });",
          "",
          "[Added Lines]",
          "39:     RemoveTrailingBr.addNodeFilter(parser, schema);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts": [
          "File: modules/tinymce/src/core/main/ts/init/InitContentBody.ts -> modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "76:     forced_root_block: getOption('forced_root_block'),",
          "77:     forced_root_block_attrs: getOption('forced_root_block_attrs'),",
          "78:     preserve_cdata: getOption('preserve_cdata'),",
          "80:     inline_styles: getOption('inline_styles'),",
          "81:     root_name: getRootName(editor),",
          "82:     sanitize: getOption('xss_sanitization'),",
          "",
          "[Removed Lines]",
          "79:     remove_trailing_brs: getOption('remove_trailing_brs'),",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "112:     ...mkSchemaSettings(editor),",
          "113:     ...removeUndefined<DomSerializerSettings>({",
          "115:       url_converter: getOption('url_converter'),",
          "116:       url_converter_scope: getOption('url_converter_scope'),",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "114:       remove_trailing_brs: getOption('remove_trailing_brs'),",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/dom/SerializerTest.ts||modules/tinymce/src/core/test/ts/browser/dom/SerializerTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/dom/SerializerTest.ts -> modules/tinymce/src/core/test/ts/browser/dom/SerializerTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "836:       '<a href=\"#\"><p>block</p></a>'",
          "837:     );",
          "838:   });",
          "839: });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "840:   it('TINY-3909: Remove redundant br elements', () => {",
          "841:     const ser = DomSerializer({ remove_trailing_brs: true });",
          "843:     setTestHtml( '<p>a<br></p>' +",
          "844:       '<p>a<br>b<br></p>' +",
          "845:       '<p>a<br><br></p><p>a<br><span data-mce-type=\"bookmark\"></span><br></p>' +",
          "846:       '<p>a<span data-mce-type=\"bookmark\"></span><br></p>');",
          "847:     assert.equal(",
          "848:       ser.serialize(getTestElement(), { getInner: true }),",
          "849:       '<p>a</p><p>a<br>b</p><p>a<br><br></p><p>a<br><br></p><p>a</p>',",
          "850:       'Should remove redundant br elements');",
          "851:   });",
          "853:   it('TINY-3909: Replace br with nbsp when wrapped in two inline elements and one block element', () => {",
          "854:     const ser = DomSerializer({ remove_trailing_brs: true });",
          "856:     setTestHtml('<p><strong><em><br /></em></strong></p>');",
          "857:     assert.equal(",
          "858:       ser.serialize(getTestElement(), { getInner: true }),",
          "859:       '<p><strong><em>&nbsp;</em></strong></p>',",
          "860:       'Should replace br with nbsp');",
          "861:   });",
          "863:   it('TINY-3909: Replace br with nbsp when wrapped in an inline element and placed in the root', () => {",
          "864:     const ser = DomSerializer({ remove_trailing_brs: true });",
          "866:     setTestHtml('<strong><br /></strong>');",
          "867:     assert.equal(",
          "868:       ser.serialize(getTestElement(), { getInner: true }),",
          "869:       '<strong>&nbsp;</strong>',",
          "870:       'Should replace br with nbsp');",
          "871:   });",
          "873:   it('TINY-3909: Don\\'t replace br inside root element when there is multiple brs', () => {",
          "874:     const ser = DomSerializer({ remove_trailing_brs: true });",
          "876:     setTestHtml('<strong><br /><br /></strong>');",
          "877:     assert.equal(",
          "878:       ser.serialize(getTestElement(), { getInner: true }),",
          "879:       '<strong><br><br></strong>',",
          "880:       'Should not replace br with nbsp');",
          "881:   });",
          "883:   it('TINY-3909: Don\\'t replace br inside root element when there is siblings', () => {",
          "884:     const ser = DomSerializer({ remove_trailing_brs: true });",
          "886:     setTestHtml('<strong><br /></strong><em>x</em>');",
          "887:     assert.equal(",
          "888:       ser.serialize(getTestElement(), { getInner: true }),",
          "889:       '<strong><br></strong><em>x</em>',",
          "890:       'Should not replace br with nbsp');",
          "891:   });",
          "893:   it('TINY-3909: Remove br in invalid parent bug', () => {",
          "894:     const ser = DomSerializer({ remove_trailing_brs: true });",
          "896:     ser.setRules('br');",
          "897:     setTestHtml('<br>');",
          "898:     assert.equal(",
          "899:       ser.serialize(getTestElement(), { getInner: true }),",
          "900:       '',",
          "901:       'Should remove br');",
          "902:   });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/table/test/ts/browser/TableRemoveTrailingBrTest.ts||modules/tinymce/src/plugins/table/test/ts/browser/TableRemoveTrailingBrTest.ts": [
          "File: modules/tinymce/src/plugins/table/test/ts/browser/TableRemoveTrailingBrTest.ts -> modules/tinymce/src/plugins/table/test/ts/browser/TableRemoveTrailingBrTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "2: import { TinyAssertions, TinyHooks } from '@ephox/wrap-mcagar';",
          "4: import Editor from 'tinymce/core/api/Editor';",
          "5: import Plugin from 'tinymce/plugins/table/Plugin';",
          "7: import * as TableTestUtils from '../module/test/TableTestUtils';",
          "9: describe('browser.tinymce.plugins.table.TableRemoveTrailingBrTest', () => {",
          "11:   const baseSettings = {",
          "12:     plugins: 'table code',",
          "13:     base_url: '/project/tinymce/js/tinymce'",
          "14:   };",
          "16:   context('remove_trailing_br with nested table', () => {",
          "17:     const hookWithTrailingBr = TinyHooks.bddSetup<Editor>({ ...baseSettings, remove_trailing_br: true }, [ Plugin ], true);",
          "18:     const hookWithoutTrailingBr = TinyHooks.bddSetup<Editor>({ ...baseSettings, remove_trailing_br: false }, [ Plugin ], true);",
          "20:     it('TINY-3909: single table, not removing br', async () => {",
          "21:       const editor = hookWithoutTrailingBr.editor();",
          "22:       editor.setContent('');",
          "23:       await TableTestUtils.pInsertTableViaGrid(editor, 2, 2);",
          "24:       TinyAssertions.assertCursor(editor, [ 0, 1, 0, 0 ], 0);",
          "25:       TinyAssertions.assertContentPresence(editor, { br: 4 });",
          "26:     });",
          "28:     it('TINY-3909: nested table, removing br', async () => {",
          "29:       const editor = hookWithTrailingBr.editor();",
          "30:       editor.setContent('');",
          "31:       await TableTestUtils.pInsertTableViaGrid(editor, 2, 2);",
          "32:       await TableTestUtils.pInsertTableViaGrid(editor, 2, 2);",
          "33:       TinyAssertions.assertCursor(editor, [ 0, 1, 0, 0, 0, 1, 0, 0 ], 0);",
          "34:     });",
          "36:     it('TINY-3909: nested table, not removing br', async () => {",
          "37:       const editor = hookWithoutTrailingBr.editor();",
          "38:       editor.setContent('');",
          "39:       await TableTestUtils.pInsertTableViaGrid(editor, 2, 2);",
          "40:       await TableTestUtils.pInsertTableViaGrid(editor, 2, 2);",
          "41:       TinyAssertions.assertCursor(editor, [ 0, 1, 0, 0, 0, 1, 0, 0 ], 0);",
          "42:     });",
          "43:   });",
          "45: });",
          "",
          "---------------"
        ]
      }
    }
  ]
}