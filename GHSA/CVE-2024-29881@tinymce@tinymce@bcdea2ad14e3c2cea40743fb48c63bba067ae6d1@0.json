{
  "cve_id": "CVE-2024-29881",
  "cve_desc": "TinyMCE is an open source rich text editor.  A cross-site scripting (XSS) vulnerability was discovered in TinyMCE\u2019s content loading and content inserting code. A SVG image could be loaded though an `object` or `embed` element and that image could potentially contain a XSS payload. This vulnerability is fixed in 6.8.1 and 7.0.0.",
  "repo": "tinymce/tinymce",
  "patch_hash": "bcdea2ad14e3c2cea40743fb48c63bba067ae6d1",
  "patch_info": {
    "commit_hash": "bcdea2ad14e3c2cea40743fb48c63bba067ae6d1",
    "repo": "tinymce/tinymce",
    "commit_url": "https://github.com/tinymce/tinymce/commit/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1",
    "files": [
      "modules/tinymce/CHANGELOG.md",
      "modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
      "modules/tinymce/src/core/main/ts/api/Options.ts",
      "modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
      "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
      "modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
      "modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
      "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
      "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
      "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
      "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
      "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
      "modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts"
    ],
    "message": "TINY-10348 & TINY-10349: Add sandbox_iframes and convert_unsafe_embeds options (#9172)\n\n* TINY-10348: Add sandbox_iframes option\n\n* TINY-10349: Add convert_unsafe_embeds option\n\n* TINY-10348 & TINY-10349: Add paste tests\n\n* TINY-10348 & TINY-10349: Add changelog entries\n\n* TINY-10348: Add missing PageBreakPlugin dependency in SelectionToolbarTest\n\n* TINY-10349: Add attribute preservation tests for convert_unsafe_embeds",
    "before_after_code_files": [
      "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
      "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
      "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
      "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
      "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
      "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
      "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
      "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
      "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
      "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
      "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts||modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
      "modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts||modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts"
    ]
  },
  "patch_diff": {
    "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts": [
      "File: modules/tinymce/src/core/main/ts/api/OptionTypes.ts -> modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "86:   contextmenu?: string | string[] | false;",
      "87:   contextmenu_never_use_native?: boolean;",
      "88:   convert_fonts_to_spans?: boolean;",
      "89:   convert_urls?: boolean;",
      "90:   custom_colors?: boolean;",
      "91:   custom_elements?: string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "89:   convert_unsafe_embeds?: boolean;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "197:   resize?: boolean | 'both';",
      "198:   resize_img_proportional?: boolean;",
      "199:   root_name?: string;",
      "200:   schema?: SchemaType;",
      "201:   selector?: string;",
      "202:   setup?: SetupCallback;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "201:   sandbox_iframes?: boolean;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "289:   color_default_foreground: string;",
      "290:   content_css: string[];",
      "291:   contextmenu: string[];",
      "292:   custom_colors: boolean;",
      "293:   default_font_stack: string[];",
      "294:   document_base_url: string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "294:   convert_unsafe_embeds: boolean;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "336:   promotion: boolean;",
      "337:   readonly: boolean;",
      "338:   removed_menuitems: string;",
      "339:   toolbar: boolean | string | string[] | Array<ToolbarGroup>;",
      "340:   toolbar_groups: Record<string, Toolbar.GroupToolbarButtonSpec>;",
      "341:   toolbar_location: ToolbarLocation;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "342:   sandbox_iframes: boolean;",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
      "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "836:     default: 'off',",
      "837:   });",
      "840:   editor.on('ScriptsLoaded', () => {",
      "841:     registerOption('directionality', {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "839:   registerOption('sandbox_iframes', {",
      "840:     processor: 'boolean',",
      "841:     default: false",
      "842:   });",
      "844:   registerOption('convert_unsafe_embeds', {",
      "845:     processor: 'boolean',",
      "846:     default: false",
      "847:   });",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "944: const shouldHighlightOnFocus = option('highlight_on_focus');",
      "945: const shouldSanitizeXss = option('xss_sanitization');",
      "946: const shouldUseDocumentWrite = option('init_content_sync');",
      "963: const hasTableTabNavigation = option('table_tab_navigation');",
      "965: const getDetailsInitialState = option('details_initial_state');",
      "966: const getDetailsSerializedState = option('details_serialized_state');",
      "968: const shouldForceHexColor = option('force_hex_color');",
      "970: export {",
      "971:   register,",
      "",
      "[Removed Lines]",
      "948: const hasTextPatternsLookup = (editor: Editor): boolean =>",
      "949:   editor.options.isSet('text_patterns_lookup');",
      "951: const getFontStyleValues = (editor: Editor): string[] =>",
      "952:   Tools.explode(editor.options.get('font_size_style_values'));",
      "954: const getFontSizeClasses = (editor: Editor): string[] =>",
      "955:   Tools.explode(editor.options.get('font_size_classes'));",
      "957: const isEncodingXml = (editor: Editor): boolean =>",
      "958:   editor.options.get('encoding') === 'xml';",
      "960: const getAllowedImageFileTypes = (editor: Editor): string[] =>",
      "961:   Tools.explode(editor.options.get('images_file_types'));",
      "",
      "[Added Lines]",
      "957: const hasTextPatternsLookup = (editor: Editor): boolean => editor.options.isSet('text_patterns_lookup');",
      "958: const getFontStyleValues = (editor: Editor): string[] => Tools.explode(editor.options.get('font_size_style_values'));",
      "959: const getFontSizeClasses = (editor: Editor): string[] => Tools.explode(editor.options.get('font_size_classes'));",
      "960: const isEncodingXml = (editor: Editor): boolean => editor.options.get('encoding') === 'xml';",
      "961: const getAllowedImageFileTypes = (editor: Editor): string[] => Tools.explode(editor.options.get('images_file_types'));",
      "966: const shouldSandboxIframes = option('sandbox_iframes');",
      "967: const shouldConvertUnsafeEmbeds = option('convert_unsafe_embeds');",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1071:   getDetailsInitialState,",
      "1072:   getDetailsSerializedState,",
      "1073:   shouldUseDocumentWrite,",
      "1075: };",
      "",
      "[Removed Lines]",
      "1074:   shouldForceHexColor",
      "",
      "[Added Lines]",
      "1073:   shouldForceHexColor,",
      "1074:   shouldSandboxIframes,",
      "1075:   shouldConvertUnsafeEmbeds",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts": [
      "File: modules/tinymce/src/core/main/ts/api/html/DomParser.ts -> modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "57:   allow_unsafe_link_target?: boolean;",
      "58:   blob_cache?: BlobCache;",
      "59:   convert_fonts_to_spans?: boolean;",
      "60:   document?: Document;",
      "61:   fix_list_elements?: boolean;",
      "62:   font_size_legacy_values?: string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "60:   convert_unsafe_embeds?: boolean;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "70:   remove_trailing_brs?: boolean;",
      "71:   root_name?: string;",
      "72:   sanitize?: boolean;",
      "73:   validate?: boolean;",
      "74: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "73:   sandbox_iframes?: boolean;",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts": [
      "File: modules/tinymce/src/core/main/ts/content/PrePostProcess.ts -> modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: import Editor from '../api/Editor';",
      "4: import * as Events from '../api/Events';",
      "6: import HtmlSerializer from '../api/html/Serializer';",
      "7: import * as Options from '../api/Options';",
      "8: import { EditorEvent } from '../api/util/EventDispatcher';",
      "",
      "[Removed Lines]",
      "5: import DomParser from '../api/html/DomParser';",
      "",
      "[Added Lines]",
      "5: import DomParser, { DomParserSettings } from '../api/html/DomParser';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "11: const serializeContent = (content: Content): string =>",
      "12:   isTreeNode(content) ? HtmlSerializer({ validate: false }).serialize(content) : content;",
      "15:   const serializedContent = serializeContent(content);",
      "16:   const eventArgs = fireEvent(serializedContent);",
      "17:   if (eventArgs.isDefaultPrevented()) {",
      "",
      "[Removed Lines]",
      "14: const withSerializedContent = <R extends EditorEvent<{ content: string }>>(content: Content, fireEvent: (content: string) => R, sanitize: boolean): R & { content: Content } => {",
      "",
      "[Added Lines]",
      "14: const withSerializedContent = <R extends EditorEvent<{ content: string }>>(content: Content, fireEvent: (content: string) => R, parserSettings: DomParserSettings): R & { content: Content } => {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "22:     if (eventArgs.content !== serializedContent) {",
      "24:       return { ...eventArgs, content: rootNode };",
      "25:     } else {",
      "26:       return { ...eventArgs, content };",
      "",
      "[Removed Lines]",
      "23:       const rootNode = DomParser({ validate: false, forced_root_block: false, sanitize }).parse(eventArgs.content, { context: content.name });",
      "",
      "[Added Lines]",
      "23:       const rootNode = DomParser({ validate: false, forced_root_block: false, ...parserSettings }).parse(eventArgs.content, { context: content.name });",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "47:   if (args.no_events) {",
      "48:     return content;",
      "49:   } else {",
      "51:     return processedEventArgs.content;",
      "52:   }",
      "53: };",
      "",
      "[Removed Lines]",
      "50:     const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), Options.shouldSanitizeXss(editor));",
      "",
      "[Added Lines]",
      "50:     const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), { sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) });",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "56:   if (args.no_events) {",
      "57:     return Result.value(args);",
      "58:   } else {",
      "60:     if (processedEventArgs.isDefaultPrevented()) {",
      "61:       Events.fireSetContent(editor, processedEventArgs);",
      "62:       return Result.error(undefined);",
      "",
      "[Removed Lines]",
      "59:     const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), Options.shouldSanitizeXss(editor));",
      "",
      "[Added Lines]",
      "59:     const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), { sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts": [
      "File: modules/tinymce/src/core/main/ts/html/ParserFilters.ts -> modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: import Env from '../api/Env';",
      "4: import DomParser, { DomParserSettings } from '../api/html/DomParser';",
      "",
      "[Removed Lines]",
      "1: import { Arr, Type } from '@ephox/katamari';",
      "",
      "[Added Lines]",
      "1: import { Arr, Strings, Type } from '@ephox/katamari';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "32:   }",
      "33: };",
      "35: const register = (parser: DomParser, settings: DomParserSettings): void => {",
      "36:   const schema = parser.schema;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "35: const isMimeType = (mime: string, type: 'image' | 'video' | 'audio'): boolean => Strings.startsWith(mime, `${type}/`);",
      "37: const createSafeEmbed = (mime?: string, src?: string, width?: string, height?: string, sandboxIframes?: boolean): AstNode => {",
      "38:   let name: 'iframe' | 'img' | 'video' | 'audio';",
      "39:   if (Type.isUndefined(mime)) {",
      "40:     name = 'iframe';",
      "41:   } else if (isMimeType(mime, 'image')) {",
      "42:     name = 'img';",
      "43:   } else if (isMimeType(mime, 'video')) {",
      "44:     name = 'video';",
      "45:   } else if (isMimeType(mime, 'audio')) {",
      "46:     name = 'audio';",
      "47:   } else {",
      "48:     name = 'iframe';",
      "49:   }",
      "51:   const embed = new AstNode(name, 1);",
      "52:   embed.attr(name === 'audio' ? { src } : { src, width, height });",
      "55:   if (name === 'audio' || name === 'video') {",
      "56:     embed.attr('controls', '');",
      "57:   }",
      "59:   if (name === 'iframe' && sandboxIframes) {",
      "60:     embed.attr('sandbox', '');",
      "61:   }",
      "62:   return embed;",
      "63: };",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "153:   }",
      "155:   registerBase64ImageFilter(parser, settings);",
      "156: };",
      "158: export {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "187:   if (settings.convert_unsafe_embeds) {",
      "188:     parser.addNodeFilter('object,embed', (nodes) => Arr.each(nodes, (node) => {",
      "189:       node.replace(",
      "190:         createSafeEmbed(",
      "191:           node.attr('type'),",
      "192:           node.name === 'object' ? node.attr('data') : node.attr('src'),",
      "193:           node.attr('width'),",
      "194:           node.attr('height'),",
      "195:           settings.sandbox_iframes",
      "196:         ));",
      "197:     }));",
      "198:   }",
      "200:   if (settings.sandbox_iframes) {",
      "201:     parser.addNodeFilter('iframe', (nodes) => Arr.each(nodes, (node) => node.attr('sandbox', '')));",
      "202:   }",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts": [
      "File: modules/tinymce/src/core/main/ts/init/InitContentBody.ts -> modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "73:     allow_html_in_named_anchor: getOption('allow_html_in_named_anchor'),",
      "74:     allow_script_urls: getOption('allow_script_urls'),",
      "75:     allow_unsafe_link_target: getOption('allow_unsafe_link_target'),",
      "76:     convert_fonts_to_spans: getOption('convert_fonts_to_spans'),",
      "77:     fix_list_elements: getOption('fix_list_elements'),",
      "78:     font_size_legacy_values: getOption('font_size_legacy_values'),",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "76:     convert_unsafe_embeds: getOption('convert_unsafe_embeds'),",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "81:     preserve_cdata: getOption('preserve_cdata'),",
      "82:     inline_styles: getOption('inline_styles'),",
      "83:     root_name: getRootName(editor),",
      "84:     sanitize: getOption('xss_sanitization'),",
      "85:     validate: true,",
      "86:     blob_cache: blobCache,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "85:     sandbox_iframes: getOption('sandbox_iframes'),",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts": [
      "File: modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts -> modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "11: }",
      "13: const preProcess = (editor: Editor, html: string): string => {",
      "17:   parser.addNodeFilter('meta', (nodes) => {",
      "",
      "[Removed Lines]",
      "14:   const parser = DomParser({ sanitize: Options.shouldSanitizeXss(editor) }, editor.schema);",
      "",
      "[Added Lines]",
      "14:   const parser = DomParser({ sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) }, editor.schema);",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts": [
      "File: modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts -> modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "350:             assert.equal(content, final, 'ZWNBSP should be stripped');",
      "351:           });",
      "352:         });",
      "353:       });",
      "354:     }",
      "355:   );",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "354:         context('iframe sandboxing', () => {",
      "355:           context('sandbox_iframes default', () => {",
      "356:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "357:               ...options,",
      "358:               base_url: '/project/tinymce/js/tinymce'",
      "359:             }, []);",
      "361:             it('TINY-10348: Iframe should not be sandboxed by default', () => {",
      "362:               const editor = hook.editor();",
      "363:               editor.setContent('<iframe src=\"about:blank\"></iframe>');",
      "364:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\"></iframe></p>');",
      "365:             });",
      "366:           });",
      "368:           context('sandbox_iframes: false', () => {",
      "369:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "370:               ...options,",
      "371:               base_url: '/project/tinymce/js/tinymce',",
      "372:               sandbox_iframes: false",
      "373:             }, []);",
      "375:             it('TINY-10348: Iframe should not be sandboxed when sandbox_iframes: false', () => {",
      "376:               const editor = hook.editor();",
      "377:               editor.setContent('<iframe src=\"about:blank\"></iframe>');",
      "378:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\"></iframe></p>');",
      "379:             });",
      "381:             it('TINY-10348: Iframe with sandbox attribute should not be modified when sandbox_iframes: false', () => {",
      "382:               const editor = hook.editor();",
      "383:               editor.setContent('<iframe src=\"about:blank\" sandbox=\"allow-scripts allow-same-origin allow-forms\"></iframe>');",
      "384:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"allow-scripts allow-same-origin allow-forms\"></iframe></p>');",
      "385:             });",
      "386:           });",
      "388:           context('sandbox_iframes: true', () => {",
      "389:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "390:               ...options,",
      "391:               base_url: '/project/tinymce/js/tinymce',",
      "392:               sandbox_iframes: true",
      "393:             }, []);",
      "395:             it('TINY-10348: Iframe should be sandboxed when sandbox_iframes: true', () => {",
      "396:               const editor = hook.editor();",
      "397:               editor.setContent('<iframe src=\"about:blank\"></iframe>');",
      "398:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>');",
      "399:             });",
      "401:             it('TINY-10348: Iframe with sandbox attribute should be sandboxed when sandbox_iframes: true', () => {",
      "402:               const editor = hook.editor();",
      "403:               editor.setContent('<iframe src=\"about:blank\" sandbox=\"allow-scripts allow-same-origin allow-forms\"></iframe>');",
      "404:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>');",
      "405:             });",
      "406:           });",
      "407:         });",
      "409:         context('Convert unsafe embeds', () => {",
      "410:           const setAndAssertEmbed = (editor: Editor, embedHtml: string, expectedHtml: string) => {",
      "411:             editor.setContent(embedHtml);",
      "412:             TinyAssertions.assertContent(editor, `<p>${expectedHtml}</p>`);",
      "413:           };",
      "415:           const testNoConversion = (hook: TinyHooks.Hook<Editor>, embedHtml: string) => () => {",
      "416:             const editor = hook.editor();",
      "417:             setAndAssertEmbed(editor, embedHtml, embedHtml);",
      "418:           };",
      "420:           const testConversion = (hook: TinyHooks.Hook<Editor>, embedHtml: string, expectedHtml: string) => () => {",
      "421:             const editor = hook.editor();",
      "422:             setAndAssertEmbed(editor, embedHtml, expectedHtml);",
      "423:           };",
      "425:           context('convert_unsafe_embeds default', () => {",
      "426:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "427:               ...options,",
      "428:               base_url: '/project/tinymce/js/tinymce'",
      "429:             }, []);",
      "431:             it('TINY-10349: Object elements should not be converted', testNoConversion(hook, '<object data=\"about:blank\"></object>'));",
      "432:             it('TINY-10349: Embed elements should not be converted', testNoConversion(hook, '<embed src=\"about:blank\">'));",
      "433:           });",
      "435:           context('convert_unsafe_embeds: false', () => {",
      "436:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "437:               ...options,",
      "438:               base_url: '/project/tinymce/js/tinymce',",
      "439:               convert_unsafe_embeds: false",
      "440:             }, []);",
      "442:             it('TINY-10349: Object elements should not be converted', testNoConversion(hook, '<object data=\"about:blank\"></object>'));",
      "443:             it('TINY-10349: Embed elements should not be converted', testNoConversion(hook, '<embed src=\"about:blank\">'));",
      "444:           });",
      "446:           context('convert_unsafe_embeds: true', () => {",
      "447:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "448:               ...options,",
      "449:               base_url: '/project/tinymce/js/tinymce',",
      "450:               convert_unsafe_embeds: true",
      "451:             }, []);",
      "453:             it('TINY-10349: Object elements should be converted to iframe',",
      "454:               testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
      "456:             it('TINY-10349: Embed elements should be converted to iframe',",
      "457:               testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\"></iframe>'));",
      "458:           });",
      "460:           context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
      "461:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "462:               ...options,",
      "463:               base_url: '/project/tinymce/js/tinymce',",
      "464:               convert_unsafe_embeds: true,",
      "465:               sandbox_iframes: true",
      "466:             }, []);",
      "468:             it('TINY-10349: Object elements should be converted to sandboxed iframe',",
      "469:               testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "471:             it('TINY-10349: Embed elements should be converted to sandboxed iframe',",
      "472:               testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "473:           });",
      "474:         });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts": [
      "File: modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts -> modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "1531:           }));",
      "1532:         });",
      "1533:       });",
      "1534:     });",
      "1535:   });",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1535:       context('Sandboxing iframes', () => {",
      "1536:         const serializeIframeHtml = (sandbox: boolean): string => {",
      "1537:           const parser = DomParser({ ...scenario.settings, sandbox_iframes: sandbox });",
      "1538:           return serializer.serialize(parser.parse('<iframe src=\"about:blank\"></iframe>'));",
      "1539:         };",
      "1541:         it('TINY-10348: iframes should be sandboxed when sandbox_iframes: false', () =>",
      "1542:           assert.equal(serializeIframeHtml(false), '<iframe src=\"about:blank\"></iframe>'));",
      "1544:         it('TINY-10348: iframes should be sandboxed when sandbox_iframes: true', () =>",
      "1545:           assert.equal(serializeIframeHtml(true), '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "1546:       });",
      "1548:       context('Convert unsafe embeds', () => {",
      "1549:         const serializeEmbedHtml = (embedHtml: string, convert: boolean): string => {",
      "1550:           const parser = DomParser({ ...scenario.settings, convert_unsafe_embeds: convert });",
      "1551:           return serializer.serialize(parser.parse(embedHtml));",
      "1552:         };",
      "1554:         const testConversion = (embedHtml: string, expectedHtml: string) => () => {",
      "1555:           const serializedHtml = serializeEmbedHtml(embedHtml, true);",
      "1556:           assert.equal(serializedHtml, expectedHtml);",
      "1557:         };",
      "1559:         context('convert_unsafe_embeds: false', () => {",
      "1560:           const testNoConversion = (embedHtml: string) => () => {",
      "1561:             const serializedHtml = serializeEmbedHtml(embedHtml, false);",
      "1562:             assert.equal(serializedHtml, embedHtml);",
      "1563:           };",
      "1565:           it('TINY-10349: Object elements should not be converted', testNoConversion('<object data=\"about:blank\"></object>'));",
      "1566:           it('TINY-10349: Object elements with a mime type should not be converted', testNoConversion('<object data=\"about:blank\" type=\"image/png\"></object>'));",
      "1567:           it('TINY-10349: Embed elements should notr be converted', testNoConversion('<embed src=\"about:blank\">'));",
      "1568:           it('TINY-10349: Embed elements with a mime type should not be converted', testNoConversion('<embed src=\"about:blank\" type=\"image/png\">'));",
      "1569:         });",
      "1571:         context('convert_unsafe_embeds: true', () => {",
      "1572:           it('TINY-10349: Object elements without a mime type should be converted to iframe',",
      "1573:             testConversion('<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
      "1574:           it('TINY-10349: Object elements with an image mime type should be converted to img',",
      "1575:             testConversion('<object data=\"about:blank\" type=\"image/png\"></object>', '<img src=\"about:blank\">'));",
      "1576:           it('TINY-10349: Object elements with a video mime type should be converted to video',",
      "1577:             testConversion('<object data=\"about:blank\" type=\"video/mp4\"></object>', '<video src=\"about:blank\" controls=\"\"></video>'));",
      "1578:           it('TINY-10349: Object elements with an audio mime type should be converted to audio',",
      "1579:             testConversion('<object data=\"about:blank\" type=\"audio/mpeg\"></object>', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1580:           it('TINY-10349: Object elements with other mime type should be converted to iframe',",
      "1581:             testConversion('<object data=\"about:blank\" type=\"application/pdf\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
      "1583:           it('TINY-10349: Embed elements without a mime type should be converted to iframe',",
      "1584:             testConversion('<embed src=\"about:blank\">', '<iframe src=\"about:blank\"></iframe>'));",
      "1585:           it('TINY-10349: Embed elements with an image mime type should be converted to img',",
      "1586:             testConversion('<embed src=\"about:blank\" type=\"image/png\">', '<img src=\"about:blank\">'));",
      "1587:           it('TINY-10349: Embed elements with a video mime type should be converted to video',",
      "1588:             testConversion('<embed src=\"about:blank\" type=\"video/mp4\">', '<video src=\"about:blank\" controls=\"\"></video>'));",
      "1589:           it('TINY-10349: Embed elements with an audio mime type should be converted to audio',",
      "1590:             testConversion('<embed src=\"about:blank\" type=\"audio/mpeg\">', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1591:           it('TINY-10349: Embed elements with other mime type should be converted to iframe',",
      "1592:             testConversion('<embed src=\"about:blank\" type=\"application/pdf\">', '<iframe src=\"about:blank\"></iframe>'));",
      "1593:         });",
      "1595:         context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
      "1596:           const testSandboxedConversion = (embedHtml: string, expectedHtml: string) => () => {",
      "1597:             const parser = DomParser({ ...scenario.settings, convert_unsafe_embeds: true, sandbox_iframes: true });",
      "1598:             const serializedHtml = serializer.serialize(parser.parse(embedHtml));",
      "1599:             assert.equal(serializedHtml, expectedHtml);",
      "1600:           };",
      "1602:           it('TINY-10349: Object elements without a mime type should be converted to sandboxed iframe',",
      "1603:             testSandboxedConversion('<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "1605:           it('TINY-10349: Embed elements without a mime type should be converted to sandboxed iframe',",
      "1606:             testSandboxedConversion('<embed src=\"about:blank\">', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "1607:         });",
      "1609:         context('convert_unsafe_embeds: true, attribute preservation', () => {",
      "1610:           it('TINY-10349: Object elements should perserve width and height attributes only',",
      "1611:             testConversion('<object data=\"about:blank\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1612:           it('TINY-10349: Object elements with an image mime type should perserve width and height attributes only',",
      "1613:             testConversion('<object data=\"about:blank\" type=\"image/png\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<img src=\"about:blank\" width=\"100\" height=\"100\">'));",
      "1614:           it('TINY-10349: Object elements with a video mime type should perserve width and height attributes only',",
      "1615:             testConversion('<object data=\"about:blank\" type=\"video/mp4\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<video src=\"about:blank\" width=\"100\" height=\"100\" controls=\"\"></video>'));",
      "1616:           it('TINY-10349: Object elements with an audio mime type should not perserve other attributes only',",
      "1617:             testConversion('<object data=\"about:blank\" type=\"audio/mpeg\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1618:           it('TINY-10349: Object elements with other mime type should perserve width and height attributes only',",
      "1619:             testConversion('<object data=\"about:blank\" type=\"application/pdf\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1621:           it('TINY-10349: Embed elements should preserve width and heigth attributes only',",
      "1622:             testConversion('<embed src=\"about:blank\" width=\"100\" height=\"100\" style=\"color: red;\">', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1623:           it('TINY-10349: Embed elements with an image mime type should preserve width and height attributes only',",
      "1624:             testConversion('<embed src=\"about:blank\" type=\"image/png\" width=\"100\" height=\"100\" style=\"color: red;\">', '<img src=\"about:blank\" width=\"100\" height=\"100\">'));",
      "1625:           it('TINY-10349: Embed elements with a video mime type should preserve width and height attributes only',",
      "1626:             testConversion('<embed src=\"about:blank\" type=\"video/mp4\" width=\"100\" height=\"100\" style=\"color: red;\">', '<video src=\"about:blank\" width=\"100\" height=\"100\" controls=\"\"></video>'));",
      "1627:           it('TINY-10349: Embed elements with an audio mime type should not preserve other attributes',",
      "1628:             testConversion('<embed src=\"about:blank\" type=\"audio/mpeg\" width=\"100\" height=\"100\" style=\"color: red;\">', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1629:           it('TINY-10349: Embed elements with other mime type should preserve width and height attributes only',",
      "1630:             testConversion('<embed src=\"about:blank\" type=\"application/pdf\" width=\"100\" height=\"100\" style=\"color: red;\">', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1631:         });",
      "1632:       });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts": [
      "File: modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts -> modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "19:     base_url: '/project/tinymce/js/tinymce'",
      "20:   }, [], true);",
      "22:   beforeEach(() => {",
      "23:     const editor = hook.editor();",
      "24:     editor.setContent('');",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22:   const testPasteHtml = (hook: TinyHooks.Hook<Editor>, html: string, expected: string) => () => {",
      "23:     const editor = hook.editor();",
      "24:     editor.setContent('');",
      "25:     editor.execCommand('mceInsertClipboardContent', false, { html });",
      "26:     TinyAssertions.assertContent(editor, expected);",
      "27:   };",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "505:       editor.off('beforeinput', setBeforeInputEvent);",
      "506:       editor.off('input', setInputEvent);",
      "507:     });",
      "508:   });",
      "509: });",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "516:     context('iframe sandboxing', () => {",
      "517:       context('sandbox_iframes: false', () => {",
      "518:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "519:           base_url: '/project/tinymce/js/tinymce',",
      "520:           sandbox_iframes: false",
      "521:         });",
      "523:         it('TINY-10348: Pasted iframe should not be sandboxed',",
      "524:           testPasteHtml(hook, '<iframe src=\"about:blank\"></iframe>', '<p><iframe src=\"about:blank\"></iframe></p>'));",
      "525:       });",
      "527:       context('sandbox_iframes: true', () => {",
      "528:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "529:           base_url: '/project/tinymce/js/tinymce',",
      "530:           sandbox_iframes: true",
      "531:         });",
      "533:         it('TINY-10348: Pasted iframe should be sandboxed',",
      "534:           testPasteHtml(hook, '<iframe src=\"about:blank\"></iframe>', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
      "535:       });",
      "536:     });",
      "538:     context('Convert unsafe embeds', () => {",
      "539:       context('convert_unsafe_embeds: false', () => {",
      "540:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "541:           base_url: '/project/tinymce/js/tinymce',",
      "542:           convert_unsafe_embeds: false",
      "543:         });",
      "545:         it('TINY-10349: Pasted object element should not be converted',",
      "546:           testPasteHtml(hook, '<object data=\"about:blank\"></object>', '<p><object data=\"about:blank\"></object></p>'));",
      "548:         it('TINY-10349: Pasted embed element should not be converted',",
      "549:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><embed src=\"about:blank\"></p>'));",
      "550:       });",
      "552:       context('convert_unsafe_embeds: true', () => {",
      "553:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "554:           base_url: '/project/tinymce/js/tinymce',",
      "555:           convert_unsafe_embeds: true",
      "556:         });",
      "558:         it('TINY-10349: Pasted object element should be converted to iframe',",
      "559:           testPasteHtml(hook, '<object data=\"about:blank\">', '<p><iframe src=\"about:blank\"></iframe></p>'));",
      "561:         it('TINY-10349: Pasted embed element should be converted to iframe',",
      "562:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><iframe src=\"about:blank\"></iframe></p>'));",
      "563:       });",
      "565:       context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
      "566:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "567:           base_url: '/project/tinymce/js/tinymce',",
      "568:           convert_unsafe_embeds: true,",
      "569:           sandbox_iframes: true",
      "570:         });",
      "572:         it('TINY-10349: Pasted object element should be converted to sandboxed iframe',",
      "573:           testPasteHtml(hook, '<object data=\"about:blank\"></object>', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
      "575:         it('TINY-10349: Pasted embed element should be converted to sandboxed iframe',",
      "576:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
      "577:       });",
      "578:     });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts||modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts": [
      "File: modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts -> modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "91:   if (name === 'iframe') {",
      "92:     previewNode.attr({",
      "93:       allowfullscreen: node.attr('allowfullscreen'),",
      "95:     });",
      "96:   } else {",
      "",
      "[Removed Lines]",
      "94:       frameborder: '0'",
      "",
      "[Added Lines]",
      "94:       frameborder: '0',",
      "95:       sandbox: node.attr('sandbox')",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts": [
      "File: modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "57:     );",
      "58:   });",
      "60:   it('TBA: Iframe with innerHTML retained as is with xss_sanitization: false', async () => {",
      "62:     const editor = await McEditor.pFromSettings<Editor>({",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "60:   it('TINY-10348: Iframe retained as is with sandbox_iframes: false', async () => {",
      "61:     const editor = await McEditor.pFromSettings({ ...settings, sandbox_iframes: false });",
      "62:     editor.setContent('<iframe src=\"320x240.ogg\" allowfullscreen></iframe>');",
      "63:     TinyAssertions.assertContent(editor,",
      "64:       '<p><iframe src=\"320x240.ogg\" width=\"300\" height=\"150\" allowfullscreen=\"allowfullscreen\"></iframe></p>'",
      "65:     );",
      "66:     McEditor.remove(editor);",
      "67:   });",
      "69:   it('TINY-10348: Iframe retained as is with sandbox_iframes: true', async () => {",
      "70:     const editor = await McEditor.pFromSettings({ ...settings, sandbox_iframes: true });",
      "71:     editor.setContent('<iframe src=\"320x240.ogg\" allowfullscreen></iframe>');",
      "72:     TinyAssertions.assertContent(editor,",
      "73:       '<p><iframe src=\"320x240.ogg\" width=\"300\" height=\"150\" sandbox=\"\" allowfullscreen=\"allowfullscreen\"></iframe></p>'",
      "74:     );",
      "75:     McEditor.remove(editor);",
      "76:   });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts": [
      "File: modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: import { ApproxStructure, Assertions, StructAssert, UiFinder } from '@ephox/agar';",
      "6: import Editor from 'tinymce/core/api/Editor';",
      "7: import Plugin from 'tinymce/plugins/media/Plugin';",
      "9: describe('browser.tinymce.plugins.media.core.LiveEmbedNodeTest', () => {",
      "11:     plugins: [ 'media' ],",
      "13:     base_url: '/project/tinymce/js/tinymce'",
      "14:   }, [ Plugin ]);",
      "",
      "[Removed Lines]",
      "2: import { describe, it } from '@ephox/bedrock-client';",
      "3: import { Arr, Fun, Obj } from '@ephox/katamari';",
      "4: import { TinyDom, TinyHooks } from '@ephox/wrap-mcagar';",
      "10:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "12:     toolbar: 'media',",
      "",
      "[Added Lines]",
      "2: import { context, describe, it } from '@ephox/bedrock-client';",
      "3: import { Arr, Fun, Obj, Type } from '@ephox/katamari';",
      "4: import { McEditor, TinyDom, TinyHooks } from '@ephox/wrap-mcagar';",
      "10:   const baseSettings = {",
      "12:     toolbar: 'media'",
      "13:   };",
      "14:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "15:     ...baseSettings,",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "17:     editor: Editor,",
      "18:     tag: string,",
      "19:     classes: string[],",
      "21:     styles: Record<string, string>,",
      "22:     getChildren: ApproxStructure.Builder<StructAssert[]> = Fun.constant([])",
      "23:   ) => {",
      "",
      "[Removed Lines]",
      "20:     attrs: Record<string, string>,",
      "",
      "[Added Lines]",
      "23:     attrs: Record<string, string | null>,",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "36:           attrs: {",
      "37:             height: str.none('should not have height'),",
      "38:             width: str.none('should not have width'),",
      "40:           },",
      "41:           styles: {",
      "42:             height: str.none('should not have height style'),",
      "",
      "[Removed Lines]",
      "39:             ...Obj.map(attrs, (value) => str.is(value))",
      "",
      "[Added Lines]",
      "42:             ...Obj.map(attrs, (value) => Type.isNull(value) ? str.none() : str.is(value))",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "131:       })",
      "132:     ]);",
      "133:   });",
      "134: });",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "138:   context('Sandboxing iframes', () => {",
      "139:     const initialIframeHtml = '<iframe src=\"about:blank\"></iframe>';",
      "141:     it('TINY-10348: sandbox_iframes: false should not have sandbox attribute in live embed', async () => {",
      "142:       const editor = await McEditor.pFromSettings<Editor>({ ...baseSettings, sandbox_iframes: false });",
      "143:       editor.setContent(initialIframeHtml);",
      "144:       assertStructure(editor, 'iframe', [ ], { sandbox: null }, { });",
      "145:     });",
      "147:     it('TINY-10348: sandbox_iframes: true should havce sandbox attribute in live embed', async () => {",
      "148:       const editor = await McEditor.pFromSettings<Editor>({ ...baseSettings, sandbox_iframes: true });",
      "149:       editor.setContent(initialIframeHtml);",
      "150:       assertStructure(editor, 'iframe', [ ], { sandbox: '' }, { });",
      "151:     });",
      "152:   });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts": [
      "File: modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: import { ApproxStructure, StructAssert, Waiter } from '@ephox/agar';",
      "2: import { before, context, describe, it } from '@ephox/bedrock-client';",
      "5: import Editor from 'tinymce/core/api/Editor';",
      "6: import Env from 'tinymce/core/api/Env';",
      "",
      "[Removed Lines]",
      "3: import { TinyAssertions, TinyHooks, TinyUiActions } from '@ephox/wrap-mcagar';",
      "",
      "[Added Lines]",
      "3: import { McEditor, TinyAssertions, TinyHooks, TinyUiActions } from '@ephox/wrap-mcagar';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "9: import * as Utils from '../module/test/Utils';",
      "11: describe('browser.tinymce.plugins.media.core.PlaceholderTest', () => {",
      "13:     plugins: [ 'media' ],",
      "14:     toolbar: 'media',",
      "16:     base_url: '/project/tinymce/js/tinymce'",
      "17:   }, [ Plugin ]);",
      "",
      "[Removed Lines]",
      "12:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "15:     extended_valid_elements: 'script[src|type]',",
      "",
      "[Added Lines]",
      "12:   const baseSettings = {",
      "15:     extended_valid_elements: 'script[src|type]'",
      "16:   };",
      "18:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "19:     ...baseSettings,",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "42:     });",
      "43:   });",
      "63:   context('media_live_embeds=false', () => {",
      "64:     before(() => {",
      "65:       const editor = hook.editor();",
      "",
      "[Removed Lines]",
      "45:   const iframeStructure = ApproxStructure.build((s) => {",
      "46:     return s.element('body', {",
      "47:       children: [",
      "48:         s.element('p', {",
      "49:           children: [",
      "50:             s.element('span', {",
      "51:               children: [",
      "52:                 s.element('iframe', {}),",
      "53:                 s.element('span', {})",
      "54:               ]",
      "55:             })",
      "56:           ]",
      "57:         }),",
      "58:         s.theRest()",
      "59:       ]",
      "60:     });",
      "61:   });",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "88:   });",
      "90:   context('media_live_embeds=true', () => {",
      "91:     before(() => {",
      "92:       const editor = hook.editor();",
      "93:       editor.options.set('media_live_embeds', true);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "77:     const createIframeStructure = (sandbox: boolean) => ApproxStructure.build((s, str) => {",
      "78:       return s.element('body', {",
      "79:         children: [",
      "80:           s.element('p', {",
      "81:             children: [",
      "82:               s.element('span', {",
      "83:                 children: [",
      "84:                   s.element('iframe', {",
      "85:                     attrs: {",
      "86:                       sandbox: sandbox ? str.is('') : str.none()",
      "87:                     }",
      "88:                   }),",
      "89:                   s.element('span', {})",
      "90:                 ]",
      "91:               })",
      "92:             ]",
      "93:           }),",
      "94:           s.theRest()",
      "95:         ]",
      "96:       });",
      "97:     });",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "97:       'https://www.youtube.com/watch?v=P_205ZY52pY',",
      "98:       '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
      "99:       'height=\"314\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
      "101:     ));",
      "102:   });",
      "103: });",
      "",
      "[Removed Lines]",
      "100:       iframeStructure",
      "",
      "[Added Lines]",
      "108:       createIframeStructure(false)",
      "111:     it('TINY-10348: Live iframe embed structure when sandbox_iframes: false', async () => {",
      "112:       const editor = await McEditor.pFromSettings<Editor>({",
      "113:         ...baseSettings,",
      "114:         sandbox_iframes: false",
      "115:       });",
      "116:       pTestPlaceholder(editor,",
      "117:         'https://www.youtube.com/watch?v=P_205ZY52pY',",
      "118:         '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
      "119:         'height=\"314\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
      "120:         createIframeStructure(false)",
      "121:       );",
      "122:     });",
      "124:     it('TINY-10348: Live iframe embed structure when sandbox_iframes: true', async () => {",
      "125:       const editor = await McEditor.pFromSettings<Editor>({",
      "126:         ...baseSettings,",
      "127:         sandbox_iframes: true",
      "128:       });",
      "129:       pTestPlaceholder(editor,",
      "130:         'https://www.youtube.com/watch?v=P_205ZY52pY',",
      "131:         '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
      "132:         'height=\"314\" sandbox=\"\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
      "133:         createIframeStructure(true)",
      "134:       );",
      "135:     });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts||modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts": [
      "File: modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts -> modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "6: import Editor from 'tinymce/core/api/Editor';",
      "7: import LinkPlugin from 'tinymce/plugins/link/Plugin';",
      "8: import QuickbarsPlugin from 'tinymce/plugins/quickbars/Plugin';",
      "10: enum Alignment {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "8: import PageBreakPlugin from 'tinymce/plugins/pagebreak/Plugin';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "20:     toolbar: false,",
      "21:     menubar: false,",
      "22:     base_url: '/project/tinymce/js/tinymce'",
      "25:   const imgSrc = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';",
      "",
      "[Removed Lines]",
      "23:   }, [ LinkPlugin, QuickbarsPlugin ], true);",
      "",
      "[Added Lines]",
      "24:   }, [ LinkPlugin, QuickbarsPlugin, PageBreakPlugin ], true);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "6256d08e9754ede01131cedfbac4cd1be43ddd09",
      "candidate_info": {
        "commit_hash": "6256d08e9754ede01131cedfbac4cd1be43ddd09",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/6256d08e9754ede01131cedfbac4cd1be43ddd09",
        "files": [
          ".changes/unreleased/tinymce-TINY-10681-2024-02-22.yaml",
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/main/ts/init/LicenseKeyValidation.ts",
          "modules/tinymce/src/core/test/ts/browser/init/LicenseKeyValidationTest.ts"
        ],
        "message": "TINY-10681: Added new license_key option (#9411)\n\n* TINY-10681: Added new license_key option\n\n* TINY-10681: Updated url until we have a better one\n\n* TINY-10681: Updated changelog to be more describing of the change\n\n* TINY-10681: Added check for api_key",
        "before_after_code_files": [
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/main/ts/init/LicenseKeyValidation.ts||modules/tinymce/src/core/main/ts/init/LicenseKeyValidation.ts",
          "modules/tinymce/src/core/test/ts/browser/init/LicenseKeyValidationTest.ts||modules/tinymce/src/core/test/ts/browser/init/LicenseKeyValidationTest.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts": [
          "File: modules/tinymce/src/core/main/ts/api/OptionTypes.ts -> modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "249:   visual_table_class?: string;",
          "250:   width?: number | string;",
          "251:   xss_sanitization?: boolean;",
          "254:   disable_nodechange?: boolean;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "252:   license_key?: string;",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "677:     processor: 'string'",
          "678:   });",
          "680:   registerOption('paste_block_drop', {",
          "681:     processor: 'boolean',",
          "682:     default: false",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "680:   registerOption('license_key', {",
          "681:     processor: 'string'",
          "682:   });",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "980: const shouldSandboxIframes = option('sandbox_iframes');",
          "981: const getSandboxIframesExclusions = (editor: Editor): string[] => editor.options.get('sandbox_iframes_exclusions');",
          "982: const shouldConvertUnsafeEmbeds = option('convert_unsafe_embeds');",
          "984: export {",
          "985:   register,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "987: const getLicenseKey = option('license_key');",
          "988: const getApiKey = option('api_key');",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1087:   shouldUseDocumentWrite,",
          "1088:   shouldForceHexColor,",
          "1089:   shouldSandboxIframes,",
          "1090:   getSandboxIframesExclusions,",
          "1092: };",
          "",
          "[Removed Lines]",
          "1091:   shouldConvertUnsafeEmbeds",
          "",
          "[Added Lines]",
          "1096:   getLicenseKey,",
          "1098:   shouldConvertUnsafeEmbeds,",
          "1099:   getApiKey",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts": [
          "File: modules/tinymce/src/core/main/ts/init/InitContentBody.ts -> modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "37: import * as TextPattern from '../textpatterns/TextPatterns';",
          "38: import Quirks from '../util/Quirks';",
          "39: import * as ContentCss from './ContentCss';",
          "41: declare const escape: any;",
          "42: declare let tinymce: TinyMCE;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40: import * as LicenseKeyValidation from './LicenseKeyValidation';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "479:   preInit(editor);",
          "481:   setupRtcThunk.fold(() => {",
          "482:     const cancelProgress = startProgress(editor);",
          "483:     loadContentCss(editor).then(() => {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "482:   LicenseKeyValidation.validateEditorLicenseKey(editor);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/init/LicenseKeyValidation.ts||modules/tinymce/src/core/main/ts/init/LicenseKeyValidation.ts": [
          "File: modules/tinymce/src/core/main/ts/init/LicenseKeyValidation.ts -> modules/tinymce/src/core/main/ts/init/LicenseKeyValidation.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { Type } from '@ephox/katamari';",
          "3: import Editor from '../api/Editor';",
          "4: import * as Options from '../api/Options';",
          "6: type KeyStatus = 'VALID' | 'INVALID';",
          "8: const isGplKey = (key: string) => key.toLowerCase() === 'gpl';",
          "10: const isValidGeneratedKey = (key: string): boolean => key.length >= 40 && key.length <= 255;",
          "12: export const validateLicenseKey = (key: string): KeyStatus => isGplKey(key) || isValidGeneratedKey(key) ? 'VALID' : 'INVALID';",
          "14: export const validateEditorLicenseKey = (editor: Editor): void => {",
          "15:   const licenseKey = Options.getLicenseKey(editor);",
          "16:   const hasApiKey = Type.isString(Options.getApiKey(editor));",
          "17:   if (!hasApiKey && (Type.isUndefined(licenseKey) || validateLicenseKey(licenseKey) === 'INVALID')) {",
          "19:     console.warn('You are running TinyMCE in evaluation mode. Provide a valid license key or specify the license to \\'GPL\\' to agree to the open source license terms. https://www.tiny.cloud/');",
          "20:   }",
          "21: };",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/init/LicenseKeyValidationTest.ts||modules/tinymce/src/core/test/ts/browser/init/LicenseKeyValidationTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/init/LicenseKeyValidationTest.ts -> modules/tinymce/src/core/test/ts/browser/init/LicenseKeyValidationTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2: import { after, afterEach, before, context, describe, it } from '@ephox/bedrock-client';",
          "3: import { Arr, Fun, Global } from '@ephox/katamari';",
          "4: import { TinyHooks } from '@ephox/mcagar';",
          "5: import { assert } from 'chai';",
          "7: import Editor from 'tinymce/core/api/Editor';",
          "8: import * as LicenseKeyValidation from 'tinymce/core/init/LicenseKeyValidation';",
          "10: describe('browser.tinymce.core.init.LicenseKeyValidationTest', () => {",
          "11:   let oldWarn: typeof console.warn;",
          "12:   let messages: string[] = [];",
          "13:   const expectedLogMessage = 'You are running TinyMCE in evaluation mode. Provide a valid license key or specify the license to \\'GPL\\' to agree to the open source license terms. https://www.tiny.cloud/';",
          "14:   const invalidGeneratedKeyToShort = 'foo';",
          "15:   const invalidGeneratedKeyToLong = Arr.range(512, Fun.constant('x')).join('');",
          "16:   const validGeneratedKey = Arr.range(52, Fun.constant('x')).join('');",
          "18:   const beforeHandler = () => {",
          "19:     messages = [];",
          "20:     oldWarn = Global.console.warn;",
          "21:     Global.console.warn = (...args: any[]) => {",
          "22:       messages.push(Arr.map(args, (arg) => String(arg)).join(' '));",
          "23:     };",
          "24:   };",
          "26:   const afterHandler = () => {",
          "27:     Global.console.warn = oldWarn;",
          "28:   };",
          "30:   context('LicenseKeyValidator API', () => {",
          "31:     before(beforeHandler);",
          "32:     after(afterHandler);",
          "34:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "35:       base_url: '/project/tinymce/js/tinymce'",
          "36:     });",
          "38:     afterEach(() => {",
          "39:       hook.editor().options.unset('license_key');",
          "40:     });",
          "42:     it('validateLicenseKey GPL', () => {",
          "43:       assert.equal(LicenseKeyValidation.validateLicenseKey('GPL'), 'VALID');",
          "44:       assert.equal(LicenseKeyValidation.validateLicenseKey('gPl'), 'VALID');",
          "45:       assert.equal(LicenseKeyValidation.validateLicenseKey('gpl'), 'VALID');",
          "46:     });",
          "48:     it('validateLicenseKey generated', () => {",
          "49:       assert.equal(LicenseKeyValidation.validateLicenseKey(invalidGeneratedKeyToShort), 'INVALID', 'To short');",
          "50:       assert.equal(LicenseKeyValidation.validateLicenseKey(invalidGeneratedKeyToLong), 'INVALID', 'To to long');",
          "51:       assert.equal(LicenseKeyValidation.validateLicenseKey(validGeneratedKey), 'VALID', 'Is valid');",
          "52:     });",
          "54:     it('validateEditorLicenseKey no license key set', () => {",
          "55:       messages = [];",
          "56:       LicenseKeyValidation.validateEditorLicenseKey(hook.editor());",
          "57:       assert.deepEqual(messages, [ expectedLogMessage ], 'Should produce a message since license_key is missing');",
          "58:     });",
          "60:     it('validateEditorLicenseKey GPL license key set', () => {",
          "61:       const editor = hook.editor();",
          "63:       messages = [];",
          "64:       editor.options.set('license_key', 'gpl');",
          "65:       LicenseKeyValidation.validateEditorLicenseKey(hook.editor());",
          "66:       assert.deepEqual(messages, [ ], 'Should not produce a message since GPL is valid');",
          "67:     });",
          "69:     it('validateEditorLicenseKey generated valid license key set', () => {",
          "70:       const editor = hook.editor();",
          "72:       messages = [];",
          "73:       editor.options.set('license_key', validGeneratedKey);",
          "74:       LicenseKeyValidation.validateEditorLicenseKey(hook.editor());",
          "75:       assert.deepEqual(messages, [ ], 'Should not produce a message since generated key is valid');",
          "76:     });",
          "78:     it('validateEditorLicenseKey api_key set but no license_key', () => {",
          "79:       const editor = hook.editor();",
          "81:       messages = [];",
          "82:       editor.options.set('api_key', 'some-api-key');",
          "83:       LicenseKeyValidation.validateEditorLicenseKey(hook.editor());",
          "84:       assert.deepEqual(messages, [ ], 'Should not produce a message since an api_key was provided');",
          "85:       editor.options.unset('api_key');",
          "86:     });",
          "87:   });",
          "89:   context('No license key specified', () => {",
          "90:     before(beforeHandler);",
          "91:     after(afterHandler);",
          "93:     TinyHooks.bddSetupLight<Editor>({",
          "94:       base_url: '/project/tinymce/js/tinymce'",
          "95:     });",
          "97:     it('Should have warned while initializing the editor', () => {",
          "98:       assert.deepEqual(messages, [ expectedLogMessage ]);",
          "99:     });",
          "100:   });",
          "102:   context('GPL license key specified', () => {",
          "103:     before(beforeHandler);",
          "104:     after(afterHandler);",
          "106:     TinyHooks.bddSetupLight<Editor>({",
          "107:       base_url: '/project/tinymce/js/tinymce',",
          "108:       license_key: 'gpl'",
          "109:     });",
          "111:     it('Should not have any warning messages since gpl was provided', () => {",
          "112:       assert.deepEqual(messages, []);",
          "113:     });",
          "114:   });",
          "116:   context('Invalid license key specified', () => {",
          "117:     before(beforeHandler);",
          "118:     after(afterHandler);",
          "120:     TinyHooks.bddSetupLight<Editor>({",
          "121:       base_url: '/project/tinymce/js/tinymce',",
          "122:       license_key: 'foo'",
          "123:     }, []);",
          "125:     it('Should have warned while initializing the editor since the key is to short', () => {",
          "126:       assert.deepEqual(messages, [ expectedLogMessage ]);",
          "127:     });",
          "128:   });",
          "130:   context('api_key specified', () => {",
          "131:     before(beforeHandler);",
          "132:     after(afterHandler);",
          "134:     TinyHooks.bddSetupLight<Editor>({",
          "135:       base_url: '/project/tinymce/js/tinymce',",
          "136:       api_key: 'some-api-key'",
          "137:     });",
          "139:     it('Should not have any warning messages since an api_key was provided', () => {",
          "140:       assert.deepEqual(messages, []);",
          "141:     });",
          "142:   });",
          "143: });",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "e13c27a9ebc0ee63fca259c1743ceecacbb23de2",
      "candidate_info": {
        "commit_hash": "e13c27a9ebc0ee63fca259c1743ceecacbb23de2",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/e13c27a9ebc0ee63fca259c1743ceecacbb23de2",
        "files": [
          "Jenkinsfile",
          "modules/dragster/src/test/ts/browser/datatransfer/DataTransferTest.ts",
          "modules/sugar/src/test/ts/browser/SelectionRangeTest.ts",
          "modules/tinymce/src/core/test/ts/browser/FormatterRemoveTest.ts",
          "modules/tinymce/src/core/test/ts/browser/annotate/AnnotationStylingTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/dom/SelectionTest.ts",
          "modules/tinymce/src/core/test/ts/browser/dom/TrimBodyTest.ts",
          "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
          "modules/tinymce/src/core/test/ts/browser/html/SanitizationTest.ts",
          "modules/tinymce/src/core/test/ts/webdriver/keyboard/SpaceKeyTest.ts",
          "modules/tinymce/src/plugins/accordion/test/ts/webdriver/AccordionBackspaceDeleteTest.ts",
          "modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingTypingTest.ts",
          "modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingWrapTypingTest.ts"
        ],
        "message": "TINY-10639: Update Jenkins to Safari 17 and fix test failures (#9473)\n\n* TINY-10639: Safari 17 browser check\n\n* TINY-10639: Fixed a couple tests\n\n* TINY-10639: Update more tests\n\n* TINY-10639: Replace Sand API\n\n* TINY-10639: Update safari version in jenkins file and remove safari < 17 checks\n\n* TINY-10639: Undo test changes\n\n* TINY-10639: Fix failing webdriver tests\n\n* TINY-10639: Fix dragster test\n\n* TINY-10639: Fix safari webdriver tests\n\n* TINY-10639: Testing new content to resolve some safari failures\n\n* TINY-10639: Fix \"e\" character not working in safari webdriver tests\n\n* TINY-10639: Testing with focus\n\n* TINY-10639: Test new selector\n\n* TINY-10639: Skip failing safari nonbreaking tests\n\n* TINY-10639: Link Jira\n\n* TINY-10639: Fix dragster test in Chrome\n\n* TINY-10639: Fix Dragster test\n\n* TINY-10639: Fix Firefox failure with inline blocks\n\n* Revert \"TINY-10639: Fix Firefox failure with inline blocks\"\n\nThis reverts commit ad56f4b101883f2197b4a3bc220a43626f2623c1.\n\n* TINY-10639: Update Safari to use latest version\n\n* TINY-10639: Skip failing tests in firefox for TINY-10742\n\n* TINY-10639: Fix clearData new behaviour on chrome\n\n* TINY-10639: Skip clearData test for TINY-10743\n\n* TINY-10639: Fix skipping tests\n\n* TINY-10639: Skipping failing tests to be addressed in TINY-10737\n\n---------\n\nCo-authored-by: MitchCTiny <89239746+MitchCTiny@users.noreply.github.com>",
        "before_after_code_files": [
          "modules/dragster/src/test/ts/browser/datatransfer/DataTransferTest.ts||modules/dragster/src/test/ts/browser/datatransfer/DataTransferTest.ts",
          "modules/sugar/src/test/ts/browser/SelectionRangeTest.ts||modules/sugar/src/test/ts/browser/SelectionRangeTest.ts",
          "modules/tinymce/src/core/test/ts/browser/FormatterRemoveTest.ts||modules/tinymce/src/core/test/ts/browser/FormatterRemoveTest.ts",
          "modules/tinymce/src/core/test/ts/browser/annotate/AnnotationStylingTest.ts||modules/tinymce/src/core/test/ts/browser/annotate/AnnotationStylingTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/dom/SelectionTest.ts||modules/tinymce/src/core/test/ts/browser/dom/SelectionTest.ts",
          "modules/tinymce/src/core/test/ts/browser/dom/TrimBodyTest.ts||modules/tinymce/src/core/test/ts/browser/dom/TrimBodyTest.ts",
          "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
          "modules/tinymce/src/core/test/ts/browser/html/SanitizationTest.ts||modules/tinymce/src/core/test/ts/browser/html/SanitizationTest.ts",
          "modules/tinymce/src/core/test/ts/webdriver/keyboard/SpaceKeyTest.ts||modules/tinymce/src/core/test/ts/webdriver/keyboard/SpaceKeyTest.ts",
          "modules/tinymce/src/plugins/accordion/test/ts/webdriver/AccordionBackspaceDeleteTest.ts||modules/tinymce/src/plugins/accordion/test/ts/webdriver/AccordionBackspaceDeleteTest.ts",
          "modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingTypingTest.ts||modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingTypingTest.ts",
          "modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingWrapTypingTest.ts||modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingWrapTypingTest.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
            "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
            "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/dragster/src/test/ts/browser/datatransfer/DataTransferTest.ts||modules/dragster/src/test/ts/browser/datatransfer/DataTransferTest.ts": [
          "File: modules/dragster/src/test/ts/browser/datatransfer/DataTransferTest.ts -> modules/dragster/src/test/ts/browser/datatransfer/DataTransferTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "190:     it('TINY-9601: Files list cannot be modified', () => {",
          "191:       const transfer = createDataTransfer();",
          "192:       addAndAssertFile(transfer, testFile1, 1);",
          "200:     });",
          "202:     it('TINY-9601: Files list cannot be modified when in protected mode', () => {",
          "",
          "[Removed Lines]",
          "193:       if (isSafari) {",
          "195:         transfer.files[0] = testFile2;",
          "196:         assert.deepEqual(transfer.files.item(0), testFile1, 'Should still be file 1');",
          "197:       } else {",
          "198:         assertFilesCannotBeModified(transfer);",
          "199:       }",
          "",
          "[Added Lines]",
          "193:       assertFilesCannotBeModified(transfer);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "209:   });",
          "211:   context('clearData', () => {",
          "213:       const transfer = createDataTransfer();",
          "215:       transfer.setData('text/plain', 'Hello');",
          "",
          "[Removed Lines]",
          "212:     it('TINY-9601: clearData should clear data as expected', () => {",
          "",
          "[Added Lines]",
          "207:     it.skip('TINY-9601: clearData should clear data as expected', () => {",
          "",
          "---------------"
        ],
        "modules/sugar/src/test/ts/browser/SelectionRangeTest.ts||modules/sugar/src/test/ts/browser/SelectionRangeTest.ts": [
          "File: modules/sugar/src/test/ts/browser/SelectionRangeTest.ts -> modules/sugar/src/test/ts/browser/SelectionRangeTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "122:         finish: [ 0, 1, 0 ],",
          "123:         foffset: 'w'.length",
          "124:       },",
          "125:       fallback: {",
          "126:         start: [ 0, 1, 0 ],",
          "127:         soffset: 'world'.length,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "125:       safari: {",
          "126:         start: [ 0 ],",
          "127:         soffset: 2,",
          "128:         finish: [ 0, 1, 0 ],",
          "129:         foffset: 'w'.length",
          "130:       },",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "142:         soffset: 0,",
          "143:         finish: [ 0 ],",
          "144:         foffset: 7",
          "151:       }",
          "152:     },",
          "153:     Situ.on(find( [ 0 ]), 0),",
          "",
          "[Removed Lines]",
          "145:       },",
          "146:       safari: {",
          "147:         start: [ 0, 0 ],",
          "148:         soffset: ''.length,",
          "149:         finish: [ 0 ],",
          "150:         foffset: 7",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "169:         soffset: 7,",
          "170:         finish: [ 0 ],",
          "171:         foffset: 0",
          "178:       }",
          "179:     },",
          "180:     Situ.on(find( [ 0 ]), 7),",
          "",
          "[Removed Lines]",
          "172:       },",
          "173:       safari: {",
          "174:         start: [ 0 ],",
          "175:         soffset: 7,",
          "176:         finish: [ 0, 0 ],",
          "177:         foffset: ''.length",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "184:   checkSelection(",
          "185:     'LTR selection (t I)',",
          "186:     {",
          "194:       fallback: {",
          "195:         start: [ 0, 3, 1 ],",
          "196:         soffset: 1,",
          "",
          "[Removed Lines]",
          "188:       safari: {",
          "189:         start: [ 0, 3, 2 ],",
          "190:         soffset: ''.length,",
          "191:         finish: [ 0 ],",
          "192:         foffset: 6",
          "193:       },",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "224:         start: [ 0 ],",
          "225:         soffset: 6",
          "226:       },",
          "227:       spartan: {",
          "228:         finish: [ 0, 3, 1 ],",
          "229:         foffset: 1,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "214:       safari: {",
          "215:         finish: [ 0, 3, 1 ],",
          "216:         foffset: 1,",
          "217:         start: [ 0 ],",
          "218:         soffset: 6",
          "219:       },",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "263:         soffset: 0,",
          "264:         finish: [ 0 ],",
          "265:         foffset: 0",
          "272:       }",
          "273:     },",
          "274:     Situ.on(find( [ 0 ]), 0 ),",
          "",
          "[Removed Lines]",
          "266:       },",
          "267:       safari: {",
          "268:         start: [ 0, 0 ],",
          "269:         soffset: 0,",
          "270:         finish: [ 0, 0 ],",
          "271:         foffset: 0",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "283:         soffset: 0,",
          "284:         finish: [ 0 ],",
          "285:         foffset: 0",
          "292:       }",
          "293:     },",
          "294:     Situ.on(find( [ 0 ]), 0 ),",
          "",
          "[Removed Lines]",
          "286:       },",
          "287:       safari: {",
          "288:         start: [ 0, 0 ],",
          "289:         soffset: 0,",
          "290:         finish: [ 0, 0 ],",
          "291:         foffset: 0",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/FormatterRemoveTest.ts||modules/tinymce/src/core/test/ts/browser/FormatterRemoveTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/FormatterRemoveTest.ts -> modules/tinymce/src/core/test/ts/browser/FormatterRemoveTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { describe, it } from '@ephox/bedrock-client';",
          "2: import { LegacyUnit, TinyApis, TinyAssertions, TinyHooks, TinySelections } from '@ephox/wrap-mcagar';",
          "3: import { assert } from 'chai';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2: import { PlatformDetection } from '@ephox/sand';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "8: import * as KeyUtils from '../module/test/KeyUtils';",
          "10: describe('browser.tinymce.core.FormatterRemoveTest', () => {",
          "11:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "12:     indent: false,",
          "13:     extended_valid_elements: 'b[style],i,span[style|contenteditable|class]',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "12:   const browser = PlatformDetection.detect().browser;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "372:     editor.setContent(initialContent);",
          "373:     LegacyUnit.setSelection(editor, 'p:nth-child(2) b', 0, 'p:last-of-type b', 3);",
          "374:     editor.formatter.remove('format');",
          "376:   });",
          "378:   it('contentEditable: true inside contentEditable: false', () => {",
          "",
          "[Removed Lines]",
          "375:     TinyAssertions.assertContent(editor, initialContent);",
          "",
          "[Added Lines]",
          "378:     if (browser.isSafari()) {",
          "381:       const expectedContent = '<p>abc</p><p>def</p><p contenteditable=\"false\"><b>ghj</b></p>';",
          "382:       TinyAssertions.assertContent(editor, expectedContent);",
          "383:     } else {",
          "384:       TinyAssertions.assertContent(editor, initialContent);",
          "385:     }",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/annotate/AnnotationStylingTest.ts||modules/tinymce/src/core/test/ts/browser/annotate/AnnotationStylingTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/annotate/AnnotationStylingTest.ts -> modules/tinymce/src/core/test/ts/browser/annotate/AnnotationStylingTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "301:     it('TINY-8698: should have blue outline for nested editable region when selected noneditable ancestor has a comment', async () => {",
          "302:       const editor = hook.editor();",
          "303:       editor.setContent(figureImageHtml);",
          "305:       editor.annotator.annotate('test-comment', {});",
          "306:       TinySelections.setCursor(editor, [ 0, 1, 0 ], 1, true);",
          "307:       await pAssertStyling(editor, 'figure.image', noBackgroundColor, selectedOutline, false);",
          "",
          "[Removed Lines]",
          "304:       TinySelections.select(editor, 'img', []);",
          "",
          "[Added Lines]",
          "304:       TinySelections.select(editor, 'figure.image', []);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts -> modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { beforeEach, context, describe, it } from '@ephox/bedrock-client';",
          "2: import { Arr, Type } from '@ephox/katamari';",
          "4: import { TinyApis, TinyAssertions, TinyHooks } from '@ephox/wrap-mcagar';",
          "5: import { assert } from 'chai';",
          "",
          "[Removed Lines]",
          "3: import { PlatformDetection } from '@ephox/sand';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "18: ];",
          "20: describe('browser.tinymce.core.content.EditorContentTest', () => {",
          "26:   const toHtml = (node: AstNode): string => HtmlSerializer({}).serialize(node);",
          "28:   const assertContentTreeEqualToHtml = (editor: Editor, html: string, msg: string) => {",
          "",
          "[Removed Lines]",
          "22:   const platform = PlatformDetection.detect();",
          "23:   const isSafari = platform.browser.isSafari();",
          "24:   const isSafariLessThan17 = isSafari && platform.browser.version.major < 17;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "578:           const editor = hook.editor();",
          "579:           editor.setContent('<p><iframe><p>test</p></iframe></p>');",
          "580:           const content = editor.getContent();",
          "586:         });",
          "588:         it('getContent text with unsanitized content should get text from unsanitized content', () => {",
          "",
          "[Removed Lines]",
          "582:           const expected = isSafariLessThan17",
          "583:             ? '<p><iframe sandbox=\"\">&lt;p&gt;test&lt;/p&gt;</iframe></p>'",
          "584:             : '<p><iframe sandbox=\"\"><p>test</p></iframe></p>';",
          "585:           assert.equal(content, expected, 'getContent should not error when there is iframes with child nodes in content');",
          "",
          "[Added Lines]",
          "575:           assert.equal(content, '<p><iframe sandbox=\"\"><p>test</p></iframe></p>', 'getContent should not error when there is iframes with child nodes in content');",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "619:       it('TINY-10305: setContent html should sanitize content that can cause mXSS via ZWNBSP trimming', () => {",
          "620:         const editor = hook.editor();",
          "621:         editor.setContent('<p>test</p><!--\\ufeff><iframe onload=alert(document.domain)>-></body>-->');",
          "627:       });",
          "629:       it('TINY-10305: setContent tree should sanitize content that can cause mXSS via ZWNBSP trimming', () => {",
          "",
          "[Removed Lines]",
          "623:         const expected = isSafariLessThan17",
          "624:           ? '<p>test</p><!----><p><iframe sandbox=\"\">-&gt;&lt;/body&gt;--&gt;&lt;/body&gt;</iframe></p>'",
          "625:           : '<p>test</p><!---->';",
          "626:         TinyAssertions.assertRawContent(editor, expected);",
          "",
          "[Added Lines]",
          "612:         TinyAssertions.assertRawContent(editor, '<p>test</p><!---->');",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts -> modules/tinymce/src/core/test/ts/browser/content/EditorGetContentRawTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "2: import { Arr } from '@ephox/katamari';",
          "4: import { TinyApis, TinyAssertions, TinyHooks } from '@ephox/wrap-mcagar';",
          "5: import { assert } from 'chai';",
          "7: import Editor from 'tinymce/core/api/Editor';",
          "9: describe('browser.tinymce.core.content.EditorGetContentRawTest', () => {",
          "14:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "15:     base_url: '/project/tinymce/js/tinymce'",
          "16:   }, []);",
          "",
          "[Removed Lines]",
          "3: import { PlatformDetection } from '@ephox/sand';",
          "11:   const platform = PlatformDetection.detect();",
          "12:   const isSafariLessThan17 = platform.browser.isSafari() && platform.browser.version.major < 17;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "51:     TinyApis(editor).setRawContent(initial);",
          "52:     assert.strictEqual(editor.getContent({ format: 'raw' }), '<p>test0</p><plaintext></plaintext>', 'Should be expected html');",
          "56:   });",
          "58:   context('Content XSS', () => {",
          "",
          "[Removed Lines]",
          "54:     TinyAssertions.assertRawContent(editor,",
          "55:       isSafariLessThan17 ? '<p>test0</p><plaintext>te\\uFEFFst1 test2&lt;p&gt;te\\uFEFFst3&lt;/p&gt;</plaintext>' : `${initial}</plaintext>`);",
          "",
          "[Added Lines]",
          "49:     TinyAssertions.assertRawContent(editor, `${initial}</plaintext>`);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts -> modules/tinymce/src/core/test/ts/browser/content/InsertContentTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "3: import { TinyAssertions, TinyHooks, TinySelections, TinyState } from '@ephox/wrap-mcagar';",
          "4: import { assert } from 'chai';",
          "",
          "[Removed Lines]",
          "2: import { PlatformDetection } from '@ephox/sand';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "9: import * as InsertContent from 'tinymce/core/content/InsertContent';",
          "11: describe('browser.tinymce.core.content.InsertContentTest', () => {",
          "16:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "17:     add_unload_trigger: false,",
          "18:     disable_nodechange: true,",
          "",
          "[Removed Lines]",
          "13:   const platform = PlatformDetection.detect();",
          "14:   const isSafariLessThan17 = platform.browser.isSafari() && platform.browser.version.major < 17;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "845:       TinySelections.setCursor(editor, [ 0 ], 0);",
          "846:       editor.insertContent('<!--\\ufeff><iframe onload=alert(document.domain)>-></body>-->');",
          "851:     });",
          "852:   });",
          "",
          "[Removed Lines]",
          "848:       TinyAssertions.assertRawContent(editor, isSafariLessThan17",
          "849:         ? '<p><!----><iframe sandbox=\"\">-&gt;&lt;/body&gt;--&gt;&lt;span id=\"mce_marker\" data-mce-type=\"bookmark\"&gt;&amp;#xFEFF;&lt;/span&gt;&lt;/body&gt;</iframe>initial</p>'",
          "850:         : '<p><!---->initial</p>');",
          "",
          "[Added Lines]",
          "843:       TinyAssertions.assertRawContent(editor, '<p><!---->initial</p>');",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/dom/SelectionTest.ts||modules/tinymce/src/core/test/ts/browser/dom/SelectionTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/dom/SelectionTest.ts -> modules/tinymce/src/core/test/ts/browser/dom/SelectionTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "2: import { LegacyUnit, TinyAssertions, TinyHooks, TinySelections } from '@ephox/wrap-mcagar';",
          "3: import { assert } from 'chai';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "2: import { PlatformDetection } from '@ephox/sand';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "10: import * as Zwsp from 'tinymce/core/text/Zwsp';",
          "12: describe('browser.tinymce.core.dom.SelectionTest', () => {",
          "13:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "14:     add_unload_trigger: false,",
          "15:     entities: 'raw',",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "14:   const platform = PlatformDetection.detect();",
          "15:   const isSafari = platform.browser.isSafari();",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1365:       soffset: 1,",
          "1366:       fpath: [ 1, 0 ],",
          "1367:       foffset: 1,",
          "1369:     }));",
          "1371:     it('TINY-9477: isEditable on selected noneditable table cells should be true since parent is editable', testIsEditableSelection({",
          "",
          "[Removed Lines]",
          "1368:       expected: false",
          "",
          "[Added Lines]",
          "1373:       expected: isSafari",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/dom/TrimBodyTest.ts||modules/tinymce/src/core/test/ts/browser/dom/TrimBodyTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/dom/TrimBodyTest.ts -> modules/tinymce/src/core/test/ts/browser/dom/TrimBodyTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "2: import { Arr } from '@ephox/katamari';",
          "4: import { assert } from 'chai';",
          "6: import * as TrimBody from 'tinymce/core/dom/TrimBody';",
          "8: describe('browser.tinymce.core.dom.TrimBodyTest', () => {",
          "11:   context('trim', () => {",
          "12:     it('trim should trim body containing trimmmable nodes', () => {",
          "13:       const tempAttrs = [ 'data-mce-selected' ];",
          "",
          "[Removed Lines]",
          "3: import { PlatformDetection } from '@ephox/sand';",
          "9:   const isSafari = PlatformDetection.detect().browser.isSafari();",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "180:         unescapedText.innerHTML = `<p>Test</p><${plaintext}>Test<p>Test</p>`;",
          "181:         TrimBody.emptyUnescapedZwspTexts(unescapedText);",
          "185:       });",
          "186:     });",
          "187:   });",
          "",
          "[Removed Lines]",
          "183:         assert.strictEqual(unescapedText.innerHTML,",
          "184:           isSafari ? `<p>Test</p><${plaintext}>Test&lt;p&gt;Test&lt;/p&gt;</${plaintext}>` : `<p>Test</p><${plaintext}>Test<p>Test</p></${plaintext}>`);",
          "",
          "[Added Lines]",
          "180:         assert.strictEqual(unescapedText.innerHTML, `<p>Test</p><${plaintext}>Test<p>Test</p></${plaintext}>`);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts -> modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "2: import { Arr, Fun, Obj } from '@ephox/katamari';",
          "4: import { assert } from 'chai';",
          "6: import Env from 'tinymce/core/api/Env';",
          "",
          "[Removed Lines]",
          "3: import { PlatformDetection } from '@ephox/sand';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "17: }",
          "19: describe('browser.tinymce.core.html.DomParserTest', () => {",
          "21:   const schema = Schema({ valid_elements: '*[class|title]' });",
          "22:   const serializer = HtmlSerializer({}, schema);",
          "",
          "[Removed Lines]",
          "20:   const browser = PlatformDetection.detect().browser;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "773:         assert.equal(",
          "774:           serializer.serialize(DomParser(scenario.settings).parse('<iframe><textarea></iframe><img src=\"a\" onerror=\"alert(document.domain)\" />')),",
          "776:         );",
          "777:       });",
          "",
          "[Removed Lines]",
          "775:           browser.isSafari() || !scenario.isSanitizeEnabled ? '<iframe><textarea></iframe><img src=\"a\">' : '<img src=\"a\">'",
          "",
          "[Added Lines]",
          "773:           scenario.isSanitizeEnabled ? '<img src=\"a\">' : '<iframe><textarea></iframe><img src=\"a\">'",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/html/SanitizationTest.ts||modules/tinymce/src/core/test/ts/browser/html/SanitizationTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/html/SanitizationTest.ts -> modules/tinymce/src/core/test/ts/browser/html/SanitizationTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "3: import { assert } from 'chai';",
          "5: import Schema from 'tinymce/core/api/html/Schema';",
          "",
          "[Removed Lines]",
          "2: import { PlatformDetection } from '@ephox/sand';",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "8: describe('browser.tinymce.core.html.SanitizationTest', () => {",
          "9:   context('Sanitize html', () => {",
          "12:     const testHtmlSanitizer = (testCase: { input: string; expected: string; mimeType: MimeType; sanitize?: boolean }) => {",
          "13:       const sanitizer = getSanitizer({ sanitize: testCase.sanitize ?? true }, Schema());",
          "",
          "[Removed Lines]",
          "10:     const isSafari = PlatformDetection.detect().browser.isSafari();",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "22:     it('Sanitize iframe HTML', () => testHtmlSanitizer({",
          "23:       input: '<iframe src=\"x\"><script>alert(1)</script></iframe><iframe src=\"javascript:alert(1)\"></iframe>',",
          "26:       mimeType: 'text/html'",
          "27:     }));",
          "29:     it('Disabled sanitization of iframe HTML', () => testHtmlSanitizer({",
          "30:       input: '<iframe src=\"x\"><script>alert(1)</script></iframe><iframe src=\"javascript:alert(1)\"></iframe>',",
          "33:       mimeType: 'text/html',",
          "34:       sanitize: false",
          "35:     }));",
          "",
          "[Removed Lines]",
          "25:       expected: isSafari ? '<iframe src=\"x\">&lt;script&gt;alert(1)&lt;/script&gt;</iframe><iframe></iframe>' : '<iframe></iframe>',",
          "32:       expected: isSafari ? '<iframe src=\"x\">&lt;script&gt;alert(1)&lt;/script&gt;</iframe><iframe></iframe>' : '<iframe src=\"x\"><script>alert(1)</script></iframe><iframe></iframe>',",
          "",
          "[Added Lines]",
          "22:       expected: '<iframe></iframe>',",
          "29:       expected: '<iframe src=\"x\"><script>alert(1)</script></iframe><iframe></iframe>',",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/webdriver/keyboard/SpaceKeyTest.ts||modules/tinymce/src/core/test/ts/webdriver/keyboard/SpaceKeyTest.ts": [
          "File: modules/tinymce/src/core/test/ts/webdriver/keyboard/SpaceKeyTest.ts -> modules/tinymce/src/core/test/ts/webdriver/keyboard/SpaceKeyTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "22:   });",
          "24:   context('Space key around inline boundary elements', () => {",
          "26:       const editor = hook.editor();",
          "27:       editor.setContent('<p>s<span style=\"display: block;\" contenteditable=\"false\">a</span></p>');",
          "28:       TinySelections.setCursor(editor, [ 0, 0 ], 1);",
          "",
          "[Removed Lines]",
          "25:     it('TINY-8588: Add one space just before a block', async () => {",
          "",
          "[Added Lines]",
          "26:     it.skip('TINY-8588: Add one space just before a block', async () => {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "30:       TinyAssertions.assertContent(editor, '<p>s&nbsp;<span style=\"display: block;\" contenteditable=\"false\">a</span></p>');",
          "31:     });",
          "34:       const editor = hook.editor();",
          "35:       editor.setContent('<p>s<span style=\"display: block;\" contenteditable=\"false\">a</span></p>');",
          "36:       TinySelections.setCursor(editor, [ 0, 0 ], 1);",
          "",
          "[Removed Lines]",
          "33:     it('TINY-8588: Add two spaces just before a block', async () => {",
          "",
          "[Added Lines]",
          "35:     it.skip('TINY-8588: Add two spaces just before a block', async () => {",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "45:       }",
          "46:     });",
          "49:       const editor = hook.editor();",
          "50:       editor.setContent('<p><span class=\"filler\">s</span><span style=\"display: block;\" contenteditable=\"false\">a</span></p>');",
          "51:       TinySelections.setCursor(editor, [ 0, 0, 0 ], 1);",
          "",
          "[Removed Lines]",
          "48:     it('TINY-8588: Add one space before a block while in a span', async () => {",
          "",
          "[Added Lines]",
          "51:     it.skip('TINY-8588: Add one space before a block while in a span', async () => {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "53:       TinyAssertions.assertContent(editor, '<p><span class=\"filler\">s&nbsp;</span><span style=\"display: block;\" contenteditable=\"false\">a</span></p>');",
          "54:     });",
          "57:       const editor = hook.editor();",
          "58:       editor.setContent('<p>s<strong><span contenteditable=\"false\" style=\"display: block;\">a</span></strong></p>');",
          "59:       TinySelections.setCursor(editor, [ 0, 0 ], 1);",
          "",
          "[Removed Lines]",
          "56:     it('TINY-8588: Add one space before a block inside a strong', async () => {",
          "",
          "[Added Lines]",
          "60:     it.skip('TINY-8588: Add one space before a block inside a strong', async () => {",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/accordion/test/ts/webdriver/AccordionBackspaceDeleteTest.ts||modules/tinymce/src/plugins/accordion/test/ts/webdriver/AccordionBackspaceDeleteTest.ts": [
          "File: modules/tinymce/src/plugins/accordion/test/ts/webdriver/AccordionBackspaceDeleteTest.ts -> modules/tinymce/src/plugins/accordion/test/ts/webdriver/AccordionBackspaceDeleteTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "31:   const hook = TinyHooks.bddSetup<Editor>(settings, [ AccordionPlugin ], true);",
          "33:   const platform = PlatformDetection.detect();",
          "36:   const isFirefox = platform.browser.isFirefox();",
          "40:   const pDoBackspaceDelete = async (key: DeletionKey, modifier?: BackspaceDeleteModifier): Promise<void> => {",
          "41:     await RealKeys.pSendKeysOn('iframe => body', [ Type.isUndefined(modifier) ? RealKeys.text(key) : RealKeys.combo(modifier, key) ]);",
          "",
          "[Removed Lines]",
          "34:   const os = platform.os;",
          "35:   const isSafari = platform.browser.isSafari();",
          "37:   const isMacOS = os.isMacOS();",
          "38:   const isWindows = os.isWindows();",
          "",
          "[Added Lines]",
          "35:   const isSafari = platform.browser.isSafari();",
          "36:   const isMacOS = platform.os.isMacOS();",
          "37:   const isWindows = platform.os.isWindows();",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "246:         TinySelections.setCursor(editor, [ 0, 1, 0 ], 0);",
          "247:         await pDoDelete();",
          "248:         assertAccordionContent(editor, { summary: 'summary', body: '<p>ody</p>' });",
          "251:       });",
          "253:       it('TINY-9951: Deleting content in body by pressing DELETE should work as expected if caret in middle of body content', async () => {",
          "",
          "[Removed Lines]",
          "250:         TinyAssertions.assertCursor(editor, isFirefox || isSafari ? [ 0, 1, 0 ] : [ 0, 1, 0, 0 ], 0);",
          "",
          "[Added Lines]",
          "249:         TinyAssertions.assertCursor(editor, isFirefox ? [ 0, 1, 0 ] : [ 0, 1, 0, 0 ], 0);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "410:         }",
          "411:         assertAccordionContent(editor, getSummarySpec(expectedContent));",
          "417:         if (isSafari) {",
          "420:         } else {",
          "424:         }",
          "426:       };",
          "428:       const testCtrlDeletionInSummary = (deletionKey: DeletionKey) => testCtrlDeletion(deletionKey, 'summary');",
          "",
          "[Removed Lines]",
          "415:         let expectedPath: number[];",
          "416:         let expectedOffset: number;",
          "418:           expectedPath = isSummary ? [ 0, 0, 0 ] : [ 0, 1, 0, 0 ];",
          "419:           expectedOffset = isBackspace ? 'word1 '.length : 'wo'.length;",
          "421:           expectedPath = isSummary ? [ 0, 0, 1, 0 ] : [ 0, 1, 0, 1, 0 ];",
          "423:           expectedOffset = 0;",
          "425:         TinyAssertions.assertCursor(editor, expectedPath, expectedOffset);",
          "",
          "[Added Lines]",
          "414:           const expectedPath = isSummary ? [ 0, 0, 0 ] : [ 0, 1, 0, 0 ];",
          "415:           const expectedOffset = isBackspace ? 6 : 2;",
          "417:           TinyAssertions.assertCursor(editor, expectedPath, expectedOffset);",
          "420:           const expectedPath = isSummary ? [ 0, 0, 1, 0 ] : [ 0, 1, 0, 1, 0 ];",
          "421:           const expectedOffset = 0;",
          "423:           TinyAssertions.assertCursor(editor, expectedPath, expectedOffset);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingTypingTest.ts||modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingTypingTest.ts": [
          "File: modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingTypingTest.ts -> modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingTypingTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "25:     editor.setContent('');",
          "26:   });",
          "29:     const editor = hook.editor();",
          "30:     clickNbspToolbarButton(editor);",
          "32:     TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str) => {",
          "33:       return s.element('body', {",
          "34:         children: [",
          "",
          "[Removed Lines]",
          "28:   it('TBA: Click on the nbsp button then type some text, and assert content is correct', async () => {",
          "31:     await RealKeys.pSendKeysOn('iframe => body => p', [ RealKeys.text('test') ]);",
          "",
          "[Added Lines]",
          "29:   it.skip('TBA: Click on the nbsp button then type some text, and assert content is correct', async () => {",
          "32:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text('test') ]);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "60:     }));",
          "61:   });",
          "64:     const editor = hook.editor();",
          "65:     editor.setContent('test');",
          "66:     TinySelections.setCursor(editor, [ 0, 0 ], 4);",
          "67:     clickNbspToolbarButton(editor);",
          "69:     TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str) => {",
          "70:       return s.element('body', {",
          "71:         children: [",
          "",
          "[Removed Lines]",
          "63:   it('TBA: Add content to editor, click on the nbsp button then type some text, and assert content is correct', async () => {",
          "68:     await RealKeys.pSendKeysOn('iframe => body => p', [ RealKeys.text('test') ]);",
          "",
          "[Added Lines]",
          "65:   it.skip('TBA: Add content to editor, click on the nbsp button then type some text, and assert content is correct', async () => {",
          "70:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text('test') ]);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "82:   it('TBA: Click on the nbsp button then type a space, and assert content is correct', async () => {",
          "83:     const editor = hook.editor();",
          "84:     clickNbspToolbarButton(editor);",
          "86:     TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str) => {",
          "87:       return s.element('body', {",
          "88:         children: [",
          "",
          "[Removed Lines]",
          "85:     await RealKeys.pSendKeysOn('iframe => body => p', [ RealKeys.text(' ') ]);",
          "",
          "[Added Lines]",
          "87:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text(' ') ]);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "96:     }));",
          "97:   });",
          "100:     const editor = hook.editor();",
          "101:     editor.setContent('test');",
          "102:     TinySelections.setCursor(editor, [ 0, 0 ], 4);",
          "103:     clickNbspToolbarButton(editor);",
          "105:     TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str) => {",
          "106:       return s.element('body', {",
          "107:         children: [",
          "",
          "[Removed Lines]",
          "99:   it('TBA: Add text to editor, click on the nbsp button and add content plus a space, and assert content is correct', async () => {",
          "104:     await RealKeys.pSendKeysOn('iframe => body => p', [ RealKeys.text('test ') ]);",
          "",
          "[Added Lines]",
          "102:   it.skip('TBA: Add text to editor, click on the nbsp button and add content plus a space, and assert content is correct', async () => {",
          "107:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text('test ') ]);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingWrapTypingTest.ts||modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingWrapTypingTest.ts": [
          "File: modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingWrapTypingTest.ts -> modules/tinymce/src/plugins/nonbreaking/test/ts/webdriver/NonbreakingWrapTypingTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "25:     editor.setContent('');",
          "26:   });",
          "29:     const editor = hook.editor();",
          "30:     clickNbspToolbarButton(editor);",
          "32:     TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str, arr) => s.element('body', {",
          "33:       children: [",
          "34:         s.element('p', {",
          "",
          "[Removed Lines]",
          "28:   it('TINY-3647: Click on the nbsp button then type some text, and assert content is correct', async () => {",
          "31:     await RealKeys.pSendKeysOn('iframe => body => p', [ RealKeys.text('test') ]);",
          "",
          "[Added Lines]",
          "29:   it.skip('TINY-3647: Click on the nbsp button then type some text, and assert content is correct', async () => {",
          "32:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text('test') ]);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "69:     })));",
          "70:   });",
          "73:     const editor = hook.editor();",
          "74:     editor.setContent('test');",
          "75:     TinySelections.setCursor(editor, [ 0, 0 ], 4);",
          "76:     clickNbspToolbarButton(editor);",
          "78:     TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str, arr) => s.element('body', {",
          "79:       children: [",
          "80:         s.element('p', {",
          "",
          "[Removed Lines]",
          "72:   it('TINY-3647: Add content to editor, click on the nbsp button then type some text, and assert content is correct', async () => {",
          "77:     await RealKeys.pSendKeysOn('iframe => body => p', [ RealKeys.text('test') ]);",
          "",
          "[Added Lines]",
          "74:   it.skip('TINY-3647: Add content to editor, click on the nbsp button then type some text, and assert content is correct', async () => {",
          "79:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text('test') ]);",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "96:   it('TINY-3647: Click on the nbsp button then type a space, and assert content is correct', async () => {",
          "97:     const editor = hook.editor();",
          "98:     clickNbspToolbarButton(editor);",
          "100:     TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str, arr) => s.element('body', {",
          "101:       children: [",
          "102:         s.element('p', {",
          "",
          "[Removed Lines]",
          "99:     await RealKeys.pSendKeysOn('iframe => body => p', [ RealKeys.text(' ') ]);",
          "",
          "[Added Lines]",
          "101:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text(' ') ]);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "114:     })));",
          "115:   });",
          "118:     const editor = hook.editor();",
          "119:     editor.setContent('test');",
          "120:     TinySelections.setCursor(editor, [ 0, 0 ], 4);",
          "",
          "[Removed Lines]",
          "117:   it('TINY-3647: Add text to editor, click on the nbsp button and add content plus a space, and assert content is correct', async () => {",
          "",
          "[Added Lines]",
          "120:   it.skip('TINY-3647: Add text to editor, click on the nbsp button and add content plus a space, and assert content is correct', async () => {",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "136:       ]",
          "137:     })));",
          "140:     TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str, arr) => s.element('body', {",
          "141:       children: [",
          "142:         s.element('p', {",
          "",
          "[Removed Lines]",
          "139:     await RealKeys.pSendKeysOn('iframe => body => p', [ RealKeys.text('test ') ]);",
          "",
          "[Added Lines]",
          "142:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text('test ') ]);",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "155:     })));",
          "156:   });",
          "159:     const editor = hook.editor();",
          "160:     editor.setContent('test');",
          "161:     TinySelections.setCursor(editor, [ 0, 0 ], 4);",
          "",
          "[Removed Lines]",
          "158:   it('TINY-3647: Add text to editor, click on the nbsp button and add content plus a space, repeat, and assert content is correct', async () => {",
          "",
          "[Added Lines]",
          "162:   it.skip('TINY-3647: Add text to editor, click on the nbsp button and add content plus a space, repeat, and assert content is correct', async () => {",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "177:       ]",
          "178:     })));",
          "181:     TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str, arr) => s.element('body', {",
          "182:       children: [",
          "183:         s.element('p', {",
          "",
          "[Removed Lines]",
          "180:     await RealKeys.pSendKeysOn('iframe => body => p', [ RealKeys.text('test ') ]);",
          "",
          "[Added Lines]",
          "184:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text('test ') ]);",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "195:       ]",
          "196:     })));",
          "199:     TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str, arr) => s.element('body', {",
          "200:       children: [",
          "201:         s.element('p', {",
          "",
          "[Removed Lines]",
          "198:     await RealKeys.pSendKeysOn('iframe => body => p', [ RealKeys.text('test ') ]);",
          "",
          "[Added Lines]",
          "202:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text('test ') ]);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "a80749ca9f8ac77f8b3a0358e07b31b6b8d4a7f9",
      "candidate_info": {
        "commit_hash": "a80749ca9f8ac77f8b3a0358e07b31b6b8d4a7f9",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/a80749ca9f8ac77f8b3a0358e07b31b6b8d4a7f9",
        "files": [
          ".changes/unreleased/tinymce-TINY-10374-2024-05-09.yaml",
          "modules/tinymce/src/core/main/ts/schema/SchemaLookupTable.ts",
          "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts"
        ],
        "message": "TINY-10374: add referrerpolicy atribute to the iframe (#9635)\n\n* TINY-10374: add referrerpolicy atribute to the iframe\n\n* TINY-10374: changelog\n\n* Update .changes/unreleased/tinymce-TINY-10374-2024-05-09.yaml\n\nCo-authored-by: spocke <spocke@moxiecode.com>\n\n---------\n\nCo-authored-by: spocke <spocke@moxiecode.com>",
        "before_after_code_files": [
          "modules/tinymce/src/core/main/ts/schema/SchemaLookupTable.ts||modules/tinymce/src/core/main/ts/schema/SchemaLookupTable.ts",
          "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts||modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts||modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts"
          ],
          "candidate": [
            "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts||modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/tinymce/src/core/main/ts/schema/SchemaLookupTable.ts||modules/tinymce/src/core/main/ts/schema/SchemaLookupTable.ts": [
          "File: modules/tinymce/src/core/main/ts/schema/SchemaLookupTable.ts -> modules/tinymce/src/core/main/ts/schema/SchemaLookupTable.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "193:     addAttrs('a', 'download');",
          "194:     addAttrs('link script img', 'crossorigin');",
          "195:     addAttrs('img', 'loading');",
          "197:   }",
          "",
          "[Removed Lines]",
          "196:     addAttrs('iframe', 'sandbox seamless allow allowfullscreen loading'); // Excluded: srcdoc",
          "",
          "[Added Lines]",
          "196:     addAttrs('iframe', 'sandbox seamless allow allowfullscreen loading referrerpolicy'); // Excluded: srcdoc",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts||modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts": [
          "File: modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts -> modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "92:     previewNode.attr({",
          "93:       allowfullscreen: node.attr('allowfullscreen'),",
          "94:       frameborder: '0',",
          "96:     });",
          "97:   } else {",
          "",
          "[Removed Lines]",
          "95:       sandbox: node.attr('sandbox')",
          "",
          "[Added Lines]",
          "95:       sandbox: node.attr('sandbox'),",
          "96:       referrerpolicy: node.attr('referrerpolicy')",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "149c58012905080fc6c57b556efbbb8451c1c575",
      "candidate_info": {
        "commit_hash": "149c58012905080fc6c57b556efbbb8451c1c575",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/149c58012905080fc6c57b556efbbb8451c1c575",
        "files": [
          "modules/tinymce/src/core/main/ts/api/Options.ts"
        ],
        "message": "TINY-10535: Improve list of iframe sandboxing exclusions (#9447)\n\nCo-authored-by: MitchCTiny <89239746+MitchCTiny@users.noreply.github.com>",
        "before_after_code_files": [
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "853:       'youtube.com',",
          "854:       'youtu.be',",
          "855:       'vimeo.com',",
          "856:       'dailymotion.com',",
          "857:       'dai.ly',",
          "859:     ]",
          "860:   });",
          "",
          "[Removed Lines]",
          "858:       'codepen.io'",
          "",
          "[Added Lines]",
          "856:       'player.vimeo.com',",
          "858:       'embed.music.apple.com',",
          "859:       'open.spotify.com',",
          "860:       'giphy.com',",
          "862:       'codepen.io',",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "19551b47c60a26ec27dd919eeb2c268192555b83",
      "candidate_info": {
        "commit_hash": "19551b47c60a26ec27dd919eeb2c268192555b83",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/19551b47c60a26ec27dd919eeb2c268192555b83",
        "files": [
          "modules/oxide/src/less/skins/ui/dark/skin.less",
          "modules/oxide/src/less/theme/components/edit-area/edit-area.less",
          "modules/oxide/src/less/theme/components/editor/editor.less",
          "modules/tinymce/CHANGELOG.md",
          "modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/focus/FocusController.ts",
          "modules/tinymce/src/core/test/ts/browser/focus/HighlightOnFocusTest.ts",
          "modules/tinymce/src/core/test/ts/webdriver/keyboard/IframeTabfocusTest.ts"
        ],
        "message": "TINY-9277: Highlight the content area if the editor is focused (#8371)\n\nCo-authored-by: spocke <spocke@moxiecode.com>",
        "before_after_code_files": [
          "modules/oxide/src/less/skins/ui/dark/skin.less||modules/oxide/src/less/skins/ui/dark/skin.less",
          "modules/oxide/src/less/theme/components/edit-area/edit-area.less||modules/oxide/src/less/theme/components/edit-area/edit-area.less",
          "modules/oxide/src/less/theme/components/editor/editor.less||modules/oxide/src/less/theme/components/editor/editor.less",
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/focus/FocusController.ts||modules/tinymce/src/core/main/ts/focus/FocusController.ts",
          "modules/tinymce/src/core/test/ts/browser/focus/HighlightOnFocusTest.ts||modules/tinymce/src/core/test/ts/browser/focus/HighlightOnFocusTest.ts",
          "modules/tinymce/src/core/test/ts/webdriver/keyboard/IframeTabfocusTest.ts||modules/tinymce/src/core/test/ts/webdriver/keyboard/IframeTabfocusTest.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/oxide/src/less/skins/ui/dark/skin.less||modules/oxide/src/less/skins/ui/dark/skin.less": [
          "File: modules/oxide/src/less/skins/ui/dark/skin.less -> modules/oxide/src/less/skins/ui/dark/skin.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "21: .tox.tox-tinymce-aux .tox-toolbar__overflow {",
          "22:   box-shadow: 0 0 0 1px @tinymce-separator-color;",
          "23: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: @edit-area-border-color: #FFFFFF;",
          "",
          "---------------"
        ],
        "modules/oxide/src/less/theme/components/edit-area/edit-area.less||modules/oxide/src/less/theme/components/edit-area/edit-area.less": [
          "File: modules/oxide/src/less/theme/components/edit-area/edit-area.less -> modules/oxide/src/less/theme/components/edit-area/edit-area.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: @edit-area-iframe-background-color: @color-white;",
          "6: @edit-area-border: 0;",
          "8: .tox {",
          "9:   .tox-edit-area {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "7: @edit-area-border-color: #2D6ADF;",
          "8: @edit-area-border-width: 2px;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "11:     flex: 1;",
          "12:     overflow: hidden;",
          "13:     position: relative; // Required for the iframe to resize in IE and Edge",
          "14:   }",
          "16:   .tox-edit-area__iframe {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "16:     &::before {",
          "17:       border: @edit-area-border-width solid @edit-area-border-color;",
          "18:       border-radius: 4px;",
          "19:       content: '';",
          "20:       inset: 0;",
          "21:       opacity: 0;",
          "22:       pointer-events: none;",
          "23:       position: absolute;",
          "24:       transition: opacity .15s;",
          "25:       z-index: 1;",
          "26:     }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "23:     width: 100%;",
          "24:   }",
          "25: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "40: .tox.tox-edit-focus .tox-edit-area::before {",
          "41:   opacity: 1;",
          "42: }",
          "",
          "---------------"
        ],
        "modules/oxide/src/less/theme/components/editor/editor.less||modules/oxide/src/less/theme/components/editor/editor.less": [
          "File: modules/oxide/src/less/theme/components/editor/editor.less -> modules/oxide/src/less/theme/components/editor/editor.less",
          "--- Hunk 1 ---",
          "[Context before]",
          "24:   .tox-editor-header {",
          "25:     display: grid;",
          "26:     grid-template-columns: 1fr min-content;",
          "28:   }",
          "30:   &:not(.tox-tinymce-inline) .tox-editor-header {",
          "",
          "[Removed Lines]",
          "27:     z-index: 1;",
          "",
          "[Added Lines]",
          "28:     z-index: 2;",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "780:     default: true",
          "781:   });",
          "784:   editor.on('ScriptsLoaded', () => {",
          "785:     registerOption('directionality', {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "783:   registerOption('highlight_on_focus', {",
          "784:     processor: 'boolean',",
          "785:     default: false",
          "786:   });",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "883: const getEditableClass = option('editable_class');",
          "884: const getNonEditableRegExps = option('noneditable_regexp');",
          "885: const shouldPreserveCData = option('preserve_cdata');",
          "887: const hasTextPatternsLookup = (editor: Editor): boolean =>",
          "888:   editor.options.isSet('text_patterns_lookup');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "891: const shouldHighlightOnFocus = option('highlight_on_focus');",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "997:   getNonEditableRegExps,",
          "998:   getEditableClass,",
          "999:   hasTableTabNavigation,",
          "1001: };",
          "",
          "[Removed Lines]",
          "1000:   shouldPreserveCData",
          "",
          "[Added Lines]",
          "1006:   shouldPreserveCData,",
          "1007:   shouldHighlightOnFocus",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/focus/FocusController.ts||modules/tinymce/src/core/main/ts/focus/FocusController.ts": [
          "File: modules/tinymce/src/core/main/ts/focus/FocusController.ts -> modules/tinymce/src/core/main/ts/focus/FocusController.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { Fun } from '@ephox/katamari';",
          "4: import DOMUtils from '../api/dom/DOMUtils';",
          "5: import Editor from '../api/Editor';",
          "",
          "[Removed Lines]",
          "2: import { Focus, SugarElement, SugarShadowDom } from '@ephox/sugar';",
          "",
          "[Added Lines]",
          "2: import { Class, Focus, SugarElement, SugarShadowDom } from '@ephox/sugar';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "60:   SelectionRestore.register(editor);",
          "62:   editor.on('focusin', () => {",
          "63:     const focusedEditor = editorManager.focusedEditor;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "62:   const toggleContainerFocus = (editor: Editor) => {",
          "64:     if (Options.shouldHighlightOnFocus(editor) && editor.inline !== true) {",
          "65:       const contentArea = SugarElement.fromDom(editor.getContainer());",
          "66:       Class.toggle(contentArea, 'tox-edit-focus');",
          "67:     }",
          "68:   };",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "70:       editorManager.setActive(editor);",
          "71:       editorManager.focusedEditor = editor;",
          "72:       editor.dispatch('focus', { blurredEditor: focusedEditor });",
          "73:       editor.focus(true);",
          "74:     }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "80:       toggleContainerFocus(editor);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "82:       if (!isUIElement(editor, getActiveElement(editor)) && focusedEditor === editor) {",
          "83:         editor.dispatch('blur', { focusedEditor: null });",
          "84:         editorManager.focusedEditor = null;",
          "85:       }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "92:         toggleContainerFocus(focusedEditor);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/focus/HighlightOnFocusTest.ts||modules/tinymce/src/core/test/ts/browser/focus/HighlightOnFocusTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/focus/HighlightOnFocusTest.ts -> modules/tinymce/src/core/test/ts/browser/focus/HighlightOnFocusTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "2: import { Class } from '@ephox/sugar';",
          "3: import { TinyDom, TinyHooks } from '@ephox/wrap-mcagar';",
          "4: import { assert } from 'chai';",
          "6: import Editor from 'tinymce/core/api/Editor';",
          "8: describe('browser.tinymce.core.focus.HighlightOnFocus', () => {",
          "9:   const assertIsHighlighted = (editor: Editor) => assert.isTrue(Class.has(TinyDom.container(editor), 'tox-edit-focus'), 'Editor container should have tox-edit-focus class');",
          "10:   const assertIsNotHighlighted = (editor: Editor) => assert.isFalse(Class.has(TinyDom.container(editor), 'tox-edit-focus'), 'Editor container should not have tox-edit-focus class');",
          "12:   context('with highlight_on_focus: true', () => {",
          "13:     const hook = TinyHooks.bddSetup<Editor>({",
          "14:       base_url: '/project/tinymce/js/tinymce',",
          "15:       highlight_on_focus: true",
          "16:     });",
          "18:     it('TINY-9277: Content area should be highlighted on focus', () => {",
          "19:       const editor = hook.editor();",
          "20:       assertIsNotHighlighted(editor);",
          "21:       editor.focus();",
          "22:       assertIsHighlighted(editor);",
          "23:     });",
          "24:   });",
          "26:   context('without highlight_on_focus option', () => {",
          "27:     const hook = TinyHooks.bddSetup<Editor>({",
          "28:       base_url: '/project/tinymce/js/tinymce'",
          "29:     });",
          "31:     it('TINY-9277: Content area should not be highlighted on focus', () => {",
          "32:       const editor = hook.editor();",
          "33:       assertIsNotHighlighted(editor);",
          "34:       editor.focus();",
          "35:       assertIsNotHighlighted(editor);",
          "36:     });",
          "37:   });",
          "39: });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/webdriver/keyboard/IframeTabfocusTest.ts||modules/tinymce/src/core/test/ts/webdriver/keyboard/IframeTabfocusTest.ts": [
          "File: modules/tinymce/src/core/test/ts/webdriver/keyboard/IframeTabfocusTest.ts -> modules/tinymce/src/core/test/ts/webdriver/keyboard/IframeTabfocusTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: import Editor from 'tinymce/core/api/Editor';",
          "8: describe('webdriver.tinymce.core.keyboard.IframeTabfocusTest', () => {",
          "30:   });",
          "36:   });",
          "37: });",
          "",
          "[Removed Lines]",
          "1: import { FocusTools, RealKeys } from '@ephox/agar';",
          "2: import { after, before, describe, it } from '@ephox/bedrock-client';",
          "3: import { SugarDocument } from '@ephox/sugar';",
          "4: import { TinyHooks } from '@ephox/wrap-mcagar';",
          "9:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "10:     base_url: '/project/tinymce/js/tinymce',",
          "11:     iframe_attrs: { // using this instead of tabindex on the target to check custom attrs don't get clobbered",
          "12:       tabindex: '1'",
          "13:     }",
          "14:   }, [ ], true);",
          "16:   before(() => {",
          "17:     const editor = hook.editor();",
          "18:     const container = editor.getContainer();",
          "19:     const inputElem = document.createElement('input');",
          "20:     inputElem.id = 'inputElem';",
          "21:     inputElem.tabIndex = 2;",
          "22:     container.parentNode?.insertBefore(inputElem, container);",
          "23:   });",
          "25:   after(() => {",
          "26:     const inputElem = document.getElementById('inputElem');",
          "27:     if (inputElem) {",
          "28:       inputElem.parentNode?.removeChild(inputElem);",
          "29:     }",
          "32:   it('TINY-8315: Add an input field outside the editor, focus on the editor, press the tab key and assert focus shifts to the input field', async () => {",
          "33:     FocusTools.isOnSelector('iframe is focused', SugarDocument.getDocument(), 'iframe');",
          "34:     await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text('\\t') ]);",
          "35:     await FocusTools.pTryOnSelector('Wait for focus to be on input', SugarDocument.getDocument(), '#inputElem');",
          "",
          "[Added Lines]",
          "1: import { FocusTools, RealKeys, RealMouse } from '@ephox/agar';",
          "2: import { after, afterEach, before, context, describe, it } from '@ephox/bedrock-client';",
          "3: import { Class, SugarDocument } from '@ephox/sugar';",
          "4: import { TinyDom, TinyHooks } from '@ephox/wrap-mcagar';",
          "5: import { assert } from 'chai';",
          "10:   context('Focus shift on pressing tab', () => {",
          "11:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "12:       base_url: '/project/tinymce/js/tinymce',",
          "13:       iframe_attrs: { // using this instead of tabindex on the target to check custom attrs don't get clobbered",
          "14:         tabindex: '1'",
          "15:       }",
          "16:     }, [ ], true);",
          "18:     before(() => {",
          "19:       const editor = hook.editor();",
          "20:       const container = editor.getContainer();",
          "21:       const inputElem = document.createElement('input');",
          "22:       inputElem.id = 'inputElem';",
          "23:       inputElem.tabIndex = 2;",
          "24:       container.parentNode?.insertBefore(inputElem, container);",
          "25:     });",
          "27:     after(() => {",
          "28:       const inputElem = document.getElementById('inputElem');",
          "29:       if (inputElem) {",
          "30:         inputElem.parentNode?.removeChild(inputElem);",
          "31:       }",
          "32:     });",
          "34:     it('TINY-8315: Add an input field outside the editor, focus on the editor, press the tab key and assert focus shifts to the input field', async () => {",
          "35:       FocusTools.isOnSelector('iframe is focused', SugarDocument.getDocument(), 'iframe');",
          "36:       await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.text('\\t') ]);",
          "37:       await FocusTools.pTryOnSelector('Wait for focus to be on input', SugarDocument.getDocument(), '#inputElem');",
          "38:     });",
          "41:   context('Highlight editor content area on focus', () => {",
          "42:     const assertIsHighlighted = (editor: Editor) => assert.isTrue(Class.has(TinyDom.container(editor), 'tox-edit-focus'), 'Editor container should have tox-edit-focus class');",
          "43:     const assertIsNotHighlighted = (editor: Editor) => assert.isFalse(Class.has(TinyDom.container(editor), 'tox-edit-focus'), 'Editor container should not have tox-edit-focus class');",
          "45:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "46:       base_url: '/project/tinymce/js/tinymce',",
          "47:       highlight_on_focus: true,",
          "48:       iframe_attrs: { // using this instead of tabindex on the target to check custom attrs don't get clobbered",
          "49:         tabindex: '1'",
          "50:       }",
          "51:     }, []);",
          "53:     afterEach(async () => {",
          "55:       await RealKeys.pSendKeysOn('iframe => body', [ RealKeys.combo({ shiftKey: true }, '\\t') ]);",
          "56:     });",
          "58:     it('TINY-9277: Focus on tab', async () => {",
          "59:       const editor = hook.editor();",
          "60:       assertIsNotHighlighted(editor);",
          "63:       await RealKeys.pSendKeysOn('body', [ RealKeys.text('\\t') ]);",
          "64:       assertIsHighlighted(editor);",
          "65:     });",
          "67:     it('TINY-9277: Focus on click', async () => {",
          "68:       const editor = hook.editor();",
          "69:       assertIsNotHighlighted(editor);",
          "70:       await RealMouse.pClickOn('iframe => body');",
          "71:       assertIsHighlighted(editor);",
          "72:     });",
          "",
          "---------------"
        ]
      }
    }
  ]
}