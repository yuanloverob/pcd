{
  "cve_id": "CVE-2024-8060",
  "cve_desc": "OpenWebUI version 0.3.0 contains a vulnerability in the audio API endpoint `/audio/api/v1/transcriptions` that allows for arbitrary file upload. The application performs insufficient validation on the `file.content_type` and allows user-controlled filenames, leading to a path traversal vulnerability. This can be exploited by an authenticated user to overwrite critical files within the Docker container, potentially leading to remote code execution as the root user.",
  "repo": "open-webui/open-webui",
  "patch_hash": "613a087387c094e71ee91d29c015195ef401e160",
  "patch_info": {
    "commit_hash": "613a087387c094e71ee91d29c015195ef401e160",
    "repo": "open-webui/open-webui",
    "commit_url": "https://github.com/open-webui/open-webui/commit/613a087387c094e71ee91d29c015195ef401e160",
    "files": [
      "backend/open_webui/routers/audio.py"
    ],
    "message": "refac",
    "before_after_code_files": [
      "backend/open_webui/routers/audio.py||backend/open_webui/routers/audio.py"
    ]
  },
  "patch_diff": {
    "backend/open_webui/routers/audio.py||backend/open_webui/routers/audio.py": [
      "File: backend/open_webui/routers/audio.py -> backend/open_webui/routers/audio.py",
      "--- Hunk 1 ---",
      "[Context before]",
      "681:     available_models = []",
      "682:     if request.app.state.config.TTS_ENGINE == \"openai\":",
      "683:         # Use custom endpoint if not using the official OpenAI API URL",
      "685:             try:",
      "687:                 response.raise_for_status()",
      "688:                 data = response.json()",
      "689:                 available_models = data.get(\"models\", [])",
      "690:             except Exception as e:",
      "691:                 log.error(f\"Error fetching models from custom endpoint: {str(e)}\")",
      "693:         else:",
      "694:             available_models = [{\"id\": \"tts-1\"}, {\"id\": \"tts-1-hd\"}]",
      "695:     elif request.app.state.config.TTS_ENGINE == \"elevenlabs\":",
      "",
      "[Removed Lines]",
      "684:         if not request.app.state.config.TTS_OPENAI_API_BASE_URL.startswith(\"https://api.openai.com\"):",
      "686:                 response = requests.get(f\"{request.app.state.config.TTS_OPENAI_API_BASE_URL}/audio/models\")",
      "692:                 available_models = []",
      "",
      "[Added Lines]",
      "684:         if not request.app.state.config.TTS_OPENAI_API_BASE_URL.startswith(",
      "685:             \"https://api.openai.com\"",
      "686:         ):",
      "688:                 response = requests.get(",
      "689:                     f\"{request.app.state.config.TTS_OPENAI_API_BASE_URL}/audio/models\"",
      "690:                 )",
      "696:                 available_models = [{\"id\": \"tts-1\"}, {\"id\": \"tts-1-hd\"}]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "723:     available_voices = {}",
      "724:     if request.app.state.config.TTS_ENGINE == \"openai\":",
      "725:         # Use custom endpoint if not using the official OpenAI API URL",
      "727:             try:",
      "729:                 response.raise_for_status()",
      "730:                 data = response.json()",
      "731:                 voices_list = data.get(\"voices\", [])",
      "732:                 available_voices = {voice[\"id\"]: voice[\"name\"] for voice in voices_list}",
      "733:             except Exception as e:",
      "734:                 log.error(f\"Error fetching voices from custom endpoint: {str(e)}\")",
      "736:         else:",
      "737:             available_voices = {",
      "738:                 \"alloy\": \"alloy\",",
      "",
      "[Removed Lines]",
      "726:         if not request.app.state.config.TTS_OPENAI_API_BASE_URL.startswith(\"https://api.openai.com\"):",
      "728:                 response = requests.get(f\"{request.app.state.config.TTS_OPENAI_API_BASE_URL}/audio/voices\")",
      "735:                 available_voices = {}",
      "",
      "[Added Lines]",
      "730:         if not request.app.state.config.TTS_OPENAI_API_BASE_URL.startswith(",
      "731:             \"https://api.openai.com\"",
      "732:         ):",
      "734:                 response = requests.get(",
      "735:                     f\"{request.app.state.config.TTS_OPENAI_API_BASE_URL}/audio/voices\"",
      "736:                 )",
      "743:                 available_voices = {",
      "744:                     \"alloy\": \"alloy\",",
      "745:                     \"echo\": \"echo\",",
      "746:                     \"fable\": \"fable\",",
      "747:                     \"onyx\": \"onyx\",",
      "748:                     \"nova\": \"nova\",",
      "749:                     \"shimmer\": \"shimmer\",",
      "750:                 }",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "de4e086bd58e6013ee65572e25244fc32138e473",
      "candidate_info": {
        "commit_hash": "de4e086bd58e6013ee65572e25244fc32138e473",
        "repo": "open-webui/open-webui",
        "commit_url": "https://github.com/open-webui/open-webui/commit/de4e086bd58e6013ee65572e25244fc32138e473",
        "files": [
          "src/lib/components/chat/Messages/RateComment.svelte"
        ],
        "message": "refac",
        "before_after_code_files": [
          "src/lib/components/chat/Messages/RateComment.svelte||src/lib/components/chat/Messages/RateComment.svelte"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/lib/components/chat/Messages/RateComment.svelte||src/lib/components/chat/Messages/RateComment.svelte": [
          "File: src/lib/components/chat/Messages/RateComment.svelte -> src/lib/components/chat/Messages/RateComment.svelte",
          "--- Hunk 1 ---",
          "[Context before]",
          "52:  }",
          "54:  const init = () => {",
          "57:   tags = (message?.annotation?.tags ?? []).map((tag) => ({",
          "58:    name: tag",
          "59:   }));",
          "61:  };",
          "63:  onMount(() => {",
          "",
          "[Removed Lines]",
          "55:   selectedReason = message?.annotation?.reason ?? '';",
          "56:   comment = message?.annotation?.comment ?? '';",
          "60:   detailedRating = message?.annotation?.details?.rating ?? null;",
          "",
          "[Added Lines]",
          "55:   if (!selectedReason) {",
          "56:    selectedReason = message?.annotation?.reason ?? '';",
          "57:   }",
          "59:   if (!comment) {",
          "60:    comment = message?.annotation?.comment ?? '';",
          "61:   }",
          "67:   if (!detailedRating) {",
          "68:    detailedRating = message?.annotation?.details?.rating ?? null;",
          "69:   }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "c5636ff68c4e9ca095cd6458cc740f4a3aa53831",
      "candidate_info": {
        "commit_hash": "c5636ff68c4e9ca095cd6458cc740f4a3aa53831",
        "repo": "open-webui/open-webui",
        "commit_url": "https://github.com/open-webui/open-webui/commit/c5636ff68c4e9ca095cd6458cc740f4a3aa53831",
        "files": [
          "src/lib/components/chat/MessageInput/Commands/Knowledge.svelte",
          "src/lib/components/chat/Messages/Citations.svelte",
          "src/lib/components/chat/Messages/CitationsModal.svelte",
          "src/lib/components/common/FileItem.svelte",
          "src/lib/components/workspace/Knowledge/KnowledgeBase.svelte"
        ],
        "message": "refac",
        "before_after_code_files": [
          "src/lib/components/chat/MessageInput/Commands/Knowledge.svelte||src/lib/components/chat/MessageInput/Commands/Knowledge.svelte",
          "src/lib/components/chat/Messages/Citations.svelte||src/lib/components/chat/Messages/Citations.svelte",
          "src/lib/components/chat/Messages/CitationsModal.svelte||src/lib/components/chat/Messages/CitationsModal.svelte",
          "src/lib/components/common/FileItem.svelte||src/lib/components/common/FileItem.svelte",
          "src/lib/components/workspace/Knowledge/KnowledgeBase.svelte||src/lib/components/workspace/Knowledge/KnowledgeBase.svelte"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/lib/components/chat/MessageInput/Commands/Knowledge.svelte||src/lib/components/chat/MessageInput/Commands/Knowledge.svelte": [
          "File: src/lib/components/chat/MessageInput/Commands/Knowledge.svelte -> src/lib/components/chat/MessageInput/Commands/Knowledge.svelte",
          "--- Hunk 1 ---",
          "[Context before]",
          "154:    keys: ['name', 'description']",
          "155:   });",
          "156:  });",
          "157: </script>",
          "159: {#if filteredItems.length > 0 || prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "158:  const decodeString = (str: string) => {",
          "159:   try {",
          "160:    return decodeURIComponent(str);",
          "161:   } catch (e) {",
          "162:    return str;",
          "163:   }",
          "164:  };",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "210:          {/if}",
          "212:          <div class=\"line-clamp-1\">",
          "214:          </div>",
          "215:         </div>",
          "",
          "[Removed Lines]",
          "213:           {decodeURIComponent(item?.name)}",
          "",
          "[Added Lines]",
          "221:           {decodeString(item?.name)}",
          "",
          "---------------"
        ],
        "src/lib/components/chat/Messages/Citations.svelte||src/lib/components/chat/Messages/Citations.svelte": [
          "File: src/lib/components/chat/Messages/Citations.svelte -> src/lib/components/chat/Messages/Citations.svelte",
          "--- Hunk 1 ---",
          "[Context before]",
          "87:   showRelevance = calculateShowRelevance(citations);",
          "88:   showPercentage = shouldShowPercentage(citations);",
          "89:  }",
          "90: </script>",
          "92: <CitationsModal",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "91:  const decodeString = (str: string) => {",
          "92:   try {",
          "93:    return decodeURIComponent(str);",
          "94:   } catch (e) {",
          "95:    return str;",
          "96:   }",
          "97:  };",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "117:       <div",
          "118:        class=\"flex-1 mx-1 truncate text-black/60 hover:text-black dark:text-white/60 dark:hover:text-white transition\"",
          "119:       >",
          "121:       </div>",
          "122:      </button>",
          "123:     {/each}",
          "",
          "[Removed Lines]",
          "120:        {decodeURIComponent(citation.source.name)}",
          "",
          "[Added Lines]",
          "128:        {decodeString(citation.source.name)}",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "157:            </div>",
          "158:           {/if}",
          "159:           <div class=\"flex-1 mx-1 truncate\">",
          "161:           </div>",
          "162:          </button>",
          "163:         {/each}",
          "",
          "[Removed Lines]",
          "160:            {decodeURIComponent(citation.source.name)}",
          "",
          "[Added Lines]",
          "168:            {decodeString(citation.source.name)}",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "194:          </div>",
          "195:         {/if}",
          "196:         <div class=\"flex-1 mx-1 truncate\">",
          "198:         </div>",
          "199:        </button>",
          "200:       {/each}",
          "",
          "[Removed Lines]",
          "197:          {decodeURIComponent(citation.source.name)}",
          "",
          "[Added Lines]",
          "205:          {decodeString(citation.source.name)}",
          "",
          "---------------"
        ],
        "src/lib/components/chat/Messages/CitationsModal.svelte||src/lib/components/chat/Messages/CitationsModal.svelte": [
          "File: src/lib/components/chat/Messages/CitationsModal.svelte -> src/lib/components/chat/Messages/CitationsModal.svelte",
          "--- Hunk 1 ---",
          "[Context before]",
          "45:    );",
          "46:   }",
          "47:  }",
          "48: </script>",
          "50: <Modal size=\"lg\" bind:show>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "49:  const decodeString = (str: string) => {",
          "50:   try {",
          "51:    return decodeURIComponent(str);",
          "52:   } catch (e) {",
          "53:    return str;",
          "54:   }",
          "55:  };",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "99:             : `#`}",
          "100:           target=\"_blank\"",
          "101:          >",
          "103:          </a>",
          "104:          {#if document?.metadata?.page}",
          "105:           <span class=\"text-xs text-gray-500 dark:text-gray-400\">",
          "",
          "[Removed Lines]",
          "102:           {decodeURIComponent(document?.metadata?.name ?? document.source.name)}",
          "",
          "[Added Lines]",
          "110:           {decodeString(document?.metadata?.name ?? document.source.name)}",
          "",
          "---------------"
        ],
        "src/lib/components/common/FileItem.svelte||src/lib/components/common/FileItem.svelte": [
          "File: src/lib/components/common/FileItem.svelte -> src/lib/components/common/FileItem.svelte",
          "--- Hunk 1 ---",
          "[Context before]",
          "28:  import { deleteFileById } from '$lib/apis/files';",
          "30:  let showModal = false;",
          "31: </script>",
          "33: {#if item}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32:  const decodeString = (str: string) => {",
          "33:   try {",
          "34:    return decodeURIComponent(str);",
          "35:   } catch (e) {",
          "36:    return str;",
          "37:   }",
          "38:  };",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "82:  {#if !small}",
          "83:   <div class=\"flex flex-col justify-center -space-y-0.5 px-2.5 w-full\">",
          "84:    <div class=\" dark:text-gray-100 text-sm font-medium line-clamp-1 mb-1\">",
          "86:    </div>",
          "88:    <div class=\" flex justify-between text-gray-500 text-xs line-clamp-1\">",
          "",
          "[Removed Lines]",
          "85:     {decodeURIComponent(name)}",
          "",
          "[Added Lines]",
          "93:     {decodeString(name)}",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "101:    </div>",
          "102:   </div>",
          "103:  {:else}",
          "109:    <div class=\"flex flex-col justify-center -space-y-0.5 px-2.5 w-full\">",
          "110:     <div class=\" dark:text-gray-100 text-sm flex justify-between items-center\">",
          "111:      {#if loading}",
          "",
          "[Removed Lines]",
          "104:   <Tooltip",
          "105:    content={decodeURIComponent(name)}",
          "106:    className=\"flex flex-col w-full\"",
          "107:    placement=\"top-start\"",
          "108:   >",
          "",
          "[Added Lines]",
          "112:   <Tooltip content={decodeString(name)} className=\"flex flex-col w-full\" placement=\"top-start\">",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "113:        <Spinner className=\"size-4\" />",
          "114:       </div>",
          "115:      {/if}",
          "117:      <div class=\"text-gray-500 text-xs capitalize shrink-0\">{formatFileSize(size)}</div>",
          "118:     </div>",
          "119:    </div>",
          "",
          "[Removed Lines]",
          "116:      <div class=\"font-medium line-clamp-1 flex-1\">{decodeURIComponent(name)}</div>",
          "",
          "[Added Lines]",
          "120:      <div class=\"font-medium line-clamp-1 flex-1\">{decodeString(name)}</div>",
          "",
          "---------------"
        ],
        "src/lib/components/workspace/Knowledge/KnowledgeBase.svelte||src/lib/components/workspace/Knowledge/KnowledgeBase.svelte": [
          "File: src/lib/components/workspace/Knowledge/KnowledgeBase.svelte -> src/lib/components/workspace/Knowledge/KnowledgeBase.svelte",
          "--- Hunk 1 ---",
          "[Context before]",
          "547:   dropZone?.removeEventListener('drop', onDrop);",
          "548:   dropZone?.removeEventListener('dragleave', onDragLeave);",
          "549:  });",
          "550: </script>",
          "552: {#if dragged}",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "551:  const decodeString = (str: string) => {",
          "552:   try {",
          "553:    return decodeURIComponent(str);",
          "554:   } catch (e) {",
          "555:    return str;",
          "556:   }",
          "557:  };",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "698:           href={selectedFile.id ? `/api/v1/files/${selectedFile.id}/content` : '#'}",
          "699:           target=\"_blank\"",
          "700:          >",
          "702:          </a>",
          "703:         </div>",
          "",
          "[Removed Lines]",
          "701:           {decodeURIComponent(selectedFile?.meta?.name)}",
          "",
          "[Added Lines]",
          "709:           {decodeString(selectedFile?.meta?.name)}",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "866d02bbaef827c2c5a7e84710273700d16ea22d",
      "candidate_info": {
        "commit_hash": "866d02bbaef827c2c5a7e84710273700d16ea22d",
        "repo": "open-webui/open-webui",
        "commit_url": "https://github.com/open-webui/open-webui/commit/866d02bbaef827c2c5a7e84710273700d16ea22d",
        "files": [
          "backend/open_webui/config.py"
        ],
        "message": "refac",
        "before_after_code_files": [
          "backend/open_webui/config.py||backend/open_webui/config.py"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "backend/open_webui/config.py||backend/open_webui/config.py": [
          "File: backend/open_webui/config.py -> backend/open_webui/config.py",
          "--- Hunk 1 ---",
          "[Context before]",
          "1500: VECTOR_DB = os.environ.get(\"VECTOR_DB\", \"chroma\")",
          "1502: # Chroma",
          "1503: if VECTOR_DB == \"chroma\":",
          "1504:     import chromadb",
          "1507:     CHROMA_TENANT = os.environ.get(\"CHROMA_TENANT\", chromadb.DEFAULT_TENANT)",
          "1508:     CHROMA_DATABASE = os.environ.get(\"CHROMA_DATABASE\", chromadb.DEFAULT_DATABASE)",
          "1509:     CHROMA_HTTP_HOST = os.environ.get(\"CHROMA_HTTP_HOST\", \"\")",
          "",
          "[Removed Lines]",
          "1506:     CHROMA_DATA_PATH = f\"{DATA_DIR}/vector_db\"",
          "",
          "[Added Lines]",
          "1503: CHROMA_DATA_PATH = f\"{DATA_DIR}/vector_db\"",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "10b9fa6ed0f3451940d1de83cfe14bd195f93717",
      "candidate_info": {
        "commit_hash": "10b9fa6ed0f3451940d1de83cfe14bd195f93717",
        "repo": "open-webui/open-webui",
        "commit_url": "https://github.com/open-webui/open-webui/commit/10b9fa6ed0f3451940d1de83cfe14bd195f93717",
        "files": [
          "src/lib/components/layout/Navbar/Menu.svelte",
          "src/lib/components/layout/Sidebar/ChatMenu.svelte"
        ],
        "message": "refac",
        "before_after_code_files": [
          "src/lib/components/layout/Navbar/Menu.svelte||src/lib/components/layout/Navbar/Menu.svelte",
          "src/lib/components/layout/Sidebar/ChatMenu.svelte||src/lib/components/layout/Sidebar/ChatMenu.svelte"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/lib/components/layout/Navbar/Menu.svelte||src/lib/components/layout/Navbar/Menu.svelte": [
          "File: src/lib/components/layout/Navbar/Menu.svelte -> src/lib/components/layout/Navbar/Menu.svelte",
          "--- Hunk 1 ---",
          "[Context before]",
          "67:   if (containerElement) {",
          "68:    try {",
          "69:     const canvas = await html2canvas(containerElement, {",
          "72:      height: containerElement.scrollHeight,",
          "73:      windowHeight: containerElement.scrollHeight",
          "74:     });",
          "76:     const imgData = canvas.toDataURL('image/png');",
          "79:     const pdf = new jsPDF('p', 'mm', 'a4');",
          "83:     const imgHeight = (canvas.height * imgWidth) / canvas.width; // Maintain aspect ratio",
          "84:     let heightLeft = imgHeight;",
          "85:     let position = 0;",
          "88:     pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);",
          "89:     heightLeft -= pageHeight;",
          "92:     while (heightLeft > 0) {",
          "93:      position -= pageHeight;",
          "94:      pdf.addPage();",
          "95:      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);",
          "96:      heightLeft -= pageHeight;",
          "97:     }",
          "",
          "[Removed Lines]",
          "70:      backgroundColor: $theme.includes('dark') ? '#000' : '#fff',",
          "71:      scale: 2, // Increases resolution for better quality",
          "80:     const imgWidth = 210; // A4 width in mm",
          "81:     const pageHeight = 297; // A4 height in mm",
          "",
          "[Added Lines]",
          "69:     const isDarkMode = $theme.includes('dark'); // Check theme mode",
          "72:      backgroundColor: isDarkMode ? '#000' : '#fff', // Ensure proper background",
          "73:      scale: 2, // Enhance resolution",
          "82:     const imgWidth = 210;",
          "83:     const pageHeight = 297;",
          "90:     if (isDarkMode) {",
          "91:      pdf.setFillColor(0, 0, 0); // Black background for each page",
          "92:      pdf.rect(0, 0, imgWidth, pageHeight, 'F'); // Fill entire page",
          "93:     }",
          "104:      if (isDarkMode) {",
          "105:       pdf.setFillColor(0, 0, 0); // Ensure dark background for new pages",
          "106:       pdf.rect(0, 0, imgWidth, pageHeight, 'F');",
          "107:      }",
          "",
          "---------------"
        ],
        "src/lib/components/layout/Sidebar/ChatMenu.svelte||src/lib/components/layout/Sidebar/ChatMenu.svelte": [
          "File: src/lib/components/layout/Sidebar/ChatMenu.svelte -> src/lib/components/layout/Sidebar/ChatMenu.svelte",
          "--- Hunk 1 ---",
          "[Context before]",
          "85:   if (containerElement) {",
          "86:    try {",
          "87:     const canvas = await html2canvas(containerElement, {",
          "90:      height: containerElement.scrollHeight,",
          "91:      windowHeight: containerElement.scrollHeight",
          "92:     });",
          "94:     const imgData = canvas.toDataURL('image/png');",
          "97:     const pdf = new jsPDF('p', 'mm', 'a4');",
          "101:     const imgHeight = (canvas.height * imgWidth) / canvas.width; // Maintain aspect ratio",
          "102:     let heightLeft = imgHeight;",
          "103:     let position = 0;",
          "106:     pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);",
          "107:     heightLeft -= pageHeight;",
          "110:     while (heightLeft > 0) {",
          "111:      position -= pageHeight;",
          "112:      pdf.addPage();",
          "113:      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);",
          "114:      heightLeft -= pageHeight;",
          "115:     }",
          "",
          "[Removed Lines]",
          "88:      backgroundColor: $theme.includes('dark') ? '#1a202c' : '#fff',",
          "89:      scale: 2, // Increases resolution for better quality",
          "98:     const imgWidth = 210; // A4 width in mm",
          "99:     const pageHeight = 297; // A4 height in mm",
          "",
          "[Added Lines]",
          "87:     const isDarkMode = $theme.includes('dark'); // Check theme mode",
          "90:      backgroundColor: isDarkMode ? '#000' : '#fff', // Ensure proper background",
          "91:      scale: 2, // Enhance resolution",
          "100:     const imgWidth = 210;",
          "101:     const pageHeight = 297;",
          "108:     if (isDarkMode) {",
          "109:      pdf.setFillColor(0, 0, 0); // Black background for each page",
          "110:      pdf.rect(0, 0, imgWidth, pageHeight, 'F'); // Fill entire page",
          "111:     }",
          "122:      if (isDarkMode) {",
          "123:       pdf.setFillColor(0, 0, 0); // Ensure dark background for new pages",
          "124:       pdf.rect(0, 0, imgWidth, pageHeight, 'F');",
          "125:      }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "4e375c892ad04a3c9d86fdff1e2fae14337eee99",
      "candidate_info": {
        "commit_hash": "4e375c892ad04a3c9d86fdff1e2fae14337eee99",
        "repo": "open-webui/open-webui",
        "commit_url": "https://github.com/open-webui/open-webui/commit/4e375c892ad04a3c9d86fdff1e2fae14337eee99",
        "files": [
          "src/lib/components/chat/Messages/ResponseMessage.svelte"
        ],
        "message": "refac",
        "before_after_code_files": [
          "src/lib/components/chat/Messages/ResponseMessage.svelte||src/lib/components/chat/Messages/ResponseMessage.svelte"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "src/lib/components/chat/Messages/ResponseMessage.svelte||src/lib/components/chat/Messages/ResponseMessage.svelte": [
          "File: src/lib/components/chat/Messages/ResponseMessage.svelte -> src/lib/components/chat/Messages/ResponseMessage.svelte",
          "--- Hunk 1 ---",
          "[Context before]",
          "1108:          {/if}",
          "1110:          {#if isLastMessage}",
          "1140:           <Tooltip content={$i18n.t('Continue Response')} placement=\"bottom\">",
          "1141:            <button",
          "1142:             type=\"button\"",
          "",
          "[Removed Lines]",
          "1111:           {#if siblings.length > 1}",
          "1112:           <Tooltip content={$i18n.t('Delete')} placement=\"bottom\">",
          "1113:            <button",
          "1114:             type=\"button\"",
          "1115:             id=\"continue-response-button\"",
          "1116:             class=\"{isLastMessage",
          "1117:              ? 'visible'",
          "1118:              : 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition regenerate-response-button\"",
          "1119:             on:click={() => {",
          "1120:              deleteMessageHandler();",
          "1121:             }}",
          "1122:            >",
          "1123:             <svg",
          "1124:              xmlns=\"http://www.w3.org/2000/svg\"",
          "1125:              fill=\"none\"",
          "1126:              viewBox=\"0 0 24 24\"",
          "1127:              stroke-width=\"2\"",
          "1128:              stroke=\"currentColor\"",
          "1129:              class=\"w-4 h-4\"",
          "1130:             >",
          "1131:              <path",
          "1132:               stroke-linecap=\"round\"",
          "1133:               stroke-linejoin=\"round\"",
          "1134:               d=\"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0\"",
          "1135:              />",
          "1136:             </svg>",
          "1137:            </button>",
          "1138:           </Tooltip>",
          "1139:           {/if}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "1211:           </button>",
          "1212:          </Tooltip>",
          "1214:          {#if isLastMessage}",
          "1215:           {#each model?.actions ?? [] as action}",
          "1216:            <Tooltip content={action.name} placement=\"bottom\">",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1184:          {#if siblings.length > 1}",
          "1185:           <Tooltip content={$i18n.t('Delete')} placement=\"bottom\">",
          "1186:            <button",
          "1187:             type=\"button\"",
          "1188:             id=\"continue-response-button\"",
          "1189:             class=\"{isLastMessage",
          "1190:              ? 'visible'",
          "1191:              : 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition regenerate-response-button\"",
          "1192:             on:click={() => {",
          "1193:              deleteMessageHandler();",
          "1194:             }}",
          "1195:            >",
          "1196:             <svg",
          "1197:              xmlns=\"http://www.w3.org/2000/svg\"",
          "1198:              fill=\"none\"",
          "1199:              viewBox=\"0 0 24 24\"",
          "1200:              stroke-width=\"2\"",
          "1201:              stroke=\"currentColor\"",
          "1202:              class=\"w-4 h-4\"",
          "1203:             >",
          "1204:              <path",
          "1205:               stroke-linecap=\"round\"",
          "1206:               stroke-linejoin=\"round\"",
          "1207:               d=\"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0\"",
          "1208:              />",
          "1209:             </svg>",
          "1210:            </button>",
          "1211:           </Tooltip>",
          "1212:          {/if}",
          "",
          "---------------"
        ]
      }
    }
  ]
}