{
  "cve_id": "CVE-2024-55922",
  "cve_desc": "TYPO3 is a free and open source Content Management Framework. A vulnerability has been identified in the backend user interface functionality involving deep links. Specifically, this functionality is susceptible to Cross-Site Request Forgery (CSRF). Additionally, state-changing actions in downstream components incorrectly accepted submissions via HTTP GET and did not enforce the appropriate HTTP method. Successful exploitation of this vulnerability requires the victim to have an active session on the backend user interface and to be deceived into interacting with a malicious URL targeting the backend, which can occur under the following conditions: The user opens a malicious link, such as one sent via email. The user visits a compromised or manipulated website while the following settings are misconfigured: 1. `security.backend.enforceReferrer` feature is disabled, 2. `BE/cookieSameSite` configuration is set to lax or none The vulnerability in the affected downstream component \u201cForm Framework Module\u201d allows attackers to manipulate or delete persisted form definitions. Users are advised to update to TYPO3 versions 11.5.42 ELTS, 12.4.25 LTS, 13.4.3 LTS which fix the problem described. There are no known workarounds for this vulnerability.",
  "repo": "TYPO3-CMS/form",
  "patch_hash": "93327743f5dfd31c44898ce16e3e004e05f8ba5f",
  "patch_info": {
    "commit_hash": "93327743f5dfd31c44898ce16e3e004e05f8ba5f",
    "repo": "TYPO3-CMS/form",
    "commit_url": "https://github.com/TYPO3-CMS/form/commit/93327743f5dfd31c44898ce16e3e004e05f8ba5f",
    "files": [
      "Classes/Controller/FormEditorController.php",
      "Classes/Controller/FormManagerController.php",
      "Resources/Private/Templates/Backend/FormManager/Index.html",
      "Resources/Public/JavaScript/backend/form-manager/view-model.js"
    ],
    "message": "[SECURITY] Enforce HTTP method assertions for backend modules\n\nResolves: #104456\nReleases: main, 13.4, 12.4\nChange-Id: Ic679584a343b6d35e81325a03148b0cff81f1d27\nSecurity-Bulletin: TYPO3-CORE-SA-2025-003\nSecurity-Bulletin: TYPO3-CORE-SA-2025-004\nSecurity-Bulletin: TYPO3-CORE-SA-2025-005\nSecurity-Bulletin: TYPO3-CORE-SA-2025-006\nSecurity-Bulletin: TYPO3-CORE-SA-2025-007\nSecurity-Bulletin: TYPO3-CORE-SA-2025-008\nSecurity-References: CVE-2024-55893\nSecurity-References: CVE-2024-55894\nSecurity-References: CVE-2024-55920\nSecurity-References: CVE-2024-55921\nSecurity-References: CVE-2024-55922\nSecurity-References: CVE-2024-55923\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/87744\nTested-by: Oliver Hader <oliver.hader@typo3.org>\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>",
    "before_after_code_files": [
      "Classes/Controller/FormEditorController.php||Classes/Controller/FormEditorController.php",
      "Classes/Controller/FormManagerController.php||Classes/Controller/FormManagerController.php",
      "Resources/Private/Templates/Backend/FormManager/Index.html||Resources/Private/Templates/Backend/FormManager/Index.html",
      "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
    ]
  },
  "patch_diff": {
    "Classes/Controller/FormEditorController.php||Classes/Controller/FormEditorController.php": [
      "File: Classes/Controller/FormEditorController.php -> Classes/Controller/FormEditorController.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "22: use TYPO3\\CMS\\Backend\\Template\\Components\\ButtonBar;",
      "23: use TYPO3\\CMS\\Backend\\Template\\ModuleTemplate;",
      "24: use TYPO3\\CMS\\Backend\\Template\\ModuleTemplateFactory;",
      "25: use TYPO3\\CMS\\Core\\Imaging\\IconFactory;",
      "26: use TYPO3\\CMS\\Core\\Imaging\\IconSize;",
      "27: use TYPO3\\CMS\\Core\\Localization\\LanguageService;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "25: use TYPO3\\CMS\\Core\\Http\\AllowedMethodsTrait;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "58: class FormEditorController extends ActionController",
      "59: {",
      "60:     protected const JS_MODULE_NAMES = ['app', 'mediator', 'viewModel'];",
      "62:     public function __construct(",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "61:     use AllowedMethodsTrait;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "171:     protected function initializeSaveFormAction(): void",
      "172:     {",
      "173:         $this->defaultViewObjectName = JsonView::class;",
      "174:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "176:         $this->assertAllowedHttpMethod($this->request, 'POST');",
      "",
      "---------------"
    ],
    "Classes/Controller/FormManagerController.php||Classes/Controller/FormManagerController.php": [
      "File: Classes/Controller/FormManagerController.php -> Classes/Controller/FormManagerController.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "26: use TYPO3\\CMS\\Backend\\Template\\ModuleTemplateFactory;",
      "27: use TYPO3\\CMS\\Backend\\Utility\\BackendUtility;",
      "28: use TYPO3\\CMS\\Core\\Charset\\CharsetConverter;",
      "29: use TYPO3\\CMS\\Core\\Imaging\\IconFactory;",
      "30: use TYPO3\\CMS\\Core\\Imaging\\IconSize;",
      "31: use TYPO3\\CMS\\Core\\Localization\\LanguageService;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "29: use TYPO3\\CMS\\Core\\Http\\AllowedMethodsTrait;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "33: use TYPO3\\CMS\\Core\\Page\\PageRenderer;",
      "34: use TYPO3\\CMS\\Core\\Pagination\\ArrayPaginator;",
      "35: use TYPO3\\CMS\\Core\\Pagination\\SimplePagination;",
      "37: use TYPO3\\CMS\\Core\\Utility\\ArrayUtility;",
      "38: use TYPO3\\CMS\\Core\\Utility\\GeneralUtility;",
      "39: use TYPO3\\CMS\\Extbase\\Configuration\\ConfigurationManagerInterface;",
      "",
      "[Removed Lines]",
      "36: use TYPO3\\CMS\\Core\\Type\\ContextualFeedbackSeverity;",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "55: class FormManagerController extends ActionController",
      "56: {",
      "57:     protected const JS_MODULE_NAMES = ['app', 'viewModel'];",
      "58:     protected const PAGINATION_MAX = 20;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "57:     use AllowedMethodsTrait;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "119:     protected function initializeCreateAction(): void",
      "120:     {",
      "121:         $this->defaultViewObjectName = JsonView::class;",
      "122:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "123:         $this->assertAllowedHttpMethod($this->request, 'POST');",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "186:     protected function initializeDuplicateAction(): void",
      "187:     {",
      "188:         $this->defaultViewObjectName = JsonView::class;",
      "189:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "191:         $this->assertAllowedHttpMethod($this->request, 'POST');",
      "",
      "---------------",
      "--- Hunk 6 ---",
      "[Context before]",
      "273:         return $this->jsonResponse();",
      "274:     }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "280:     protected function initializeDeleteAction(): void",
      "281:     {",
      "282:         $this->assertAllowedHttpMethod($this->request, 'POST');",
      "283:         $this->defaultViewObjectName = JsonView::class;",
      "284:     }",
      "",
      "---------------",
      "--- Hunk 7 ---",
      "[Context before]",
      "284:         if (!$this->formPersistenceManager->isAllowedPersistencePath($formPersistenceIdentifier, $formSettings)) {",
      "285:             throw new PersistenceManagerException(sprintf('Delete \"%s\" is not allowed', $formPersistenceIdentifier), 1614500661);",
      "286:         }",
      "287:         if (empty($this->databaseService->getReferencesByPersistenceIdentifier($formPersistenceIdentifier))) {",
      "288:             foreach ($GLOBALS['TYPO3_CONF_VARS']['SC_OPTIONS']['ext/form']['beforeFormDelete'] ?? [] as $className) {",
      "289:                 $hookObj = GeneralUtility::makeInstance($className);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "297:         $response = [",
      "298:             'status' => 'success',",
      "299:             'url' => $this->uriBuilder->uriFor('index', [], 'FormManager'),",
      "300:         ];",
      "",
      "---------------",
      "--- Hunk 8 ---",
      "[Context before]",
      "299:                 $formSettings['formManager']['controller'],",
      "300:                 $formSettings['formManager']['translationFiles'] ?? []",
      "301:             );",
      "307:         }",
      "309:     }",
      "311:     protected function getFormSettings(): array",
      "",
      "[Removed Lines]",
      "302:             $this->addFlashMessage(",
      "303:                 sprintf($controllerConfiguration['deleteAction']['errorMessage'], $formPersistenceIdentifier),",
      "304:                 $controllerConfiguration['deleteAction']['errorTitle'],",
      "305:                 ContextualFeedbackSeverity::ERROR,",
      "306:             );",
      "308:         return $this->redirect('index');",
      "",
      "[Added Lines]",
      "317:             $response = [",
      "318:                 'status' => 'error',",
      "319:                 'title' => $controllerConfiguration['deleteAction']['errorTitle'],",
      "320:                 'message' => sprintf($controllerConfiguration['deleteAction']['errorMessage'], $formPersistenceIdentifier),",
      "321:             ];",
      "327:         $view = $this->view;",
      "328:         $view->assign('response', $response);",
      "329:         $view->setVariablesToRender([",
      "330:             'response',",
      "331:         ]);",
      "332:         return $this->jsonResponse();",
      "",
      "---------------"
    ],
    "Resources/Private/Templates/Backend/FormManager/Index.html||Resources/Private/Templates/Backend/FormManager/Index.html": [
      "File: Resources/Private/Templates/Backend/FormManager/Index.html -> Resources/Private/Templates/Backend/FormManager/Index.html",
      "--- Hunk 1 ---",
      "[Context before]",
      "140:                                                     data-bs-original-title=\"{f:translate(key: 'LLL:EXT:form/Resources/Private/Language/Database.xlf:formManager.delete_form')}\"",
      "141:                                                     data-identifier=\"removeForm\"",
      "142:                                                     data-form-persistence-identifier=\"{form.persistenceIdentifier}\"",
      "143:                                                     title=\"{f:translate(key: 'LLL:EXT:form/Resources/Private/Language/Database.xlf:formManager.delete_form')}\"",
      "144:                                                 >",
      "145:                                                     <core:icon identifier=\"actions-edit-delete\" />",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "143:                                                     data-form-name=\"{form.name}\"",
      "",
      "---------------"
    ],
    "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js": [
      "File: Resources/Public/JavaScript/backend/form-manager/view-model.js -> Resources/Public/JavaScript/backend/form-manager/view-model.js",
      "--- Hunk 1 ---",
      "[Context before]",
      "[No context available]",
      "",
      "[Removed Lines]",
      "13: import $ from\"jquery\";import Modal from\"@typo3/backend/modal.js\";import Severity from\"@typo3/backend/severity.js\";import MultiStepWizard from\"@typo3/backend/multi-step-wizard.js\";import Icons from\"@typo3/backend/icons.js\";import Notification from\"@typo3/backend/notification.js\";import SecurityUtility from\"@typo3/core/security-utility.js\";import{selector}from\"@typo3/core/literals.js\";import SortableTable from\"@typo3/backend/sortable-table.js\";const securityUtility=new SecurityUtility;var Identifiers;function newFormSetup(e){$(Identifiers.newFormModalTrigger).on(\"click\",(function(t){t.preventDefault(),MultiStepWizard.addSlide(\"new-form-step-1\",TYPO3.lang[\"formManager.newFormWizard.step1.title\"],\"\",Severity.notice,TYPO3.lang[\"formManager.newFormWizard.step1.progressLabel\"],(async function(t){const a=await Icons.getIcon(\"actions-plus\",Icons.sizes.small),r=await Icons.getIcon(\"form-page\",Icons.sizes.large),i=await Icons.getIcon(\"apps-pagetree-page-default\",Icons.sizes.large);let o;const n=MultiStepWizard.setup.$carousel.closest(\".modal\"),l=n.find(\".modal-footer\").find('button[name=\"next\"]');MultiStepWizard.blurCancelStep(),MultiStepWizard.lockNextStep(),MultiStepWizard.lockPrevStep();0===e.getAccessibleFormStorageFolders().length&&(o='<div class=\"new-form-modal\"><div class=\"row\"><label class=\"col col-form-label\">'+TYPO3.lang[\"formManager.newFormWizard.step1.noStorages\"]+\"</label></div></div>\",t.html(o),e.assert(!1,\"No accessible form storage folders\",1477506500)),o='<div class=\"new-form-modal\">',o+='<div class=\"card-container\"><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+i+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.blankForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.blankForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.blankForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-default\" data-inline=\"1\" value=\"blank\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.blankForm.label\"]+'</button></div></div><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+r+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.predefinedForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.predefinedForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-default\" data-inline=\"1\" value=\"predefined\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</button></div></div>\",o+=\"</div>\",t.html(o),$(Identifiers.newFormModeButton,n).on(\"click\",(function(e){MultiStepWizard.set(\"newFormMode\",$(e.currentTarget).val()),MultiStepWizard.next()})),l.on(\"click\",(async function(){t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-2\",TYPO3.lang[\"formManager.newFormWizard.step2.title\"],\"\",Severity.notice,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t,a){let r,i;MultiStepWizard.lockNextStep(),MultiStepWizard.unlockPrevStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(a.savePath||(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"savePathName\",l[0].label)),l.length>1){i=$('<select class=\"new-form-save-path form-select\" id=\"new-form-save-path\" data-identifier=\"newFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}const s=e.getPrototypes();e.assert(s.length>0,\"No prototypes available\",1477506501),a.prototypeName||(MultiStepWizard.set(\"prototypeName\",s[0].value),MultiStepWizard.set(\"prototypeNameName\",s[0].label));const d=$('<select class=\"new-form-prototype-name form-select\" id=\"new-form-prototype-name\" data-identifier=\"newFormPrototypeName\" />');for(let e=0,t=s.length;e<t;++e){const t=new Option(s[e].label,s[e].value);$(d).append(t)}let c=e.getTemplatesForPrototype(s[0].value);e.assert(c.length>0,\"No templates available\",1477506502),a.templatePath||(MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label));const m=$('<select class=\"new-form-template form-select\" id=\"new-form-template\" data-identifier=\"newFormTemplate\" />');for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(m).append(t)}r='<div class=\"new-form-modal\">',\"blank\"===a.newFormMode?(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.blankForm.label\"]+\"</h5>\",MultiStepWizard.set(\"templatePath\",\"EXT:form/Resources/Private/Backend/Templates/FormEditor/Yaml/NewForms/BlankForm.yaml\"),MultiStepWizard.set(\"templatePathName\",TYPO3.lang[\"formManager.blankForm.label\"])):(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</h5>\",s.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-prototype-name\"><strong>'+TYPO3.lang[\"formManager.form_prototype\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-control-wrap\">'+$(d)[0].outerHTML+\"</div></div></div>\"),c.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-template\"><strong>'+TYPO3.lang[\"formManager.form_template\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_template_description\"]+'</div><div class=\"form-control-wrap\">'+$(m)[0].outerHTML+\"</div></div></div>\")),r+='<div class=\"mb-3\"><label for=\"new-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\">',a.formName?(r+='<input class=\"form-control\" id=\"new-form-name\" data-identifier=\"newFormName\" value=\"'+securityUtility.encodeHtml(a.formName)+'\" />',setTimeout((function(){MultiStepWizard.unlockNextStep()}),200)):r+='<input class=\"form-control has-error\" id=\"new-form-name\" data-identifier=\"newFormName\" />',r+=\"</div></div></div>\",i&&(r+='<div class=\"mb-3\"><label for=\"new-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),a.savePath&&$(Identifiers.newFormSavePath,o).val(a.savePath),a.templatePath&&$(Identifiers.newFormTemplate,o).val(a.templatePath),s.length>1?$(Identifiers.newFormPrototypeName,o).focus():c.length>1&&$(Identifiers.newFormTemplate,o).focus();const p=function(){$(Identifiers.newFormTemplate,o).on(\"change\",(function(){MultiStepWizard.set(\"templatePath\",$(Identifiers.newFormTemplate+\" option:selected\",o).val()),MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),MultiStepWizard.set(\"templatePathOnPrev\",$(Identifiers.newFormTemplate+\" option:selected\",o).val())}))};$(Identifiers.newFormPrototypeName,o).on(\"change\",(function(t){MultiStepWizard.set(\"prototypeName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).val()),MultiStepWizard.set(\"prototypeNameName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).text()),c=e.getTemplatesForPrototype($(t.currentTarget).val()),$(Identifiers.newFormTemplate,o).off().empty();for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(Identifiers.newFormTemplate,o).append(t),MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label)}p()})),p(),a.prototypeName&&($(Identifiers.newFormPrototypeName,o).val(a.prototypeName),$(Identifiers.newFormPrototypeName,o).trigger(\"change\"),a.templatePathOnPrev&&($(Identifiers.newFormTemplate,o).find(selector`option[value=\"${a.templatePathOnPrev}\"]`).prop(\"selected\",!0),$(Identifiers.newFormTemplate,o).trigger(\"change\"))),$(Identifiers.newFormName,o).focus(),$(Identifiers.newFormName,o).on(\"keyup paste\",(function(e){$(e.currentTarget).val().length>0?($(e.currentTarget).removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",$(e.currentTarget).val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):($(e.currentTarget).addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),$(Identifiers.newFormSavePath,o).on(\"change\",(function(){MultiStepWizard.set(\"savePath\",$(Identifiers.newFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"savePathName\",$(Identifiers.newFormSavePath+\" option:selected\",o).text())})),\"blank\"===a.newFormMode||a.templatePathName||MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-3\",TYPO3.lang[\"formManager.newFormWizard.step3.title\"],\"\",Severity.notice,TYPO3.lang[\"formManager.newFormWizard.step3.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-cog\",Icons.sizes.small),r=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),i=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),o=await Icons.getIcon(\"actions-database\",Icons.sizes.small),n=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let l='<div class=\"new-form-modal\">';l+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.newFormWizard.step3.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\">',t.prototypeNameName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+a+\" \"+TYPO3.lang[\"formManager.form_prototype\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.prototypeNameName)+\"</div></div>\"),t.templatePathName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+r+\" \"+TYPO3.lang[\"formManager.form_template\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.templatePathName)+\"</div></div>\"),l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+i+\" \"+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"row my-1\"><div class=\"col col-sm-6\">'+o+\" \"+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.savePathName)+\"</div></div>\",l+=\"</div></div>\",e.html(l),n.focus(),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"create\"),{formName:MultiStepWizard.setup.settings.formName,templatePath:MultiStepWizard.setup.settings.templatePath,prototypeName:MultiStepWizard.setup.settings.prototypeName,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.newFormWizard.step4.errorTitle\"],TYPO3.lang[\"formManager.newFormWizard.step4.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function removeFormSetup(e){$(Identifiers.removeFormModalTrigger).on(\"click\",(function(t){const a=[];t.preventDefault();const r=$(t.currentTarget);a.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}}),a.push({text:TYPO3.lang[\"formManager.remove_form\"],active:!0,btnClass:\"btn-danger\",name:\"createform\",trigger:function(t,a){document.location=e.getAjaxEndpoint(\"delete\")+\"&formPersistenceIdentifier=\"+r.data(\"formPersistenceIdentifier\"),a.hideModal()}}),Modal.show(TYPO3.lang[\"formManager.remove_form_title\"],TYPO3.lang[\"formManager.remove_form_message\"].replace(\"{0}\",r.data(\"formName\")),Severity.error,a)}))}function duplicateFormSetup(e){$(Identifiers.duplicateFormModalTrigger).on(\"click\",(function(t){t.preventDefault();const a=$(t.currentTarget);MultiStepWizard.addSlide(\"duplicate-form-step-1\",TYPO3.lang[\"formManager.duplicateFormWizard.step1.title\"].replace(\"{0}\",a.data(\"formName\")),\"\",Severity.notice,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t){let r,i;MultiStepWizard.lockPrevStep(),MultiStepWizard.lockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(e.assert(l.length>0,\"No accessible form storage folders\",1477649539),MultiStepWizard.set(\"formPersistenceIdentifier\",a.data(\"formPersistenceIdentifier\")),MultiStepWizard.set(\"savePath\",l[0].value),l.length>1){i=$('<select id=\"duplicate-form-save-path\" class=\"form-select\" data-identifier=\"duplicateFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}r='<div class=\"duplicate-form-modal\"><h2 class=\"h3 form-section-headline\">'+TYPO3.lang[\"formManager.new_form_name\"]+'</h2><div class=\"mb-3\"><label for=\"duplicate-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\"><input id=\"duplicate-form-name\" class=\"form-control has-error\" data-identifier=\"duplicateFormName\" /></div></div></div>',i&&(r+='<div class=\"mb-3\"><label for=\"duplicate-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),$(Identifiers.duplicateFormName,o).focus(),$(Identifiers.duplicateFormName,o).on(\"keyup paste\",(function(e){const t=$(event.currentTarget);t.val().length>0?(t.removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",t.val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):(t.addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,MultiStepWizard.set(\"confirmationDuplicateFormName\",a.data(\"formName\")),l.length>1?(MultiStepWizard.set(\"savePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).text())):(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",l[0].label)),t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"duplicate-form-step-2\",TYPO3.lang[\"formManager.duplicateFormWizard.step2.title\"],\"\",Severity.notice,TYPO3.lang[\"formManager.duplicateFormWizard.step2.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),r=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),i=await Icons.getIcon(\"actions-database\",Icons.sizes.small);MultiStepWizard.unlockPrevStep(),MultiStepWizard.unlockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let n='<div class=\"new-form-modal\"><div class=\"row\"><div class=\"col\">';n+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.duplicateFormWizard.step2.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+a+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_copied\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+r+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+i+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormSavePath)+\"</div></div></div>\",n+=\"</div></div></div>\",e.html(n),o.focus(),o.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"duplicate\"),{formName:MultiStepWizard.setup.settings.formName,formPersistenceIdentifier:MultiStepWizard.setup.settings.formPersistenceIdentifier,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorTitle\"],TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function showReferencesSetup(e){$(Identifiers.showReferences).on(\"click\",(t=>{t.preventDefault();const a=$(t.currentTarget),r=e.getAjaxEndpoint(\"references\")+\"&formPersistenceIdentifier=\"+a.data(\"formPersistenceIdentifier\");$.get(r,(async function(e){let t;const r=[];r.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}});const i=e.references.length,o=await Icons.getIcon(\"actions-open\",Icons.sizes.small);if(i>0){t='<div><h2 class=\"h3\">'+TYPO3.lang[\"formManager.references.headline\"].replace(\"{0}\",securityUtility.encodeHtml(a.data(\"formName\")))+'</h2></div><div class=\"table-fit\"><table id=\"forms\" class=\"table table-striped table-hover\"><thead><tr><th class=\"col-icon\"></th><th class=\"col-recordtitle\">'+TYPO3.lang[\"formManager.table.field.title\"]+\"</th><th>\"+TYPO3.lang[\"formManager.table.field.uid\"]+'</th><th class=\"col-control nowrap\"><span class=\"visually-hidden\">'+TYPO3.lang[\"formManager.table.field._CONTROL_\"]+\"</span></th></tr></thead><tbody>\";for(let a=0,r=e.references.length;a<r;++a)t+='<tr><td class=\"col-icon\">'+e.references[a].recordIcon+'</td><td class=\"col-recordtitle\"><a href=\"'+securityUtility.encodeHtml(e.references[a].recordEditUrl)+'\" data-identifier=\"referenceLink\">'+securityUtility.encodeHtml(e.references[a].recordTitle)+\"</a></td><td>\"+securityUtility.encodeHtml(e.references[a].recordUid)+'</td><td class=\"col-control\"><div class=\"btn-group\" role=\"group\"><a href=\"'+securityUtility.encodeHtml(e.references[a].recordEditUrl)+'\" data-identifier=\"referenceLink\" class=\"btn btn-default\" title=\"'+TYPO3.lang[\"formManager.btn.edit.title\"]+'\">'+o+\"</a></div></td></tr>\";t+=\"</tbody></table></div>\"}else t=\"<div><h1>\"+TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",securityUtility.encodeHtml(e.formPersistenceIdentifier))+\"</h1></div><div>\"+TYPO3.lang[\"formManager.no_references\"]+\"</div>\";t=$(t),$(Identifiers.referenceLink,t).on(\"click\",(function(e){e.preventDefault(),Modal.currentModal.hideModal(),document.location=$(e.currentTarget).prop(\"href\")})),Modal.show(TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",a.data(\"formName\")),t,Severity.notice,r)})).fail((function(e,t,a){0!==e.status&&Notification.error(t,a,2)}))}))}function initializeSortable(){const e=document.querySelector(Identifiers.formsTable);null!==e&&new SortableTable(e)}!function(e){e.newFormModalTrigger='[data-identifier=\"newForm\"]',e.duplicateFormModalTrigger='[data-identifier=\"duplicateForm\"]',e.removeFormModalTrigger='[data-identifier=\"removeForm\"]',e.newFormModeButton='[data-identifier=\"newFormModeButton\"]',e.newFormName='[data-identifier=\"newFormName\"]',e.newFormSavePath='[data-identifier=\"newFormSavePath\"]',e.newFormPrototypeName='[data-identifier=\"newFormPrototypeName\"]',e.newFormTemplate='[data-identifier=\"newFormTemplate\"]',e.duplicateFormName='[data-identifier=\"duplicateFormName\"]',e.duplicateFormSavePath='[data-identifier=\"duplicateFormSavePath\"]',e.showReferences='[data-identifier=\"showReferences\"]',e.referenceLink='[data-identifier=\"referenceLink\"]',e.moduleBody=\".module-body.t3js-module-body\",e.t3Logo=\".t3-message-page-logo\",e.t3Footer=\"#t3-footer\",e.formsTable=\"#forms\"}(Identifiers||(Identifiers={}));export function bootstrap(e){removeFormSetup(e),newFormSetup(e),duplicateFormSetup(e),showReferencesSetup(e),initializeSortable()}",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "ed4d41a0a77e32636c8d484d282e1469ac46204c",
      "candidate_info": {
        "commit_hash": "ed4d41a0a77e32636c8d484d282e1469ac46204c",
        "repo": "TYPO3-CMS/form",
        "commit_url": "https://github.com/TYPO3-CMS/form/commit/ed4d41a0a77e32636c8d484d282e1469ac46204c",
        "files": [
          "Resources/Public/JavaScript/backend/form-manager/view-model.js"
        ],
        "message": "[TASK] Remove `then()` callback hell in EXT:form wizard\n\nThe code of the form creation wizard is cleaned up a bit. The nested\n`then()` callback hell is replaced with proper async/await statements to\nmake the code more readable.\n\nResolves: #103156\nReleases: main\nChange-Id: I144d6be0c3608f7d412dbefd031dd4d0ce4a3a42\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/83041\nTested-by: Benjamin Franzke <ben@bnf.dev>\nTested-by: Andreas Nedbal <andy@pixelde.su>\nReviewed-by: Benjamin Franzke <ben@bnf.dev>\nReviewed-by: Andreas Kienast <a.fernandez@scripting-base.de>\nReviewed-by: Andreas Nedbal <andy@pixelde.su>\nTested-by: core-ci <typo3@b13.com>\nTested-by: Andreas Kienast <a.fernandez@scripting-base.de>",
        "before_after_code_files": [
          "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
          ],
          "candidate": [
            "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
          ]
        }
      },
      "candidate_diff": {
        "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js": [
          "File: Resources/Public/JavaScript/backend/form-manager/view-model.js -> Resources/Public/JavaScript/backend/form-manager/view-model.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "13: import $ from\"jquery\";import Modal from\"@typo3/backend/modal.js\";import Severity from\"@typo3/backend/severity.js\";import MultiStepWizard from\"@typo3/backend/multi-step-wizard.js\";import Icons from\"@typo3/backend/icons.js\";import Notification from\"@typo3/backend/notification.js\";import SecurityUtility from\"@typo3/core/security-utility.js\";import{selector}from\"@typo3/core/literals.js\";const securityUtility=new SecurityUtility;var Identifiers;function newFormSetup(e){$(Identifiers.newFormModalTrigger).on(\"click\",(function(t){t.preventDefault(),MultiStepWizard.addSlide(\"new-form-step-1\",TYPO3.lang[\"formManager.newFormWizard.step1.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.newFormWizard.step1.progressLabel\"],(function(t){Icons.getIcon(\"actions-plus\",Icons.sizes.small).then((function(a){Icons.getIcon(\"form-page\",Icons.sizes.large).then((function(r){Icons.getIcon(\"apps-pagetree-page-default\",Icons.sizes.large).then((function(o){let i;const n=MultiStepWizard.setup.$carousel.closest(\".modal\"),l=n.find(\".modal-footer\").find('button[name=\"next\"]');MultiStepWizard.blurCancelStep(),MultiStepWizard.lockNextStep(),MultiStepWizard.lockPrevStep();0===e.getAccessibleFormStorageFolders().length&&(i='<div class=\"new-form-modal\"><div class=\"row\"><label class=\"col col-form-label\">'+TYPO3.lang[\"formManager.newFormWizard.step1.noStorages\"]+\"</label></div></div>\",t.html(i),e.assert(!1,\"No accessible form storage folders\",1477506500)),i='<div class=\"new-form-modal\">',i+='<div class=\"card-container\"><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+o+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.blankForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.blankForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.blankForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-success\" data-inline=\"1\" value=\"blank\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.blankForm.label\"]+'</button></div></div><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+r+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.predefinedForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.predefinedForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-success\" data-inline=\"1\" value=\"predefined\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</button></div></div>\",i+=\"</div>\",t.html(i),$(Identifiers.newFormModeButton,n).on(\"click\",(function(e){MultiStepWizard.set(\"newFormMode\",$(e.currentTarget).val()),MultiStepWizard.unlockNextStep().get(0).click()})),l.on(\"click\",(function(){Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null).then((function(e){t.html($(\"<div />\",{class:\"text-center\"}).append(e).prop(\"outerHTML\"))}))}))}))}))}))})),MultiStepWizard.addSlide(\"new-form-step-2\",TYPO3.lang[\"formManager.newFormWizard.step2.title\"],\"\",Severity.info,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t,a){let r,o;MultiStepWizard.lockNextStep(),MultiStepWizard.unlockPrevStep();const i=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=i.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(a.savePath||(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"savePathName\",l[0].label)),l.length>1){o=$('<select class=\"new-form-save-path form-select\" id=\"new-form-save-path\" data-identifier=\"newFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(o).append(t)}}const s=e.getPrototypes();e.assert(s.length>0,\"No prototypes available\",1477506501),a.prototypeName||(MultiStepWizard.set(\"prototypeName\",s[0].value),MultiStepWizard.set(\"prototypeNameName\",s[0].label));const d=$('<select class=\"new-form-prototype-name form-select\" id=\"new-form-prototype-name\" data-identifier=\"newFormPrototypeName\" />');for(let e=0,t=s.length;e<t;++e){const t=new Option(s[e].label,s[e].value);$(d).append(t)}let c=e.getTemplatesForPrototype(s[0].value);e.assert(c.length>0,\"No templates available\",1477506502),a.templatePath||(MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label));const m=$('<select class=\"new-form-template form-select\" id=\"new-form-template\" data-identifier=\"newFormTemplate\" />');for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(m).append(t)}r='<div class=\"new-form-modal\">',\"blank\"===a.newFormMode?(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.blankForm.label\"]+\"</h5>\",MultiStepWizard.set(\"templatePath\",\"EXT:form/Resources/Private/Backend/Templates/FormEditor/Yaml/NewForms/BlankForm.yaml\"),MultiStepWizard.set(\"templatePathName\",TYPO3.lang[\"formManager.blankForm.label\"])):(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</h5>\",s.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-prototype-name\"><strong>'+TYPO3.lang[\"formManager.form_prototype\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-control-wrap\">'+$(d)[0].outerHTML+\"</div></div></div>\"),c.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-template\"><strong>'+TYPO3.lang[\"formManager.form_template\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_template_description\"]+'</div><div class=\"form-control-wrap\">'+$(m)[0].outerHTML+\"</div></div></div>\")),r+='<div class=\"mb-3\"><label for=\"new-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\">',a.formName?(r+='<input class=\"form-control\" id=\"new-form-name\" data-identifier=\"newFormName\" value=\"'+securityUtility.encodeHtml(a.formName)+'\" />',setTimeout((function(){MultiStepWizard.unlockNextStep()}),200)):r+='<input class=\"form-control has-error\" id=\"new-form-name\" data-identifier=\"newFormName\" />',r+=\"</div></div></div>\",o&&(r+='<div class=\"mb-3\"><label for=\"new-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(o)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),a.savePath&&$(Identifiers.newFormSavePath,i).val(a.savePath),a.templatePath&&$(Identifiers.newFormTemplate,i).val(a.templatePath),s.length>1?$(Identifiers.newFormPrototypeName,i).focus():c.length>1&&$(Identifiers.newFormTemplate,i).focus();const p=function(){$(Identifiers.newFormTemplate,i).on(\"change\",(function(){MultiStepWizard.set(\"templatePath\",$(Identifiers.newFormTemplate+\" option:selected\",i).val()),MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",i).text()),MultiStepWizard.set(\"templatePathOnPrev\",$(Identifiers.newFormTemplate+\" option:selected\",i).val())}))};$(Identifiers.newFormPrototypeName,i).on(\"change\",(function(t){MultiStepWizard.set(\"prototypeName\",$(Identifiers.newFormPrototypeName+\" option:selected\",i).val()),MultiStepWizard.set(\"prototypeNameName\",$(Identifiers.newFormPrototypeName+\" option:selected\",i).text()),c=e.getTemplatesForPrototype($(t.currentTarget).val()),$(Identifiers.newFormTemplate,i).off().empty();for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(Identifiers.newFormTemplate,i).append(t),MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label)}p()})),p(),a.prototypeName&&($(Identifiers.newFormPrototypeName,i).val(a.prototypeName),$(Identifiers.newFormPrototypeName,i).trigger(\"change\"),a.templatePathOnPrev&&($(Identifiers.newFormTemplate,i).find(selector`option[value=\"${a.templatePathOnPrev}\"]`).prop(\"selected\",!0),$(Identifiers.newFormTemplate,i).trigger(\"change\"))),$(Identifiers.newFormName,i).focus(),$(Identifiers.newFormName,i).on(\"keyup paste\",(function(e){$(e.currentTarget).val().length>0?($(e.currentTarget).removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",$(e.currentTarget).val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):($(e.currentTarget).addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),$(Identifiers.newFormSavePath,i).on(\"change\",(function(){MultiStepWizard.set(\"savePath\",$(Identifiers.newFormSavePath+\" option:selected\",i).val()),MultiStepWizard.set(\"savePathName\",$(Identifiers.newFormSavePath+\" option:selected\",i).text())})),\"blank\"===a.newFormMode||a.templatePathName||MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",i).text()),n.on(\"click\",(function(){MultiStepWizard.setup.forceSelection=!1,Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null).then((function(e){t.html($(\"<div />\",{class:\"text-center\"}).append(e).prop(\"outerHTML\"))}))}))})),MultiStepWizard.addSlide(\"new-form-step-3\",TYPO3.lang[\"formManager.newFormWizard.step3.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.newFormWizard.step3.progressLabel\"],(function(e,t){Icons.getIcon(\"actions-cog\",Icons.sizes.small).then((function(a){Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small).then((function(r){Icons.getIcon(\"actions-tag\",Icons.sizes.small).then((function(o){Icons.getIcon(\"actions-database\",Icons.sizes.small).then((function(i){const n=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let l='<div class=\"new-form-modal\">';l+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.newFormWizard.step3.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\">',t.prototypeNameName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+a+\" \"+TYPO3.lang[\"formManager.form_prototype\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.prototypeNameName)+\"</div></div>\"),t.templatePathName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+r+\" \"+TYPO3.lang[\"formManager.form_template\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.templatePathName)+\"</div></div>\"),l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+o+\" \"+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"row my-1\"><div class=\"col col-sm-6\">'+i+\" \"+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.savePathName)+\"</div></div>\",l+=\"</div></div></div>\",e.html(l),n.focus(),n.on(\"click\",(function(){MultiStepWizard.setup.forceSelection=!1,Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null).then((function(t){e.html($(\"<div />\",{class:\"text-center\"}).append(t).prop(\"outerHTML\"))}))}))}))}))}))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"create\"),{formName:MultiStepWizard.setup.settings.formName,templatePath:MultiStepWizard.setup.settings.templatePath,prototypeName:MultiStepWizard.setup.settings.prototypeName,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.newFormWizard.step4.errorTitle\"],TYPO3.lang[\"formManager.newFormWizard.step4.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),o=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,o).remove(),$(Identifiers.t3Footer,o).remove(),$(Identifiers.moduleBody).html(o.html())}))})).then((function(){MultiStepWizard.show()}))}))}function removeFormSetup(e){$(Identifiers.removeFormModalTrigger).on(\"click\",(function(t){const a=[];t.preventDefault();const r=$(t.currentTarget);a.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}}),a.push({text:TYPO3.lang[\"formManager.remove_form\"],active:!0,btnClass:\"btn-warning\",name:\"createform\",trigger:function(t,a){document.location=e.getAjaxEndpoint(\"delete\")+\"&formPersistenceIdentifier=\"+r.data(\"formPersistenceIdentifier\"),a.hideModal()}}),Modal.show(TYPO3.lang[\"formManager.remove_form_title\"],TYPO3.lang[\"formManager.remove_form_message\"],Severity.warning,a)}))}function duplicateFormSetup(e){$(Identifiers.duplicateFormModalTrigger).on(\"click\",(function(t){t.preventDefault();const a=$(t.currentTarget);MultiStepWizard.addSlide(\"duplicate-form-step-1\",TYPO3.lang[\"formManager.duplicateFormWizard.step1.title\"].replace(\"{0}\",a.data(\"formName\")),\"\",Severity.info,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t){let r,o;MultiStepWizard.lockPrevStep(),MultiStepWizard.lockNextStep();const i=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=i.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(e.assert(l.length>0,\"No accessible form storage folders\",1477649539),MultiStepWizard.set(\"formPersistenceIdentifier\",a.data(\"formPersistenceIdentifier\")),MultiStepWizard.set(\"savePath\",l[0].value),l.length>1){o=$('<select id=\"duplicate-form-save-path\" class=\"form-select\" data-identifier=\"duplicateFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(o).append(t)}}r='<div class=\"duplicate-form-modal\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.new_form_name\"]+'</h5><div class=\"mb-3\"><label for=\"duplicate-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\"><input id=\"duplicate-form-name\" class=\"form-control has-error\" data-identifier=\"duplicateFormName\" /></div></div></div>',o&&(r+='<div class=\"mb-3\"><label for=\"duplicate-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(o)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),$(Identifiers.duplicateFormName,i).focus(),$(Identifiers.duplicateFormName,i).on(\"keyup paste\",(function(e){const t=$(event.currentTarget);t.val().length>0?(t.removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",t.val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):(t.addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),n.on(\"click\",(function(){MultiStepWizard.setup.forceSelection=!1,Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null).then((function(e){MultiStepWizard.set(\"confirmationDuplicateFormName\",a.data(\"formName\")),l.length>1?(MultiStepWizard.set(\"savePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",i).val()),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",i).text())):(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",l[0].label)),t.html($(\"<div />\",{class:\"text-center\"}).append(e).prop(\"outerHTML\"))}))}))})),MultiStepWizard.addSlide(\"duplicate-form-step-2\",TYPO3.lang[\"formManager.duplicateFormWizard.step2.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.duplicateFormWizard.step2.progressLabel\"],(function(e,t){Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small).then((function(a){Icons.getIcon(\"actions-tag\",Icons.sizes.small).then((function(r){Icons.getIcon(\"actions-database\",Icons.sizes.small).then((function(o){MultiStepWizard.unlockPrevStep(),MultiStepWizard.unlockNextStep();const i=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let n='<div class=\"new-form-modal\"><div class=\"row\"><div class=\"col\">';n+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.duplicateFormWizard.step2.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\"><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+a+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_copied\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+r+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+o+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormSavePath)+\"</div></div></div></div>\",n+=\"</div></div></div>\",e.html(n),i.focus(),i.on(\"click\",(function(){MultiStepWizard.setup.forceSelection=!1,Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null).then((function(t){e.html($(\"<div />\",{class:\"text-center\"}).append(t).prop(\"outerHTML\"))}))}))}))}))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"duplicate\"),{formName:MultiStepWizard.setup.settings.formName,formPersistenceIdentifier:MultiStepWizard.setup.settings.formPersistenceIdentifier,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorTitle\"],TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),o=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,o).remove(),$(Identifiers.t3Footer,o).remove(),$(Identifiers.moduleBody).html(o.html())}))})).then((function(){MultiStepWizard.show()}))}))}function showReferencesSetup(e){$(Identifiers.showReferences).on(\"click\",(t=>{t.preventDefault();const a=$(t.currentTarget),r=e.getAjaxEndpoint(\"references\")+\"&formPersistenceIdentifier=\"+a.data(\"formPersistenceIdentifier\");$.get(r,(function(e){let t;const r=[];r.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}});if(e.references.length>0){t=\"<div><h3>\"+TYPO3.lang[\"formManager.references.headline\"].replace(\"{0}\",a.data(\"formName\"))+'</h3></div><div class=\"table-fit\"><table id=\"forms\" class=\"table table-striped table-sm\"><thead><tr><th>'+TYPO3.lang[\"formManager.page\"]+\"</th><th>\"+TYPO3.lang[\"formManager.record\"]+\"</th></tr></thead><tbody>\";for(let a=0,r=e.references.length;a<r;++a)t+=\"<tr><td>\"+e.references[a].recordPageTitle+\"</td><td>\"+e.references[a].recordIcon+'<a href=\"'+e.references[a].recordEditUrl+'\" data-identifier=\"referenceLink\">'+e.references[a].recordTitle+\" (uid: \"+e.references[a].recordUid+\")</a></td></tr>\";t+=\"</tbody></table></div>\"}else t=\"<div><h1>\"+TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",e.formPersistenceIdentifier)+\"</h1></div><div>\"+TYPO3.lang[\"formManager.no_references\"]+\"</div>\";t=$(t),$(Identifiers.referenceLink,t).on(\"click\",(function(e){e.preventDefault(),Modal.currentModal.hideModal(),document.location=$(e.currentTarget).prop(\"href\")})),Modal.show(TYPO3.lang[\"formManager.references.title\"],t,Severity.info,r)})).fail((function(e,t,a){0!==e.status&&Notification.error(t,a,2)}))}))}!function(e){e.newFormModalTrigger='[data-identifier=\"newForm\"]',e.duplicateFormModalTrigger='[data-identifier=\"duplicateForm\"]',e.removeFormModalTrigger='[data-identifier=\"removeForm\"]',e.newFormModeButton='[data-identifier=\"newFormModeButton\"]',e.newFormName='[data-identifier=\"newFormName\"]',e.newFormSavePath='[data-identifier=\"newFormSavePath\"]',e.newFormPrototypeName='[data-identifier=\"newFormPrototypeName\"]',e.newFormTemplate='[data-identifier=\"newFormTemplate\"]',e.duplicateFormName='[data-identifier=\"duplicateFormName\"]',e.duplicateFormSavePath='[data-identifier=\"duplicateFormSavePath\"]',e.showReferences='[data-identifier=\"showReferences\"]',e.referenceLink='[data-identifier=\"referenceLink\"]',e.moduleBody=\".module-body.t3js-module-body\",e.t3Logo=\".t3-message-page-logo\",e.t3Footer=\"#t3-footer\"}(Identifiers||(Identifiers={}));export function bootstrap(e){removeFormSetup(e),newFormSetup(e),duplicateFormSetup(e),showReferencesSetup(e)}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "75cd436b036e027f58c2ed53b3b179f12ff1ea7f",
      "candidate_info": {
        "commit_hash": "75cd436b036e027f58c2ed53b3b179f12ff1ea7f",
        "repo": "TYPO3-CMS/form",
        "commit_url": "https://github.com/TYPO3-CMS/form/commit/75cd436b036e027f58c2ed53b3b179f12ff1ea7f",
        "files": [
          "Resources/Private/Backend/Partials/FormEditor/Modals/InsertElements.html",
          "Resources/Private/Backend/Partials/FormEditor/Modals/InsertPages.html",
          "Resources/Public/JavaScript/backend/form-manager/view-model.js"
        ],
        "message": "[BUGFIX] Correct heading hierarchy in various backend modals\n\nResolves: #104046\nReleases: main, 13.4\nChange-Id: Ifc707f0ea03934bc4e05a28ba911da448301f2b0\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/84614\nTested-by: Benni Mack <benni@typo3.org>\nReviewed-by: Jasmina Lie\u00dfmann <minapokhalo+typo3@gmail.com>\nTested-by: core-ci <typo3@b13.com>\nReviewed-by: Benni Mack <benni@typo3.org>\nTested-by: Jasmina Lie\u00dfmann <minapokhalo+typo3@gmail.com>",
        "before_after_code_files": [
          "Resources/Private/Backend/Partials/FormEditor/Modals/InsertElements.html||Resources/Private/Backend/Partials/FormEditor/Modals/InsertElements.html",
          "Resources/Private/Backend/Partials/FormEditor/Modals/InsertPages.html||Resources/Private/Backend/Partials/FormEditor/Modals/InsertPages.html",
          "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
          ],
          "candidate": [
            "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
          ]
        }
      },
      "candidate_diff": {
        "Resources/Private/Backend/Partials/FormEditor/Modals/InsertElements.html||Resources/Private/Backend/Partials/FormEditor/Modals/InsertElements.html": [
          "File: Resources/Private/Backend/Partials/FormEditor/Modals/InsertElements.html -> Resources/Private/Backend/Partials/FormEditor/Modals/InsertElements.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: <div id=\"t3-form-insert-elements-panel\">",
          "3:     <f:for each=\"{insertRenderablesPanelConfiguration}\" as=\"insertRenderablePanelConfiguration\">",
          "4:         <f:if condition=\"{insertRenderablePanelConfiguration.key} != 'page'\">",
          "6:                 <span>{insertRenderablePanelConfiguration.label}</span>",
          "8:             <div class=\"row\">",
          "9:                 <f:for each=\"{insertRenderablePanelConfiguration.elements}\" as=\"element\">",
          "10:                     <div class=\"col-4 mb-3\">",
          "",
          "[Removed Lines]",
          "5:             <h4 class=\"t3-form-group-{insertRenderablePanelConfiguration.key}\">",
          "7:             </h4>",
          "",
          "[Added Lines]",
          "5:             <h2 class=\"h3 t3-form-group-{insertRenderablePanelConfiguration.key}\">",
          "7:             </h2>",
          "",
          "---------------"
        ],
        "Resources/Private/Backend/Partials/FormEditor/Modals/InsertPages.html||Resources/Private/Backend/Partials/FormEditor/Modals/InsertPages.html": [
          "File: Resources/Private/Backend/Partials/FormEditor/Modals/InsertPages.html -> Resources/Private/Backend/Partials/FormEditor/Modals/InsertPages.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: <div id=\"t3-form-insert-pages-panel\">",
          "3:     <f:for each=\"{insertRenderablesPanelConfiguration}\" as=\"insertRenderablePanelConfiguration\">",
          "4:         <f:if condition=\"{insertRenderablePanelConfiguration.key} == 'page'\">",
          "6:                 <span>{insertRenderablePanelConfiguration.label}</span>",
          "8:             <div class=\"row\">",
          "9:                 <f:for each=\"{insertRenderablePanelConfiguration.elements}\" as=\"element\">",
          "10:                     <div class=\"col-sm-4\">",
          "",
          "[Removed Lines]",
          "5:             <h3 class=\"t3-form-group-{insertRenderablePanelConfiguration.key}\">",
          "7:             </h3>",
          "",
          "[Added Lines]",
          "5:             <h2 class=\"h3 t3-form-group-{insertRenderablePanelConfiguration.key}\">",
          "7:             </h2>",
          "",
          "---------------"
        ],
        "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js": [
          "File: Resources/Public/JavaScript/backend/form-manager/view-model.js -> Resources/Public/JavaScript/backend/form-manager/view-model.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "13: import $ from\"jquery\";import Modal from\"@typo3/backend/modal.js\";import Severity from\"@typo3/backend/severity.js\";import MultiStepWizard from\"@typo3/backend/multi-step-wizard.js\";import Icons from\"@typo3/backend/icons.js\";import Notification from\"@typo3/backend/notification.js\";import SecurityUtility from\"@typo3/core/security-utility.js\";import{selector}from\"@typo3/core/literals.js\";import SortableTable from\"@typo3/backend/sortable-table.js\";const securityUtility=new SecurityUtility;var Identifiers;function newFormSetup(e){$(Identifiers.newFormModalTrigger).on(\"click\",(function(t){t.preventDefault(),MultiStepWizard.addSlide(\"new-form-step-1\",TYPO3.lang[\"formManager.newFormWizard.step1.title\"],\"\",Severity.notice,TYPO3.lang[\"formManager.newFormWizard.step1.progressLabel\"],(async function(t){const a=await Icons.getIcon(\"actions-plus\",Icons.sizes.small),r=await Icons.getIcon(\"form-page\",Icons.sizes.large),i=await Icons.getIcon(\"apps-pagetree-page-default\",Icons.sizes.large);let o;const n=MultiStepWizard.setup.$carousel.closest(\".modal\"),l=n.find(\".modal-footer\").find('button[name=\"next\"]');MultiStepWizard.blurCancelStep(),MultiStepWizard.lockNextStep(),MultiStepWizard.lockPrevStep();0===e.getAccessibleFormStorageFolders().length&&(o='<div class=\"new-form-modal\"><div class=\"row\"><label class=\"col col-form-label\">'+TYPO3.lang[\"formManager.newFormWizard.step1.noStorages\"]+\"</label></div></div>\",t.html(o),e.assert(!1,\"No accessible form storage folders\",1477506500)),o='<div class=\"new-form-modal\">',o+='<div class=\"card-container\"><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+i+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.blankForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.blankForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.blankForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-default\" data-inline=\"1\" value=\"blank\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.blankForm.label\"]+'</button></div></div><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+r+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.predefinedForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.predefinedForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-default\" data-inline=\"1\" value=\"predefined\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</button></div></div>\",o+=\"</div>\",t.html(o),$(Identifiers.newFormModeButton,n).on(\"click\",(function(e){MultiStepWizard.set(\"newFormMode\",$(e.currentTarget).val()),MultiStepWizard.next()})),l.on(\"click\",(async function(){t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-2\",TYPO3.lang[\"formManager.newFormWizard.step2.title\"],\"\",Severity.notice,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t,a){let r,i;MultiStepWizard.lockNextStep(),MultiStepWizard.unlockPrevStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(a.savePath||(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"savePathName\",l[0].label)),l.length>1){i=$('<select class=\"new-form-save-path form-select\" id=\"new-form-save-path\" data-identifier=\"newFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}const s=e.getPrototypes();e.assert(s.length>0,\"No prototypes available\",1477506501),a.prototypeName||(MultiStepWizard.set(\"prototypeName\",s[0].value),MultiStepWizard.set(\"prototypeNameName\",s[0].label));const d=$('<select class=\"new-form-prototype-name form-select\" id=\"new-form-prototype-name\" data-identifier=\"newFormPrototypeName\" />');for(let e=0,t=s.length;e<t;++e){const t=new Option(s[e].label,s[e].value);$(d).append(t)}let c=e.getTemplatesForPrototype(s[0].value);e.assert(c.length>0,\"No templates available\",1477506502),a.templatePath||(MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label));const m=$('<select class=\"new-form-template form-select\" id=\"new-form-template\" data-identifier=\"newFormTemplate\" />');for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(m).append(t)}r='<div class=\"new-form-modal\">',\"blank\"===a.newFormMode?(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.blankForm.label\"]+\"</h5>\",MultiStepWizard.set(\"templatePath\",\"EXT:form/Resources/Private/Backend/Templates/FormEditor/Yaml/NewForms/BlankForm.yaml\"),MultiStepWizard.set(\"templatePathName\",TYPO3.lang[\"formManager.blankForm.label\"])):(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</h5>\",s.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-prototype-name\"><strong>'+TYPO3.lang[\"formManager.form_prototype\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-control-wrap\">'+$(d)[0].outerHTML+\"</div></div></div>\"),c.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-template\"><strong>'+TYPO3.lang[\"formManager.form_template\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_template_description\"]+'</div><div class=\"form-control-wrap\">'+$(m)[0].outerHTML+\"</div></div></div>\")),r+='<div class=\"mb-3\"><label for=\"new-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\">',a.formName?(r+='<input class=\"form-control\" id=\"new-form-name\" data-identifier=\"newFormName\" value=\"'+securityUtility.encodeHtml(a.formName)+'\" />',setTimeout((function(){MultiStepWizard.unlockNextStep()}),200)):r+='<input class=\"form-control has-error\" id=\"new-form-name\" data-identifier=\"newFormName\" />',r+=\"</div></div></div>\",i&&(r+='<div class=\"mb-3\"><label for=\"new-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),a.savePath&&$(Identifiers.newFormSavePath,o).val(a.savePath),a.templatePath&&$(Identifiers.newFormTemplate,o).val(a.templatePath),s.length>1?$(Identifiers.newFormPrototypeName,o).focus():c.length>1&&$(Identifiers.newFormTemplate,o).focus();const p=function(){$(Identifiers.newFormTemplate,o).on(\"change\",(function(){MultiStepWizard.set(\"templatePath\",$(Identifiers.newFormTemplate+\" option:selected\",o).val()),MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),MultiStepWizard.set(\"templatePathOnPrev\",$(Identifiers.newFormTemplate+\" option:selected\",o).val())}))};$(Identifiers.newFormPrototypeName,o).on(\"change\",(function(t){MultiStepWizard.set(\"prototypeName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).val()),MultiStepWizard.set(\"prototypeNameName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).text()),c=e.getTemplatesForPrototype($(t.currentTarget).val()),$(Identifiers.newFormTemplate,o).off().empty();for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(Identifiers.newFormTemplate,o).append(t),MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label)}p()})),p(),a.prototypeName&&($(Identifiers.newFormPrototypeName,o).val(a.prototypeName),$(Identifiers.newFormPrototypeName,o).trigger(\"change\"),a.templatePathOnPrev&&($(Identifiers.newFormTemplate,o).find(selector`option[value=\"${a.templatePathOnPrev}\"]`).prop(\"selected\",!0),$(Identifiers.newFormTemplate,o).trigger(\"change\"))),$(Identifiers.newFormName,o).focus(),$(Identifiers.newFormName,o).on(\"keyup paste\",(function(e){$(e.currentTarget).val().length>0?($(e.currentTarget).removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",$(e.currentTarget).val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):($(e.currentTarget).addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),$(Identifiers.newFormSavePath,o).on(\"change\",(function(){MultiStepWizard.set(\"savePath\",$(Identifiers.newFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"savePathName\",$(Identifiers.newFormSavePath+\" option:selected\",o).text())})),\"blank\"===a.newFormMode||a.templatePathName||MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-3\",TYPO3.lang[\"formManager.newFormWizard.step3.title\"],\"\",Severity.notice,TYPO3.lang[\"formManager.newFormWizard.step3.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-cog\",Icons.sizes.small),r=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),i=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),o=await Icons.getIcon(\"actions-database\",Icons.sizes.small),n=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let l='<div class=\"new-form-modal\">';l+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.newFormWizard.step3.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\">',t.prototypeNameName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+a+\" \"+TYPO3.lang[\"formManager.form_prototype\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.prototypeNameName)+\"</div></div>\"),t.templatePathName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+r+\" \"+TYPO3.lang[\"formManager.form_template\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.templatePathName)+\"</div></div>\"),l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+i+\" \"+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"row my-1\"><div class=\"col col-sm-6\">'+o+\" \"+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.savePathName)+\"</div></div>\",l+=\"</div></div>\",e.html(l),n.focus(),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"create\"),{formName:MultiStepWizard.setup.settings.formName,templatePath:MultiStepWizard.setup.settings.templatePath,prototypeName:MultiStepWizard.setup.settings.prototypeName,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.newFormWizard.step4.errorTitle\"],TYPO3.lang[\"formManager.newFormWizard.step4.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function removeFormSetup(e){$(Identifiers.removeFormModalTrigger).on(\"click\",(function(t){const a=[];t.preventDefault();const r=$(t.currentTarget);a.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}}),a.push({text:TYPO3.lang[\"formManager.remove_form\"],active:!0,btnClass:\"btn-danger\",name:\"createform\",trigger:function(t,a){document.location=e.getAjaxEndpoint(\"delete\")+\"&formPersistenceIdentifier=\"+r.data(\"formPersistenceIdentifier\"),a.hideModal()}}),Modal.show(TYPO3.lang[\"formManager.remove_form_title\"],TYPO3.lang[\"formManager.remove_form_message\"].replace(\"{0}\",r.data(\"formName\")),Severity.error,a)}))}function duplicateFormSetup(e){$(Identifiers.duplicateFormModalTrigger).on(\"click\",(function(t){t.preventDefault();const a=$(t.currentTarget);MultiStepWizard.addSlide(\"duplicate-form-step-1\",TYPO3.lang[\"formManager.duplicateFormWizard.step1.title\"].replace(\"{0}\",a.data(\"formName\")),\"\",Severity.notice,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t){let r,i;MultiStepWizard.lockPrevStep(),MultiStepWizard.lockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(e.assert(l.length>0,\"No accessible form storage folders\",1477649539),MultiStepWizard.set(\"formPersistenceIdentifier\",a.data(\"formPersistenceIdentifier\")),MultiStepWizard.set(\"savePath\",l[0].value),l.length>1){i=$('<select id=\"duplicate-form-save-path\" class=\"form-select\" data-identifier=\"duplicateFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}r='<div class=\"duplicate-form-modal\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.new_form_name\"]+'</h5><div class=\"mb-3\"><label for=\"duplicate-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\"><input id=\"duplicate-form-name\" class=\"form-control has-error\" data-identifier=\"duplicateFormName\" /></div></div></div>',i&&(r+='<div class=\"mb-3\"><label for=\"duplicate-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),$(Identifiers.duplicateFormName,o).focus(),$(Identifiers.duplicateFormName,o).on(\"keyup paste\",(function(e){const t=$(event.currentTarget);t.val().length>0?(t.removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",t.val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):(t.addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,MultiStepWizard.set(\"confirmationDuplicateFormName\",a.data(\"formName\")),l.length>1?(MultiStepWizard.set(\"savePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).text())):(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",l[0].label)),t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"duplicate-form-step-2\",TYPO3.lang[\"formManager.duplicateFormWizard.step2.title\"],\"\",Severity.notice,TYPO3.lang[\"formManager.duplicateFormWizard.step2.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),r=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),i=await Icons.getIcon(\"actions-database\",Icons.sizes.small);MultiStepWizard.unlockPrevStep(),MultiStepWizard.unlockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let n='<div class=\"new-form-modal\"><div class=\"row\"><div class=\"col\">';n+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.duplicateFormWizard.step2.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+a+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_copied\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+r+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+i+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormSavePath)+\"</div></div></div>\",n+=\"</div></div></div>\",e.html(n),o.focus(),o.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"duplicate\"),{formName:MultiStepWizard.setup.settings.formName,formPersistenceIdentifier:MultiStepWizard.setup.settings.formPersistenceIdentifier,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorTitle\"],TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function showReferencesSetup(e){$(Identifiers.showReferences).on(\"click\",(t=>{t.preventDefault();const a=$(t.currentTarget),r=e.getAjaxEndpoint(\"references\")+\"&formPersistenceIdentifier=\"+a.data(\"formPersistenceIdentifier\");$.get(r,(async function(e){let t;const r=[];r.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}});const i=e.references.length,o=await Icons.getIcon(\"actions-open\",Icons.sizes.small);if(i>0){t=\"<div><h3>\"+TYPO3.lang[\"formManager.references.headline\"].replace(\"{0}\",securityUtility.encodeHtml(a.data(\"formName\")))+'</h3></div><div class=\"table-fit\"><table id=\"forms\" class=\"table table-striped table-hover\"><thead><tr><th class=\"col-icon\"></th><th class=\"col-recordtitle\">'+TYPO3.lang[\"formManager.table.field.title\"]+\"</th><th>\"+TYPO3.lang[\"formManager.table.field.uid\"]+'</th><th class=\"col-control nowrap\"><span class=\"visually-hidden\">'+TYPO3.lang[\"formManager.table.field._CONTROL_\"]+\"</span></th></tr></thead><tbody>\";for(let a=0,r=e.references.length;a<r;++a)t+='<tr><td class=\"col-icon\">'+e.references[a].recordIcon+'</td><td class=\"col-recordtitle\"><a href=\"'+securityUtility.encodeHtml(e.references[a].recordEditUrl)+'\" data-identifier=\"referenceLink\">'+securityUtility.encodeHtml(e.references[a].recordTitle)+\"</a></td><td>\"+securityUtility.encodeHtml(e.references[a].recordUid)+'</td><td class=\"col-control\"><div class=\"btn-group\" role=\"group\"><a href=\"'+securityUtility.encodeHtml(e.references[a].recordEditUrl)+'\" data-identifier=\"referenceLink\" class=\"btn btn-default\" title=\"'+TYPO3.lang[\"formManager.btn.edit.title\"]+'\">'+o+\"</a></div></td></tr>\";t+=\"</tbody></table></div>\"}else t=\"<div><h1>\"+TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",securityUtility.encodeHtml(e.formPersistenceIdentifier))+\"</h1></div><div>\"+TYPO3.lang[\"formManager.no_references\"]+\"</div>\";t=$(t),$(Identifiers.referenceLink,t).on(\"click\",(function(e){e.preventDefault(),Modal.currentModal.hideModal(),document.location=$(e.currentTarget).prop(\"href\")})),Modal.show(TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",a.data(\"formName\")),t,Severity.notice,r)})).fail((function(e,t,a){0!==e.status&&Notification.error(t,a,2)}))}))}function initializeSortable(){const e=document.querySelector(Identifiers.formsTable);null!==e&&new SortableTable(e)}!function(e){e.newFormModalTrigger='[data-identifier=\"newForm\"]',e.duplicateFormModalTrigger='[data-identifier=\"duplicateForm\"]',e.removeFormModalTrigger='[data-identifier=\"removeForm\"]',e.newFormModeButton='[data-identifier=\"newFormModeButton\"]',e.newFormName='[data-identifier=\"newFormName\"]',e.newFormSavePath='[data-identifier=\"newFormSavePath\"]',e.newFormPrototypeName='[data-identifier=\"newFormPrototypeName\"]',e.newFormTemplate='[data-identifier=\"newFormTemplate\"]',e.duplicateFormName='[data-identifier=\"duplicateFormName\"]',e.duplicateFormSavePath='[data-identifier=\"duplicateFormSavePath\"]',e.showReferences='[data-identifier=\"showReferences\"]',e.referenceLink='[data-identifier=\"referenceLink\"]',e.moduleBody=\".module-body.t3js-module-body\",e.t3Logo=\".t3-message-page-logo\",e.t3Footer=\"#t3-footer\",e.formsTable=\"#forms\"}(Identifiers||(Identifiers={}));export function bootstrap(e){removeFormSetup(e),newFormSetup(e),duplicateFormSetup(e),showReferencesSetup(e),initializeSortable()}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5705f9bef38d477d6bf7c3ca98d8ef1b55391c81",
      "candidate_info": {
        "commit_hash": "5705f9bef38d477d6bf7c3ca98d8ef1b55391c81",
        "repo": "TYPO3-CMS/form",
        "commit_url": "https://github.com/TYPO3-CMS/form/commit/5705f9bef38d477d6bf7c3ca98d8ef1b55391c81",
        "files": [
          "Resources/Public/JavaScript/backend/form-manager/view-model.js"
        ],
        "message": "[TASK] Add methods to switch MSW steps programatically\n\nThe module `@typo3/backend/multi-step-wizard` now has two additional\nmethods to allow switching to the previous or next step programatically:\n\n* `previous()`\n* `next()`\n\nThe current jQuery hack in EXT:form's wizard is now using the introduced\n`next()` version.\n\nResolves: #103280\nReleases: main\nChange-Id: I50e6e3f499ddbf50a912bc6f5b7d2c557c45e9b5\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/83210\nTested-by: Simon Schaufelberger <simonschaufi+typo3@gmail.com>\nTested-by: Andreas Nedbal <andy@pixelde.su>\nReviewed-by: Andreas Kienast <a.fernandez@scripting-base.de>\nTested-by: Andreas Kienast <a.fernandez@scripting-base.de>\nTested-by: core-ci <typo3@b13.com>\nReviewed-by: Simon Schaufelberger <simonschaufi+typo3@gmail.com>\nReviewed-by: Andreas Nedbal <andy@pixelde.su>",
        "before_after_code_files": [
          "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
          ],
          "candidate": [
            "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
          ]
        }
      },
      "candidate_diff": {
        "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js": [
          "File: Resources/Public/JavaScript/backend/form-manager/view-model.js -> Resources/Public/JavaScript/backend/form-manager/view-model.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "13: import $ from\"jquery\";import Modal from\"@typo3/backend/modal.js\";import Severity from\"@typo3/backend/severity.js\";import MultiStepWizard from\"@typo3/backend/multi-step-wizard.js\";import Icons from\"@typo3/backend/icons.js\";import Notification from\"@typo3/backend/notification.js\";import SecurityUtility from\"@typo3/core/security-utility.js\";import{selector}from\"@typo3/core/literals.js\";const securityUtility=new SecurityUtility;var Identifiers;function newFormSetup(e){$(Identifiers.newFormModalTrigger).on(\"click\",(function(t){t.preventDefault(),MultiStepWizard.addSlide(\"new-form-step-1\",TYPO3.lang[\"formManager.newFormWizard.step1.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.newFormWizard.step1.progressLabel\"],(async function(t){const a=await Icons.getIcon(\"actions-plus\",Icons.sizes.small),r=await Icons.getIcon(\"form-page\",Icons.sizes.large),i=await Icons.getIcon(\"apps-pagetree-page-default\",Icons.sizes.large);let o;const n=MultiStepWizard.setup.$carousel.closest(\".modal\"),l=n.find(\".modal-footer\").find('button[name=\"next\"]');MultiStepWizard.blurCancelStep(),MultiStepWizard.lockNextStep(),MultiStepWizard.lockPrevStep();0===e.getAccessibleFormStorageFolders().length&&(o='<div class=\"new-form-modal\"><div class=\"row\"><label class=\"col col-form-label\">'+TYPO3.lang[\"formManager.newFormWizard.step1.noStorages\"]+\"</label></div></div>\",t.html(o),e.assert(!1,\"No accessible form storage folders\",1477506500)),o='<div class=\"new-form-modal\">',o+='<div class=\"card-container\"><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+i+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.blankForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.blankForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.blankForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-success\" data-inline=\"1\" value=\"blank\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.blankForm.label\"]+'</button></div></div><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+r+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.predefinedForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.predefinedForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-success\" data-inline=\"1\" value=\"predefined\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</button></div></div>\",o+=\"</div>\",t.html(o),$(Identifiers.newFormModeButton,n).on(\"click\",(function(e){MultiStepWizard.set(\"newFormMode\",$(e.currentTarget).val()),MultiStepWizard.unlockNextStep().get(0).click()})),l.on(\"click\",(async function(){t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-2\",TYPO3.lang[\"formManager.newFormWizard.step2.title\"],\"\",Severity.info,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t,a){let r,i;MultiStepWizard.lockNextStep(),MultiStepWizard.unlockPrevStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(a.savePath||(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"savePathName\",l[0].label)),l.length>1){i=$('<select class=\"new-form-save-path form-select\" id=\"new-form-save-path\" data-identifier=\"newFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}const s=e.getPrototypes();e.assert(s.length>0,\"No prototypes available\",1477506501),a.prototypeName||(MultiStepWizard.set(\"prototypeName\",s[0].value),MultiStepWizard.set(\"prototypeNameName\",s[0].label));const d=$('<select class=\"new-form-prototype-name form-select\" id=\"new-form-prototype-name\" data-identifier=\"newFormPrototypeName\" />');for(let e=0,t=s.length;e<t;++e){const t=new Option(s[e].label,s[e].value);$(d).append(t)}let c=e.getTemplatesForPrototype(s[0].value);e.assert(c.length>0,\"No templates available\",1477506502),a.templatePath||(MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label));const m=$('<select class=\"new-form-template form-select\" id=\"new-form-template\" data-identifier=\"newFormTemplate\" />');for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(m).append(t)}r='<div class=\"new-form-modal\">',\"blank\"===a.newFormMode?(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.blankForm.label\"]+\"</h5>\",MultiStepWizard.set(\"templatePath\",\"EXT:form/Resources/Private/Backend/Templates/FormEditor/Yaml/NewForms/BlankForm.yaml\"),MultiStepWizard.set(\"templatePathName\",TYPO3.lang[\"formManager.blankForm.label\"])):(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</h5>\",s.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-prototype-name\"><strong>'+TYPO3.lang[\"formManager.form_prototype\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-control-wrap\">'+$(d)[0].outerHTML+\"</div></div></div>\"),c.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-template\"><strong>'+TYPO3.lang[\"formManager.form_template\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_template_description\"]+'</div><div class=\"form-control-wrap\">'+$(m)[0].outerHTML+\"</div></div></div>\")),r+='<div class=\"mb-3\"><label for=\"new-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\">',a.formName?(r+='<input class=\"form-control\" id=\"new-form-name\" data-identifier=\"newFormName\" value=\"'+securityUtility.encodeHtml(a.formName)+'\" />',setTimeout((function(){MultiStepWizard.unlockNextStep()}),200)):r+='<input class=\"form-control has-error\" id=\"new-form-name\" data-identifier=\"newFormName\" />',r+=\"</div></div></div>\",i&&(r+='<div class=\"mb-3\"><label for=\"new-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),a.savePath&&$(Identifiers.newFormSavePath,o).val(a.savePath),a.templatePath&&$(Identifiers.newFormTemplate,o).val(a.templatePath),s.length>1?$(Identifiers.newFormPrototypeName,o).focus():c.length>1&&$(Identifiers.newFormTemplate,o).focus();const p=function(){$(Identifiers.newFormTemplate,o).on(\"change\",(function(){MultiStepWizard.set(\"templatePath\",$(Identifiers.newFormTemplate+\" option:selected\",o).val()),MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),MultiStepWizard.set(\"templatePathOnPrev\",$(Identifiers.newFormTemplate+\" option:selected\",o).val())}))};$(Identifiers.newFormPrototypeName,o).on(\"change\",(function(t){MultiStepWizard.set(\"prototypeName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).val()),MultiStepWizard.set(\"prototypeNameName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).text()),c=e.getTemplatesForPrototype($(t.currentTarget).val()),$(Identifiers.newFormTemplate,o).off().empty();for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(Identifiers.newFormTemplate,o).append(t),MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label)}p()})),p(),a.prototypeName&&($(Identifiers.newFormPrototypeName,o).val(a.prototypeName),$(Identifiers.newFormPrototypeName,o).trigger(\"change\"),a.templatePathOnPrev&&($(Identifiers.newFormTemplate,o).find(selector`option[value=\"${a.templatePathOnPrev}\"]`).prop(\"selected\",!0),$(Identifiers.newFormTemplate,o).trigger(\"change\"))),$(Identifiers.newFormName,o).focus(),$(Identifiers.newFormName,o).on(\"keyup paste\",(function(e){$(e.currentTarget).val().length>0?($(e.currentTarget).removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",$(e.currentTarget).val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):($(e.currentTarget).addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),$(Identifiers.newFormSavePath,o).on(\"change\",(function(){MultiStepWizard.set(\"savePath\",$(Identifiers.newFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"savePathName\",$(Identifiers.newFormSavePath+\" option:selected\",o).text())})),\"blank\"===a.newFormMode||a.templatePathName||MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-3\",TYPO3.lang[\"formManager.newFormWizard.step3.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.newFormWizard.step3.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-cog\",Icons.sizes.small),r=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),i=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),o=await Icons.getIcon(\"actions-database\",Icons.sizes.small),n=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let l='<div class=\"new-form-modal\">';l+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.newFormWizard.step3.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\">',t.prototypeNameName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+a+\" \"+TYPO3.lang[\"formManager.form_prototype\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.prototypeNameName)+\"</div></div>\"),t.templatePathName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+r+\" \"+TYPO3.lang[\"formManager.form_template\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.templatePathName)+\"</div></div>\"),l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+i+\" \"+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"row my-1\"><div class=\"col col-sm-6\">'+o+\" \"+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.savePathName)+\"</div></div>\",l+=\"</div></div></div>\",e.html(l),n.focus(),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"create\"),{formName:MultiStepWizard.setup.settings.formName,templatePath:MultiStepWizard.setup.settings.templatePath,prototypeName:MultiStepWizard.setup.settings.prototypeName,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.newFormWizard.step4.errorTitle\"],TYPO3.lang[\"formManager.newFormWizard.step4.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function removeFormSetup(e){$(Identifiers.removeFormModalTrigger).on(\"click\",(function(t){const a=[];t.preventDefault();const r=$(t.currentTarget);a.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}}),a.push({text:TYPO3.lang[\"formManager.remove_form\"],active:!0,btnClass:\"btn-warning\",name:\"createform\",trigger:function(t,a){document.location=e.getAjaxEndpoint(\"delete\")+\"&formPersistenceIdentifier=\"+r.data(\"formPersistenceIdentifier\"),a.hideModal()}}),Modal.show(TYPO3.lang[\"formManager.remove_form_title\"],TYPO3.lang[\"formManager.remove_form_message\"],Severity.warning,a)}))}function duplicateFormSetup(e){$(Identifiers.duplicateFormModalTrigger).on(\"click\",(function(t){t.preventDefault();const a=$(t.currentTarget);MultiStepWizard.addSlide(\"duplicate-form-step-1\",TYPO3.lang[\"formManager.duplicateFormWizard.step1.title\"].replace(\"{0}\",a.data(\"formName\")),\"\",Severity.info,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t){let r,i;MultiStepWizard.lockPrevStep(),MultiStepWizard.lockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(e.assert(l.length>0,\"No accessible form storage folders\",1477649539),MultiStepWizard.set(\"formPersistenceIdentifier\",a.data(\"formPersistenceIdentifier\")),MultiStepWizard.set(\"savePath\",l[0].value),l.length>1){i=$('<select id=\"duplicate-form-save-path\" class=\"form-select\" data-identifier=\"duplicateFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}r='<div class=\"duplicate-form-modal\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.new_form_name\"]+'</h5><div class=\"mb-3\"><label for=\"duplicate-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\"><input id=\"duplicate-form-name\" class=\"form-control has-error\" data-identifier=\"duplicateFormName\" /></div></div></div>',i&&(r+='<div class=\"mb-3\"><label for=\"duplicate-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),$(Identifiers.duplicateFormName,o).focus(),$(Identifiers.duplicateFormName,o).on(\"keyup paste\",(function(e){const t=$(event.currentTarget);t.val().length>0?(t.removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",t.val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):(t.addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,MultiStepWizard.set(\"confirmationDuplicateFormName\",a.data(\"formName\")),l.length>1?(MultiStepWizard.set(\"savePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).text())):(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",l[0].label)),t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"duplicate-form-step-2\",TYPO3.lang[\"formManager.duplicateFormWizard.step2.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.duplicateFormWizard.step2.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),r=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),i=await Icons.getIcon(\"actions-database\",Icons.sizes.small);MultiStepWizard.unlockPrevStep(),MultiStepWizard.unlockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let n='<div class=\"new-form-modal\"><div class=\"row\"><div class=\"col\">';n+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.duplicateFormWizard.step2.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\"><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+a+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_copied\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+r+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+i+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormSavePath)+\"</div></div></div></div>\",n+=\"</div></div></div>\",e.html(n),o.focus(),o.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"duplicate\"),{formName:MultiStepWizard.setup.settings.formName,formPersistenceIdentifier:MultiStepWizard.setup.settings.formPersistenceIdentifier,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorTitle\"],TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function showReferencesSetup(e){$(Identifiers.showReferences).on(\"click\",(t=>{t.preventDefault();const a=$(t.currentTarget),r=e.getAjaxEndpoint(\"references\")+\"&formPersistenceIdentifier=\"+a.data(\"formPersistenceIdentifier\");$.get(r,(function(e){let t;const r=[];r.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}});if(e.references.length>0){t=\"<div><h3>\"+TYPO3.lang[\"formManager.references.headline\"].replace(\"{0}\",a.data(\"formName\"))+'</h3></div><div class=\"table-fit\"><table id=\"forms\" class=\"table table-striped table-sm\"><thead><tr><th>'+TYPO3.lang[\"formManager.page\"]+\"</th><th>\"+TYPO3.lang[\"formManager.record\"]+\"</th></tr></thead><tbody>\";for(let a=0,r=e.references.length;a<r;++a)t+=\"<tr><td>\"+e.references[a].recordPageTitle+\"</td><td>\"+e.references[a].recordIcon+'<a href=\"'+e.references[a].recordEditUrl+'\" data-identifier=\"referenceLink\">'+e.references[a].recordTitle+\" (uid: \"+e.references[a].recordUid+\")</a></td></tr>\";t+=\"</tbody></table></div>\"}else t=\"<div><h1>\"+TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",e.formPersistenceIdentifier)+\"</h1></div><div>\"+TYPO3.lang[\"formManager.no_references\"]+\"</div>\";t=$(t),$(Identifiers.referenceLink,t).on(\"click\",(function(e){e.preventDefault(),Modal.currentModal.hideModal(),document.location=$(e.currentTarget).prop(\"href\")})),Modal.show(TYPO3.lang[\"formManager.references.title\"],t,Severity.info,r)})).fail((function(e,t,a){0!==e.status&&Notification.error(t,a,2)}))}))}!function(e){e.newFormModalTrigger='[data-identifier=\"newForm\"]',e.duplicateFormModalTrigger='[data-identifier=\"duplicateForm\"]',e.removeFormModalTrigger='[data-identifier=\"removeForm\"]',e.newFormModeButton='[data-identifier=\"newFormModeButton\"]',e.newFormName='[data-identifier=\"newFormName\"]',e.newFormSavePath='[data-identifier=\"newFormSavePath\"]',e.newFormPrototypeName='[data-identifier=\"newFormPrototypeName\"]',e.newFormTemplate='[data-identifier=\"newFormTemplate\"]',e.duplicateFormName='[data-identifier=\"duplicateFormName\"]',e.duplicateFormSavePath='[data-identifier=\"duplicateFormSavePath\"]',e.showReferences='[data-identifier=\"showReferences\"]',e.referenceLink='[data-identifier=\"referenceLink\"]',e.moduleBody=\".module-body.t3js-module-body\",e.t3Logo=\".t3-message-page-logo\",e.t3Footer=\"#t3-footer\"}(Identifiers||(Identifiers={}));export function bootstrap(e){removeFormSetup(e),newFormSetup(e),duplicateFormSetup(e),showReferencesSetup(e)}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "9cb6a9e63c0497ba6de31e47c39b5fe35ce1fdf6",
      "candidate_info": {
        "commit_hash": "9cb6a9e63c0497ba6de31e47c39b5fe35ce1fdf6",
        "repo": "TYPO3-CMS/form",
        "commit_url": "https://github.com/TYPO3-CMS/form/commit/9cb6a9e63c0497ba6de31e47c39b5fe35ce1fdf6",
        "files": [
          "Resources/Public/JavaScript/backend/form-manager/view-model.js"
        ],
        "message": "[TASK] Make alerts context aware\n\nWe are dropping the Bootstrap CSS definitions for\nalerts to have more control about the styling of\nthe alerts. From now on we are shipping custom\ncss adapted to our needs. The new alert styling\nis context aware and adapts to light and dark\ncolor schemes.\n\nResolves: #104374\nReleases: main\nChange-Id: I3d2f06a638eccb42acef19ff760f5c453627a484\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/85225\nTested-by: core-ci <typo3@b13.com>\nTested-by: Benjamin Franzke <ben@bnf.dev>\nTested-by: Andreas Kienast <a.fernandez@scripting-base.de>\nReviewed-by: Andreas Kienast <a.fernandez@scripting-base.de>\nReviewed-by: Benjamin Franzke <ben@bnf.dev>",
        "before_after_code_files": [
          "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
          ],
          "candidate": [
            "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
          ]
        }
      },
      "candidate_diff": {
        "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js": [
          "File: Resources/Public/JavaScript/backend/form-manager/view-model.js -> Resources/Public/JavaScript/backend/form-manager/view-model.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "13: import $ from\"jquery\";import Modal from\"@typo3/backend/modal.js\";import Severity from\"@typo3/backend/severity.js\";import MultiStepWizard from\"@typo3/backend/multi-step-wizard.js\";import Icons from\"@typo3/backend/icons.js\";import Notification from\"@typo3/backend/notification.js\";import SecurityUtility from\"@typo3/core/security-utility.js\";import{selector}from\"@typo3/core/literals.js\";import SortableTable from\"@typo3/backend/sortable-table.js\";const securityUtility=new SecurityUtility;var Identifiers;function newFormSetup(e){$(Identifiers.newFormModalTrigger).on(\"click\",(function(t){t.preventDefault(),MultiStepWizard.addSlide(\"new-form-step-1\",TYPO3.lang[\"formManager.newFormWizard.step1.title\"],\"\",Severity.notice,TYPO3.lang[\"formManager.newFormWizard.step1.progressLabel\"],(async function(t){const a=await Icons.getIcon(\"actions-plus\",Icons.sizes.small),r=await Icons.getIcon(\"form-page\",Icons.sizes.large),i=await Icons.getIcon(\"apps-pagetree-page-default\",Icons.sizes.large);let o;const n=MultiStepWizard.setup.$carousel.closest(\".modal\"),l=n.find(\".modal-footer\").find('button[name=\"next\"]');MultiStepWizard.blurCancelStep(),MultiStepWizard.lockNextStep(),MultiStepWizard.lockPrevStep();0===e.getAccessibleFormStorageFolders().length&&(o='<div class=\"new-form-modal\"><div class=\"row\"><label class=\"col col-form-label\">'+TYPO3.lang[\"formManager.newFormWizard.step1.noStorages\"]+\"</label></div></div>\",t.html(o),e.assert(!1,\"No accessible form storage folders\",1477506500)),o='<div class=\"new-form-modal\">',o+='<div class=\"card-container\"><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+i+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.blankForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.blankForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.blankForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-default\" data-inline=\"1\" value=\"blank\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.blankForm.label\"]+'</button></div></div><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+r+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.predefinedForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.predefinedForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-default\" data-inline=\"1\" value=\"predefined\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</button></div></div>\",o+=\"</div>\",t.html(o),$(Identifiers.newFormModeButton,n).on(\"click\",(function(e){MultiStepWizard.set(\"newFormMode\",$(e.currentTarget).val()),MultiStepWizard.next()})),l.on(\"click\",(async function(){t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-2\",TYPO3.lang[\"formManager.newFormWizard.step2.title\"],\"\",Severity.notice,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t,a){let r,i;MultiStepWizard.lockNextStep(),MultiStepWizard.unlockPrevStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(a.savePath||(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"savePathName\",l[0].label)),l.length>1){i=$('<select class=\"new-form-save-path form-select\" id=\"new-form-save-path\" data-identifier=\"newFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}const s=e.getPrototypes();e.assert(s.length>0,\"No prototypes available\",1477506501),a.prototypeName||(MultiStepWizard.set(\"prototypeName\",s[0].value),MultiStepWizard.set(\"prototypeNameName\",s[0].label));const d=$('<select class=\"new-form-prototype-name form-select\" id=\"new-form-prototype-name\" data-identifier=\"newFormPrototypeName\" />');for(let e=0,t=s.length;e<t;++e){const t=new Option(s[e].label,s[e].value);$(d).append(t)}let c=e.getTemplatesForPrototype(s[0].value);e.assert(c.length>0,\"No templates available\",1477506502),a.templatePath||(MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label));const m=$('<select class=\"new-form-template form-select\" id=\"new-form-template\" data-identifier=\"newFormTemplate\" />');for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(m).append(t)}r='<div class=\"new-form-modal\">',\"blank\"===a.newFormMode?(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.blankForm.label\"]+\"</h5>\",MultiStepWizard.set(\"templatePath\",\"EXT:form/Resources/Private/Backend/Templates/FormEditor/Yaml/NewForms/BlankForm.yaml\"),MultiStepWizard.set(\"templatePathName\",TYPO3.lang[\"formManager.blankForm.label\"])):(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</h5>\",s.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-prototype-name\"><strong>'+TYPO3.lang[\"formManager.form_prototype\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-control-wrap\">'+$(d)[0].outerHTML+\"</div></div></div>\"),c.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-template\"><strong>'+TYPO3.lang[\"formManager.form_template\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_template_description\"]+'</div><div class=\"form-control-wrap\">'+$(m)[0].outerHTML+\"</div></div></div>\")),r+='<div class=\"mb-3\"><label for=\"new-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\">',a.formName?(r+='<input class=\"form-control\" id=\"new-form-name\" data-identifier=\"newFormName\" value=\"'+securityUtility.encodeHtml(a.formName)+'\" />',setTimeout((function(){MultiStepWizard.unlockNextStep()}),200)):r+='<input class=\"form-control has-error\" id=\"new-form-name\" data-identifier=\"newFormName\" />',r+=\"</div></div></div>\",i&&(r+='<div class=\"mb-3\"><label for=\"new-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),a.savePath&&$(Identifiers.newFormSavePath,o).val(a.savePath),a.templatePath&&$(Identifiers.newFormTemplate,o).val(a.templatePath),s.length>1?$(Identifiers.newFormPrototypeName,o).focus():c.length>1&&$(Identifiers.newFormTemplate,o).focus();const p=function(){$(Identifiers.newFormTemplate,o).on(\"change\",(function(){MultiStepWizard.set(\"templatePath\",$(Identifiers.newFormTemplate+\" option:selected\",o).val()),MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),MultiStepWizard.set(\"templatePathOnPrev\",$(Identifiers.newFormTemplate+\" option:selected\",o).val())}))};$(Identifiers.newFormPrototypeName,o).on(\"change\",(function(t){MultiStepWizard.set(\"prototypeName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).val()),MultiStepWizard.set(\"prototypeNameName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).text()),c=e.getTemplatesForPrototype($(t.currentTarget).val()),$(Identifiers.newFormTemplate,o).off().empty();for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(Identifiers.newFormTemplate,o).append(t),MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label)}p()})),p(),a.prototypeName&&($(Identifiers.newFormPrototypeName,o).val(a.prototypeName),$(Identifiers.newFormPrototypeName,o).trigger(\"change\"),a.templatePathOnPrev&&($(Identifiers.newFormTemplate,o).find(selector`option[value=\"${a.templatePathOnPrev}\"]`).prop(\"selected\",!0),$(Identifiers.newFormTemplate,o).trigger(\"change\"))),$(Identifiers.newFormName,o).focus(),$(Identifiers.newFormName,o).on(\"keyup paste\",(function(e){$(e.currentTarget).val().length>0?($(e.currentTarget).removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",$(e.currentTarget).val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):($(e.currentTarget).addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),$(Identifiers.newFormSavePath,o).on(\"change\",(function(){MultiStepWizard.set(\"savePath\",$(Identifiers.newFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"savePathName\",$(Identifiers.newFormSavePath+\" option:selected\",o).text())})),\"blank\"===a.newFormMode||a.templatePathName||MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-3\",TYPO3.lang[\"formManager.newFormWizard.step3.title\"],\"\",Severity.notice,TYPO3.lang[\"formManager.newFormWizard.step3.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-cog\",Icons.sizes.small),r=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),i=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),o=await Icons.getIcon(\"actions-database\",Icons.sizes.small),n=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let l='<div class=\"new-form-modal\">';l+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.newFormWizard.step3.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\">',t.prototypeNameName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+a+\" \"+TYPO3.lang[\"formManager.form_prototype\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.prototypeNameName)+\"</div></div>\"),t.templatePathName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+r+\" \"+TYPO3.lang[\"formManager.form_template\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.templatePathName)+\"</div></div>\"),l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+i+\" \"+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"row my-1\"><div class=\"col col-sm-6\">'+o+\" \"+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.savePathName)+\"</div></div>\",l+=\"</div></div></div>\",e.html(l),n.focus(),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"create\"),{formName:MultiStepWizard.setup.settings.formName,templatePath:MultiStepWizard.setup.settings.templatePath,prototypeName:MultiStepWizard.setup.settings.prototypeName,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.newFormWizard.step4.errorTitle\"],TYPO3.lang[\"formManager.newFormWizard.step4.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function removeFormSetup(e){$(Identifiers.removeFormModalTrigger).on(\"click\",(function(t){const a=[];t.preventDefault();const r=$(t.currentTarget);a.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}}),a.push({text:TYPO3.lang[\"formManager.remove_form\"],active:!0,btnClass:\"btn-danger\",name:\"createform\",trigger:function(t,a){document.location=e.getAjaxEndpoint(\"delete\")+\"&formPersistenceIdentifier=\"+r.data(\"formPersistenceIdentifier\"),a.hideModal()}}),Modal.show(TYPO3.lang[\"formManager.remove_form_title\"],TYPO3.lang[\"formManager.remove_form_message\"].replace(\"{0}\",r.data(\"formName\")),Severity.error,a)}))}function duplicateFormSetup(e){$(Identifiers.duplicateFormModalTrigger).on(\"click\",(function(t){t.preventDefault();const a=$(t.currentTarget);MultiStepWizard.addSlide(\"duplicate-form-step-1\",TYPO3.lang[\"formManager.duplicateFormWizard.step1.title\"].replace(\"{0}\",a.data(\"formName\")),\"\",Severity.notice,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t){let r,i;MultiStepWizard.lockPrevStep(),MultiStepWizard.lockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(e.assert(l.length>0,\"No accessible form storage folders\",1477649539),MultiStepWizard.set(\"formPersistenceIdentifier\",a.data(\"formPersistenceIdentifier\")),MultiStepWizard.set(\"savePath\",l[0].value),l.length>1){i=$('<select id=\"duplicate-form-save-path\" class=\"form-select\" data-identifier=\"duplicateFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}r='<div class=\"duplicate-form-modal\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.new_form_name\"]+'</h5><div class=\"mb-3\"><label for=\"duplicate-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\"><input id=\"duplicate-form-name\" class=\"form-control has-error\" data-identifier=\"duplicateFormName\" /></div></div></div>',i&&(r+='<div class=\"mb-3\"><label for=\"duplicate-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),$(Identifiers.duplicateFormName,o).focus(),$(Identifiers.duplicateFormName,o).on(\"keyup paste\",(function(e){const t=$(event.currentTarget);t.val().length>0?(t.removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",t.val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):(t.addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,MultiStepWizard.set(\"confirmationDuplicateFormName\",a.data(\"formName\")),l.length>1?(MultiStepWizard.set(\"savePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).text())):(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",l[0].label)),t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"duplicate-form-step-2\",TYPO3.lang[\"formManager.duplicateFormWizard.step2.title\"],\"\",Severity.notice,TYPO3.lang[\"formManager.duplicateFormWizard.step2.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),r=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),i=await Icons.getIcon(\"actions-database\",Icons.sizes.small);MultiStepWizard.unlockPrevStep(),MultiStepWizard.unlockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let n='<div class=\"new-form-modal\"><div class=\"row\"><div class=\"col\">';n+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.duplicateFormWizard.step2.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\"><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+a+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_copied\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+r+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+i+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormSavePath)+\"</div></div></div></div>\",n+=\"</div></div></div>\",e.html(n),o.focus(),o.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"duplicate\"),{formName:MultiStepWizard.setup.settings.formName,formPersistenceIdentifier:MultiStepWizard.setup.settings.formPersistenceIdentifier,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorTitle\"],TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function showReferencesSetup(e){$(Identifiers.showReferences).on(\"click\",(t=>{t.preventDefault();const a=$(t.currentTarget),r=e.getAjaxEndpoint(\"references\")+\"&formPersistenceIdentifier=\"+a.data(\"formPersistenceIdentifier\");$.get(r,(async function(e){let t;const r=[];r.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}});const i=e.references.length,o=await Icons.getIcon(\"actions-open\",Icons.sizes.small);if(i>0){t=\"<div><h3>\"+TYPO3.lang[\"formManager.references.headline\"].replace(\"{0}\",securityUtility.encodeHtml(a.data(\"formName\")))+'</h3></div><div class=\"table-fit\"><table id=\"forms\" class=\"table table-striped table-hover\"><thead><tr><th class=\"col-icon\"></th><th class=\"col-recordtitle\">'+TYPO3.lang[\"formManager.table.field.title\"]+\"</th><th>\"+TYPO3.lang[\"formManager.table.field.uid\"]+'</th><th class=\"col-control nowrap\"><span class=\"visually-hidden\">'+TYPO3.lang[\"formManager.table.field._CONTROL_\"]+\"</span></th></tr></thead><tbody>\";for(let a=0,r=e.references.length;a<r;++a)t+='<tr><td class=\"col-icon\">'+e.references[a].recordIcon+'</td><td class=\"col-recordtitle\"><a href=\"'+securityUtility.encodeHtml(e.references[a].recordEditUrl)+'\" data-identifier=\"referenceLink\">'+securityUtility.encodeHtml(e.references[a].recordTitle)+\"</a></td><td>\"+securityUtility.encodeHtml(e.references[a].recordUid)+'</td><td class=\"col-control\"><div class=\"btn-group\" role=\"group\"><a href=\"'+securityUtility.encodeHtml(e.references[a].recordEditUrl)+'\" data-identifier=\"referenceLink\" class=\"btn btn-default\" title=\"'+TYPO3.lang[\"formManager.btn.edit.title\"]+'\">'+o+\"</a></div></td></tr>\";t+=\"</tbody></table></div>\"}else t=\"<div><h1>\"+TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",securityUtility.encodeHtml(e.formPersistenceIdentifier))+\"</h1></div><div>\"+TYPO3.lang[\"formManager.no_references\"]+\"</div>\";t=$(t),$(Identifiers.referenceLink,t).on(\"click\",(function(e){e.preventDefault(),Modal.currentModal.hideModal(),document.location=$(e.currentTarget).prop(\"href\")})),Modal.show(TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",a.data(\"formName\")),t,Severity.notice,r)})).fail((function(e,t,a){0!==e.status&&Notification.error(t,a,2)}))}))}function initializeSortable(){const e=document.querySelector(Identifiers.formsTable);null!==e&&new SortableTable(e)}!function(e){e.newFormModalTrigger='[data-identifier=\"newForm\"]',e.duplicateFormModalTrigger='[data-identifier=\"duplicateForm\"]',e.removeFormModalTrigger='[data-identifier=\"removeForm\"]',e.newFormModeButton='[data-identifier=\"newFormModeButton\"]',e.newFormName='[data-identifier=\"newFormName\"]',e.newFormSavePath='[data-identifier=\"newFormSavePath\"]',e.newFormPrototypeName='[data-identifier=\"newFormPrototypeName\"]',e.newFormTemplate='[data-identifier=\"newFormTemplate\"]',e.duplicateFormName='[data-identifier=\"duplicateFormName\"]',e.duplicateFormSavePath='[data-identifier=\"duplicateFormSavePath\"]',e.showReferences='[data-identifier=\"showReferences\"]',e.referenceLink='[data-identifier=\"referenceLink\"]',e.moduleBody=\".module-body.t3js-module-body\",e.t3Logo=\".t3-message-page-logo\",e.t3Footer=\"#t3-footer\",e.formsTable=\"#forms\"}(Identifiers||(Identifiers={}));export function bootstrap(e){removeFormSetup(e),newFormSetup(e),duplicateFormSetup(e),showReferencesSetup(e),initializeSortable()}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5ecb2a7829a269fb14deba59199d196d38aee674",
      "candidate_info": {
        "commit_hash": "5ecb2a7829a269fb14deba59199d196d38aee674",
        "repo": "TYPO3-CMS/form",
        "commit_url": "https://github.com/TYPO3-CMS/form/commit/5ecb2a7829a269fb14deba59199d196d38aee674",
        "files": [
          "Classes/Controller/FormManagerController.php",
          "Resources/Public/JavaScript/backend/form-manager/view-model.js"
        ],
        "message": "[SECURITY] Prevent XSS in FormManager backend module\n\nEncode non prepared output of BackendUtility::getRecordTitle.\nThe string returned by getRecordTitle is only HTML encoded if\nthe third parameter (`$prep`) is set to true, ensure that\nnon-prepared usages are encoded on render.\n\nResolves: #103782\nReleases: main, 13.1, 12.4, 11.5\nChange-Id: I96b9530d118a21163d6679ebf7120aa40c7ac7b6\nSecurity-Bulletin: TYPO3-CORE-SA-2024-008\nSecurity-References: CVE-2024-34356\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/84265\nTested-by: Oliver Hader <oliver.hader@typo3.org>\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>",
        "before_after_code_files": [
          "Classes/Controller/FormManagerController.php||Classes/Controller/FormManagerController.php",
          "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Classes/Controller/FormManagerController.php||Classes/Controller/FormManagerController.php",
            "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
          ],
          "candidate": [
            "Classes/Controller/FormManagerController.php||Classes/Controller/FormManagerController.php",
            "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js"
          ]
        }
      },
      "candidate_diff": {
        "Classes/Controller/FormManagerController.php||Classes/Controller/FormManagerController.php": [
          "File: Classes/Controller/FormManagerController.php -> Classes/Controller/FormManagerController.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "158:             'url' => $this->uriBuilder->uriFor('index', ['formPersistenceIdentifier' => $formPersistenceIdentifier], 'FormEditor'),",
          "159:         ];",
          "161:         try {",
          "162:             $this->formPersistenceManager->save($formPersistenceIdentifier, $form);",
          "163:         } catch (PersistenceManagerException $e) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "161:         $form = ArrayUtility::stripTagsFromValuesRecursive($form);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "222:             'url' => $this->uriBuilder->uriFor('index', ['formPersistenceIdentifier' => $formPersistenceIdentifier], 'FormEditor'),",
          "223:         ];",
          "225:         try {",
          "226:             $this->formPersistenceManager->save($formPersistenceIdentifier, $formToDuplicate);",
          "227:         } catch (PersistenceManagerException $e) {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "226:         $formToDuplicate = ArrayUtility::stripTagsFromValuesRecursive($formToDuplicate);",
          "",
          "---------------"
        ],
        "Resources/Public/JavaScript/backend/form-manager/view-model.js||Resources/Public/JavaScript/backend/form-manager/view-model.js": [
          "File: Resources/Public/JavaScript/backend/form-manager/view-model.js -> Resources/Public/JavaScript/backend/form-manager/view-model.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "13: import $ from\"jquery\";import Modal from\"@typo3/backend/modal.js\";import Severity from\"@typo3/backend/severity.js\";import MultiStepWizard from\"@typo3/backend/multi-step-wizard.js\";import Icons from\"@typo3/backend/icons.js\";import Notification from\"@typo3/backend/notification.js\";import SecurityUtility from\"@typo3/core/security-utility.js\";import{selector}from\"@typo3/core/literals.js\";const securityUtility=new SecurityUtility;var Identifiers;function newFormSetup(e){$(Identifiers.newFormModalTrigger).on(\"click\",(function(t){t.preventDefault(),MultiStepWizard.addSlide(\"new-form-step-1\",TYPO3.lang[\"formManager.newFormWizard.step1.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.newFormWizard.step1.progressLabel\"],(async function(t){const a=await Icons.getIcon(\"actions-plus\",Icons.sizes.small),r=await Icons.getIcon(\"form-page\",Icons.sizes.large),i=await Icons.getIcon(\"apps-pagetree-page-default\",Icons.sizes.large);let o;const n=MultiStepWizard.setup.$carousel.closest(\".modal\"),l=n.find(\".modal-footer\").find('button[name=\"next\"]');MultiStepWizard.blurCancelStep(),MultiStepWizard.lockNextStep(),MultiStepWizard.lockPrevStep();0===e.getAccessibleFormStorageFolders().length&&(o='<div class=\"new-form-modal\"><div class=\"row\"><label class=\"col col-form-label\">'+TYPO3.lang[\"formManager.newFormWizard.step1.noStorages\"]+\"</label></div></div>\",t.html(o),e.assert(!1,\"No accessible form storage folders\",1477506500)),o='<div class=\"new-form-modal\">',o+='<div class=\"card-container\"><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+i+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.blankForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.blankForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.blankForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-success\" data-inline=\"1\" value=\"blank\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.blankForm.label\"]+'</button></div></div><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+r+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.predefinedForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.predefinedForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-success\" data-inline=\"1\" value=\"predefined\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</button></div></div>\",o+=\"</div>\",t.html(o),$(Identifiers.newFormModeButton,n).on(\"click\",(function(e){MultiStepWizard.set(\"newFormMode\",$(e.currentTarget).val()),MultiStepWizard.next()})),l.on(\"click\",(async function(){t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-2\",TYPO3.lang[\"formManager.newFormWizard.step2.title\"],\"\",Severity.info,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t,a){let r,i;MultiStepWizard.lockNextStep(),MultiStepWizard.unlockPrevStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(a.savePath||(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"savePathName\",l[0].label)),l.length>1){i=$('<select class=\"new-form-save-path form-select\" id=\"new-form-save-path\" data-identifier=\"newFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}const s=e.getPrototypes();e.assert(s.length>0,\"No prototypes available\",1477506501),a.prototypeName||(MultiStepWizard.set(\"prototypeName\",s[0].value),MultiStepWizard.set(\"prototypeNameName\",s[0].label));const d=$('<select class=\"new-form-prototype-name form-select\" id=\"new-form-prototype-name\" data-identifier=\"newFormPrototypeName\" />');for(let e=0,t=s.length;e<t;++e){const t=new Option(s[e].label,s[e].value);$(d).append(t)}let c=e.getTemplatesForPrototype(s[0].value);e.assert(c.length>0,\"No templates available\",1477506502),a.templatePath||(MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label));const m=$('<select class=\"new-form-template form-select\" id=\"new-form-template\" data-identifier=\"newFormTemplate\" />');for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(m).append(t)}r='<div class=\"new-form-modal\">',\"blank\"===a.newFormMode?(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.blankForm.label\"]+\"</h5>\",MultiStepWizard.set(\"templatePath\",\"EXT:form/Resources/Private/Backend/Templates/FormEditor/Yaml/NewForms/BlankForm.yaml\"),MultiStepWizard.set(\"templatePathName\",TYPO3.lang[\"formManager.blankForm.label\"])):(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</h5>\",s.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-prototype-name\"><strong>'+TYPO3.lang[\"formManager.form_prototype\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-control-wrap\">'+$(d)[0].outerHTML+\"</div></div></div>\"),c.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-template\"><strong>'+TYPO3.lang[\"formManager.form_template\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_template_description\"]+'</div><div class=\"form-control-wrap\">'+$(m)[0].outerHTML+\"</div></div></div>\")),r+='<div class=\"mb-3\"><label for=\"new-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\">',a.formName?(r+='<input class=\"form-control\" id=\"new-form-name\" data-identifier=\"newFormName\" value=\"'+securityUtility.encodeHtml(a.formName)+'\" />',setTimeout((function(){MultiStepWizard.unlockNextStep()}),200)):r+='<input class=\"form-control has-error\" id=\"new-form-name\" data-identifier=\"newFormName\" />',r+=\"</div></div></div>\",i&&(r+='<div class=\"mb-3\"><label for=\"new-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),a.savePath&&$(Identifiers.newFormSavePath,o).val(a.savePath),a.templatePath&&$(Identifiers.newFormTemplate,o).val(a.templatePath),s.length>1?$(Identifiers.newFormPrototypeName,o).focus():c.length>1&&$(Identifiers.newFormTemplate,o).focus();const p=function(){$(Identifiers.newFormTemplate,o).on(\"change\",(function(){MultiStepWizard.set(\"templatePath\",$(Identifiers.newFormTemplate+\" option:selected\",o).val()),MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),MultiStepWizard.set(\"templatePathOnPrev\",$(Identifiers.newFormTemplate+\" option:selected\",o).val())}))};$(Identifiers.newFormPrototypeName,o).on(\"change\",(function(t){MultiStepWizard.set(\"prototypeName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).val()),MultiStepWizard.set(\"prototypeNameName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).text()),c=e.getTemplatesForPrototype($(t.currentTarget).val()),$(Identifiers.newFormTemplate,o).off().empty();for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(Identifiers.newFormTemplate,o).append(t),MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label)}p()})),p(),a.prototypeName&&($(Identifiers.newFormPrototypeName,o).val(a.prototypeName),$(Identifiers.newFormPrototypeName,o).trigger(\"change\"),a.templatePathOnPrev&&($(Identifiers.newFormTemplate,o).find(selector`option[value=\"${a.templatePathOnPrev}\"]`).prop(\"selected\",!0),$(Identifiers.newFormTemplate,o).trigger(\"change\"))),$(Identifiers.newFormName,o).focus(),$(Identifiers.newFormName,o).on(\"keyup paste\",(function(e){$(e.currentTarget).val().length>0?($(e.currentTarget).removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",$(e.currentTarget).val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):($(e.currentTarget).addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),$(Identifiers.newFormSavePath,o).on(\"change\",(function(){MultiStepWizard.set(\"savePath\",$(Identifiers.newFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"savePathName\",$(Identifiers.newFormSavePath+\" option:selected\",o).text())})),\"blank\"===a.newFormMode||a.templatePathName||MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-3\",TYPO3.lang[\"formManager.newFormWizard.step3.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.newFormWizard.step3.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-cog\",Icons.sizes.small),r=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),i=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),o=await Icons.getIcon(\"actions-database\",Icons.sizes.small),n=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let l='<div class=\"new-form-modal\">';l+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.newFormWizard.step3.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\">',t.prototypeNameName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+a+\" \"+TYPO3.lang[\"formManager.form_prototype\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.prototypeNameName)+\"</div></div>\"),t.templatePathName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+r+\" \"+TYPO3.lang[\"formManager.form_template\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.templatePathName)+\"</div></div>\"),l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+i+\" \"+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"row my-1\"><div class=\"col col-sm-6\">'+o+\" \"+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.savePathName)+\"</div></div>\",l+=\"</div></div></div>\",e.html(l),n.focus(),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"create\"),{formName:MultiStepWizard.setup.settings.formName,templatePath:MultiStepWizard.setup.settings.templatePath,prototypeName:MultiStepWizard.setup.settings.prototypeName,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.newFormWizard.step4.errorTitle\"],TYPO3.lang[\"formManager.newFormWizard.step4.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function removeFormSetup(e){$(Identifiers.removeFormModalTrigger).on(\"click\",(function(t){const a=[];t.preventDefault();const r=$(t.currentTarget);a.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}}),a.push({text:TYPO3.lang[\"formManager.remove_form\"],active:!0,btnClass:\"btn-warning\",name:\"createform\",trigger:function(t,a){document.location=e.getAjaxEndpoint(\"delete\")+\"&formPersistenceIdentifier=\"+r.data(\"formPersistenceIdentifier\"),a.hideModal()}}),Modal.show(TYPO3.lang[\"formManager.remove_form_title\"],TYPO3.lang[\"formManager.remove_form_message\"],Severity.warning,a)}))}function duplicateFormSetup(e){$(Identifiers.duplicateFormModalTrigger).on(\"click\",(function(t){t.preventDefault();const a=$(t.currentTarget);MultiStepWizard.addSlide(\"duplicate-form-step-1\",TYPO3.lang[\"formManager.duplicateFormWizard.step1.title\"].replace(\"{0}\",a.data(\"formName\")),\"\",Severity.info,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t){let r,i;MultiStepWizard.lockPrevStep(),MultiStepWizard.lockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(e.assert(l.length>0,\"No accessible form storage folders\",1477649539),MultiStepWizard.set(\"formPersistenceIdentifier\",a.data(\"formPersistenceIdentifier\")),MultiStepWizard.set(\"savePath\",l[0].value),l.length>1){i=$('<select id=\"duplicate-form-save-path\" class=\"form-select\" data-identifier=\"duplicateFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}r='<div class=\"duplicate-form-modal\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.new_form_name\"]+'</h5><div class=\"mb-3\"><label for=\"duplicate-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\"><input id=\"duplicate-form-name\" class=\"form-control has-error\" data-identifier=\"duplicateFormName\" /></div></div></div>',i&&(r+='<div class=\"mb-3\"><label for=\"duplicate-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),$(Identifiers.duplicateFormName,o).focus(),$(Identifiers.duplicateFormName,o).on(\"keyup paste\",(function(e){const t=$(event.currentTarget);t.val().length>0?(t.removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",t.val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):(t.addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,MultiStepWizard.set(\"confirmationDuplicateFormName\",a.data(\"formName\")),l.length>1?(MultiStepWizard.set(\"savePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).text())):(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",l[0].label)),t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"duplicate-form-step-2\",TYPO3.lang[\"formManager.duplicateFormWizard.step2.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.duplicateFormWizard.step2.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),r=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),i=await Icons.getIcon(\"actions-database\",Icons.sizes.small);MultiStepWizard.unlockPrevStep(),MultiStepWizard.unlockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let n='<div class=\"new-form-modal\"><div class=\"row\"><div class=\"col\">';n+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.duplicateFormWizard.step2.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\"><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+a+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_copied\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+r+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+i+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormSavePath)+\"</div></div></div></div>\",n+=\"</div></div></div>\",e.html(n),o.focus(),o.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"duplicate\"),{formName:MultiStepWizard.setup.settings.formName,formPersistenceIdentifier:MultiStepWizard.setup.settings.formPersistenceIdentifier,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorTitle\"],TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function showReferencesSetup(e){$(Identifiers.showReferences).on(\"click\",(t=>{t.preventDefault();const a=$(t.currentTarget),r=e.getAjaxEndpoint(\"references\")+\"&formPersistenceIdentifier=\"+a.data(\"formPersistenceIdentifier\");$.get(r,(function(e){let t;const r=[];r.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}});if(e.references.length>0){t=\"<div><h3>\"+TYPO3.lang[\"formManager.references.headline\"].replace(\"{0}\",a.data(\"formName\"))+'</h3></div><div class=\"table-fit\"><table id=\"forms\" class=\"table table-striped table-sm\"><thead><tr><th>'+TYPO3.lang[\"formManager.page\"]+\"</th><th>\"+TYPO3.lang[\"formManager.record\"]+\"</th></tr></thead><tbody>\";for(let a=0,r=e.references.length;a<r;++a)t+=\"<tr><td>\"+e.references[a].recordPageTitle+\"</td><td>\"+e.references[a].recordIcon+'<a href=\"'+e.references[a].recordEditUrl+'\" data-identifier=\"referenceLink\">'+e.references[a].recordTitle+\" (uid: \"+e.references[a].recordUid+\")</a></td></tr>\";t+=\"</tbody></table></div>\"}else t=\"<div><h1>\"+TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",e.formPersistenceIdentifier)+\"</h1></div><div>\"+TYPO3.lang[\"formManager.no_references\"]+\"</div>\";t=$(t),$(Identifiers.referenceLink,t).on(\"click\",(function(e){e.preventDefault(),Modal.currentModal.hideModal(),document.location=$(e.currentTarget).prop(\"href\")})),Modal.show(TYPO3.lang[\"formManager.references.title\"],t,Severity.info,r)})).fail((function(e,t,a){0!==e.status&&Notification.error(t,a,2)}))}))}!function(e){e.newFormModalTrigger='[data-identifier=\"newForm\"]',e.duplicateFormModalTrigger='[data-identifier=\"duplicateForm\"]',e.removeFormModalTrigger='[data-identifier=\"removeForm\"]',e.newFormModeButton='[data-identifier=\"newFormModeButton\"]',e.newFormName='[data-identifier=\"newFormName\"]',e.newFormSavePath='[data-identifier=\"newFormSavePath\"]',e.newFormPrototypeName='[data-identifier=\"newFormPrototypeName\"]',e.newFormTemplate='[data-identifier=\"newFormTemplate\"]',e.duplicateFormName='[data-identifier=\"duplicateFormName\"]',e.duplicateFormSavePath='[data-identifier=\"duplicateFormSavePath\"]',e.showReferences='[data-identifier=\"showReferences\"]',e.referenceLink='[data-identifier=\"referenceLink\"]',e.moduleBody=\".module-body.t3js-module-body\",e.t3Logo=\".t3-message-page-logo\",e.t3Footer=\"#t3-footer\"}(Identifiers||(Identifiers={}));export function bootstrap(e){removeFormSetup(e),newFormSetup(e),duplicateFormSetup(e),showReferencesSetup(e)}",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}