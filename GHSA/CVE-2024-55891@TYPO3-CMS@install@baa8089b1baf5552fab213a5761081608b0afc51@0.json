{
  "cve_id": "CVE-2024-55891",
  "cve_desc": "TYPO3 is a free and open source Content Management Framework. It has been discovered that the install tool password has been logged as plaintext in case the password hashing mechanism used for the password was incorrect. Users are advised to update to TYPO3 versions 13.4.3 ELTS which fixes the problem described. There are no known workarounds for this vulnerability.",
  "repo": "TYPO3-CMS/install",
  "patch_hash": "baa8089b1baf5552fab213a5761081608b0afc51",
  "patch_info": {
    "commit_hash": "baa8089b1baf5552fab213a5761081608b0afc51",
    "repo": "TYPO3-CMS/install",
    "commit_url": "https://github.com/TYPO3-CMS/install/commit/baa8089b1baf5552fab213a5761081608b0afc51",
    "files": [
      "Classes/Authentication/AuthenticationService.php"
    ],
    "message": "[SECURITY] Avoid logging install tool password on hashing issue\n\nThis change avoids logging the submitted plain-text install tool\npassword in case the server-side hash was invalid.\n\nResolves: #105685\nReleases: main, 13.4\nChange-Id: I0b83e672d612a14442d5023361a96bd863947492\nSecurity-Bulletin: TYPO3-CORE-SA-2025-001\nSecurity-References: CVE-2024-55891\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/87742\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>\nTested-by: Oliver Hader <oliver.hader@typo3.org>",
    "before_after_code_files": [
      "Classes/Authentication/AuthenticationService.php||Classes/Authentication/AuthenticationService.php"
    ]
  },
  "patch_diff": {
    "Classes/Authentication/AuthenticationService.php||Classes/Authentication/AuthenticationService.php": [
      "File: Classes/Authentication/AuthenticationService.php -> Classes/Authentication/AuthenticationService.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "70:                 $validPassword = $hashInstance->checkPassword($password, $installToolPassword);",
      "71:             } catch (InvalidPasswordHashException $e) {",
      "72:                 $logger = GeneralUtility::makeInstance(LogManager::class)->getLogger(__CLASS__);",
      "74:                     'Invalid install tool password hash specified in \"BE/installToolPassword\" configuration.',",
      "76:                 );",
      "77:             }",
      "78:         }",
      "",
      "[Removed Lines]",
      "73:                 $logger->warning(",
      "75:                     ['exception' => $e]",
      "",
      "[Added Lines]",
      "73:                 $logger->error(",
      "75:                     ['exceptionMessage' => $e->getMessage()]",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "c21b237500c44223aa144b5e3841a6171b361391",
      "candidate_info": {
        "commit_hash": "c21b237500c44223aa144b5e3841a6171b361391",
        "repo": "TYPO3-CMS/install",
        "commit_url": "https://github.com/TYPO3-CMS/install/commit/c21b237500c44223aa144b5e3841a6171b361391",
        "files": [
          "Classes/Authentication/AuthenticationService.php"
        ],
        "message": "[BUGFIX] Show hash to user even if InstallTool password is invalid\n\nCurrently, if a user uses an invalid InstallTool password hash,\nfor example a plaintext placeholder, the InstallTool login\nthrows an uncaught `InvalidPasswordHashException`.\n\nThis prevents the output of the generated hash based on\nthe entered password, which could then be used to fix the\nissue by setting a valid InstallTool password in the\nconfiguration.\n\nWith this change, the exception is caught and is written\nto the log file instead. The user is shown the normal login\nscreen with the generated hash.\n\nResolves: #105016\nReleases: main, 13.4\nChange-Id: Ib0a3b1dafba23a4554eb11d4adbad51e7f07527c\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/86147\nTested-by: Christian Kuhn <lolli@schwarzbu.ch>\nTested-by: Andreas Nedbal <andy@pixelde.su>\nReviewed-by: Andreas Nedbal <andy@pixelde.su>\nReviewed-by: Simon Praetorius <simon@praetorius.me>\nTested-by: Simon Praetorius <simon@praetorius.me>\nTested-by: core-ci <typo3@b13.com>\nReviewed-by: Christian Kuhn <lolli@schwarzbu.ch>",
        "before_after_code_files": [
          "Classes/Authentication/AuthenticationService.php||Classes/Authentication/AuthenticationService.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "Classes/Authentication/AuthenticationService.php||Classes/Authentication/AuthenticationService.php"
          ],
          "candidate": [
            "Classes/Authentication/AuthenticationService.php||Classes/Authentication/AuthenticationService.php"
          ]
        }
      },
      "candidate_diff": {
        "Classes/Authentication/AuthenticationService.php||Classes/Authentication/AuthenticationService.php": [
          "File: Classes/Authentication/AuthenticationService.php -> Classes/Authentication/AuthenticationService.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: use Symfony\\Component\\Mime\\Address;",
          "23: use Symfony\\Component\\Mime\\Exception\\RfcComplianceException;",
          "24: use Symfony\\Component\\Mime\\RawMessage;",
          "25: use TYPO3\\CMS\\Core\\Crypto\\PasswordHashing\\PasswordHashFactory;",
          "26: use TYPO3\\CMS\\Core\\Log\\LogManager;",
          "27: use TYPO3\\CMS\\Core\\Mail\\FluidEmail;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: use TYPO3\\CMS\\Core\\Crypto\\PasswordHashing\\InvalidPasswordHashException;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "63:         if ($password !== null && $password !== '') {",
          "64:             $installToolPassword = $GLOBALS['TYPO3_CONF_VARS']['BE']['installToolPassword'];",
          "65:             $hashFactory = GeneralUtility::makeInstance(PasswordHashFactory::class);",
          "70:         }",
          "71:         if ($validPassword) {",
          "72:             $session->setAuthorized();",
          "",
          "[Removed Lines]",
          "67:             $hashInstance = $hashFactory->get($installToolPassword, 'BE');",
          "69:             $validPassword = $hashInstance->checkPassword($password, $installToolPassword);",
          "",
          "[Added Lines]",
          "67:             try {",
          "68:                 $hashInstance = $hashFactory->get($installToolPassword, 'BE');",
          "70:                 $validPassword = $hashInstance->checkPassword($password, $installToolPassword);",
          "71:             } catch (InvalidPasswordHashException $e) {",
          "72:                 $logger = GeneralUtility::makeInstance(LogManager::class)->getLogger(__CLASS__);",
          "73:                 $logger->warning(",
          "74:                     'Invalid install tool password hash specified in \"BE/installToolPassword\" configuration.',",
          "75:                     ['exception' => $e]",
          "76:                 );",
          "77:             }",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5add47ada19f1f9ab39aa59d359a5d9c53e19d47",
      "candidate_info": {
        "commit_hash": "5add47ada19f1f9ab39aa59d359a5d9c53e19d47",
        "repo": "TYPO3-CMS/install",
        "commit_url": "https://github.com/TYPO3-CMS/install/commit/5add47ada19f1f9ab39aa59d359a5d9c53e19d47",
        "files": [
          "Classes/Authentication/AuthenticationService.php"
        ],
        "message": "[SECURITY] Avoid logging install tool password on hashing issue\n\nThis change avoids logging the submitted plain-text install tool\npassword in case the server-side hash was invalid.\n\nResolves: #105685\nReleases: main, 13.4\nChange-Id: I0b83e672d612a14442d5023361a96bd863947492\nSecurity-Bulletin: TYPO3-CORE-SA-2025-001\nSecurity-References: CVE-2024-55891\nReviewed-on: https://review.typo3.org/c/Packages/TYPO3.CMS/+/87739\nReviewed-by: Oliver Hader <oliver.hader@typo3.org>\nTested-by: Oliver Hader <oliver.hader@typo3.org>",
        "before_after_code_files": [
          "Classes/Authentication/AuthenticationService.php||Classes/Authentication/AuthenticationService.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "diff_branch_message": 1,
        "olp_code_files": {
          "patch": [
            "Classes/Authentication/AuthenticationService.php||Classes/Authentication/AuthenticationService.php"
          ],
          "candidate": [
            "Classes/Authentication/AuthenticationService.php||Classes/Authentication/AuthenticationService.php"
          ]
        }
      },
      "candidate_diff": {
        "Classes/Authentication/AuthenticationService.php||Classes/Authentication/AuthenticationService.php": [
          "File: Classes/Authentication/AuthenticationService.php -> Classes/Authentication/AuthenticationService.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "70:                 $validPassword = $hashInstance->checkPassword($password, $installToolPassword);",
          "71:             } catch (InvalidPasswordHashException $e) {",
          "72:                 $logger = GeneralUtility::makeInstance(LogManager::class)->getLogger(__CLASS__);",
          "74:                     'Invalid install tool password hash specified in \"BE/installToolPassword\" configuration.',",
          "76:                 );",
          "77:             }",
          "78:         }",
          "",
          "[Removed Lines]",
          "73:                 $logger->warning(",
          "75:                     ['exception' => $e]",
          "",
          "[Added Lines]",
          "73:                 $logger->error(",
          "75:                     ['exceptionMessage' => $e->getMessage()]",
          "",
          "---------------"
        ]
      }
    }
  ]
}