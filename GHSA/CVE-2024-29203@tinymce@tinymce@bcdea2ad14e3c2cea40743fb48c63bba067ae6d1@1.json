{
  "cve_id": "CVE-2024-29203",
  "cve_desc": "TinyMCE is an open source rich text editor. A\u00a0cross-site scripting (XSS) vulnerability was discovered in TinyMCE\u2019s content insertion code.  This allowed `iframe` elements containing malicious code to execute when inserted into the editor.  These `iframe` elements are restricted in their permissions by same-origin browser protections, but could still trigger operations such as downloading of malicious assets. This vulnerability is fixed in 6.8.1.",
  "repo": "tinymce/tinymce",
  "patch_hash": "bcdea2ad14e3c2cea40743fb48c63bba067ae6d1",
  "patch_info": {
    "commit_hash": "bcdea2ad14e3c2cea40743fb48c63bba067ae6d1",
    "repo": "tinymce/tinymce",
    "commit_url": "https://github.com/tinymce/tinymce/commit/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1",
    "files": [
      "modules/tinymce/CHANGELOG.md",
      "modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
      "modules/tinymce/src/core/main/ts/api/Options.ts",
      "modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
      "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
      "modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
      "modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
      "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
      "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
      "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
      "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
      "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
      "modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts"
    ],
    "message": "TINY-10348 & TINY-10349: Add sandbox_iframes and convert_unsafe_embeds options (#9172)\n\n* TINY-10348: Add sandbox_iframes option\n\n* TINY-10349: Add convert_unsafe_embeds option\n\n* TINY-10348 & TINY-10349: Add paste tests\n\n* TINY-10348 & TINY-10349: Add changelog entries\n\n* TINY-10348: Add missing PageBreakPlugin dependency in SelectionToolbarTest\n\n* TINY-10349: Add attribute preservation tests for convert_unsafe_embeds",
    "before_after_code_files": [
      "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
      "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
      "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
      "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
      "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
      "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
      "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
      "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
      "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
      "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
      "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts||modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts",
      "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
      "modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts||modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts"
    ]
  },
  "patch_diff": {
    "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts": [
      "File: modules/tinymce/src/core/main/ts/api/OptionTypes.ts -> modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "86:   contextmenu?: string | string[] | false;",
      "87:   contextmenu_never_use_native?: boolean;",
      "88:   convert_fonts_to_spans?: boolean;",
      "89:   convert_urls?: boolean;",
      "90:   custom_colors?: boolean;",
      "91:   custom_elements?: string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "89:   convert_unsafe_embeds?: boolean;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "197:   resize?: boolean | 'both';",
      "198:   resize_img_proportional?: boolean;",
      "199:   root_name?: string;",
      "200:   schema?: SchemaType;",
      "201:   selector?: string;",
      "202:   setup?: SetupCallback;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "201:   sandbox_iframes?: boolean;",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "289:   color_default_foreground: string;",
      "290:   content_css: string[];",
      "291:   contextmenu: string[];",
      "292:   custom_colors: boolean;",
      "293:   default_font_stack: string[];",
      "294:   document_base_url: string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "294:   convert_unsafe_embeds: boolean;",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "336:   promotion: boolean;",
      "337:   readonly: boolean;",
      "338:   removed_menuitems: string;",
      "339:   toolbar: boolean | string | string[] | Array<ToolbarGroup>;",
      "340:   toolbar_groups: Record<string, Toolbar.GroupToolbarButtonSpec>;",
      "341:   toolbar_location: ToolbarLocation;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "342:   sandbox_iframes: boolean;",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
      "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "836:     default: 'off',",
      "837:   });",
      "840:   editor.on('ScriptsLoaded', () => {",
      "841:     registerOption('directionality', {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "839:   registerOption('sandbox_iframes', {",
      "840:     processor: 'boolean',",
      "841:     default: false",
      "842:   });",
      "844:   registerOption('convert_unsafe_embeds', {",
      "845:     processor: 'boolean',",
      "846:     default: false",
      "847:   });",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "944: const shouldHighlightOnFocus = option('highlight_on_focus');",
      "945: const shouldSanitizeXss = option('xss_sanitization');",
      "946: const shouldUseDocumentWrite = option('init_content_sync');",
      "963: const hasTableTabNavigation = option('table_tab_navigation');",
      "965: const getDetailsInitialState = option('details_initial_state');",
      "966: const getDetailsSerializedState = option('details_serialized_state');",
      "968: const shouldForceHexColor = option('force_hex_color');",
      "970: export {",
      "971:   register,",
      "",
      "[Removed Lines]",
      "948: const hasTextPatternsLookup = (editor: Editor): boolean =>",
      "949:   editor.options.isSet('text_patterns_lookup');",
      "951: const getFontStyleValues = (editor: Editor): string[] =>",
      "952:   Tools.explode(editor.options.get('font_size_style_values'));",
      "954: const getFontSizeClasses = (editor: Editor): string[] =>",
      "955:   Tools.explode(editor.options.get('font_size_classes'));",
      "957: const isEncodingXml = (editor: Editor): boolean =>",
      "958:   editor.options.get('encoding') === 'xml';",
      "960: const getAllowedImageFileTypes = (editor: Editor): string[] =>",
      "961:   Tools.explode(editor.options.get('images_file_types'));",
      "",
      "[Added Lines]",
      "957: const hasTextPatternsLookup = (editor: Editor): boolean => editor.options.isSet('text_patterns_lookup');",
      "958: const getFontStyleValues = (editor: Editor): string[] => Tools.explode(editor.options.get('font_size_style_values'));",
      "959: const getFontSizeClasses = (editor: Editor): string[] => Tools.explode(editor.options.get('font_size_classes'));",
      "960: const isEncodingXml = (editor: Editor): boolean => editor.options.get('encoding') === 'xml';",
      "961: const getAllowedImageFileTypes = (editor: Editor): string[] => Tools.explode(editor.options.get('images_file_types'));",
      "966: const shouldSandboxIframes = option('sandbox_iframes');",
      "967: const shouldConvertUnsafeEmbeds = option('convert_unsafe_embeds');",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "1071:   getDetailsInitialState,",
      "1072:   getDetailsSerializedState,",
      "1073:   shouldUseDocumentWrite,",
      "1075: };",
      "",
      "[Removed Lines]",
      "1074:   shouldForceHexColor",
      "",
      "[Added Lines]",
      "1073:   shouldForceHexColor,",
      "1074:   shouldSandboxIframes,",
      "1075:   shouldConvertUnsafeEmbeds",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts": [
      "File: modules/tinymce/src/core/main/ts/api/html/DomParser.ts -> modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "57:   allow_unsafe_link_target?: boolean;",
      "58:   blob_cache?: BlobCache;",
      "59:   convert_fonts_to_spans?: boolean;",
      "60:   document?: Document;",
      "61:   fix_list_elements?: boolean;",
      "62:   font_size_legacy_values?: string;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "60:   convert_unsafe_embeds?: boolean;",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "70:   remove_trailing_brs?: boolean;",
      "71:   root_name?: string;",
      "72:   sanitize?: boolean;",
      "73:   validate?: boolean;",
      "74: }",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "73:   sandbox_iframes?: boolean;",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts": [
      "File: modules/tinymce/src/core/main/ts/content/PrePostProcess.ts -> modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: import Editor from '../api/Editor';",
      "4: import * as Events from '../api/Events';",
      "6: import HtmlSerializer from '../api/html/Serializer';",
      "7: import * as Options from '../api/Options';",
      "8: import { EditorEvent } from '../api/util/EventDispatcher';",
      "",
      "[Removed Lines]",
      "5: import DomParser from '../api/html/DomParser';",
      "",
      "[Added Lines]",
      "5: import DomParser, { DomParserSettings } from '../api/html/DomParser';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "11: const serializeContent = (content: Content): string =>",
      "12:   isTreeNode(content) ? HtmlSerializer({ validate: false }).serialize(content) : content;",
      "15:   const serializedContent = serializeContent(content);",
      "16:   const eventArgs = fireEvent(serializedContent);",
      "17:   if (eventArgs.isDefaultPrevented()) {",
      "",
      "[Removed Lines]",
      "14: const withSerializedContent = <R extends EditorEvent<{ content: string }>>(content: Content, fireEvent: (content: string) => R, sanitize: boolean): R & { content: Content } => {",
      "",
      "[Added Lines]",
      "14: const withSerializedContent = <R extends EditorEvent<{ content: string }>>(content: Content, fireEvent: (content: string) => R, parserSettings: DomParserSettings): R & { content: Content } => {",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "22:     if (eventArgs.content !== serializedContent) {",
      "24:       return { ...eventArgs, content: rootNode };",
      "25:     } else {",
      "26:       return { ...eventArgs, content };",
      "",
      "[Removed Lines]",
      "23:       const rootNode = DomParser({ validate: false, forced_root_block: false, sanitize }).parse(eventArgs.content, { context: content.name });",
      "",
      "[Added Lines]",
      "23:       const rootNode = DomParser({ validate: false, forced_root_block: false, ...parserSettings }).parse(eventArgs.content, { context: content.name });",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "47:   if (args.no_events) {",
      "48:     return content;",
      "49:   } else {",
      "51:     return processedEventArgs.content;",
      "52:   }",
      "53: };",
      "",
      "[Removed Lines]",
      "50:     const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), Options.shouldSanitizeXss(editor));",
      "",
      "[Added Lines]",
      "50:     const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), { sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) });",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "56:   if (args.no_events) {",
      "57:     return Result.value(args);",
      "58:   } else {",
      "60:     if (processedEventArgs.isDefaultPrevented()) {",
      "61:       Events.fireSetContent(editor, processedEventArgs);",
      "62:       return Result.error(undefined);",
      "",
      "[Removed Lines]",
      "59:     const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), Options.shouldSanitizeXss(editor));",
      "",
      "[Added Lines]",
      "59:     const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), { sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/html/ParserFilters.ts||modules/tinymce/src/core/main/ts/html/ParserFilters.ts": [
      "File: modules/tinymce/src/core/main/ts/html/ParserFilters.ts -> modules/tinymce/src/core/main/ts/html/ParserFilters.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: import Env from '../api/Env';",
      "4: import DomParser, { DomParserSettings } from '../api/html/DomParser';",
      "",
      "[Removed Lines]",
      "1: import { Arr, Type } from '@ephox/katamari';",
      "",
      "[Added Lines]",
      "1: import { Arr, Strings, Type } from '@ephox/katamari';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "32:   }",
      "33: };",
      "35: const register = (parser: DomParser, settings: DomParserSettings): void => {",
      "36:   const schema = parser.schema;",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "35: const isMimeType = (mime: string, type: 'image' | 'video' | 'audio'): boolean => Strings.startsWith(mime, `${type}/`);",
      "37: const createSafeEmbed = (mime?: string, src?: string, width?: string, height?: string, sandboxIframes?: boolean): AstNode => {",
      "38:   let name: 'iframe' | 'img' | 'video' | 'audio';",
      "39:   if (Type.isUndefined(mime)) {",
      "40:     name = 'iframe';",
      "41:   } else if (isMimeType(mime, 'image')) {",
      "42:     name = 'img';",
      "43:   } else if (isMimeType(mime, 'video')) {",
      "44:     name = 'video';",
      "45:   } else if (isMimeType(mime, 'audio')) {",
      "46:     name = 'audio';",
      "47:   } else {",
      "48:     name = 'iframe';",
      "49:   }",
      "51:   const embed = new AstNode(name, 1);",
      "52:   embed.attr(name === 'audio' ? { src } : { src, width, height });",
      "55:   if (name === 'audio' || name === 'video') {",
      "56:     embed.attr('controls', '');",
      "57:   }",
      "59:   if (name === 'iframe' && sandboxIframes) {",
      "60:     embed.attr('sandbox', '');",
      "61:   }",
      "62:   return embed;",
      "63: };",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "153:   }",
      "155:   registerBase64ImageFilter(parser, settings);",
      "156: };",
      "158: export {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "187:   if (settings.convert_unsafe_embeds) {",
      "188:     parser.addNodeFilter('object,embed', (nodes) => Arr.each(nodes, (node) => {",
      "189:       node.replace(",
      "190:         createSafeEmbed(",
      "191:           node.attr('type'),",
      "192:           node.name === 'object' ? node.attr('data') : node.attr('src'),",
      "193:           node.attr('width'),",
      "194:           node.attr('height'),",
      "195:           settings.sandbox_iframes",
      "196:         ));",
      "197:     }));",
      "198:   }",
      "200:   if (settings.sandbox_iframes) {",
      "201:     parser.addNodeFilter('iframe', (nodes) => Arr.each(nodes, (node) => node.attr('sandbox', '')));",
      "202:   }",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts": [
      "File: modules/tinymce/src/core/main/ts/init/InitContentBody.ts -> modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "73:     allow_html_in_named_anchor: getOption('allow_html_in_named_anchor'),",
      "74:     allow_script_urls: getOption('allow_script_urls'),",
      "75:     allow_unsafe_link_target: getOption('allow_unsafe_link_target'),",
      "76:     convert_fonts_to_spans: getOption('convert_fonts_to_spans'),",
      "77:     fix_list_elements: getOption('fix_list_elements'),",
      "78:     font_size_legacy_values: getOption('font_size_legacy_values'),",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "76:     convert_unsafe_embeds: getOption('convert_unsafe_embeds'),",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "81:     preserve_cdata: getOption('preserve_cdata'),",
      "82:     inline_styles: getOption('inline_styles'),",
      "83:     root_name: getRootName(editor),",
      "84:     sanitize: getOption('xss_sanitization'),",
      "85:     validate: true,",
      "86:     blob_cache: blobCache,",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "85:     sandbox_iframes: getOption('sandbox_iframes'),",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts": [
      "File: modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts -> modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "11: }",
      "13: const preProcess = (editor: Editor, html: string): string => {",
      "17:   parser.addNodeFilter('meta', (nodes) => {",
      "",
      "[Removed Lines]",
      "14:   const parser = DomParser({ sanitize: Options.shouldSanitizeXss(editor) }, editor.schema);",
      "",
      "[Added Lines]",
      "14:   const parser = DomParser({ sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) }, editor.schema);",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts": [
      "File: modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts -> modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "350:             assert.equal(content, final, 'ZWNBSP should be stripped');",
      "351:           });",
      "352:         });",
      "353:       });",
      "354:     }",
      "355:   );",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "354:         context('iframe sandboxing', () => {",
      "355:           context('sandbox_iframes default', () => {",
      "356:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "357:               ...options,",
      "358:               base_url: '/project/tinymce/js/tinymce'",
      "359:             }, []);",
      "361:             it('TINY-10348: Iframe should not be sandboxed by default', () => {",
      "362:               const editor = hook.editor();",
      "363:               editor.setContent('<iframe src=\"about:blank\"></iframe>');",
      "364:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\"></iframe></p>');",
      "365:             });",
      "366:           });",
      "368:           context('sandbox_iframes: false', () => {",
      "369:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "370:               ...options,",
      "371:               base_url: '/project/tinymce/js/tinymce',",
      "372:               sandbox_iframes: false",
      "373:             }, []);",
      "375:             it('TINY-10348: Iframe should not be sandboxed when sandbox_iframes: false', () => {",
      "376:               const editor = hook.editor();",
      "377:               editor.setContent('<iframe src=\"about:blank\"></iframe>');",
      "378:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\"></iframe></p>');",
      "379:             });",
      "381:             it('TINY-10348: Iframe with sandbox attribute should not be modified when sandbox_iframes: false', () => {",
      "382:               const editor = hook.editor();",
      "383:               editor.setContent('<iframe src=\"about:blank\" sandbox=\"allow-scripts allow-same-origin allow-forms\"></iframe>');",
      "384:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"allow-scripts allow-same-origin allow-forms\"></iframe></p>');",
      "385:             });",
      "386:           });",
      "388:           context('sandbox_iframes: true', () => {",
      "389:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "390:               ...options,",
      "391:               base_url: '/project/tinymce/js/tinymce',",
      "392:               sandbox_iframes: true",
      "393:             }, []);",
      "395:             it('TINY-10348: Iframe should be sandboxed when sandbox_iframes: true', () => {",
      "396:               const editor = hook.editor();",
      "397:               editor.setContent('<iframe src=\"about:blank\"></iframe>');",
      "398:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>');",
      "399:             });",
      "401:             it('TINY-10348: Iframe with sandbox attribute should be sandboxed when sandbox_iframes: true', () => {",
      "402:               const editor = hook.editor();",
      "403:               editor.setContent('<iframe src=\"about:blank\" sandbox=\"allow-scripts allow-same-origin allow-forms\"></iframe>');",
      "404:               TinyAssertions.assertContent(editor, '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>');",
      "405:             });",
      "406:           });",
      "407:         });",
      "409:         context('Convert unsafe embeds', () => {",
      "410:           const setAndAssertEmbed = (editor: Editor, embedHtml: string, expectedHtml: string) => {",
      "411:             editor.setContent(embedHtml);",
      "412:             TinyAssertions.assertContent(editor, `<p>${expectedHtml}</p>`);",
      "413:           };",
      "415:           const testNoConversion = (hook: TinyHooks.Hook<Editor>, embedHtml: string) => () => {",
      "416:             const editor = hook.editor();",
      "417:             setAndAssertEmbed(editor, embedHtml, embedHtml);",
      "418:           };",
      "420:           const testConversion = (hook: TinyHooks.Hook<Editor>, embedHtml: string, expectedHtml: string) => () => {",
      "421:             const editor = hook.editor();",
      "422:             setAndAssertEmbed(editor, embedHtml, expectedHtml);",
      "423:           };",
      "425:           context('convert_unsafe_embeds default', () => {",
      "426:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "427:               ...options,",
      "428:               base_url: '/project/tinymce/js/tinymce'",
      "429:             }, []);",
      "431:             it('TINY-10349: Object elements should not be converted', testNoConversion(hook, '<object data=\"about:blank\"></object>'));",
      "432:             it('TINY-10349: Embed elements should not be converted', testNoConversion(hook, '<embed src=\"about:blank\">'));",
      "433:           });",
      "435:           context('convert_unsafe_embeds: false', () => {",
      "436:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "437:               ...options,",
      "438:               base_url: '/project/tinymce/js/tinymce',",
      "439:               convert_unsafe_embeds: false",
      "440:             }, []);",
      "442:             it('TINY-10349: Object elements should not be converted', testNoConversion(hook, '<object data=\"about:blank\"></object>'));",
      "443:             it('TINY-10349: Embed elements should not be converted', testNoConversion(hook, '<embed src=\"about:blank\">'));",
      "444:           });",
      "446:           context('convert_unsafe_embeds: true', () => {",
      "447:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "448:               ...options,",
      "449:               base_url: '/project/tinymce/js/tinymce',",
      "450:               convert_unsafe_embeds: true",
      "451:             }, []);",
      "453:             it('TINY-10349: Object elements should be converted to iframe',",
      "454:               testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
      "456:             it('TINY-10349: Embed elements should be converted to iframe',",
      "457:               testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\"></iframe>'));",
      "458:           });",
      "460:           context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
      "461:             const hook = TinyHooks.bddSetupLight<Editor>({",
      "462:               ...options,",
      "463:               base_url: '/project/tinymce/js/tinymce',",
      "464:               convert_unsafe_embeds: true,",
      "465:               sandbox_iframes: true",
      "466:             }, []);",
      "468:             it('TINY-10349: Object elements should be converted to sandboxed iframe',",
      "469:               testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "471:             it('TINY-10349: Embed elements should be converted to sandboxed iframe',",
      "472:               testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "473:           });",
      "474:         });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts": [
      "File: modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts -> modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "1531:           }));",
      "1532:         });",
      "1533:       });",
      "1534:     });",
      "1535:   });",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "1535:       context('Sandboxing iframes', () => {",
      "1536:         const serializeIframeHtml = (sandbox: boolean): string => {",
      "1537:           const parser = DomParser({ ...scenario.settings, sandbox_iframes: sandbox });",
      "1538:           return serializer.serialize(parser.parse('<iframe src=\"about:blank\"></iframe>'));",
      "1539:         };",
      "1541:         it('TINY-10348: iframes should be sandboxed when sandbox_iframes: false', () =>",
      "1542:           assert.equal(serializeIframeHtml(false), '<iframe src=\"about:blank\"></iframe>'));",
      "1544:         it('TINY-10348: iframes should be sandboxed when sandbox_iframes: true', () =>",
      "1545:           assert.equal(serializeIframeHtml(true), '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "1546:       });",
      "1548:       context('Convert unsafe embeds', () => {",
      "1549:         const serializeEmbedHtml = (embedHtml: string, convert: boolean): string => {",
      "1550:           const parser = DomParser({ ...scenario.settings, convert_unsafe_embeds: convert });",
      "1551:           return serializer.serialize(parser.parse(embedHtml));",
      "1552:         };",
      "1554:         const testConversion = (embedHtml: string, expectedHtml: string) => () => {",
      "1555:           const serializedHtml = serializeEmbedHtml(embedHtml, true);",
      "1556:           assert.equal(serializedHtml, expectedHtml);",
      "1557:         };",
      "1559:         context('convert_unsafe_embeds: false', () => {",
      "1560:           const testNoConversion = (embedHtml: string) => () => {",
      "1561:             const serializedHtml = serializeEmbedHtml(embedHtml, false);",
      "1562:             assert.equal(serializedHtml, embedHtml);",
      "1563:           };",
      "1565:           it('TINY-10349: Object elements should not be converted', testNoConversion('<object data=\"about:blank\"></object>'));",
      "1566:           it('TINY-10349: Object elements with a mime type should not be converted', testNoConversion('<object data=\"about:blank\" type=\"image/png\"></object>'));",
      "1567:           it('TINY-10349: Embed elements should notr be converted', testNoConversion('<embed src=\"about:blank\">'));",
      "1568:           it('TINY-10349: Embed elements with a mime type should not be converted', testNoConversion('<embed src=\"about:blank\" type=\"image/png\">'));",
      "1569:         });",
      "1571:         context('convert_unsafe_embeds: true', () => {",
      "1572:           it('TINY-10349: Object elements without a mime type should be converted to iframe',",
      "1573:             testConversion('<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
      "1574:           it('TINY-10349: Object elements with an image mime type should be converted to img',",
      "1575:             testConversion('<object data=\"about:blank\" type=\"image/png\"></object>', '<img src=\"about:blank\">'));",
      "1576:           it('TINY-10349: Object elements with a video mime type should be converted to video',",
      "1577:             testConversion('<object data=\"about:blank\" type=\"video/mp4\"></object>', '<video src=\"about:blank\" controls=\"\"></video>'));",
      "1578:           it('TINY-10349: Object elements with an audio mime type should be converted to audio',",
      "1579:             testConversion('<object data=\"about:blank\" type=\"audio/mpeg\"></object>', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1580:           it('TINY-10349: Object elements with other mime type should be converted to iframe',",
      "1581:             testConversion('<object data=\"about:blank\" type=\"application/pdf\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
      "1583:           it('TINY-10349: Embed elements without a mime type should be converted to iframe',",
      "1584:             testConversion('<embed src=\"about:blank\">', '<iframe src=\"about:blank\"></iframe>'));",
      "1585:           it('TINY-10349: Embed elements with an image mime type should be converted to img',",
      "1586:             testConversion('<embed src=\"about:blank\" type=\"image/png\">', '<img src=\"about:blank\">'));",
      "1587:           it('TINY-10349: Embed elements with a video mime type should be converted to video',",
      "1588:             testConversion('<embed src=\"about:blank\" type=\"video/mp4\">', '<video src=\"about:blank\" controls=\"\"></video>'));",
      "1589:           it('TINY-10349: Embed elements with an audio mime type should be converted to audio',",
      "1590:             testConversion('<embed src=\"about:blank\" type=\"audio/mpeg\">', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1591:           it('TINY-10349: Embed elements with other mime type should be converted to iframe',",
      "1592:             testConversion('<embed src=\"about:blank\" type=\"application/pdf\">', '<iframe src=\"about:blank\"></iframe>'));",
      "1593:         });",
      "1595:         context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
      "1596:           const testSandboxedConversion = (embedHtml: string, expectedHtml: string) => () => {",
      "1597:             const parser = DomParser({ ...scenario.settings, convert_unsafe_embeds: true, sandbox_iframes: true });",
      "1598:             const serializedHtml = serializer.serialize(parser.parse(embedHtml));",
      "1599:             assert.equal(serializedHtml, expectedHtml);",
      "1600:           };",
      "1602:           it('TINY-10349: Object elements without a mime type should be converted to sandboxed iframe',",
      "1603:             testSandboxedConversion('<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "1605:           it('TINY-10349: Embed elements without a mime type should be converted to sandboxed iframe',",
      "1606:             testSandboxedConversion('<embed src=\"about:blank\">', '<iframe src=\"about:blank\" sandbox=\"\"></iframe>'));",
      "1607:         });",
      "1609:         context('convert_unsafe_embeds: true, attribute preservation', () => {",
      "1610:           it('TINY-10349: Object elements should perserve width and height attributes only',",
      "1611:             testConversion('<object data=\"about:blank\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1612:           it('TINY-10349: Object elements with an image mime type should perserve width and height attributes only',",
      "1613:             testConversion('<object data=\"about:blank\" type=\"image/png\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<img src=\"about:blank\" width=\"100\" height=\"100\">'));",
      "1614:           it('TINY-10349: Object elements with a video mime type should perserve width and height attributes only',",
      "1615:             testConversion('<object data=\"about:blank\" type=\"video/mp4\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<video src=\"about:blank\" width=\"100\" height=\"100\" controls=\"\"></video>'));",
      "1616:           it('TINY-10349: Object elements with an audio mime type should not perserve other attributes only',",
      "1617:             testConversion('<object data=\"about:blank\" type=\"audio/mpeg\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1618:           it('TINY-10349: Object elements with other mime type should perserve width and height attributes only',",
      "1619:             testConversion('<object data=\"about:blank\" type=\"application/pdf\" width=\"100\" height=\"100\" style=\"color: red;\"></object>', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1621:           it('TINY-10349: Embed elements should preserve width and heigth attributes only',",
      "1622:             testConversion('<embed src=\"about:blank\" width=\"100\" height=\"100\" style=\"color: red;\">', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1623:           it('TINY-10349: Embed elements with an image mime type should preserve width and height attributes only',",
      "1624:             testConversion('<embed src=\"about:blank\" type=\"image/png\" width=\"100\" height=\"100\" style=\"color: red;\">', '<img src=\"about:blank\" width=\"100\" height=\"100\">'));",
      "1625:           it('TINY-10349: Embed elements with a video mime type should preserve width and height attributes only',",
      "1626:             testConversion('<embed src=\"about:blank\" type=\"video/mp4\" width=\"100\" height=\"100\" style=\"color: red;\">', '<video src=\"about:blank\" width=\"100\" height=\"100\" controls=\"\"></video>'));",
      "1627:           it('TINY-10349: Embed elements with an audio mime type should not preserve other attributes',",
      "1628:             testConversion('<embed src=\"about:blank\" type=\"audio/mpeg\" width=\"100\" height=\"100\" style=\"color: red;\">', '<audio src=\"about:blank\" controls=\"\"></audio>'));",
      "1629:           it('TINY-10349: Embed elements with other mime type should preserve width and height attributes only',",
      "1630:             testConversion('<embed src=\"about:blank\" type=\"application/pdf\" width=\"100\" height=\"100\" style=\"color: red;\">', '<iframe src=\"about:blank\" width=\"100\" height=\"100\"></iframe>'));",
      "1631:         });",
      "1632:       });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts": [
      "File: modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts -> modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "19:     base_url: '/project/tinymce/js/tinymce'",
      "20:   }, [], true);",
      "22:   beforeEach(() => {",
      "23:     const editor = hook.editor();",
      "24:     editor.setContent('');",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "22:   const testPasteHtml = (hook: TinyHooks.Hook<Editor>, html: string, expected: string) => () => {",
      "23:     const editor = hook.editor();",
      "24:     editor.setContent('');",
      "25:     editor.execCommand('mceInsertClipboardContent', false, { html });",
      "26:     TinyAssertions.assertContent(editor, expected);",
      "27:   };",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "505:       editor.off('beforeinput', setBeforeInputEvent);",
      "506:       editor.off('input', setInputEvent);",
      "507:     });",
      "508:   });",
      "509: });",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "516:     context('iframe sandboxing', () => {",
      "517:       context('sandbox_iframes: false', () => {",
      "518:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "519:           base_url: '/project/tinymce/js/tinymce',",
      "520:           sandbox_iframes: false",
      "521:         });",
      "523:         it('TINY-10348: Pasted iframe should not be sandboxed',",
      "524:           testPasteHtml(hook, '<iframe src=\"about:blank\"></iframe>', '<p><iframe src=\"about:blank\"></iframe></p>'));",
      "525:       });",
      "527:       context('sandbox_iframes: true', () => {",
      "528:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "529:           base_url: '/project/tinymce/js/tinymce',",
      "530:           sandbox_iframes: true",
      "531:         });",
      "533:         it('TINY-10348: Pasted iframe should be sandboxed',",
      "534:           testPasteHtml(hook, '<iframe src=\"about:blank\"></iframe>', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
      "535:       });",
      "536:     });",
      "538:     context('Convert unsafe embeds', () => {",
      "539:       context('convert_unsafe_embeds: false', () => {",
      "540:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "541:           base_url: '/project/tinymce/js/tinymce',",
      "542:           convert_unsafe_embeds: false",
      "543:         });",
      "545:         it('TINY-10349: Pasted object element should not be converted',",
      "546:           testPasteHtml(hook, '<object data=\"about:blank\"></object>', '<p><object data=\"about:blank\"></object></p>'));",
      "548:         it('TINY-10349: Pasted embed element should not be converted',",
      "549:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><embed src=\"about:blank\"></p>'));",
      "550:       });",
      "552:       context('convert_unsafe_embeds: true', () => {",
      "553:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "554:           base_url: '/project/tinymce/js/tinymce',",
      "555:           convert_unsafe_embeds: true",
      "556:         });",
      "558:         it('TINY-10349: Pasted object element should be converted to iframe',",
      "559:           testPasteHtml(hook, '<object data=\"about:blank\">', '<p><iframe src=\"about:blank\"></iframe></p>'));",
      "561:         it('TINY-10349: Pasted embed element should be converted to iframe',",
      "562:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><iframe src=\"about:blank\"></iframe></p>'));",
      "563:       });",
      "565:       context('convert_unsafe_embeds: true, sandbox_iframes: true', () => {",
      "566:         const hook = TinyHooks.bddSetupLight<Editor>({",
      "567:           base_url: '/project/tinymce/js/tinymce',",
      "568:           convert_unsafe_embeds: true,",
      "569:           sandbox_iframes: true",
      "570:         });",
      "572:         it('TINY-10349: Pasted object element should be converted to sandboxed iframe',",
      "573:           testPasteHtml(hook, '<object data=\"about:blank\"></object>', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
      "575:         it('TINY-10349: Pasted embed element should be converted to sandboxed iframe',",
      "576:           testPasteHtml(hook, '<embed src=\"about:blank\">', '<p><iframe src=\"about:blank\" sandbox=\"\"></iframe></p>'));",
      "577:       });",
      "578:     });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts||modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts": [
      "File: modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts -> modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "91:   if (name === 'iframe') {",
      "92:     previewNode.attr({",
      "93:       allowfullscreen: node.attr('allowfullscreen'),",
      "95:     });",
      "96:   } else {",
      "",
      "[Removed Lines]",
      "94:       frameborder: '0'",
      "",
      "[Added Lines]",
      "94:       frameborder: '0',",
      "95:       sandbox: node.attr('sandbox')",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts": [
      "File: modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "57:     );",
      "58:   });",
      "60:   it('TBA: Iframe with innerHTML retained as is with xss_sanitization: false', async () => {",
      "62:     const editor = await McEditor.pFromSettings<Editor>({",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "60:   it('TINY-10348: Iframe retained as is with sandbox_iframes: false', async () => {",
      "61:     const editor = await McEditor.pFromSettings({ ...settings, sandbox_iframes: false });",
      "62:     editor.setContent('<iframe src=\"320x240.ogg\" allowfullscreen></iframe>');",
      "63:     TinyAssertions.assertContent(editor,",
      "64:       '<p><iframe src=\"320x240.ogg\" width=\"300\" height=\"150\" allowfullscreen=\"allowfullscreen\"></iframe></p>'",
      "65:     );",
      "66:     McEditor.remove(editor);",
      "67:   });",
      "69:   it('TINY-10348: Iframe retained as is with sandbox_iframes: true', async () => {",
      "70:     const editor = await McEditor.pFromSettings({ ...settings, sandbox_iframes: true });",
      "71:     editor.setContent('<iframe src=\"320x240.ogg\" allowfullscreen></iframe>');",
      "72:     TinyAssertions.assertContent(editor,",
      "73:       '<p><iframe src=\"320x240.ogg\" width=\"300\" height=\"150\" sandbox=\"\" allowfullscreen=\"allowfullscreen\"></iframe></p>'",
      "74:     );",
      "75:     McEditor.remove(editor);",
      "76:   });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts": [
      "File: modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: import { ApproxStructure, Assertions, StructAssert, UiFinder } from '@ephox/agar';",
      "6: import Editor from 'tinymce/core/api/Editor';",
      "7: import Plugin from 'tinymce/plugins/media/Plugin';",
      "9: describe('browser.tinymce.plugins.media.core.LiveEmbedNodeTest', () => {",
      "11:     plugins: [ 'media' ],",
      "13:     base_url: '/project/tinymce/js/tinymce'",
      "14:   }, [ Plugin ]);",
      "",
      "[Removed Lines]",
      "2: import { describe, it } from '@ephox/bedrock-client';",
      "3: import { Arr, Fun, Obj } from '@ephox/katamari';",
      "4: import { TinyDom, TinyHooks } from '@ephox/wrap-mcagar';",
      "10:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "12:     toolbar: 'media',",
      "",
      "[Added Lines]",
      "2: import { context, describe, it } from '@ephox/bedrock-client';",
      "3: import { Arr, Fun, Obj, Type } from '@ephox/katamari';",
      "4: import { McEditor, TinyDom, TinyHooks } from '@ephox/wrap-mcagar';",
      "10:   const baseSettings = {",
      "12:     toolbar: 'media'",
      "13:   };",
      "14:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "15:     ...baseSettings,",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "17:     editor: Editor,",
      "18:     tag: string,",
      "19:     classes: string[],",
      "21:     styles: Record<string, string>,",
      "22:     getChildren: ApproxStructure.Builder<StructAssert[]> = Fun.constant([])",
      "23:   ) => {",
      "",
      "[Removed Lines]",
      "20:     attrs: Record<string, string>,",
      "",
      "[Added Lines]",
      "23:     attrs: Record<string, string | null>,",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "36:           attrs: {",
      "37:             height: str.none('should not have height'),",
      "38:             width: str.none('should not have width'),",
      "40:           },",
      "41:           styles: {",
      "42:             height: str.none('should not have height style'),",
      "",
      "[Removed Lines]",
      "39:             ...Obj.map(attrs, (value) => str.is(value))",
      "",
      "[Added Lines]",
      "42:             ...Obj.map(attrs, (value) => Type.isNull(value) ? str.none() : str.is(value))",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "131:       })",
      "132:     ]);",
      "133:   });",
      "134: });",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "138:   context('Sandboxing iframes', () => {",
      "139:     const initialIframeHtml = '<iframe src=\"about:blank\"></iframe>';",
      "141:     it('TINY-10348: sandbox_iframes: false should not have sandbox attribute in live embed', async () => {",
      "142:       const editor = await McEditor.pFromSettings<Editor>({ ...baseSettings, sandbox_iframes: false });",
      "143:       editor.setContent(initialIframeHtml);",
      "144:       assertStructure(editor, 'iframe', [ ], { sandbox: null }, { });",
      "145:     });",
      "147:     it('TINY-10348: sandbox_iframes: true should havce sandbox attribute in live embed', async () => {",
      "148:       const editor = await McEditor.pFromSettings<Editor>({ ...baseSettings, sandbox_iframes: true });",
      "149:       editor.setContent(initialIframeHtml);",
      "150:       assertStructure(editor, 'iframe', [ ], { sandbox: '' }, { });",
      "151:     });",
      "152:   });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts": [
      "File: modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "1: import { ApproxStructure, StructAssert, Waiter } from '@ephox/agar';",
      "2: import { before, context, describe, it } from '@ephox/bedrock-client';",
      "5: import Editor from 'tinymce/core/api/Editor';",
      "6: import Env from 'tinymce/core/api/Env';",
      "",
      "[Removed Lines]",
      "3: import { TinyAssertions, TinyHooks, TinyUiActions } from '@ephox/wrap-mcagar';",
      "",
      "[Added Lines]",
      "3: import { McEditor, TinyAssertions, TinyHooks, TinyUiActions } from '@ephox/wrap-mcagar';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "9: import * as Utils from '../module/test/Utils';",
      "11: describe('browser.tinymce.plugins.media.core.PlaceholderTest', () => {",
      "13:     plugins: [ 'media' ],",
      "14:     toolbar: 'media',",
      "16:     base_url: '/project/tinymce/js/tinymce'",
      "17:   }, [ Plugin ]);",
      "",
      "[Removed Lines]",
      "12:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "15:     extended_valid_elements: 'script[src|type]',",
      "",
      "[Added Lines]",
      "12:   const baseSettings = {",
      "15:     extended_valid_elements: 'script[src|type]'",
      "16:   };",
      "18:   const hook = TinyHooks.bddSetupLight<Editor>({",
      "19:     ...baseSettings,",
      "",
      "---------------",
      "--- Hunk 3 ---",
      "[Context before]",
      "42:     });",
      "43:   });",
      "63:   context('media_live_embeds=false', () => {",
      "64:     before(() => {",
      "65:       const editor = hook.editor();",
      "",
      "[Removed Lines]",
      "45:   const iframeStructure = ApproxStructure.build((s) => {",
      "46:     return s.element('body', {",
      "47:       children: [",
      "48:         s.element('p', {",
      "49:           children: [",
      "50:             s.element('span', {",
      "51:               children: [",
      "52:                 s.element('iframe', {}),",
      "53:                 s.element('span', {})",
      "54:               ]",
      "55:             })",
      "56:           ]",
      "57:         }),",
      "58:         s.theRest()",
      "59:       ]",
      "60:     });",
      "61:   });",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 4 ---",
      "[Context before]",
      "88:   });",
      "90:   context('media_live_embeds=true', () => {",
      "91:     before(() => {",
      "92:       const editor = hook.editor();",
      "93:       editor.options.set('media_live_embeds', true);",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "77:     const createIframeStructure = (sandbox: boolean) => ApproxStructure.build((s, str) => {",
      "78:       return s.element('body', {",
      "79:         children: [",
      "80:           s.element('p', {",
      "81:             children: [",
      "82:               s.element('span', {",
      "83:                 children: [",
      "84:                   s.element('iframe', {",
      "85:                     attrs: {",
      "86:                       sandbox: sandbox ? str.is('') : str.none()",
      "87:                     }",
      "88:                   }),",
      "89:                   s.element('span', {})",
      "90:                 ]",
      "91:               })",
      "92:             ]",
      "93:           }),",
      "94:           s.theRest()",
      "95:         ]",
      "96:       });",
      "97:     });",
      "",
      "---------------",
      "--- Hunk 5 ---",
      "[Context before]",
      "97:       'https://www.youtube.com/watch?v=P_205ZY52pY',",
      "98:       '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
      "99:       'height=\"314\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
      "101:     ));",
      "102:   });",
      "103: });",
      "",
      "[Removed Lines]",
      "100:       iframeStructure",
      "",
      "[Added Lines]",
      "108:       createIframeStructure(false)",
      "111:     it('TINY-10348: Live iframe embed structure when sandbox_iframes: false', async () => {",
      "112:       const editor = await McEditor.pFromSettings<Editor>({",
      "113:         ...baseSettings,",
      "114:         sandbox_iframes: false",
      "115:       });",
      "116:       pTestPlaceholder(editor,",
      "117:         'https://www.youtube.com/watch?v=P_205ZY52pY',",
      "118:         '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
      "119:         'height=\"314\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
      "120:         createIframeStructure(false)",
      "121:       );",
      "122:     });",
      "124:     it('TINY-10348: Live iframe embed structure when sandbox_iframes: true', async () => {",
      "125:       const editor = await McEditor.pFromSettings<Editor>({",
      "126:         ...baseSettings,",
      "127:         sandbox_iframes: true",
      "128:       });",
      "129:       pTestPlaceholder(editor,",
      "130:         'https://www.youtube.com/watch?v=P_205ZY52pY',",
      "131:         '<p><iframe src=\"https://www.youtube.com/embed/P_205ZY52pY\" width=\"560\" ' +",
      "132:         'height=\"314\" sandbox=\"\" allowfullscreen=\"allowfullscreen\"></iframe></p>',",
      "133:         createIframeStructure(true)",
      "134:       );",
      "135:     });",
      "",
      "---------------"
    ],
    "modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts||modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts": [
      "File: modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts -> modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts",
      "--- Hunk 1 ---",
      "[Context before]",
      "6: import Editor from 'tinymce/core/api/Editor';",
      "7: import LinkPlugin from 'tinymce/plugins/link/Plugin';",
      "8: import QuickbarsPlugin from 'tinymce/plugins/quickbars/Plugin';",
      "10: enum Alignment {",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "8: import PageBreakPlugin from 'tinymce/plugins/pagebreak/Plugin';",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "20:     toolbar: false,",
      "21:     menubar: false,",
      "22:     base_url: '/project/tinymce/js/tinymce'",
      "25:   const imgSrc = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';",
      "",
      "[Removed Lines]",
      "23:   }, [ LinkPlugin, QuickbarsPlugin ], true);",
      "",
      "[Added Lines]",
      "24:   }, [ LinkPlugin, QuickbarsPlugin, PageBreakPlugin ], true);",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "70a5a95fce2489b9bb17b63478ea7917e308ae59",
      "candidate_info": {
        "commit_hash": "70a5a95fce2489b9bb17b63478ea7917e308ae59",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/70a5a95fce2489b9bb17b63478ea7917e308ae59",
        "files": [
          ".changes/unreleased/tinymce-TINY-10351-2024-01-04.yaml",
          "modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/delete/MediaDeleteTest.ts",
          "modules/tinymce/src/core/test/ts/browser/keyboard/MediaNavigationTest.ts",
          "modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts"
        ],
        "message": "TINY-10351: Default convert_unsafe_embeds to true (#9281)\n\n* TINY-10351: Default  to true\n\n* TINY-10351: Ensure convert_unsafe_embeds option is respected in paste preprocessing\n\n* TINY-10351: Clarify changelog entry\n\n* TINY-10351: Set convert_unsafe_embeds to false in unrelated tests to ensure the behavior to be tested remains consistent\n\n---------\n\nCo-authored-by: MitchCTiny <89239746+MitchCTiny@users.noreply.github.com>",
        "before_after_code_files": [
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/delete/MediaDeleteTest.ts||modules/tinymce/src/core/test/ts/browser/delete/MediaDeleteTest.ts",
          "modules/tinymce/src/core/test/ts/browser/keyboard/MediaNavigationTest.ts||modules/tinymce/src/core/test/ts/browser/keyboard/MediaNavigationTest.ts",
          "modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts||modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts",
          "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
            "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
            "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
            "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
            "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "844:   registerOption('convert_unsafe_embeds', {",
          "845:     processor: 'boolean',",
          "847:   });",
          "",
          "[Removed Lines]",
          "846:     default: false",
          "",
          "[Added Lines]",
          "846:     default: true",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts": [
          "File: modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts -> modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: }",
          "13: const preProcess = (editor: Editor, html: string): string => {",
          "17:   parser.addNodeFilter('meta', (nodes) => {",
          "",
          "[Removed Lines]",
          "14:   const parser = DomParser({ sanitize: Options.shouldSanitizeXss(editor), sandbox_iframes: Options.shouldSandboxIframes(editor) }, editor.schema);",
          "",
          "[Added Lines]",
          "14:   const parser = DomParser({",
          "15:     sanitize: Options.shouldSanitizeXss(editor),",
          "16:     sandbox_iframes: Options.shouldSandboxIframes(editor),",
          "17:     convert_unsafe_embeds: Options.shouldConvertUnsafeEmbeds(editor)",
          "18:   }, editor.schema);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts -> modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "428:               base_url: '/project/tinymce/js/tinymce'",
          "429:             }, []);",
          "433:           });",
          "435:           context('convert_unsafe_embeds: false', () => {",
          "",
          "[Removed Lines]",
          "431:             it('TINY-10349: Object elements should not be converted', testNoConversion(hook, '<object data=\"about:blank\"></object>'));",
          "432:             it('TINY-10349: Embed elements should not be converted', testNoConversion(hook, '<embed src=\"about:blank\">'));",
          "",
          "[Added Lines]",
          "431:             it('TINY-10349: Object elements should be converted', testConversion(hook, '<object data=\"about:blank\"></object>', '<iframe src=\"about:blank\"></iframe>'));",
          "432:             it('TINY-10349: Embed elements should be converted', testConversion(hook, '<embed src=\"about:blank\">', '<iframe src=\"about:blank\"></iframe>'));",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/delete/MediaDeleteTest.ts||modules/tinymce/src/core/test/ts/browser/delete/MediaDeleteTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/delete/MediaDeleteTest.ts -> modules/tinymce/src/core/test/ts/browser/delete/MediaDeleteTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "9: describe('browser.tinymce.core.delete.MediaDeleteTest', () => {",
          "10:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "12:   }, [], true);",
          "14:   const assertEmptyEditorStructure = (editor: Editor) => TinyAssertions.assertContentStructure(editor, ApproxStructure.build((s, str) =>",
          "",
          "[Removed Lines]",
          "11:     base_url: '/project/tinymce/js/tinymce'",
          "",
          "[Added Lines]",
          "11:     base_url: '/project/tinymce/js/tinymce',",
          "12:     convert_unsafe_embeds: false",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/keyboard/MediaNavigationTest.ts||modules/tinymce/src/core/test/ts/browser/keyboard/MediaNavigationTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/keyboard/MediaNavigationTest.ts -> modules/tinymce/src/core/test/ts/browser/keyboard/MediaNavigationTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "13:   const hook = TinyHooks.bddSetupLight<Editor>({",
          "14:     height: 400,",
          "15:     indent: false,",
          "17:   }, [], true);",
          "19:   const assertStartContainer = (editor: Editor, f: (node: Node) => boolean) => {",
          "",
          "[Removed Lines]",
          "16:     base_url: '/project/tinymce/js/tinymce'",
          "",
          "[Added Lines]",
          "16:     base_url: '/project/tinymce/js/tinymce',",
          "17:     convert_unsafe_embeds: false",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts||modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts -> modules/tinymce/src/core/test/ts/browser/paste/ProcessFiltersTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "113:     const result = processPrePost(editor, 'a<b>b</b>c', true, preProcessHandler(), preventHandler);",
          "114:     assert.deepEqual(result, { content: 'a<b>b</b>cX', cancelled: true }, 'Should have a X added and be cancelled');",
          "115:   });",
          "116: });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "117:   it('TINY-10351: Unsafe embeds should be converted on preprocess/postprocess', () => {",
          "118:     const editor = hook.editor();",
          "120:     const objectRes = processPrePost(editor, '<object data=\"about:blank\"></object>', true, Fun.noop, Fun.noop);",
          "121:     assert.deepEqual(objectRes, { content: '<iframe src=\"about:blank\"></iframe>', cancelled: false }, '<object> should be converted');",
          "123:     const embedRes = processPrePost(editor, '<embed src=\"about:blank\">', true, Fun.noop, Fun.noop);",
          "124:     assert.deepEqual(embedRes, { content: '<iframe src=\"about:blank\"></iframe>', cancelled: false }, '<embed> should be converted');",
          "125:   });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts||modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts": [
          "File: modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts -> modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "12:     media_live_embeds: false,",
          "13:     document_base_url: '/tinymce/tinymce/trunk/tests/',",
          "14:     extended_valid_elements: 'script[src|type]',",
          "16:   };",
          "17:   const hook = TinyHooks.bddSetupLight<Editor>(settings, [ Plugin ]);",
          "",
          "[Removed Lines]",
          "15:     allow_conditional_comments: true",
          "",
          "[Added Lines]",
          "15:     allow_conditional_comments: true,",
          "16:     convert_unsafe_embeds: false",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "ccdbcc74e96830707ae3e1fa685372c047a7bc6c",
      "candidate_info": {
        "commit_hash": "ccdbcc74e96830707ae3e1fa685372c047a7bc6c",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/ccdbcc74e96830707ae3e1fa685372c047a7bc6c",
        "files": [
          "modules/tinymce/CHANGELOG.md",
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/api/dom/DOMUtils.ts",
          "modules/tinymce/src/core/main/ts/api/html/Styles.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/test/ts/browser/html/StylesTest.ts",
          "modules/tinymce/src/themes/silver/test/ts/browser/editor/ForceHexColorTest.ts"
        ],
        "message": "TINY-9819: Added force_hex_color option (#9105)\n\n* Added `force_hex_color` option\n\nSetting to `'always'` will cause all data-mce-style colors to use HEX instead of RGB.\n`\"rgb_only\"` will only convert RGB and not RGBA.\n`\"off\"` will do nothing and leave colors as they were.\n\n* Condense if statement block and improve readability\n\nCo-authored-by: spocke <spocke@moxiecode.com>\n\n* Refactored tests\n\nMoved editor related tests to `ForceHexColorTest.ts`. As well as adding force_hex_color specific tests to `StylesTest.ts`\n\n* Fixed a selection bug and added `assertContent` call for more test coverage\n\n* Added ForceHexColor type\n\n* Processor for force_hex_color option now utilises the ForceHexColor type\n\n* Use `Type.isString` instead of the `typeof` builtin\n\n---------\n\nCo-authored-by: spocke <spocke@moxiecode.com>",
        "before_after_code_files": [
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/api/dom/DOMUtils.ts||modules/tinymce/src/core/main/ts/api/dom/DOMUtils.ts",
          "modules/tinymce/src/core/main/ts/api/html/Styles.ts||modules/tinymce/src/core/main/ts/api/html/Styles.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/test/ts/browser/html/StylesTest.ts||modules/tinymce/src/core/test/ts/browser/html/StylesTest.ts",
          "modules/tinymce/src/themes/silver/test/ts/browser/editor/ForceHexColorTest.ts||modules/tinymce/src/themes/silver/test/ts/browser/editor/ForceHexColorTest.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts": [
          "File: modules/tinymce/src/core/main/ts/api/OptionTypes.ts -> modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "44: export type ToolbarMode = 'floating' | 'sliding' | 'scrolling' | 'wrap';",
          "45: export type ToolbarLocation = 'top' | 'bottom' | 'auto';",
          "47: interface BaseEditorOptions {",
          "48:   a11y_advanced_options?: boolean;",
          "49:   add_form_submit_trigger?: boolean;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "47: export type ForceHexColor = 'always' | 'rgb_only' | 'off';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "117:   font_size_style_values?: string;",
          "118:   font_size_formats?: string;",
          "119:   font_size_input_default_unit?: string;",
          "120:   forced_root_block?: string;",
          "121:   forced_root_block_attrs?: Record<string, string>;",
          "122:   formats?: Formats;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "122:   force_hex_color?: ForceHexColor;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "300:   font_size_style_values: string;",
          "301:   forced_root_block: string;",
          "302:   forced_root_block_attrs: Record<string, string>;",
          "303:   format_noneditable_selector: string;",
          "304:   height: number | string;",
          "305:   highlight_on_focus: boolean;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "306:   force_hex_color: ForceHexColor;",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: import * as PatternTypes from '../textpatterns/core/PatternTypes';",
          "6: import DOMUtils from './dom/DOMUtils';",
          "7: import Editor from './Editor';",
          "9: import I18n from './util/I18n';",
          "10: import Tools from './util/Tools';",
          "",
          "[Removed Lines]",
          "8: import { EditorOptions } from './OptionTypes';",
          "",
          "[Added Lines]",
          "8: import { EditorOptions, ForceHexColor } from './OptionTypes';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "827:     default: ''",
          "828:   });",
          "831:   editor.on('ScriptsLoaded', () => {",
          "832:     registerOption('directionality', {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "830:   registerOption('force_hex_color', {",
          "831:     processor: (value) => {",
          "832:       const options: ForceHexColor[] = [ 'always', 'rgb_only', 'off' ];",
          "833:       const valid = Arr.contains(options, value);",
          "834:       return valid ? { value, valid } : { valid: false, message: `Must be one of: ${options.join(', ')}.` };",
          "835:     },",
          "836:     default: 'off',",
          "837:   });",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "956: const getDetailsInitialState = option('details_initial_state');",
          "957: const getDetailsSerializedState = option('details_serialized_state');",
          "959: export {",
          "960:   register,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "968: const shouldForceHexColor = option('force_hex_color');",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1059:   shouldSanitizeXss,",
          "1060:   getDetailsInitialState,",
          "1061:   getDetailsSerializedState,",
          "1063: };",
          "",
          "[Removed Lines]",
          "1062:   shouldUseDocumentWrite",
          "",
          "[Added Lines]",
          "1073:   shouldUseDocumentWrite,",
          "1074:   shouldForceHexColor",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/dom/DOMUtils.ts||modules/tinymce/src/core/main/ts/api/dom/DOMUtils.ts": [
          "File: modules/tinymce/src/core/main/ts/api/dom/DOMUtils.ts -> modules/tinymce/src/core/main/ts/api/dom/DOMUtils.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "11: import Entities from '../html/Entities';",
          "12: import Schema from '../html/Schema';",
          "13: import Styles, { StyleMap } from '../html/Styles';",
          "15: import { MappedEvent } from '../util/EventDispatcher';",
          "16: import Tools from '../util/Tools';",
          "17: import EventUtils, { EventUtilsCallback } from './EventUtils';",
          "",
          "[Removed Lines]",
          "14: import { URLConverter } from '../OptionTypes';",
          "",
          "[Added Lines]",
          "14: import { ForceHexColor, URLConverter } from '../OptionTypes';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "65:   onSetAttrib: (event: SetAttribEvent) => void;",
          "66:   contentCssCors: boolean;",
          "67:   referrerPolicy: ReferrerPolicy;",
          "68: }",
          "70: export type Target = Node | Window;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "68:   force_hex_color: ForceHexColor;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "338:   const schema = settings.schema ? settings.schema : Schema({});",
          "339:   const styles = Styles({",
          "340:     url_converter: settings.url_converter,",
          "342:   }, settings.schema);",
          "344:   const events = settings.ownEvents ? new EventUtils() : EventUtils.Event;",
          "",
          "[Removed Lines]",
          "341:     url_converter_scope: settings.url_converter_scope",
          "",
          "[Added Lines]",
          "342:     url_converter_scope: settings.url_converter_scope,",
          "343:     force_hex_color: settings.force_hex_color,",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/html/Styles.ts||modules/tinymce/src/core/main/ts/api/html/Styles.ts": [
          "File: modules/tinymce/src/core/main/ts/api/html/Styles.ts -> modules/tinymce/src/core/main/ts/api/html/Styles.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: import Schema, { SchemaMap } from './Schema';",
          "24: export type StyleMap = Record<string, string | number>;",
          "",
          "[Removed Lines]",
          "19: import { Obj, Unicode } from '@ephox/katamari';",
          "21: import { URLConverter } from '../OptionTypes';",
          "",
          "[Added Lines]",
          "19: import { RgbaColour, Transformations } from '@ephox/acid';",
          "20: import { Obj, Type, Unicode } from '@ephox/katamari';",
          "22: import { ForceHexColor, URLConverter } from '../OptionTypes';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "28:   allow_svg_data_urls?: boolean;",
          "29:   url_converter?: URLConverter;",
          "30:   url_converter_scope?: any;",
          "31: }",
          "33: interface Styles {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "32:   force_hex_color?: ForceHexColor;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "263:               value = value.toLowerCase();",
          "264:             }",
          "267:             value = value.replace(urlOrStrRegExp, processUrl);",
          "268:             styles[name] = isEncoded ? decode(value, true) : value;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "269:             if (Type.isString(settings.force_hex_color) && settings.force_hex_color !== 'off') {",
          "270:               RgbaColour.fromString(value).each((rgba) => {",
          "272:                 if (settings.force_hex_color === 'always' || rgba.alpha === 1) {",
          "273:                   value = Transformations.rgbaToHexString(RgbaColour.toString(rgba));",
          "274:                 }",
          "275:               });",
          "276:             }",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts": [
          "File: modules/tinymce/src/core/main/ts/init/InitContentBody.ts -> modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "432:     referrerPolicy: Options.getReferrerPolicy(editor),",
          "433:     onSetAttrib: (e) => {",
          "434:       editor.dispatch('SetAttrib', e);",
          "436:   });",
          "438:   editor.parser = createParser(editor);",
          "",
          "[Removed Lines]",
          "435:     }",
          "",
          "[Added Lines]",
          "435:     },",
          "436:     force_hex_color: Options.shouldForceHexColor(editor),",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/html/StylesTest.ts||modules/tinymce/src/core/test/ts/browser/html/StylesTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/html/StylesTest.ts -> modules/tinymce/src/core/test/ts/browser/html/StylesTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "234:     assertStyles(styles, 'background:url(javascript:alert(1)', `background: url('javascript:alert(1');`);",
          "235:     assertStyles(styles, 'background:url(vbscript:alert(1)', `background: url('vbscript:alert(1');`);",
          "236:   });",
          "237: });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "238:   it('TINY-9819: force_hex_color set to \"off\" (the default)', () => {",
          "239:     const styles = Styles();",
          "240:     for (const color of [",
          "241:       '#aabbcc',",
          "242:       'rgb(1, 2, 3)',",
          "243:       'rgba(1, 2, 3, 0.5)',",
          "244:       `rgba(200, 150, 100, 0.95)`",
          "245:     ]) {",
          "247:       assertStyles(styles, `color: ${color};`, `color: ${color};`);",
          "248:     }",
          "249:   });",
          "251:   it('TINY-9819: force_hex_color set to \"always\"', () => {",
          "252:     const styles = Styles({ force_hex_color: 'always' });",
          "253:     assertStyles(styles, 'color: #aabbcc;', 'color: #aabbcc;');",
          "254:     assertStyles(styles, 'color: rgb(1, 2, 3);', 'color: #010203;');",
          "255:     assertStyles(styles, 'color: rgba(1, 2, 3, 1);', 'color: #010203;');",
          "256:     assertStyles(styles, 'color: rgba(1, 2, 3, 0);', 'color: #010203;');",
          "257:     assertStyles(styles, 'color: rgba(1, 2, 3, 0.5);', 'color: #010203;');",
          "258:   });",
          "260:   it('TINY-9819: force_hex_color set to \"rgb_only\"', () => {",
          "261:     const styles = Styles({ force_hex_color: 'rgb_only' });",
          "262:     assertStyles(styles, 'color: #aabbcc;', 'color: #aabbcc;');",
          "263:     assertStyles(styles, 'color: rgb(1, 2, 3);', 'color: #010203;');",
          "264:     assertStyles(styles, 'color: rgba(1, 2, 3, 1);', 'color: #010203;');",
          "265:     assertStyles(styles, 'color: rgba(1, 2, 3, 0);', 'color: rgba(1, 2, 3, 0);');",
          "266:     assertStyles(styles, 'color: rgba(1, 2, 3, 0.5);', 'color: rgba(1, 2, 3, 0.5);');",
          "267:   });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/themes/silver/test/ts/browser/editor/ForceHexColorTest.ts||modules/tinymce/src/themes/silver/test/ts/browser/editor/ForceHexColorTest.ts": [
          "File: modules/tinymce/src/themes/silver/test/ts/browser/editor/ForceHexColorTest.ts -> modules/tinymce/src/themes/silver/test/ts/browser/editor/ForceHexColorTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { Transformations } from '@ephox/acid';",
          "2: import { context, describe, it } from '@ephox/bedrock-client';",
          "3: import { TinyAssertions, TinyHooks, TinySelections, TinyUiActions } from '@ephox/wrap-mcagar';",
          "4: import { assert } from 'chai';",
          "6: import Editor from 'tinymce/core/api/Editor';",
          "8: describe('browser.tinymce.themes.silver.editor.ForceHexColorTest', () => {",
          "9:   const applyAndAssertForeColor = (editor: Editor, appliedColor: string, expectedColor: string) => {",
          "11:     editor.setContent('<p>colour me</p>');",
          "13:     return {",
          "15:       usingCommand: () => {",
          "16:         TinySelections.setSelection(editor, [ 0, 0 ], 0, [ 0, 0 ], 'color me'.length + 1);",
          "17:         editor.execCommand('mceApplyTextcolor', 'forecolor' as any, appliedColor);",
          "18:         TinyAssertions.assertContentPresence(editor, { [`span[data-mce-style=\"color: ${expectedColor};\"]`]: 1 });",
          "19:         TinyAssertions.assertContent(editor, `<p><span style=\"color: ${expectedColor};\">colour me</span></p>`);",
          "20:       },",
          "22:       usingToolbar: async () => {",
          "23:         TinySelections.setSelection(editor, [ 0, 0 ], 0, [ 0, 0 ], 'color me'.length + 1);",
          "24:         TinyUiActions.clickOnToolbar(editor, '[aria-label^=\"Text color\"] > .tox-tbtn + .tox-split-button__chevron');",
          "25:         await TinyUiActions.pWaitForUi(editor, '.tox-swatches');",
          "26:         TinyUiActions.clickOnUi(editor, `div[data-mce-color=\"${appliedColor}\"]`);",
          "27:         TinyAssertions.assertContentPresence(editor, { [`span[data-mce-style=\"color: ${expectedColor};\"]`]: 1 });",
          "28:         TinyAssertions.assertContent(editor, `<p><span style=\"color: ${expectedColor};\">colour me</span></p>`);",
          "29:       },",
          "30:     };",
          "31:   };",
          "33:   context('force_hex_color option set to default (\"off\")', () => {",
          "34:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "35:       base_url: '/project/tinymce/js/tinymce',",
          "36:     }, []);",
          "38:     it('TINY-9819: data-mce-style colors are left as RGB', () => {",
          "39:       const editor = hook.editor();",
          "40:       assert.equal(editor.options.get('force_hex_color'), 'off', 'force_hex_color must be set to \"off\"');",
          "41:       applyAndAssertForeColor(editor, '#E03E2D', 'rgb(224, 62, 45)').usingCommand();",
          "42:       applyAndAssertForeColor(editor, '#FF0000', 'rgb(255, 0, 0)').usingCommand();",
          "43:       applyAndAssertForeColor(editor, '#00FF00', 'rgb(0, 255, 0)').usingCommand();",
          "44:       applyAndAssertForeColor(editor, 'rgb(40, 120, 200)', 'rgb(40, 120, 200)').usingCommand();",
          "45:     });",
          "47:     it('TINY-9819: alpha channel is unaffected', () => {",
          "48:       const editor = hook.editor();",
          "49:       applyAndAssertForeColor(editor, 'rgba(224, 62, 45, 0.5)', 'rgba(224, 62, 45, 0.5)').usingCommand();",
          "50:       applyAndAssertForeColor(editor, 'rgba(3, 2, 1, 0.01)', 'rgba(3, 2, 1, 0.01)').usingCommand();",
          "51:     });",
          "52:   });",
          "54:   context('force_hex_color option set to \"rgb_only\"', () => {",
          "55:     const color_map = [ '#E03E2D', 'Red', 'rgb(10, 200, 10)', 'Green' ];",
          "56:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "57:       base_url: '/project/tinymce/js/tinymce',",
          "58:       force_hex_color: 'rgb_only',",
          "59:       toolbar: 'forecolor',",
          "60:       color_map,",
          "61:     }, []);",
          "63:     it('TINY-9819: will leave RGBA colors unaffected', () => {",
          "64:       const editor = hook.editor();",
          "65:       assert.equal(editor.options.get('force_hex_color'), 'rgb_only', 'force_hex_color must be set to \"rgb_only\"');",
          "66:       applyAndAssertForeColor(editor, 'rgba(50, 60, 70, 0.4)', 'rgba(50, 60, 70, 0.4)').usingCommand();",
          "67:     });",
          "69:     it('TINY-9819: will convert RGB to HEX', () => {",
          "70:       applyAndAssertForeColor(hook.editor(), 'rgb(50, 60, 70)', '#323C46').usingCommand();",
          "71:       applyAndAssertForeColor(hook.editor(), 'rgb(105, 72, 72)', '#694848').usingCommand();",
          "72:     });",
          "74:     it('TINY-9819: will convert RGB to HEX with toolbar & color_map', async () => {",
          "75:       const editor = hook.editor();",
          "76:       await applyAndAssertForeColor(editor, color_map[0], color_map[0]).usingToolbar();",
          "77:       const hex = Transformations.rgbaToHexString(color_map[2]);",
          "78:       await applyAndAssertForeColor(editor, hex, hex).usingToolbar();",
          "79:     });",
          "80:   });",
          "82:   context('force_hex_color option set to \"always\"', () => {",
          "83:     const color_map = [ '#E03E2D', 'Red', 'rgb(10, 200, 10)', 'Green', 'rgba(10, 10, 200, 0.9)', 'Blue' ];",
          "84:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "85:       base_url: '/project/tinymce/js/tinymce',",
          "86:       force_hex_color: 'always',",
          "87:       toolbar: 'forecolor',",
          "88:       color_map,",
          "89:     }, []);",
          "91:     it('TINY-9819: will convert RGB & RGBA to HEX', () => {",
          "92:       const editor = hook.editor();",
          "93:       assert.equal(editor.options.get('force_hex_color'), 'always', 'force_hex_color must be set to \"always\"');",
          "94:       applyAndAssertForeColor(editor, 'rgb(50, 60, 70)', '#323C46').usingCommand();",
          "95:       applyAndAssertForeColor(editor, 'rgba(50, 60, 70, 0.4)', '#323C46').usingCommand();",
          "96:     });",
          "98:     it('TINY-9819: will convert RGB & RGBA to HEX with toolbar & color_map', async () => {",
          "99:       const editor = hook.editor();",
          "100:       await applyAndAssertForeColor(editor, color_map[0], color_map[0]).usingToolbar();",
          "101:       let hex = Transformations.rgbaToHexString(color_map[2]);",
          "102:       await applyAndAssertForeColor(editor, hex, hex).usingToolbar();",
          "103:       hex = Transformations.rgbaToHexString(color_map[4]);",
          "104:       await applyAndAssertForeColor(editor, hex, hex).usingToolbar();",
          "105:     });",
          "106:   });",
          "108:   context('force_hex_color option set to \"always\" and without color_map', () => {",
          "109:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "110:       base_url: '/project/tinymce/js/tinymce',",
          "111:       force_hex_color: 'always',",
          "112:       toolbar: 'forecolor',",
          "113:     }, []);",
          "115:     it('TINY-9819: will convert RGB & RGBA to HEX', () => {",
          "116:       const editor = hook.editor();",
          "117:       assert.isFalse(editor.options.isSet('color_map'));",
          "119:       applyAndAssertForeColor(editor, '#00FF00', '#00FF00').usingCommand();",
          "120:       applyAndAssertForeColor(editor, 'rgb(10, 200, 10)', '#0AC80A').usingCommand();",
          "121:       applyAndAssertForeColor(editor, 'rgba(10, 10, 200, 0.9)', '#0A0AC8').usingCommand();",
          "122:     });",
          "124:     it('TINY-9819: will convert RGB & RGBA to HEX with toolbar & without color_map', async () => {",
          "125:       const editor = hook.editor();",
          "126:       await applyAndAssertForeColor(editor, '#BA372A', '#BA372A').usingToolbar();",
          "127:       await applyAndAssertForeColor(editor, '#3598DB', '#3598DB').usingToolbar();",
          "128:       await applyAndAssertForeColor(editor, '#B96AD9', '#B96AD9').usingToolbar();",
          "129:     });",
          "130:   });",
          "131: });",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "27227cc2fa54d432753449f9ca91cb089bb469c4",
      "candidate_info": {
        "commit_hash": "27227cc2fa54d432753449f9ca91cb089bb469c4",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/27227cc2fa54d432753449f9ca91cb089bb469c4",
        "files": [
          "modules/tinymce/CHANGELOG.md",
          "modules/tinymce/src/core/demo/ts/demo/FullDemo.ts",
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/init/InitIframe.ts",
          "modules/tinymce/src/core/test/ts/browser/init/InitDocumentWriteTest.ts"
        ],
        "message": "TINY-9818: Add option to restore document.write behaviour (#8724)\n\n* TINY-9818: Added document_write option\n\n* TINY-9818: Added test and changelog item\n\n* TINY-9818: Renamed the option\n\n* TINY-9818: Switched to UiFinder",
        "before_after_code_files": [
          "modules/tinymce/src/core/demo/ts/demo/FullDemo.ts||modules/tinymce/src/core/demo/ts/demo/FullDemo.ts",
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/init/InitIframe.ts||modules/tinymce/src/core/main/ts/init/InitIframe.ts",
          "modules/tinymce/src/core/test/ts/browser/init/InitDocumentWriteTest.ts||modules/tinymce/src/core/test/ts/browser/init/InitDocumentWriteTest.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/tinymce/src/core/demo/ts/demo/FullDemo.ts||modules/tinymce/src/core/demo/ts/demo/FullDemo.ts": [
          "File: modules/tinymce/src/core/demo/ts/demo/FullDemo.ts -> modules/tinymce/src/core/demo/ts/demo/FullDemo.ts"
        ],
        "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts": [
          "File: modules/tinymce/src/core/main/ts/api/OptionTypes.ts -> modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "284:   contextmenu: string[];",
          "285:   custom_colors: boolean;",
          "286:   document_base_url: string;",
          "287:   draggable_modal: boolean;",
          "288:   editable_class: string;",
          "289:   font_css: string[];",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "287:   init_content_sync: boolean;",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "807:     default: 'inherited'",
          "808:   });",
          "811:   editor.on('ScriptsLoaded', () => {",
          "812:     registerOption('directionality', {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "810:   registerOption('init_content_sync', {",
          "811:     processor: 'boolean',",
          "812:     default: false",
          "813:   });",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "912: const shouldPreserveCData = option('preserve_cdata');",
          "913: const shouldHighlightOnFocus = option('highlight_on_focus');",
          "914: const shouldSanitizeXss = option('xss_sanitization');",
          "916: const hasTextPatternsLookup = (editor: Editor): boolean =>",
          "917:   editor.options.isSet('text_patterns_lookup');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "920: const shouldUseDocumentWrite = option('init_content_sync');",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1033:   shouldHighlightOnFocus,",
          "1034:   shouldSanitizeXss,",
          "1035:   getDetailsInitialState,",
          "1037: };",
          "",
          "[Removed Lines]",
          "1036:   getDetailsSerializedState",
          "",
          "[Added Lines]",
          "1042:   getDetailsSerializedState,",
          "1043:   shouldUseDocumentWrite",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/init/InitIframe.ts||modules/tinymce/src/core/main/ts/init/InitIframe.ts": [
          "File: modules/tinymce/src/core/main/ts/init/InitIframe.ts -> modules/tinymce/src/core/main/ts/init/InitIframe.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "81: const setupIframeBody = (editor: Editor): void => {",
          "83:   const iframe = editor.iframeElement as HTMLIFrameElement;",
          "88:     editor.contentDocument = iframe.contentDocument as Document;",
          "91:     InitContentBody.contentBodyLoaded(editor);",
          "97:     const doc = editor.getDoc();",
          "98:     doc.open();",
          "99:     doc.write(editor.iframeHTML as string);",
          "100:     doc.close();",
          "101:   } else {",
          "102:     iframe.srcdoc = editor.iframeHTML as string;",
          "103:   }",
          "104: };",
          "",
          "[Removed Lines]",
          "84:   const binder = DomEvent.bind(SugarElement.fromDom(iframe), 'load', () => {",
          "85:     binder.unbind();",
          "92:   });",
          "96:   if (Env.browser.isFirefox()) {",
          "",
          "[Added Lines]",
          "84:   const ready = () => {",
          "90:   };",
          "94:   if (Options.shouldUseDocumentWrite(editor) || Env.browser.isFirefox()) {",
          "99:     ready();",
          "101:     const binder = DomEvent.bind(SugarElement.fromDom(iframe), 'load', () => {",
          "102:       binder.unbind();",
          "103:       ready();",
          "104:     });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/init/InitDocumentWriteTest.ts||modules/tinymce/src/core/test/ts/browser/init/InitDocumentWriteTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/init/InitDocumentWriteTest.ts -> modules/tinymce/src/core/test/ts/browser/init/InitDocumentWriteTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { UiFinder } from '@ephox/agar';",
          "2: import { describe, it } from '@ephox/bedrock-client';",
          "3: import { TinyDom, TinyHooks } from '@ephox/wrap-mcagar';",
          "4: import { assert } from 'chai';",
          "6: import Editor from 'tinymce/core/api/Editor';",
          "8: describe('browser.tinymce.core.init.InitDocumentWriteTest', () => {",
          "9:   const hook = TinyHooks.bddSetup<Editor>({",
          "10:     base_url: '/project/tinymce/js/tinymce',",
          "11:     init_content_sync: true",
          "12:   }, [], true);",
          "14:   it('TINY-9818: Should initialize the editor', () => {",
          "15:     const editor = hook.editor();",
          "16:     const ifr = UiFinder.findIn<HTMLIFrameElement>(TinyDom.container(editor), 'iframe').getOrDie();",
          "17:     assert.isEmpty(ifr.dom.srcdoc, 'Should not have srcdoc set to a non empty string');",
          "18:     UiFinder.exists(TinyDom.documentElement(editor), 'link');",
          "19:   });",
          "20: });",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "7a8394ad9a7558af17a9d2c15c729624053ee6f6",
      "candidate_info": {
        "commit_hash": "7a8394ad9a7558af17a9d2c15c729624053ee6f6",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/7a8394ad9a7558af17a9d2c15c729624053ee6f6",
        "files": [
          "modules/tinymce/CHANGELOG.md",
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
          "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/InsertUnsanitizedContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
          "modules/tinymce/src/core/test/ts/browser/init/InitUnsanitizedContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/paste/UnsanitizedPasteTest.ts",
          "modules/tinymce/src/plugins/media/main/ts/core/Sanitize.ts",
          "modules/tinymce/src/plugins/template/main/ts/core/Templates.ts",
          "modules/tinymce/src/plugins/template/main/ts/core/Utils.ts",
          "modules/tinymce/src/plugins/template/main/ts/ui/Dialog.ts"
        ],
        "message": "TINY-9600: Provide configuration to turn off XSS sanitization (#8480)\n\n* TINY-9600: Add editor_security option\n\n* TINY-9600: Make parser respect editor_security option\n\n- add 'sanitize' option to DomParserSettings (default: true)\n- set 'sanitize' option for parser based on 'editor_security' option in InitContentBody\n\n* TINY-9600: Make paste respect editor_security option\n\n- configure sanitize setting in DomParser created in paste module\n\n* TINY-9600: Rename editor_security option to xss_sanitization\n\n* TINY-9600: Fix getContent throwing error when iframes with child nodes are present in content after disabling sanitization\n\n* TINY-9600: Respect xss_sanitization option if content has to be reparsed during getContent or setContent\n\n* TINY-9600: Rename Templates util function from sanitize to parseAndSerialize for accuracy\n\n- since sanitization can now be turned off in the parser\n\n* TINY-9600: Add parser tests\n\n* TINY-9600: Rename Options.shouldSanitizeContent to Options.shouldSanitizeXss to be consistent with option name\n\n* TINY-9600: Add unsanitized content tests in EditorContentTest\n\n- for setContent and getContent\n- test existing safe-html tests with xss_sanitization: false option\n\n* TINY-9600: Create assertContentTreeEqualToHtml in EditorContentTest to avoid repeated code\n\n* TINY-9600: Refactor content altered tests in EditorContentTest\n\n* TINY-9600: Add iframe with child node getContent test\n\n* TINY-9600: Add insertContent with xss_sanitization: false test\n\n* TINY-9600: Add pasting unsanitized content test\n\n* TINY-9600: Resolve Safari test failure for iframe with child node test\n\n* TINY-9600: Refactor inserting unsanitized content tests into its own file\n\n- add tests for inserting content with xss_sanitization: true\n\n* TINY-9600: Add xss_sanitization: true getContent and setContent tests\n\n* TINY-9600: Add changelog entry\n\n* TINY-9600: Add content initialisation with unsanitized html tests\n\n* TINY-9600: Replace editor argument with sanitize boolean argument in withSerializedContent\n\n* TINY-9600: Move DOMPurify setup function out of parseAndSanitizeWithContext to prevent unnecessary performance overhead\n\n* TINY-9600: Simplify toHtml in EditorContentTest by removing extra variable\n\n* TINY-9600: Convert concatenated strings to template strings in EditorContentTest and InsertUnsanitizedContentTest\n\n* TINY-9600: Add comment noting planned investigation of Safari-specific HTML output in EditorContentTest",
        "before_after_code_files": [
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
          "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
          "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/content/InsertUnsanitizedContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/InsertUnsanitizedContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
          "modules/tinymce/src/core/test/ts/browser/init/InitUnsanitizedContentTest.ts||modules/tinymce/src/core/test/ts/browser/init/InitUnsanitizedContentTest.ts",
          "modules/tinymce/src/core/test/ts/browser/paste/UnsanitizedPasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/UnsanitizedPasteTest.ts",
          "modules/tinymce/src/plugins/media/main/ts/core/Sanitize.ts||modules/tinymce/src/plugins/media/main/ts/core/Sanitize.ts",
          "modules/tinymce/src/plugins/template/main/ts/core/Templates.ts||modules/tinymce/src/plugins/template/main/ts/core/Templates.ts",
          "modules/tinymce/src/plugins/template/main/ts/core/Utils.ts||modules/tinymce/src/plugins/template/main/ts/core/Utils.ts",
          "modules/tinymce/src/plugins/template/main/ts/ui/Dialog.ts||modules/tinymce/src/plugins/template/main/ts/ui/Dialog.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
            "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
            "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
            "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
            "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
            "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
            "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
            "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
            "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts": [
          "File: modules/tinymce/src/core/main/ts/api/OptionTypes.ts -> modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "236:   visual_anchor_class?: string;",
          "237:   visual_table_class?: string;",
          "238:   width?: number | string;",
          "241:   disable_nodechange?: boolean;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "239:   xss_sanitization?: boolean;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "333:   visual_anchor_class: string;",
          "334:   visual_table_class: string;",
          "335:   width: number | string;",
          "336: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "337:   xss_sanitization: boolean;",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "785:     default: false",
          "786:   });",
          "789:   editor.on('ScriptsLoaded', () => {",
          "790:     registerOption('directionality', {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "788:   registerOption('xss_sanitization', {",
          "789:     processor: 'boolean',",
          "790:     default: true",
          "791:   });",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "889: const getNonEditableRegExps = option('noneditable_regexp');",
          "890: const shouldPreserveCData = option('preserve_cdata');",
          "891: const shouldHighlightOnFocus = option('highlight_on_focus');",
          "893: const hasTextPatternsLookup = (editor: Editor): boolean =>",
          "894:   editor.options.isSet('text_patterns_lookup');",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "897: const shouldSanitizeXss = option('xss_sanitization');",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "1004:   getEditableClass,",
          "1005:   hasTableTabNavigation,",
          "1006:   shouldPreserveCData,",
          "1008: };",
          "",
          "[Removed Lines]",
          "1007:   shouldHighlightOnFocus",
          "",
          "[Added Lines]",
          "1013:   shouldHighlightOnFocus,",
          "1014:   shouldSanitizeXss",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/html/DomParser.ts||modules/tinymce/src/core/main/ts/api/html/DomParser.ts": [
          "File: modules/tinymce/src/core/main/ts/api/html/DomParser.ts -> modules/tinymce/src/core/main/ts/api/html/DomParser.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "56:   allow_html_in_named_anchor?: boolean;",
          "57:   allow_script_urls?: boolean;",
          "58:   allow_unsafe_link_target?: boolean;",
          "59:   convert_fonts_to_spans?: boolean;",
          "60:   fix_list_elements?: boolean;",
          "61:   font_size_legacy_values?: string;",
          "62:   forced_root_block?: boolean | string;",
          "63:   forced_root_block_attrs?: Record<string, string>;",
          "64:   preserve_cdata?: boolean;",
          "65:   remove_trailing_brs?: boolean;",
          "66:   root_name?: string;",
          "67:   validate?: boolean;",
          "71: }",
          "73: interface DomParser {",
          "",
          "[Removed Lines]",
          "68:   inline_styles?: boolean;",
          "69:   blob_cache?: BlobCache;",
          "70:   document?: Document;",
          "",
          "[Added Lines]",
          "59:   blob_cache?: BlobCache;",
          "61:   document?: Document;",
          "66:   inline_styles?: boolean;",
          "70:   sanitize?: boolean;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "408:   const defaultedSettings = {",
          "409:     validate: true,",
          "410:     root_name: 'body',",
          "411:     ...settings",
          "412:   };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "412:     sanitize: true,",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "425:     const body = parser.parseFromString(wrappedHtml, mimeType).body;",
          "431:     return isSpecialRoot ? body.firstChild as Element : body;",
          "432:   };",
          "",
          "[Removed Lines]",
          "428:     purify.sanitize(body, getPurifyConfig(defaultedSettings, mimeType));",
          "429:     purify.removed = [];",
          "",
          "[Added Lines]",
          "430:     if (defaultedSettings.sanitize) {",
          "431:       purify.sanitize(body, getPurifyConfig(defaultedSettings, mimeType));",
          "432:       purify.removed = [];",
          "433:     }",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts||modules/tinymce/src/core/main/ts/content/PrePostProcess.ts": [
          "File: modules/tinymce/src/core/main/ts/content/PrePostProcess.ts -> modules/tinymce/src/core/main/ts/content/PrePostProcess.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: import * as Events from '../api/Events';",
          "5: import DomParser from '../api/html/DomParser';",
          "6: import HtmlSerializer from '../api/html/Serializer';",
          "7: import { EditorEvent } from '../api/util/EventDispatcher';",
          "8: import { Content, GetContentArgs, isTreeNode, SetContentArgs } from './ContentTypes';",
          "10: const serializeContent = (content: Content): string =>",
          "11:   isTreeNode(content) ? HtmlSerializer({ validate: false }).serialize(content) : content;",
          "14:   const serializedContent = serializeContent(content);",
          "15:   const eventArgs = fireEvent(serializedContent);",
          "16:   if (eventArgs.isDefaultPrevented()) {",
          "",
          "[Removed Lines]",
          "13: const withSerializedContent = <R extends EditorEvent<{ content: string }>>(content: Content, fireEvent: (content: string) => R): R & { content: Content } => {",
          "",
          "[Added Lines]",
          "7: import * as Options from '../api/Options';",
          "14: const withSerializedContent = <R extends EditorEvent<{ content: string }>>(content: Content, fireEvent: (content: string) => R, sanitize: boolean): R & { content: Content } => {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "21:     if (eventArgs.content !== serializedContent) {",
          "23:       return { ...eventArgs, content: rootNode };",
          "24:     } else {",
          "25:       return { ...eventArgs, content };",
          "",
          "[Removed Lines]",
          "22:       const rootNode = DomParser({ validate: false, forced_root_block: false }).parse(eventArgs.content, { context: content.name });",
          "",
          "[Added Lines]",
          "23:       const rootNode = DomParser({ validate: false, forced_root_block: false, sanitize }).parse(eventArgs.content, { context: content.name });",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "46:   if (args.no_events) {",
          "47:     return content;",
          "48:   } else {",
          "50:     return processedEventArgs.content;",
          "51:   }",
          "52: };",
          "",
          "[Removed Lines]",
          "49:     const processedEventArgs = withSerializedContent(content, (c) => Events.fireGetContent(editor, { ...args, content: c }));",
          "",
          "[Added Lines]",
          "50:     const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), Options.shouldSanitizeXss(editor));",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "55:   if (args.no_events) {",
          "56:     return Result.value(args);",
          "57:   } else {",
          "59:     if (processedEventArgs.isDefaultPrevented()) {",
          "60:       Events.fireSetContent(editor, processedEventArgs);",
          "61:       return Result.error(undefined);",
          "",
          "[Removed Lines]",
          "58:     const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }));",
          "",
          "[Added Lines]",
          "59:     const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), Options.shouldSanitizeXss(editor));",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts": [
          "File: modules/tinymce/src/core/main/ts/init/InitContentBody.ts -> modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "80:     remove_trailing_brs: getOption('remove_trailing_brs'),",
          "81:     inline_styles: getOption('inline_styles'),",
          "82:     root_name: getRootName(editor),",
          "83:     validate: true,",
          "84:     blob_cache: blobCache,",
          "85:     document: editor.getDoc()",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "83:     sanitize: getOption('xss_sanitization'),",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts||modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts": [
          "File: modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts -> modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: import * as Events from '../api/Events';",
          "3: import DomParser from '../api/html/DomParser';",
          "4: import HtmlSerializer from '../api/html/Serializer';",
          "5: import Tools from '../api/util/Tools';",
          "7: interface ProcessResult {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: import * as Options from '../api/Options';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "10: }",
          "12: const preProcess = (editor: Editor, html: string): string => {",
          "16:   parser.addNodeFilter('meta', (nodes) => {",
          "",
          "[Removed Lines]",
          "13:   const parser = DomParser({ }, editor.schema);",
          "",
          "[Added Lines]",
          "14:   const parser = DomParser({ sanitize: Options.shouldSanitizeXss(editor) }, editor.schema);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts -> modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { beforeEach, context, describe, it } from '@ephox/bedrock-client';",
          "2: import { Arr, Type } from '@ephox/katamari';",
          "3: import { TinyAssertions, TinyHooks } from '@ephox/wrap-mcagar';",
          "4: import { assert } from 'chai';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "3: import { PlatformDetection } from '@ephox/sand';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "17: ];",
          "19: describe('browser.tinymce.core.content.EditorContentTest', () => {",
          "20:   Arr.each(",
          "21:     [",
          "22:       {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21:   const toHtml = (node: AstNode): string => HtmlSerializer({}).serialize(node);",
          "23:   const assertContentTreeEqualToHtml = (editor: Editor, html: string, msg: string) => {",
          "24:     const tree = editor.getContent({ format: 'tree' });",
          "25:     assert.equal(toHtml(tree), html, msg);",
          "26:   };",
          "28:   const getFontTree = (): AstNode => {",
          "29:     const body = new AstNode('body', 11);",
          "30:     const font = new AstNode('font', 1);",
          "31:     const text = new AstNode('#text', 3);",
          "33:     text.value = 'x';",
          "34:     font.attr('size', '7');",
          "35:     font.append(text);",
          "36:     body.append(font);",
          "38:     return body;",
          "39:   };",
          "41:   const testSetContentTreeWithContentAlteredInBeforeSetContent = (editor: Editor, alteredContent: string, msg: string, expectedContent?: string) => {",
          "42:     editor.setContent('<p>tree</p>');",
          "43:     editor.once('BeforeSetContent', (e) => {",
          "44:       assert.equal(e.content, '<font size=\"7\">x</font>');",
          "45:       e.content = alteredContent;",
          "46:     });",
          "47:     editor.setContent(getFontTree());",
          "48:     assert.equal(editor.getContent(), expectedContent ?? alteredContent, msg);",
          "49:   };",
          "51:   const testGetContentTreeWithContentAlteredInGetContent = (editor: Editor, alteredContent: string, msg: string, expectedContent?: string) => {",
          "52:     editor.setContent('<p>tree</p>');",
          "53:     editor.once('GetContent', (e) => {",
          "54:       assert.equal(e.content, '<p>tree</p>');",
          "55:       e.content = alteredContent;",
          "56:     });",
          "57:     assertContentTreeEqualToHtml(editor, expectedContent ?? alteredContent, msg);",
          "58:   };",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "24:       },",
          "25:       {",
          "26:         inline: false",
          "27:       }",
          "28:     ], (options) => {",
          "30:         let events: EditorEvent<SetContentEvent | GetContentEvent | BeforeSetContentEvent | BeforeGetContentEvent>[] = [];",
          "31:         const hook = TinyHooks.bddSetupLight<Editor>({",
          "32:           base_url: '/project/tinymce/js/tinymce',",
          "",
          "[Removed Lines]",
          "29:       context('Test with inline option ' + options.inline, () => {",
          "",
          "[Added Lines]",
          "67:       },",
          "68:       {",
          "69:         inline: true,",
          "70:         xss_sanitization: false",
          "71:       },",
          "72:       {",
          "73:         inline: false,",
          "74:         xss_sanitization: false",
          "77:       context(`Test with inline: ${options.inline} and xss_sanitization: ${options.xss_sanitization}`, () => {",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "38:           ...options",
          "39:         }, []);",
          "59:         const assertEventsFiredInOrder = (expectedEvents: string[] = defaultExpectedEvents) => {",
          "60:           const names = Arr.map(events, (e) => e.type);",
          "61:           assert.deepEqual(names, expectedEvents, 'Get content events should have been fired');",
          "",
          "[Removed Lines]",
          "41:         const getFontTree = (): AstNode => {",
          "42:           const body = new AstNode('body', 11);",
          "43:           const font = new AstNode('font', 1);",
          "44:           const text = new AstNode('#text', 3);",
          "46:           text.value = 'x';",
          "47:           font.attr('size', '7');",
          "48:           font.append(text);",
          "49:           body.append(font);",
          "51:           return body;",
          "52:         };",
          "54:         const toHtml = (node: AstNode): string => {",
          "55:           const htmlSerializer = HtmlSerializer({});",
          "56:           return htmlSerializer.serialize(node);",
          "57:         };",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 5 ---",
          "[Context before]",
          "115:         it('TBA: getContent tree', () => {",
          "116:           const editor = hook.editor();",
          "117:           editor.setContent('<p>tree</p>');",
          "120:           assertEventsFiredInOrder();",
          "121:           assertEventsContentType();",
          "122:         });",
          "",
          "[Removed Lines]",
          "118:           const tree = editor.getContent({ format: 'tree' });",
          "119:           assert.equal(toHtml(tree), '<p>tree</p>', 'Should be expected tree html');",
          "",
          "[Added Lines]",
          "148:           assertContentTreeEqualToHtml(editor, '<p>tree</p>', 'Should be expected tree html');",
          "",
          "---------------",
          "--- Hunk 6 ---",
          "[Context before]",
          "124:         it('TINY-6281: getContent tree with empty editor', () => {",
          "125:           const editor = hook.editor();",
          "126:           editor.setContent('');",
          "130:           assertEventsFiredInOrder();",
          "131:           assertEventsContentType();",
          "132:         });",
          "",
          "[Removed Lines]",
          "127:           const tree = editor.getContent({ format: 'tree' });",
          "129:           assert.equal(toHtml(tree), '<p>\u00a0</p>', 'Should be expected tree html');",
          "",
          "[Added Lines]",
          "157:           assertContentTreeEqualToHtml(editor, '<p>\u00a0</p>', 'Should be expected tree html');",
          "",
          "---------------",
          "--- Hunk 7 ---",
          "[Context before]",
          "134:         it('TBA: getContent tree filtered', () => {",
          "135:           const editor = hook.editor();",
          "136:           editor.setContent('<p><font size=\"7\">x</font></p>', { format: 'raw' });",
          "139:           assertEventsFiredInOrder();",
          "140:           assertEventsContentType();",
          "141:         });",
          "",
          "[Removed Lines]",
          "137:           const tree = editor.getContent({ format: 'tree' });",
          "138:           assert.equal(toHtml(tree), '<p><span style=\"font-size: 300%;\">x</span></p>', 'Should be expected tree filtered html');",
          "",
          "[Added Lines]",
          "165:           assertContentTreeEqualToHtml(editor, '<p><span style=\"font-size: 300%;\">x</span></p>', 'Should be expected tree filtered html');",
          "",
          "---------------",
          "--- Hunk 8 ---",
          "[Context before]",
          "251:         it('TINY-7996: Set tree content with content altered in BeforeSetContent', () => {",
          "252:           const editor = hook.editor();",
          "260:         });",
          "262:         it('TINY-7996: Get tree content with content altered in GetContent', () => {",
          "263:           const editor = hook.editor();",
          "271:         });",
          "273:         const initialContent = '<p>initial</p>';",
          "",
          "[Removed Lines]",
          "253:           editor.setContent('<p>tree</p>');",
          "254:           editor.once('BeforeSetContent', (e) => {",
          "255:             assert.equal(e.content, '<font size=\"7\">x</font>');",
          "256:             e.content = '<p>replaced</p>';",
          "257:           });",
          "258:           editor.setContent(getFontTree());",
          "259:           assert.equal(editor.getContent(), '<p>replaced</p>', 'Should be replaced html');",
          "264:           editor.setContent('<p>tree</p>');",
          "265:           editor.once('GetContent', (e) => {",
          "266:             assert.equal(e.content, '<p>tree</p>');",
          "267:             e.content = '<p>replaced</p>';",
          "268:           });",
          "269:           const tree = editor.getContent({ format: 'tree' });",
          "270:           assert.equal(toHtml(tree), '<p>replaced</p>', 'Should be replaced html');",
          "",
          "[Added Lines]",
          "280:           testSetContentTreeWithContentAlteredInBeforeSetContent(editor, '<p>replaced</p>', 'Should be replaced html');",
          "285:           testGetContentTreeWithContentAlteredInGetContent(editor, '<p>replaced</p>', 'Should be replaced html');",
          "",
          "---------------",
          "--- Hunk 9 ---",
          "[Context before]",
          "275:         const manipulatedContent = '<p>manipulated</p>';",
          "276:         Arr.each([",
          "277:           [ 'setContent', manipulatedContent ],",
          "279:         ] as const, ([ action, result ]) => {",
          "280:           it(`TINY-9143: Can manipulate content in \"BeforeSetContent\" callback when called from \"${action}\" function`, () => {",
          "281:             const editor = hook.editor();",
          "",
          "[Removed Lines]",
          "278:           [ 'insertContent', manipulatedContent + '\\n' + initialContent ]",
          "",
          "[Added Lines]",
          "293:           [ 'insertContent', `${manipulatedContent}\\n${initialContent}` ]",
          "",
          "---------------",
          "--- Hunk 10 ---",
          "[Context before]",
          "291:       });",
          "292:     }",
          "293:   );",
          "294: });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "310:   Arr.each([",
          "311:     { inline: true },",
          "312:     { inline: false }",
          "313:   ], (options) => {",
          "314:     const unsanitizedHtml = '<p><a href=\"javascript:alert(1)\">XSS</a></p>';",
          "316:     context(`TINY-9600: Test unsanitized content with inline: ${options.inline} and xss_sanitization: true`, () => {",
          "317:       const hook = TinyHooks.bddSetupLight<Editor>({",
          "318:         base_url: '/project/tinymce/js/tinymce',",
          "319:         xss_sanitization: true,",
          "320:         ...options",
          "321:       }, []);",
          "323:       const sanitizedHtml = '<p><a>XSS</a></p>';",
          "325:       it('setContent with unsanitized content should set sanitized html', () => {",
          "326:         const editor = hook.editor();",
          "327:         editor.setContent(unsanitizedHtml);",
          "328:         TinyAssertions.assertContent(editor, sanitizedHtml);",
          "329:       });",
          "331:       it('getContent html with unsanitized content should get sanitized html', () => {",
          "332:         const editor = hook.editor();",
          "333:         editor.setContent(unsanitizedHtml);",
          "334:         const content = editor.getContent();",
          "335:         assert.equal(content, sanitizedHtml, 'Unsanitized html should be sanitized');",
          "336:       });",
          "338:       it('getContent text with unsanitized content should get text from sanitized content', () => {",
          "339:         const editor = hook.editor();",
          "340:         editor.setContent(unsanitizedHtml);",
          "341:         const text = editor.getContent({ format: 'text' });",
          "342:         assert.equal(text, 'XSS', 'Text should be retrieved from sanitized html');",
          "343:       });",
          "345:       it('getContent tree with unsanitized content should get sanitized tree', () => {",
          "346:         const editor = hook.editor();",
          "347:         editor.setContent(unsanitizedHtml);",
          "348:         assertContentTreeEqualToHtml(editor, sanitizedHtml, 'Unsanitized html should be sanitized');",
          "349:       });",
          "351:       it('setContent tree with content altered in BeforeSetContent should set sanitized html', () => {",
          "352:         const editor = hook.editor();",
          "353:         testSetContentTreeWithContentAlteredInBeforeSetContent(editor, unsanitizedHtml, 'Replaced content should be sanitized', sanitizedHtml);",
          "354:       });",
          "356:       it('getContent tree with content altered in GetContent should get sanitized html', () => {",
          "357:         const editor = hook.editor();",
          "358:         testGetContentTreeWithContentAlteredInGetContent(editor, unsanitizedHtml, 'Replaced content should be sanitized', sanitizedHtml);",
          "359:       });",
          "360:     });",
          "362:     context(`TINY-9600: Test unsanitized content with inline: ${options.inline} and xss_sanitization: false`, () => {",
          "363:       const hook = TinyHooks.bddSetupLight<Editor>({",
          "364:         base_url: '/project/tinymce/js/tinymce',",
          "365:         xss_sanitization: false,",
          "366:         ...options",
          "367:       }, []);",
          "369:       it('setContent with unsanitized content should set content unaltered', () => {",
          "370:         const editor = hook.editor();",
          "371:         editor.setContent(unsanitizedHtml);",
          "372:         TinyAssertions.assertContent(editor, unsanitizedHtml);",
          "373:       });",
          "375:       it('getContent html with unsanitized content should get content unaltered', () => {",
          "376:         const editor = hook.editor();",
          "377:         editor.setContent(unsanitizedHtml);",
          "378:         const content = editor.getContent();",
          "379:         assert.equal(content, unsanitizedHtml, 'Unsanitized html should not be altered');",
          "380:       });",
          "382:       it('getContent html with iframe with child node should get the content as expected and not error', () => {",
          "383:         const editor = hook.editor();",
          "384:         editor.setContent('<p><iframe><p>test</p></iframe></p>');",
          "385:         const content = editor.getContent();",
          "386:         assert.equal(content,",
          "388:           PlatformDetection.detect().browser.isSafari()",
          "389:             ? '<p><iframe>&lt;p&gt;test&lt;/p&gt;</iframe></p>'",
          "390:             : '<p><iframe><p>test</p></iframe></p>',",
          "391:           'getContent should not error when there is iframes with child nodes in content');",
          "392:       });",
          "394:       it('getContent text with unsanitized content should get text from unsanitized content', () => {",
          "395:         const editor = hook.editor();",
          "396:         editor.setContent(unsanitizedHtml);",
          "397:         const text = editor.getContent({ format: 'text' });",
          "398:         assert.equal(text, 'XSS', 'Text content from unsanitized html should not be altered');",
          "399:       });",
          "401:       it('getContent tree with unsanitized content should get unsanitized tree', () => {",
          "402:         const editor = hook.editor();",
          "403:         editor.setContent(unsanitizedHtml);",
          "404:         assertContentTreeEqualToHtml(editor, unsanitizedHtml, 'Unsanitized html should not be altered');",
          "405:       });",
          "407:       it('setContent tree with content altered to unsanitized html in BeforeSetContent should set unsanitized html', () => {",
          "408:         const editor = hook.editor();",
          "409:         testSetContentTreeWithContentAlteredInBeforeSetContent(editor, unsanitizedHtml, 'Replaced content should be unaltered unsanitized html');",
          "410:       });",
          "412:       it('getContent tree with content altered to unsanitized html in GetContent should get unsanitized html', () => {",
          "413:         const editor = hook.editor();",
          "414:         testGetContentTreeWithContentAlteredInGetContent(editor, unsanitizedHtml, 'Replaced content should be unaltered unsanitized html');",
          "415:       });",
          "416:     });",
          "417:   });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/content/InsertUnsanitizedContentTest.ts||modules/tinymce/src/core/test/ts/browser/content/InsertUnsanitizedContentTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/content/InsertUnsanitizedContentTest.ts -> modules/tinymce/src/core/test/ts/browser/content/InsertUnsanitizedContentTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "2: import { TinyAssertions, TinyHooks, TinySelections } from '@ephox/wrap-mcagar';",
          "4: import Editor from 'tinymce/core/api/Editor';",
          "6: describe('browser.tinymce.core.content.InsertUnsanitizedContentTest', () => {",
          "7:   const unsanitizedHtml = '<p><a href=\"javascript:alert(1)\">XSS</a></p>';",
          "8:   const sanitizedHtml = '<p><a>XSS</a></p>';",
          "9:   const testInsertContent = (editor: Editor, content: string, expected: string) => {",
          "10:     const initialContent = '<p>initial</p>';",
          "11:     editor.setContent(initialContent);",
          "12:     TinySelections.setCursor(editor, [ 0, 0 ], 0);",
          "13:     editor.insertContent(content);",
          "14:     TinyAssertions.assertContent(editor, `${expected}\\n${initialContent}`);",
          "15:   };",
          "17:   context('TINY-9600: Inserting unsanitized html with xss_sanitization: true', () => {",
          "18:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "19:       base_url: '/project/tinymce/js/tinymce',",
          "20:       xss_sanitization: true",
          "21:     }, []);",
          "23:     it('insertContent should sanitize inserted html', () => {",
          "24:       const editor = hook.editor();",
          "25:       testInsertContent(editor, unsanitizedHtml, sanitizedHtml);",
          "26:     });",
          "27:   });",
          "29:   context('TINY-9600: Inserting unsanitized html with xss_sanitization: false', () => {",
          "30:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "31:       base_url: '/project/tinymce/js/tinymce',",
          "32:       xss_sanitization: false",
          "33:     }, []);",
          "35:     it('insertContent should not alter inserted unsanitized html', () => {",
          "36:       const editor = hook.editor();",
          "37:       testInsertContent(editor, unsanitizedHtml, unsanitizedHtml);",
          "38:     });",
          "39:   });",
          "40: });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts||modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts -> modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1487:       }));",
          "1488:     });",
          "1489:   });",
          "1490: });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1491:   context('TINY-9600: sanitize: false', () => {",
          "1492:     const testDisablingSanitization = (testCase: { name: string; input: string }) => {",
          "1493:       it(testCase.name, () => {",
          "1494:         const parser = DomParser({ sanitize: false }, schema);",
          "1495:         const serializedHtml = serializer.serialize(parser.parse(testCase.input));",
          "1497:         assert.equal(serializedHtml, testCase.input);",
          "1498:       });",
          "1499:     };",
          "1501:     Arr.each([{",
          "1502:       name: 'should not remove script tags',",
          "1503:       input: '<script>alert(1)</script>'",
          "1504:     }, {",
          "1505:       name: 'should not remove iframe tags with child nodes',",
          "1506:       input: '<iframe src=\"https://example.com\"><p>Lorem ipsum</p></iframe>'",
          "1507:     }, {",
          "1508:       name: 'should not remove iframe tags with srcdoc',",
          "1509:       input: '<iframe srcdoc=\"Lorem ipsum\"></iframe>'",
          "1510:     }, {",
          "1511:       name: 'should not remove unsafe attributes',",
          "1512:       input: '<p><a href=\"javascript:alert(1)\">XSS</a></p>'",
          "1513:     },",
          "1514:     {",
          "1515:       name: 'should not remove svg tags',",
          "1516:       input: '<svg><circle cx=\"50\" cy=\"50\" r=\"40\" stroke=\"green\" stroke-width=\"4\" fill=\"yellow\"></circle></svg>'",
          "1517:     }",
          "1518:     ], testDisablingSanitization);",
          "1519:   });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/init/InitUnsanitizedContentTest.ts||modules/tinymce/src/core/test/ts/browser/init/InitUnsanitizedContentTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/init/InitUnsanitizedContentTest.ts -> modules/tinymce/src/core/test/ts/browser/init/InitUnsanitizedContentTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "2: import { McEditor, TinyAssertions } from '@ephox/mcagar';",
          "4: import Editor from 'tinymce/core/api/Editor';",
          "6: describe('browser.tinymce.core.init.InitUnsanitizedContentTest', () => {",
          "7:   const initAndAssertContent = (label: string, xss_sanitization: boolean, initial: string, expected: string) => {",
          "8:     it(label, async () => {",
          "9:       const editor = await McEditor.pFromHtml<Editor>(`<textarea>${initial}</textarea>`, {",
          "10:         base_url: '/project/tinymce/js/tinymce',",
          "11:         xss_sanitization",
          "12:       });",
          "13:       TinyAssertions.assertContent(editor, expected);",
          "14:       McEditor.remove(editor);",
          "15:     });",
          "16:   };",
          "18:   const unsanitizedHtml = '<p><a href=\"javascript:alert(1)\">XSS</a></p>';",
          "20:   context('TINY-9600: xss_sanitized: true', () => {",
          "21:     const sanitizedHtml = '<p><a>XSS</a></p>';",
          "22:     initAndAssertContent('should sanitize initial content', true, unsanitizedHtml, sanitizedHtml);",
          "23:   });",
          "25:   context('TINY-9600: xss_sanitized: false', () => {",
          "26:     initAndAssertContent('should not sanitize initial content', false, unsanitizedHtml, unsanitizedHtml);",
          "27:   });",
          "28: });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/paste/UnsanitizedPasteTest.ts||modules/tinymce/src/core/test/ts/browser/paste/UnsanitizedPasteTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/paste/UnsanitizedPasteTest.ts -> modules/tinymce/src/core/test/ts/browser/paste/UnsanitizedPasteTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { context, describe, it } from '@ephox/bedrock-client';",
          "2: import { TinyAssertions, TinyHooks } from '@ephox/wrap-mcagar';",
          "4: import Editor from 'tinymce/core/api/Editor';",
          "6: describe('browser.tinymce.core.paste.UnsanitizedPasteTest', () => {",
          "7:   const unsanitizedHtml = '<p><a href=\"javascript:alert(1)\">XSS</a></p>';",
          "8:   const sanitizedHtml = '<p><a>XSS</a></p>';",
          "9:   const testPaste = (editor: Editor, content: string, expected: string) => {",
          "10:     editor.setContent('');",
          "11:     editor.execCommand('mceInsertClipboardContent', false, { html: content });",
          "12:     TinyAssertions.assertContent(editor, expected);",
          "13:   };",
          "15:   context('TINY-9600: xss_sanitization: true', () => {",
          "16:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "17:       base_url: '/project/tinymce/js/tinymce',",
          "18:       xss_sanitization: true",
          "19:     }, []);",
          "21:     it('should sanitize pasted content', () => {",
          "22:       const editor = hook.editor();",
          "23:       testPaste(editor, unsanitizedHtml, sanitizedHtml);",
          "24:     });",
          "25:   });",
          "27:   context('TINY-9600: xss_sanitization: false', () => {",
          "28:     const hook = TinyHooks.bddSetupLight<Editor>({",
          "29:       base_url: '/project/tinymce/js/tinymce',",
          "30:       xss_sanitization: false",
          "31:     }, []);",
          "33:     it('should not sanitize pasted content', () => {",
          "34:       const editor = hook.editor();",
          "35:       testPaste(editor, unsanitizedHtml, unsanitizedHtml);",
          "36:     });",
          "37:   });",
          "38: });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/media/main/ts/core/Sanitize.ts||modules/tinymce/src/plugins/media/main/ts/core/Sanitize.ts": [
          "File: modules/tinymce/src/plugins/media/main/ts/core/Sanitize.ts -> modules/tinymce/src/plugins/media/main/ts/core/Sanitize.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: import { Parser } from './Parser';",
          "7: const parseAndSanitize = (editor: Editor, context: string, html: string): AstNode => {",
          "8:   const validate = Options.shouldFilterHtml(editor);",
          "10: };",
          "12: export {",
          "",
          "[Removed Lines]",
          "9:   return Parser(editor.schema, { validate }).parse(html, { context });",
          "",
          "[Added Lines]",
          "8:   const getEditorOption = editor.options.get;",
          "9:   const sanitize = getEditorOption('xss_sanitization');",
          "11:   return Parser(editor.schema, { sanitize, validate }).parse(html, { context });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/template/main/ts/core/Templates.ts||modules/tinymce/src/plugins/template/main/ts/core/Templates.ts": [
          "File: modules/tinymce/src/plugins/template/main/ts/core/Templates.ts -> modules/tinymce/src/plugins/template/main/ts/core/Templates.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "6: import * as Options from '../api/Options';",
          "7: import * as DateTimeHelper from './DateTimeHelper';",
          "8: import { ExternalTemplate, TemplateValues } from './Types';",
          "11: const createTemplateList = (editor: Editor, callback: (templates: ExternalTemplate[]) => void) => {",
          "12:   return (): void => {",
          "",
          "[Removed Lines]",
          "9: import { hasAnyClasses, sanitize } from './Utils';",
          "",
          "[Added Lines]",
          "9: import { hasAnyClasses, parseAndSerialize } from './Utils';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "61:   const sel = editor.selection.getContent();",
          "63:   html = replaceTemplateValues(html, Options.getTemplateReplaceValues(editor));",
          "67:   const n = dom.select('.mceTmpl', el);",
          "",
          "[Removed Lines]",
          "64:   let el = dom.create('div', {}, sanitize(editor, html));",
          "",
          "[Added Lines]",
          "64:   let el = dom.create('div', {}, parseAndSerialize(editor, html));",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/template/main/ts/core/Utils.ts||modules/tinymce/src/plugins/template/main/ts/core/Utils.ts": [
          "File: modules/tinymce/src/plugins/template/main/ts/core/Utils.ts -> modules/tinymce/src/plugins/template/main/ts/core/Utils.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: const hasAnyClasses = (dom: DOMUtils, n: Element, classes: string): boolean =>",
          "19:   Arr.exists(classes.split(/\\s+/), (c) => dom.hasClass(n, c));",
          "22:   HtmlSerializer({ validate: true }, editor.schema).serialize(",
          "23:     editor.parser.parse(html, { insert: true })",
          "24:   );",
          "",
          "[Removed Lines]",
          "21: const sanitize = (editor: Editor, html: string): string =>",
          "",
          "[Added Lines]",
          "21: const parseAndSerialize = (editor: Editor, html: string): string =>",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "26: export {",
          "27:   hasAnyClasses,",
          "28:   htmlEscape,",
          "30: };",
          "",
          "[Removed Lines]",
          "29:   sanitize",
          "",
          "[Added Lines]",
          "29:   parseAndSerialize",
          "",
          "---------------"
        ],
        "modules/tinymce/src/plugins/template/main/ts/ui/Dialog.ts||modules/tinymce/src/plugins/template/main/ts/ui/Dialog.ts": [
          "File: modules/tinymce/src/plugins/template/main/ts/ui/Dialog.ts -> modules/tinymce/src/plugins/template/main/ts/ui/Dialog.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "59:       preventClicksOnLinksScript +",
          "60:       '</head>' +",
          "61:       '<body class=\"' + encode(bodyClass) + '\"' + dirAttr + '>' +",
          "63:       '</body>' +",
          "64:       '</html>'",
          "65:     );",
          "",
          "[Removed Lines]",
          "62:       Utils.sanitize(editor, html) +",
          "",
          "[Added Lines]",
          "62:       Utils.parseAndSerialize(editor, html) +",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "908f34efe9fbe0a82bffeb3a42b4d1ab924ad120",
      "candidate_info": {
        "commit_hash": "908f34efe9fbe0a82bffeb3a42b4d1ab924ad120",
        "repo": "tinymce/tinymce",
        "commit_url": "https://github.com/tinymce/tinymce/commit/908f34efe9fbe0a82bffeb3a42b4d1ab924ad120",
        "files": [
          "modules/tinymce/src/core/demo/html/disabled_demo.html",
          "modules/tinymce/src/core/demo/ts/demo/Demos.ts",
          "modules/tinymce/src/core/demo/ts/demo/DisabledDemo.ts",
          "modules/tinymce/src/core/main/ts/NodeChange.ts",
          "modules/tinymce/src/core/main/ts/api/Editor.ts",
          "modules/tinymce/src/core/main/ts/api/EditorObservable.ts",
          "modules/tinymce/src/core/main/ts/api/EventTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Events.ts",
          "modules/tinymce/src/core/main/ts/api/Mode.ts",
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/init/Init.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/main/ts/mode/Disabled.ts",
          "modules/tinymce/src/core/main/ts/mode/EditableRoot.ts",
          "modules/tinymce/src/core/main/ts/mode/Mode.ts",
          "modules/tinymce/src/core/main/ts/mode/Readonly.ts",
          "modules/tinymce/src/core/main/ts/util/ModeUtils.ts",
          "modules/tinymce/src/core/test/ts/browser/DisabledModeTest.ts",
          "modules/tinymce/src/core/test/ts/browser/EditableRootTest.ts",
          "modules/tinymce/src/core/test/ts/browser/EditorTest.ts",
          "modules/tinymce/src/core/test/ts/browser/ReadOnlyModeTest.ts",
          "modules/tinymce/src/models/dom/main/ts/table/api/TableResizeHandler.ts",
          "modules/tinymce/src/themes/silver/main/ts/UiState.ts",
          "modules/tinymce/src/themes/silver/main/ts/api/Options.ts",
          "modules/tinymce/src/themes/silver/main/ts/backstage/Backstage.ts",
          "modules/tinymce/src/themes/silver/main/ts/ui/context/ContextToolbar.ts",
          "modules/tinymce/src/themes/silver/main/ts/ui/core/complex/BespokeNumberInput.ts",
          "modules/tinymce/src/themes/silver/test/ts/browser/editor/DisableTest.ts"
        ],
        "message": "TINY-11488: Added new option to disable the editor",
        "before_after_code_files": [
          "modules/tinymce/src/core/demo/html/disabled_demo.html||modules/tinymce/src/core/demo/html/disabled_demo.html",
          "modules/tinymce/src/core/demo/ts/demo/Demos.ts||modules/tinymce/src/core/demo/ts/demo/Demos.ts",
          "modules/tinymce/src/core/demo/ts/demo/DisabledDemo.ts||modules/tinymce/src/core/demo/ts/demo/DisabledDemo.ts",
          "modules/tinymce/src/core/main/ts/NodeChange.ts||modules/tinymce/src/core/main/ts/NodeChange.ts",
          "modules/tinymce/src/core/main/ts/api/Editor.ts||modules/tinymce/src/core/main/ts/api/Editor.ts",
          "modules/tinymce/src/core/main/ts/api/EditorObservable.ts||modules/tinymce/src/core/main/ts/api/EditorObservable.ts",
          "modules/tinymce/src/core/main/ts/api/EventTypes.ts||modules/tinymce/src/core/main/ts/api/EventTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Events.ts||modules/tinymce/src/core/main/ts/api/Events.ts",
          "modules/tinymce/src/core/main/ts/api/Mode.ts||modules/tinymce/src/core/main/ts/api/Mode.ts",
          "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
          "modules/tinymce/src/core/main/ts/init/Init.ts||modules/tinymce/src/core/main/ts/init/Init.ts",
          "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "modules/tinymce/src/core/main/ts/mode/Disabled.ts||modules/tinymce/src/core/main/ts/mode/Disabled.ts",
          "modules/tinymce/src/core/main/ts/mode/EditableRoot.ts||modules/tinymce/src/core/main/ts/mode/EditableRoot.ts",
          "modules/tinymce/src/core/main/ts/mode/Mode.ts||modules/tinymce/src/core/main/ts/mode/Mode.ts",
          "modules/tinymce/src/core/main/ts/mode/Readonly.ts||modules/tinymce/src/core/main/ts/mode/Readonly.ts",
          "modules/tinymce/src/core/main/ts/util/ModeUtils.ts||modules/tinymce/src/core/main/ts/util/ModeUtils.ts",
          "modules/tinymce/src/core/test/ts/browser/DisabledModeTest.ts||modules/tinymce/src/core/test/ts/browser/DisabledModeTest.ts",
          "modules/tinymce/src/core/test/ts/browser/EditableRootTest.ts||modules/tinymce/src/core/test/ts/browser/EditableRootTest.ts",
          "modules/tinymce/src/core/test/ts/browser/EditorTest.ts||modules/tinymce/src/core/test/ts/browser/EditorTest.ts",
          "modules/tinymce/src/core/test/ts/browser/ReadOnlyModeTest.ts||modules/tinymce/src/core/test/ts/browser/ReadOnlyModeTest.ts",
          "modules/tinymce/src/models/dom/main/ts/table/api/TableResizeHandler.ts||modules/tinymce/src/models/dom/main/ts/table/api/TableResizeHandler.ts",
          "modules/tinymce/src/themes/silver/main/ts/UiState.ts||modules/tinymce/src/themes/silver/main/ts/UiState.ts",
          "modules/tinymce/src/themes/silver/main/ts/api/Options.ts||modules/tinymce/src/themes/silver/main/ts/api/Options.ts",
          "modules/tinymce/src/themes/silver/main/ts/backstage/Backstage.ts||modules/tinymce/src/themes/silver/main/ts/backstage/Backstage.ts",
          "modules/tinymce/src/themes/silver/main/ts/ui/context/ContextToolbar.ts||modules/tinymce/src/themes/silver/main/ts/ui/context/ContextToolbar.ts",
          "modules/tinymce/src/themes/silver/main/ts/ui/core/complex/BespokeNumberInput.ts||modules/tinymce/src/themes/silver/main/ts/ui/core/complex/BespokeNumberInput.ts",
          "modules/tinymce/src/themes/silver/test/ts/browser/editor/DisableTest.ts||modules/tinymce/src/themes/silver/test/ts/browser/editor/DisableTest.ts"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts"
          ],
          "candidate": [
            "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
            "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts",
            "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts"
          ]
        }
      },
      "candidate_diff": {
        "modules/tinymce/src/core/demo/html/disabled_demo.html||modules/tinymce/src/core/demo/html/disabled_demo.html": [
          "File: modules/tinymce/src/core/demo/html/disabled_demo.html -> modules/tinymce/src/core/demo/html/disabled_demo.html",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: <!DOCTYPE html>",
          "2: <html lang=\"en\">",
          "3:   <head>",
          "4:     <title>Disabled demo Demo Page</title>",
          "5:   </head>",
          "7:   <body>",
          "8:   <h2>Disabled demo Page</h2>",
          "9:     <div id=\"ephox-ui\">",
          "10:       <div class=\"tinymce\">",
          "11:     <div>",
          "12:       <h1>Welcome to Your Project!</h1>",
          "13:       <p>This is a sample paragraph to showcase <strong>editable</strong> and <strong>non-editable</strong> elements in TinyMCE.</p>",
          "15:       <h2>About the Project</h2>",
          "16:       <p>",
          "17:         This project is a demonstration of how to use various elements within TinyMCE. You can add images, tables, and editable text.",
          "18:         TinyMCE is a robust WYSIWYG editor that allows for rich content editing and formatting.",
          "19:       </p>",
          "21:       <h2>Sample Table</h2>",
          "22:       <table border=\"1\" cellpadding=\"10\" cellspacing=\"0\" style=\"width: 100%; margin: 10px 0;\">",
          "23:         <thead>",
          "24:           <tr>",
          "25:             <th>Header 1</th>",
          "26:             <th>Header 2</th>",
          "27:             <th>Header 3</th>",
          "28:           </tr>",
          "29:         </thead>",
          "30:         <tbody>",
          "31:           <tr>",
          "32:             <td>Row 1, Cell 1</td>",
          "33:             <td contenteditable=\"false\">Row 1, Cell 2 (Non-Editable)</td>",
          "34:             <td>Row 1, Cell 3</td>",
          "35:           </tr>",
          "36:           <tr>",
          "37:             <td>Row 2, Cell 1</td>",
          "38:             <td>Row 2, Cell 2</td>",
          "39:             <td>Row 2, Cell 3</td>",
          "40:           </tr>",
          "41:         </tbody>",
          "42:       </table>",
          "44:       <h2>Image Section</h2>",
          "45:       <p>Below is a sample image that can be resized and styled within TinyMCE.</p>",
          "46:       <img src=\"https://placehold.co/600x400\" alt=\"Placeholder Image\" style=\"display: block; margin: 10px auto; width: 600px;\">",
          "48:       <h2>Conclusion</h2>",
          "49:       <p>Thank you for exploring this demo. You can <em>edit</em>, <strong>format</strong>, and <u>style</u> all the elements as needed!</p>",
          "50:     </div>",
          "51:       </div>",
          "52:     </div>",
          "54:     <script src=\"../../../../js/tinymce/tinymce.js\"></script>",
          "55:     <script src=\"../../../../scratch/demos/core/demo.js\"></script>",
          "56:     <script>demos.DisabledDemo();</script>",
          "58:   </body>",
          "59: </html>",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/demo/ts/demo/Demos.ts||modules/tinymce/src/core/demo/ts/demo/Demos.ts": [
          "File: modules/tinymce/src/core/demo/ts/demo/Demos.ts -> modules/tinymce/src/core/demo/ts/demo/Demos.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: import CommandsDemo from './CommandsDemo';",
          "3: import ContentEditableFalseDemo from './ContentEditableFalseDemo';",
          "4: import CustomThemeDemo from './CustomThemeDemo';",
          "5: import FixedToolbarContainerDemo from './FixedToolbarContainerDemo';",
          "6: import FullDemo from './FullDemo';",
          "7: import IframeDemo from './IframeDemo';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "5: import DisabledDemo from './DisabledDemo';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "21:   CommandsDemo,",
          "22:   ContentEditableFalseDemo,",
          "23:   CustomThemeDemo,",
          "24:   IframeDemo,",
          "25:   InlineDemo,",
          "26:   FixedToolbarContainerDemo,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25:   DisabledDemo,",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/demo/ts/demo/DisabledDemo.ts||modules/tinymce/src/core/demo/ts/demo/DisabledDemo.ts": [
          "File: modules/tinymce/src/core/demo/ts/demo/DisabledDemo.ts -> modules/tinymce/src/core/demo/ts/demo/DisabledDemo.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { DomEvent, Html, Insert, SelectorFind, SugarBody, SugarElement, TextContent } from '@ephox/sugar';",
          "3: import { TinyMCE } from 'tinymce/core/api/PublicApi';",
          "5: declare let tinymce: TinyMCE;",
          "7: export default (): void => {",
          "8:   const container = SelectorFind.descendant(SugarBody.body(), '#ephox-ui').getOrDie();",
          "10:   const statusDiv = SugarElement.fromTag('p');",
          "11:   Insert.before(container, statusDiv);",
          "13:   const toggleModeBtn = SugarElement.fromTag('button');",
          "14:   Html.set(toggleModeBtn, 'Toggle readonly mode');",
          "15:   DomEvent.bind(toggleModeBtn, 'click', () => {",
          "16:     tinymce.activeEditor?.mode.set(tinymce.activeEditor.mode.get() === 'readonly' ? 'design' : 'readonly');",
          "17:     TextContent.set(statusDiv, `Mode: ${tinymce.activeEditor?.mode.get()}, Disabled: ${tinymce.activeEditor?.options.get('disabled')}`);",
          "18:   });",
          "19:   Insert.before(container, toggleModeBtn);",
          "21:   const toggleDisabledBtn = SugarElement.fromTag('button');",
          "22:   Html.set(toggleDisabledBtn, 'Toggle disabled mode');",
          "23:   DomEvent.bind(toggleDisabledBtn, 'click', () => {",
          "24:     tinymce.activeEditor?.options.set('disabled', !tinymce.activeEditor.options.get('disabled'));",
          "25:     TextContent.set(statusDiv, `Mode: ${tinymce.activeEditor?.mode.get()}, Disabled: ${tinymce.activeEditor?.options.get('disabled')}`);",
          "26:   });",
          "27:   Insert.before(container, toggleDisabledBtn);",
          "29:   tinymce.init({",
          "30:     skin_url: '../../../../js/tinymce/skins/ui/oxide',",
          "31:     selector: 'div.tinymce',",
          "32:     height: 1000,",
          "33:     plugins: 'accordion image table emoticons charmap codesample insertdatetime',",
          "35:     toolbar: 'bold italic underline strikethrough subscript superscript accordion addtemplate inserttemplate| fontfamily fontsize fontsizeinput | numlist bullist checklist mergetags footnotes footnotesupdate| typography permanentpen formatpainter removeformat forecolor backcolor | blockquote nonbreaking hr pagebreak | casechange styles blocks lineheight | ltr rtl outdent indent | align alignleft aligncenter alignright alignjustify alignnone | h1 h2 h3 h4 h5 h6 h7 | copy cut paste pastetext selectall remove newdocument wordcount searchreplace | undo redo | save cancel restoredraft | fullscreen print preview export code help | template insertdatetime codesample emoticons charmap | anchor link unlink image media pageembed insertfile | visualblocks visualchars | table advtablerownumbering tableclass tablecellclass tablecellvalign tablecellborderwidth tablecellborderstyle tablecaption tablecellbackgroundcolor tablecellbordercolor tablerowheader tablecolheader',",
          "36:     setup: (ed) => {",
          "37:       ed.on('init', () => {",
          "38:         TextContent.set(statusDiv, `Mode: ${ed.mode.get()}, Disabled: ${ed.options.get('disabled')}`);",
          "39:       });",
          "40:     }",
          "41:   });",
          "42: };",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/NodeChange.ts||modules/tinymce/src/core/main/ts/NodeChange.ts": [
          "File: modules/tinymce/src/core/main/ts/NodeChange.ts -> modules/tinymce/src/core/main/ts/NodeChange.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "98:     let node: Element | undefined;",
          "103:       const root = editor.getBody();",
          "104:       node = selection.getStart(true) || root;",
          "",
          "[Removed Lines]",
          "101:     if (editor.initialized && selection && !Options.shouldDisableNodeChange(editor)) {",
          "",
          "[Added Lines]",
          "101:     if (editor.initialized && selection && !Options.shouldDisableNodeChange(editor) && !editor.disabled) {",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/Editor.ts||modules/tinymce/src/core/main/ts/api/Editor.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Editor.ts -> modules/tinymce/src/core/main/ts/api/Editor.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "206:   public contentAreaContainer!: HTMLElement;",
          "207:   public contentDocument!: Document;",
          "208:   public contentWindow!: Window;",
          "209:   public delegates: Record<string, EventUtilsCallback<any>> | undefined;",
          "210:   public destroyed: boolean = false;",
          "211:   public dom!: DOMUtils;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "209:   public disabled: boolean = false;",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/EditorObservable.ts||modules/tinymce/src/core/main/ts/api/EditorObservable.ts": [
          "File: modules/tinymce/src/core/main/ts/api/EditorObservable.ts -> modules/tinymce/src/core/main/ts/api/EditorObservable.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { Obj } from '@ephox/katamari';",
          "4: import DOMUtils from './dom/DOMUtils';",
          "5: import { EventUtilsCallback } from './dom/EventUtils';",
          "6: import Editor from './Editor';",
          "",
          "[Removed Lines]",
          "3: import { isReadOnly, processReadonlyEvents } from '../mode/Readonly';",
          "",
          "[Added Lines]",
          "3: import * as Disabled from '../mode/Disabled';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:   return editor.getBody();",
          "56: };",
          "59: const fireEvent = (editor: Editor, eventName: string, e: Event) => {",
          "60:   if (isListening(editor)) {",
          "61:     editor.dispatch(eventName, e);",
          "64:   }",
          "65: };",
          "",
          "[Removed Lines]",
          "58: const isListening = (editor: Editor) => !editor.hidden;",
          "62:   } else if (isReadOnly(editor)) {",
          "63:     processReadonlyEvents(editor, e);",
          "",
          "[Added Lines]",
          "58: const isListening = (editor: Editor) => !editor.hidden && !editor.disabled;",
          "62:   } else if (Disabled.isDisabled(editor)) {",
          "63:     Disabled.processDisabledEvents(editor, e);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/EventTypes.ts||modules/tinymce/src/core/main/ts/api/EventTypes.ts": [
          "File: modules/tinymce/src/core/main/ts/api/EventTypes.ts -> modules/tinymce/src/core/main/ts/api/EventTypes.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "173:   notification: NotificationApi;",
          "174: }",
          "176: export interface EditorEventMap extends Omit<NativeEventMap, 'blur' | 'focus'> {",
          "177:   'activate': { relatedTarget: Editor | null };",
          "178:   'deactivate': { relatedTarget: Editor };",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "176: export interface DisabledStateChangeEvent {",
          "177:   state: boolean;",
          "178: }",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/Events.ts||modules/tinymce/src/core/main/ts/api/Events.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Events.ts -> modules/tinymce/src/core/main/ts/api/Events.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: import Editor from './Editor';",
          "5: import {",
          "6:   BeforeSetContentEvent, SetContentEvent, PastePlainTextToggleEvent, PastePostProcessEvent, PastePreProcessEvent, GetContentEvent, BeforeGetContentEvent,",
          "8: } from './EventTypes';",
          "9: import { ParserArgs } from './html/DomParser';",
          "10: import { EditorEvent } from './util/EventDispatcher';",
          "",
          "[Removed Lines]",
          "7:   PreProcessEvent, PostProcessEvent, EditableRootStateChangeEvent",
          "",
          "[Added Lines]",
          "7:   PreProcessEvent, PostProcessEvent, EditableRootStateChangeEvent, DisabledStateChangeEvent",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "103: const fireEditableRootStateChange = (editor: Editor, state: boolean): EditorEvent<EditableRootStateChangeEvent> =>",
          "104:   editor.dispatch('EditableRootStateChange', { state });",
          "106: export {",
          "107:   firePreProcess,",
          "108:   firePostProcess,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "106: const fireDisabledStateChange = (editor: Editor, state: boolean): EditorEvent<DisabledStateChangeEvent> =>",
          "107:   editor.dispatch('DisabledStateChange', { state });",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "129:   firePastePlainTextToggle,",
          "130:   firePastePostProcess,",
          "131:   firePastePreProcess,",
          "133: };",
          "",
          "[Removed Lines]",
          "132:   fireEditableRootStateChange",
          "",
          "[Added Lines]",
          "135:   fireEditableRootStateChange,",
          "136:   fireDisabledStateChange",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/Mode.ts||modules/tinymce/src/core/main/ts/api/Mode.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Mode.ts -> modules/tinymce/src/core/main/ts/api/Mode.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { Cell, Fun } from '@ephox/katamari';",
          "3: import { registerMode, setMode } from '../mode/Mode';",
          "5: import Editor from './Editor';",
          "",
          "[Removed Lines]",
          "4: import { isReadOnly, registerReadOnlySelectionBlockers } from '../mode/Readonly';",
          "",
          "[Added Lines]",
          "4: import { isReadOnly, registerReadOnlyInputBlockers } from '../mode/Readonly';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "83:     }",
          "84:   });",
          "88:   return {",
          "89:     isReadOnly: () => isReadOnly(editor),",
          "",
          "[Removed Lines]",
          "86:   registerReadOnlySelectionBlockers(editor);",
          "",
          "[Added Lines]",
          "86:   registerReadOnlyInputBlockers(editor);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/OptionTypes.ts||modules/tinymce/src/core/main/ts/api/OptionTypes.ts": [
          "File: modules/tinymce/src/core/main/ts/api/OptionTypes.ts -> modules/tinymce/src/core/main/ts/api/OptionTypes.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "247:   width?: number | string;",
          "248:   xss_sanitization?: boolean;",
          "249:   license_key?: string;",
          "252:   disable_nodechange?: boolean;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "250:   disabled?: boolean;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "353:   visual_table_class: string;",
          "354:   width: number | string;",
          "355:   xss_sanitization: boolean;",
          "356: }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "357:   disabled: boolean;",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/api/Options.ts||modules/tinymce/src/core/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/core/main/ts/api/Options.ts -> modules/tinymce/src/core/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: import * as PatternTypes from '../textpatterns/core/PatternTypes';",
          "6: import DOMUtils from './dom/DOMUtils';",
          "7: import Editor from './Editor';",
          "8: import { EditorOptions } from './OptionTypes';",
          "9: import I18n from './util/I18n';",
          "10: import Tools from './util/Tools';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "8: import { fireDisabledStateChange } from './Events';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "437:     default: false",
          "438:   });",
          "440:   registerOption('readonly', {",
          "441:     processor: 'boolean',",
          "442:     default: false",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "441:   registerOption('disabled', {",
          "442:     processor: (value) => {",
          "443:       if (Type.isBoolean(value)) {",
          "444:         if (editor.disabled !== value) {",
          "445:           fireDisabledStateChange(editor, value);",
          "446:         }",
          "447:         return { valid: true, value };",
          "448:       }",
          "450:       return { valid: false, message: 'The value must be a boolean.' };",
          "451:     },",
          "452:     default: false",
          "453:   });",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "988: const shouldConvertUnsafeEmbeds = option('convert_unsafe_embeds');",
          "989: const getLicenseKey = option('license_key');",
          "990: const getApiKey = option('api_key');",
          "992: export {",
          "993:   register,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1006: const isDisabled = option('disabled');",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "1097:   getLicenseKey,",
          "1098:   getSandboxIframesExclusions,",
          "1099:   shouldConvertUnsafeEmbeds,",
          "1101: };",
          "",
          "[Removed Lines]",
          "1100:   getApiKey",
          "",
          "[Added Lines]",
          "1116:   getApiKey,",
          "1117:   isDisabled",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/init/Init.ts||modules/tinymce/src/core/main/ts/init/Init.ts": [
          "File: modules/tinymce/src/core/main/ts/init/Init.ts -> modules/tinymce/src/core/main/ts/init/Init.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "160:     hide: Optional.from(api.hide).getOr(Fun.noop),",
          "161:     isEnabled: Optional.from(api.isEnabled).getOr(Fun.always),",
          "162:     setEnabled: (state) => {",
          "164:       if (!shouldSkip) {",
          "165:         Optional.from(api.setEnabled).each((f) => f(state));",
          "166:       }",
          "",
          "[Removed Lines]",
          "163:       const shouldSkip = state && editor.mode.get() === 'readonly';",
          "",
          "[Added Lines]",
          "163:       const shouldSkip = state && (editor.mode.get() === 'readonly' || editor.disabled);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/init/InitContentBody.ts||modules/tinymce/src/core/main/ts/init/InitContentBody.ts": [
          "File: modules/tinymce/src/core/main/ts/init/InitContentBody.ts -> modules/tinymce/src/core/main/ts/init/InitContentBody.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "27: import * as ForceBlocks from '../ForceBlocks';",
          "28: import * as NonEditableFilter from '../html/NonEditableFilter';",
          "29: import * as KeyboardOverrides from '../keyboard/KeyboardOverrides';",
          "30: import { NodeChange } from '../NodeChange';",
          "31: import * as Paste from '../paste/Paste';",
          "32: import * as Rtc from '../Rtc';",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "30: import * as Disabled from '../mode/Disabled';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "254: const initEditor = (editor: Editor) => {",
          "255:   editor.bindPendingEventDelegates();",
          "256:   editor.initialized = true;",
          "257:   Events.fireInit(editor);",
          "258:   editor.focus(true);",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "257:   if (editor.disabled) {",
          "258:     Disabled.toggleDisabled(editor, true);",
          "259:   }",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "263:     initInstanceCallback.call(editor, editor);",
          "264:   }",
          "265:   autoFocus(editor);",
          "266: };",
          "268: const getStyleSheetLoader = (editor: Editor): StyleSheetLoader =>",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "270:   Disabled.registerEventsAndFilters(editor);",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "421:   (body as any).disabled = true;",
          "422:   editor.readonly = Options.isReadOnly(editor);",
          "423:   editor._editableRoot = Options.hasEditableRoot(editor);",
          "426:     if (editor.inline && DOM.getStyle(body, 'position', true) === 'static') {",
          "427:       body.style.position = 'relative';",
          "428:     }",
          "",
          "[Removed Lines]",
          "425:   if (editor.hasEditableRoot()) {",
          "",
          "[Added Lines]",
          "428:   editor.disabled = Options.isDisabled(editor);",
          "431:   if (!editor.disabled && editor.hasEditableRoot()) {",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/mode/Disabled.ts||modules/tinymce/src/core/main/ts/mode/Disabled.ts": [
          "File: modules/tinymce/src/core/main/ts/mode/Disabled.ts -> modules/tinymce/src/core/main/ts/mode/Disabled.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { Arr, Optional, Strings } from '@ephox/katamari';",
          "2: import { Attribute, Compare, SelectorFilter, SelectorFind, SugarElement } from '@ephox/sugar';",
          "4: import Editor from '../api/Editor';",
          "5: import VK from '../api/util/VK';",
          "6: import * as ModeUtils from '../util/ModeUtils';",
          "8: const isDisabled = (editor: Editor): boolean => editor.disabled;",
          "10: const internalContentEditableAttr = 'data-mce-contenteditable';",
          "12: const setContentEditable = (elm: SugarElement<HTMLElement>, state: boolean) => {",
          "13:   elm.dom.contentEditable = state ? 'true' : 'false';",
          "14: };",
          "16: const switchOffContentEditableTrue = (elm: SugarElement<Node>) => {",
          "17:   Arr.each(SelectorFilter.descendants<HTMLElement>(elm, '*[contenteditable=\"true\"]'), (elm) => {",
          "18:     Attribute.set(elm, internalContentEditableAttr, 'true');",
          "19:     setContentEditable(elm, false);",
          "20:   });",
          "21: };",
          "23: const switchOnContentEditableTrue = (elm: SugarElement<Node>) => {",
          "24:   Arr.each(SelectorFilter.descendants<HTMLElement>(elm, `*[${internalContentEditableAttr}=\"true\"]`), (elm) => {",
          "25:     Attribute.remove(elm, internalContentEditableAttr);",
          "26:     setContentEditable(elm, true);",
          "27:   });",
          "28: };",
          "30: const toggleDisabled = (editor: Editor, state: boolean): void => {",
          "31:   const body = SugarElement.fromDom(editor.getBody());",
          "33:   if (state) {",
          "34:     editor.disabled = true;",
          "35:     ModeUtils.disableEditor(editor);",
          "36:     setContentEditable(body, false);",
          "37:     switchOffContentEditableTrue(body);",
          "38:   } else {",
          "39:     editor.disabled = false;",
          "40:     switchOnContentEditableTrue(body);",
          "41:     ModeUtils.enableEditor(editor);",
          "42:   }",
          "43: };",
          "45: const registerDisabledContentFilters = (editor: Editor): void => {",
          "46:   if (editor.serializer) {",
          "47:     registerFilters(editor);",
          "48:   } else {",
          "49:     editor.on('PreInit', () => {",
          "50:       registerFilters(editor);",
          "51:     });",
          "52:   }",
          "53: };",
          "55: const registerFilters = (editor: Editor): void => {",
          "56:   editor.parser.addAttributeFilter('contenteditable', (nodes) => {",
          "57:     if (isDisabled(editor)) {",
          "58:       Arr.each(nodes, (node) => {",
          "59:         node.attr(internalContentEditableAttr, node.attr('contenteditable'));",
          "60:         node.attr('contenteditable', 'false');",
          "61:       });",
          "62:     }",
          "63:   });",
          "65:   editor.serializer.addAttributeFilter(internalContentEditableAttr, (nodes) => {",
          "66:     if (isDisabled(editor)) {",
          "67:       Arr.each(nodes, (node) => {",
          "68:         node.attr('contenteditable', node.attr(internalContentEditableAttr));",
          "69:       });",
          "70:     }",
          "71:   });",
          "73:   editor.serializer.addTempAttr(internalContentEditableAttr);",
          "74: };",
          "76: const isClickEvent = (e: Event): e is MouseEvent => e.type === 'click';",
          "78: const allowedEvents: ReadonlyArray<string> = [ 'copy' ];",
          "80: const isDisabledAllowedEvent = (e: Event) => Arr.contains(allowedEvents, e.type);",
          "82: const getAnchorHrefOpt = (editor: Editor, elm: SugarElement<Node>): Optional<string> => {",
          "83:   const isRoot = (elm: SugarElement<Node>) => Compare.eq(elm, SugarElement.fromDom(editor.getBody()));",
          "84:   return SelectorFind.closest<HTMLAnchorElement>(elm, 'a', isRoot).bind((a) => Attribute.getOpt(a, 'href'));",
          "85: };",
          "87: const processDisabledEvents = (editor: Editor, e: Event): void => {",
          "89:     If an event is a click event on or within an anchor, and the CMD/CTRL key is",
          "90:     not held, then we want to prevent default behaviour and either:",
          "91:       a) scroll to the relevant bookmark",
          "92:       b) open the link using default browser behaviour",
          "94:   if (isClickEvent(e) && !VK.metaKeyPressed(e)) {",
          "95:     const elm = SugarElement.fromDom(e.target as Node);",
          "96:     getAnchorHrefOpt(editor, elm).each((href) => {",
          "97:       e.preventDefault();",
          "98:       if (/^#/.test(href)) {",
          "99:         const targetEl = editor.dom.select(`${href},[name=\"${Strings.removeLeading(href, '#')}\"]`);",
          "100:         if (targetEl.length) {",
          "101:           editor.selection.scrollIntoView(targetEl[0], true);",
          "102:         }",
          "103:       } else {",
          "104:         window.open(href, '_blank', 'rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes');",
          "105:       }",
          "106:     });",
          "107:   } else if (isDisabledAllowedEvent(e)) {",
          "108:     editor.dispatch(e.type, e);",
          "109:   }",
          "110: };",
          "112: const registerDisabledModeEventHandlers = (editor: Editor): void => {",
          "113:   editor.on('ShowCaret', (e) => {",
          "114:     if (isDisabled(editor)) {",
          "115:       e.preventDefault();",
          "116:     }",
          "117:   });",
          "119:   editor.on('ObjectSelected', (e) => {",
          "120:     if (isDisabled(editor)) {",
          "121:       e.preventDefault();",
          "122:     }",
          "123:   });",
          "126:   editor.on('DisabledStateChange', (e) => {",
          "127:     if (!e.isDefaultPrevented()) {",
          "128:       toggleDisabled(editor, e.state);",
          "129:     }",
          "130:   }, true);",
          "131: };",
          "133: const registerEventsAndFilters = (editor: Editor): void => {",
          "134:   registerDisabledContentFilters(editor);",
          "135:   registerDisabledModeEventHandlers(editor);",
          "136: };",
          "138: export {",
          "139:   isDisabled,",
          "140:   processDisabledEvents,",
          "141:   getAnchorHrefOpt,",
          "142:   toggleDisabled,",
          "143:   registerEventsAndFilters",
          "144: };",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/mode/EditableRoot.ts||modules/tinymce/src/core/main/ts/mode/EditableRoot.ts": [
          "File: modules/tinymce/src/core/main/ts/mode/EditableRoot.ts -> modules/tinymce/src/core/main/ts/mode/EditableRoot.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "5:   if (editor._editableRoot !== state) {",
          "6:     editor._editableRoot = state;",
          "11:     Events.fireEditableRootStateChange(editor, state);",
          "12:   }",
          "",
          "[Removed Lines]",
          "8:     editor.getBody().contentEditable = String(editor.hasEditableRoot());",
          "9:     editor.nodeChanged();",
          "",
          "[Added Lines]",
          "8:     if (!editor.disabled) {",
          "9:       editor.getBody().contentEditable = String(editor.hasEditableRoot());",
          "10:       editor.nodeChanged();",
          "11:     }",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/mode/Mode.ts||modules/tinymce/src/core/main/ts/mode/Mode.ts": [
          "File: modules/tinymce/src/core/main/ts/mode/Mode.ts -> modules/tinymce/src/core/main/ts/mode/Mode.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "28: };",
          "30: const setMode = (editor: Editor, availableModes: Record<string, EditorModeApi>, activeMode: Cell<string>, mode: string): void => {",
          "32:     return;",
          "33:   } else if (!Obj.has(availableModes, mode)) {",
          "34:     throw new Error(`Editor mode '${mode}' is invalid`);",
          "",
          "[Removed Lines]",
          "31:   if (mode === activeMode.get()) {",
          "",
          "[Added Lines]",
          "31:   if (mode === activeMode.get() || editor.disabled) {",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/mode/Readonly.ts||modules/tinymce/src/core/main/ts/mode/Readonly.ts": [
          "File: modules/tinymce/src/core/main/ts/mode/Readonly.ts -> modules/tinymce/src/core/main/ts/mode/Readonly.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "4: import Editor from '../api/Editor';",
          "27: const setContentEditable = (elm: SugarElement<HTMLElement>, state: boolean) => {",
          "28:   elm.dom.contentEditable = state ? 'true' : 'false';",
          "29: };",
          "67: const toggleReadOnly = (editor: Editor, state: boolean): void => {",
          "68:   const body = SugarElement.fromDom(editor.getBody());",
          "71:   if (state) {",
          "73:     if (editor.hasEditableRoot()) {",
          "74:       setContentEditable(body, true);",
          "75:     }",
          "76:   } else {",
          "78:   }",
          "79: };",
          "81: const isReadOnly = (editor: Editor): boolean => editor.readonly;",
          "123:   editor.on('beforeinput paste cut dragend dragover draggesture dragdrop drop drag', (e) => {",
          "124:     if (isReadOnly(editor)) {",
          "125:       e.preventDefault();",
          "",
          "[Removed Lines]",
          "1: import { Arr, Optional, Strings, Type } from '@ephox/katamari';",
          "2: import { Attribute, Class, Compare, SelectorFind, SugarElement } from '@ephox/sugar';",
          "5: import VK from '../api/util/VK';",
          "6: import * as EditorFocus from '../focus/EditorFocus';",
          "9: const toggleClass = (elm: SugarElement<Element>, cls: string, state: boolean) => {",
          "10:   if (Class.has(elm, cls) && !state) {",
          "11:     Class.remove(elm, cls);",
          "12:   } else if (state) {",
          "13:     Class.add(elm, cls);",
          "14:   }",
          "15: };",
          "17: const setEditorCommandState = (editor: Editor, cmd: string, state: boolean) => {",
          "18:   try {",
          "21:     editor.getDoc().execCommand(cmd, false, String(state));",
          "22:   } catch (ex) {",
          "24:   }",
          "25: };",
          "31: const removeFakeSelection = (editor: Editor) => {",
          "32:   Optional.from(editor.selection.getNode()).each((elm) => {",
          "33:     elm.removeAttribute('data-mce-selected');",
          "34:   });",
          "35: };",
          "37: const restoreFakeSelection = (editor: Editor) => {",
          "38:   editor.selection.setRng(editor.selection.getRng());",
          "39: };",
          "41: const setCommonEditorCommands = (editor: Editor, state: boolean): void => {",
          "42:   setEditorCommandState(editor, 'StyleWithCSS', state);",
          "43:   setEditorCommandState(editor, 'enableInlineTableEditing', state);",
          "44:   setEditorCommandState(editor, 'enableObjectResizing', state);",
          "45: };",
          "47: const setEditorReadonly = (editor: Editor) => {",
          "48:   editor.readonly = true;",
          "49:   editor.selection.controlSelection.hideResizeRect();",
          "50:   editor._selectionOverrides.hideFakeCaret();",
          "51:   removeFakeSelection(editor);",
          "52: };",
          "54: const unsetEditorReadonly = (editor: Editor, body: SugarElement<HTMLElement>) => {",
          "55:   editor.readonly = false;",
          "56:   if (editor.hasEditableRoot()) {",
          "57:     setContentEditable(body, true);",
          "58:   }",
          "59:   setCommonEditorCommands(editor, false);",
          "60:   if (EditorFocus.hasEditorOrUiFocus(editor)) {",
          "61:     editor.focus();",
          "62:   }",
          "63:   restoreFakeSelection(editor);",
          "64:   editor.nodeChanged();",
          "65: };",
          "69:   toggleClass(body, 'mce-content-readonly', state);",
          "72:     setEditorReadonly(editor);",
          "77:     unsetEditorReadonly(editor, body);",
          "83: const isClickEvent = (e: Event): e is MouseEvent => e.type === 'click';",
          "85: const allowedEvents: ReadonlyArray<string> = [ 'copy' ];",
          "87: const isReadOnlyAllowedEvent = (e: Event) => Arr.contains(allowedEvents, e.type);",
          "92: const getAnchorHrefOpt = (editor: Editor, elm: SugarElement<Node>): Optional<string> => {",
          "93:   const isRoot = (elm: SugarElement<Node>) => Compare.eq(elm, SugarElement.fromDom(editor.getBody()));",
          "94:   return SelectorFind.closest<HTMLAnchorElement>(elm, 'a', isRoot).bind((a) => Attribute.getOpt(a, 'href'));",
          "95: };",
          "97: const processReadonlyEvents = (editor: Editor, e: Event): void => {",
          "99:     If an event is a click event on or within an anchor, and the CMD/CTRL key is",
          "100:     not held, then we want to prevent default behaviour and either:",
          "101:       a) scroll to the relevant bookmark",
          "102:       b) open the link using default browser behaviour",
          "104:   if (isClickEvent(e) && !VK.metaKeyPressed(e)) {",
          "105:     const elm = SugarElement.fromDom(e.target as Node);",
          "106:     getAnchorHrefOpt(editor, elm).each((href) => {",
          "107:       e.preventDefault();",
          "108:       if (/^#/.test(href)) {",
          "109:         const targetEl = editor.dom.select(`${href},[name=\"${Strings.removeLeading(href, '#')}\"]`);",
          "110:         if (targetEl.length) {",
          "111:           editor.selection.scrollIntoView(targetEl[0], true);",
          "112:         }",
          "113:       } else {",
          "114:         window.open(href, '_blank', 'rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes');",
          "115:       }",
          "116:     });",
          "117:   } else if (isReadOnlyAllowedEvent(e)) {",
          "118:     editor.dispatch(e.type, e);",
          "119:   }",
          "120: };",
          "122: const registerReadOnlySelectionBlockers = (editor: Editor): void => {",
          "",
          "[Added Lines]",
          "1: import { Type } from '@ephox/katamari';",
          "2: import { SugarElement } from '@ephox/sugar';",
          "5: import * as ModeUtils from '../util/ModeUtils';",
          "15:     editor.readonly = true;",
          "19:     ModeUtils.disableEditor(editor);",
          "21:     editor.readonly = false;",
          "22:     ModeUtils.enableEditor(editor);",
          "28: const registerReadOnlyInputBlockers = (editor: Editor): void => {",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "154: export {",
          "155:   isReadOnly,",
          "157:   toggleReadOnly,",
          "160: };",
          "",
          "[Removed Lines]",
          "156:   getAnchorHrefOpt,",
          "158:   processReadonlyEvents,",
          "159:   registerReadOnlySelectionBlockers",
          "",
          "[Added Lines]",
          "63:   registerReadOnlyInputBlockers",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/main/ts/util/ModeUtils.ts||modules/tinymce/src/core/main/ts/util/ModeUtils.ts": [
          "File: modules/tinymce/src/core/main/ts/util/ModeUtils.ts -> modules/tinymce/src/core/main/ts/util/ModeUtils.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { Optional } from '@ephox/katamari';",
          "2: import { Class, SugarElement } from '@ephox/sugar';",
          "4: import Editor from '../api/Editor';",
          "5: import * as EditorFocus from '../focus/EditorFocus';",
          "7: const removeFakeSelection = (editor: Editor) => {",
          "8:   Optional.from(editor.selection.getNode()).each((elm) => {",
          "9:     elm.removeAttribute('data-mce-selected');",
          "10:   });",
          "11: };",
          "13: const setEditorCommandState = (editor: Editor, cmd: string, state: boolean) => {",
          "14:   try {",
          "17:     editor.getDoc().execCommand(cmd, false, String(state));",
          "18:   } catch (ex) {",
          "20:   }",
          "21: };",
          "23: const setCommonEditorCommands = (editor: Editor, state: boolean): void => {",
          "24:   setEditorCommandState(editor, 'StyleWithCSS', state);",
          "25:   setEditorCommandState(editor, 'enableInlineTableEditing', state);",
          "26:   setEditorCommandState(editor, 'enableObjectResizing', state);",
          "27: };",
          "29: const setContentEditable = (elm: SugarElement<HTMLElement>, state: boolean) => {",
          "30:   elm.dom.contentEditable = state ? 'true' : 'false';",
          "31: };",
          "33: const restoreFakeSelection = (editor: Editor) => {",
          "34:   editor.selection.setRng(editor.selection.getRng());",
          "35: };",
          "38: const toggleClass = (elm: SugarElement<Element>, cls: string, state: boolean) => {",
          "39:   if (Class.has(elm, cls) && !state) {",
          "40:     Class.remove(elm, cls);",
          "41:   } else if (state) {",
          "42:     Class.add(elm, cls);",
          "43:   }",
          "44: };",
          "46: const disableEditor = (editor: Editor): void => {",
          "47:   const body = SugarElement.fromDom(editor.getBody());",
          "48:   toggleClass(body, 'mce-content-readonly', true);",
          "49:   editor.selection.controlSelection.hideResizeRect();",
          "50:   editor._selectionOverrides.hideFakeCaret();",
          "51:   removeFakeSelection(editor);",
          "52: };",
          "54: const enableEditor = (editor: Editor): void => {",
          "55:   const body = SugarElement.fromDom(editor.getBody());",
          "56:   toggleClass(body, 'mce-content-readonly', false);",
          "58:   if (editor.hasEditableRoot()) {",
          "59:     setContentEditable(body, true);",
          "60:   }",
          "61:   setCommonEditorCommands(editor, false);",
          "62:   if (EditorFocus.hasEditorOrUiFocus(editor)) {",
          "63:     editor.focus();",
          "64:   }",
          "65:   restoreFakeSelection(editor);",
          "66:   editor.nodeChanged();",
          "67: };",
          "69: export {",
          "70:   enableEditor,",
          "71:   disableEditor",
          "72: };",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/DisabledModeTest.ts||modules/tinymce/src/core/test/ts/browser/DisabledModeTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/DisabledModeTest.ts -> modules/tinymce/src/core/test/ts/browser/DisabledModeTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: import { ApproxStructure, Mouse, UiFinder, Clipboard, TestStore } from '@ephox/agar';",
          "2: import { afterEach, Assert, context, describe, it } from '@ephox/bedrock-client';",
          "3: import { Arr, Optional, OptionalInstances } from '@ephox/katamari';",
          "4: import { Class, Css, Scroll, SelectorFind, SugarBody, SugarElement, Traverse } from '@ephox/sugar';",
          "5: import { TinyAssertions, TinyDom, TinyHooks, TinySelections } from '@ephox/wrap-mcagar';",
          "6: import { assert } from 'chai';",
          "8: import Editor from 'tinymce/core/api/Editor';",
          "9: import * as Disabled from 'tinymce/core/mode/Disabled';",
          "10: import TablePlugin from 'tinymce/plugins/table/Plugin';",
          "12: const tOptional = OptionalInstances.tOptional;",
          "14: interface TestButtonDisabledState {",
          "15:   name: string;",
          "16:   disabledAttribute: 'aria-disabled' | 'disabled';",
          "17: }",
          "19: describe('browser.tinymce.core.DisabledModeTest', () => {",
          "20:   const settings = {",
          "21:     base_url: '/project/tinymce/js/tinymce',",
          "22:     toolbar: 'bold',",
          "23:     statusbar: false",
          "24:   };",
          "26:   context('Disabled mode', () => {",
          "27:     const hook = TinyHooks.bddSetup<Editor>({ ...settings, plugins: 'table' }, [ TablePlugin ]);",
          "29:     const assertNestedContentEditableTrueDisabled = (editor: Editor, state: boolean, offscreen: boolean) => {",
          "30:       TinyAssertions.assertContentStructure(editor,",
          "31:         ApproxStructure.build((s, str, _arr) => {",
          "32:           const attrs = state ? {",
          "33:             'contenteditable': str.is('false'),",
          "34:             'data-mce-contenteditable': str.is('true')",
          "35:           } : {",
          "36:             'contenteditable': str.is('true'),",
          "37:             'data-mce-contenteditable': str.none()",
          "38:           };",
          "40:           return s.element('body', {",
          "41:             children: [",
          "42:               s.element('div', {",
          "43:                 attrs: {",
          "44:                   contenteditable: str.is('false')",
          "45:                 },",
          "46:                 children: [",
          "47:                   s.text(str.is('a')),",
          "48:                   s.element('span', {",
          "49:                     attrs,",
          "50:                   }),",
          "51:                   s.text(str.is('c'))",
          "52:                 ]",
          "53:               }),",
          "54:               ...offscreen ? [ s.element('div', {}) ] : [] // Offscreen cef clone",
          "55:             ]",
          "56:           });",
          "57:         })",
          "58:       );",
          "59:     };",
          "61:     const assertFakeSelection = (editor: Editor, expectedState: boolean) => {",
          "62:       assert.equal(editor.selection.getNode().hasAttribute('data-mce-selected'), expectedState, 'Selected element should have expected state');",
          "63:     };",
          "65:     const assertResizeBars = (editor: Editor, expectedState: boolean) => {",
          "66:       SelectorFind.descendant(Traverse.documentElement(TinyDom.document(editor)), '.ephox-snooker-resizer-bar').fold(",
          "67:         () => {",
          "68:           assert.isFalse(expectedState, 'Was expecting to find resize bars');",
          "69:         },",
          "70:         (bar) => {",
          "71:           const actualDisplay = Css.get(bar, 'display');",
          "72:           const expectedDisplay = expectedState ? 'block' : 'none';",
          "73:           assert.equal(actualDisplay, expectedDisplay, 'Should be expected display state on resize bar');",
          "74:         }",
          "75:       );",
          "76:     };",
          "78:     const mouseOverTable = (editor: Editor) => {",
          "79:       const table = UiFinder.findIn(TinyDom.body(editor), 'table').getOrDie();",
          "80:       Mouse.mouseOver(table);",
          "81:     };",
          "83:     const assertToolbarDisabled = (expectedState: boolean) => {",
          "84:       const elm = UiFinder.findIn(SugarBody.body(), 'button[data-mce-name=\"bold\"]').getOrDie();",
          "85:       assert.equal(Class.has(elm, 'tox-tbtn--disabled'), expectedState, 'Button should have expected disabled state');",
          "86:     };",
          "88:     const assertHrefOpt = (editor: Editor, selector: string, expectedHref: Optional<string>) => {",
          "89:       const elm = SugarElement.fromDom(editor.dom.select(selector)[0]);",
          "90:       const hrefOpt = Disabled.getAnchorHrefOpt(editor, elm);",
          "91:       Assert.eq('href options match', expectedHref, hrefOpt, tOptional());",
          "92:     };",
          "94:     it('TBA: Switching to disabled mode while having cef selection should remove fake selection', () => {",
          "95:       const editor = hook.editor();",
          "96:       editor.setContent('<div contenteditable=\"false\">CEF</div>');",
          "97:       TinySelections.select(editor, 'div[contenteditable=\"false\"]', []);",
          "98:       assertFakeSelection(editor, true);",
          "99:       editor.options.set('disabled', true);",
          "100:       assertFakeSelection(editor, false);",
          "101:       editor.options.set('disabled', false);",
          "102:       assertFakeSelection(editor, true);",
          "103:     });",
          "105:     it('TBA: Selecting cef element while in disabled mode should not add fake selection', () => {",
          "106:       const editor = hook.editor();",
          "107:       editor.setContent('<div contenteditable=\"false\">CEF</div>');",
          "108:       TinySelections.select(editor, 'div[contenteditable=\"false\"]', []);",
          "109:       assertFakeSelection(editor, true);",
          "110:       editor.options.set('disabled', true);",
          "111:       TinySelections.select(editor, 'div[contenteditable=\"false\"]', []);",
          "112:       assertFakeSelection(editor, false);",
          "113:       editor.options.set('disabled', false);",
          "114:       TinySelections.select(editor, 'div[contenteditable=\"false\"]', []);",
          "115:       assertFakeSelection(editor, true);",
          "116:     });",
          "118:     it('TBA: Setting caret before cef in editor while in disabled mode should not render fake caret', () => {",
          "119:       const editor = hook.editor();",
          "120:       editor.setContent('<div contenteditable=\"false\">CEF</div>');",
          "121:       editor.options.set('disabled', true);",
          "122:       TinySelections.setCursor(editor, [], 0);",
          "123:       TinyAssertions.assertContentStructure(editor,",
          "124:         ApproxStructure.build((s, str, _arr) => {",
          "125:           return s.element('body', {",
          "126:             children: [",
          "127:               s.element('div', {",
          "128:                 attrs: {",
          "129:                   contenteditable: str.is('false')",
          "130:                 },",
          "131:                 children: [",
          "132:                   s.text(str.is('CEF'))",
          "133:                 ]",
          "134:               })",
          "135:             ]",
          "136:           });",
          "137:         })",
          "138:       );",
          "139:       editor.options.set('disabled', false);",
          "140:       TinyAssertions.assertContentStructure(editor,",
          "141:         ApproxStructure.build((s, str, arr) => {",
          "142:           return s.element('body', {",
          "143:             children: [",
          "144:               s.element('p', {",
          "145:                 attrs: {",
          "146:                   'data-mce-caret': str.is('before'),",
          "147:                   'data-mce-bogus': str.is('all')",
          "148:                 },",
          "149:                 children: [",
          "150:                   s.element('br', {})",
          "151:                 ]",
          "152:               }),",
          "153:               s.element('div', {",
          "154:                 attrs: {",
          "155:                   contenteditable: str.is('false')",
          "156:                 },",
          "157:                 children: [",
          "158:                   s.text(str.is('CEF'))",
          "159:                 ]",
          "160:               }),",
          "161:               s.element('div', {",
          "162:                 attrs: {",
          "163:                   'data-mce-bogus': str.is('all')",
          "164:                 },",
          "165:                 classes: [ arr.has('mce-visual-caret'), arr.has('mce-visual-caret-before') ]",
          "166:               })",
          "167:             ]",
          "168:           });",
          "169:         })",
          "170:       );",
          "171:     });",
          "173:     it('TBA: Switching to disabled mode on content with nested contenteditable=true should toggle them to contenteditable=false', async () => {",
          "174:       const editor = hook.editor();",
          "175:       editor.setContent('<div contenteditable=\"false\">a<span contenteditable=\"true\">b</span>c</div>');",
          "176:       TinySelections.select(editor, 'div[contenteditable=\"false\"]', []);",
          "177:       assertFakeSelection(editor, true);",
          "178:       editor.options.set('disabled', true);",
          "179:       assertNestedContentEditableTrueDisabled(editor, true, true);",
          "180:       TinyAssertions.assertContent(editor, '<div contenteditable=\"false\">a<span contenteditable=\"true\">b</span>c</div>');",
          "181:       assertFakeSelection(editor, false);",
          "182:       editor.options.set('disabled', false);",
          "183:       TinyAssertions.assertContent(editor, '<div contenteditable=\"false\">a<span contenteditable=\"true\">b</span>c</div>');",
          "184:       assertNestedContentEditableTrueDisabled(editor, false, true);",
          "185:     });",
          "187:     it('TBA: Setting contents with contenteditable=true should switch them to contenteditable=false while in disabled mode', () => {",
          "188:       const editor = hook.editor();",
          "189:       editor.options.set('disabled', true);",
          "190:       editor.setContent('<div contenteditable=\"false\">a<span contenteditable=\"true\">b</span>c</div>');",
          "191:       assertNestedContentEditableTrueDisabled(editor, true, false);",
          "192:       TinyAssertions.assertContent(editor, '<div contenteditable=\"false\">a<span contenteditable=\"true\">b</span>c</div>');",
          "193:       editor.options.set('disabled', false);",
          "194:       TinyAssertions.assertContent(editor, '<div contenteditable=\"false\">a<span contenteditable=\"true\">b</span>c</div>');",
          "195:       TinySelections.select(editor, 'div[contenteditable=\"false\"]', []);",
          "196:       assertNestedContentEditableTrueDisabled(editor, false, true);",
          "197:       editor.setContent('<div contenteditable=\"false\">a<span contenteditable=\"true\">b</span>c</div>');",
          "198:       TinySelections.select(editor, 'div[contenteditable=\"false\"]', []);",
          "199:       assertNestedContentEditableTrueDisabled(editor, false, true);",
          "200:     });",
          "202:     it('TBA: Resize bars for tables should be hidden while in disabled mode', async () => {",
          "203:       const editor = hook.editor();",
          "204:       editor.setContent('<table><tbody><tr><td>a</td></tr></tbody></table>');",
          "205:       TinySelections.setCursor(editor, [ 0, 0, 0, 0, 0 ], 0);",
          "206:       mouseOverTable(editor);",
          "207:       assertResizeBars(editor, true);",
          "208:       editor.options.set('disabled', true);",
          "209:       assertResizeBars(editor, false);",
          "210:       mouseOverTable(editor);",
          "211:       assertResizeBars(editor, false);",
          "212:       editor.options.set('disabled', false);",
          "213:       mouseOverTable(editor);",
          "214:       assertResizeBars(editor, true);",
          "215:     });",
          "217:     it('TBA: Context toolbar should be hidden in disabled mode', async () => {",
          "218:       const editor = hook.editor();",
          "219:       editor.focus();",
          "220:       editor.setContent('<table><tbody><tr><td>a</td></tr></tbody></table>');",
          "221:       TinySelections.setCursor(editor, [ 0, 0, 0, 0, 0 ], 0);",
          "222:       await UiFinder.pWaitFor('Waited for context toolbar', SugarBody.body(), '.tox-pop');",
          "223:       editor.options.set('disabled', true);",
          "224:       UiFinder.notExists(SugarBody.body(), '.tox-pop');",
          "225:       editor.options.set('disabled', false);",
          "226:       editor.setContent('<table><tbody><tr><td>a</td></tr></tbody></table>');",
          "227:       TinySelections.setCursor(editor, [ 0, 0, 0, 0, 0 ], 0);",
          "228:       UiFinder.sWaitFor('Waited for context toolbar', SugarBody.body(), '.tox-pop');",
          "229:     });",
          "231:     it('TBA: Main toolbar should be disabled when switching to disabled mode', () => {",
          "232:       const editor = hook.editor();",
          "233:       assertToolbarDisabled(false);",
          "234:       editor.options.set('disabled', true);",
          "235:       assertToolbarDisabled(true);",
          "236:       editor.options.set('disabled', false);",
          "237:       assertToolbarDisabled(false);",
          "238:     });",
          "240:     it('TBA: Menus should close when switching to readonly mode', async () => {",
          "241:       const editor = hook.editor();",
          "242:       const fileMenu = UiFinder.findIn(SugarBody.body(), '.tox-mbtn:contains(\"File\")').getOrDie();",
          "243:       Mouse.click(fileMenu);",
          "244:       await UiFinder.pWaitFor('Waited for menu', SugarBody.body(), '.tox-menu');",
          "245:       editor.options.set('disabled', true);",
          "246:       UiFinder.notExists(SugarBody.body(), '.tox-menu');",
          "247:       editor.options.set('disabled', false);",
          "248:     });",
          "250:     it('TINY-6248: getAnchorHrefOpt should return an Optional of the href of the closest anchor tag', () => {",
          "251:       const editor = hook.editor();",
          "252:       editor.setContent('<p><a href=\"https://tiny.cloud\">external link</a></p>');",
          "253:       assertHrefOpt(editor, 'a', Optional.some('https://tiny.cloud'));",
          "254:       editor.setContent('<p><a>external link with no href</a></p>');",
          "255:       assertHrefOpt(editor, 'a', Optional.none());",
          "256:       editor.setContent('<p><a href=\"https://tiny.cloud\"><img src=\"\">nested image </img>inside anchor</a></p>');",
          "257:       assertHrefOpt(editor, 'img', Optional.some('https://tiny.cloud'));",
          "258:     });",
          "260:     it('TINY-6248: processReadonlyEvents should scroll to bookmark with id in disabled mode', () => {",
          "261:       const editor = hook.editor();",
          "262:       editor.resetContent();",
          "263:       editor.options.set('disabled', true);",
          "264:       editor.setContent('<p><a href=\"#someBookmark\">internal bookmark</a></p><div style=\"padding-top: 2000px;\"></div><p><a id=\"someBookmark\"></a></p>');",
          "266:       const body = TinyDom.body(editor);",
          "267:       const doc = TinyDom.document(editor);",
          "268:       const yPos = Scroll.get(doc).top;",
          "269:       const anchor = UiFinder.findIn(body, 'a[href=\"#someBookmark\"]').getOrDie();",
          "270:       Mouse.click(anchor);",
          "271:       const newPos = Scroll.get(doc).top;",
          "272:       assert.notEqual(newPos, yPos, 'assert yPos has changed i.e. has scrolled');",
          "273:       editor.options.set('disabled', false);",
          "274:     });",
          "276:     it('TINY-6800: Copy events should be dispatched even in disabled mode', () => {",
          "277:       const editor = hook.editor();",
          "278:       editor.options.set('disabled', true);",
          "280:       let copyEventCount = 0;",
          "281:       const copyHandler = () => copyEventCount++;",
          "282:       editor.on('copy', copyHandler);",
          "284:       Clipboard.copy(TinyDom.body(editor));",
          "285:       assert.equal(copyEventCount, 1, 'copy event should be fired');",
          "286:       editor.off('copy', copyHandler);",
          "287:       editor.options.set('disabled', false);",
          "288:     });",
          "290:     it('TINY-6248: processReadonlyEvents should scroll to bookmark with name in disabled mode', async () => {",
          "291:       const editor = hook.editor();",
          "292:       const body = TinyDom.body(editor);",
          "293:       const doc = TinyDom.document(editor);",
          "294:       editor.resetContent();",
          "295:       editor.options.set('disabled', true);",
          "296:       editor.setContent('<p><a href=\"#someBookmark\">internal bookmark</a></p><div style=\"padding-top: 2000px;\"></div><p><a name=\"someBookmark\"></a></p>');",
          "298:       const yPos = Scroll.get(doc).top;",
          "299:       const anchor = UiFinder.findIn(body, 'a[href=\"#someBookmark\"]').getOrDie();",
          "300:       Mouse.click(anchor);",
          "301:       const newPos = Scroll.get(doc).top;",
          "302:       assert.notEqual(newPos, yPos, 'assert yPos has changed i.e. has scrolled');",
          "303:       editor.options.set('disabled', false);",
          "304:     });",
          "306:     const assertBodyClass = (editor: Editor, cls: string, state: boolean) => {",
          "307:       assert.equal(Class.has(TinyDom.body(editor), cls), state, 'Should be the expected class state');",
          "308:     };",
          "310:     it('TINY-11488: Assert body class when editor is disabled', () => {",
          "311:       const editor = hook.editor();",
          "312:       editor.options.set('disabled', true);",
          "313:       assertBodyClass(editor, 'mce-content-readonly', true);",
          "315:       editor.options.set('disabled', false);",
          "316:       assertBodyClass(editor, 'mce-content-readonly', false);",
          "318:       editor.options.set('disabled', true);",
          "319:       assertBodyClass(editor, 'mce-content-readonly', true);",
          "320:     });",
          "321:   });",
          "323:   const assertContentEditableBody = (editor: Editor) => (shouldBeEditable: boolean) => {",
          "324:     assert.isTrue(editor.getBody().contentEditable === shouldBeEditable.toString(), 'Editor body contentEditable should be ' + shouldBeEditable);",
          "325:   };",
          "327:   const assertEditorContainerClass = (editor: Editor) => (shouldNotHaveClass: boolean) => {",
          "328:     const hasClass = Class.has(TinyDom.container(editor), 'tox-tinymce--disabled');",
          "329:     assert.equal(!hasClass, shouldNotHaveClass, 'Editor container should not have class: tox-tinymce--disabled');",
          "330:   };",
          "332:   const assertEditorState = (shouldBeEnabled: boolean) => (editor: Editor) => {",
          "333:     assert.equal(editor.disabled, !shouldBeEnabled, `Editor.disabled should be ${!shouldBeEnabled}`);",
          "334:     assertContentEditableBody(editor)(shouldBeEnabled);",
          "335:     assertEditorContainerClass(editor)(shouldBeEnabled);",
          "336:   };",
          "338:   const assertEditorDisabled = assertEditorState(false);",
          "339:   const assertEditorEnabled = assertEditorState(true);",
          "341:   context('Switching editor mode', () => {",
          "342:     const hook = TinyHooks.bddSetup<Editor>({ ...settings, disabled: true }, []);",
          "344:     afterEach(() => hook.editor().options.set('disabled', true));",
          "347:     it('TINY-11488: Should be able to switch from disabled mode to enabled mode', () => {",
          "348:       const editor = hook.editor();",
          "349:       assertEditorDisabled(editor);",
          "350:       editor.options.set('disabled', false);",
          "351:       assertEditorEnabled(editor);",
          "352:     });",
          "354:     it('TINY-11488: Should not allow switching modes when the editor is disabled', () => {",
          "355:       const editor = hook.editor();",
          "356:       assertEditorDisabled(editor);",
          "357:       editor.mode.set('readonly');",
          "358:       assertEditorDisabled(editor);",
          "359:       editor.options.set('disabled', false);",
          "360:       assertEditorEnabled(editor);",
          "361:       editor.mode.set('readonly');",
          "362:       assertEditorEnabled(editor);",
          "363:       editor.mode.set('design');",
          "364:     });",
          "366:     it('TINY-11488: UIs should still be disabled when switching to disable false in readonly mode', () => {",
          "367:       const editor = hook.editor();",
          "368:       editor.options.set('disabled', false);",
          "369:       editor.mode.set('readonly');",
          "370:       assertEditorEnabled(editor);",
          "371:       editor.options.set('disabled', true);",
          "372:       assertEditorDisabled(editor);",
          "373:       editor.options.set('disabled', false);",
          "374:       assertEditorEnabled(editor);",
          "375:     });",
          "376:   });",
          "378:   context('Default disabled: false', () => {",
          "379:     const hook = TinyHooks.bddSetup<Editor>({ ...settings, disabled: false }, []);",
          "381:     afterEach(() => hook.editor().options.set('disabled', true));",
          "384:     it('TINY-11488: Should be able to switch from disabled mode to enabled mode', () => {",
          "385:       const editor = hook.editor();",
          "386:       assertEditorEnabled(editor);",
          "387:       editor.options.set('disabled', true);",
          "388:       assertEditorDisabled(editor);",
          "389:       editor.options.set('disabled', false);",
          "390:       assertEditorEnabled(editor);",
          "391:     });",
          "392:   });",
          "394:   context('DisabledStateChange Event', () => {",
          "395:     const store = TestStore<boolean>();",
          "396:     const hook = TinyHooks.bddSetup<Editor>({",
          "397:       ...settings,",
          "398:       disabled: true,",
          "399:       setup: (ed: Editor) => {",
          "400:         ed.on('DisabledStateChange', (e) => store.add(e.state));",
          "401:       }",
          "402:     }, []);",
          "404:     afterEach(() => {",
          "405:       hook.editor().options.set('disabled', true);",
          "406:       store.clear();",
          "407:     });",
          "409:     it('TINY-11488: DisabledStateChange event should be dispatched when state changes', () => {",
          "410:       const editor = hook.editor();",
          "411:       store.assertEq('InitialState', [ ]);",
          "412:       editor.options.set('disabled', false);",
          "413:       store.assertEq('Disable state change event setting to false', [ false ]);",
          "415:       editor.options.set('disabled', false);",
          "416:       store.assertEq('Setting the same value should not dispatch DisabledStateChange', [ false ]);",
          "418:       editor.options.set('disabled', true);",
          "419:       store.assertEq('Disable state change event setting to true', [ false, true ]);",
          "420:     });",
          "421:   });",
          "423:   context('Toolbar button state with disable state and readonly mode/non editable root', () => {",
          "424:     const assertButtonState = (button: TestButtonDisabledState, shouldBeDisabled: boolean) => {",
          "425:       const { name, disabledAttribute } = button;",
          "426:       const attributeValue = disabledAttribute === 'disabled' ? 'disabled' : 'true';",
          "427:       const selector = `[data-mce-name=\"${name}\"][${disabledAttribute}=\"${attributeValue}\"]`;",
          "429:       if (shouldBeDisabled) {",
          "430:         UiFinder.exists(SugarBody.body(), selector);",
          "431:       } else {",
          "432:         UiFinder.notExists(SugarBody.body(), selector);",
          "433:       }",
          "434:     };",
          "436:     const assertButtonsStateDisabled = (buttons: TestButtonDisabledState[]) => {",
          "437:       Arr.each(buttons, (button) => assertButtonState(button, true));",
          "438:     };",
          "440:     const assertButtonsStateEnabled = (buttons: TestButtonDisabledState[]) => {",
          "441:       Arr.each(buttons, (button) => assertButtonState(button, false));",
          "442:     };",
          "444:     const toolbarButtons: TestButtonDisabledState[] = [",
          "445:       { name: 'bold', disabledAttribute: 'aria-disabled' },",
          "446:       { name: 'print', disabledAttribute: 'aria-disabled' },",
          "447:       { name: 'forecolor', disabledAttribute: 'aria-disabled' },",
          "448:       { name: 'searchreplace', disabledAttribute: 'aria-disabled' },",
          "449:     ];",
          "451:     const nativeDisabledToolbarButtons: TestButtonDisabledState[] = [",
          "452:       { name: 'lineheight', disabledAttribute: 'disabled' },",
          "453:       { name: 'fontfamily', disabledAttribute: 'disabled' },",
          "454:       { name: 'fontsize', disabledAttribute: 'disabled' },",
          "455:       { name: 'blocks', disabledAttribute: 'disabled' },",
          "456:       { name: 'styles', disabledAttribute: 'disabled' },",
          "457:     ];",
          "459:     const allButtons = [ ...toolbarButtons, ...nativeDisabledToolbarButtons ];",
          "461:     const excludeReadOnlyEnabledButton = Arr.filter(toolbarButtons, (btn) => btn.name !== 'print');",
          "462:     const excludeNonEditableRootButton = Arr.filter(toolbarButtons, (btn) => btn.name !== 'print' && btn.name !== 'searchreplace');",
          "464:     const hook = TinyHooks.bddSetup<Editor>({",
          "465:       base_url: '/project/tinymce/js/tinymce',",
          "466:       disabled: true,",
          "467:       plugins: 'searchreplace',",
          "468:       toolbar: Arr.map(allButtons, (button) => button.name).join(' '),",
          "469:     }, []);",
          "471:     afterEach(() => hook.editor().options.set('disabled', true));",
          "473:     it('TINY-11488: Toolbar buttons should reflect the editor disabled state in readonly', () => {",
          "474:       const editor = hook.editor();",
          "475:       assertButtonsStateDisabled(allButtons);",
          "477:       editor.options.set('disabled', false);",
          "478:       assertButtonsStateEnabled(allButtons);",
          "481:       editor.mode.set('readonly');",
          "482:       assertButtonsStateDisabled([ ...excludeReadOnlyEnabledButton, ...nativeDisabledToolbarButtons ]);",
          "483:       assertButtonState({ name: 'print', disabledAttribute: 'aria-disabled' }, false);",
          "486:       editor.options.set('disabled', true);",
          "487:       assertButtonsStateDisabled(allButtons);",
          "490:       editor.options.set('disabled', false);",
          "491:       assertButtonsStateDisabled([ ...excludeReadOnlyEnabledButton, ...nativeDisabledToolbarButtons ]);",
          "492:       assertButtonState({ name: 'print', disabledAttribute: 'aria-disabled' }, false);",
          "495:       editor.mode.set('design');",
          "496:       assertButtonsStateEnabled(allButtons);",
          "497:     });",
          "499:     it('TINY-11488: Toolbar buttons should reflect the editor disabled state in noneditable root', () => {",
          "500:       const editor = hook.editor();",
          "501:       assertButtonsStateDisabled(allButtons);",
          "503:       editor.options.set('disabled', false);",
          "504:       assertButtonsStateEnabled(allButtons);",
          "507:       editor.setEditableRoot(false);",
          "508:       assertButtonsStateDisabled([ ...excludeNonEditableRootButton, ...nativeDisabledToolbarButtons ]);",
          "509:       assertButtonsStateEnabled([{ name: 'print', disabledAttribute: 'aria-disabled' }, { name: 'searchreplace', disabledAttribute: 'aria-disabled' }]);",
          "512:       editor.options.set('disabled', true);",
          "513:       assertButtonsStateDisabled(allButtons);",
          "515:       editor.options.set('disabled', false);",
          "516:       assertButtonsStateDisabled([ ...excludeNonEditableRootButton, ...nativeDisabledToolbarButtons ]);",
          "517:       assertButtonsStateEnabled([{ name: 'print', disabledAttribute: 'aria-disabled' }, { name: 'searchreplace', disabledAttribute: 'aria-disabled' }]);",
          "519:       editor.setEditableRoot(true);",
          "520:       assertButtonsStateEnabled(allButtons);",
          "521:     });",
          "522:   });",
          "523: });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/EditableRootTest.ts||modules/tinymce/src/core/test/ts/browser/EditableRootTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/EditableRootTest.ts -> modules/tinymce/src/core/test/ts/browser/EditableRootTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "5: import Editor from 'tinymce/core/api/Editor';",
          "7: describe('browser.tinymce.core.EditableRootTest', () => {",
          "10:   };",
          "12:   const assertRootEditableState = (editor: Editor, expectedState: boolean) => {",
          "",
          "[Removed Lines]",
          "8:   const assertContentEditableState = (editor: Editor, expectedState: boolean) => {",
          "9:     assert.equal(editor.getBody().isContentEditable, expectedState);",
          "",
          "[Added Lines]",
          "8:   const assertContentEditableState = (editor: Editor, expectedState: boolean, message?: string) => {",
          "9:     assert.equal(editor.getBody().isContentEditable, expectedState, message);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "92:       assert.isTrue(editor.hasEditableRoot());",
          "93:       assertContentEditableState(editor, true);",
          "94:     });",
          "95:   });",
          "96: });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "96:     it('TINY-11488: Editor editable state should not be impacted by disabled mode toggling', () => {",
          "97:       const editor = hook.editor();",
          "99:       editor.options.set('disabled', true);",
          "100:       assert.isTrue(editor.hasEditableRoot(), 'Editable root should be present when disabled');",
          "101:       assertContentEditableState(editor, false, 'Content should not be editable when disabled');",
          "103:       editor.options.set('disabled', false);",
          "104:       assert.isTrue(editor.hasEditableRoot(), 'Editable root should remain when re-enabled');",
          "105:       assertContentEditableState(editor, true, 'Content should be editable when re-enabled');",
          "107:       editor.setEditableRoot(false);",
          "109:       editor.options.set('disabled', true);",
          "110:       assert.isFalse(editor.hasEditableRoot(), 'Editable root should not be present after disabling');",
          "111:       assertContentEditableState(editor, false, 'Content should not be editable when disabled with no editable root');",
          "113:       editor.options.set('disabled', false);",
          "114:       assert.isFalse(editor.hasEditableRoot(), 'Editable root should remain absent when re-enabled');",
          "115:       assertContentEditableState(editor, false, 'Content should not be editable when re-enabled with no editable root');",
          "117:       editor.options.set('disabled', true);",
          "118:       editor.setEditableRoot(true);",
          "120:       assert.isTrue(editor.hasEditableRoot(), 'Editable root should be restored');",
          "121:       assertContentEditableState(editor, false, 'Content should remain non-editable when disabled with editable root');",
          "122:     });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/EditorTest.ts||modules/tinymce/src/core/test/ts/browser/EditorTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/EditorTest.ts -> modules/tinymce/src/core/test/ts/browser/EditorTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "442:     assert.equal(clickCount, 3, 'setMode');",
          "443:   });",
          "445:   it('TBA: translate', () => {",
          "446:     const editor = hook.editor();",
          "447:     EditorManager.addI18n('en', {",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "445:   it('TINY-11488: Verifies click event behavior in disabled and enabled editor states', () => {",
          "446:     const editor = hook.editor();",
          "447:     let clickCount = 0;",
          "449:     const isDisabled = (selector: string) => {",
          "450:       const elm = UiFinder.findIn(SugarBody.body(), selector);",
          "451:       return elm.forall((elm) => Attribute.has(elm, 'disabled') || Class.has(elm, 'tox-tbtn--disabled'));",
          "452:     };",
          "454:     editor.on('click', () => {",
          "455:       clickCount++;",
          "456:     });",
          "458:     editor.dom.dispatch(editor.getBody(), 'click');",
          "459:     assert.equal(clickCount, 1, 'Click should be counted in enabled state');",
          "461:     editor.options.set('disabled', true);",
          "462:     assert.isTrue(isDisabled('.tox-editor-container button:last-of-type'), 'Button should be disabled in disabled mode');",
          "463:     editor.dom.dispatch(editor.getBody(), 'click');",
          "464:     assert.equal(clickCount, 1, 'Click should not be counted in disabled state');",
          "466:     editor.options.set('disabled', false);",
          "467:     editor.dom.dispatch(editor.getBody(), 'click');",
          "468:     assert.isFalse(isDisabled('.tox-editor-container button:last-of-type'), 'Button should remain enabled in enabled state');",
          "469:     assert.equal(clickCount, 2, 'Click should be counted in re-enabled state');",
          "470:   });",
          "",
          "---------------"
        ],
        "modules/tinymce/src/core/test/ts/browser/ReadOnlyModeTest.ts||modules/tinymce/src/core/test/ts/browser/ReadOnlyModeTest.ts": [
          "File: modules/tinymce/src/core/test/ts/browser/ReadOnlyModeTest.ts -> modules/tinymce/src/core/test/ts/browser/ReadOnlyModeTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "1: import { ApproxStructure, Mouse, UiFinder, Clipboard } from '@ephox/agar';",
          "4: import { PlatformDetection } from '@ephox/sand';",
          "6: import { TinyAssertions, TinyDom, TinyHooks, TinySelections } from '@ephox/wrap-mcagar';",
          "7: import { assert } from 'chai';",
          "9: import Editor from 'tinymce/core/api/Editor';",
          "11: import AnchorPlugin from 'tinymce/plugins/anchor/Plugin';",
          "12: import LinkPlugin from 'tinymce/plugins/link/Plugin';",
          "13: import TablePlugin from 'tinymce/plugins/table/Plugin';",
          "17: describe('browser.tinymce.core.ReadOnlyModeTest', () => {",
          "18:   const hook = TinyHooks.bddSetup<Editor>({",
          "19:     base_url: '/project/tinymce/js/tinymce',",
          "",
          "[Removed Lines]",
          "2: import { Assert, describe, it } from '@ephox/bedrock-client';",
          "3: import { Optional, OptionalInstances } from '@ephox/katamari';",
          "5: import { Attribute, Class, Css, Scroll, SelectorFind, SugarBody, SugarElement, Traverse } from '@ephox/sugar';",
          "10: import * as Readonly from 'tinymce/core/mode/Readonly';",
          "15: const tOptional = OptionalInstances.tOptional;",
          "",
          "[Added Lines]",
          "2: import { describe, it } from '@ephox/bedrock-client';",
          "4: import { Attribute, Class, Css, Scroll, SelectorFind, SugarBody, Traverse } from '@ephox/sugar';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "89:     assert.equal(Attribute.get(elm, 'aria-disabled'), expectedState.toString(), 'Toolbar should have expected disabled state');",
          "90:   };",
          "98:   it('TBA: Switching to readonly mode while having cef selection should remove fake selection', () => {",
          "99:     const editor = hook.editor();",
          "100:     setMode(editor, 'design');",
          "",
          "[Removed Lines]",
          "92:   const assertHrefOpt = (editor: Editor, selector: string, expectedHref: Optional<string>) => {",
          "93:     const elm = SugarElement.fromDom(editor.dom.select(selector)[0]);",
          "94:     const hrefOpt = Readonly.getAnchorHrefOpt(editor, elm);",
          "95:     Assert.eq('href options match', expectedHref, hrefOpt, tOptional());",
          "96:   };",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "251:     UiFinder.sNotExists(SugarBody.body(), '.tox-menu');",
          "252:   });",
          "264:   const metaKey = PlatformDetection.detect().os.isMacOS() ? { metaKey: true } : { ctrlKey: true };",
          "266:   it('TINY-6248: processReadonlyEvents should scroll to bookmark with id', () => {",
          "",
          "[Removed Lines]",
          "254:   it('TINY-6248: getAnchorHrefOpt should return an Optional of the href of the closest anchor tag', () => {",
          "255:     const editor = hook.editor();",
          "256:     editor.setContent('<p><a href=\"https://tiny.cloud\">external link</a></p>');",
          "257:     assertHrefOpt(editor, 'a', Optional.some('https://tiny.cloud'));",
          "258:     editor.setContent('<p><a>external link with no href</a></p>');",
          "259:     assertHrefOpt(editor, 'a', Optional.none());",
          "260:     editor.setContent('<p><a href=\"https://tiny.cloud\"><img src=\"\">nested image </img>inside anchor</a></p>');",
          "261:     assertHrefOpt(editor, 'img', Optional.some('https://tiny.cloud'));",
          "262:   });",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ],
        "modules/tinymce/src/models/dom/main/ts/table/api/TableResizeHandler.ts||modules/tinymce/src/models/dom/main/ts/table/api/TableResizeHandler.ts": [
          "File: modules/tinymce/src/models/dom/main/ts/table/api/TableResizeHandler.ts -> modules/tinymce/src/models/dom/main/ts/table/api/TableResizeHandler.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "209:     }",
          "210:   });",
          "213:     tableResize.on((resize) => {",
          "221:     });",
          "225:     tableResize.on((resize) => {",
          "233:     });",
          "234:   });",
          "236:   editor.on('remove', () => {",
          "",
          "[Removed Lines]",
          "212:   editor.on('SwitchMode', () => {",
          "214:       if (editor.mode.isReadOnly()) {",
          "215:         resize.off();",
          "216:         resize.hideBars();",
          "217:       } else {",
          "218:         resize.on();",
          "219:         resize.showBars();",
          "220:       }",
          "222:   });",
          "224:   editor.on('dragstart dragend', (e) => {",
          "226:       if (e.type === 'dragstart') {",
          "227:         resize.hideBars();",
          "228:         resize.off();",
          "229:       } else {",
          "230:         resize.on();",
          "231:         resize.showBars();",
          "232:       }",
          "",
          "[Added Lines]",
          "212:   const showResizeBars = () => {",
          "214:       resize.on();",
          "215:       resize.showBars();",
          "217:   };",
          "219:   const hideResizeBars = () => {",
          "221:       resize.off();",
          "222:       resize.hideBars();",
          "224:   };",
          "226:   editor.on('DisabledStateChange', (e) => {",
          "227:     e.state ? hideResizeBars() : showResizeBars();",
          "228:   });",
          "230:   editor.on('SwitchMode', () => {",
          "231:     editor.mode.isReadOnly() ? hideResizeBars() : showResizeBars();",
          "232:   });",
          "234:   editor.on('dragstart dragend', (e) => {",
          "235:     e.type === 'dragstart' ? hideResizeBars() : showResizeBars();",
          "",
          "---------------"
        ],
        "modules/tinymce/src/themes/silver/main/ts/UiState.ts||modules/tinymce/src/themes/silver/main/ts/UiState.ts": [
          "File: modules/tinymce/src/themes/silver/main/ts/UiState.ts -> modules/tinymce/src/themes/silver/main/ts/UiState.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "2: import { Arr } from '@ephox/katamari';",
          "4: import Editor from 'tinymce/core/api/Editor';",
          "6: import { EditorEvent } from 'tinymce/core/api/util/EventDispatcher';",
          "8: import * as Options from './api/Options';",
          "",
          "[Removed Lines]",
          "5: import { NodeChangeEvent, SwitchModeEvent } from 'tinymce/core/api/EventTypes';",
          "",
          "[Added Lines]",
          "5: import { DisabledStateChangeEvent, NodeChangeEvent, SwitchModeEvent } from 'tinymce/core/api/EventTypes';",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "11: export const UiStateChannel = 'silver.uistate';",
          "14:   const outerContainer = uiRefs.mainUi.outerContainer;",
          "16:   const motherships = [ uiRefs.mainUi.mothership, ...uiRefs.uiMotherships ];",
          "19:     Arr.each(motherships, (m) => {",
          "21:     });",
          "22:   }",
          "24:   Arr.each(motherships, (m) => {",
          "26:   });",
          "27: };",
          "29: const setupEventsForUi = (editor: Editor, uiRefs: ReadyUiReferences): void => {",
          "32:   });",
          "39:     }",
          "40:   });",
          "42:   if (Options.isReadOnly(editor)) {",
          "43:     editor.mode.set('readonly');",
          "44:   }",
          "",
          "[Removed Lines]",
          "13: const broadcastEvents = (uiRefs: ReadyUiReferences, data: string): void => {",
          "15:   const target = outerContainer.element;",
          "18:   if (data === 'setDisabled') {",
          "20:       m.broadcastOn([ Channels.dismissPopups() ], { target });",
          "25:     m.broadcastOn([ UiStateChannel ], data);",
          "30:   editor.on('init SwitchMode', (e: EditorEvent<{} | SwitchModeEvent>) => {",
          "31:     broadcastEvents(uiRefs, e.type);",
          "34:   editor.on('NodeChange', (e: EditorEvent<NodeChangeEvent>) => {",
          "35:     if (!editor.ui.isEnabled()) {",
          "36:       broadcastEvents(uiRefs, 'setDisabled');",
          "37:     } else {",
          "38:       broadcastEvents(uiRefs, e.type);",
          "",
          "[Added Lines]",
          "13: const messageSetDisabled = 'setDisabled';",
          "14: const messageSetEnabled = 'setEnabled';",
          "15: const messageInit = 'init';",
          "16: const messageSwitchMode = 'switchmode';",
          "17: const modeContextMessages = [ messageSwitchMode, messageInit ];",
          "19: const broadcastEvents = (uiRefs: ReadyUiReferences, messageType: string): void => {",
          "23:   if (messageType === messageSetDisabled) {",
          "25:       m.broadcastOn([ Channels.dismissPopups() ], { target: outerContainer.element });",
          "30:     m.broadcastOn([ UiStateChannel ], messageType);",
          "35:   editor.on('init SwitchMode', (event: EditorEvent<{} | SwitchModeEvent>) => {",
          "36:     broadcastEvents(uiRefs, event.type);",
          "39:   editor.on('DisabledStateChange', (event: EditorEvent<DisabledStateChangeEvent>) => {",
          "40:     if (!event.isDefaultPrevented()) {",
          "44:       const messageType = event.state ? messageSetDisabled : messageInit;",
          "45:       broadcastEvents(uiRefs, messageType);",
          "48:       if (!event.state) {",
          "49:         editor.nodeChanged();",
          "50:       }",
          "54:   editor.on('NodeChange', (e: EditorEvent<NodeChangeEvent>) => {",
          "55:     const messageType = editor.ui.isEnabled() ? e.type : messageSetDisabled;",
          "56:     broadcastEvents(uiRefs, messageType);",
          "57:   });",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "47: const toggleOnReceive = (getContext: () => { contextType: string; shouldDisable: boolean }): Behaviour.NamedConfiguredBehaviour<any, any> => Receiving.config({",
          "48:   channels: {",
          "49:     [UiStateChannel]: {",
          "53:           return;",
          "54:         }",
          "58:           return;",
          "59:         }",
          "62:       }",
          "63:     }",
          "64:   }",
          "",
          "[Removed Lines]",
          "50:       onReceive: (comp, buttonStateData: string) => {",
          "51:         if (buttonStateData === 'setDisabled' || buttonStateData === 'setEnabled') {",
          "52:           Disabling.set(comp, buttonStateData === 'setDisabled');",
          "56:         const { contextType, shouldDisable: contextShouldDisable } = getContext();",
          "57:         if (contextType === 'mode' && !Arr.contains([ 'switchmode', 'init' ], buttonStateData)) {",
          "61:         Disabling.set(comp, contextShouldDisable);",
          "",
          "[Added Lines]",
          "67:       onReceive: (comp, messageType: string) => {",
          "68:         if (messageType === messageSetDisabled || messageType === messageSetEnabled) {",
          "69:           Disabling.set(comp, messageType === messageSetDisabled);",
          "73:         const { contextType, shouldDisable } = getContext();",
          "74:         if (contextType === 'mode' && !Arr.contains(modeContextMessages, messageType)) {",
          "78:         Disabling.set(comp, shouldDisable);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/themes/silver/main/ts/api/Options.ts||modules/tinymce/src/themes/silver/main/ts/api/Options.ts": [
          "File: modules/tinymce/src/themes/silver/main/ts/api/Options.ts -> modules/tinymce/src/themes/silver/main/ts/api/Options.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "295: };",
          "297: const isReadOnly = option('readonly');",
          "298: const getHeightOption = option('height');",
          "299: const getWidthOption = option('width');",
          "300: const getMinWidthOption = wrapOptional(option('min_width'));",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "298: const isDisabled = option('disabled');",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "439:   getSkinUrl,",
          "440:   getSkinUrlOption,",
          "441:   isReadOnly,",
          "442:   isSkinDisabled,",
          "443:   getHeightOption,",
          "444:   getWidthOption,",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "443:   isDisabled,",
          "",
          "---------------"
        ],
        "modules/tinymce/src/themes/silver/main/ts/backstage/Backstage.ts||modules/tinymce/src/themes/silver/main/ts/backstage/Backstage.ts": [
          "File: modules/tinymce/src/themes/silver/main/ts/backstage/Backstage.ts -> modules/tinymce/src/themes/silver/main/ts/backstage/Backstage.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "61:     getOption: editor.options.get,",
          "62:     tooltips: TooltipsBackstage(lazySinks.dialog),",
          "63:     checkUiComponentContext: (specContext: string) => {",
          "64:       const [ key, value = '' ] = specContext.split(':');",
          "65:       const contexts = editor.ui.registry.getAll().contexts;",
          "66:       const enabledInContext = Obj.get(contexts, key)",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "64:       if (editor.disabled) {",
          "65:         return {",
          "66:           contextType: 'disabled',",
          "67:           shouldDisable: true",
          "68:         };",
          "69:       }",
          "",
          "---------------"
        ],
        "modules/tinymce/src/themes/silver/main/ts/ui/context/ContextToolbar.ts||modules/tinymce/src/themes/silver/main/ts/ui/context/ContextToolbar.ts": [
          "File: modules/tinymce/src/themes/silver/main/ts/ui/context/ContextToolbar.ts -> modules/tinymce/src/themes/silver/main/ts/ui/context/ContextToolbar.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "274:       }, 0);",
          "275:     });",
          "279:         close();",
          "280:       }",
          "281:     });",
          "",
          "[Removed Lines]",
          "277:     editor.on('SwitchMode', () => {",
          "278:       if (editor.mode.isReadOnly()) {",
          "",
          "[Added Lines]",
          "277:     editor.on('SwitchMode DisabledStateChange', () => {",
          "278:       if (editor.mode.isReadOnly() || editor.disabled) {",
          "",
          "---------------"
        ],
        "modules/tinymce/src/themes/silver/main/ts/ui/core/complex/BespokeNumberInput.ts||modules/tinymce/src/themes/silver/main/ts/ui/core/complex/BespokeNumberInput.ts": [
          "File: modules/tinymce/src/themes/silver/main/ts/ui/core/complex/BespokeNumberInput.ts -> modules/tinymce/src/themes/silver/main/ts/ui/core/complex/BespokeNumberInput.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "22:   const getValueFromCurrentComp = (comp: Optional<AlloyComponent>): string =>",
          "23:     comp.map((alloyComp) => Representing.getValue(alloyComp)).getOr('');",
          "26:     const comp = api.getComponent();",
          "27:     currentComp = Optional.some(comp);",
          "28:     spec.updateInputValue(comp);",
          "30:   });",
          "32:   const getApi = (comp: AlloyComponent): BespokeSelectApi => ({ getComponent: Fun.constant(comp) });",
          "",
          "[Removed Lines]",
          "25:   const onSetup = onSetupEvent(editor, 'NodeChange SwitchMode', (api: BespokeSelectApi) => {",
          "29:     Disabling.set(comp, !editor.selection.isEditable());",
          "",
          "[Added Lines]",
          "25:   const onSetup = onSetupEvent(editor, 'NodeChange SwitchMode DisabledStateChange', (api: BespokeSelectApi) => {",
          "29:     Disabling.set(comp, !editor.selection.isEditable() || editor.disabled);",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "75:     const editorOffCellStepButton = Cell(Fun.noop);",
          "76:     const translatedTooltip = backstage.shared.providers.translate(tooltip);",
          "77:     const altExecuting = Id.generate('altExecuting');",
          "80:     });",
          "82:     const onClick = (comp: AlloyComponent) => {",
          "",
          "[Removed Lines]",
          "78:     const onSetup = onSetupEvent(editor, 'NodeChange SwitchMode', (api: BespokeSelectApi) => {",
          "79:       Disabling.set(api.getComponent(), !editor.selection.isEditable());",
          "",
          "[Added Lines]",
          "78:     const onSetup = onSetupEvent(editor, 'NodeChange SwitchMode DisabledStateChange', (api: BespokeSelectApi) => {",
          "79:       Disabling.set(api.getComponent(), !editor.selection.isEditable() || editor.disabled);",
          "",
          "---------------"
        ],
        "modules/tinymce/src/themes/silver/test/ts/browser/editor/DisableTest.ts||modules/tinymce/src/themes/silver/test/ts/browser/editor/DisableTest.ts": [
          "File: modules/tinymce/src/themes/silver/test/ts/browser/editor/DisableTest.ts -> modules/tinymce/src/themes/silver/test/ts/browser/editor/DisableTest.ts",
          "--- Hunk 1 ---",
          "[Context before]",
          "8: import Editor from 'tinymce/core/api/Editor';",
          "10: describe('browser.tinymce.themes.silver.editor.DisableTest', () => {",
          "23:   const pAssertUiDisabled = async (editor: Editor, disabled: boolean) => {",
          "24:     const overlord = UiFinder.findIn(SugarBody.body(), '.tox-toolbar-overlord').getOrDie();",
          "25:     await Waiter.pTryUntil(",
          "",
          "[Removed Lines]",
          "11:   const hook = TinyHooks.bddSetup<Editor>({",
          "12:     base_url: '/project/tinymce/js/tinymce',",
          "13:     toolbar: 't1',",
          "14:     setup: (ed: Editor) => {",
          "15:       ed.ui.registry.addButton('t1', {",
          "16:         onAction: Fun.noop,",
          "17:         text: 'Test1',",
          "18:         context: 'any'",
          "19:       });",
          "20:     }",
          "21:   }, []);",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "49:   const assertButtonDisabled = (selector: string) => UiFinder.exists(SugarBody.body(), `[data-mce-name=\"${selector}\"][aria-disabled=\"true\"]`);",
          "58:     });",
          "61:       const editor = hook.editor();",
          "62:       editor.ui.setEnabled(false);",
          "63:       await pAssertUiDisabled(editor, true);",
          "66:       editor.ui.setEnabled(true);",
          "67:       await pAssertUiDisabled(editor, false);",
          "73:       editor.ui.setEnabled(false);",
          "79:     });",
          "80:   });",
          "81: });",
          "",
          "[Removed Lines]",
          "51:   context('Test disable/enable APIs', () => {",
          "52:     it('TINY-6397: Should be able to enable and disable the UI', async () => {",
          "53:       const editor = hook.editor();",
          "54:       editor.ui.setEnabled(false);",
          "55:       await pAssertUiDisabled(editor, true);",
          "56:       editor.ui.setEnabled(true);",
          "57:       await pAssertUiDisabled(editor, false);",
          "60:     it('TINY-6397: Should still able to toggle ui state in readonly mode', async () => {",
          "64:       editor.mode.set('readonly');",
          "65:       await pAssertUiDisabled(editor, false);",
          "68:       editor.mode.set('design');",
          "69:     });",
          "71:     it('TINY-11211: Should not enable button on NodeChange with context: any when ui is disabled', async () => {",
          "72:       const editor = hook.editor();",
          "74:       assertButtonDisabled('t1');",
          "75:       editor.nodeChanged();",
          "76:       assertButtonDisabled('t1');",
          "77:       editor.ui.setEnabled(true);",
          "78:       assertButtonEnabled('t1');",
          "",
          "[Added Lines]",
          "39:   context('Without disabled option', () => {",
          "40:     const hook = TinyHooks.bddSetup<Editor>({",
          "41:       base_url: '/project/tinymce/js/tinymce',",
          "42:       toolbar: 't1',",
          "43:       setup: (ed: Editor) => {",
          "44:         ed.ui.registry.addButton('t1', {",
          "45:           onAction: Fun.noop,",
          "46:           text: 'Test1',",
          "47:           context: 'any'",
          "48:         });",
          "49:       }",
          "50:     }, []);",
          "52:     context('Test disable/enable APIs', () => {",
          "53:       it('TINY-6397: Should be able to enable and disable the UI', async () => {",
          "54:         const editor = hook.editor();",
          "55:         editor.ui.setEnabled(false);",
          "56:         await pAssertUiDisabled(editor, true);",
          "57:         editor.ui.setEnabled(true);",
          "58:         await pAssertUiDisabled(editor, false);",
          "59:       });",
          "61:       it('TINY-6397: Should still able to toggle ui state in readonly mode', async () => {",
          "62:         const editor = hook.editor();",
          "63:         editor.ui.setEnabled(false);",
          "64:         await pAssertUiDisabled(editor, true);",
          "65:         editor.mode.set('readonly');",
          "66:         await pAssertUiDisabled(editor, false);",
          "67:         editor.ui.setEnabled(true);",
          "68:         await pAssertUiDisabled(editor, false);",
          "69:         editor.mode.set('design');",
          "70:       });",
          "72:       it('TINY-11211: Should not enable button on NodeChange with context: any when ui is disabled', async () => {",
          "73:         const editor = hook.editor();",
          "74:         editor.ui.setEnabled(false);",
          "75:         assertButtonDisabled('t1');",
          "76:         editor.nodeChanged();",
          "77:         assertButtonDisabled('t1');",
          "78:         editor.ui.setEnabled(true);",
          "79:         assertButtonEnabled('t1');",
          "80:       });",
          "82:   });",
          "84:   context('With disabled option', () => {",
          "85:     const hook = TinyHooks.bddSetup<Editor>({",
          "86:       base_url: '/project/tinymce/js/tinymce',",
          "87:       toolbar: 't1',",
          "88:       disabled: true,",
          "89:       setup: (ed: Editor) => {",
          "90:         ed.ui.registry.addButton('t1', {",
          "91:           onAction: Fun.noop,",
          "92:           text: 'Test1',",
          "93:           context: 'any'",
          "94:         });",
          "95:       }",
          "96:     }, []);",
          "98:     it('TINY-11488: Should not be able to enable the UI when in disabled mode', async () => {",
          "100:       await pAssertUiDisabled(editor, true);",
          "101:       editor.ui.setEnabled(true);",
          "102:       await pAssertUiDisabled(editor, true);",
          "106:       editor.options.set('disabled', false);",
          "110:       await pAssertUiDisabled(editor, true);",
          "",
          "---------------"
        ]
      }
    }
  ]
}