{
  "cve_id": "CVE-2024-52296",
  "cve_desc": "libosdp is an implementation of IEC 60839-11-5 OSDP (Open Supervised Device Protocol) and provides a C library with support for C++, Rust and Python3. At ospd_common.c, on the osdp_reply_name function, any reply id between REPLY_ACK and REPLY_XRD is valid, but names array do not declare all of the range. On a case of an undefined reply id within the range, name will be null (name = names[reply_id - REPLY_ACK];). Null name will casue a crash on next line: if (name[0] == '\\0') as null[0] is invalid. As this logic is not limited to a secure connection, attacker may trigger this vulnerability without any prior knowledge. This issue is fixed in 2.4.0.",
  "repo": "goToMain/libosdp",
  "patch_hash": "24409e98a260176765956ec766a04cb35984fab1",
  "patch_info": {
    "commit_hash": "24409e98a260176765956ec766a04cb35984fab1",
    "repo": "goToMain/libosdp",
    "commit_url": "https://github.com/goToMain/libosdp/commit/24409e98a260176765956ec766a04cb35984fab1",
    "files": [
      "src/osdp_common.c"
    ],
    "message": "Fix null pointer deref issue osdp_reply_name\n\nSigned-off-by: Siddharth Chandrasekaran <sidcha.dev@gmail.com>",
    "before_after_code_files": [
      "src/osdp_common.c||src/osdp_common.c"
    ]
  },
  "patch_diff": {
    "src/osdp_common.c||src/osdp_common.c": [
      "File: src/osdp_common.c -> src/osdp_common.c",
      "--- Hunk 1 ---",
      "[Context before]",
      "120:   return \"INVALID\";",
      "121:  }",
      "122:  name = names[reply_id - REPLY_ACK];",
      "124:   return \"UNKNOWN\";",
      "125:  }",
      "126:  return name;",
      "",
      "[Removed Lines]",
      "123:  if (name[0] == '\\0') {",
      "",
      "[Added Lines]",
      "123:  if (!name) {",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "0f456670ac3b17bc46bc125f05da407f45a743c9",
      "candidate_info": {
        "commit_hash": "0f456670ac3b17bc46bc125f05da407f45a743c9",
        "repo": "goToMain/libosdp",
        "commit_url": "https://github.com/goToMain/libosdp/commit/0f456670ac3b17bc46bc125f05da407f45a743c9",
        "files": [
          "doc/protocol/commands-and-replies.rst",
          "src/osdp_common.c",
          "src/osdp_common.h",
          "src/osdp_cp.c"
        ],
        "message": "libosdp: Fix CMD_ABORT's assigned command code\n\nOSDP assigned command code for CMD_ABORT was incorrectly set to 0x7A in\nthe library (reported in #93). This commit corrects this issue. While at\nit, also add new commands introduced in v2.2 of the specification and\nremove some old ones that are no longer supported.\n\nFixes: #93\nSigned-off-by: Siddharth Chandrasekaran <sidcha.dev@gmail.com>",
        "before_after_code_files": [
          "src/osdp_common.c||src/osdp_common.c",
          "src/osdp_common.h||src/osdp_common.h",
          "src/osdp_cp.c||src/osdp_cp.c"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "src/osdp_common.c||src/osdp_common.c"
          ],
          "candidate": [
            "src/osdp_common.c||src/osdp_common.c"
          ]
        }
      },
      "candidate_diff": {
        "src/osdp_common.c||src/osdp_common.c": [
          "File: src/osdp_common.c -> src/osdp_common.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "51: const char *osdp_cmd_name(int cmd_id)",
          "52: {",
          "53:  static const char * const names[] = {",
          "54:   [CMD_POLL         - CMD_POLL] = \"POLL\",",
          "55:   [CMD_ID           - CMD_POLL] = \"ID\",",
          "56:   [CMD_CAP          - CMD_POLL] = \"CAP\",",
          "58:   [CMD_LSTAT        - CMD_POLL] = \"LSTAT\",",
          "59:   [CMD_ISTAT        - CMD_POLL] = \"ISTAT\",",
          "60:   [CMD_OSTAT        - CMD_POLL] = \"OSTAT\",",
          "",
          "[Removed Lines]",
          "57:   [CMD_DIAG         - CMD_POLL] = \"DIAG\",",
          "",
          "[Added Lines]",
          "53:  const char *name;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "66:   [CMD_RMODE        - CMD_POLL] = \"RMODE\",",
          "67:   [CMD_TDSET        - CMD_POLL] = \"TDSET\",",
          "68:   [CMD_COMSET       - CMD_POLL] = \"COMSET\",",
          "73:   [CMD_BIOREAD      - CMD_POLL] = \"BIOREAD\",",
          "74:   [CMD_BIOMATCH     - CMD_POLL] = \"BIOMATCH\",",
          "75:   [CMD_KEYSET       - CMD_POLL] = \"KEYSET\",",
          "76:   [CMD_CHLNG        - CMD_POLL] = \"CHLNG\",",
          "77:   [CMD_SCRYPT       - CMD_POLL] = \"SCRYPT\",",
          "81:   [CMD_ACURXSIZE    - CMD_POLL] = \"ACURXSIZE\",",
          "82:   [CMD_MFG          - CMD_POLL] = \"MFG\",",
          "84:   [CMD_XWR          - CMD_POLL] = \"XWR\",",
          "85:   [CMD_KEEPACTIVE   - CMD_POLL] = \"KEEPACTIVE\",",
          "86:  };",
          "88:  if (cmd_id < CMD_POLL || cmd_id > CMD_KEEPACTIVE) {",
          "90:  }",
          "92: }",
          "94: const char *osdp_reply_name(int reply_id)",
          "95: {",
          "96:  static const char * const names[] = {",
          "97:   [REPLY_ACK       - REPLY_ACK] = \"ACK\",",
          "98:   [REPLY_NAK       - REPLY_ACK] = \"NAK\",",
          "",
          "[Removed Lines]",
          "69:   [CMD_DATA         - CMD_POLL] = \"DATA\",",
          "70:   [CMD_XMIT         - CMD_POLL] = \"XMIT\",",
          "71:   [CMD_PROMPT       - CMD_POLL] = \"PROMPT\",",
          "72:   [CMD_SPE          - CMD_POLL] = \"SPE\",",
          "78:   [CMD_CONT         - CMD_POLL] = \"CONT\",",
          "79:   [CMD_ABORT        - CMD_POLL] = \"ABORT\",",
          "80:   [CMD_FILETRANSFER - CMD_POLL] = \"FILETRANSFER\",",
          "83:   [CMD_SCDONE       - CMD_POLL] = \"SCDONE\",",
          "89:   return NULL;",
          "91:  return names[cmd_id - CMD_POLL];",
          "",
          "[Added Lines]",
          "75:   [CMD_FILETRANSFER - CMD_POLL] = \"FILETRANSFER\",",
          "78:   [CMD_ABORT        - CMD_POLL] = \"ABORT\",",
          "79:   [CMD_PIVDATA      - CMD_POLL] = \"PIVDATA\",",
          "80:   [CMD_CRAUTH       - CMD_POLL] = \"CRAUTH\",",
          "81:   [CMD_GENAUTH      - CMD_POLL] = \"GENAUTH\",",
          "86:   return \"INVALID\";",
          "88:  name = names[cmd_id - CMD_POLL];",
          "89:  if (name[0] == '\\0') {",
          "90:   return \"UNKNOWN\";",
          "91:  }",
          "92:  return name;",
          "97:  const char *name;",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "104:   [REPLY_RSTATR    - REPLY_ACK] = \"RSTATR\",",
          "105:   [REPLY_RAW       - REPLY_ACK] = \"RAW\",",
          "106:   [REPLY_FMT       - REPLY_ACK] = \"FMT\",",
          "108:   [REPLY_KEYPPAD   - REPLY_ACK] = \"KEYPPAD\",",
          "109:   [REPLY_COM       - REPLY_ACK] = \"COM\",",
          "112:   [REPLY_BIOREADR  - REPLY_ACK] = \"BIOREADR\",",
          "113:   [REPLY_BIOMATCHR - REPLY_ACK] = \"BIOMATCHR\",",
          "114:   [REPLY_CCRYPT    - REPLY_ACK] = \"CCRYPT\",",
          "",
          "[Removed Lines]",
          "107:   [REPLY_PRES      - REPLY_ACK] = \"PRES\",",
          "110:   [REPLY_SCREP     - REPLY_ACK] = \"SCREP\",",
          "111:   [REPLY_SPER      - REPLY_ACK] = \"SPER\",",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 4 ---",
          "[Context before]",
          "116:   [REPLY_FTSTAT    - REPLY_ACK] = \"FTSTAT\",",
          "117:   [REPLY_MFGREP    - REPLY_ACK] = \"MFGREP\",",
          "118:   [REPLY_BUSY      - REPLY_ACK] = \"BUSY\",",
          "119:   [REPLY_XRD       - REPLY_ACK] = \"XRD\",",
          "120:  };",
          "122:  if (reply_id < REPLY_ACK || reply_id > REPLY_XRD) {",
          "123:   return \"UNKNOWN\";",
          "124:  }",
          "126: }",
          "128: void osdp_keyset_complete(struct osdp_pd *pd)",
          "",
          "[Removed Lines]",
          "125:  return names[reply_id - REPLY_ACK];",
          "",
          "[Added Lines]",
          "118:   [REPLY_PIVDATAR  - REPLY_ACK] = \"PIVDATA\",",
          "119:   [REPLY_CRAUTHR   - REPLY_ACK] = \"CRAUTH\",",
          "120:   [REPLY_MFGSTATR  - REPLY_ACK] = \"MFGSTATR\",",
          "121:   [REPLY_MFGERRR   - REPLY_ACK] = \"MFGERR\",",
          "126:   return \"INVALID\";",
          "127:  }",
          "128:  name = names[reply_id - REPLY_ACK];",
          "129:  if (name[0] == '\\0') {",
          "132:  return name;",
          "",
          "---------------"
        ],
        "src/osdp_common.h||src/osdp_common.h": [
          "File: src/osdp_common.h -> src/osdp_common.h",
          "--- Hunk 1 ---",
          "[Context before]",
          "102: #define CMD_POLL  0x60",
          "103: #define CMD_ID   0x61",
          "104: #define CMD_CAP   0x62",
          "106: #define CMD_LSTAT  0x64",
          "107: #define CMD_ISTAT  0x65",
          "108: #define CMD_OSTAT  0x66",
          "",
          "[Removed Lines]",
          "105: #define CMD_DIAG  0x63",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "114: #define CMD_RMODE  0x6C",
          "115: #define CMD_TDSET  0x6D",
          "116: #define CMD_COMSET  0x6E",
          "121: #define CMD_BIOREAD  0x73",
          "122: #define CMD_BIOMATCH  0x74",
          "123: #define CMD_KEYSET  0x75",
          "124: #define CMD_CHLNG  0x76",
          "125: #define CMD_SCRYPT  0x77",
          "129: #define CMD_ACURXSIZE  0x7B",
          "130: #define CMD_MFG   0x80",
          "132: #define CMD_XWR   0xA1",
          "133: #define CMD_KEEPACTIVE  0xA7",
          "",
          "[Removed Lines]",
          "117: #define CMD_DATA  0x6F",
          "118: #define CMD_XMIT  0x70",
          "119: #define CMD_PROMPT  0x71",
          "120: #define CMD_SPE   0x72",
          "126: #define CMD_CONT  0x79",
          "127: #define CMD_ABORT  0x7A",
          "128: #define CMD_FILETRANSFER 0x7C",
          "131: #define CMD_SCDONE  0xA0",
          "",
          "[Added Lines]",
          "122: #define CMD_FILETRANSFER 0x7C",
          "125: #define CMD_ABORT  0xA2",
          "126: #define CMD_PIVDATA  0xA3",
          "127: #define CMD_GENAUTH  0xA4",
          "128: #define CMD_CRAUTH  0xA5",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "145: #define REPLY_RSTATR 0x4B",
          "146: #define REPLY_RAW 0x50",
          "147: #define REPLY_FMT 0x51",
          "149: #define REPLY_KEYPPAD 0x53",
          "150: #define REPLY_COM 0x54",
          "153: #define REPLY_BIOREADR 0x57",
          "154: #define REPLY_BIOMATCHR 0x58",
          "155: #define REPLY_CCRYPT 0x76",
          "156: #define REPLY_RMAC_I 0x78",
          "157: #define REPLY_FTSTAT 0x7A",
          "158: #define REPLY_MFGREP 0x90",
          "160: #define REPLY_XRD 0xB1",
          "",
          "[Removed Lines]",
          "148: #define REPLY_PRES 0x52",
          "151: #define REPLY_SCREP 0x55",
          "152: #define REPLY_SPER 0x56",
          "159: #define REPLY_BUSY 0x79",
          "",
          "[Added Lines]",
          "149: #define REPLY_BUSY 0x79",
          "152: #define REPLY_PIVDATAR 0x80",
          "153: #define REPLY_GENAUTHR 0x81",
          "154: #define REPLY_CRAUTHR 0x82",
          "155: #define REPLY_MFGSTATR 0x83",
          "156: #define REPLY_MFGERRR 0x84",
          "",
          "---------------"
        ],
        "src/osdp_cp.c||src/osdp_cp.c": [
          "File: src/osdp_cp.c -> src/osdp_cp.c",
          "--- Hunk 1 ---",
          "[Context before]",
          "223:   buf[len++] = pd->cmd_id;",
          "224:   buf[len++] = 0x00;",
          "225:   break;",
          "231:  case CMD_OUT:",
          "232:   assert_len(CMD_OUT_LEN, max_len);",
          "233:   cmd = (struct osdp_cmd *)pd->ephemeral_data;",
          "",
          "[Removed Lines]",
          "226:  case CMD_DIAG:",
          "227:   assert_len(CMD_DIAG_LEN, max_len);",
          "228:   buf[len++] = pd->cmd_id;",
          "229:   buf[len++] = 0x00;",
          "230:   break;",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------"
        ]
      }
    }
  ]
}