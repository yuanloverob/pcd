{
  "cve_id": "CVE-2024-28108",
  "cve_desc": "phpMyFAQ is an open source FAQ web application for PHP 8.1+ and MySQL, PostgreSQL and other databases. Due to insufficient validation on the `contentLink` parameter, it is possible for unauthenticated users to inject HTML code to the page which might affect other users. _Also, requires that adding new FAQs is allowed for guests and that the admin doesn't check the content of a newly added FAQ._ This vulnerability is fixed in 3.2.6.",
  "repo": "thorsten/phpMyFAQ",
  "patch_hash": "4fed1d9602f0635260f789fe85995789d94d6634",
  "patch_info": {
    "commit_hash": "4fed1d9602f0635260f789fe85995789d94d6634",
    "repo": "thorsten/phpMyFAQ",
    "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/4fed1d9602f0635260f789fe85995789d94d6634",
    "files": [
      "phpmyfaq/api.service.php"
    ],
    "message": "fix: added missing conversion to HTML entities",
    "before_after_code_files": [
      "phpmyfaq/api.service.php||phpmyfaq/api.service.php"
    ]
  },
  "patch_diff": {
    "phpmyfaq/api.service.php||phpmyfaq/api.service.php": [
      "File: phpmyfaq/api.service.php -> phpmyfaq/api.service.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "412:                     $answer,",
      "413:                     Translation::get('msgInfo'),",
      "414:                     Strings::substr($contentLink, 7),",
      "416:                 );",
      "417:             }",
      "",
      "[Removed Lines]",
      "415:                     $contentLink",
      "",
      "[Added Lines]",
      "415:                     Strings::htmlentities($contentLink)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "baa93e0a7b7f00fb99b378cbeccfac79b02aa890",
      "candidate_info": {
        "commit_hash": "baa93e0a7b7f00fb99b378cbeccfac79b02aa890",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/baa93e0a7b7f00fb99b378cbeccfac79b02aa890",
        "files": [
          "phpmyfaq/show.php",
          "phpmyfaq/src/phpMyFAQ/Faq.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/show.php||phpmyfaq/show.php",
          "phpmyfaq/src/phpMyFAQ/Faq.php||phpmyfaq/src/phpMyFAQ/Faq.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/show.php||phpmyfaq/show.php": [
          "File: phpmyfaq/show.php -> phpmyfaq/show.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "99:     $template->parse(",
          "100:         'mainPageContent',",
          "101:         [",
          "103:             'categoryDescription' => Strings::htmlentities($categoryData->getDescription()),",
          "104:             'categoryFaqsHeader' => $PMF_LANG['msgEntries'],",
          "105:             'categoryContent' => $records,",
          "",
          "[Removed Lines]",
          "102:             'categoryHeader' => $PMF_LANG['msgEntriesIn'] . $categoryData->getName(),",
          "",
          "[Added Lines]",
          "102:             'categoryHeader' => $PMF_LANG['msgEntriesIn'] . Strings::htmlentities($categoryData->getName()),",
          "",
          "---------------"
        ],
        "phpmyfaq/src/phpMyFAQ/Faq.php||phpmyfaq/src/phpMyFAQ/Faq.php": [
          "File: phpmyfaq/src/phpMyFAQ/Faq.php -> phpmyfaq/src/phpMyFAQ/Faq.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "2621:         if (count($result) > 0) {",
          "2622:             foreach ($result as $row) {",
          "2623:                 $output['title'][] = Utils::makeShorterText(Strings::htmlentities($row['question']), 8);",
          "2625:                 $output['url'][] = Strings::htmlentities($row['url']);",
          "2626:             }",
          "2627:         } else {",
          "",
          "[Removed Lines]",
          "2624:                 $output['preview'][] = Strings::htmlentities($row['question']);",
          "",
          "[Added Lines]",
          "2624:                 $output['preview'][] = Strings::htmlentities(Strings::htmlentities($row['question']));",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "5310cb8c37dc3a5c5aead0898690b14705c433d3",
      "candidate_info": {
        "commit_hash": "5310cb8c37dc3a5c5aead0898690b14705c433d3",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/5310cb8c37dc3a5c5aead0898690b14705c433d3",
        "files": [
          "phpmyfaq/admin/record.edit.php",
          "phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/admin/record.edit.php||phpmyfaq/admin/record.edit.php",
          "phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php||phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/admin/record.edit.php||phpmyfaq/admin/record.edit.php": [
          "File: phpmyfaq/admin/record.edit.php -> phpmyfaq/admin/record.edit.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "484:                                                     printf(",
          "485:                                                         '<li><a href=\"../%s\">%s</a> ',",
          "486:                                                         $att->buildUrl(),",
          "488:                                                     );",
          "489:                                                     if ($user->perm->hasPermission($currentUserId, 'delattachment')) {",
          "490:                                                         printf(",
          "",
          "[Removed Lines]",
          "487:                                                         $att->getFilename()",
          "",
          "[Added Lines]",
          "487:                                                         Strings::htmlentities($att->getFilename())",
          "",
          "---------------"
        ],
        "phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php||phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php": [
          "File: phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php -> phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: namespace phpMyFAQ\\Helper;",
          "20: use phpMyFAQ\\Attachment\\AttachmentAbstract;",
          "21: use phpMyFAQ\\Translation;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21: use phpMyFAQ\\Strings;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45:                 '<li><i class=\"fa fa-%s\" aria-hidden=\"true\"></i> <a href=\"%s\">%s</a></li>',",
          "46:                 $this->mapMimeTypeToIcon($attachment->getMimeType()),",
          "47:                 $attachment->buildUrl(),",
          "49:             );",
          "50:         }",
          "",
          "[Removed Lines]",
          "48:                 $attachment->getFilename()",
          "",
          "[Added Lines]",
          "49:                 Strings::htmlentities($attachment->getFilename())",
          "",
          "---------------"
        ]
      }
    }
  ]
}