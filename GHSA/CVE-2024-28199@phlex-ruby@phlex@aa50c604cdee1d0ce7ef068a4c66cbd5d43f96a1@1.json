{
  "cve_id": "CVE-2024-28199",
  "cve_desc": "phlex is an open source framework for building object-oriented views in Ruby. There is a potential cross-site scripting (XSS) vulnerability that can be exploited via maliciously crafted user data. This was due to improper case-sensitivity in the code that was meant to prevent these attacks. If you render an `<a>` tag with an `href` attribute set to a user-provided link, that link could potentially execute JavaScript when clicked by another user. If you splat user-provided attributes when rendering any HTML tag, malicious event attributes could be included in the output, executing JavaScript when the events are triggered by another user. Patches are available on RubyGems for all 1.x minor versions. Users are advised to upgrade. Users unable to upgrade should consider configuring a content security policy that does not allow `unsafe-inline`.",
  "repo": "phlex-ruby/phlex",
  "patch_hash": "aa50c604cdee1d0ce7ef068a4c66cbd5d43f96a1",
  "patch_info": {
    "commit_hash": "aa50c604cdee1d0ce7ef068a4c66cbd5d43f96a1",
    "repo": "phlex-ruby/phlex",
    "commit_url": "https://github.com/phlex-ruby/phlex/commit/aa50c604cdee1d0ce7ef068a4c66cbd5d43f96a1",
    "files": [
      "lib/phlex/sgml.rb",
      "test/phlex/view/naughty_business.rb"
    ],
    "message": "Fix improper case-sensitivity\n\nSee https://github.com/phlex-ruby/phlex/security/advisories/GHSA-242p-4v39-2v8g",
    "before_after_code_files": [
      "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
      "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb"
    ]
  },
  "patch_diff": {
    "lib/phlex/sgml.rb||lib/phlex/sgml.rb": [
      "File: lib/phlex/sgml.rb -> lib/phlex/sgml.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "393:     attributes = process_attributes(**attributes)",
      "394:    end",
      "404:    buffer = +\"\"",
      "405:    __build_attributes__(attributes, buffer: buffer)",
      "",
      "[Removed Lines]",
      "396:    if attributes[:href]&.start_with?(/\\s*javascript:/)",
      "397:     attributes.delete(:href)",
      "398:    end",
      "400:    if attributes[\"href\"]&.start_with?(/\\s*javascript:/)",
      "401:     attributes.delete(\"href\")",
      "402:    end",
      "",
      "[Added Lines]",
      "[None]",
      "",
      "---------------",
      "--- Hunk 2 ---",
      "[Context before]",
      "418:      else raise ArgumentError, \"Attribute keys should be Strings or Symbols.\"",
      "419:     end",
      "421:     # Detect unsafe attribute names. Attribute names are considered unsafe if they match an event attribute or include unsafe characters.",
      "423:      raise ArgumentError, \"Unsafe attribute name detected: #{k}.\"",
      "424:     end",
      "",
      "[Removed Lines]",
      "422:     if HTML::EVENT_ATTRIBUTES[name] || name.match?(/[<>&\"']/)",
      "",
      "[Added Lines]",
      "413:     lower_name = name.downcase",
      "414:     next if lower_name == \"href\" && v.start_with?(/\\s*javascript:/i)",
      "417:     if HTML::EVENT_ATTRIBUTES[lower_name] || name.match?(/[<>&\"']/)",
      "",
      "---------------"
    ],
    "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb": [
      "File: test/phlex/view/naughty_business.rb -> test/phlex/view/naughty_business.rb",
      "--- Hunk 1 ---",
      "[Context before]",
      "3: describe Phlex::HTML do",
      "4:  extend ViewHelper",
      "6:  with \"naughty text\" do",
      "7:   view do",
      "8:    def view_template",
      "",
      "[Removed Lines]",
      "[None]",
      "",
      "[Added Lines]",
      "6:  with \"naughty javascript links\" do",
      "7:   view do",
      "8:    def template",
      "9:     a(href: \"javascript:alert(1)\") { \"a\" }",
      "10:     a(href: \"JAVASCRIPT:alert(1)\") { \"b\" }",
      "11:     a(href: :\"JAVASCRIPT:alert(1)\") { \"c\" }",
      "12:     a(HREF: \"javascript:alert(1)\") { \"d\" }",
      "13:    end",
      "14:   end",
      "16:   it \"removes the href attributes\" do",
      "17:    expect(output).to be == \"<a>a</a><a>b</a><a>c</a><a>d</a>\"",
      "18:   end",
      "19:  end",
      "21:  with \"naughty uppercase event tag\" do",
      "22:   view do",
      "23:    def template",
      "24:     button ONCLICK: \"ALERT(1)\" do",
      "25:      \"naughty button\"",
      "26:     end",
      "27:    end",
      "28:   end",
      "30:   it \"raises\" do",
      "31:    expect { output }.to raise_exception ArgumentError,",
      "32:     message: be == \"Unsafe attribute name detected: ONCLICK.\"",
      "33:   end",
      "34:  end",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "9e3f5b980655817993682e409cbda72956d865cb",
      "candidate_info": {
        "commit_hash": "9e3f5b980655817993682e409cbda72956d865cb",
        "repo": "phlex-ruby/phlex",
        "commit_url": "https://github.com/phlex-ruby/phlex/commit/9e3f5b980655817993682e409cbda72956d865cb",
        "files": [
          "lib/phlex/sgml.rb",
          "test/phlex/view/naughty_business.rb"
        ],
        "message": "Fix XSS",
        "before_after_code_files": [
          "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
          "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
            "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb"
          ],
          "candidate": [
            "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
            "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/phlex/sgml.rb||lib/phlex/sgml.rb": [
          "File: lib/phlex/sgml.rb -> lib/phlex/sgml.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "382:     end",
          "384:     lower_name = name.downcase",
          "387:     # Detect unsafe attribute names. Attribute names are considered unsafe if they match an event attribute or include unsafe characters.",
          "388:     if HTML::EVENT_ATTRIBUTES.include?(lower_name) || name.match?(/[<>&\"']/)",
          "",
          "[Removed Lines]",
          "385:     next if lower_name == \"href\" && v.start_with?(/\\s*javascript:/i)",
          "",
          "[Added Lines]",
          "385:     next if lower_name == \"href\" && v.to_s.downcase.tr(\"\\t \\n\", \"\").start_with?(\"javascript:\")",
          "",
          "---------------"
        ],
        "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb": [
          "File: test/phlex/view/naughty_business.rb -> test/phlex/view/naughty_business.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "85:   end",
          "86:  end",
          "88:  Phlex::HTML::EVENT_ATTRIBUTES.each do |event_attribute|",
          "89:   with \"with naughty #{event_attribute} attribute\" do",
          "90:    naughty_attributes = { event_attribute => \"alert(1);\" }",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "88:  with \"naughty javascript link protocol with a hidden tab character\" do",
          "89:   view do",
          "90:    def view_template",
          "91:     a(href: \"\\tjavascript:alert(1)\") { \"XSS\" }",
          "92:     a(href: \"j\\tavascript:alert(1)\") { \"XSS\" }",
          "93:     a(href: \"ja\\tvascript:alert(1)\") { \"XSS\" }",
          "94:     a(href: \"jav\\tascript:alert(1)\") { \"XSS\" }",
          "95:     a(href: \"java\\tscript:alert(1)\") { \"XSS\" }",
          "96:     a(href: \"javas\\tcript:alert(1)\") { \"XSS\" }",
          "97:     a(href: \"javasc\\tript:alert(1)\") { \"XSS\" }",
          "98:     a(href: \"javascr\\tipt:alert(1)\") { \"XSS\" }",
          "99:     a(href: \"javascri\\tpt:alert(1)\") { \"XSS\" }",
          "100:     a(href: \"javascrip\\tt:alert(1)\") { \"XSS\" }",
          "101:     a(href: \"javascript\\t:alert(1)\") { \"XSS\" }",
          "102:     a(href: \"javascript:\\talert(1)\") { \"XSS\" }",
          "103:    end",
          "104:   end",
          "106:   it \"strips the javascript protocol\" do",
          "107:    expect(output.scan(\"<a>\").size).to be == 12",
          "108:    expect(output.scan(\"href\").size).to be == 0",
          "109:   end",
          "110:  end",
          "112:  with \"naughty javascript link protocol with a hidden newline character\" do",
          "113:   view do",
          "114:    def view_template",
          "115:     a(href: \"\\njavascript:alert(1)\") { \"XSS\" }",
          "116:     a(href: \"j\\navascript:alert(1)\") { \"XSS\" }",
          "117:     a(href: \"ja\\nvascript:alert(1)\") { \"XSS\" }",
          "118:     a(href: \"jav\\nascript:alert(1)\") { \"XSS\" }",
          "119:     a(href: \"java\\nscript:alert(1)\") { \"XSS\" }",
          "120:     a(href: \"javas\\ncript:alert(1)\") { \"XSS\" }",
          "121:     a(href: \"javasc\\nript:alert(1)\") { \"XSS\" }",
          "122:     a(href: \"javascr\\nipt:alert(1)\") { \"XSS\" }",
          "123:     a(href: \"javascri\\npt:alert(1)\") { \"XSS\" }",
          "124:     a(href: \"javascrip\\nt:alert(1)\") { \"XSS\" }",
          "125:     a(href: \"javascript\\n:alert(1)\") { \"XSS\" }",
          "126:     a(href: \"javascript:\\nalert(1)\") { \"XSS\" }",
          "127:    end",
          "128:   end",
          "130:   it \"strips the javascript protocol\" do",
          "131:    expect(output.scan(\"<a>\").size).to be == 12",
          "132:    expect(output.scan(\"href\").size).to be == 0",
          "133:   end",
          "134:  end",
          "136:  with \"naughty javascript link protocol with a hidden whitespace character\" do",
          "137:   view do",
          "138:    def view_template",
          "139:     a(href: \" javascript:alert(1)\") { \"XSS\" }",
          "140:     a(href: \"j avascript:alert(1)\") { \"XSS\" }",
          "141:     a(href: \"ja vascript:alert(1)\") { \"XSS\" }",
          "142:     a(href: \"jav ascript:alert(1)\") { \"XSS\" }",
          "143:     a(href: \"java script:alert(1)\") { \"XSS\" }",
          "144:     a(href: \"javas cript:alert(1)\") { \"XSS\" }",
          "145:     a(href: \"javasc ript:alert(1)\") { \"XSS\" }",
          "146:     a(href: \"javascr ipt:alert(1)\") { \"XSS\" }",
          "147:     a(href: \"javascri pt:alert(1)\") { \"XSS\" }",
          "148:     a(href: \"javascrip t:alert(1)\") { \"XSS\" }",
          "149:     a(href: \"javascript :alert(1)\") { \"XSS\" }",
          "150:     a(href: \"javascript: alert(1)\") { \"XSS\" }",
          "151:    end",
          "152:   end",
          "154:   it \"strips the javascript protocol\" do",
          "155:    expect(output.scan(\"<a>\").size).to be == 12",
          "156:    expect(output.scan(\"href\").size).to be == 0",
          "157:   end",
          "158:  end",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "dc6f375037a37f397688a90cdda2b8b2b4520e57",
      "candidate_info": {
        "commit_hash": "dc6f375037a37f397688a90cdda2b8b2b4520e57",
        "repo": "phlex-ruby/phlex",
        "commit_url": "https://github.com/phlex-ruby/phlex/commit/dc6f375037a37f397688a90cdda2b8b2b4520e57",
        "files": [
          "lib/phlex/csv.rb",
          "lib/phlex/html.rb",
          "lib/phlex/sgml.rb",
          "test/phlex/view/naughty_business.rb"
        ],
        "message": "Use Sets",
        "before_after_code_files": [
          "lib/phlex/csv.rb||lib/phlex/csv.rb",
          "lib/phlex/html.rb||lib/phlex/html.rb",
          "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
          "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
            "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb"
          ],
          "candidate": [
            "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
            "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/phlex/csv.rb||lib/phlex/csv.rb": [
          "File: lib/phlex/csv.rb -> lib/phlex/csv.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "3: class Phlex::CSV",
          "4:  include Phlex::Callable",
          "9:  def initialize(collection)",
          "10:   @collection = collection",
          "",
          "[Removed Lines]",
          "6:  FORMULA_PREFIXES = [\"=\", \"+\", \"-\", \"@\", \"\\t\", \"\\r\"].to_h { |prefix| [prefix, true] }.freeze",
          "7:  SPACE_CHARACTERS = [\" \", \"\\t\", \"\\r\"].to_h { |char| [char, true] }.freeze",
          "",
          "[Added Lines]",
          "6:  FORMULA_PREFIXES = Set[\"=\", \"+\", \"-\", \"@\", \"\\t\", \"\\r\"].freeze",
          "7:  SPACE_CHARACTERS = Set[\" \", \"\\t\", \"\\r\"].freeze",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "116:   first_char = value[0]",
          "117:   last_char = value[-1]",
          "120:    # Prefix a single quote to prevent Excel, Google Docs, etc. from interpreting the value as a formula.",
          "121:    # See https://owasp.org/www-community/attacks/CSV_Injection",
          "122:    %(\"'#{value.gsub('\"', '\"\"')}\")",
          "124:    %(\"#{value.gsub('\"', '\"\"')}\")",
          "125:   else",
          "126:    value",
          "",
          "[Removed Lines]",
          "119:   if escape_csv_injection? && FORMULA_PREFIXES[first_char]",
          "123:   elsif (!trim_whitespace? && (SPACE_CHARACTERS[first_char] || SPACE_CHARACTERS[last_char])) || value.include?('\"') || value.include?(\",\") || value.include?(\"\\n\")",
          "",
          "[Added Lines]",
          "119:   if escape_csv_injection? && FORMULA_PREFIXES.include?(first_char)",
          "123:   elsif (!trim_whitespace? && (SPACE_CHARACTERS.include?(first_char) || SPACE_CHARACTERS.include?(last_char))) || value.include?('\"') || value.include?(\",\") || value.include?(\"\\n\")",
          "",
          "---------------"
        ],
        "lib/phlex/html.rb||lib/phlex/html.rb": [
          "File: lib/phlex/html.rb -> lib/phlex/html.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "7:   autoload :VoidElements, \"phlex/html/void_elements\"",
          "9:   # A list of HTML attributes that have the potential to execute unsafe JavaScript.",
          "12:   UNBUFFERED_MUTEX = Mutex.new",
          "",
          "[Removed Lines]",
          "10:   EVENT_ATTRIBUTES = %w[onabort onafterprint onbeforeprint onbeforeunload onblur oncanplay oncanplaythrough onchange onclick oncontextmenu oncopy oncuechange oncut ondblclick ondrag ondragend ondragenter ondragleave ondragover ondragstart ondrop ondurationchange onemptied onended onerror onfocus onhashchange oninput oninvalid onkeydown onkeypress onkeyup onload onloadeddata onloadedmetadata onloadstart onmessage onmousedown onmousemove onmouseout onmouseover onmouseup onmousewheel onoffline ononline onpagehide onpageshow onpaste onpause onplay onplaying onpopstate onprogress onratechange onreset onresize onscroll onsearch onseeked onseeking onselect onstalled onstorage onsubmit onsuspend ontimeupdate ontoggle onunload onvolumechange onwaiting onwheel].to_h { [_1, true] }.freeze",
          "",
          "[Added Lines]",
          "10:   EVENT_ATTRIBUTES = Set.new(%w[onabort onafterprint onbeforeprint onbeforeunload onblur oncanplay oncanplaythrough onchange onclick oncontextmenu oncopy oncuechange oncut ondblclick ondrag ondragend ondragenter ondragleave ondragover ondragstart ondrop ondurationchange onemptied onended onerror onfocus onhashchange oninput oninvalid onkeydown onkeypress onkeyup onload onloadeddata onloadedmetadata onloadstart onmessage onmousedown onmousemove onmouseout onmouseover onmouseup onmousewheel onoffline ononline onpagehide onpageshow onpaste onpause onplay onplaying onpopstate onprogress onratechange onreset onresize onscroll onsearch onseeked onseeking onselect onstalled onstorage onsubmit onsuspend ontimeupdate ontoggle onunload onvolumechange onwaiting onwheel]).freeze",
          "",
          "---------------"
        ],
        "lib/phlex/sgml.rb||lib/phlex/sgml.rb": [
          "File: lib/phlex/sgml.rb -> lib/phlex/sgml.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "16:    def new(*args, **kwargs, &block)",
          "17:     if block",
          "18:      object = super(*args, **kwargs, &nil)",
          "20:      object",
          "21:     else",
          "22:      super",
          "",
          "[Removed Lines]",
          "19:      object.instance_variable_set(:@_content_block, block)",
          "",
          "[Added Lines]",
          "19:      object.instance_exec { @_content_block = block }",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "417:     next if lower_name == \"href\" && v.start_with?(/\\s*javascript:/i)",
          "419:     # Detect unsafe attribute names. Attribute names are considered unsafe if they match an event attribute or include unsafe characters.",
          "421:      raise ArgumentError, \"Unsafe attribute name detected: #{k}.\"",
          "422:     end",
          "",
          "[Removed Lines]",
          "420:     if HTML::EVENT_ATTRIBUTES[lower_name] || name.match?(/[<>&\"']/)",
          "",
          "[Added Lines]",
          "420:     if HTML::EVENT_ATTRIBUTES.include?(lower_name) || name.match?(/[<>&\"']/)",
          "",
          "---------------"
        ],
        "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb": [
          "File: test/phlex/view/naughty_business.rb -> test/phlex/view/naughty_business.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "85:   end",
          "86:  end",
          "89:   with \"with naughty #{event_attribute} attribute\" do",
          "90:    naughty_attributes = { event_attribute => \"alert(1);\" }",
          "",
          "[Removed Lines]",
          "88:  Phlex::HTML::EVENT_ATTRIBUTES.each_key do |event_attribute|",
          "",
          "[Added Lines]",
          "88:  Phlex::HTML::EVENT_ATTRIBUTES.each do |event_attribute|",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b0694c7d64cefb6071690778a1f6910ad8c4e623",
      "candidate_info": {
        "commit_hash": "b0694c7d64cefb6071690778a1f6910ad8c4e623",
        "repo": "phlex-ruby/phlex",
        "commit_url": "https://github.com/phlex-ruby/phlex/commit/b0694c7d64cefb6071690778a1f6910ad8c4e623",
        "files": [
          "lib/phlex/html.rb",
          "lib/phlex/sgml.rb",
          "test/phlex/view/capture.rb",
          "test/phlex/view/naughty_business.rb"
        ],
        "message": "`srcdoc` should be considered unsafe in version of Phlex that don\u2019t escape attribute values (#777)\n\nSince we replaced the HTML escape with a `\"` gsub, we should consider\n`srcdoc` unsafe.",
        "before_after_code_files": [
          "lib/phlex/html.rb||lib/phlex/html.rb",
          "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
          "test/phlex/view/capture.rb||test/phlex/view/capture.rb",
          "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
            "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb"
          ],
          "candidate": [
            "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
            "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/phlex/html.rb||lib/phlex/html.rb": [
          "File: lib/phlex/html.rb -> lib/phlex/html.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "5:  autoload :VoidElements, \"phlex/html/void_elements\"",
          "7:  # A list of HTML attributes that have the potential to execute unsafe JavaScript.",
          "10:  extend Phlex::Elements",
          "11:  include VoidElements, StandardElements",
          "",
          "[Removed Lines]",
          "8:  EVENT_ATTRIBUTES = Set.new(%w[onabort onafterprint onbeforeprint onbeforeunload onblur oncanplay oncanplaythrough onchange onclick oncontextmenu oncopy oncuechange oncut ondblclick ondrag ondragend ondragenter ondragleave ondragover ondragstart ondrop ondurationchange onemptied onended onerror onfocus onhashchange oninput oninvalid onkeydown onkeypress onkeyup onload onloadeddata onloadedmetadata onloadstart onmessage onmousedown onmousemove onmouseout onmouseover onmouseup onmousewheel onoffline ononline onpagehide onpageshow onpaste onpause onplay onplaying onpopstate onprogress onratechange onreset onresize onscroll onsearch onseeked onseeking onselect onstalled onstorage onsubmit onsuspend ontimeupdate ontoggle onunload onvolumechange onwaiting onwheel]).freeze",
          "",
          "[Added Lines]",
          "8:  UNSAFE_ATTRIBUTES = Set.new(%w[onabort onafterprint onbeforeprint onbeforeunload onblur oncanplay oncanplaythrough onchange onclick oncontextmenu oncopy oncuechange oncut ondblclick ondrag ondragend ondragenter ondragleave ondragover ondragstart ondrop ondurationchange onemptied onended onerror onfocus onhashchange oninput oninvalid onkeydown onkeypress onkeyup onload onloadeddata onloadedmetadata onloadstart onmessage onmousedown onmousemove onmouseout onmouseover onmouseup onmousewheel onoffline ononline onpagehide onpageshow onpaste onpause onplay onplaying onpopstate onprogress onratechange onreset onresize onscroll onsearch onseeked onseeking onselect onstalled onstorage onsubmit onsuspend ontimeupdate ontoggle onunload onvolumechange onwaiting onwheel srcdoc]).freeze",
          "",
          "---------------"
        ],
        "lib/phlex/sgml.rb||lib/phlex/sgml.rb": [
          "File: lib/phlex/sgml.rb -> lib/phlex/sgml.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "421:     end",
          "423:     # Detect unsafe attribute names. Attribute names are considered unsafe if they match an event attribute or include unsafe characters.",
          "425:      raise Phlex::ArgumentError.new(\"Unsafe attribute name detected: #{k}.\")",
          "426:     end",
          "427:    end",
          "",
          "[Removed Lines]",
          "424:     if Phlex::HTML::EVENT_ATTRIBUTES.include?(lower_name.delete(\"^a-z-\"))",
          "",
          "[Added Lines]",
          "424:     if Phlex::HTML::UNSAFE_ATTRIBUTES.include?(lower_name.delete(\"^a-z-\"))",
          "",
          "---------------"
        ],
        "test/phlex/view/capture.rb||test/phlex/view/capture.rb": [
          "File: test/phlex/view/capture.rb -> test/phlex/view/capture.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "76:     def view_template",
          "77:      srcdoc = capture { yield } if block_given?",
          "80:     end",
          "81:    end",
          "82:   end",
          "",
          "[Removed Lines]",
          "79:      iframe srcdoc:",
          "",
          "[Added Lines]",
          "79:      iframe srcdoc: safe(srcdoc)",
          "",
          "---------------"
        ],
        "test/phlex/view/naughty_business.rb||test/phlex/view/naughty_business.rb": [
          "File: test/phlex/view/naughty_business.rb -> test/phlex/view/naughty_business.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "157:   end",
          "158:  end",
          "161:   with \"with naughty #{event_attribute} attribute\" do",
          "162:    naughty_attributes = { event_attribute => \"alert(1);\" }",
          "",
          "[Removed Lines]",
          "160:  Phlex::HTML::EVENT_ATTRIBUTES.each do |event_attribute|",
          "",
          "[Added Lines]",
          "160:  Phlex::HTML::UNSAFE_ATTRIBUTES.each do |event_attribute|",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "92d246fd330507ec2b17e1fe69ff9f71fcd80575",
      "candidate_info": {
        "commit_hash": "92d246fd330507ec2b17e1fe69ff9f71fcd80575",
        "repo": "phlex-ruby/phlex",
        "commit_url": "https://github.com/phlex-ruby/phlex/commit/92d246fd330507ec2b17e1fe69ff9f71fcd80575",
        "files": [
          "lib/phlex/sgml.rb",
          "test/phlex/view/lowercase_symbolic_id_guard.test.rb"
        ],
        "message": "raise on non-symbolic and non-lowercase :id",
        "before_after_code_files": [
          "lib/phlex/sgml.rb||lib/phlex/sgml.rb",
          "test/phlex/view/lowercase_symbolic_id_guard.test.rb||test/phlex/view/lowercase_symbolic_id_guard.test.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/phlex/sgml.rb||lib/phlex/sgml.rb"
          ],
          "candidate": [
            "lib/phlex/sgml.rb||lib/phlex/sgml.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/phlex/sgml.rb||lib/phlex/sgml.rb": [
          "File: lib/phlex/sgml.rb -> lib/phlex/sgml.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "396:      raise ArgumentError.new(\"Unsafe attribute name detected: #{k}.\")",
          "397:     end",
          "399:     case v",
          "400:     when true",
          "401:      buffer << \" \" << name",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "399:     if lower_name.to_sym == :id && k != :id",
          "400:      raise ArgumentError.new(\":id attribute should only be passed as a lowercase symbol.\")",
          "401:     end",
          "",
          "---------------"
        ],
        "test/phlex/view/lowercase_symbolic_id_guard.test.rb||test/phlex/view/lowercase_symbolic_id_guard.test.rb": [
          "File: test/phlex/view/lowercase_symbolic_id_guard.test.rb -> test/phlex/view/lowercase_symbolic_id_guard.test.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "[No context available]",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "1: # frozen_string_literal: true",
          "3: describe Phlex::SGML do",
          "4:  extend ViewHelper",
          "6:  with \"non lowercase id\" do",
          "7:   view do",
          "8:    def view_template",
          "9:     div(iD: \"a\")",
          "10:    end",
          "11:   end",
          "13:   it \"raises\" do",
          "14:    expect { output }.to raise_exception(Phlex::ArgumentError)",
          "15:   end",
          "16:  end",
          "18:  with \"non symbolic id\" do",
          "19:   view do",
          "20:    def view_template",
          "21:     div(\"id\" => \"a\")",
          "22:    end",
          "23:   end",
          "25:   it \"raises\" do",
          "26:    expect { output }.to raise_exception(Phlex::ArgumentError)",
          "27:   end",
          "28:  end",
          "29: end",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "bad756b4867652b3feecfa5fea90903b50a7799d",
      "candidate_info": {
        "commit_hash": "bad756b4867652b3feecfa5fea90903b50a7799d",
        "repo": "phlex-ruby/phlex",
        "commit_url": "https://github.com/phlex-ruby/phlex/commit/bad756b4867652b3feecfa5fea90903b50a7799d",
        "files": [
          "lib/phlex/sgml.rb"
        ],
        "message": "Remove trailing comma for truffle compat",
        "before_after_code_files": [
          "lib/phlex/sgml.rb||lib/phlex/sgml.rb"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 0,
        "same_branch_evolution": 1,
        "olp_code_files": {
          "patch": [
            "lib/phlex/sgml.rb||lib/phlex/sgml.rb"
          ],
          "candidate": [
            "lib/phlex/sgml.rb||lib/phlex/sgml.rb"
          ]
        }
      },
      "candidate_diff": {
        "lib/phlex/sgml.rb||lib/phlex/sgml.rb": [
          "File: lib/phlex/sgml.rb -> lib/phlex/sgml.rb",
          "--- Hunk 1 ---",
          "[Context before]",
          "416:      when :style",
          "417:       buffer << \" \" << name << '=\"' << __styles__(v).gsub('\"', \"&quot;\") << '\"'",
          "418:      else",
          "424:      end",
          "425:     when Array",
          "426:      value = case k",
          "",
          "[Removed Lines]",
          "419:       __nested_attributes__(",
          "420:        v,",
          "421:        \"#{name}-\",",
          "422:        buffer,",
          "423:       )",
          "",
          "[Added Lines]",
          "419:       __nested_attributes__(v, \"#{name}-\", buffer)",
          "",
          "---------------"
        ]
      }
    }
  ]
}