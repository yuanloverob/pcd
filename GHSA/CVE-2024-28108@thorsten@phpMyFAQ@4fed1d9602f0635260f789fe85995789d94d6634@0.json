{
  "cve_id": "CVE-2024-28108",
  "cve_desc": "phpMyFAQ is an open source FAQ web application for PHP 8.1+ and MySQL, PostgreSQL and other databases. Due to insufficient validation on the `contentLink` parameter, it is possible for unauthenticated users to inject HTML code to the page which might affect other users. _Also, requires that adding new FAQs is allowed for guests and that the admin doesn't check the content of a newly added FAQ._ This vulnerability is fixed in 3.2.6.",
  "repo": "thorsten/phpMyFAQ",
  "patch_hash": "4fed1d9602f0635260f789fe85995789d94d6634",
  "patch_info": {
    "commit_hash": "4fed1d9602f0635260f789fe85995789d94d6634",
    "repo": "thorsten/phpMyFAQ",
    "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/4fed1d9602f0635260f789fe85995789d94d6634",
    "files": [
      "phpmyfaq/api.service.php"
    ],
    "message": "fix: added missing conversion to HTML entities",
    "before_after_code_files": [
      "phpmyfaq/api.service.php||phpmyfaq/api.service.php"
    ]
  },
  "patch_diff": {
    "phpmyfaq/api.service.php||phpmyfaq/api.service.php": [
      "File: phpmyfaq/api.service.php -> phpmyfaq/api.service.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "412:                     $answer,",
      "413:                     Translation::get('msgInfo'),",
      "414:                     Strings::substr($contentLink, 7),",
      "416:                 );",
      "417:             }",
      "",
      "[Removed Lines]",
      "415:                     $contentLink",
      "",
      "[Added Lines]",
      "415:                     Strings::htmlentities($contentLink)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "de90315c9bd4ead5fe6ba5586f6b016843aa8209",
      "candidate_info": {
        "commit_hash": "de90315c9bd4ead5fe6ba5586f6b016843aa8209",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/de90315c9bd4ead5fe6ba5586f6b016843aa8209",
        "files": [
          "phpmyfaq/admin/user.php",
          "phpmyfaq/ucp.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/admin/user.php||phpmyfaq/admin/user.php",
          "phpmyfaq/ucp.php||phpmyfaq/ucp.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/admin/user.php||phpmyfaq/admin/user.php": [
          "File: phpmyfaq/admin/user.php -> phpmyfaq/admin/user.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "572:                     <td><?= Strings::htmlentities($user->getUserData('display_name')) ?></td>",
          "573:                     <td><?= Strings::htmlentities($user->getLogin()) ?></td>",
          "574:                     <td>",
          "577:                         </a>",
          "578:                     </td>",
          "579:                     <td>",
          "",
          "[Removed Lines]",
          "575:                         <a href=\"mailto:<?= $user->getUserData('email') ?>\">",
          "576:                             <?= $user->getUserData('email') ?>",
          "",
          "[Added Lines]",
          "575:                         <a href=\"mailto:<?= Strings::htmlentities($user->getUserData('email')) ?>\">",
          "576:                             <?= Strings::htmlentities($user->getUserData('email')) ?>",
          "",
          "---------------"
        ],
        "phpmyfaq/ucp.php||phpmyfaq/ucp.php": [
          "File: phpmyfaq/ucp.php -> phpmyfaq/ucp.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "75:             'msgRealName' => Translation::get('ad_user_name'),",
          "76:             'realname' => Strings::htmlentities($user->getUserData('display_name')),",
          "77:             'msgEmail' => Translation::get('msgNewContentMail'),",
          "79:             'msgIsVisible' => Translation::get('ad_user_data_is_visible'),",
          "80:             'checked' => (int)$user->getUserData('is_visible') === 1 ? 'checked' : '',",
          "81:             'msgPassword' => Translation::get('ad_auth_passwd'),",
          "",
          "[Removed Lines]",
          "78:             'email' => $user->getUserData('email'),",
          "",
          "[Added Lines]",
          "78:             'email' => Strings::htmlentities($user->getUserData('email')),",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "b3e5a053b59dcc072d76a55d6ce0311ea30174fa",
      "candidate_info": {
        "commit_hash": "b3e5a053b59dcc072d76a55d6ce0311ea30174fa",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/b3e5a053b59dcc072d76a55d6ce0311ea30174fa",
        "files": [
          "phpmyfaq/src/phpMyFAQ/Faq.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/src/phpMyFAQ/Faq.php||phpmyfaq/src/phpMyFAQ/Faq.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/src/phpMyFAQ/Faq.php||phpmyfaq/src/phpMyFAQ/Faq.php": [
          "File: phpmyfaq/src/phpMyFAQ/Faq.php -> phpmyfaq/src/phpMyFAQ/Faq.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "425:                     $visits = $row->visits;",
          "426:                 }",
          "429:                 $url = sprintf(",
          "430:                     '%sindex.php?%saction=faq&amp;cat=%d&amp;id=%d&amp;artlang=%s',",
          "431:                     $this->config->getDefaultUrl(),",
          "",
          "[Removed Lines]",
          "428:                 $title = $row->question;",
          "",
          "[Added Lines]",
          "428:                 $title = Strings::htmlentities($row->question);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "97d90ebbe11ebc6081bf49a2ba4b60f227cd1b43",
      "candidate_info": {
        "commit_hash": "97d90ebbe11ebc6081bf49a2ba4b60f227cd1b43",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/97d90ebbe11ebc6081bf49a2ba4b60f227cd1b43",
        "files": [
          "phpmyfaq/src/phpMyFAQ/Helper/FaqHelper.php",
          "phpmyfaq/src/phpMyFAQ/Helper/SearchHelper.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/src/phpMyFAQ/Helper/FaqHelper.php||phpmyfaq/src/phpMyFAQ/Helper/FaqHelper.php",
          "phpmyfaq/src/phpMyFAQ/Helper/SearchHelper.php||phpmyfaq/src/phpMyFAQ/Helper/SearchHelper.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/src/phpMyFAQ/Helper/FaqHelper.php||phpmyfaq/src/phpMyFAQ/Helper/FaqHelper.php": [
          "File: phpmyfaq/src/phpMyFAQ/Helper/FaqHelper.php -> phpmyfaq/src/phpMyFAQ/Helper/FaqHelper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "187:             $lastCategory = 0;",
          "188:             foreach ($faq->faqRecords as $data) {",
          "189:                 if ($data['category_id'] !== $lastCategory) {",
          "191:                 }",
          "193:                 $output .= sprintf('<h4>%s</h4>', Strings::htmlentities($data['title']));",
          "195:                 $output .= sprintf(",
          "196:                     '<p>%s: %s<br>%s',",
          "197:                     $PMF_LANG['msgAuthor'],",
          "",
          "[Removed Lines]",
          "190:                     $output .= sprintf('<h3>%s</h3>', $category->getPath($data['category_id'], ' &raquo; '));",
          "194:                 $output .= sprintf('<article>%s</article>', $data['content']);",
          "",
          "[Added Lines]",
          "190:                     $output .= sprintf(",
          "191:                         '<h3>%s</h3>',",
          "192:                         $this->cleanUpContent(",
          "193:                             $this->cleanUpContent($category->getPath($data['category_id'], ' &raquo; '))",
          "194:                         )",
          "195:                     );",
          "199:                 $output .= sprintf('<article>%s</article>', $this->cleanUpContent($data['content']));",
          "",
          "---------------"
        ],
        "phpmyfaq/src/phpMyFAQ/Helper/SearchHelper.php||phpmyfaq/src/phpMyFAQ/Helper/SearchHelper.php": [
          "File: phpmyfaq/src/phpMyFAQ/Helper/SearchHelper.php -> phpmyfaq/src/phpMyFAQ/Helper/SearchHelper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "258:                 );",
          "260:                 $oLink = new Link($currentUrl, $this->config);",
          "264:                 $html .= '<li>';",
          "265:                 $html .= $this->renderScore($result->score * 33);",
          "266:                 $html .= sprintf(",
          "267:                     '<strong>%s</strong>: %s<br>',",
          "269:                     $oLink->toHtmlAnchor()",
          "270:                 );",
          "271:                 $html .= sprintf(",
          "",
          "[Removed Lines]",
          "261:                 $oLink->text = $question;",
          "262:                 $oLink->itemTitle = $oLink->tooltip = $result->question;",
          "268:                     $categoryInfo[0]['name'],",
          "",
          "[Added Lines]",
          "261:                 $oLink->text = Strings::htmlentities($question);",
          "262:                 $oLink->itemTitle = $oLink->tooltip = Strings::htmlentities($result->question);",
          "268:                     Strings::htmlentities($categoryInfo[0]['name']),",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "3d274a117ca740e02b6bd7707240f0b7c42c46fa",
      "candidate_info": {
        "commit_hash": "3d274a117ca740e02b6bd7707240f0b7c42c46fa",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/3d274a117ca740e02b6bd7707240f0b7c42c46fa",
        "files": [
          "phpmyfaq/admin/record.edit.php",
          "phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/admin/record.edit.php||phpmyfaq/admin/record.edit.php",
          "phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php||phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/admin/record.edit.php||phpmyfaq/admin/record.edit.php": [
          "File: phpmyfaq/admin/record.edit.php -> phpmyfaq/admin/record.edit.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "486:                                                     printf(",
          "487:                                                         '<li><a href=\"../%s\">%s</a> ',",
          "488:                                                         $att->buildUrl(),",
          "490:                                                     );",
          "491:                                                     if ($user->perm->hasPermission($currentUserId, 'delattachment')) {",
          "492:                                                         printf(",
          "",
          "[Removed Lines]",
          "489:                                                         $att->getFilename()",
          "",
          "[Added Lines]",
          "489:                                                         Strings::htmlentities($att->getFilename())",
          "",
          "---------------"
        ],
        "phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php||phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php": [
          "File: phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php -> phpmyfaq/src/phpMyFAQ/Helper/AttachmentHelper.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: namespace phpMyFAQ\\Helper;",
          "20: use phpMyFAQ\\Attachment\\AttachmentAbstract;",
          "21: use phpMyFAQ\\Translation;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "21: use phpMyFAQ\\Strings;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "45:                 '<li><i class=\"fa fa-%s\" aria-hidden=\"true\"></i> <a href=\"%s\">%s</a></li>',",
          "46:                 $this->mapMimeTypeToIcon($attachment->getMimeType()),",
          "47:                 $attachment->buildUrl(),",
          "49:             );",
          "50:         }",
          "",
          "[Removed Lines]",
          "48:                 $attachment->getFilename()",
          "",
          "[Added Lines]",
          "49:                 Strings::htmlentities($attachment->getFilename())",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "09336b0ff0e0a04aa0c97c5975651af4769d2459",
      "candidate_info": {
        "commit_hash": "09336b0ff0e0a04aa0c97c5975651af4769d2459",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/09336b0ff0e0a04aa0c97c5975651af4769d2459",
        "files": [
          "phpmyfaq/admin/user.php",
          "phpmyfaq/ucp.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/admin/user.php||phpmyfaq/admin/user.php",
          "phpmyfaq/ucp.php||phpmyfaq/ucp.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/admin/user.php||phpmyfaq/admin/user.php": [
          "File: phpmyfaq/admin/user.php -> phpmyfaq/admin/user.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "573:                 <tr class=\"row_user_id_<?= $user->getUserId() ?>\">",
          "574:                     <td><?= Strings::htmlentities($user->getUserData('display_name')) ?></td>",
          "575:                     <td>",
          "578:                         </a>",
          "579:                     </td>",
          "580:                     <td><?= Strings::htmlentities($user->getLogin()) ?></td>",
          "",
          "[Removed Lines]",
          "576:                         <a href=\"mailto:<?= $user->getUserData('email') ?>\">",
          "577:                             <?= $user->getUserData('email') ?>",
          "",
          "[Added Lines]",
          "576:                         <a href=\"mailto:<?= Strings::htmlentities($user->getUserData('email')) ?>\">",
          "577:                             <?= Strings::htmlentities($user->getUserData('email')) ?>",
          "",
          "---------------"
        ],
        "phpmyfaq/ucp.php||phpmyfaq/ucp.php": [
          "File: phpmyfaq/ucp.php -> phpmyfaq/ucp.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "78:             'msgRealName' => Translation::get('ad_user_name'),",
          "79:             'realname' => Strings::htmlentities($user->getUserData('display_name')),",
          "80:             'msgEmail' => Translation::get('msgNewContentMail'),",
          "82:             'msgIsVisible' => Translation::get('ad_user_data_is_visible'),",
          "83:             'checked' => (int)$user->getUserData('is_visible') === 1 ? 'checked' : '',",
          "84:             'msgPassword' => Translation::get('ad_auth_passwd'),",
          "",
          "[Removed Lines]",
          "81:             'email' => $user->getUserData('email'),",
          "",
          "[Added Lines]",
          "81:             'email' => Strings::htmlentities($user->getUserData('email')),",
          "",
          "---------------"
        ]
      }
    }
  ]
}