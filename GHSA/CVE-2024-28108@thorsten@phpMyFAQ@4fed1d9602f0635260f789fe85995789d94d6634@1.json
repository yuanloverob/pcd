{
  "cve_id": "CVE-2024-28108",
  "cve_desc": "phpMyFAQ is an open source FAQ web application for PHP 8.1+ and MySQL, PostgreSQL and other databases. Due to insufficient validation on the `contentLink` parameter, it is possible for unauthenticated users to inject HTML code to the page which might affect other users. _Also, requires that adding new FAQs is allowed for guests and that the admin doesn't check the content of a newly added FAQ._ This vulnerability is fixed in 3.2.6.",
  "repo": "thorsten/phpMyFAQ",
  "patch_hash": "4fed1d9602f0635260f789fe85995789d94d6634",
  "patch_info": {
    "commit_hash": "4fed1d9602f0635260f789fe85995789d94d6634",
    "repo": "thorsten/phpMyFAQ",
    "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/4fed1d9602f0635260f789fe85995789d94d6634",
    "files": [
      "phpmyfaq/api.service.php"
    ],
    "message": "fix: added missing conversion to HTML entities",
    "before_after_code_files": [
      "phpmyfaq/api.service.php||phpmyfaq/api.service.php"
    ]
  },
  "patch_diff": {
    "phpmyfaq/api.service.php||phpmyfaq/api.service.php": [
      "File: phpmyfaq/api.service.php -> phpmyfaq/api.service.php",
      "--- Hunk 1 ---",
      "[Context before]",
      "412:                     $answer,",
      "413:                     Translation::get('msgInfo'),",
      "414:                     Strings::substr($contentLink, 7),",
      "416:                 );",
      "417:             }",
      "",
      "[Removed Lines]",
      "415:                     $contentLink",
      "",
      "[Added Lines]",
      "415:                     Strings::htmlentities($contentLink)",
      "",
      "---------------"
    ]
  },
  "candidates": [
    {
      "candidate_hash": "97e813dcd2022bd10a8770569a8b02591716365f",
      "candidate_info": {
        "commit_hash": "97e813dcd2022bd10a8770569a8b02591716365f",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/97e813dcd2022bd10a8770569a8b02591716365f",
        "files": [
          "phpmyfaq/admin/login.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/admin/login.php||phpmyfaq/admin/login.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/admin/login.php||phpmyfaq/admin/login.php": [
          "File: phpmyfaq/admin/login.php -> phpmyfaq/admin/login.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "19: use phpMyFAQ\\Component\\Alert;",
          "20: use phpMyFAQ\\Translation;",
          "21: use Symfony\\Component\\HttpFoundation\\Request;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: use phpMyFAQ\\Strings;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:                                     <form action=\"<?= $faqSystem->getSystemUri($faqConfig) ?>admin/index.php\"",
          "56:                                           method=\"post\" accept-charset=\"utf-8\" role=\"form\">",
          "57:                                         <input type=\"hidden\" name=\"redirect-action\"",
          "59:                                         <div class=\"form-floating mb-3\">",
          "60:                                             <input class=\"form-control\" id=\"faqusername\" name=\"faqusername\" type=\"text\"",
          "61:                                                    placeholder=\"<?= Translation::get('ad_auth_user') ?>\" />",
          "",
          "[Removed Lines]",
          "58:                                                value=\"<?= $request->query->get('action') ?>\">",
          "",
          "[Added Lines]",
          "59:                                                value=\"<?= Strings::htmlentities($request->query->get('action')) ?>\">",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "95ed9b20557ed930d4eed1f3a6db713416f31131",
      "candidate_info": {
        "commit_hash": "95ed9b20557ed930d4eed1f3a6db713416f31131",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/95ed9b20557ed930d4eed1f3a6db713416f31131",
        "files": [
          "phpmyfaq/admin/ajax.user.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/admin/ajax.user.php||phpmyfaq/admin/ajax.user.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/admin/ajax.user.php||phpmyfaq/admin/ajax.user.php": [
          "File: phpmyfaq/admin/ajax.user.php -> phpmyfaq/admin/ajax.user.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "66:             $userdata = $user->userdata->get('*');",
          "67:             $userdata['status'] = $user->getStatus();",
          "68:             $userdata['login'] = Strings::htmlentities($user->getLogin());",
          "69:             $userdata['is_superadmin'] = $user->isSuperAdmin();",
          "70:             $http->sendJsonWithHeaders($userdata);",
          "71:             break;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "69:             $userdata['display_name'] = Strings::htmlentities($userdata['display_name']);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "40eb9685198128908e83c2bef4c228751fd43a0e",
      "candidate_info": {
        "commit_hash": "40eb9685198128908e83c2bef4c228751fd43a0e",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/40eb9685198128908e83c2bef4c228751fd43a0e",
        "files": [
          "phpmyfaq/src/phpMyFAQ/Link.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/src/phpMyFAQ/Link.php||phpmyfaq/src/phpMyFAQ/Link.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/src/phpMyFAQ/Link.php||phpmyfaq/src/phpMyFAQ/Link.php": [
          "File: phpmyfaq/src/phpMyFAQ/Link.php -> phpmyfaq/src/phpMyFAQ/Link.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "315:         }",
          "317:         if (!empty($this->tooltip)) {",
          "319:         }",
          "321:         if (!empty($this->name)) {",
          "323:         } else {",
          "324:             if (!empty($this->url)) {",
          "325:                 $htmlAnchor .= sprintf(' href=\"%s\"', $url);",
          "",
          "[Removed Lines]",
          "318:             $htmlAnchor .= sprintf(' title=\"%s\"', addslashes($this->tooltip));",
          "322:             $htmlAnchor .= sprintf(' name=\"%s\"', $this->name);",
          "",
          "[Added Lines]",
          "318:             $htmlAnchor .= sprintf(' title=\"%s\"', Strings::htmlentities($this->tooltip));",
          "322:             $htmlAnchor .= sprintf(' name=\"%s\"', Strings::htmlentities($this->name));",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "333:         }",
          "334:         $htmlAnchor .= '>';",
          "335:         if (('0' == $this->text) || (!empty($this->text))) {",
          "337:         } else {",
          "338:             if (!empty($this->name)) {",
          "340:             } else {",
          "341:                 $htmlAnchor .= $url;",
          "342:             }",
          "",
          "[Removed Lines]",
          "336:             $htmlAnchor .= $this->text;",
          "339:                 $htmlAnchor .= $this->name;",
          "",
          "[Added Lines]",
          "336:             $htmlAnchor .= Strings::htmlentities($this->text);",
          "339:                 $htmlAnchor .= Strings::htmlentities($this->name);",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "332d2e4a83251d406ca58dd11c27c598673aa5fa",
      "candidate_info": {
        "commit_hash": "332d2e4a83251d406ca58dd11c27c598673aa5fa",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/332d2e4a83251d406ca58dd11c27c598673aa5fa",
        "files": [
          "phpmyfaq/admin/ajax.config_list.php"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/admin/ajax.config_list.php||phpmyfaq/admin/ajax.config_list.php"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/admin/ajax.config_list.php||phpmyfaq/admin/ajax.config_list.php": [
          "File: phpmyfaq/admin/ajax.config_list.php -> phpmyfaq/admin/ajax.config_list.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "22: use phpMyFAQ\\Helper\\AdministrationHelper;",
          "23: use phpMyFAQ\\Helper\\LanguageHelper;",
          "24: use phpMyFAQ\\Helper\\PermissionHelper;",
          "25: use phpMyFAQ\\System;",
          "26: use phpMyFAQ\\Utils;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "25: use phpMyFAQ\\Strings;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "95:                 is_numeric($value) ? 'number' : $type,",
          "96:                 $key,",
          "97:                 $key,",
          "99:             );",
          "100:             if ('api.apiClientToken' === $key) {",
          "101:                 echo '<div class=\"input-group-append\">';",
          "",
          "[Removed Lines]",
          "98:                 $value",
          "",
          "[Added Lines]",
          "99:                 Strings::htmlentities($value)",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "143:             printf(",
          "144:                 '<input class=\"form-control\" type=\"password\" autocomplete=\"off\" name=\"edit[%s]\" value=\"%s\">',",
          "145:                 $key,",
          "147:             );",
          "148:             echo \"</div>\\n\";",
          "149:             break;",
          "",
          "[Removed Lines]",
          "146:                 $faqConfig->get($key)",
          "",
          "[Added Lines]",
          "147:                 Strings::htmlentities($faqConfig->get($key))",
          "",
          "---------------"
        ]
      }
    },
    {
      "candidate_hash": "1037a8f012e0d9ec4bf4c8107972f6695e381392",
      "candidate_info": {
        "commit_hash": "1037a8f012e0d9ec4bf4c8107972f6695e381392",
        "repo": "thorsten/phpMyFAQ",
        "commit_url": "https://github.com/thorsten/phpMyFAQ/commit/1037a8f012e0d9ec4bf4c8107972f6695e381392",
        "files": [
          "phpmyfaq/admin/ajax.tags.php",
          "phpmyfaq/admin/assets/js/tags.js"
        ],
        "message": "fix: added missing conversion to HTML entities",
        "before_after_code_files": [
          "phpmyfaq/admin/ajax.tags.php||phpmyfaq/admin/ajax.tags.php",
          "phpmyfaq/admin/assets/js/tags.js||phpmyfaq/admin/assets/js/tags.js"
        ]
      },
      "candidate_patch_features": {
        "candidate_earlier_than_patch": 1,
        "same_branch_message": 1,
        "olp_code_files": {
          "patch": [],
          "candidate": []
        }
      },
      "candidate_diff": {
        "phpmyfaq/admin/ajax.tags.php||phpmyfaq/admin/ajax.tags.php": [
          "File: phpmyfaq/admin/ajax.tags.php -> phpmyfaq/admin/ajax.tags.php",
          "--- Hunk 1 ---",
          "[Context before]",
          "18: use phpMyFAQ\\Filter;",
          "19: use phpMyFAQ\\Helper\\HttpHelper;",
          "20: use phpMyFAQ\\Tags;",
          "21: use phpMyFAQ\\Entity\\TagEntity as TagEntity;",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "20: use phpMyFAQ\\Strings;",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "55:                 ++$i;",
          "56:                 if ($i <= PMF_TAGS_AUTOCOMPLETE_RESULT_SET_SIZE) {",
          "57:                     $currentTag = new stdClass();",
          "59:                     $tagNames[] = $currentTag;",
          "60:                 }",
          "61:             }",
          "",
          "[Removed Lines]",
          "58:                     $currentTag->tagName = $tagName;",
          "",
          "[Added Lines]",
          "59:                     $currentTag->tagName = Strings::htmlentities($tagName);",
          "",
          "---------------"
        ],
        "phpmyfaq/admin/assets/js/tags.js||phpmyfaq/admin/assets/js/tags.js": [
          "File: phpmyfaq/admin/assets/js/tags.js -> phpmyfaq/admin/assets/js/tags.js",
          "--- Hunk 1 ---",
          "[Context before]",
          "24:       span.replaceWith('<input name=\"tag\" class=\"form-control\" data-tag-id=\"' + id + '\" value=\"' + span.html() + '\">');",
          "25:     } else {",
          "26:       const input = $('input[data-tag-id=\"' + id + '\"]');",
          "28:     }",
          "29:   });",
          "",
          "[Removed Lines]",
          "27:       input.replaceWith('<span data-tag-id=\"' + id + '\">' + input.val().replace(/\\//g, '&#x2F;') + '</span>');",
          "",
          "[Added Lines]",
          "27:       input.replaceWith('<span data-tag-id=\"' + id + '\">' + escape(input.val().replace(/\\//g, '&#x2F;')) + '</span>');",
          "",
          "---------------",
          "--- Hunk 2 ---",
          "[Context before]",
          "36:     const tag = input.val();",
          "37:     const csrf = $('input[name=csrf]').val();",
          "43:     $.ajax({",
          "44:       url: 'index.php?action=ajax&ajax=tags&ajaxaction=update',",
          "45:       type: 'POST',",
          "",
          "[Removed Lines]",
          "39:     const escape = (unsafe) => {",
          "40:       return unsafe.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('\"', '&quot;').replaceAll(\"'\", '&#039;');",
          "41:     }",
          "",
          "[Added Lines]",
          "[None]",
          "",
          "---------------",
          "--- Hunk 3 ---",
          "[Context before]",
          "60:     return false;",
          "61:   });",
          "62: });",
          "",
          "[Removed Lines]",
          "[None]",
          "",
          "[Added Lines]",
          "59:   const escape = (unsafe) => {",
          "60:     return unsafe.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('\"', '&quot;').replaceAll(\"'\", '&#039;');",
          "61:   }",
          "",
          "---------------"
        ]
      }
    }
  ]
}